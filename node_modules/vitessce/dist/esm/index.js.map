{
  "version": 3,
  "sources": ["../../src/components/heatmap/HeatmapSubscriber.js", "../../src/components/TitleInfo.js", "../../src/components/classNames.js", "../../src/components/LoadingIndicator.js", "../../src/components/shared-mui/components.js", "../../src/components/hooks.js", "../../src/app/state/hooks.js", "../../src/utils.js", "../../src/components/shared-mui/styles.js", "../../src/components/utils.js", "../../src/components/sets/constants.js", "../../src/components/data-hooks.js", "../../src/loaders/errors/AbstractLoaderError.js", "../../src/loaders/errors/LoaderValidationError.js", "../../src/loaders/errors/LoaderNotFoundError.js", "../../node_modules/@hms-dbmi/viv/dist/viv.es.js", "../../src/components/spatial/constants.js", "../../src/app/state/coordination.js", "../../src/components/sets/cell-set-utils.js", "../../src/components/sets/utils.js", "../../src/components/interpolate-colors.js", "../../src/components/heatmap/Heatmap.js", "../../src/layers/HeatmapCompositeTextLayer.js", "../../src/layers/heatmap-constants.js", "../../src/layers/PixelatedBitmapLayer.js", "../../src/layers/HeatmapBitmapLayer.js", "../../src/layers/constants.js", "../../src/layers/heatmap-bitmap-layer-shaders.js", "../../src/components/heatmap/utils.js", "inline-worker:/home/runner/work/vitessce/vitessce/src/components/heatmap/heatmap.worker", "../../src/Pool.js", "../../src/components/heatmap/HeatmapWorkerPool.js", "../../src/components/heatmap/HeatmapTooltipSubscriber.js", "../../src/components/tooltip/Tooltip2D.js", "../../src/components/tooltip/Tooltip.js", "../../src/components/tooltip/styles.js", "../../src/components/tooltip/TooltipContent.js", "../../src/components/heatmap/HeatmapOptions.js", "../../src/components/shared-plot-options/styles.js", "../../src/components/shared-plot-options/OptionsContainer.js", "../../src/components/shared-plot-options/OptionSelect.js", "../../src/components/spatial/SpatialSubscriber.js", "../../src/components/spatial/Spatial.js", "../../src/layers/selection-utils.js", "../../src/layers/SelectionLayer.js", "../../src/components/spatial/utils.js", "../../src/layers/BitmaskLayer.js", "../../src/layers/bitmask-layer-shaders.js", "../../src/components/layer-controller/utils.js", "../../src/components/shared-spatial-scatterplot/AbstractSpatialOrScatterplot.js", "../../src/components/shared-spatial-scatterplot/ToolMenu.js", "../../src/assets/tools/near_me.svg", "../../src/assets/tools/selection_rectangle.svg", "../../src/assets/tools/selection_lasso.svg", "../../src/components/shared-spatial-scatterplot/cursor.js", "../../src/components/shared-spatial-scatterplot/quadtree.js", "../../src/layer-extensions/ScaledExpressionExtension/ScaledExpressionExtension.js", "../../src/layer-extensions/ScaledExpressionExtension/shader-module.js", "../../src/layer-extensions/ScaledExpressionExtension/index.js", "../../src/layer-extensions/SelectionExtension/SelectionExtension.js", "../../src/layer-extensions/SelectionExtension/shader-module.js", "../../src/layer-extensions/SelectionExtension/index.js", "../../src/components/spatial/SpatialOptions.js", "../../src/components/shared-plot-options/CellColorEncodingOption.js", "../../src/components/spatial/SpatialTooltipSubscriber.js", "../../src/components/scatterplot/ScatterplotSubscriber.js", "../../src/components/scatterplot/Scatterplot.js", "../../src/components/shared-spatial-scatterplot/force-collide-rects.js", "../../src/components/scatterplot/ScatterplotTooltipSubscriber.js", "../../src/components/scatterplot/ScatterplotOptions.js", "../../src/components/shared-spatial-scatterplot/dynamic-opacity.js", "../../src/app/VitessceGrid.js", "../../src/app/vitessce-grid-layout/VitessceGridLayout.js", "../../src/app/vitessce-grid-layout/layout-utils.js", "../../src/app/vitessce-grid-utils.js", "../../src/loaders/JsonLoader.js", "../../src/loaders/AbstractLoader.js", "../../src/loaders/AbstractTwoStepLoader.js", "../../src/loaders/LoaderResult.js", "../../src/loaders/MatrixZarrLoader.js", "../../src/loaders/GenesJsonAsMatrixZarrLoader.js", "../../src/loaders/ClustersJsonAsMatrixZarrLoader.js", "../../src/loaders/RasterJsonLoader.js", "../../src/loaders/OmeZarrLoader.js", "../../src/components/sets/io.js", "../../src/loaders/CellSetsJsonLoader.js", "../../src/loaders/anndata-loaders/CellSetsZarrLoader.js", "../../src/loaders/anndata-loaders/CellsZarrLoader.js", "../../src/loaders/anndata-loaders/MatrixZarrLoader.js", "../../src/loaders/anndata-loaders/index.js", "../../src/loaders/GenomicProfilesZarrLoader.js", "../../src/loaders/data-sources/AnnDataSource.js", "../../src/loaders/data-sources/ZarrDataSource.js", "../../src/loaders/errors/DataSourceFetchError.js", "../../src/loaders/data-sources/JsonSource.js", "../../src/loaders/types.js", "../../src/app/app.js", "../../src/app/api.js", "../../src/app/Welcome.js", "../../src/app/Warning.js", "../../src/app/Vitessce.js", "../../src/app/CallbackPublisher.js", "../../src/app/view-config-versions.js", "../../src/app/view-config-upgraders.js", "../../src/components/description/DescriptionSubscriber.js", "../../src/components/description/Description.js", "../../src/components/status/StatusSubscriber.js", "../../src/components/status/Status.js", "../../src/components/genes/GenesSubscriber.js", "../../src/components/genes/Genes.js", "../../src/components/selectable-table/SelectableTable.js", "../../src/components/sets/CellSetsManagerSubscriber.js", "../../src/components/sets/SetsManager.js", "../../src/components/sets/Tree.js", "../../src/components/sets/TreeNode.js", "../../src/components/sets/PopoverMenu.js", "../../src/components/sets/Popover.js", "../../src/components/sets/HelpTooltip.js", "../../src/assets/menu.svg", "../../src/components/sets/SetsManagerButtons.js", "../../src/assets/sets/union.svg", "../../src/assets/sets/intersection.svg", "../../src/assets/sets/complement.svg", "../../src/components/layer-controller/LayerControllerSubscriber.js", "../../src/components/layer-controller/RasterChannelController.js", "../../src/components/layer-controller/ChannelOptions.js", "../../src/components/layer-controller/ColorPalette.js", "../../src/components/layer-controller/constants.js", "../../src/components/layer-controller/shared-channel-controls.js", "../../src/components/layer-controller/styles.js", "../../src/components/layer-controller/BitmaskChannelController.js", "../../src/components/layer-controller/VectorLayerController.js", "../../src/components/layer-controller/LayerController.js", "../../src/components/layer-controller/LayerOptions.js", "../../src/components/layer-controller/VolumeOptions.js", "../../src/components/layer-controller/ImageAddButton.js", "../../src/components/higlass/HiGlassSubscriber.js", "../../src/components/higlass/HiGlassLazy.js", "../../src/components/sets/CellSetSizesPlotSubscriber.js", "../../src/components/sets/CellSetSizesPlot.js", "../../src/components/vega/VegaPlot.js", "../../src/components/vega/ReactVega.js", "../../src/components/vega/utils.js", "../../src/components/higlass/GenomicProfilesSubscriber.js", "../../src/components/genes/ExpressionHistogramSubscriber.js", "../../src/components/genes/ExpressionHistogram.js", "../../src/components/sets/CellSetExpressionPlotSubscriber.js", "../../src/components/sets/hooks.js", "../../src/components/sets/CellSetExpressionPlotOptions.js", "../../src/components/sets/CellSetExpressionPlot.js", "../../src/app/component-registry.js", "../../src/app/view-config-utils.js", "../../src/app/export-utils.js", "../../src/api/VitessceConfig.js"],
  "sourcesContent": ["import React, {\n  useEffect, useState, useCallback, useMemo,\n} from 'react';\nimport TitleInfo from '../TitleInfo';\nimport { pluralize, capitalize } from '../../utils';\nimport { useDeckCanvasSize, useReady, useUrls } from '../hooks';\nimport { mergeCellSets } from '../utils';\nimport {\n  useCellsData,\n  useCellSetsData,\n  useExpressionMatrixData,\n} from '../data-hooks';\nimport { getCellColors } from '../interpolate-colors';\nimport {\n  useCoordination, useLoaders,\n  useSetComponentHover, useSetComponentViewInfo,\n} from '../../app/state/hooks';\nimport {\n  COMPONENT_COORDINATION_TYPES,\n} from '../../app/state/coordination';\nimport Heatmap from './Heatmap';\nimport HeatmapTooltipSubscriber from './HeatmapTooltipSubscriber';\nimport HeatmapOptions from './HeatmapOptions';\n\nconst HEATMAP_DATA_TYPES = ['cells', 'cell-sets', 'expression-matrix'];\n\n/**\n * @param {object} props\n * @param {number} props.uuid The unique identifier for this component.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n * @param {boolean} props.transpose Whether to\n * render as cell-by-gene or gene-by-cell.\n * @param {string} props.observationsLabelOverride The singular\n * form of the name of the observation.\n * @param {string} props.observationsPluralLabelOverride The\n * plural form of the name of the observation.\n * @param {string} props.variablesLabelOverride The singular\n * form of the name of the variable.\n * @param {string} props.variablesPluralLabelOverride The plural\n * form of the name of the variable.\n * @param {boolean} props.disableTooltip Whether to disable the\n * tooltip on mouse hover.\n */\nexport default function HeatmapSubscriber(props) {\n  const {\n    uuid,\n    coordinationScopes,\n    removeGridComponent, theme, transpose,\n    observationsLabelOverride: observationsLabel = 'cell',\n    observationsPluralLabelOverride: observationsPluralLabel = `${observationsLabel}s`,\n    variablesLabelOverride: variablesLabel = 'gene',\n    variablesPluralLabelOverride: variablesPluralLabel = `${variablesLabel}s`,\n    disableTooltip = false,\n    title = 'Heatmap',\n  } = props;\n\n  const loaders = useLoaders();\n  const setComponentHover = useSetComponentHover();\n  const setComponentViewInfo = useSetComponentViewInfo(uuid);\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    heatmapZoomX: zoomX,\n    heatmapTargetX: targetX,\n    heatmapTargetY: targetY,\n    geneSelection,\n    cellHighlight,\n    geneHighlight,\n    cellSetSelection,\n    cellSetColor,\n    additionalCellSets,\n    geneExpressionColormap,\n    geneExpressionColormapRange,\n  }, {\n    setHeatmapZoomX: setZoomX,\n    setHeatmapZoomY: setZoomY,\n    setHeatmapTargetX: setTargetX,\n    setHeatmapTargetY: setTargetY,\n    setCellHighlight,\n    setGeneHighlight,\n    setCellSetSelection,\n    setCellSetColor,\n    setGeneExpressionColormapRange,\n    setGeneExpressionColormap,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.heatmap, coordinationScopes);\n\n  const observationsTitle = capitalize(observationsPluralLabel);\n  const variablesTitle = capitalize(variablesPluralLabel);\n\n  const [isRendering, setIsRendering] = useState(false);\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    HEATMAP_DATA_TYPES,\n  );\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [width, height, deckRef] = useDeckCanvasSize();\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [cells] = useCellsData(loaders, dataset, setItemIsReady, addUrl, true);\n  const [expressionMatrix] = useExpressionMatrixData(\n    loaders, dataset, setItemIsReady, addUrl, true,\n  );\n  const [cellSets] = useCellSetsData(\n    loaders, dataset, setItemIsReady, addUrl, false,\n    { setCellSetSelection, setCellSetColor },\n    { cellSetSelection, cellSetColor },\n  );\n\n  const mergedCellSets = useMemo(() => mergeCellSets(\n    cellSets, additionalCellSets,\n  ), [cellSets, additionalCellSets]);\n\n  const cellColors = useMemo(() => getCellColors({\n    // Only show cell set selection on heatmap labels.\n    cellColorEncoding: 'cellSetSelection',\n    geneSelection,\n    cellSets: mergedCellSets,\n    cellSetSelection,\n    cellSetColor,\n    expressionDataAttrs: expressionMatrix,\n    theme,\n  }), [mergedCellSets, geneSelection, theme,\n    cellSetColor, cellSetSelection, expressionMatrix]);\n\n  const getCellInfo = useCallback((cellId) => {\n    if (cellId) {\n      const cellInfo = cells[cellId];\n      return {\n        [`${capitalize(observationsLabel)} ID`]: cellId,\n        ...(cellInfo ? cellInfo.factors : {}),\n      };\n    }\n    return null;\n  }, [cells, observationsLabel]);\n\n  const getGeneInfo = useCallback((geneId) => {\n    if (geneId) {\n      return { [`${capitalize(variablesLabel)} ID`]: geneId };\n    }\n    return null;\n  }, [variablesLabel]);\n\n  const cellsCount = expressionMatrix && expressionMatrix.rows\n    ? expressionMatrix.rows.length : 0;\n  const genesCount = expressionMatrix && expressionMatrix.cols\n    ? expressionMatrix.cols.length : 0;\n  const selectedCount = cellColors.size;\n  return (\n    <TitleInfo\n      title={title}\n      info={`${cellsCount} ${pluralize(observationsLabel, observationsPluralLabel, cellsCount)} \u00D7 ${genesCount} ${pluralize(variablesLabel, variablesPluralLabel, genesCount)},\n             with ${selectedCount} ${pluralize(observationsLabel, observationsPluralLabel, selectedCount)} selected`}\n      urls={urls}\n      theme={theme}\n      removeGridComponent={removeGridComponent}\n      isReady={isReady && !isRendering}\n      options={(\n        <HeatmapOptions\n          geneExpressionColormap={geneExpressionColormap}\n          setGeneExpressionColormap={setGeneExpressionColormap}\n          geneExpressionColormapRange={geneExpressionColormapRange}\n          setGeneExpressionColormapRange={setGeneExpressionColormapRange}\n        />\n      )}\n    >\n      <Heatmap\n        ref={deckRef}\n        transpose={transpose}\n        viewState={{ zoom: zoomX, target: [targetX, targetY] }}\n        setViewState={({ zoom, target }) => {\n          setZoomX(zoom);\n          setZoomY(zoom);\n          setTargetX(target[0]);\n          setTargetY(target[1]);\n        }}\n        colormapRange={geneExpressionColormapRange}\n        setColormapRange={setGeneExpressionColormapRange}\n        height={height}\n        width={width}\n        theme={theme}\n        uuid={uuid}\n        expressionMatrix={expressionMatrix}\n        cellColors={cellColors}\n        colormap={geneExpressionColormap}\n        setIsRendering={setIsRendering}\n        setCellHighlight={setCellHighlight}\n        setGeneHighlight={setGeneHighlight}\n        setComponentHover={() => {\n          setComponentHover(uuid);\n        }}\n        updateViewInfo={setComponentViewInfo}\n        observationsTitle={observationsTitle}\n        variablesTitle={variablesTitle}\n      />\n      {!disableTooltip && (\n      <HeatmapTooltipSubscriber\n        parentUuid={uuid}\n        width={width}\n        height={height}\n        transpose={transpose}\n        getCellInfo={getCellInfo}\n        getGeneInfo={getGeneInfo}\n        cellHighlight={cellHighlight}\n        geneHighlight={geneHighlight}\n      />\n      )}\n    </TitleInfo>\n  );\n}\n", "import React, { useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport CloudDownloadIcon from '@material-ui/icons/CloudDownload';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport IconButton from '@material-ui/core/IconButton';\nimport Link from '@material-ui/core/Link';\nimport ArrowDropDownIcon from '@material-ui/icons/ArrowDropDown';\nimport ArrowDropUpIcon from '@material-ui/icons/ArrowDropUp';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport CloseIcon from '@material-ui/icons/Close';\n\nimport { SCROLL_CARD, BLACK_CARD, SECONDARY_CARD } from './classNames';\nimport LoadingIndicator from './LoadingIndicator';\nimport { PopperMenu } from './shared-mui/components';\n\nconst useStyles = makeStyles(theme => ({\n  iconButton: {\n    border: 'none',\n    marginLeft: 0,\n    background: 'none',\n    color: theme.palette.primaryForeground,\n    paddingLeft: '0.25em',\n    paddingRight: '0.25em',\n    borderRadius: '2px',\n    '&:hover': {\n      backgroundColor: theme.palette.primaryBackgroundLight,\n    },\n    '&:first-child': {\n      marginLeft: '0.25em',\n    },\n    '&:last-child': {\n      marginRight: '0.25em',\n    },\n    '& svg': {\n      width: '0.7em',\n      height: '0.7em',\n      verticalAlign: 'middle',\n      overflow: 'visible',\n    },\n  },\n  downloadLink: {\n    color: theme.palette.primaryForeground,\n  },\n}));\n\nfunction SettingsIconWithArrow({ open }) {\n  return (\n    <>\n      <SettingsIcon />\n      {open ? <ArrowDropUpIcon /> : <ArrowDropDownIcon />}\n    </>\n  );\n}\n\nfunction PlotOptions(props) {\n  const { options } = props;\n  const [open, setOpen] = useState(false);\n  const classes = useStyles();\n  return (\n    <PopperMenu\n      open={open}\n      setOpen={setOpen}\n      buttonIcon={<SettingsIconWithArrow open={open} />}\n      buttonClassName={classes.iconButton}\n      placement=\"bottom-end\"\n    >\n      {options}\n    </PopperMenu>\n  );\n}\n\nfunction CloudDownloadIconWithArrow({ open }) {\n  return (\n    <>\n      <CloudDownloadIcon />\n      {open ? <ArrowDropUpIcon /> : <ArrowDropDownIcon />}\n    </>\n  );\n}\n\nfunction DownloadOptions(props) {\n  const { urls } = props;\n  const [open, setOpen] = useState(false);\n  const classes = useStyles();\n  return (\n    <PopperMenu\n      open={open}\n      setOpen={setOpen}\n      buttonIcon={<CloudDownloadIconWithArrow open={open} />}\n      buttonClassName={classes.iconButton}\n      placement=\"bottom-end\"\n    >\n      {urls.map(({ url, name }) => (\n        <MenuItem dense key={url}>\n          <Link underline=\"none\" href={url} target=\"_blank\" rel=\"noopener\" className={classes.downloadLink}>\n            Download {name}\n          </Link>\n        </MenuItem>\n      ))}\n    </PopperMenu>\n  );\n}\n\nfunction ClosePaneButton(props) {\n  const { removeGridComponent } = props;\n  const classes = useStyles();\n  return (\n    <IconButton\n      onClick={removeGridComponent}\n      size=\"small\"\n      className={classes.iconButton}\n      title=\"close\"\n    >\n      <CloseIcon />\n    </IconButton>\n  );\n}\n\nexport default function TitleInfo(props) {\n  const {\n    title, info, children, isScroll, isSpatial, removeGridComponent, urls,\n    isReady, options,\n  } = props;\n  // eslint-disable-next-line no-nested-ternary\n  const childClassName = isScroll ? SCROLL_CARD : (isSpatial ? BLACK_CARD : SECONDARY_CARD);\n  return (\n    // d-flex without wrapping div is not always full height; I don't understand the root cause.\n    <>\n      <div className=\"title\">\n        <div className=\"title-left\">\n          {title}\n        </div>\n        <div className=\"title-info\" title={info}>\n          {info}\n        </div>\n        <div className=\"title-buttons\">\n          { options && (\n            <PlotOptions\n              options={options}\n            />\n          ) }\n          {urls && urls.length > 0 && (\n            <DownloadOptions\n              urls={urls}\n            />\n          )}\n          <ClosePaneButton\n            removeGridComponent={removeGridComponent}\n          />\n        </div>\n      </div>\n      <div className={childClassName}>\n        { !isReady && <LoadingIndicator /> }\n        {children}\n      </div>\n    </>\n    // \"pl-2\" only matters when the window is very narrow.\n  );\n}\n", "export const TOOLTIP_ANCESTOR = 'tooltip-ancestor';\nconst CARD = `card card-body my-2 ${TOOLTIP_ANCESTOR}`;\nexport const PRIMARY_CARD = `${CARD} bg-primary`;\nexport const SECONDARY_CARD = `${CARD} bg-secondary`;\nexport const BLACK_CARD = `${CARD} bg-black`;\nexport const TITLE_CARD = 'title';\nexport const SCROLL_CARD = `${PRIMARY_CARD} scroll`;\nexport const VITESSCE_CONTAINER = 'vitessce-container';\n", "import React from 'react';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nexport default function LoadingIndicator() {\n  return (\n    <div className=\"loading-indicator-backdrop\">\n      <div className=\"loading-indicator-container\">\n        <CircularProgress />\n      </div>\n    </div>\n  );\n}\n", "import React, { useRef } from 'react';\nimport Paper from '@material-ui/core/Paper';\nimport Popper from '@material-ui/core/Popper';\nimport IconButton from '@material-ui/core/IconButton';\nimport MenuList from '@material-ui/core/MenuList';\nimport ClickAwayListener from '@material-ui/core/ClickAwayListener';\nimport Fade from '@material-ui/core/Fade';\nimport { useVitessceContainer } from '../hooks';\nimport { styles } from './styles';\n\nexport function MuiSpan(props) {\n  const { children } = props;\n  const classes = styles();\n  return <span className={classes.span}>{children}</span>;\n}\n\nexport function PopperMenu(props) {\n  const {\n    buttonIcon,\n    open,\n    setOpen,\n    children,\n    buttonClassName,\n  } = props;\n  const classes = styles();\n\n  const anchorRef = useRef();\n\n  const handleClick = () => {\n    setOpen(prev => !prev);\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n\n  const id = open ? 'v-popover-menu' : undefined;\n\n  const getTooltipContainer = useVitessceContainer(anchorRef);\n\n  return (\n    <div ref={anchorRef} className={classes.container}>\n      <IconButton\n        aria-describedby={id}\n        onClick={handleClick}\n        size=\"small\"\n        className={buttonClassName}\n      >\n        {buttonIcon}\n      </IconButton>\n      <Popper\n        id={id}\n        open={open}\n        anchorEl={anchorRef && anchorRef.current}\n        container={getTooltipContainer}\n        onClose={handleClose}\n        placement=\"bottom-end\"\n        transition\n      >\n        {({ TransitionProps }) => (\n          <ClickAwayListener onClickAway={handleClose}>\n            <Fade {...TransitionProps} timeout={100}>\n              <Paper elevation={4} className={classes.paper}>\n                <MenuList>{children}</MenuList>\n              </Paper>\n            </Fade>\n          </ClickAwayListener>\n        )}\n      </Popper>\n    </div>\n  );\n}\n", "import {\n  useRef, useState, useEffect, useCallback, useMemo,\n} from 'react';\nimport debounce from 'lodash/debounce';\nimport { useGridResize, useEmitGridResize } from '../app/state/hooks';\nimport { VITESSCE_CONTAINER } from './classNames';\n\nfunction getWindowDimensions() {\n  const { innerWidth: width, innerHeight: height } = window;\n  return {\n    width,\n    height,\n  };\n}\n\nexport function useVitessceContainer(ref) {\n  return useCallback(() => {\n    if (ref.current) {\n      return ref.current.closest(`.${VITESSCE_CONTAINER}`);\n    }\n    return null;\n  }, [ref]);\n}\n\n/**\n * Custom hook, gets the full window dimensions.\n * @returns {array} `[width, height]` where width and height\n * are numbers.\n */\nexport function useWindowDimensions() {\n  const [windowDimensions, setWindowDimensions] = useState(\n    getWindowDimensions(),\n  );\n\n  useEffect(() => {\n    function handleResize() {\n      setWindowDimensions(getWindowDimensions());\n    }\n    const onResizeDebounced = debounce(handleResize, 100, { trailing: true });\n\n    window.addEventListener('resize', onResizeDebounced);\n    return () => window.removeEventListener('resize', onResizeDebounced);\n  }, []);\n\n  return windowDimensions;\n}\n\n/**\n * Custom hook, subscribes to GRID_RESIZE and window resize events.\n * @returns {array} `[width, height, containerRef]` where width and height\n * are numbers and containerRef is a React ref.\n */\nexport function useGridItemSize() {\n  const containerRef = useRef();\n\n  const [height, setHeight] = useState();\n  const [width, setWidth] = useState();\n\n  const resizeCount = useGridResize();\n  const incrementResizeCount = useEmitGridResize();\n\n  // On window resize events, increment the grid resize count.\n  useEffect(() => {\n    function onWindowResize() {\n      incrementResizeCount();\n    }\n    const onResizeDebounced = debounce(onWindowResize, 100, { trailing: true });\n    window.addEventListener('resize', onResizeDebounced);\n    onWindowResize();\n    return () => {\n      window.removeEventListener('resize', onResizeDebounced);\n    };\n  }, [incrementResizeCount]);\n\n  // On new grid resize counts, re-compute the component\n  // width/height.\n  useEffect(() => {\n    if (!containerRef.current) return;\n    const container = containerRef.current;\n    const containerRect = container.getBoundingClientRect();\n    setHeight(containerRect.height);\n    setWidth(containerRect.width);\n  }, [resizeCount]);\n\n  return [width, height, containerRef];\n}\n\n/**\n * Custom hook, subscribes to GRID_RESIZE and window resize events.\n * @returns {array} `[width, height, deckRef]` where width and height\n * are numbers and deckRef is a React ref to be used with\n * a <DeckGL/> element (or a forwardRef to one).\n */\nexport function useDeckCanvasSize() {\n  const deckRef = useRef();\n\n  const [height, setHeight] = useState();\n  const [width, setWidth] = useState();\n\n  const resizeCount = useGridResize();\n  const incrementResizeCount = useEmitGridResize();\n\n  // On window resize events, increment the grid resize count.\n  useEffect(() => {\n    function onWindowResize() {\n      incrementResizeCount();\n    }\n    const onResizeDebounced = debounce(onWindowResize, 100, { trailing: true });\n    window.addEventListener('resize', onResizeDebounced);\n    onWindowResize();\n    return () => {\n      window.removeEventListener('resize', onResizeDebounced);\n    };\n  }, [incrementResizeCount]);\n\n  // On new grid resize counts, re-compute the DeckGL canvas\n  // width/height.\n  useEffect(() => {\n    if (!deckRef.current) return;\n    const { canvas } = deckRef.current.deck;\n    const canvasRect = canvas.getBoundingClientRect();\n    setHeight(canvasRect.height);\n    setWidth(canvasRect.width);\n  }, [resizeCount]);\n\n  return [width, height, deckRef];\n}\n\n/**\n * This hook handles a boolean isReady value,\n * which only returns true once every item in the\n * input list has been marked as \"ready\".\n * @param {string[]} items The items to wait on.\n * Should be defined as a constant\n * (outside a function component / render function),\n * otherwise strange bugs may occur.\n * @returns {array} An array\n * [isReady, setItemIsReady, setItemIsNotReady, resetReadyItems]\n * where isReady is the boolean value,\n * setItemIsReady marks one item as ready,\n * setItemIsNotReady marks one item as not ready,\n * and resetReadyItem marks all items as waiting.\n */\nexport function useReady(supportedItems) {\n  const items = supportedItems;\n  const [waiting, setWaiting] = useState(items);\n\n  const setItemIsReady = useCallback((readyItem) => {\n    setWaiting((waitingItems) => {\n      const nextWaitingItems = waitingItems.filter(item => item !== readyItem);\n      // eslint-disable-next-line no-console\n      console.log(`cleared ${readyItem}; waiting on ${nextWaitingItems.length}: ${JSON.stringify(nextWaitingItems)}`);\n      return nextWaitingItems;\n    });\n  }, [setWaiting]);\n\n  const setItemIsNotReady = useCallback((notReadyItem) => {\n    setWaiting((waitingItems) => {\n      const nextWaitingItems = [...waitingItems, notReadyItem];\n      // eslint-disable-next-line no-console\n      console.log(`waiting on ${nextWaitingItems.length}: ${JSON.stringify(nextWaitingItems)}`);\n      return nextWaitingItems;\n    });\n  }, [setWaiting]);\n\n  const resetReadyItems = useCallback(() => {\n    setWaiting(items);\n    // eslint-disable-next-line no-console\n    console.log(`waiting on ${items.length}: ${JSON.stringify(items)}`);\n  }, [setWaiting, items]);\n\n  const isReady = waiting.length === 0;\n\n  return [isReady, setItemIsReady, setItemIsNotReady, resetReadyItems];\n}\n\n/**\n * This hook manages a list of URLs,\n * with adding and resetting helpers.\n * @returns {array} An array\n * [urls, addUrl, resetUrls]\n * where urls is the array of URL objects,\n * addUrl is a function for adding a URL to the array,\n * resetUrls is a function that clears the array.\n */\nexport function useUrls() {\n  const [urls, setUrls] = useState([]);\n\n  const addUrl = useCallback((url, name) => {\n    if (url) {\n      setUrls(prev => ([...prev, { url, name }]));\n    }\n  }, [setUrls]);\n\n  const resetUrls = useCallback(() => {\n    setUrls([]);\n  }, [setUrls]);\n\n  return [urls, addUrl, resetUrls];\n}\n\n/**\n * Custom hook, subscribes to the width and height of the closest .vitessce-container\n * element and updates upon window resize events.\n * @param {Ref} ref A React ref object within the `.vitessce-container`.\n * @returns {array} `[width, height]` where width and height\n * are numbers.\n */\nexport function useClosestVitessceContainerSize(ref) {\n  const [height, setHeight] = useState();\n  const [width, setWidth] = useState();\n\n  useEffect(() => {\n    function onWindowResize() {\n      if (ref.current) {\n        const {\n          clientHeight: componentHeight, clientWidth: componentWidth,\n        } = ref.current.closest('.vitessce-container');\n        setWidth(componentWidth);\n        setHeight(componentHeight);\n      }\n    }\n    const onResizeDebounced = debounce(onWindowResize, 100, { trailing: true });\n    window.addEventListener('resize', onResizeDebounced);\n    onWindowResize();\n    return () => {\n      window.removeEventListener('resize', onResizeDebounced);\n    };\n  }, [ref]);\n\n  return [width, height];\n}\n\nexport function useExpressionValueGetter({ attrs, expressionData }) {\n  // Get a mapping from cell ID to row index in the gene expression matrix.\n  const cellIdMap = useMemo(() => {\n    const result = {};\n    if (attrs && attrs.rows) {\n      // eslint-disable-next-line no-plusplus\n      for (let i = 0; i < attrs.rows.length; i++) {\n        result[attrs.rows[i]] = i;\n      }\n    }\n    return result;\n  }, [attrs]);\n\n  // Set up a getter function for gene expression values, to be used\n  // by the DeckGL layer to obtain values for instanced attributes.\n  const getExpressionValue = useCallback((entry) => {\n    const cellId = entry[0];\n    if (cellIdMap && expressionData && expressionData[0]) {\n      const cellIndex = cellIdMap[cellId];\n      const val = expressionData[0][cellIndex];\n      return val;\n    }\n    return 0;\n  }, [cellIdMap, expressionData]);\n  return getExpressionValue;\n}\n", "import { useRef, useCallback, useMemo } from 'react';\nimport create from 'zustand';\nimport createContext from 'zustand/context';\nimport shallow from 'zustand/shallow';\nimport { fromEntries, capitalize } from '../../utils';\n\n// Reference: https://github.com/pmndrs/zustand#react-context\n// Reference: https://github.com/pmndrs/zustand/blob/e47ea03/tests/context.test.tsx#L60\nconst {\n  Provider: ViewConfigProviderLocal,\n  useStore: useViewConfigStoreLocal,\n  useStoreApi: useViewConfigStoreApiLocal,\n} = createContext();\n\nexport const ViewConfigProvider = ViewConfigProviderLocal;\nexport const useViewConfigStore = useViewConfigStoreLocal;\nexport const useViewConfigStoreApi = useViewConfigStoreApiLocal;\n\nconst {\n  Provider: AuxiliaryProviderLocal,\n  useStore: useAuxiliaryStoreLocal,\n} = createContext();\n\nexport const AuxiliaryProvider = AuxiliaryProviderLocal;\nexport const useAuxiliaryStore = useAuxiliaryStoreLocal;\n\n\n/**\n * The useViewConfigStore hook is initialized via the zustand\n * create() function, which sets up both the state variables\n * and the reducer-type functions.\n * Reference: https://github.com/react-spring/zustand\n * @returns {function} The useStore hook.\n */\nexport const createViewConfigStore = () => create(set => ({\n  // State:\n  // The viewConfig is an object which must conform to the schema\n  // found in src/schemas/config.schema.json.\n  viewConfig: null,\n  // The loaders object is a mapping from dataset ID to\n  // data type to loader object instance.\n  loaders: null,\n  // Reducer functions which update the state\n  // (although technically also part of state):\n  setViewConfig: viewConfig => set({ viewConfig }),\n  setLoaders: loaders => set({ loaders }),\n  setCoordinationValue: ({ parameter, scope, value }) => set(state => ({\n    viewConfig: {\n      ...state.viewConfig,\n      coordinationSpace: {\n        ...state.viewConfig.coordinationSpace,\n        [parameter]: {\n          ...state.viewConfig.coordinationSpace[parameter],\n          [scope]: value,\n        },\n      },\n    },\n  })),\n  removeComponent: i => set((state) => {\n    const newLayout = state.viewConfig.layout.slice();\n    newLayout.splice(i, 1);\n    return {\n      viewConfig: {\n        ...state.viewConfig,\n        layout: newLayout,\n      },\n    };\n  }),\n  changeLayout: newComponentProps => set((state) => {\n    const newLayout = state.viewConfig.layout.slice();\n    newComponentProps.forEach(([i, newProps]) => {\n      newLayout[i] = {\n        ...newLayout[i],\n        ...newProps,\n      };\n    });\n    return {\n      viewConfig: {\n        ...state.viewConfig,\n        layout: newLayout,\n      },\n    };\n  }),\n}));\n\n/**\n * Hook for getting components' layout from the view config based on\n * matching all coordination scopes.\n * @returns {Object} The components' layout.\n */\nexport const useComponentLayout = (component, scopes, coordinationScopes) => useViewConfigStore(\n  state => state.viewConfig.layout.filter(l => l.component === component).filter(\n    l => scopes.every(scope => l.coordinationScopes[scope]\n          === coordinationScopes[scope]),\n  ),\n);\n\n/**\n * The useAuxiliaryStore hook is initialized via the zustand\n * create() function, which sets up both the state variables\n * and the reducer-type functions.\n * Reference: https://github.com/react-spring/zustand\n * It is meant to be used for non-viewconfig-based coordination between components.\n * For example, as currently happens, the layer controller can coordinate\n * on-load callbacks with spatial view based on whether or not they are\n * coordinated via `spatialRasterLayers` - the callbacks are not part of the view config\n * though so they live here.\n * @returns {function} The useStore hook.\n */\nexport const createAuxiliaryStore = () => create(set => ({\n  auxiliaryStore: null,\n  setCoordinationValue: ({ parameter, scope, value }) => set(state => ({\n    auxiliaryStore: {\n      ...state.auxiliaryStore,\n      [parameter]: {\n        [scope]: value,\n      },\n    },\n  })),\n}));\n\n/**\n * The hover store can be used to store global state\n * related to which component is currently hovered,\n * which is required for tooltip / crossover elements.\n * @returns {function} The useStore hook.\n */\nconst useHoverStore = create(set => ({\n  // Components may need to know if they are the \"hover source\"\n  // for tooltip interactions. This value should be a unique\n  // component ID, such as its index in the view config layout.\n  componentHover: null,\n  setComponentHover: componentHover => set({ componentHover }),\n}));\n\n/**\n * The warning store can be used to store global state\n * related to app warning messages.\n * @returns {function} The useStore hook.\n */\nconst useWarnStore = create(set => ({\n  // Want a global state to collect warning messages\n  // that occur anywhere in the app.\n  warning: null,\n  setWarning: warning => set({ warning }),\n}));\n\n/**\n * The view info store can be used to store component-level\n * viewInfo objects,\n * which are required for tooltip / crossover elements.\n * @returns {function} The useStore hook.\n */\nconst useViewInfoStore = create(set => ({\n  // The viewInfo object is a mapping from\n  // component IDs to component view info objects.\n  // Each view info object must have a project() function.\n  viewInfo: {},\n  setComponentViewInfo: (uuid, viewInfo) => set(state => ({\n    viewInfo: {\n      ...state.viewInfo,\n      [uuid]: viewInfo,\n    },\n  })),\n}));\n\n/**\n * The grid size store can be used to store a\n * counter which updates on each window or react-grid-layout\n * resize event.\n * @returns {function} The useStore hook.\n */\nconst useGridSizeStore = create(set => ({\n  resizeCount: {},\n  incrementResizeCount: () => set(state => ({\n    resizeCount: state.resizeCount + 1,\n  })),\n}));\n\n/**\n * The useCoordination hook returns both the\n * values and setter functions for the coordination objects\n * in a particular coordination scope mapping.\n * This hook is intended to be used within the ___Subscriber\n * components to allow them to \"hook into\" only those coordination\n * objects and setter functions of relevance.\n * @param {string[]} parameters Array of coordination types.\n * @param {object} coordinationScopes Mapping of coordination types\n * to scope names.\n * @returns {array} Returns a tuple [values, setters]\n * where values is an object containing all coordination values,\n * and setters is an object containing all coordination setter\n * functions for the values in `values`, named with a \"set\"\n * prefix.\n */\nexport function useCoordination(parameters, coordinationScopes) {\n  const setCoordinationValue = useViewConfigStore(state => state.setCoordinationValue);\n\n  const values = useViewConfigStore((state) => {\n    const { coordinationSpace } = state.viewConfig;\n    return fromEntries(parameters.map((parameter) => {\n      if (coordinationSpace && coordinationSpace[parameter]) {\n        const value = coordinationSpace[parameter][coordinationScopes[parameter]];\n        return [parameter, value];\n      }\n      return [parameter, undefined];\n    }));\n  }, shallow);\n\n  const setters = useMemo(() => fromEntries(parameters.map((parameter) => {\n    const setterName = `set${capitalize(parameter)}`;\n    const setterFunc = value => setCoordinationValue({\n      parameter,\n      scope: coordinationScopes[parameter],\n      value,\n    });\n    return [setterName, setterFunc];\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  })), [parameters, coordinationScopes]);\n\n  return [values, setters];\n}\n\nconst AUXILIARY_COORDINATION_TYPES_MAP = {\n  spatialRasterLayers: ['rasterLayersCallbacks', 'areLoadingRasterChannnels'],\n};\n\n/**\n * The maps the coordination types of incoming scopes to new types\n * for the auxiliary store.\n * @param {object} coordinationScopes Mapping of coordination types\n * to scope names.\n * @returns {object} Mapping of coordination types\n * to new scope names for the auxiliary store.\n */\nconst mapCoordinationScopes = (coordinationScopes) => {\n  const newCoordinationScopes = {};\n  Object.keys(coordinationScopes).forEach((key) => {\n    const newCoordinationTypes = AUXILIARY_COORDINATION_TYPES_MAP[key] || [];\n    newCoordinationTypes.forEach((coordinationType) => {\n      newCoordinationScopes[coordinationType || key] = coordinationScopes[key];\n    });\n  });\n  return newCoordinationScopes;\n};\n\nconst mapParameters = parameters => parameters\n  .map(parameter => AUXILIARY_COORDINATION_TYPES_MAP[parameter]).filter(Boolean).flat();\n\n/**\n * The useAuxiliaryCoordination hook returns both the\n * values and setter functions for the auxiliary coordination objects\n * in a particular coordination scope mapping.\n * This hook is intended to be used within the ___Subscriber\n * components to allow them to \"hook into\" only those auxiliary coordination\n * objects and setter functions of relevance, for example \"on load\" callbacks.\n * @param {string[]} parameters Array of coordination types.\n * @param {object} coordinationScopes Mapping of coordination types\n * to scope names.\n * @returns {array} Returns a tuple [values, setters]\n * where values is an object containing all coordination values,\n * and setters is an object containing all coordination setter\n * functions for the values in `values`, named with a \"set\"\n * prefix.\n */\nexport function useAuxiliaryCoordination(parameters, coordinationScopes) {\n  const setCoordinationValue = useAuxiliaryStore(state => state.setCoordinationValue);\n  const mappedCoordinationScopes = mapCoordinationScopes(coordinationScopes);\n  const mappedParameters = mapParameters(parameters);\n  const values = useAuxiliaryStore((state) => {\n    const { auxiliaryStore } = state;\n    return fromEntries(mappedParameters.map((parameter) => {\n      if (auxiliaryStore && auxiliaryStore[parameter]) {\n        const value = auxiliaryStore[parameter][mappedCoordinationScopes[parameter]];\n        return [parameter, value];\n      }\n      return [parameter, undefined];\n    }));\n  }, shallow);\n  const setters = useMemo(() => fromEntries(mappedParameters.map((parameter) => {\n    const setterName = `set${capitalize(parameter)}`;\n    const setterFunc = value => setCoordinationValue({\n      parameter,\n      scope: mappedCoordinationScopes[parameter],\n      value,\n    });\n    return [setterName, setterFunc];\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  })), [parameters, coordinationScopes]);\n\n  return [values, setters];\n}\n\n/**\n * Obtain the loaders object from\n * the global app state.\n * @returns {object} The loaders object\n * in the `useViewConfigStore` store.\n */\nexport function useLoaders() {\n  return useViewConfigStore(state => state.loaders);\n}\n\n/**\n * Obtain the view config layout array from\n * the global app state.\n * @returns {object[]} The layout array\n * in the `useViewConfigStore` store.\n */\nexport function useLayout() {\n  return useViewConfigStore(state => state.viewConfig?.layout);\n}\n\n/**\n * Obtain the component removal function from\n * the global app state.\n * @returns {function} The remove component function\n * in the `useViewInfoStore` store.\n */\nexport function useRemoveComponent() {\n  return useViewConfigStore(state => state.removeComponent);\n}\n\n/**\n * Obtain the component prop setter function from\n * the global app state.\n * @returns {function} The set component props function\n * in the `useViewInfoStore` store.\n */\nexport function useChangeLayout() {\n  return useViewConfigStore(state => state.changeLayout);\n}\n\n/**\n * Obtain the loaders setter function from\n * the global app state.\n * @returns {function} The loaders setter function\n * in the `useViewConfigStore` store.\n */\nexport function useSetLoaders() {\n  return useViewConfigStore(state => state.setLoaders);\n}\n\n/**\n * Obtain the view config setter function from\n * the global app state.\n * @returns {function} The view config setter function\n * in the `useViewConfigStore` store.\n */\nexport function useSetViewConfig(viewConfigStoreApi) {\n  const setViewConfigRef = useRef(viewConfigStoreApi.getState().setViewConfig);\n  const setViewConfig = setViewConfigRef.current;\n  return setViewConfig;\n}\n\n/**\n * Obtain the component hover value from\n * the global app state.\n * @returns {number} The hovered component ID\n * in the `useHoverStore` store.\n */\nexport function useComponentHover() {\n  return useHoverStore(state => state.componentHover);\n}\n\n/**\n * Obtain the component hover setter function from\n * the global app state.\n * @returns {function} The component hover setter function\n * in the `useHoverStore` store.\n */\nexport function useSetComponentHover() {\n  return useHoverStore(state => state.setComponentHover);\n}\n\n/**\n * Obtain the warning message from\n * the global app state.\n * @returns {string} The warning message\n * in the `useWarnStore` store.\n */\nexport function useWarning() {\n  return useWarnStore(state => state.warning);\n}\n\n/**\n * Obtain the warning setter function from\n * the global app state.\n * @returns {function} The warning setter function\n * in the `useWarnStore` store.\n */\nexport function useSetWarning() {\n  return useWarnStore(state => state.setWarning);\n}\n\n/**\n * Obtain the component view info value from\n * the global app state.\n * @returns {object} The view info object for the component\n * in the `useViewInfoStore` store.\n */\nexport function useComponentViewInfo(uuid) {\n  return useViewInfoStore(useCallback(state => state.viewInfo[uuid], [uuid]));\n}\n\n/**\n * Obtain the component view info setter function from\n * the global app state.\n * @returns {function} The component view info setter function\n * in the `useViewInfoStore` store.\n */\nexport function useSetComponentViewInfo(uuid) {\n  const setViewInfoRef = useRef(useViewInfoStore.getState().setComponentViewInfo);\n  const setComponentViewInfo = viewInfo => setViewInfoRef.current(uuid, viewInfo);\n  return setComponentViewInfo;\n}\n\n/**\n * Obtain the grid resize count value\n * from the global app state.\n * @returns {number} The grid resize increment value.\n */\nexport function useGridResize() {\n  return useGridSizeStore(state => state.resizeCount);\n}\n\n/**\n * Obtain the grid resize count increment function\n * from the global app state.\n * @returns {function} The grid resize count increment\n * function.\n */\nexport function useEmitGridResize() {\n  return useGridSizeStore(state => state.incrementResizeCount);\n}\n", "/* eslint-disable no-plusplus */\n\n// Adapted from https://github.com/feross/fromentries/blob/29b52a850bb3a47c390937631c2638edf3443942/index.js\nexport function fromEntries(iterable) {\n  return [...iterable]\n    .reduce((obj, { 0: key, 1: val }) => Object.assign(obj, { [key]: val }), {});\n}\n\nexport function range(length) {\n  return [...Array(length).keys()];\n}\n\n/**\n * Select between a singular and plural version of a word,\n * based on an item count.\n * @param {string} singular The singular version of the word.\n * @param {string} plural The plural version of the word.\n * @param {number} count The number of items.\n * @returns {string} Singular if count is one, else plural.\n */\nexport function pluralize(singular, plural, count) {\n  return (count === 1 ? singular : plural);\n}\n\n/**\n * Capitalize a the first letter of a string.\n * @param {string} word A string to capitalize.\n * @returns {string} The word parameter with the first letter capitalized.\n */\nexport function capitalize(word) {\n  return word.charAt(0).toUpperCase() + word.slice(1);\n}\n\n/**\n * Generate a new scope name which does not\n * conflict / overlap with a previous scope name.\n * Really these just need to be unique within the coordination object.\n * So in theory they could be String(Math.random()) or uuidv4() or something.\n * However it may be good to make them more human-readable and memorable\n * since eventually we will want to expose a UI to update the coordination.\n * @param {string[]} prevScopes Previous scope names.\n * @returns {string} The new scope name.\n */\nexport function getNextScope(prevScopes) {\n  // Keep an ordered list of valid characters.\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n  // Store the value of the next character for each position\n  // in the new string.\n  // For example, [0] -> \"A\", [1] -> \"B\", [0, 1] -> \"AB\"\n  const nextCharIndices = [0];\n\n  // Generate a new scope name,\n  // potentially conflicting with an existing name.\n  // Reference: https://stackoverflow.com/a/12504061\n  function next() {\n    const r = [];\n    nextCharIndices.forEach((charIndex) => {\n      r.unshift(chars[charIndex]);\n    });\n    let increment = true;\n    for (let i = 0; i < nextCharIndices.length; i++) {\n      const val = ++nextCharIndices[i];\n      if (val >= chars.length) {\n        nextCharIndices[i] = 0;\n      } else {\n        increment = false;\n        break;\n      }\n    }\n    if (increment) {\n      nextCharIndices.push(0);\n    }\n    return r.join('');\n  }\n\n  let nextScope;\n  do {\n    nextScope = next();\n  } while (prevScopes.includes(nextScope));\n  return nextScope;\n}\n\n/**\n * Get a representative PixelSource from a loader object returned from\n * the Vitessce imaging loaders\n * @param {object} loader { data: (PixelSource[]|PixelSource), metadata, channels } object\n * @param {number=} level Level of the multiscale loader from which to get a PixelSource\n * @returns {object} PixelSource object\n */\nexport function getSourceFromLoader(loader, level) {\n  const { data } = loader;\n  const source = Array.isArray(data) ? data[(level || data.length - 1)] : data;\n  return source;\n}\n\n/*\n * Helper method to determine whether pixel data is interleaved and rgb or not.\n * @param {object} loader\n */\nexport function isRgb(loader) {\n  const source = getSourceFromLoader(loader);\n  const { shape, dtype, labels } = source;\n  const channelSize = shape[labels.indexOf('c')];\n  return (channelSize === 3) && dtype === 'Uint8';\n}\n", "import { makeStyles, createMuiTheme } from '@material-ui/core/styles';\nimport { grey } from '@material-ui/core/colors';\n\nexport const styles = makeStyles(() => ({\n  paper: {\n    maxHeight: 200,\n    overflow: 'auto',\n  },\n  container: {\n    position: 'relative',\n    left: 0,\n    top: 0,\n  },\n  span: {\n    width: '70px',\n    textAlign: 'center',\n    paddingLeft: '2px',\n    paddingRight: '2px',\n  },\n}));\n\nexport const muiTheme = {\n  dark: createMuiTheme({\n    palette: {\n      type: 'dark',\n      primary: grey,\n      secondary: grey,\n      primaryBackground: '#222222',\n      primaryBackgroundHighlight: '#000000',\n      primaryBackgroundInput: '#D3D3D3',\n      primaryBackgroundDim: '#333333',\n      primaryBackgroundLight: '#757575',\n      primaryForeground: '#D3D3D3',\n      primaryForegroundDim: '#000000',\n      primaryForegroundActive: '#9bb7d6',\n      secondaryBackground: '#000000',\n      secondaryBackgroundDim: '#444444',\n      secondaryForeground: '#D3D3D3',\n    },\n    props: {\n      MuiButtonBase: {\n        disableRipple: true,\n      },\n    },\n  }),\n  light: createMuiTheme({\n    palette: {\n      type: 'light',\n      primary: grey,\n      secondary: grey,\n      primaryBackground: '#F1F1F1',\n      primaryBackgroundHighlight: '#FFFFFF',\n      primaryBackgroundInput: '#FFFFFF',\n      primaryBackgroundDim: '#8A8A8A',\n      primaryBackgroundLight: '#e0e0e0',\n      primaryForeground: '#333333',\n      primaryForegroundDim: '#808080',\n      primaryForegroundActive: '#0074D9',\n      secondaryBackground: '#F1F1F1',\n      secondaryBackgroundDim: '#C0C0C0',\n      secondaryForeground: '#222222',\n    },\n    props: {\n      MuiButtonBase: {\n        disableRipple: true,\n      },\n    },\n  }),\n};\n", "import React from 'react';\nimport { COORDINATE_SYSTEM } from '@deck.gl/core'; // eslint-disable-line import/no-extraneous-dependencies\nimport {\n  SETS_DATATYPE_CELL,\n  HIERARCHICAL_SCHEMAS,\n} from './sets/constants';\nimport { PRIMARY_CARD } from './classNames';\n\nexport function makeCellStatusMessage(cellInfoFactors) {\n  return Object.entries(cellInfoFactors).map(\n    ([factor, value]) => `${factor}: ${value}`,\n  ).join('; ');\n}\n\nexport function cellLayerDefaultProps(cells, updateStatus, setCellHighlight, setComponentHover) {\n  return {\n    coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n    data: cells,\n    pickable: true,\n    autoHighlight: true,\n    stroked: true,\n    filled: true,\n    getElevation: 0,\n    onHover: (info) => {\n      // Notify the parent component that its child component is\n      // the \"hover source\".\n      if (setComponentHover) {\n        setComponentHover();\n      }\n      if (info.object) {\n        const [cellId, cellInfo] = info.object;\n        const { factors = {} } = cellInfo;\n        if (updateStatus) {\n          updateStatus(makeCellStatusMessage(factors));\n        }\n        if (setCellHighlight) {\n          setCellHighlight(cellId);\n        }\n      } else if (setCellHighlight) {\n        // Clear the currently-hovered cell info by passing null.\n        setCellHighlight('');\n      }\n    },\n  };\n}\n\nexport const DEFAULT_DARK_COLOR = [50, 50, 50];\nexport const DEFAULT_LIGHT_COLOR = [200, 200, 200];\n\nexport function getDefaultColor(theme) {\n  return theme === 'dark' ? DEFAULT_DARK_COLOR : DEFAULT_LIGHT_COLOR;\n}\n\n// From https://personal.sron.nl/~pault/#sec:qualitative\nexport const PALETTE = [\n  [68, 119, 170],\n  [136, 204, 238],\n  [68, 170, 153],\n  [17, 119, 51],\n  [153, 153, 51],\n  [221, 204, 119],\n  [204, 102, 119],\n  [136, 34, 85],\n  [170, 68, 153],\n];\n\nexport const VIEWER_PALETTE = [\n  [0, 0, 255],\n  [0, 255, 0],\n  [255, 0, 255],\n  [255, 255, 0],\n  [0, 255, 255],\n  [255, 255, 255],\n  [255, 128, 0],\n  [255, 0, 0],\n];\n\nexport const COLORMAP_OPTIONS = [\n  'viridis',\n  'greys',\n  'magma',\n  'jet',\n  'hot',\n  'bone',\n  'copper',\n  'summer',\n  'density',\n  'inferno',\n];\n\nexport const DEFAULT_GL_OPTIONS = { webgl2: true };\n\nexport function createDefaultUpdateStatus(componentName) {\n  return message => console.warn(`${componentName} updateStatus: ${message}`);\n}\n\nexport function createDefaultUpdateCellsSelection(componentName) {\n  return cellsSelection => console.warn(`${componentName} updateCellsSelection: ${cellsSelection}`);\n}\n\nexport function createDefaultUpdateCellsHover(componentName) {\n  return hoverInfo => console.warn(`${componentName} updateCellsHover: ${hoverInfo.cellId}`);\n}\n\nexport function createDefaultUpdateGenesHover(componentName) {\n  return hoverInfo => console.warn(`${componentName} updateGenesHover: ${hoverInfo.geneId}`);\n}\n\nexport function createDefaultUpdateViewInfo(componentName) {\n  return viewInfo => console.warn(`${componentName} updateViewInfo: ${viewInfo}`);\n}\n\nexport function createDefaultClearPleaseWait() {\n  return () => {};\n}\n\n\n/**\n * Copy a typed array into a new array buffer.\n * @param {Uint8Array} arr The typed array to be copied.\n * @returns {Uint8Array} The copied array.\n */\nexport function copyUint8Array(arr) {\n  const newBuffer = new ArrayBuffer(arr.buffer.byteLength);\n  const newArr = new Uint8Array(newBuffer);\n  newArr.set(arr);\n  return newArr;\n}\n\nexport function getNextNumberedNodeName(nodes, prefix) {\n  let i = 1;\n  if (nodes) {\n    // eslint-disable-next-line no-loop-func\n    while (nodes.find(n => n.name === `${prefix}${i}`)) {\n      // eslint-disable-next-line no-plusplus\n      i++;\n    }\n  }\n  return `${prefix}${i}`;\n}\n\n/**\n * Create a new selected cell set based on a cell selection.\n * @param {string[]} cellSelection An array of cell IDs.\n * @param {object[]} additionalCellSets The previous array of user-defined cell sets.\n * @param {function} setCellSetSelection The setter function for cell set selections.\n * @param {function} setAdditionalCellSets The setter function for user-defined cell sets.\n */\nexport function setCellSelection(cellSelection, additionalCellSets, cellSetColor, setCellSetSelection, setAdditionalCellSets, setCellSetColor, setCellColorEncoding, prefix = 'Selection ') {\n  const CELL_SELECTIONS_LEVEL_ZERO_NAME = 'My Selections';\n\n  const selectionsLevelZeroNode = additionalCellSets?.tree.find(\n    n => n.name === CELL_SELECTIONS_LEVEL_ZERO_NAME,\n  );\n  const nextAdditionalCellSets = {\n    version: HIERARCHICAL_SCHEMAS[SETS_DATATYPE_CELL].latestVersion,\n    datatype: SETS_DATATYPE_CELL,\n    tree: [...(additionalCellSets ? additionalCellSets.tree : [])],\n  };\n\n  const nextName = getNextNumberedNodeName(selectionsLevelZeroNode?.children, prefix);\n  let colorIndex = 0;\n  if (selectionsLevelZeroNode) {\n    colorIndex = selectionsLevelZeroNode.children.length;\n    selectionsLevelZeroNode.children.push({\n      name: nextName,\n      set: cellSelection.map(d => [d, null]),\n    });\n  } else {\n    nextAdditionalCellSets.tree.push({\n      name: CELL_SELECTIONS_LEVEL_ZERO_NAME,\n      children: [\n        {\n          name: nextName,\n          set: cellSelection.map(d => [d, null]),\n        },\n      ],\n    });\n  }\n  setAdditionalCellSets(nextAdditionalCellSets);\n  const nextPath = ['My Selections', nextName];\n  setCellSetColor([\n    ...(cellSetColor || []),\n    {\n      path: nextPath,\n      color: PALETTE[colorIndex % PALETTE.length],\n    },\n  ]);\n  setCellSetSelection([nextPath]);\n  setCellColorEncoding('cellSetSelection');\n}\n\nexport function mergeCellSets(cellSets, additionalCellSets) {\n  return {\n    version: HIERARCHICAL_SCHEMAS[SETS_DATATYPE_CELL].latestVersion,\n    datatype: SETS_DATATYPE_CELL,\n    tree: [\n      ...(cellSets ? cellSets.tree : []),\n      ...(additionalCellSets ? additionalCellSets.tree : []),\n    ],\n  };\n}\n\nexport function createWarningComponent(props) {\n  return () => {\n    const {\n      title,\n      message,\n    } = props;\n    return (\n      <div className={PRIMARY_CARD}>\n        <h1>{title}</h1>\n        <div>{message}</div>\n      </div>\n    );\n  };\n}\n\nexport function asEsModule(component) {\n  return {\n    __esModule: true,\n    default: component,\n  };\n}\n\n\nexport function formatBytes(bytes, decimals = 2) {\n  if (bytes === 0) return '0 Bytes';\n\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  // eslint-disable-next-line no-restricted-properties\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;\n}\n\nexport const getStatsForResolution = (loader, resolution) => {\n  const { shape, labels } = loader[resolution];\n  const height = shape[labels.indexOf('y')];\n  const width = shape[labels.indexOf('x')];\n  const depth = shape[labels.indexOf('z')];\n  // eslint-disable-next-line no-bitwise\n  const depthDownsampled = Math.max(1, depth >> resolution);\n  // Check memory allocation limits for Float32Array (used in XR3DLayer for rendering)\n  const totalBytes = 4 * height * width * depthDownsampled;\n  return {\n    height, width, depthDownsampled, totalBytes,\n  };\n};\n\nexport const canLoadResolution = (loader, resolution) => {\n  const {\n    totalBytes, height, width, depthDownsampled,\n  } = getStatsForResolution(\n    loader,\n    resolution,\n  );\n  const maxHeapSize = window.performance?.memory\n    && window.performance?.memory?.jsHeapSizeLimit / 2;\n  const maxSize = maxHeapSize || (2 ** 31) - 1;\n  // 2048 is a normal texture size limit although some browsers go larger.\n  return (\n    totalBytes < maxSize\n    && height <= 2048\n    && depthDownsampled <= 2048\n    && width <= 2048\n    && depthDownsampled > 1\n  );\n};\n", "import cellSetsSchema from '../../schemas/cell-sets.schema.json';\nimport cellSetsTabularSchema from '../../schemas/cell-sets-tabular.schema.json';\n\nexport const FILE_EXTENSION_JSON = 'json';\nexport const MIME_TYPE_JSON = 'application/json';\n\nexport const FILE_EXTENSION_TABULAR = 'csv';\nexport const MIME_TYPE_TABULAR = 'text/csv';\nexport const SEPARATOR_TABULAR = ',';\n// The NA value below corresponds to the allowed string enum\n// value \"NA\" in the cell-sets-tabular JSON schema.\nexport const NA_VALUE_TABULAR = 'NA';\n\nexport const SETS_DATATYPE_CELL = 'cell';\nexport const HIERARCHICAL_SCHEMAS = {\n  cell: {\n    latestVersion: '0.1.3',\n    schema: cellSetsSchema,\n  },\n};\n\nexport const TABULAR_SCHEMAS = {\n  cell: {\n    schema: cellSetsTabularSchema,\n  },\n};\n", "import { useState, useEffect } from 'react';\nimport equal from 'fast-deep-equal';\nimport { capitalize } from '../utils';\nimport { useSetWarning } from '../app/state/hooks';\nimport {\n  AbstractLoaderError,\n  LoaderNotFoundError,\n} from '../loaders/errors/index';\nimport {\n  DEFAULT_MOLECULES_LAYER,\n  DEFAULT_CELLS_LAYER,\n  DEFAULT_NEIGHBORHOODS_LAYER,\n} from './spatial/constants';\nimport { DEFAULT_COORDINATION_VALUES } from '../app/state/coordination';\n\n/**\n * Warn via publishing to the console\n * and to the global warning store.\n * @param {AbstractLoaderError} error An error instance.\n */\nfunction warn(error, setWarning) {\n  setWarning(error.message);\n  console.warn(error.message);\n  if (error instanceof AbstractLoaderError) {\n    error.warnInConsole();\n  }\n}\n\n/**\n * Initialize values in the coordination space.\n * @param {object} values Object where\n * keys are coordination type names,\n * values are initial coordination values.\n * @param {object} setters Object where\n * keys are coordination type names with the prefix 'set',\n * values are coordination setter functions.\n * @param {object} initialValues Object where\n * keys are coordination type names and keys are values.\n */\nfunction initCoordinationSpace(values, setters, initialValues) {\n  if (!values || !setters) {\n    return;\n  }\n  Object.entries(values).forEach(([coordinationType, value]) => {\n    const setterName = `set${capitalize(coordinationType)}`;\n    const setterFunc = setters[setterName];\n    const initialValue = initialValues && initialValues[coordinationType];\n    const shouldInit = equal(initialValue, DEFAULT_COORDINATION_VALUES[coordinationType]);\n    if (shouldInit && setterFunc) {\n      setterFunc(value);\n    }\n  });\n}\n\n/**\n * Get the dataset description string.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @returns {array} [description] where\n * description is a string.\n */\nexport function useDescription(loaders, dataset) {\n  const [description, setDescription] = useState();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n\n    if (loaders[dataset].description) {\n      setDescription(loaders[dataset].description);\n    } else {\n      setDescription(null);\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return [description];\n}\n\n/**\n * Get data from a cells data type loader,\n * updating \"ready\" and URL state appropriately.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {function} addUrl A function to call to update\n * the URL list.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @param {object} coordinationSetters Object where\n * keys are coordination type names with the prefix 'set',\n * values are coordination setter functions.\n * @param {object} initialCoordinationValues Object where\n * keys are coordination type names with the prefix 'initialize',\n * values are initialization preferences as boolean values.\n * @returns {array} [cells, cellsCount] where\n * cells is an object and cellsCount is the\n * number of items in the cells object.\n */\nexport function useCellsData(\n  loaders, dataset, setItemIsReady, addUrl, isRequired,\n  coordinationSetters, initialCoordinationValues,\n) {\n  const [cells, setCells] = useState({});\n  const [cellsCount, setCellsCount] = useState(0);\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n\n    if (loaders[dataset].loaders.cells) {\n      loaders[dataset].loaders.cells.load().catch(e => warn(e, setWarning)).then((payload) => {\n        if (!payload) return;\n        const { data, url, coordinationValues } = payload;\n        setCells(data);\n        setCellsCount(Object.keys(data).length);\n        addUrl(url, 'Cells');\n        // This dataset has cells, so set up the\n        // spatial cells layer coordination value\n        // using the cell layer singleton.\n        const coordinationValuesOrDefault = {\n          spatialCellsLayer: DEFAULT_CELLS_LAYER,\n          ...coordinationValues,\n        };\n        initCoordinationSpace(\n          coordinationValuesOrDefault,\n          coordinationSetters, initialCoordinationValues,\n        );\n        setItemIsReady('cells');\n      });\n    } else {\n      setCells({});\n      setCellsCount(0);\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'cells', null, null), setWarning);\n      } else {\n        setItemIsReady('cells');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return [cells, cellsCount];\n}\n\n/**\n * Get data from a cell sets data type loader,\n * updating \"ready\" and URL state appropriately.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {function} addUrl A function to call to update\n * the URL list.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @param {object} coordinationSetters Object where\n * keys are coordination type names with the prefix 'set',\n * values are coordination setter functions.\n * @param {object} initialCoordinationValues Object where\n * keys are coordination type names and values are the current values.\n * @returns {array} [cellSets] where\n * cellSets is a sets tree object.\n */\nexport function useCellSetsData(\n  loaders, dataset, setItemIsReady, addUrl, isRequired,\n  coordinationSetters, initialCoordinationValues,\n) {\n  const [cellSets, setCellSets] = useState();\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n\n    if (loaders[dataset].loaders['cell-sets']) {\n      // Load the data initially.\n      loaders[dataset].loaders['cell-sets'].load().catch(e => warn(e, setWarning)).then((payload) => {\n        if (!payload) return;\n        const { data, url, coordinationValues } = payload;\n        setCellSets(data);\n        addUrl(url, 'Cell Sets');\n        initCoordinationSpace(\n          coordinationValues,\n          coordinationSetters,\n          initialCoordinationValues,\n        );\n        setItemIsReady('cell-sets');\n      });\n    } else {\n      setCellSets(null);\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'cell-sets', null, null), setWarning);\n      } else {\n        setItemIsReady('cell-sets');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return [cellSets];\n}\n\n/**\n * Get (potentially filtered) data from an expression matrix data type loader,\n * updating \"ready\" and URL state appropriately.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.  Should not be used in conjunction (called in the same component)\n * with useExpressionAttrs as this returns a potentially filtered set of attributes\n * specifically for the returned expression data.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {function} addUrl A function to call to update\n * the URL list.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @param {object} coordinationSetters Object where\n * keys are coordination type names with the prefix 'set',\n * values are coordination setter functions.\n * @param {object} initialCoordinationValues Object where\n * keys are coordination type names with the prefix 'initialize',\n * values are initialization preferences as boolean values.\n * @returns {array} [expressionMatrix] where\n * expressionMatrix is an object with\n * shape { cols, rows, matrix }.\n */\nexport function useExpressionMatrixData(\n  loaders, dataset, setItemIsReady, addUrl, isRequired,\n  coordinationSetters, initialCoordinationValues,\n) {\n  const [expressionMatrix, setExpressionMatrix] = useState();\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n\n    if (loaders[dataset].loaders['expression-matrix']) {\n      loaders[dataset].loaders['expression-matrix'].load().catch(e => warn(e, setWarning)).then((payload) => {\n        if (!payload) return;\n        const { data, url, coordinationValues } = payload;\n        const [attrs, arr] = data;\n        setExpressionMatrix({\n          cols: attrs.cols,\n          rows: attrs.rows,\n          matrix: arr.data,\n        });\n        addUrl(url, 'Expression Matrix');\n        initCoordinationSpace(\n          coordinationValues,\n          coordinationSetters,\n          initialCoordinationValues,\n        );\n        setItemIsReady('expression-matrix');\n      });\n    } else {\n      setExpressionMatrix(null);\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'expression-matrix', null, null), setWarning);\n      } else {\n        setItemIsReady('expression-matrix');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return [expressionMatrix];\n}\n\n/**\n * Get data from the expression matrix data type loader for a given gene selection.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @param {boolean} selection A list of gene names to get expression data for.\n * @returns {array} [geneData] where geneData is an array [Uint8Array, ..., Uint8Array]\n * for however many genes are in the selection.\n */\nexport function useGeneSelection(\n  loaders,\n  dataset,\n  setItemIsReady,\n  isRequired,\n  selection,\n  setItemIsNotReady,\n) {\n  const [geneData, setGeneData] = useState();\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n    if (!selection) {\n      setItemIsReady('expression-matrix');\n      return;\n    }\n    const loader = loaders[dataset].loaders['expression-matrix'];\n    if (loader) {\n      setItemIsNotReady('expression-matrix');\n      const implementsGeneSelection = typeof loader.loadGeneSelection === 'function';\n      if (implementsGeneSelection) {\n        loaders[dataset].loaders['expression-matrix']\n          .loadGeneSelection({ selection })\n          .catch(e => warn(e, setWarning))\n          .then((payload) => {\n            if (!payload) return;\n            const { data } = payload;\n            setGeneData(data);\n            setItemIsReady('expression-matrix');\n          });\n      } else {\n        loader.load().catch(e => warn(e, setWarning)).then((payload) => {\n          if (!payload) return;\n          const { data } = payload;\n          const [attrs, { data: matrix }] = data;\n          const expressionDataForSelection = selection.map((sel) => {\n            const geneIndex = attrs.cols.indexOf(sel);\n            const numGenes = attrs.cols.length;\n            const numCells = attrs.rows.length;\n            const expressionData = new Uint8Array(numCells);\n            for (let cellIndex = 0; cellIndex < numCells; cellIndex += 1) {\n              expressionData[cellIndex] = matrix[cellIndex * numGenes + geneIndex];\n            }\n            return expressionData;\n          });\n          setGeneData(expressionDataForSelection);\n          setItemIsReady('expression-matrix');\n        });\n      }\n    } else {\n      setGeneData(null);\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'expression-matrix', null, null), setWarning);\n      } else {\n        setItemIsReady('expression-matrix');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset, selection]);\n\n  return [geneData];\n}\n\n/**\n * Get the attributes for the expression matrix data type loader,\n * i.e names of cells and genes.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.  Should not be used in conjunction (called in the same component)\n * with useExpressionMatrixData.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {function} addUrl A function to call to update\n * the URL list.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @returns {object} [attrs] { rows, cols } object containing cell and gene names.\n */\nexport function useExpressionAttrs(loaders, dataset, setItemIsReady, addUrl, isRequired) {\n  const [attrs, setAttrs] = useState();\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n    const loader = loaders[dataset].loaders['expression-matrix'];\n    if (loader) {\n      const implementsLoadAttrs = typeof loader.loadAttrs === 'function';\n      if (implementsLoadAttrs) {\n        loader.loadAttrs().catch(e => warn(e, setWarning)).then((payload) => {\n          if (!payload) return;\n          const { data, url } = payload;\n          setAttrs(data);\n          addUrl(url, 'Expression Matrix');\n          setItemIsReady('expression-matrix');\n        });\n      } else {\n        loader.load().catch(e => warn(e, setWarning)).then((payload) => {\n          if (!payload) return;\n          const { data, url } = payload;\n          setAttrs(data[0]);\n          addUrl(url, 'Expression Matrix');\n          setItemIsReady('expression-matrix');\n        });\n      }\n    } else {\n      setAttrs(null);\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'expression-matrix', null, null), setWarning);\n      } else {\n        setItemIsReady('expression-matrix');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return [attrs];\n}\n\n/**\n * Get data from a molecules data type loader,\n * updating \"ready\" and URL state appropriately.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {function} addUrl A function to call to update\n * the URL list.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @param {object} coordinationSetters Object where\n * keys are coordination type names with the prefix 'set',\n * values are coordination setter functions.\n * @param {object} initialCoordinationValues Object where\n * keys are coordination type names with the prefix 'initialize',\n * values are initialization preferences as boolean values.\n * @returns {array} [molecules, moleculesCount, locationsCount] where\n * molecules is an object,\n * moleculesCount is the number of unique molecule types, and\n * locationsCount is the number of molecules.\n */\nexport function useMoleculesData(\n  loaders, dataset, setItemIsReady, addUrl, isRequired,\n  coordinationSetters, initialCoordinationValues,\n) {\n  const [molecules, setMolecules] = useState();\n  const [moleculesCount, setMoleculesCount] = useState(0);\n  const [locationsCount, setLocationsCount] = useState(0);\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n\n    if (loaders[dataset].loaders.molecules) {\n      loaders[dataset].loaders.molecules.load().catch(e => warn(e, setWarning)).then((payload) => {\n        if (!payload) return;\n        const { data, url, coordinationValues } = payload;\n        setMolecules(data);\n        setMoleculesCount(Object.keys(data).length);\n        setLocationsCount(Object.values(data)\n          .map(l => l.length)\n          .reduce((a, b) => a + b, 0));\n        addUrl(url, 'Molecules');\n        const coordinationValuesOrDefault = {\n          spatialMoleculesLayer: DEFAULT_MOLECULES_LAYER,\n          ...coordinationValues,\n        };\n        initCoordinationSpace(\n          coordinationValuesOrDefault,\n          coordinationSetters,\n          initialCoordinationValues,\n        );\n        setItemIsReady('molecules');\n      });\n    } else {\n      setMolecules({});\n      setMoleculesCount(0);\n      setLocationsCount(0);\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'molecules', null, null), setWarning);\n      } else {\n        setItemIsReady('molecules');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return [molecules, moleculesCount, locationsCount];\n}\n\n/**\n * Get data from a neighborhoods data type loader,\n * updating \"ready\" and URL state appropriately.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {function} addUrl A function to call to update\n * the URL list.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @param {object} coordinationSetters Object where\n * keys are coordination type names with the prefix 'set',\n * values are coordination setter functions.\n * @param {object} initialCoordinationValues Object where\n * keys are coordination type names with the prefix 'initialize',\n * values are initialization preferences as boolean values.\n * @returns {array} [neighborhoods] where\n * neighborhoods is an object.\n */\nexport function useNeighborhoodsData(\n  loaders, dataset, setItemIsReady, addUrl, isRequired,\n  coordinationSetters, initialCoordinationValues,\n) {\n  const [neighborhoods, setNeighborhoods] = useState();\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n\n    if (loaders[dataset].loaders.neighborhoods) {\n      loaders[dataset].loaders.neighborhoods.load().catch(e => warn(e, setWarning))\n        .then((payload) => {\n          if (!payload) return;\n          const { data, url, coordinationValues } = payload;\n          setNeighborhoods(data);\n          addUrl(url, 'Neighborhoods');\n          const coordinationValuesOrDefault = {\n            spatialNeighborhoodsLayer: DEFAULT_NEIGHBORHOODS_LAYER,\n            ...coordinationValues,\n          };\n          initCoordinationSpace(\n            coordinationValuesOrDefault,\n            coordinationSetters,\n            initialCoordinationValues,\n          );\n          setItemIsReady('neighborhoods');\n        });\n    } else {\n      setNeighborhoods({});\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'neighborhoods', null, null), setWarning);\n      } else {\n        setItemIsReady('neighborhoods');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return [neighborhoods];\n}\n\n/**\n * Get data from a raster data type loader,\n * updating \"ready\" and URL state appropriately.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {function} addUrl A function to call to update\n * the URL list.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @param {object} coordinationSetters Object where\n * keys are coordination type names with the prefix 'set',\n * values are coordination setter functions.\n * @param {object} initialCoordinationValues Object where\n * keys are coordination type names with the prefix 'initialize',\n * values are initialization preferences as boolean values.\n * @returns {array} [raster, imageLayerLoaders, imageLayerMeta] where\n * raster is an object,\n * imageLayerLoaders is an object, and\n * imageLayerMeta is an object.\n */\nexport function useRasterData(\n  loaders, dataset, setItemIsReady, addUrl, isRequired,\n  coordinationSetters, initialCoordinationValues,\n) {\n  const [raster, setRaster] = useState();\n  // Since we want the image layer / channel definitions to come from the\n  // coordination space stored as JSON in the view config,\n  // we need to set up a separate state variable here to store the\n  // non-JSON objects, such as layer loader instances.\n  const [imageLayerLoaders, setImageLayerLoaders] = useState([]);\n  const [imageLayerMeta, setImageLayerMeta] = useState([]);\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n\n    if (loaders[dataset].loaders.raster) {\n      loaders[dataset].loaders.raster.load().catch(e => warn(e, setWarning)).then((payload) => {\n        if (!payload) return;\n        const { data, url: urls, coordinationValues } = payload;\n        setRaster(data);\n        urls.forEach(([url, name]) => {\n          addUrl(url, name);\n        });\n        const { loaders: nextImageLoaders, meta: nextImageMeta } = data;\n        setImageLayerLoaders(nextImageLoaders);\n        setImageLayerMeta(nextImageMeta);\n        initCoordinationSpace(\n          coordinationValues,\n          coordinationSetters,\n          initialCoordinationValues,\n        );\n        setItemIsReady('raster');\n      });\n    } else {\n      // There was no raster loader for this dataset,\n      // and raster should be optional.\n      setImageLayerLoaders([]);\n      setImageLayerMeta([]);\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'raster', null, null), setWarning);\n      } else {\n        setItemIsReady('raster');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n  return [raster, imageLayerLoaders, imageLayerMeta];\n}\n\n/**\n * Get data from a genomic-profiles data type loader,\n * updating \"ready\" and URL state appropriately.\n * Throw warnings if the data is marked as required.\n * Subscribe to loader updates.\n * @param {object} loaders The object mapping\n * datasets and data types to loader instances.\n * @param {string} dataset The key for a dataset,\n * used to identify which loader to use.\n * @param {function} setItemIsReady A function to call\n * when done loading.\n * @param {function} addUrl A function to call to update\n * the URL list.\n * @param {boolean} isRequired Should a warning be thrown if\n * loading is unsuccessful?\n * @param {object} coordinationSetters Object where\n * keys are coordination type names with the prefix 'set',\n * values are coordination setter functions.\n * @param {object} initialCoordinationValues Object where\n * keys are coordination type names with the prefix 'initialize',\n * values are initialization preferences as boolean values.\n * @returns {array} [neighborhoods] where\n * neighborhoods is an object.\n */\nexport function useGenomicProfilesData(\n  loaders, dataset, setItemIsReady, addUrl, isRequired,\n  coordinationSetters, initialCoordinationValues,\n) {\n  const [genomicProfilesAttrs, setGenomicProfilesAttrs] = useState();\n\n  const setWarning = useSetWarning();\n\n  useEffect(() => {\n    if (!loaders[dataset]) {\n      return;\n    }\n\n    if (loaders[dataset].loaders['genomic-profiles']) {\n      loaders[dataset].loaders['genomic-profiles'].load().catch(e => warn(e, setWarning))\n        .then((payload) => {\n          if (!payload) return;\n          const { data, url, coordinationValues } = payload;\n          setGenomicProfilesAttrs(data);\n          addUrl(url);\n          initCoordinationSpace(\n            coordinationValues,\n            coordinationSetters,\n            initialCoordinationValues,\n          );\n          setItemIsReady('genomic-profiles');\n        });\n    } else {\n      setGenomicProfilesAttrs(null);\n      if (isRequired) {\n        warn(new LoaderNotFoundError(dataset, 'genomic-profiles', null, null), setWarning);\n      } else {\n        setItemIsReady('genomic-profiles');\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return [genomicProfilesAttrs];\n}\n", "/**\n * A loader error ancestor class containing a default constructor\n * and a stub for the required warnInConsole() method.\n */\nexport default class AbstractLoaderError {\n  constructor(message) {\n    this.message = message;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  warnInConsole() {\n    throw new Error('The warnInConsole() method has not been implemented.');\n  }\n}\n", "import AbstractLoaderError from './AbstractLoaderError';\n\nexport default class LoaderValidationError extends AbstractLoaderError {\n  constructor(datasetType, datasetFileType, datasetUrl, reason) {\n    super(`Error while validating ${datasetType}.`);\n    this.name = 'LoaderValidationError';\n\n    this.datasetType = datasetType;\n    this.datasetFileType = datasetFileType;\n    this.datasetUrl = datasetUrl;\n    this.reason = reason;\n  }\n\n  warnInConsole() {\n    const {\n      datasetType, datasetUrl, reason,\n    } = this;\n    console.warn(\n      `${datasetType} from ${datasetUrl}: validation failed`,\n      JSON.stringify(reason, null, 2),\n    );\n  }\n}\n", "import AbstractLoaderError from './AbstractLoaderError';\n\nexport default class LoaderNotFoundError extends AbstractLoaderError {\n  constructor(datasetType, datasetFileType, datasetUrl) {\n    super(`Error finding loader for ${datasetType}.`);\n    this.name = 'LoaderNotFoundError';\n\n    this.datasetType = datasetType;\n    this.datasetFileType = datasetFileType;\n    this.datasetUrl = datasetUrl;\n  }\n\n  warnInConsole() {\n    const {\n      datasetType, datasetFileType, datasetUrl,\n    } = this;\n    if (datasetFileType && datasetUrl) {\n      console.warn(\n        `${datasetType} from ${datasetUrl}: unable to find loader for fileType ${datasetFileType}`,\n      );\n    } else {\n      console.warn(\n        `${datasetType}: unable to find loader`,\n      );\n    }\n  }\n}\n", "import { COORDINATE_SYSTEM, Layer, project32, picking, CompositeLayer, OrthographicView, Controller, OrbitView } from '@deck.gl/core';\nimport { Matrix4 } from 'math.gl';\nimport GL from '@luma.gl/constants';\nimport { TileLayer } from '@deck.gl/geo-layers';\nimport { Model, Geometry, Texture2D, isWebGL2, Texture3D } from '@luma.gl/core';\nimport { hasFeature, FEATURES } from '@luma.gl/webgl';\nimport { BitmapLayer as BitmapLayer$1, PolygonLayer, LineLayer, TextLayer } from '@deck.gl/layers';\nimport quickselect from 'quickselect';\nimport { Plane } from '@math.gl/culling';\nimport React, { PureComponent, useState, useMemo } from 'react';\nimport DeckGL from '@deck.gl/react';\nimport equal from 'fast-deep-equal';\nimport { fromUrl, fromBlob } from 'geotiff';\nimport parser from 'fast-xml-parser';\nimport { KeyError, openGroup, BoundsCheckError, slice, HTTPStore } from 'zarr';\n\nvar fsColormap1 = \"#define SHADER_NAME xr-layer-fragment-shader-colormap\\nprecision highp float;\\n#define GLSLIFY 1\\nuniform sampler2D channel0;uniform sampler2D channel1;uniform sampler2D channel2;uniform sampler2D channel3;uniform sampler2D channel4;uniform sampler2D channel5;uniform vec2 contrastLimits[6];uniform float opacity;uniform float divisor;uniform bool useTransparentColor;varying vec2 vTexCoord;void main(){float intensityValue0=sample_and_apply_contrast_limits(channel0,vTexCoord,contrastLimits[0]);float intensityValue1=sample_and_apply_contrast_limits(channel1,vTexCoord,contrastLimits[1]);float intensityValue2=sample_and_apply_contrast_limits(channel2,vTexCoord,contrastLimits[2]);float intensityValue3=sample_and_apply_contrast_limits(channel3,vTexCoord,contrastLimits[3]);float intensityValue4=sample_and_apply_contrast_limits(channel4,vTexCoord,contrastLimits[4]);float intensityValue5=sample_and_apply_contrast_limits(channel5,vTexCoord,contrastLimits[5]);float intensityCombo=0.;intensityCombo+=max(0.,intensityValue0);intensityCombo+=max(0.,intensityValue1);intensityCombo+=max(0.,intensityValue2);intensityCombo+=max(0.,intensityValue3);intensityCombo+=max(0.,intensityValue4);intensityCombo+=max(0.,intensityValue5);gl_FragColor=colormap(intensityCombo,opacity,useTransparentColor);geometry.uv=vTexCoord;DECKGL_FILTER_COLOR(gl_FragColor,geometry);}\"; // eslint-disable-line\n\nvar fsColormap2 = \"#version 300 es\\n#define SHADER_NAME xr-layer-fragment-shader\\nprecision highp float;precision highp int;precision highp SAMPLER_TYPE;\\n#define GLSLIFY 1\\nuniform SAMPLER_TYPE channel0;uniform SAMPLER_TYPE channel1;uniform SAMPLER_TYPE channel2;uniform SAMPLER_TYPE channel3;uniform SAMPLER_TYPE channel4;uniform SAMPLER_TYPE channel5;uniform vec2 contrastLimits[6];uniform float opacity;uniform bool useTransparentColor;in vec2 vTexCoord;out vec4 color;void main(){float intensityValue0=sample_and_apply_contrast_limits(channel0,vTexCoord,contrastLimits[0]);float intensityValue1=sample_and_apply_contrast_limits(channel1,vTexCoord,contrastLimits[1]);float intensityValue2=sample_and_apply_contrast_limits(channel2,vTexCoord,contrastLimits[2]);float intensityValue3=sample_and_apply_contrast_limits(channel3,vTexCoord,contrastLimits[3]);float intensityValue4=sample_and_apply_contrast_limits(channel4,vTexCoord,contrastLimits[4]);float intensityValue5=sample_and_apply_contrast_limits(channel5,vTexCoord,contrastLimits[5]);float intensityArray[6]=float[6](intensityValue0,intensityValue1,intensityValue2,intensityValue3,intensityValue4,intensityValue5);float intensityCombo=0.;for(int i=0;i<6;i++){intensityCombo+=max(0.,intensityArray[i]);}color=colormap(intensityCombo,opacity,useTransparentColor);geometry.uv=vTexCoord;DECKGL_FILTER_COLOR(color,geometry);}\"; // eslint-disable-line\n\nvar fs1 = \"#define SHADER_NAME xr-layer-fragment-shader\\nprecision highp float;\\n#define GLSLIFY 1\\nuniform sampler2D channel0;uniform sampler2D channel1;uniform sampler2D channel2;uniform sampler2D channel3;uniform sampler2D channel4;uniform sampler2D channel5;uniform vec2 contrastLimits[6];uniform vec3 colors[6];uniform float intensityArray[6];uniform float opacity;uniform float majorLensAxis;uniform float minorLensAxis;uniform vec2 lensCenter;uniform bool isLensOn;uniform int lensSelection;uniform vec3 lensBorderColor;uniform float lensBorderRadius;uniform vec3 transparentColor;uniform bool useTransparentColor;varying vec2 vTexCoord;void main(){float intensityValue0=sample_and_apply_contrast_limits(channel0,vTexCoord,contrastLimits[0]);float intensityValue1=sample_and_apply_contrast_limits(channel1,vTexCoord,contrastLimits[1]);float intensityValue2=sample_and_apply_contrast_limits(channel2,vTexCoord,contrastLimits[2]);float intensityValue3=sample_and_apply_contrast_limits(channel3,vTexCoord,contrastLimits[3]);float intensityValue4=sample_and_apply_contrast_limits(channel4,vTexCoord,contrastLimits[4]);float intensityValue5=sample_and_apply_contrast_limits(channel5,vTexCoord,contrastLimits[5]);bool isFragInLensBounds=frag_in_lens_bounds(lensCenter,vTexCoord,majorLensAxis,minorLensAxis,lensBorderRadius);bool isFragOnLensBounds=frag_on_lens_bounds(lensCenter,vTexCoord,majorLensAxis,minorLensAxis,lensBorderRadius);bool inLensAndUseLens=isLensOn&&isFragInLensBounds;vec3 rgbCombo=process_channel_intensity(intensityValue0,colors[0],0,inLensAndUseLens,lensSelection);rgbCombo+=process_channel_intensity(intensityValue1,colors[1],1,inLensAndUseLens,lensSelection);rgbCombo+=process_channel_intensity(intensityValue2,colors[2],2,inLensAndUseLens,lensSelection);rgbCombo+=process_channel_intensity(intensityValue3,colors[3],3,inLensAndUseLens,lensSelection);rgbCombo+=process_channel_intensity(intensityValue4,colors[4],4,inLensAndUseLens,lensSelection);rgbCombo+=process_channel_intensity(intensityValue5,colors[5],5,inLensAndUseLens,lensSelection);rgbCombo=(isLensOn&&isFragOnLensBounds)? lensBorderColor : rgbCombo;gl_FragColor=apply_opacity(rgbCombo,useTransparentColor,transparentColor,opacity);geometry.uv=vTexCoord;DECKGL_FILTER_COLOR(gl_FragColor,geometry);}\"; // eslint-disable-line\n\nvar fs2 = \"#version 300 es\\n#define SHADER_NAME xr-layer-fragment-shader\\nprecision highp float;precision highp int;precision highp SAMPLER_TYPE;\\n#define GLSLIFY 1\\nuniform SAMPLER_TYPE channel0;uniform SAMPLER_TYPE channel1;uniform SAMPLER_TYPE channel2;uniform SAMPLER_TYPE channel3;uniform SAMPLER_TYPE channel4;uniform SAMPLER_TYPE channel5;uniform vec2 contrastLimits[6];uniform vec3 colors[6];uniform float opacity;uniform float majorLensAxis;uniform float minorLensAxis;uniform vec2 lensCenter;uniform bool isLensOn;uniform int lensSelection;uniform vec3 lensBorderColor;uniform float lensBorderRadius;uniform vec3 transparentColor;uniform bool useTransparentColor;in vec2 vTexCoord;out vec4 color;void main(){float intensityValue0=sample_and_apply_contrast_limits(channel0,vTexCoord,contrastLimits[0]);float intensityValue1=sample_and_apply_contrast_limits(channel1,vTexCoord,contrastLimits[1]);float intensityValue2=sample_and_apply_contrast_limits(channel2,vTexCoord,contrastLimits[2]);float intensityValue3=sample_and_apply_contrast_limits(channel3,vTexCoord,contrastLimits[3]);float intensityValue4=sample_and_apply_contrast_limits(channel4,vTexCoord,contrastLimits[4]);float intensityValue5=sample_and_apply_contrast_limits(channel5,vTexCoord,contrastLimits[5]);float intensityArray[6]=float[6](intensityValue0,intensityValue1,intensityValue2,intensityValue3,intensityValue4,intensityValue5);bool isFragInLensBounds=frag_in_lens_bounds(lensCenter,vTexCoord,majorLensAxis,minorLensAxis,lensBorderRadius);bool isFragOnLensBounds=frag_on_lens_bounds(lensCenter,vTexCoord,majorLensAxis,minorLensAxis,lensBorderRadius);bool inLensAndUseLens=isLensOn&&isFragInLensBounds;vec3 rgbCombo=vec3(0.);for(int i=0;i<6;i++){rgbCombo+=process_channel_intensity(intensityArray[i],colors[i],i,inLensAndUseLens,lensSelection);}rgbCombo=(isLensOn&&isFragOnLensBounds)? lensBorderColor : rgbCombo;color=apply_opacity(rgbCombo,useTransparentColor,transparentColor,opacity);geometry.uv=vTexCoord;DECKGL_FILTER_COLOR(color,geometry);}\"; // eslint-disable-line\n\nvar vs1 = \"#define GLSLIFY 1\\n#define SHADER_NAME xr-layer-vertex-shader\\nattribute vec2 texCoords;attribute vec3 positions;attribute vec3 positions64Low;attribute vec3 instancePickingColors;varying vec2 vTexCoord;void main(void){geometry.worldPosition=positions;geometry.uv=texCoords;geometry.pickingColor=instancePickingColors;gl_Position=project_position_to_clipspace(positions,positions64Low,vec3(0.),geometry.position);DECKGL_FILTER_GL_POSITION(gl_Position,geometry);vTexCoord=texCoords;vec4 color=vec4(0.);DECKGL_FILTER_COLOR(color,geometry);}\"; // eslint-disable-line\n\nvar vs2 = \"#version 300 es\\n#define GLSLIFY 1\\n#define SHADER_NAME xr-layer-vertex-shader\\nin vec2 texCoords;in vec3 positions;in vec3 positions64Low;in vec3 instancePickingColors;out vec2 vTexCoord;void main(void){geometry.worldPosition=positions;geometry.uv=texCoords;geometry.pickingColor=instancePickingColors;gl_Position=project_position_to_clipspace(positions,positions64Low,vec3(0.),geometry.position);DECKGL_FILTER_GL_POSITION(gl_Position,geometry);vTexCoord=texCoords;vec4 color=vec4(0.);DECKGL_FILTER_COLOR(color,geometry);}\"; // eslint-disable-line\n\nvar fs$3 = \"#define GLSLIFY 1\\nvec4 jet(float x_17){const float e0=0.0;const vec4 v0=vec4(0,0,0.5137254901960784,1);const float e1=0.125;const vec4 v1=vec4(0,0.23529411764705882,0.6666666666666666,1);const float e2=0.375;const vec4 v2=vec4(0.0196078431372549,1,1,1);const float e3=0.625;const vec4 v3=vec4(1,1,0,1);const float e4=0.875;const vec4 v4=vec4(0.9803921568627451,0,0,1);const float e5=1.0;const vec4 v5=vec4(0.5019607843137255,0,0,1);float a0=smoothstep(e0,e1,x_17);float a1=smoothstep(e1,e2,x_17);float a2=smoothstep(e2,e3,x_17);float a3=smoothstep(e3,e4,x_17);float a4=smoothstep(e4,e5,x_17);return max(mix(v0,v1,a0)*step(e0,x_17)*step(x_17,e1),max(mix(v1,v2,a1)*step(e1,x_17)*step(x_17,e2),max(mix(v2,v3,a2)*step(e2,x_17)*step(x_17,e3),max(mix(v3,v4,a3)*step(e3,x_17)*step(x_17,e4),mix(v4,v5,a4)*step(e4,x_17)*step(x_17,e5)))));}vec4 hsv(float x_18){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=0.169;const vec4 v1=vec4(0.9921568627450981,1,0.00784313725490196,1);const float e2=0.173;const vec4 v2=vec4(0.9686274509803922,1,0.00784313725490196,1);const float e3=0.337;const vec4 v3=vec4(0,0.9882352941176471,0.01568627450980392,1);const float e4=0.341;const vec4 v4=vec4(0,0.9882352941176471,0.0392156862745098,1);const float e5=0.506;const vec4 v5=vec4(0.00392156862745098,0.9764705882352941,1,1);const float e6=0.671;const vec4 v6=vec4(0.00784313725490196,0,0.9921568627450981,1);const float e7=0.675;const vec4 v7=vec4(0.03137254901960784,0,0.9921568627450981,1);const float e8=0.839;const vec4 v8=vec4(1,0,0.984313725490196,1);const float e9=0.843;const vec4 v9=vec4(1,0,0.9607843137254902,1);const float e10=1.0;const vec4 v10=vec4(1,0,0.023529411764705882,1);float a0=smoothstep(e0,e1,x_18);float a1=smoothstep(e1,e2,x_18);float a2=smoothstep(e2,e3,x_18);float a3=smoothstep(e3,e4,x_18);float a4=smoothstep(e4,e5,x_18);float a5=smoothstep(e5,e6,x_18);float a6=smoothstep(e6,e7,x_18);float a7=smoothstep(e7,e8,x_18);float a8=smoothstep(e8,e9,x_18);float a9=smoothstep(e9,e10,x_18);return max(mix(v0,v1,a0)*step(e0,x_18)*step(x_18,e1),max(mix(v1,v2,a1)*step(e1,x_18)*step(x_18,e2),max(mix(v2,v3,a2)*step(e2,x_18)*step(x_18,e3),max(mix(v3,v4,a3)*step(e3,x_18)*step(x_18,e4),max(mix(v4,v5,a4)*step(e4,x_18)*step(x_18,e5),max(mix(v5,v6,a5)*step(e5,x_18)*step(x_18,e6),max(mix(v6,v7,a6)*step(e6,x_18)*step(x_18,e7),max(mix(v7,v8,a7)*step(e7,x_18)*step(x_18,e8),max(mix(v8,v9,a8)*step(e8,x_18)*step(x_18,e9),mix(v9,v10,a9)*step(e9,x_18)*step(x_18,e10))))))))));}vec4 hot(float x_13){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.3;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.6;const vec4 v2=vec4(1,0.8235294117647058,0,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_13);float a1=smoothstep(e1,e2,x_13);float a2=smoothstep(e2,e3,x_13);return max(mix(v0,v1,a0)*step(e0,x_13)*step(x_13,e1),max(mix(v1,v2,a1)*step(e1,x_13)*step(x_13,e2),mix(v2,v3,a2)*step(e2,x_13)*step(x_13,e3)));}vec4 cool(float x_24){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.4549019607843137,0,0.8549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);const float e3=0.38;const vec4 v3=vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);const float e4=0.5;const vec4 v4=vec4(0,0.8,0.7725490196078432,1);const float e5=0.63;const vec4 v5=vec4(0,0.9686274509803922,0.5725490196078431,1);const float e6=0.75;const vec4 v6=vec4(0,1,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.1568627450980392,1,0.03137254901960784,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_24);float a1=smoothstep(e1,e2,x_24);float a2=smoothstep(e2,e3,x_24);float a3=smoothstep(e3,e4,x_24);float a4=smoothstep(e4,e5,x_24);float a5=smoothstep(e5,e6,x_24);float a6=smoothstep(e6,e7,x_24);float a7=smoothstep(e7,e8,x_24);return max(mix(v0,v1,a0)*step(e0,x_24)*step(x_24,e1),max(mix(v1,v2,a1)*step(e1,x_24)*step(x_24,e2),max(mix(v2,v3,a2)*step(e2,x_24)*step(x_24,e3),max(mix(v3,v4,a3)*step(e3,x_24)*step(x_24,e4),max(mix(v4,v5,a4)*step(e4,x_24)*step(x_24,e5),max(mix(v5,v6,a5)*step(e5,x_24)*step(x_24,e6),max(mix(v6,v7,a6)*step(e6,x_24)*step(x_24,e7),mix(v7,v8,a7)*step(e7,x_24)*step(x_24,e8))))))));}vec4 spring(float x_5){const float e0=0.0;const vec4 v0=vec4(1,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_5);return mix(v0,v1,a0)*step(e0,x_5)*step(x_5,e1);}vec4 summer(float x_12){const float e0=0.0;const vec4 v0=vec4(0,0.5019607843137255,0.4,1);const float e1=1.0;const vec4 v1=vec4(1,1,0.4,1);float a0=smoothstep(e0,e1,x_12);return mix(v0,v1,a0)*step(e0,x_12)*step(x_12,e1);}vec4 autumn(float x_25){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_25);return mix(v0,v1,a0)*step(e0,x_25)*step(x_25,e1);}vec4 winter(float x_16){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(0,1,0.5019607843137255,1);float a0=smoothstep(e0,e1,x_16);return mix(v0,v1,a0)*step(e0,x_16)*step(x_16,e1);}vec4 bone(float x_15){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.376;const vec4 v1=vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);const float e2=0.753;const vec4 v2=vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_15);float a1=smoothstep(e1,e2,x_15);float a2=smoothstep(e2,e3,x_15);return max(mix(v0,v1,a0)*step(e0,x_15)*step(x_15,e1),max(mix(v1,v2,a1)*step(e1,x_15)*step(x_15,e2),mix(v2,v3,a2)*step(e2,x_15)*step(x_15,e3)));}vec4 copper(float x_10){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.804;const vec4 v1=vec4(1,0.6274509803921569,0.4,1);const float e2=1.0;const vec4 v2=vec4(1,0.7803921568627451,0.4980392156862745,1);float a0=smoothstep(e0,e1,x_10);float a1=smoothstep(e1,e2,x_10);return max(mix(v0,v1,a0)*step(e0,x_10)*step(x_10,e1),mix(v1,v2,a1)*step(e1,x_10)*step(x_10,e2));}vec4 greys(float x_4){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_4);return mix(v0,v1,a0)*step(e0,x_4)*step(x_4,e1);}vec4 yignbu(float x_32){const float e0=0.0;const vec4 v0=vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);const float e1=0.125;const vec4 v1=vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);const float e2=0.25;const vec4 v2=vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);const float e3=0.375;const vec4 v3=vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);const float e4=0.5;const vec4 v4=vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);const float e5=0.625;const vec4 v5=vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);const float e7=0.875;const vec4 v7=vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8509803921568627,1);float a0=smoothstep(e0,e1,x_32);float a1=smoothstep(e1,e2,x_32);float a2=smoothstep(e2,e3,x_32);float a3=smoothstep(e3,e4,x_32);float a4=smoothstep(e4,e5,x_32);float a5=smoothstep(e5,e6,x_32);float a6=smoothstep(e6,e7,x_32);float a7=smoothstep(e7,e8,x_32);return max(mix(v0,v1,a0)*step(e0,x_32)*step(x_32,e1),max(mix(v1,v2,a1)*step(e1,x_32)*step(x_32,e2),max(mix(v2,v3,a2)*step(e2,x_32)*step(x_32,e3),max(mix(v3,v4,a3)*step(e3,x_32)*step(x_32,e4),max(mix(v4,v5,a4)*step(e4,x_32)*step(x_32,e5),max(mix(v5,v6,a5)*step(e5,x_32)*step(x_32,e6),max(mix(v6,v7,a6)*step(e6,x_32)*step(x_32,e7),mix(v7,v8,a7)*step(e7,x_32)*step(x_32,e8))))))));}vec4 greens(float x_34){const float e0=0.0;const vec4 v0=vec4(0,0.26666666666666666,0.10588235294117647,1);const float e1=0.125;const vec4 v1=vec4(0,0.42745098039215684,0.17254901960784313,1);const float e2=0.25;const vec4 v2=vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);const float e3=0.375;const vec4 v3=vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);const float e4=0.5;const vec4 v4=vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);const float e5=0.625;const vec4 v5=vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);const float e7=0.875;const vec4 v7=vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);const float e8=1.0;const vec4 v8=vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);float a0=smoothstep(e0,e1,x_34);float a1=smoothstep(e1,e2,x_34);float a2=smoothstep(e2,e3,x_34);float a3=smoothstep(e3,e4,x_34);float a4=smoothstep(e4,e5,x_34);float a5=smoothstep(e5,e6,x_34);float a6=smoothstep(e6,e7,x_34);float a7=smoothstep(e7,e8,x_34);return max(mix(v0,v1,a0)*step(e0,x_34)*step(x_34,e1),max(mix(v1,v2,a1)*step(e1,x_34)*step(x_34,e2),max(mix(v2,v3,a2)*step(e2,x_34)*step(x_34,e3),max(mix(v3,v4,a3)*step(e3,x_34)*step(x_34,e4),max(mix(v4,v5,a4)*step(e4,x_34)*step(x_34,e5),max(mix(v5,v6,a5)*step(e5,x_34)*step(x_34,e6),max(mix(v6,v7,a6)*step(e6,x_34)*step(x_34,e7),mix(v7,v8,a7)*step(e7,x_34)*step(x_34,e8))))))));}vec4 yiorrd(float x_41){const float e0=0.0;const vec4 v0=vec4(0.5019607843137255,0,0.14901960784313725,1);const float e1=0.125;const vec4 v1=vec4(0.7411764705882353,0,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);const float e3=0.375;const vec4 v3=vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);const float e4=0.5;const vec4 v4=vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);const float e5=0.625;const vec4 v5=vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);const float e6=0.75;const vec4 v6=vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);const float e7=0.875;const vec4 v7=vec4(1,0.9294117647058824,0.6274509803921569,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8,1);float a0=smoothstep(e0,e1,x_41);float a1=smoothstep(e1,e2,x_41);float a2=smoothstep(e2,e3,x_41);float a3=smoothstep(e3,e4,x_41);float a4=smoothstep(e4,e5,x_41);float a5=smoothstep(e5,e6,x_41);float a6=smoothstep(e6,e7,x_41);float a7=smoothstep(e7,e8,x_41);return max(mix(v0,v1,a0)*step(e0,x_41)*step(x_41,e1),max(mix(v1,v2,a1)*step(e1,x_41)*step(x_41,e2),max(mix(v2,v3,a2)*step(e2,x_41)*step(x_41,e3),max(mix(v3,v4,a3)*step(e3,x_41)*step(x_41,e4),max(mix(v4,v5,a4)*step(e4,x_41)*step(x_41,e5),max(mix(v5,v6,a5)*step(e5,x_41)*step(x_41,e6),max(mix(v6,v7,a6)*step(e6,x_41)*step(x_41,e7),mix(v7,v8,a7)*step(e7,x_41)*step(x_41,e8))))))));}vec4 bluered(float x_23){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_23);return mix(v0,v1,a0)*step(e0,x_23)*step(x_23,e1);}vec4 rdbu(float x_1){const float e0=0.0;const vec4 v0=vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);const float e1=0.35;const vec4 v1=vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);const float e2=0.5;const vec4 v2=vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);const float e3=0.6;const vec4 v3=vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);const float e4=0.7;const vec4 v4=vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);const float e5=1.0;const vec4 v5=vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);float a0=smoothstep(e0,e1,x_1);float a1=smoothstep(e1,e2,x_1);float a2=smoothstep(e2,e3,x_1);float a3=smoothstep(e3,e4,x_1);float a4=smoothstep(e4,e5,x_1);return max(mix(v0,v1,a0)*step(e0,x_1)*step(x_1,e1),max(mix(v1,v2,a1)*step(e1,x_1)*step(x_1,e2),max(mix(v2,v3,a2)*step(e2,x_1)*step(x_1,e3),max(mix(v3,v4,a3)*step(e3,x_1)*step(x_1,e4),mix(v4,v5,a4)*step(e4,x_1)*step(x_1,e5)))));}vec4 picnic(float x_42){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=0.1;const vec4 v1=vec4(0.2,0.6,1,1);const float e2=0.2;const vec4 v2=vec4(0.4,0.8,1,1);const float e3=0.3;const vec4 v3=vec4(0.6,0.8,1,1);const float e4=0.4;const vec4 v4=vec4(0.8,0.8,1,1);const float e5=0.5;const vec4 v5=vec4(1,1,1,1);const float e6=0.6;const vec4 v6=vec4(1,0.8,1,1);const float e7=0.7;const vec4 v7=vec4(1,0.6,1,1);const float e8=0.8;const vec4 v8=vec4(1,0.4,0.8,1);const float e9=0.9;const vec4 v9=vec4(1,0.4,0.4,1);const float e10=1.0;const vec4 v10=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_42);float a1=smoothstep(e1,e2,x_42);float a2=smoothstep(e2,e3,x_42);float a3=smoothstep(e3,e4,x_42);float a4=smoothstep(e4,e5,x_42);float a5=smoothstep(e5,e6,x_42);float a6=smoothstep(e6,e7,x_42);float a7=smoothstep(e7,e8,x_42);float a8=smoothstep(e8,e9,x_42);float a9=smoothstep(e9,e10,x_42);return max(mix(v0,v1,a0)*step(e0,x_42)*step(x_42,e1),max(mix(v1,v2,a1)*step(e1,x_42)*step(x_42,e2),max(mix(v2,v3,a2)*step(e2,x_42)*step(x_42,e3),max(mix(v3,v4,a3)*step(e3,x_42)*step(x_42,e4),max(mix(v4,v5,a4)*step(e4,x_42)*step(x_42,e5),max(mix(v5,v6,a5)*step(e5,x_42)*step(x_42,e6),max(mix(v6,v7,a6)*step(e6,x_42)*step(x_42,e7),max(mix(v7,v8,a7)*step(e7,x_42)*step(x_42,e8),max(mix(v8,v9,a8)*step(e8,x_42)*step(x_42,e9),mix(v9,v10,a9)*step(e9,x_42)*step(x_42,e10))))))))));}vec4 rainbow(float x_31){const float e0=0.0;const vec4 v0=vec4(0.5882352941176471,0,0.35294117647058826,1);const float e1=0.125;const vec4 v1=vec4(0,0,0.7843137254901961,1);const float e2=0.25;const vec4 v2=vec4(0,0.09803921568627451,1,1);const float e3=0.375;const vec4 v3=vec4(0,0.596078431372549,1,1);const float e4=0.5;const vec4 v4=vec4(0.17254901960784313,1,0.5882352941176471,1);const float e5=0.625;const vec4 v5=vec4(0.592156862745098,1,0,1);const float e6=0.75;const vec4 v6=vec4(1,0.9176470588235294,0,1);const float e7=0.875;const vec4 v7=vec4(1,0.43529411764705883,0,1);const float e8=1.0;const vec4 v8=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_31);float a1=smoothstep(e1,e2,x_31);float a2=smoothstep(e2,e3,x_31);float a3=smoothstep(e3,e4,x_31);float a4=smoothstep(e4,e5,x_31);float a5=smoothstep(e5,e6,x_31);float a6=smoothstep(e6,e7,x_31);float a7=smoothstep(e7,e8,x_31);return max(mix(v0,v1,a0)*step(e0,x_31)*step(x_31,e1),max(mix(v1,v2,a1)*step(e1,x_31)*step(x_31,e2),max(mix(v2,v3,a2)*step(e2,x_31)*step(x_31,e3),max(mix(v3,v4,a3)*step(e3,x_31)*step(x_31,e4),max(mix(v4,v5,a4)*step(e4,x_31)*step(x_31,e5),max(mix(v5,v6,a5)*step(e5,x_31)*step(x_31,e6),max(mix(v6,v7,a6)*step(e6,x_31)*step(x_31,e7),mix(v7,v8,a7)*step(e7,x_31)*step(x_31,e8))))))));}vec4 portland(float x_21){const float e0=0.0;const vec4 v0=vec4(0.047058823529411764,0.2,0.5137254901960784,1);const float e1=0.25;const vec4 v1=vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);const float e2=0.5;const vec4 v2=vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);const float e3=0.75;const vec4 v3=vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);const float e4=1.0;const vec4 v4=vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);float a0=smoothstep(e0,e1,x_21);float a1=smoothstep(e1,e2,x_21);float a2=smoothstep(e2,e3,x_21);float a3=smoothstep(e3,e4,x_21);return max(mix(v0,v1,a0)*step(e0,x_21)*step(x_21,e1),max(mix(v1,v2,a1)*step(e1,x_21)*step(x_21,e2),max(mix(v2,v3,a2)*step(e2,x_21)*step(x_21,e3),mix(v3,v4,a3)*step(e3,x_21)*step(x_21,e4))));}vec4 blackbody(float x_38){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.2;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.4;const vec4 v2=vec4(0.9019607843137255,0.8235294117647058,0,1);const float e3=0.7;const vec4 v3=vec4(1,1,1,1);const float e4=1.0;const vec4 v4=vec4(0.6274509803921569,0.7843137254901961,1,1);float a0=smoothstep(e0,e1,x_38);float a1=smoothstep(e1,e2,x_38);float a2=smoothstep(e2,e3,x_38);float a3=smoothstep(e3,e4,x_38);return max(mix(v0,v1,a0)*step(e0,x_38)*step(x_38,e1),max(mix(v1,v2,a1)*step(e1,x_38)*step(x_38,e2),max(mix(v2,v3,a2)*step(e2,x_38)*step(x_38,e3),mix(v3,v4,a3)*step(e3,x_38)*step(x_38,e4))));}vec4 earth(float x_29){const float e0=0.0;const vec4 v0=vec4(0,0,0.5098039215686274,1);const float e1=0.1;const vec4 v1=vec4(0,0.7058823529411765,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);const float e3=0.4;const vec4 v3=vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);const float e4=0.6;const vec4 v4=vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);const float e5=1.0;const vec4 v5=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_29);float a1=smoothstep(e1,e2,x_29);float a2=smoothstep(e2,e3,x_29);float a3=smoothstep(e3,e4,x_29);float a4=smoothstep(e4,e5,x_29);return max(mix(v0,v1,a0)*step(e0,x_29)*step(x_29,e1),max(mix(v1,v2,a1)*step(e1,x_29)*step(x_29,e2),max(mix(v2,v3,a2)*step(e2,x_29)*step(x_29,e3),max(mix(v3,v4,a3)*step(e3,x_29)*step(x_29,e4),mix(v4,v5,a4)*step(e4,x_29)*step(x_29,e5)))));}vec4 electric(float x_9){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.15;const vec4 v1=vec4(0.11764705882352941,0,0.39215686274509803,1);const float e2=0.4;const vec4 v2=vec4(0.47058823529411764,0,0.39215686274509803,1);const float e3=0.6;const vec4 v3=vec4(0.6274509803921569,0.35294117647058826,0,1);const float e4=0.8;const vec4 v4=vec4(0.9019607843137255,0.7843137254901961,0,1);const float e5=1.0;const vec4 v5=vec4(1,0.9803921568627451,0.8627450980392157,1);float a0=smoothstep(e0,e1,x_9);float a1=smoothstep(e1,e2,x_9);float a2=smoothstep(e2,e3,x_9);float a3=smoothstep(e3,e4,x_9);float a4=smoothstep(e4,e5,x_9);return max(mix(v0,v1,a0)*step(e0,x_9)*step(x_9,e1),max(mix(v1,v2,a1)*step(e1,x_9)*step(x_9,e2),max(mix(v2,v3,a2)*step(e2,x_9)*step(x_9,e3),max(mix(v3,v4,a3)*step(e3,x_9)*step(x_9,e4),mix(v4,v5,a4)*step(e4,x_9)*step(x_9,e5)))));}vec4 alpha(float x_0){const float e0=0.0;const vec4 v0=vec4(1,1,1,0);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_0);return mix(v0,v1,a0)*step(e0,x_0)*step(x_0,e1);}vec4 viridis(float x_22){const float e0=0.0;const vec4 v0=vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);const float e1=0.13;const vec4 v1=vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);const float e4=0.5;const vec4 v4=vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);const float e5=0.63;const vec4 v5=vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);const float e6=0.75;const vec4 v6=vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);const float e7=0.88;const vec4 v7=vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);float a0=smoothstep(e0,e1,x_22);float a1=smoothstep(e1,e2,x_22);float a2=smoothstep(e2,e3,x_22);float a3=smoothstep(e3,e4,x_22);float a4=smoothstep(e4,e5,x_22);float a5=smoothstep(e5,e6,x_22);float a6=smoothstep(e6,e7,x_22);float a7=smoothstep(e7,e8,x_22);return max(mix(v0,v1,a0)*step(e0,x_22)*step(x_22,e1),max(mix(v1,v2,a1)*step(e1,x_22)*step(x_22,e2),max(mix(v2,v3,a2)*step(e2,x_22)*step(x_22,e3),max(mix(v3,v4,a3)*step(e3,x_22)*step(x_22,e4),max(mix(v4,v5,a4)*step(e4,x_22)*step(x_22,e5),max(mix(v5,v6,a5)*step(e5,x_22)*step(x_22,e6),max(mix(v6,v7,a6)*step(e6,x_22)*step(x_22,e7),mix(v7,v8,a7)*step(e7,x_22)*step(x_22,e8))))))));}vec4 inferno(float x_30){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);const float e3=0.38;const vec4 v3=vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);const float e4=0.5;const vec4 v4=vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);const float e5=0.63;const vec4 v5=vec4(0.8901960784313725,0.34901960784313724,0.2,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,1,0.6431372549019608,1);float a0=smoothstep(e0,e1,x_30);float a1=smoothstep(e1,e2,x_30);float a2=smoothstep(e2,e3,x_30);float a3=smoothstep(e3,e4,x_30);float a4=smoothstep(e4,e5,x_30);float a5=smoothstep(e5,e6,x_30);float a6=smoothstep(e6,e7,x_30);float a7=smoothstep(e7,e8,x_30);return max(mix(v0,v1,a0)*step(e0,x_30)*step(x_30,e1),max(mix(v1,v2,a1)*step(e1,x_30)*step(x_30,e2),max(mix(v2,v3,a2)*step(e2,x_30)*step(x_30,e3),max(mix(v3,v4,a3)*step(e3,x_30)*step(x_30,e4),max(mix(v4,v5,a4)*step(e4,x_30)*step(x_30,e5),max(mix(v5,v6,a5)*step(e5,x_30)*step(x_30,e6),max(mix(v6,v7,a6)*step(e6,x_30)*step(x_30,e7),mix(v7,v8,a7)*step(e7,x_30)*step(x_30,e8))))))));}vec4 magma(float x_33){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);const float e2=0.25;const vec4 v2=vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);const float e4=0.5;const vec4 v4=vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);const float e6=0.75;const vec4 v6=vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);float a0=smoothstep(e0,e1,x_33);float a1=smoothstep(e1,e2,x_33);float a2=smoothstep(e2,e3,x_33);float a3=smoothstep(e3,e4,x_33);float a4=smoothstep(e4,e5,x_33);float a5=smoothstep(e5,e6,x_33);float a6=smoothstep(e6,e7,x_33);float a7=smoothstep(e7,e8,x_33);return max(mix(v0,v1,a0)*step(e0,x_33)*step(x_33,e1),max(mix(v1,v2,a1)*step(e1,x_33)*step(x_33,e2),max(mix(v2,v3,a2)*step(e2,x_33)*step(x_33,e3),max(mix(v3,v4,a3)*step(e3,x_33)*step(x_33,e4),max(mix(v4,v5,a4)*step(e4,x_33)*step(x_33,e5),max(mix(v5,v6,a5)*step(e5,x_33)*step(x_33,e6),max(mix(v6,v7,a6)*step(e6,x_33)*step(x_33,e7),mix(v7,v8,a7)*step(e7,x_33)*step(x_33,e8))))))));}vec4 plasma(float x_3){const float e0=0.0;const vec4 v0=vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);const float e1=0.13;const vec4 v1=vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);const float e2=0.25;const vec4 v2=vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);const float e4=0.5;const vec4 v4=vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);const float e6=0.75;const vec4 v6=vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);const float e7=0.88;const vec4 v7=vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);float a0=smoothstep(e0,e1,x_3);float a1=smoothstep(e1,e2,x_3);float a2=smoothstep(e2,e3,x_3);float a3=smoothstep(e3,e4,x_3);float a4=smoothstep(e4,e5,x_3);float a5=smoothstep(e5,e6,x_3);float a6=smoothstep(e6,e7,x_3);float a7=smoothstep(e7,e8,x_3);return max(mix(v0,v1,a0)*step(e0,x_3)*step(x_3,e1),max(mix(v1,v2,a1)*step(e1,x_3)*step(x_3,e2),max(mix(v2,v3,a2)*step(e2,x_3)*step(x_3,e3),max(mix(v3,v4,a3)*step(e3,x_3)*step(x_3,e4),max(mix(v4,v5,a4)*step(e4,x_3)*step(x_3,e5),max(mix(v5,v6,a5)*step(e5,x_3)*step(x_3,e6),max(mix(v6,v7,a6)*step(e6,x_3)*step(x_3,e7),mix(v7,v8,a7)*step(e7,x_3)*step(x_3,e8))))))));}vec4 warm(float x_43){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.6745098039215687,0,0.7333333333333333,1);const float e2=0.25;const vec4 v2=vec4(0.8588235294117647,0,0.6666666666666666,1);const float e3=0.38;const vec4 v3=vec4(1,0,0.5098039215686274,1);const float e4=0.5;const vec4 v4=vec4(1,0.24705882352941178,0.2901960784313726,1);const float e5=0.63;const vec4 v5=vec4(1,0.4823529411764706,0,1);const float e6=0.75;const vec4 v6=vec4(0.9176470588235294,0.6901960784313725,0,1);const float e7=0.88;const vec4 v7=vec4(0.7450980392156863,0.8941176470588236,0,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_43);float a1=smoothstep(e1,e2,x_43);float a2=smoothstep(e2,e3,x_43);float a3=smoothstep(e3,e4,x_43);float a4=smoothstep(e4,e5,x_43);float a5=smoothstep(e5,e6,x_43);float a6=smoothstep(e6,e7,x_43);float a7=smoothstep(e7,e8,x_43);return max(mix(v0,v1,a0)*step(e0,x_43)*step(x_43,e1),max(mix(v1,v2,a1)*step(e1,x_43)*step(x_43,e2),max(mix(v2,v3,a2)*step(e2,x_43)*step(x_43,e3),max(mix(v3,v4,a3)*step(e3,x_43)*step(x_43,e4),max(mix(v4,v5,a4)*step(e4,x_43)*step(x_43,e5),max(mix(v5,v6,a5)*step(e5,x_43)*step(x_43,e6),max(mix(v6,v7,a6)*step(e6,x_43)*step(x_43,e7),mix(v7,v8,a7)*step(e7,x_43)*step(x_43,e8))))))));}vec4 rainbow_soft_1310269270(float x_14){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.1;const vec4 v1=vec4(0.7803921568627451,0,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(1,0,0.4745098039215686,1);const float e3=0.3;const vec4 v3=vec4(1,0.4235294117647059,0,1);const float e4=0.4;const vec4 v4=vec4(0.8705882352941177,0.7607843137254902,0,1);const float e5=0.5;const vec4 v5=vec4(0.5882352941176471,1,0,1);const float e6=0.6;const vec4 v6=vec4(0,1,0.21568627450980393,1);const float e7=0.7;const vec4 v7=vec4(0,0.9647058823529412,0.5882352941176471,1);const float e8=0.8;const vec4 v8=vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);const float e9=0.9;const vec4 v9=vec4(0.403921568627451,0.2,0.9215686274509803,1);const float e10=1.0;const vec4 v10=vec4(0.48627450980392156,0,0.7294117647058823,1);float a0=smoothstep(e0,e1,x_14);float a1=smoothstep(e1,e2,x_14);float a2=smoothstep(e2,e3,x_14);float a3=smoothstep(e3,e4,x_14);float a4=smoothstep(e4,e5,x_14);float a5=smoothstep(e5,e6,x_14);float a6=smoothstep(e6,e7,x_14);float a7=smoothstep(e7,e8,x_14);float a8=smoothstep(e8,e9,x_14);float a9=smoothstep(e9,e10,x_14);return max(mix(v0,v1,a0)*step(e0,x_14)*step(x_14,e1),max(mix(v1,v2,a1)*step(e1,x_14)*step(x_14,e2),max(mix(v2,v3,a2)*step(e2,x_14)*step(x_14,e3),max(mix(v3,v4,a3)*step(e3,x_14)*step(x_14,e4),max(mix(v4,v5,a4)*step(e4,x_14)*step(x_14,e5),max(mix(v5,v6,a5)*step(e5,x_14)*step(x_14,e6),max(mix(v6,v7,a6)*step(e6,x_14)*step(x_14,e7),max(mix(v7,v8,a7)*step(e7,x_14)*step(x_14,e8),max(mix(v8,v9,a8)*step(e8,x_14)*step(x_14,e9),mix(v9,v10,a9)*step(e9,x_14)*step(x_14,e10))))))))));}vec4 bathymetry(float x_36){const float e0=0.0;const vec4 v0=vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);const float e1=0.13;const vec4 v1=vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);const float e2=0.25;const vec4 v2=vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);const float e4=0.5;const vec4 v4=vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);const float e5=0.63;const vec4 v5=vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.996078431372549,0.8,1);float a0=smoothstep(e0,e1,x_36);float a1=smoothstep(e1,e2,x_36);float a2=smoothstep(e2,e3,x_36);float a3=smoothstep(e3,e4,x_36);float a4=smoothstep(e4,e5,x_36);float a5=smoothstep(e5,e6,x_36);float a6=smoothstep(e6,e7,x_36);float a7=smoothstep(e7,e8,x_36);return max(mix(v0,v1,a0)*step(e0,x_36)*step(x_36,e1),max(mix(v1,v2,a1)*step(e1,x_36)*step(x_36,e2),max(mix(v2,v3,a2)*step(e2,x_36)*step(x_36,e3),max(mix(v3,v4,a3)*step(e3,x_36)*step(x_36,e4),max(mix(v4,v5,a4)*step(e4,x_36)*step(x_36,e5),max(mix(v5,v6,a5)*step(e5,x_36)*step(x_36,e6),max(mix(v6,v7,a6)*step(e6,x_36)*step(x_36,e7),mix(v7,v8,a7)*step(e7,x_36)*step(x_36,e8))))))));}vec4 cdom(float x_7){const float e0=0.0;const vec4 v0=vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);const float e1=0.13;const vec4 v1=vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);const float e2=0.25;const vec4 v2=vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);const float e3=0.38;const vec4 v3=vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);const float e5=0.63;const vec4 v5=vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);const float e6=0.75;const vec4 v6=vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);float a0=smoothstep(e0,e1,x_7);float a1=smoothstep(e1,e2,x_7);float a2=smoothstep(e2,e3,x_7);float a3=smoothstep(e3,e4,x_7);float a4=smoothstep(e4,e5,x_7);float a5=smoothstep(e5,e6,x_7);float a6=smoothstep(e6,e7,x_7);float a7=smoothstep(e7,e8,x_7);return max(mix(v0,v1,a0)*step(e0,x_7)*step(x_7,e1),max(mix(v1,v2,a1)*step(e1,x_7)*step(x_7,e2),max(mix(v2,v3,a2)*step(e2,x_7)*step(x_7,e3),max(mix(v3,v4,a3)*step(e3,x_7)*step(x_7,e4),max(mix(v4,v5,a4)*step(e4,x_7)*step(x_7,e5),max(mix(v5,v6,a5)*step(e5,x_7)*step(x_7,e6),max(mix(v6,v7,a6)*step(e6,x_7)*step(x_7,e7),mix(v7,v8,a7)*step(e7,x_7)*step(x_7,e8))))))));}vec4 chlorophyll(float x_6){const float e0=0.0;const vec4 v0=vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);const float e1=0.13;const vec4 v1=vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);const float e3=0.38;const vec4 v3=vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);const float e4=0.5;const vec4 v4=vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);const float e5=0.63;const vec4 v5=vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);const float e6=0.75;const vec4 v6=vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);const float e7=0.88;const vec4 v7=vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);const float e8=1.0;const vec4 v8=vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);float a0=smoothstep(e0,e1,x_6);float a1=smoothstep(e1,e2,x_6);float a2=smoothstep(e2,e3,x_6);float a3=smoothstep(e3,e4,x_6);float a4=smoothstep(e4,e5,x_6);float a5=smoothstep(e5,e6,x_6);float a6=smoothstep(e6,e7,x_6);float a7=smoothstep(e7,e8,x_6);return max(mix(v0,v1,a0)*step(e0,x_6)*step(x_6,e1),max(mix(v1,v2,a1)*step(e1,x_6)*step(x_6,e2),max(mix(v2,v3,a2)*step(e2,x_6)*step(x_6,e3),max(mix(v3,v4,a3)*step(e3,x_6)*step(x_6,e4),max(mix(v4,v5,a4)*step(e4,x_6)*step(x_6,e5),max(mix(v5,v6,a5)*step(e5,x_6)*step(x_6,e6),max(mix(v6,v7,a6)*step(e6,x_6)*step(x_6,e7),mix(v7,v8,a7)*step(e7,x_6)*step(x_6,e8))))))));}vec4 density(float x_19){const float e0=0.0;const vec4 v0=vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);const float e2=0.25;const vec4 v2=vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);const float e3=0.38;const vec4 v3=vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);const float e4=0.5;const vec4 v4=vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);const float e5=0.63;const vec4 v5=vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);const float e6=0.75;const vec4 v6=vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);const float e7=0.88;const vec4 v7=vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);const float e8=1.0;const vec4 v8=vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);float a0=smoothstep(e0,e1,x_19);float a1=smoothstep(e1,e2,x_19);float a2=smoothstep(e2,e3,x_19);float a3=smoothstep(e3,e4,x_19);float a4=smoothstep(e4,e5,x_19);float a5=smoothstep(e5,e6,x_19);float a6=smoothstep(e6,e7,x_19);float a7=smoothstep(e7,e8,x_19);return max(mix(v0,v1,a0)*step(e0,x_19)*step(x_19,e1),max(mix(v1,v2,a1)*step(e1,x_19)*step(x_19,e2),max(mix(v2,v3,a2)*step(e2,x_19)*step(x_19,e3),max(mix(v3,v4,a3)*step(e3,x_19)*step(x_19,e4),max(mix(v4,v5,a4)*step(e4,x_19)*step(x_19,e5),max(mix(v5,v6,a5)*step(e5,x_19)*step(x_19,e6),max(mix(v6,v7,a6)*step(e6,x_19)*step(x_19,e7),mix(v7,v8,a7)*step(e7,x_19)*step(x_19,e8))))))));}vec4 freesurface_blue_3154355989(float x_35){const float e0=0.0;const vec4 v0=vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);const float e1=0.13;const vec4 v1=vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);const float e3=0.38;const vec4 v3=vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);const float e4=0.5;const vec4 v4=vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);const float e5=0.63;const vec4 v5=vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);const float e6=0.75;const vec4 v6=vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);const float e7=0.88;const vec4 v7=vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_35);float a1=smoothstep(e1,e2,x_35);float a2=smoothstep(e2,e3,x_35);float a3=smoothstep(e3,e4,x_35);float a4=smoothstep(e4,e5,x_35);float a5=smoothstep(e5,e6,x_35);float a6=smoothstep(e6,e7,x_35);float a7=smoothstep(e7,e8,x_35);return max(mix(v0,v1,a0)*step(e0,x_35)*step(x_35,e1),max(mix(v1,v2,a1)*step(e1,x_35)*step(x_35,e2),max(mix(v2,v3,a2)*step(e2,x_35)*step(x_35,e3),max(mix(v3,v4,a3)*step(e3,x_35)*step(x_35,e4),max(mix(v4,v5,a4)*step(e4,x_35)*step(x_35,e5),max(mix(v5,v6,a5)*step(e5,x_35)*step(x_35,e6),max(mix(v6,v7,a6)*step(e6,x_35)*step(x_35,e7),mix(v7,v8,a7)*step(e7,x_35)*step(x_35,e8))))))));}vec4 freesurface_red_1679163293(float x_20){const float e0=0.0;const vec4 v0=vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);const float e2=0.25;const vec4 v2=vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);const float e3=0.38;const vec4 v3=vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);const float e4=0.5;const vec4 v4=vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);const float e5=0.63;const vec4 v5=vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);const float e6=0.75;const vec4 v6=vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_20);float a1=smoothstep(e1,e2,x_20);float a2=smoothstep(e2,e3,x_20);float a3=smoothstep(e3,e4,x_20);float a4=smoothstep(e4,e5,x_20);float a5=smoothstep(e5,e6,x_20);float a6=smoothstep(e6,e7,x_20);float a7=smoothstep(e7,e8,x_20);return max(mix(v0,v1,a0)*step(e0,x_20)*step(x_20,e1),max(mix(v1,v2,a1)*step(e1,x_20)*step(x_20,e2),max(mix(v2,v3,a2)*step(e2,x_20)*step(x_20,e3),max(mix(v3,v4,a3)*step(e3,x_20)*step(x_20,e4),max(mix(v4,v5,a4)*step(e4,x_20)*step(x_20,e5),max(mix(v5,v6,a5)*step(e5,x_20)*step(x_20,e6),max(mix(v6,v7,a6)*step(e6,x_20)*step(x_20,e7),mix(v7,v8,a7)*step(e7,x_20)*step(x_20,e8))))))));}vec4 oxygen(float x_11){const float e0=0.0;const vec4 v0=vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);const float e1=0.13;const vec4 v1=vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);const float e2=0.25;const vec4 v2=vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);const float e5=0.63;const vec4 v5=vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);const float e6=0.75;const vec4 v6=vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);const float e8=1.0;const vec4 v8=vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);float a0=smoothstep(e0,e1,x_11);float a1=smoothstep(e1,e2,x_11);float a2=smoothstep(e2,e3,x_11);float a3=smoothstep(e3,e4,x_11);float a4=smoothstep(e4,e5,x_11);float a5=smoothstep(e5,e6,x_11);float a6=smoothstep(e6,e7,x_11);float a7=smoothstep(e7,e8,x_11);return max(mix(v0,v1,a0)*step(e0,x_11)*step(x_11,e1),max(mix(v1,v2,a1)*step(e1,x_11)*step(x_11,e2),max(mix(v2,v3,a2)*step(e2,x_11)*step(x_11,e3),max(mix(v3,v4,a3)*step(e3,x_11)*step(x_11,e4),max(mix(v4,v5,a4)*step(e4,x_11)*step(x_11,e5),max(mix(v5,v6,a5)*step(e5,x_11)*step(x_11,e6),max(mix(v6,v7,a6)*step(e6,x_11)*step(x_11,e7),mix(v7,v8,a7)*step(e7,x_11)*step(x_11,e8))))))));}vec4 par(float x_28){const float e0=0.0;const vec4 v0=vec4(0.2,0.0784313725490196,0.09411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);const float e2=0.25;const vec4 v2=vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);const float e3=0.38;const vec4 v3=vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);const float e4=0.5;const vec4 v4=vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);const float e5=0.63;const vec4 v5=vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);const float e6=0.75;const vec4 v6=vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);const float e7=0.88;const vec4 v7=vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);const float e8=1.0;const vec4 v8=vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);float a0=smoothstep(e0,e1,x_28);float a1=smoothstep(e1,e2,x_28);float a2=smoothstep(e2,e3,x_28);float a3=smoothstep(e3,e4,x_28);float a4=smoothstep(e4,e5,x_28);float a5=smoothstep(e5,e6,x_28);float a6=smoothstep(e6,e7,x_28);float a7=smoothstep(e7,e8,x_28);return max(mix(v0,v1,a0)*step(e0,x_28)*step(x_28,e1),max(mix(v1,v2,a1)*step(e1,x_28)*step(x_28,e2),max(mix(v2,v3,a2)*step(e2,x_28)*step(x_28,e3),max(mix(v3,v4,a3)*step(e3,x_28)*step(x_28,e4),max(mix(v4,v5,a4)*step(e4,x_28)*step(x_28,e5),max(mix(v5,v6,a5)*step(e5,x_28)*step(x_28,e6),max(mix(v6,v7,a6)*step(e6,x_28)*step(x_28,e7),mix(v7,v8,a7)*step(e7,x_28)*step(x_28,e8))))))));}vec4 phase(float x_39){const float e0=0.0;const vec4 v0=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);const float e3=0.38;const vec4 v3=vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);const float e4=0.5;const vec4 v4=vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);const float e5=0.63;const vec4 v5=vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);const float e6=0.75;const vec4 v6=vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);const float e7=0.88;const vec4 v7=vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);const float e8=1.0;const vec4 v8=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);float a0=smoothstep(e0,e1,x_39);float a1=smoothstep(e1,e2,x_39);float a2=smoothstep(e2,e3,x_39);float a3=smoothstep(e3,e4,x_39);float a4=smoothstep(e4,e5,x_39);float a5=smoothstep(e5,e6,x_39);float a6=smoothstep(e6,e7,x_39);float a7=smoothstep(e7,e8,x_39);return max(mix(v0,v1,a0)*step(e0,x_39)*step(x_39,e1),max(mix(v1,v2,a1)*step(e1,x_39)*step(x_39,e2),max(mix(v2,v3,a2)*step(e2,x_39)*step(x_39,e3),max(mix(v3,v4,a3)*step(e3,x_39)*step(x_39,e4),max(mix(v4,v5,a4)*step(e4,x_39)*step(x_39,e5),max(mix(v5,v6,a5)*step(e5,x_39)*step(x_39,e6),max(mix(v6,v7,a6)*step(e6,x_39)*step(x_39,e7),mix(v7,v8,a7)*step(e7,x_39)*step(x_39,e8))))))));}vec4 salinity(float x_26){const float e0=0.0;const vec4 v0=vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);const float e1=0.13;const vec4 v1=vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);const float e2=0.25;const vec4 v2=vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);const float e3=0.38;const vec4 v3=vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);const float e4=0.5;const vec4 v4=vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);const float e5=0.63;const vec4 v5=vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);const float e7=0.88;const vec4 v7=vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);float a0=smoothstep(e0,e1,x_26);float a1=smoothstep(e1,e2,x_26);float a2=smoothstep(e2,e3,x_26);float a3=smoothstep(e3,e4,x_26);float a4=smoothstep(e4,e5,x_26);float a5=smoothstep(e5,e6,x_26);float a6=smoothstep(e6,e7,x_26);float a7=smoothstep(e7,e8,x_26);return max(mix(v0,v1,a0)*step(e0,x_26)*step(x_26,e1),max(mix(v1,v2,a1)*step(e1,x_26)*step(x_26,e2),max(mix(v2,v3,a2)*step(e2,x_26)*step(x_26,e3),max(mix(v3,v4,a3)*step(e3,x_26)*step(x_26,e4),max(mix(v4,v5,a4)*step(e4,x_26)*step(x_26,e5),max(mix(v5,v6,a5)*step(e5,x_26)*step(x_26,e6),max(mix(v6,v7,a6)*step(e6,x_26)*step(x_26,e7),mix(v7,v8,a7)*step(e7,x_26)*step(x_26,e8))))))));}vec4 temperature(float x_8){const float e0=0.0;const vec4 v0=vec4(0.01568627450980392,0.13725490196078433,0.2,1);const float e1=0.13;const vec4 v1=vec4(0.09019607843137255,0.2,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);const float e4=0.5;const vec4 v4=vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);const float e5=0.63;const vec4 v5=vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);const float e8=1.0;const vec4 v8=vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);float a0=smoothstep(e0,e1,x_8);float a1=smoothstep(e1,e2,x_8);float a2=smoothstep(e2,e3,x_8);float a3=smoothstep(e3,e4,x_8);float a4=smoothstep(e4,e5,x_8);float a5=smoothstep(e5,e6,x_8);float a6=smoothstep(e6,e7,x_8);float a7=smoothstep(e7,e8,x_8);return max(mix(v0,v1,a0)*step(e0,x_8)*step(x_8,e1),max(mix(v1,v2,a1)*step(e1,x_8)*step(x_8,e2),max(mix(v2,v3,a2)*step(e2,x_8)*step(x_8,e3),max(mix(v3,v4,a3)*step(e3,x_8)*step(x_8,e4),max(mix(v4,v5,a4)*step(e4,x_8)*step(x_8,e5),max(mix(v5,v6,a5)*step(e5,x_8)*step(x_8,e6),max(mix(v6,v7,a6)*step(e6,x_8)*step(x_8,e7),mix(v7,v8,a7)*step(e7,x_8)*step(x_8,e8))))))));}vec4 turbidity(float x_40){const float e0=0.0;const vec4 v0=vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);const float e1=0.13;const vec4 v1=vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);const float e3=0.38;const vec4 v3=vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);const float e4=0.5;const vec4 v4=vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);const float e5=0.63;const vec4 v5=vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);const float e6=0.75;const vec4 v6=vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);const float e8=1.0;const vec4 v8=vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);float a0=smoothstep(e0,e1,x_40);float a1=smoothstep(e1,e2,x_40);float a2=smoothstep(e2,e3,x_40);float a3=smoothstep(e3,e4,x_40);float a4=smoothstep(e4,e5,x_40);float a5=smoothstep(e5,e6,x_40);float a6=smoothstep(e6,e7,x_40);float a7=smoothstep(e7,e8,x_40);return max(mix(v0,v1,a0)*step(e0,x_40)*step(x_40,e1),max(mix(v1,v2,a1)*step(e1,x_40)*step(x_40,e2),max(mix(v2,v3,a2)*step(e2,x_40)*step(x_40,e3),max(mix(v3,v4,a3)*step(e3,x_40)*step(x_40,e4),max(mix(v4,v5,a4)*step(e4,x_40)*step(x_40,e5),max(mix(v5,v6,a5)*step(e5,x_40)*step(x_40,e6),max(mix(v6,v7,a6)*step(e6,x_40)*step(x_40,e7),mix(v7,v8,a7)*step(e7,x_40)*step(x_40,e8))))))));}vec4 velocity_blue_297387650(float x_2){const float e0=0.0;const vec4 v0=vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);const float e1=0.13;const vec4 v1=vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);const float e3=0.38;const vec4 v3=vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);const float e4=0.5;const vec4 v4=vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);const float e5=0.63;const vec4 v5=vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);const float e6=0.75;const vec4 v6=vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);const float e7=0.88;const vec4 v7=vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);float a0=smoothstep(e0,e1,x_2);float a1=smoothstep(e1,e2,x_2);float a2=smoothstep(e2,e3,x_2);float a3=smoothstep(e3,e4,x_2);float a4=smoothstep(e4,e5,x_2);float a5=smoothstep(e5,e6,x_2);float a6=smoothstep(e6,e7,x_2);float a7=smoothstep(e7,e8,x_2);return max(mix(v0,v1,a0)*step(e0,x_2)*step(x_2,e1),max(mix(v1,v2,a1)*step(e1,x_2)*step(x_2,e2),max(mix(v2,v3,a2)*step(e2,x_2)*step(x_2,e3),max(mix(v3,v4,a3)*step(e3,x_2)*step(x_2,e4),max(mix(v4,v5,a4)*step(e4,x_2)*step(x_2,e5),max(mix(v5,v6,a5)*step(e5,x_2)*step(x_2,e6),max(mix(v6,v7,a6)*step(e6,x_2)*step(x_2,e7),mix(v7,v8,a7)*step(e7,x_2)*step(x_2,e8))))))));}vec4 velocity_green_2558432129(float x_27){const float e0=0.0;const vec4 v0=vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);const float e1=0.13;const vec4 v1=vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);const float e3=0.38;const vec4 v3=vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);const float e4=0.5;const vec4 v4=vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);const float e5=0.63;const vec4 v5=vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);const float e6=0.75;const vec4 v6=vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);const float e7=0.88;const vec4 v7=vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);const float e8=1.0;const vec4 v8=vec4(1,0.9921568627450981,0.803921568627451,1);float a0=smoothstep(e0,e1,x_27);float a1=smoothstep(e1,e2,x_27);float a2=smoothstep(e2,e3,x_27);float a3=smoothstep(e3,e4,x_27);float a4=smoothstep(e4,e5,x_27);float a5=smoothstep(e5,e6,x_27);float a6=smoothstep(e6,e7,x_27);float a7=smoothstep(e7,e8,x_27);return max(mix(v0,v1,a0)*step(e0,x_27)*step(x_27,e1),max(mix(v1,v2,a1)*step(e1,x_27)*step(x_27,e2),max(mix(v2,v3,a2)*step(e2,x_27)*step(x_27,e3),max(mix(v3,v4,a3)*step(e3,x_27)*step(x_27,e4),max(mix(v4,v5,a4)*step(e4,x_27)*step(x_27,e5),max(mix(v5,v6,a5)*step(e5,x_27)*step(x_27,e6),max(mix(v6,v7,a6)*step(e6,x_27)*step(x_27,e7),mix(v7,v8,a7)*step(e7,x_27)*step(x_27,e8))))))));}vec4 cubehelix(float x_37){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.07;const vec4 v1=vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);const float e2=0.13;const vec4 v2=vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);const float e3=0.2;const vec4 v3=vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);const float e4=0.27;const vec4 v4=vec4(0.6313725490196078,0,0.5764705882352941,1);const float e5=0.33;const vec4 v5=vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);const float e6=0.4;const vec4 v6=vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);const float e7=0.47;const vec4 v7=vec4(1,0.11372549019607843,0.3803921568627451,1);const float e8=0.53;const vec4 v8=vec4(1,0.21176470588235294,0.27058823529411763,1);const float e9=0.6;const vec4 v9=vec4(1,0.3333333333333333,0.1803921568627451,1);const float e10=0.67;const vec4 v10=vec4(1,0.47058823529411764,0.13333333333333333,1);const float e11=0.73;const vec4 v11=vec4(1,0.615686274509804,0.1450980392156863,1);const float e12=0.8;const vec4 v12=vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);const float e13=0.87;const vec4 v13=vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);const float e14=0.93;const vec4 v14=vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);const float e15=1.0;const vec4 v15=vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);float a0=smoothstep(e0,e1,x_37);float a1=smoothstep(e1,e2,x_37);float a2=smoothstep(e2,e3,x_37);float a3=smoothstep(e3,e4,x_37);float a4=smoothstep(e4,e5,x_37);float a5=smoothstep(e5,e6,x_37);float a6=smoothstep(e6,e7,x_37);float a7=smoothstep(e7,e8,x_37);float a8=smoothstep(e8,e9,x_37);float a9=smoothstep(e9,e10,x_37);float a10=smoothstep(e10,e11,x_37);float a11=smoothstep(e11,e12,x_37);float a12=smoothstep(e12,e13,x_37);float a13=smoothstep(e13,e14,x_37);float a14=smoothstep(e14,e15,x_37);return max(mix(v0,v1,a0)*step(e0,x_37)*step(x_37,e1),max(mix(v1,v2,a1)*step(e1,x_37)*step(x_37,e2),max(mix(v2,v3,a2)*step(e2,x_37)*step(x_37,e3),max(mix(v3,v4,a3)*step(e3,x_37)*step(x_37,e4),max(mix(v4,v5,a4)*step(e4,x_37)*step(x_37,e5),max(mix(v5,v6,a5)*step(e5,x_37)*step(x_37,e6),max(mix(v6,v7,a6)*step(e6,x_37)*step(x_37,e7),max(mix(v7,v8,a7)*step(e7,x_37)*step(x_37,e8),max(mix(v8,v9,a8)*step(e8,x_37)*step(x_37,e9),max(mix(v9,v10,a9)*step(e9,x_37)*step(x_37,e10),max(mix(v10,v11,a10)*step(e10,x_37)*step(x_37,e11),max(mix(v11,v12,a11)*step(e11,x_37)*step(x_37,e12),max(mix(v12,v13,a12)*step(e12,x_37)*step(x_37,e13),max(mix(v13,v14,a13)*step(e13,x_37)*step(x_37,e14),mix(v14,v15,a14)*step(e14,x_37)*step(x_37,e15)))))))))))))));}float sample_and_apply_contrast_limits(SAMPLER_TYPE channel,vec2 vTexCoord,vec2 contrastLimits){float fragIntensity=float(texture(channel,vTexCoord).r);float contrastLimitsAppliedToIntensity=(fragIntensity-contrastLimits[0])/max(0.0005,(contrastLimits[1]-contrastLimits[0]));return max(0.,contrastLimitsAppliedToIntensity);}vec3 process_channel_intensity(float intensity,vec3 colors,int channelIndex,bool inLensAndUseLens,int lensSelection){float useColorValue=float(int((inLensAndUseLens&&channelIndex==lensSelection)||(!inLensAndUseLens)));vec3 rgb=max(0.,min(1.,intensity))*max(vec3(colors),(1.-useColorValue)*vec3(1.,1.,1.));return rgb;}vec4 apply_opacity(vec3 color,bool useTransparentColor,vec3 transparentColor,float opacity){return vec4(color,(color==transparentColor&&useTransparentColor)? 0. : opacity);}vec4 colormap(float intensity,float opacity,bool useTransparentColor){return apply_opacity(COLORMAP_FUNCTION(min(1.,intensity)).xyz,useTransparentColor,COLORMAP_FUNCTION(0.).xyz,opacity);}\"; // eslint-disable-line\n\nvar channels$1 = {\n  name: 'channel-intensity-module',\n  defines: {\n    SAMPLER_TYPE: 'usampler2D',\n    COLORMAP_FUNCTION: ''\n  },\n  fs: fs$3\n};\n\nvar fs$2 = \"#define GLSLIFY 1\\nbool frag_in_lens_bounds(vec2 lensCenter,vec2 vTexCoord,float majorLensAxis,float minorLensAxis,float lensBorderRadius){return pow((lensCenter.x-vTexCoord.x)/majorLensAxis,2.)+pow((lensCenter.y-vTexCoord.y)/minorLensAxis,2.)<(1.-lensBorderRadius);}bool frag_on_lens_bounds(vec2 lensCenter,vec2 vTexCoord,float majorLensAxis,float minorLensAxis,float lensBorderRadius){float ellipseDistance=pow((lensCenter.x-vTexCoord.x)/majorLensAxis,2.)+pow((lensCenter.y-vTexCoord.y)/minorLensAxis,2.);return ellipseDistance<=1.&&ellipseDistance>=(1.-lensBorderRadius);}\"; // eslint-disable-line\n\nvar lens = {\n  name: 'lens-module',\n  defines: {\n    SAMPLER_TYPE: 'usampler2D'\n  },\n  fs: fs$2\n};\n\nconst MAX_COLOR_INTENSITY = 255;\nconst DEFAULT_COLOR_OFF = [0, 0, 0];\nconst MAX_CHANNELS = 6;\nconst DEFAULT_FONT_FAMILY = \"-apple-system, 'Helvetica Neue', Arial, sans-serif\";\nconst DTYPE_VALUES = {\n  Uint8: {\n    format: GL.R8UI,\n    dataFormat: GL.RED_INTEGER,\n    type: GL.UNSIGNED_BYTE,\n    max: 2 ** 8 - 1,\n    sampler: \"usampler2D\"\n  },\n  Uint16: {\n    format: GL.R16UI,\n    dataFormat: GL.RED_INTEGER,\n    type: GL.UNSIGNED_SHORT,\n    max: 2 ** 16 - 1,\n    sampler: \"usampler2D\"\n  },\n  Uint32: {\n    format: GL.R32UI,\n    dataFormat: GL.RED_INTEGER,\n    type: GL.UNSIGNED_INT,\n    max: 2 ** 32 - 1,\n    sampler: \"usampler2D\"\n  },\n  Float32: {\n    format: GL.R32F,\n    dataFormat: GL.RED,\n    type: GL.FLOAT,\n    max: 3.4 * 10 ** 38,\n    sampler: \"sampler2D\"\n  },\n  Int8: {\n    format: GL.R8I,\n    dataFormat: GL.RED_INTEGER,\n    type: GL.BYTE,\n    max: 2 ** (8 - 1) - 1,\n    sampler: \"isampler2D\"\n  },\n  Int16: {\n    format: GL.R16I,\n    dataFormat: GL.RED_INTEGER,\n    type: GL.SHORT,\n    max: 2 ** (16 - 1) - 1,\n    sampler: \"isampler2D\"\n  },\n  Int32: {\n    format: GL.R32I,\n    dataFormat: GL.RED_INTEGER,\n    type: GL.INT,\n    max: 2 ** (32 - 1) - 1,\n    sampler: \"isampler2D\"\n  },\n  Float64: {\n    format: GL.R32F,\n    dataFormat: GL.RED,\n    type: GL.FLOAT,\n    max: 3.4 * 10 ** 38,\n    sampler: \"sampler2D\",\n    cast: (data) => new Float32Array(data)\n  }\n};\nconst COLORMAPS = [\n  \"jet\",\n  \"hsv\",\n  \"hot\",\n  \"cool\",\n  \"spring\",\n  \"summer\",\n  \"autumn\",\n  \"winter\",\n  \"bone\",\n  \"copper\",\n  \"greys\",\n  \"yignbu\",\n  \"greens\",\n  \"yiorrd\",\n  \"bluered\",\n  \"rdbu\",\n  \"picnic\",\n  \"rainbow\",\n  \"portland\",\n  \"blackbody\",\n  \"earth\",\n  \"electric\",\n  \"alpha\",\n  \"viridis\",\n  \"inferno\",\n  \"magma\",\n  \"plasma\",\n  \"warm\",\n  \"rainbow-soft\",\n  \"bathymetry\",\n  \"cdom\",\n  \"chlorophyll\",\n  \"density\",\n  \"freesurface-blue\",\n  \"freesurface-red\",\n  \"oxygen\",\n  \"par\",\n  \"phase\",\n  \"salinity\",\n  \"temperature\",\n  \"turbidity\",\n  \"velocity-blue\",\n  \"velocity-green\",\n  \"cubehelix\"\n];\nvar RENDERING_MODES;\n(function(RENDERING_MODES2) {\n  RENDERING_MODES2[\"MAX_INTENSITY_PROJECTION\"] = \"Maximum Intensity Projection\";\n  RENDERING_MODES2[\"MIN_INTENSITY_PROJECTION\"] = \"Minimum Intensity Projection\";\n  RENDERING_MODES2[\"ADDITIVE\"] = \"Additive\";\n})(RENDERING_MODES || (RENDERING_MODES = {}));\nconst GLOBAL_SLIDER_DIMENSION_FIELDS = [\"z\", \"t\"];\n\nfunction range(len) {\n  return [...Array(len).keys()];\n}\n\nfunction padWithDefault(arr, defaultValue, padWidth) {\n  for (let i = 0; i < padWidth; i += 1) {\n    arr.push(defaultValue);\n  }\n  return arr;\n}\n\n/**\n * (Safely) get GL values for associated dtype.\n * @param {keyof typeof import('../constants').DTYPE_VALUES} dtype\n */\nfunction getDtypeValues(dtype) {\n  const values = DTYPE_VALUES[dtype];\n  if (!values) {\n    const valid = Object.keys(DTYPE_VALUES);\n    throw Error(`Dtype not supported, got ${dtype}. Must be one of ${valid}.`);\n  }\n  return values;\n}\n\nfunction padColorsAndWindows({\n  contrastLimits,\n  colors,\n  channelsVisible,\n  domain,\n  dtype\n}) {\n  const lengths = [contrastLimits.length, colors.length];\n  if (lengths.every(l => l !== lengths[0])) {\n    throw Error('Inconsistent number of slider values and colors provided');\n  }\n\n  const newColors = colors.map((color, i) =>\n    channelsVisible[i]\n      ? color.map(c => c / MAX_COLOR_INTENSITY)\n      : DEFAULT_COLOR_OFF\n  );\n  const maxSliderValue = (domain && domain[1]) || getDtypeValues(dtype).max;\n  const newContrastLimits = contrastLimits.map((slider, i) =>\n    channelsVisible[i] ? slider : [maxSliderValue, maxSliderValue]\n  );\n  // Need to pad contrastLimits and colors with default values (required by shader)\n  const padSize = MAX_CHANNELS - newColors.length;\n  if (padSize < 0) {\n    throw Error(`${lengths} channels passed in, but only 6 are allowed.`);\n  }\n\n  const paddedColors = padWithDefault(newColors, DEFAULT_COLOR_OFF, padSize);\n  const paddedContrastLimits = padWithDefault(\n    newContrastLimits,\n    [maxSliderValue, maxSliderValue],\n    padSize\n  );\n  const paddedColorsAndWindows = {\n    paddedContrastLimits: paddedContrastLimits.reduce(\n      (acc, val) => acc.concat(val),\n      []\n    ), // flatten for use on shaders\n    paddedColors: paddedColors.reduce((acc, val) => acc.concat(val), [])\n  };\n\n  return paddedColorsAndWindows;\n}\n\nfunction onPointer(layer) {\n  const { viewportId, lensRadius } = layer.props;\n  // If there is no viewportId, don't try to do anything.\n  if (!viewportId) {\n    layer.setState({ unprojectLensBounds: [0, 0, 0, 0] });\n    return;\n  }\n  const { mousePosition } = layer.context;\n  const layerView = layer.context.deck.viewManager.views.filter(\n    view => view.id === viewportId\n  )[0];\n  const viewState = layer.context.deck.viewManager.viewState[viewportId];\n  const viewport = layerView.makeViewport({\n    ...viewState,\n    viewState\n  });\n  // If the mouse is in the viewport and the mousePosition exists, set\n  // the state with the bounding box of the circle that will render as a lens.\n  if (mousePosition && viewport.containsPixel(mousePosition)) {\n    const offsetMousePosition = {\n      x: mousePosition.x - viewport.x,\n      y: mousePosition.y - viewport.y\n    };\n    const mousePositionBounds = [\n      // left\n      [offsetMousePosition.x - lensRadius, offsetMousePosition.y],\n      // bottom\n      [offsetMousePosition.x, offsetMousePosition.y + lensRadius],\n      // right\n      [offsetMousePosition.x + lensRadius, offsetMousePosition.y],\n      // top\n      [offsetMousePosition.x, offsetMousePosition.y - lensRadius]\n    ];\n    // Unproject from screen to world coordinates.\n    const unprojectLensBounds = mousePositionBounds.map(\n      (bounds, i) => viewport.unproject(bounds)[i % 2]\n    );\n    layer.setState({ unprojectLensBounds });\n  } else {\n    layer.setState({ unprojectLensBounds: [0, 0, 0, 0] });\n  }\n}\n\n/**\n * Get physical size scaling Matrix4\n * @param {Object} loader PixelSource\n */\nfunction getPhysicalSizeScalingMatrix(loader) {\n  const { x, y, z } = loader?.meta?.physicalSizes ?? {};\n  if (x?.size && y?.size && z?.size) {\n    const min = Math.min(z.size, x.size, y.size);\n    const ratio = [x.size / min, y.size / min, z.size / min];\n    return new Matrix4().scale(ratio);\n  }\n  return new Matrix4().identity();\n}\n\n/* eslint-disable prefer-destructuring */\n\nconst SHADER_MODULES = [\n  { fs: fs1, fscmap: fsColormap1, vs: vs1 },\n  { fs: fs2, fscmap: fsColormap2, vs: vs2 }\n];\n\nfunction validateWebGL2Filter(gl, interpolation) {\n  const canShowFloat = hasFeature(gl, FEATURES.TEXTURE_FLOAT);\n  const canShowLinear = hasFeature(gl, FEATURES.TEXTURE_FILTER_LINEAR_FLOAT);\n\n  if (!canShowFloat) {\n    throw new Error(\n      'WebGL1 context does not support floating point textures.  Unable to display raster data.'\n    );\n  }\n\n  if (!canShowLinear && interpolation === GL.LINEAR) {\n    console.warn(\n      'LINEAR filtering not supported in WebGL1 context.  Falling back to NEAREST.'\n    );\n    return GL.NEAREST;\n  }\n\n  return interpolation;\n}\n\nfunction getRenderingAttrs$1(dtype, gl, interpolation) {\n  const isLinear = interpolation === GL.LINEAR;\n  if (!isWebGL2(gl)) {\n    return {\n      format: GL.LUMINANCE,\n      dataFormat: GL.LUMINANCE,\n      type: GL.FLOAT,\n      sampler: 'sampler2D',\n      shaderModule: SHADER_MODULES[0],\n      filter: validateWebGL2Filter(gl, interpolation),\n      cast: data => new Float32Array(data)\n    };\n  }\n  // Linear filtering only works when the data type is cast to Float32.\n  const values = getDtypeValues(isLinear ? 'Float32' : dtype);\n  return {\n    ...values,\n    shaderModule: SHADER_MODULES[1],\n    filter: interpolation,\n    cast: isLinear ? data => new Float32Array(data) : data => data\n  };\n}\n\nconst defaultProps$8 = {\n  pickable: { type: 'boolean', value: true, compare: true },\n  coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n  channelData: { type: 'object', value: {}, compare: true },\n  bounds: { type: 'array', value: [0, 0, 1, 1], compare: true },\n  colors: { type: 'array', value: [], compare: true },\n  contrastLimits: { type: 'array', value: [], compare: true },\n  channelsVisible: { type: 'array', value: [], compare: true },\n  opacity: { type: 'number', value: 1, compare: true },\n  dtype: { type: 'string', value: 'Uint16', compare: true },\n  colormap: { type: 'string', value: '', compare: true },\n  isLensOn: { type: 'boolean', value: false, compare: true },\n  lensSelection: { type: 'number', value: 0, compare: true },\n  lensBorderColor: { type: 'array', value: [255, 255, 255], compare: true },\n  lensBorderRadius: { type: 'number', value: 0.02, compare: true },\n  unprojectLensBounds: { type: 'array', value: [0, 0, 0, 0], compare: true },\n  transparentColor: { type: 'array', value: null, compare: true },\n  interpolation: {\n    type: 'number',\n    value: GL.NEAREST,\n    compare: true\n  }\n};\n\n/**\n * @typedef LayerProps\n * @type {object}\n * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.\n * @property {Array.<Array.<number>>} colors List of [r, g, b] values for each channel.\n * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.\n * @property {string} dtype Dtype for the layer.\n * @property {number=} opacity Opacity of the layer.\n * @property {string=} colormap String indicating a colormap (default: '').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap\n * @property {Array.<number>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').\n * @property {String=} id Unique identifier for this layer.\n * @property {function=} onHover Hook function from deck.gl to handle hover objects.\n * @property {boolean=} isLensOn Whether or not to use the lens.\n * @property {number=} lensSelection Numeric index of the channel to be focused on by the lens.\n * @property {number=} lensRadius Pixel radius of the lens (default: 100).\n * @property {Array.<number>=} lensBorderColor RGB color of the border of the lens (default [255, 255, 255]).\n * @property {number=} lensBorderRadius Percentage of the radius of the lens for a border (default 0.02).\n * @property {function=} onClick Hook function from deck.gl to handle clicked-on objects.\n * @property {Object=} modelMatrix Math.gl Matrix4 object containing an affine transformation to be applied to the image.\n * @property {Array.<number>=} transparentColor An RGB (0-255 range) color to be considered \"transparent\" if provided.\n * In other words, any fragment shader output equal transparentColor (before applying opacity) will have opacity 0.\n * This parameter only needs to be a truthy value when using colormaps because each colormap has its own transparent color that is calculated on the shader.\n * Thus setting this to a truthy value (with a colormap set) indicates that the shader should make that color transparent.\n * @property {number=} interpolation The TEXTURE_MIN_FILTER and TEXTURE_MAG_FILTER for WebGL rendering (see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter) - default is GL.NEAREST\n */\n/**\n * @type {{ new (...props: import('../../types').Viv<LayerProps>[]) }}\n * @ignore\n */\nconst XRLayer = class extends Layer {\n  /**\n   * This function chooses a shader (colormapping or not) and\n   * replaces `usampler` with `sampler` if the data is not an unsigned integer\n   */\n  getShaders() {\n    const { colormap, dtype, interpolation } = this.props;\n    const { shaderModule, sampler } = getRenderingAttrs$1(\n      dtype,\n      this.context.gl,\n      interpolation\n    );\n    return super.getShaders({\n      fs: colormap ? shaderModule.fscmap : shaderModule.fs,\n      vs: shaderModule.vs,\n      defines: {\n        SAMPLER_TYPE: sampler,\n        COLORMAP_FUNCTION: colormap || 'viridis'\n      },\n      modules: [project32, picking, channels$1, lens]\n    });\n  }\n\n  /**\n   * This function initializes the internal state.\n   */\n  initializeState() {\n    const { gl } = this.context;\n    // This tells WebGL how to read row data from the texture.  For example, the default here is 4 (i.e for RGBA, one byte per channel) so\n    // each row of data is expected to be a multiple of 4.  This setting (i.e 1) allows us to have non-multiple-of-4 row sizes.  For example, for 2 byte (16 bit data),\n    // we could use 2 as the value and it would still work, but 1 also works fine (and is more flexible for 8 bit - 1 byte - textures as well).\n    // https://stackoverflow.com/questions/42789896/webgl-error-arraybuffer-not-big-enough-for-request-in-case-of-gl-luminance\n    gl.pixelStorei(GL.UNPACK_ALIGNMENT, 1);\n    gl.pixelStorei(GL.PACK_ALIGNMENT, 1);\n    const attributeManager = this.getAttributeManager();\n    attributeManager.add({\n      positions: {\n        size: 3,\n        type: GL.DOUBLE,\n        fp64: this.use64bitPositions(),\n        update: this.calculatePositions,\n        noAlloc: true\n      }\n    });\n    this.setState({\n      numInstances: 1,\n      positions: new Float64Array(12)\n    });\n  }\n\n  /**\n   * This function finalizes state by clearing all textures from the WebGL context\n   */\n  finalizeState() {\n    super.finalizeState();\n\n    if (this.state.textures) {\n      Object.values(this.state.textures).forEach(tex => tex && tex.delete());\n    }\n  }\n\n  /**\n   * This function updates state by retriggering model creation (shader compilation and attribute binding)\n   * and loading any textures that need be loading.\n   */\n  updateState({ props, oldProps, changeFlags }) {\n    // setup model first\n    if (\n      changeFlags.extensionsChanged ||\n      props.colormap !== oldProps.colormap ||\n      props.interpolation !== oldProps.interpolation\n    ) {\n      const { gl } = this.context;\n      if (this.state.model) {\n        this.state.model.delete();\n      }\n      this.setState({ model: this._getModel(gl) });\n\n      this.getAttributeManager().invalidateAll();\n    }\n    if (\n      (props.channelData !== oldProps.channelData &&\n        props.channelData?.data !== oldProps.channelData?.data) ||\n      props.interpolation !== oldProps.interpolation\n    ) {\n      this.loadChannelTextures(props.channelData);\n    }\n    const attributeManager = this.getAttributeManager();\n    if (props.bounds !== oldProps.bounds) {\n      attributeManager.invalidate('positions');\n    }\n  }\n\n  /**\n   * This function creates the luma.gl model.\n   */\n  _getModel(gl) {\n    if (!gl) {\n      return null;\n    }\n\n    /*\n       0,0 --- 1,0\n        |       |\n       0,1 --- 1,1\n     */\n    return new Model(gl, {\n      ...this.getShaders(),\n      id: this.props.id,\n      geometry: new Geometry({\n        drawMode: GL.TRIANGLE_FAN,\n        vertexCount: 4,\n        attributes: {\n          texCoords: new Float32Array([0, 1, 0, 0, 1, 0, 1, 1])\n        }\n      }),\n      isInstanced: false\n    });\n  }\n\n  /**\n   * This function generates view positions for use as a vec3 in the shader\n   */\n  calculatePositions(attributes) {\n    const { positions } = this.state;\n    const { bounds } = this.props;\n    // bounds as [minX, minY, maxX, maxY]\n    /*\n      (minX0, maxY3) ---- (maxX2, maxY3)\n             |                  |\n             |                  |\n             |                  |\n      (minX0, minY1) ---- (maxX2, minY1)\n   */\n    positions[0] = bounds[0];\n    positions[1] = bounds[1];\n    positions[2] = 0;\n\n    positions[3] = bounds[0];\n    positions[4] = bounds[3];\n    positions[5] = 0;\n\n    positions[6] = bounds[2];\n    positions[7] = bounds[3];\n    positions[8] = 0;\n\n    positions[9] = bounds[2];\n    positions[10] = bounds[1];\n    positions[11] = 0;\n\n    // eslint-disable-next-line  no-param-reassign\n    attributes.value = positions;\n  }\n\n  /**\n   * This function runs the shaders and draws to the canvas\n   */\n  draw({ uniforms }) {\n    const { textures, model } = this.state;\n    if (textures && model) {\n      const {\n        contrastLimits,\n        colors,\n        opacity,\n        domain,\n        dtype,\n        channelsVisible,\n        unprojectLensBounds,\n        bounds,\n        isLensOn,\n        lensSelection,\n        lensBorderColor,\n        lensBorderRadius,\n        transparentColor\n      } = this.props;\n      // Check number of textures not null.\n      const numTextures = Object.values(textures).filter(t => t).length;\n      // Slider values and color values can come in before textures since their data is async.\n      // Thus we pad based on the number of textures bound.\n      const { paddedContrastLimits, paddedColors } = padColorsAndWindows({\n        contrastLimits: contrastLimits.slice(0, numTextures),\n        colors: colors.slice(0, numTextures),\n        channelsVisible: channelsVisible.slice(0, numTextures),\n        domain,\n        dtype\n      });\n      // Creating a unit-square scaled intersection box for rendering the lens.\n      // It is ok if these coordinates are outside the unit square since\n      // we check membership in or out of the lens on the fragment shader.\n      const [\n        leftMouseBound,\n        bottomMouseBound,\n        rightMouseBound,\n        topMouseBound\n      ] = unprojectLensBounds;\n      const [left, bottom, right, top] = bounds;\n      const leftMouseBoundScaled = (leftMouseBound - left) / (right - left);\n      const bottomMouseBoundScaled = (bottomMouseBound - top) / (bottom - top);\n      const rightMouseBoundScaled = (rightMouseBound - left) / (right - left);\n      const topMouseBoundScaled = (topMouseBound - top) / (bottom - top);\n      model\n        .setUniforms({\n          ...uniforms,\n          colors: paddedColors,\n          contrastLimits: paddedContrastLimits,\n          opacity,\n          majorLensAxis: (rightMouseBoundScaled - leftMouseBoundScaled) / 2,\n          minorLensAxis: (bottomMouseBoundScaled - topMouseBoundScaled) / 2,\n          lensCenter: [\n            (rightMouseBoundScaled + leftMouseBoundScaled) / 2,\n            (bottomMouseBoundScaled + topMouseBoundScaled) / 2\n          ],\n          isLensOn,\n          lensSelection,\n          lensBorderColor,\n          lensBorderRadius,\n          transparentColor: (transparentColor || [0, 0, 0]).map(i => i / 255),\n          useTransparentColor: Boolean(transparentColor),\n          ...textures\n        })\n        .draw();\n    }\n  }\n\n  /**\n   * This function loads all channel textures from incoming resolved promises/data from the loaders by calling `dataToTexture`\n   */\n  loadChannelTextures(channelData) {\n    const textures = {\n      channel0: null,\n      channel1: null,\n      channel2: null,\n      channel3: null,\n      channel4: null,\n      channel5: null\n    };\n    if (this.state.textures) {\n      Object.values(this.state.textures).forEach(tex => tex && tex.delete());\n    }\n    if (\n      channelData &&\n      Object.keys(channelData).length > 0 &&\n      channelData.data\n    ) {\n      channelData.data.forEach((d, i) => {\n        textures[`channel${i}`] = this.dataToTexture(\n          d,\n          channelData.width,\n          channelData.height\n        );\n      }, this);\n      this.setState({ textures });\n    }\n  }\n\n  /**\n   * This function creates textures from the data\n   */\n  dataToTexture(data, width, height) {\n    const { interpolation } = this.props;\n    const attrs = getRenderingAttrs$1(\n      this.props.dtype,\n      this.context.gl,\n      interpolation\n    );\n    return new Texture2D(this.context.gl, {\n      width,\n      height,\n      data: attrs.cast?.(data) ?? data,\n      // we don't want or need mimaps\n      mipmaps: false,\n      parameters: {\n        // NEAREST for integer data\n        [GL.TEXTURE_MIN_FILTER]: attrs.filter,\n        [GL.TEXTURE_MAG_FILTER]: attrs.filter,\n        // CLAMP_TO_EDGE to remove tile artifacts\n        [GL.TEXTURE_WRAP_S]: GL.CLAMP_TO_EDGE,\n        [GL.TEXTURE_WRAP_T]: GL.CLAMP_TO_EDGE\n      },\n      format: attrs.format,\n      dataFormat: attrs.dataFormat,\n      type: attrs.type\n    });\n  }\n};\n\nXRLayer.layerName = 'XRLayer';\nXRLayer.defaultProps = defaultProps$8;\n\n// eslint-disable-next-line max-classes-per-file\n\nconst PHOTOMETRIC_INTERPRETATIONS = {\n  WhiteIsZero: 0,\n  BlackIsZero: 1,\n  RGB: 2,\n  Palette: 3,\n  TransparencyMask: 4,\n  CMYK: 5,\n  YCbCr: 6,\n  CIELab: 8,\n  ICCLab: 9\n};\n\nconst defaultProps$7 = {\n  ...BitmapLayer$1.defaultProps,\n  pickable: { type: 'boolean', value: true, compare: true },\n  coordinateSystem: COORDINATE_SYSTEM.CARTESIAN\n};\n\nconst getPhotometricInterpretationShader = (\n  photometricInterpretation,\n  transparentColorInHook\n) => {\n  const useTransparentColor = transparentColorInHook ? 'true' : 'false';\n  const transparentColorVector = `vec3(${(transparentColorInHook || [0, 0, 0])\n    .map(i => String(i / 255))\n    .join(',')})`;\n  switch (photometricInterpretation) {\n    case PHOTOMETRIC_INTERPRETATIONS.RGB:\n      return `color[3] = (${useTransparentColor} && (color.rgb == ${transparentColorVector})) ? 0.0 : color.a;`;\n    case PHOTOMETRIC_INTERPRETATIONS.WhiteIsZero:\n      return `\\\n          float value = 1.0 - (color.r / 256.0);\n          color = vec4(value, value, value, (${useTransparentColor} && vec3(value, value, value) == ${transparentColorVector}) ? 0.0 : color.a);\n        `;\n    case PHOTOMETRIC_INTERPRETATIONS.BlackIsZero:\n      return `\\\n          float value = (color.r / 256.0);\n          color = vec4(value, value, value, (${useTransparentColor} && vec3(value, value, value) == ${transparentColorVector}) ? 0.0 : color.a);\n        `;\n    case PHOTOMETRIC_INTERPRETATIONS.YCbCr:\n      // We need to use an epsilon because the conversion to RGB is not perfect.\n      return `\\\n          float y = color[0];\n          float cb = color[1];\n          float cr = color[2];\n          color[0] = (y + (1.40200 * (cr - .5)));\n          color[1] = (y - (0.34414 * (cb - .5)) - (0.71414 * (cr - .5)));\n          color[2] = (y + (1.77200 * (cb - .5)));\n          color[3] = (${useTransparentColor} && distance(color.rgb, ${transparentColorVector}) < 0.01) ? 0.0 : color.a;\n        `;\n    default:\n      console.error(\n        'Unsupported photometric interpretation or none provided.  No transformation will be done to image data'\n      );\n      return '';\n  }\n};\n\nconst getTransparentColor = photometricInterpretation => {\n  switch (photometricInterpretation) {\n    case PHOTOMETRIC_INTERPRETATIONS.RGB:\n      return [0, 0, 0, 0];\n    case PHOTOMETRIC_INTERPRETATIONS.WhiteIsZero:\n      return [255, 255, 255, 0];\n    case PHOTOMETRIC_INTERPRETATIONS.BlackIsZero:\n      return [0, 0, 0, 0];\n    case PHOTOMETRIC_INTERPRETATIONS.YCbCr:\n      return [16, 128, 128, 0];\n    default:\n      console.error(\n        'Unsupported photometric interpretation or none provided.  No transformation will be done to image data'\n      );\n      return [0, 0, 0, 0];\n  }\n};\n\nclass BitmapLayerWrapper extends BitmapLayer$1 {\n  _getModel(gl) {\n    const { photometricInterpretation, transparentColorInHook } = this.props;\n    // This is a port to the GPU of a subset of https://github.com/geotiffjs/geotiff.js/blob/master/src/rgb.js\n    // Safari was too slow doing this off of the GPU and it is noticably faster on other browsers as well.\n    const photometricInterpretationShader = getPhotometricInterpretationShader(\n      photometricInterpretation,\n      transparentColorInHook\n    );\n    if (!gl) {\n      return null;\n    }\n\n    /*\n      0,0 --- 1,0\n       |       |\n      0,1 --- 1,1\n    */\n    return new Model(gl, {\n      ...this.getShaders(),\n      id: this.props.id,\n      geometry: new Geometry({\n        drawMode: GL.TRIANGLES,\n        vertexCount: 6\n      }),\n      isInstanced: false,\n      inject: {\n        'fs:DECKGL_FILTER_COLOR': photometricInterpretationShader\n      }\n    });\n  }\n}\n\n/**\n * @typedef LayerProps\n * @type {object}\n * @property {number=} opacity Opacity of the layer.\n * @property {function=} onClick Hook function from deck.gl to handle clicked-on objects.\n * @property {Object=} modelMatrix Math.gl Matrix4 object containing an affine transformation to be applied to the image.\n * @property {number=} photometricInterpretation One of WhiteIsZero BlackIsZero YCbCr or RGB (default)\n * @property {Array.<number>=} transparentColor An RGB (0-255 range) color to be considered \"transparent\" if provided.\n * In other words, any fragment shader output equal transparentColor (before applying opacity) will have opacity 0.\n * This parameter only needs to be a truthy value when using colormaps because each colormap has its own transparent color that is calculated on the shader.\n * Thus setting this to a truthy value (with a colormap set) indicates that the shader should make that color transparent.\n * @property {String=} id Unique identifier for this layer.\n */\n/**\n * @type {{ new (...props: import('../types').Viv<LayerProps>[]) }}\n * @ignore\n */\nconst BitmapLayer = class extends CompositeLayer {\n  initializeState(args) {\n    const { gl } = this.context;\n    // This tells WebGL how to read row data from the texture.  For example, the default here is 4 (i.e for RGBA, one byte per channel) so\n    // each row of data is expected to be a multiple of 4.  This setting (i.e 1) allows us to have non-multiple-of-4 row sizes.  For example, for 2 byte (16 bit data),\n    // we could use 2 as the value and it would still work, but 1 also works fine (and is more flexible for 8 bit - 1 byte - textures as well).\n    // https://stackoverflow.com/questions/42789896/webgl-error-arraybuffer-not-big-enough-for-request-in-case-of-gl-luminance\n    // This needs to be called here and not in the BitmapLayerWrapper because the `image` prop is converted to a texture outside of the layer, as controlled by the `image` type.\n    // See: https://github.com/visgl/deck.gl/pull/5197\n    gl.pixelStorei(GL.UNPACK_ALIGNMENT, 1);\n    gl.pixelStorei(GL.PACK_ALIGNMENT, 1);\n    super.initializeState(args);\n  }\n\n  renderLayers() {\n    const {\n      photometricInterpretation,\n      transparentColor: transparentColorInHook\n    } = this.props;\n    const transparentColor = getTransparentColor(photometricInterpretation);\n    return new BitmapLayerWrapper(this.props, {\n      // transparentColor is a prop applied to the original image data by deck.gl's\n      // BitmapLayer and needs to be in the original colorspace.  It is used to determine\n      // what color is \"transparent\" in the original color space (i.e what shows when opacity is 0).\n      transparentColor,\n      // This is our transparentColor props which needs to be applied in the hook that converts to the RGB space.\n      transparentColorInHook,\n      id: `${this.props.id}-wrapped`\n    });\n  }\n};\n\nBitmapLayer.layerName = 'BitmapLayer';\n// From https://github.com/geotiffjs/geotiff.js/blob/8ef472f41b51d18074aece2300b6a8ad91a21ae1/src/globals.js#L202-L213\nBitmapLayer.PHOTOMETRIC_INTERPRETATIONS = PHOTOMETRIC_INTERPRETATIONS;\nBitmapLayer.defaultProps = {\n  ...defaultProps$7,\n  // We don't want this layer to bind the texture so the type should not be `image`.\n  image: { type: 'object', value: {}, compare: true },\n  transparentColor: { type: 'array', value: [0, 0, 0], compare: true },\n  photometricInterpretation: { type: 'number', value: 2, compare: true }\n};\nBitmapLayerWrapper.defaultProps = defaultProps$7;\nBitmapLayerWrapper.layerName = 'BitmapLayerWrapper';\n\nfunction getChannelStats(arr) {\n  let len = arr.length;\n  let min = Infinity;\n  let max = -Infinity;\n  let total = 0;\n  while (len--) {\n    if (arr[len] < min) {\n      min = arr[len];\n    }\n    if (arr[len] > max) {\n      max = arr[len];\n    }\n    total += arr[len];\n  }\n  const mean = total / arr.length;\n  len = arr.length;\n  let sumSquared = 0;\n  while (len--) {\n    sumSquared += (arr[len] - mean) ** 2;\n  }\n  const sd = (sumSquared / arr.length) ** 0.5;\n  const mid = Math.floor(arr.length / 2);\n  const firstQuartileLocation = Math.floor(arr.length / 4);\n  const thirdQuartileLocation = 3 * Math.floor(arr.length / 4);\n  quickselect(arr, mid);\n  const median = arr[mid];\n  quickselect(arr, firstQuartileLocation, 0, mid);\n  const q1 = arr[firstQuartileLocation];\n  quickselect(arr, thirdQuartileLocation, mid, arr.length - 1);\n  const q3 = arr[thirdQuartileLocation];\n  const cutoffArr = arr.filter((i) => i > 0);\n  const cutoffPercentile = 5e-4;\n  const topCutoffLocation = Math.floor(cutoffArr.length * (1 - cutoffPercentile));\n  const bottomCutoffLocation = Math.floor(cutoffArr.length * cutoffPercentile);\n  quickselect(cutoffArr, topCutoffLocation);\n  quickselect(cutoffArr, bottomCutoffLocation, 0, topCutoffLocation);\n  const contrastLimits = [\n    cutoffArr[bottomCutoffLocation] || 0,\n    cutoffArr[topCutoffLocation] || 0\n  ];\n  return {\n    mean,\n    sd,\n    q1,\n    q3,\n    median,\n    domain: [min, max],\n    contrastLimits\n  };\n}\nfunction ensureArray(x) {\n  return Array.isArray(x) ? x : [x];\n}\nfunction intToRgba(int) {\n  if (!Number.isInteger(int)) {\n    throw Error(\"Not an integer.\");\n  }\n  const buffer = new ArrayBuffer(4);\n  const view = new DataView(buffer);\n  view.setInt32(0, int, false);\n  const bytes = new Uint8Array(buffer);\n  return Array.from(bytes);\n}\nfunction isInterleaved(shape) {\n  const lastDimSize = shape[shape.length - 1];\n  return lastDimSize === 3 || lastDimSize === 4;\n}\nfunction getLabels(dimOrder) {\n  return dimOrder.toLowerCase().split(\"\").reverse();\n}\nfunction getDims(labels) {\n  const lookup = new Map(labels.map((name, i) => [name, i]));\n  if (lookup.size !== labels.length) {\n    throw Error(\"Labels must be unique, found duplicated label.\");\n  }\n  return (name) => {\n    const index = lookup.get(name);\n    if (index === void 0) {\n      throw Error(\"Invalid dimension.\");\n    }\n    return index;\n  };\n}\nfunction getImageSize(source) {\n  const interleaved = isInterleaved(source.shape);\n  const [height, width] = source.shape.slice(interleaved ? -3 : -2);\n  return { height, width };\n}\nfunction prevPowerOf2(x) {\n  return 2 ** Math.floor(Math.log2(x));\n}\nconst SIGNAL_ABORTED = \"__vivSignalAborted\";\n\nfunction renderSubLayers(props) {\n  const {\n    bbox: { left, top, right, bottom },\n    x,\n    y,\n    z\n  } = props.tile;\n  const { data, id, loader, maxZoom } = props;\n  // Only render in positive coorinate system\n  if ([left, bottom, right, top].some(v => v < 0) || !data) {\n    return null;\n  }\n  const base = loader[0];\n  const { height, width } = getImageSize(base);\n  // Tiles are exactly fitted to have height and width such that their bounds match that of the actual image (not some padded version).\n  // Thus the right/bottom given by deck.gl are incorrect since they assume tiles are of uniform sizes, which is not the case for us.\n  const bounds = [\n    left,\n    data.height < base.tileSize ? height : bottom,\n    data.width < base.tileSize ? width : right,\n    top\n  ];\n  if (isInterleaved(base.shape)) {\n    const { photometricInterpretation = 2 } = base.meta;\n    return new BitmapLayer(props, {\n      image: data,\n      photometricInterpretation,\n      // Shared props with XRLayer:\n      bounds,\n      id: `tile-sub-layer-${bounds}-${id}`,\n      tileId: { x, y, z }\n    });\n  }\n  return new XRLayer(props, {\n    channelData: data,\n    // Uncomment to help debugging - shades the tile being hovered over.\n    // autoHighlight: true,\n    // highlightColor: [80, 80, 80, 50],\n    // Shared props with BitmapLayer:\n    bounds,\n    id: `tile-sub-layer-${bounds}-${id}`,\n    tileId: { x, y, z },\n    // The auto setting is NEAREST at the highest resolution but LINEAR otherwise.\n    interpolation: z === maxZoom ? GL.NEAREST : GL.LINEAR\n  });\n}\n\nconst defaultProps$6 = {\n  pickable: { type: 'boolean', value: true, compare: true },\n  coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n  contrastLimits: { type: 'array', value: [], compare: true },\n  colors: { type: 'array', value: [], compare: true },\n  channelsVisible: { type: 'array', value: [], compare: true },\n  renderSubLayers: { type: 'function', value: renderSubLayers, compare: false },\n  colormap: { type: 'string', value: '', compare: true },\n  dtype: { type: 'string', value: 'Uint16', compare: true },\n  domain: { type: 'array', value: [], compare: true },\n  viewportId: { type: 'string', value: '', compare: true },\n  unprojectLensBounds: { type: 'array', value: [0, 0, 0, 0], compare: true },\n  isLensOn: { type: 'boolean', value: false, compare: true },\n  lensSelection: { type: 'number', value: 0, compare: true },\n  lensRadius: { type: 'number', value: 100, compare: true },\n  lensBorderColor: { type: 'array', value: [255, 255, 255], compare: true },\n  lensBorderRadius: { type: 'number', value: 0.02, compare: true },\n  transparentColor: { type: 'array', value: null, compare: true },\n  interpolation: { type: 'number', value: null, compare: true }\n};\n\n/**\n * This layer serves as a proxy of sorts to the rendering done in renderSubLayers, reacting to viewport changes in a custom manner.\n */\nclass MultiscaleImageLayerBase extends TileLayer {\n  /**\n   * This function allows us to controls which viewport gets to update the Tileset2D.\n   * This is a uniquely TileLayer issue since it updates based on viewport updates thanks\n   * to its ability to handle zoom-pan loading.  Essentially, with a picture-in-picture,\n   * this prevents it from detecting the update of some other viewport that is unwanted.\n   */\n  _updateTileset() {\n    if (!this.props.viewportId) {\n      super._updateTileset();\n    }\n    if (\n      (this.props.viewportId &&\n        this.context.viewport.id === this.props.viewportId) ||\n      // I don't know why, but DeckGL doesn't recognize multiple views on the first pass\n      // so we force update on the first pass by checking if there is a viewport in the tileset.\n      !this.state.tileset._viewport\n    ) {\n      super._updateTileset();\n    }\n  }\n}\n\nMultiscaleImageLayerBase.layerName = 'MultiscaleImageLayerBase';\nMultiscaleImageLayerBase.defaultProps = defaultProps$6;\n\nconst defaultProps$5 = {\n  pickable: { type: 'boolean', value: true, compare: true },\n  coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n  contrastLimits: { type: 'array', value: [], compare: true },\n  channelsVisible: { type: 'array', value: [], compare: true },\n  colors: { type: 'array', value: [], compare: true },\n  selections: { type: 'array', value: [], compare: true },\n  colormap: { type: 'string', value: '', compare: true },\n  domain: { type: 'array', value: [], compare: true },\n  viewportId: { type: 'string', value: '', compare: true },\n  loader: {\n    type: 'object',\n    value: {\n      getRaster: async () => ({ data: [], height: 0, width: 0 }),\n      dtype: 'Uint16'\n    },\n    compare: true\n  },\n  isLensOn: { type: 'boolean', value: false, compare: true },\n  lensSelection: { type: 'number', value: 0, compare: true },\n  lensRadius: { type: 'number', value: 100, compare: true },\n  lensBorderColor: { type: 'array', value: [255, 255, 255], compare: true },\n  lensBorderRadius: { type: 'number', value: 0.02, compare: true },\n  onClick: { type: 'function', value: null, compare: true },\n  transparentColor: { type: 'array', value: null, compare: true },\n  onViewportLoad: { type: 'function', value: null, compare: true },\n  interpolation: {\n    type: 'number',\n    value: GL.NEAREST,\n    compare: true\n  }\n};\n\n/**\n * @typedef LayerProps\n * @type {Object}\n * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.\n * @property {Array.<Array.<number>>} colors List of [r, g, b] values for each channel.\n * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.\n * @property {Object} loader PixelSource. Represents an N-dimensional image.\n * @property {Array} selections Selection to be used for fetching data.\n * @property {number=} opacity Opacity of the layer.\n * @property {string=} colormap String indicating a colormap (default: '').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap\n * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').\n * @property {string=} viewportId Id for the current view.  This needs to match the viewState id in deck.gl and is necessary for the lens.\n * @property {function=} onHover Hook function from deck.gl to handle hover objects.\n * @property {boolean=} isLensOn Whether or not to use the lens.\n * @property {number=} lensSelection Numeric index of the channel to be focused on by the lens.\n * @property {number=} lensRadius Pixel radius of the lens (default: 100).\n * @property {Array.<number>=} lensBorderColor RGB color of the border of the lens.\n * @property {number=} lensBorderRadius Percentage of the radius of the lens for a border (default 0.02).\n * @property {function=} onClick Hook function from deck.gl to handle clicked-on objects.\n * @property {Object=} modelMatrix Math.gl Matrix4 object containing an affine transformation to be applied to the image.\n * @property {Array.<number>=} transparentColor An RGB (0-255 range) color to be considered \"transparent\" if provided.\n * In other words, any fragment shader output equal transparentColor (before applying opacity) will have opacity 0.\n * This parameter only needs to be a truthy value when using colormaps because each colormap has its own transparent color that is calculated on the shader.\n * Thus setting this to a truthy value (with a colormap set) indicates that the shader should make that color transparent.\n * @property {function=} onViewportLoad Function that gets called when the data in the viewport loads.\n * @property {String=} id Unique identifier for this layer.\n */\n\n/**\n * @type {{ new <S extends string[]>(...props: import('../types').Viv<LayerProps, S>[]) }}\n * @ignore\n */\nconst ImageLayer = class extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      unprojectLensBounds: [0, 0, 0, 0],\n      width: 0,\n      height: 0,\n      data: []\n    };\n    if (this.context.deck) {\n      this.context.deck.eventManager.on({\n        pointermove: () => onPointer(this),\n        pointerleave: () => onPointer(this),\n        wheel: () => onPointer(this)\n      });\n    }\n  }\n\n  finalizeState() {\n    this.state.abortController.abort();\n  }\n\n  updateState({ props, oldProps }) {\n    const loaderChanged = props.loader !== oldProps.loader;\n    const selectionsChanged = props.selections !== oldProps.selections;\n\n    if (loaderChanged || selectionsChanged) {\n      // Only fetch new data to render if loader has changed\n      const { loader, selections = [], onViewportLoad } = this.props;\n      const abortController = new AbortController();\n      this.setState({ abortController });\n      const { signal } = abortController;\n      const getRaster = selection => loader.getRaster({ selection, signal });\n      const dataPromises = selections.map(getRaster);\n\n      Promise.all(dataPromises)\n        .then(rasters => {\n          const raster = {\n            data: rasters.map(d => d.data),\n            width: rasters[0].width,\n            height: rasters[0].height\n          };\n\n          if (isInterleaved(loader.shape)) {\n            // data is for BitmapLayer and needs to be of form { data: Uint8Array, width, height };\n            // eslint-disable-next-line prefer-destructuring\n            raster.data = raster.data[0];\n            if (raster.data.length === raster.width * raster.height * 3) {\n              // data is RGB (not RGBA) and need to update texture formats\n              raster.format = GL.RGB;\n              raster.dataFormat = GL.RGB;\n            }\n          }\n\n          if (onViewportLoad) {\n            onViewportLoad(raster);\n          }\n          this.setState({ ...raster });\n        })\n        .catch(e => {\n          if (e !== SIGNAL_ABORTED) {\n            throw e; // re-throws error if not our signal\n          }\n        });\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getPickingInfo({ info, sourceLayer }) {\n    // eslint-disable-next-line no-param-reassign\n    info.sourceLayer = sourceLayer;\n    // eslint-disable-next-line no-param-reassign\n    info.tile = sourceLayer.props.tile;\n    return info;\n  }\n\n  renderLayers() {\n    const { loader, id } = this.props;\n    const { dtype } = loader;\n    const { width, height, data, unprojectLensBounds } = this.state;\n    if (!(width && height)) return null;\n\n    const bounds = [0, height, width, 0];\n    if (isInterleaved(loader.shape)) {\n      const { photometricInterpretation = 2 } = loader.meta;\n      return new BitmapLayer(this.props, {\n        image: this.state,\n        photometricInterpretation,\n        // Shared props with XRLayer:\n        bounds,\n        id: `image-sub-layer-${bounds}-${id}`\n      });\n    }\n    return new XRLayer(this.props, {\n      channelData: { data, height, width },\n      // Shared props with BitmapLayer:\n      bounds,\n      id: `image-sub-layer-${bounds}-${id}`,\n      dtype,\n      unprojectLensBounds\n    });\n  }\n};\n\nImageLayer.layerName = 'ImageLayer';\nImageLayer.defaultProps = defaultProps$5;\n\nconst defaultProps$4 = {\n  pickable: { type: 'boolean', value: true, compare: true },\n  onHover: { type: 'function', value: null, compare: false },\n  contrastLimits: { type: 'array', value: [], compare: true },\n  colors: { type: 'array', value: [], compare: true },\n  channelsVisible: { type: 'array', value: [], compare: true },\n  opacity: { type: 'number', value: 1, compare: true },\n  colormap: { type: 'string', value: '', compare: true },\n  domain: { type: 'array', value: [], compare: true },\n  viewportId: { type: 'string', value: '', compare: true },\n  isLensOn: { type: 'boolean', value: false, compare: true },\n  lensSelection: { type: 'number', value: 0, compare: true },\n  lensRadius: { type: 'number', value: 100, compare: true },\n  lensBorderColor: { type: 'array', value: [255, 255, 255], compare: true },\n  lensBorderRadius: { type: 'number', value: 0.02, compare: true },\n  maxRequests: { type: 'number', value: 10, compare: true },\n  onClick: { type: 'function', value: null, compare: true },\n  transparentColor: { type: 'array', value: null, compare: true },\n  refinementStrategy: { type: 'string', value: null, compare: true },\n  excludeBackground: { type: 'boolean', value: false, compare: true }\n};\n\n/**\n * @typedef LayerProps\n * @type {object}\n * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.\n * @property {Array.<Array.<number>>} colors List of [r, g, b] values for each channel.\n * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.\n * @property {Array} loader Image pyramid. PixelSource[], where each PixelSource is decreasing in shape.\n * @property {Array} selections Selection to be used for fetching data.\n * @property {number=} opacity Opacity of the layer.\n * @property {string=} colormap String indicating a colormap (default: '').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap\n * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').\n * @property {string=} viewportId Id for the current view.  This needs to match the viewState id in deck.gl and is necessary for the lens.\n * @property {String=} id Unique identifier for this layer.\n * @property {function=} onTileError Custom override for handle tile fetching errors.\n * @property {function=} onHover Hook function from deck.gl to handle hover objects.\n * @property {boolean=} isLensOn Whether or not to use the lens.\n * @property {number=} lensSelection Numeric index of the channel to be focused on by the lens.\n * @property {number=} lensRadius Pixel radius of the lens (default: 100).\n * @property {Array.<number>=} lensBorderColor RGB color of the border of the lens (default [255, 255, 255]).\n * @property {number=} lensBorderRadius Percentage of the radius of the lens for a border (default 0.02).\n * @property {number=} maxRequests Maximum parallel ongoing requests allowed before aborting.\n * @property {function=} onClick Hook function from deck.gl to handle clicked-on objects.\n * @property {Object=} modelMatrix Math.gl Matrix4 object containing an affine transformation to be applied to the image.\n * @property {Array.<number>=} transparentColor An RGB (0-255 range) color to be considered \"transparent\" if provided.\n * In other words, any fragment shader output equal transparentColor (before applying opacity) will have opacity 0.\n * This parameter only needs to be a truthy value when using colormaps because each colormap has its own transparent color that is calculated on the shader.\n * Thus setting this to a truthy value (with a colormap set) indicates that the shader should make that color transparent.\n * @property {string=} refinementStrategy 'best-available' | 'no-overlap' | 'never' will be passed to TileLayer. A default will be chosen based on opacity.\n * @property {boolean=} excludeBackground Whether to exclude the background image. The background image is also excluded for opacity!=1.\n */\n\n/**\n * @type {{ new <S extends string[]>(...props: import('../../types').Viv<LayerProps, S>[]) }}\n * @ignore\n */\nconst MultiscaleImageLayer = class extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      unprojectLensBounds: [0, 0, 0, 0]\n    };\n    if (this.context.deck) {\n      this.context.deck.eventManager.on({\n        pointermove: () => onPointer(this),\n        pointerleave: () => onPointer(this),\n        wheel: () => onPointer(this)\n      });\n    }\n  }\n\n  renderLayers() {\n    const {\n      loader,\n      selections,\n      opacity,\n      viewportId,\n      onTileError,\n      onHover,\n      id,\n      onClick,\n      modelMatrix,\n      transparentColor,\n      excludeBackground,\n      refinementStrategy\n    } = this.props;\n\n    // Get properties from highest resolution\n    const { tileSize, dtype } = loader[0];\n\n    const { unprojectLensBounds } = this.state;\n    // This is basically to invert:\n    // https://github.com/visgl/deck.gl/pull/4616/files#diff-4d6a2e500c0e79e12e562c4f1217dc80R128\n    // The z level can be wrong for showing the correct scales because of the calculation deck.gl does\n    // so we need to invert it for fetching tiles and minZoom/maxZoom.\n    const getTileData = async ({ x, y, z, signal }) => {\n      // Early return if no selections\n      if (!selections || selections.length === 0) {\n        return null;\n      }\n\n      // I don't fully undertstand why this works, but I have a sense.\n      // It's basically to cancel out:\n      // https://github.com/visgl/deck.gl/pull/4616/files#diff-4d6a2e500c0e79e12e562c4f1217dc80R128,\n      // which felt odd to me to beign with.\n      // The image-tile example works without, this but I have a feeling there is something\n      // going on with our pyramids and/or rendering that is different.\n      const resolution = Math.round(-z);\n      const getTile = selection => {\n        const config = { x, y, selection, signal };\n        return loader[resolution].getTile(config);\n      };\n\n      try {\n        /*\n         * Try to request the tile data. The pixels sources can throw\n         * special SIGNAL_ABORTED string that we pick up in the catch\n         * block to return null to deck.gl.\n         *\n         * This means that our pixels sources _always_ have the same\n         * return type, and optional throw for performance.\n         */\n        const tiles = await Promise.all(selections.map(getTile));\n\n        const tile = {\n          data: tiles.map(d => d.data),\n          width: tiles[0].width,\n          height: tiles[0].height\n        };\n\n        if (isInterleaved(loader[resolution].shape)) {\n          // eslint-disable-next-line prefer-destructuring\n          tile.data = tile.data[0];\n          if (tile.data.length === tile.width * tile.height * 3) {\n            tile.format = GL.RGB;\n            tile.dataFormat = GL.RGB; // is this not properly inferred?\n          }\n          // can just return early, no need  to check for webgl2\n          return tile;\n        }\n\n        return tile;\n      } catch (err) {\n        /*\n         * Signal is aborted. We handle the custom value thrown\n         * by our pixel sources here and return falsy to deck.gl.\n         */\n        if (err === SIGNAL_ABORTED) {\n          return null;\n        }\n\n        // We should propagate all other thrown values/errors\n        throw err;\n      }\n    };\n\n    const { height, width } = getImageSize(loader[0]);\n    const tiledLayer = new MultiscaleImageLayerBase(this.props, {\n      id: `Tiled-Image-${id}`,\n      getTileData,\n      dtype,\n      tileSize,\n      // If you scale a matrix up or down, that is like zooming in or out.  zoomOffset controls\n      // how the zoom level you fetch tiles at is offset, allowing us to fetch higher resolution tiles\n      // while at a lower \"absolute\" zoom level.  If you didn't use this prop, an image that is scaled\n      // up would always look \"low resolution\" no matter the level of the image pyramid you are looking at.\n      zoomOffset: Math.round(\n        Math.log2(modelMatrix ? modelMatrix.getScale()[0] : 1)\n      ),\n      extent: [0, 0, width, height],\n      // See the above note within for why the use of zoomOffset and the rounding necessary.\n      minZoom: Math.round(-(loader.length - 1)),\n      maxZoom: 0,\n      // We want a no-overlap caching strategy with an opacity < 1 to prevent\n      // multiple rendered sublayers (some of which have been cached) from overlapping\n      refinementStrategy:\n        refinementStrategy || (opacity === 1 ? 'best-available' : 'no-overlap'),\n      // TileLayer checks `changeFlags.updateTriggersChanged.getTileData` to see if tile cache\n      // needs to be re-created. We want to trigger this behavior if the loader changes.\n      // https://github.com/uber/deck.gl/blob/3f67ea6dfd09a4d74122f93903cb6b819dd88d52/modules/geo-layers/src/tile-layer/tile-layer.js#L50\n      updateTriggers: {\n        getTileData: [loader, selections]\n      },\n      onTileError: onTileError || loader[0].onTileError,\n      unprojectLensBounds\n    });\n\n    // This gives us a background image and also solves the current\n    // minZoom funny business.  We don't use it for the background if we have an opacity\n    // paramteter set to anything but 1, but we always use it for situations where\n    // we are zoomed out too far.\n    const lowestResolution = loader[loader.length - 1];\n    const implementsGetRaster =\n      typeof lowestResolution.getRaster === 'function';\n    const layerModelMatrix = modelMatrix ? modelMatrix.clone() : new Matrix4();\n    const baseLayer =\n      implementsGetRaster &&\n      !excludeBackground &&\n      new ImageLayer(this.props, {\n        id: `Background-Image-${id}`,\n        loader: lowestResolution,\n        modelMatrix: layerModelMatrix.scale(2 ** (loader.length - 1)),\n        visible:\n          opacity === 1 &&\n          (!viewportId || this.context.viewport.id === viewportId) &&\n          // If we are using a transparent color, we shouldn't show the background image\n          // since the background image might not have the same color output from the fragment shader\n          // as the tiled layer at a higher resolution level.\n          !transparentColor,\n        pickable: { type: 'boolean', value: true, compare: true },\n        onHover,\n        onClick,\n        // Background image is nicest when LINEAR in my opinion.\n        interpolation: GL.LINEAR\n      });\n    const layers = [baseLayer, tiledLayer];\n    return layers;\n  }\n};\n\nMultiscaleImageLayer.layerName = 'MultiscaleImageLayer';\nMultiscaleImageLayer.defaultProps = defaultProps$4;\n\nconst defaultProps$3 = {\n  pickable: { type: 'boolean', value: true, compare: true },\n  loader: {\n    type: 'object',\n    value: {\n      getRaster: async () => ({ data: [], height: 0, width: 0 }),\n      getRasterSize: () => ({ height: 0, width: 0 }),\n      dtype: '<u2'\n    },\n    compare: true\n  },\n  id: { type: 'string', value: '', compare: true },\n  boundingBox: {\n    type: 'array',\n    value: [\n      [0, 0],\n      [0, 1],\n      [1, 1],\n      [1, 0]\n    ],\n    compare: true\n  },\n  boundingBoxColor: { type: 'array', value: [255, 0, 0], compare: true },\n  boundingBoxOutlineWidth: { type: 'number', value: 1, compare: true },\n  viewportOutlineColor: { type: 'array', value: [255, 190, 0], compare: true },\n  viewportOutlineWidth: { type: 'number', value: 2, compare: true },\n  overviewScale: { type: 'number', value: 1, compare: true },\n  zoom: { type: 'number', value: 1, compare: true }\n};\n\n/**\n * @typedef LayerProps\n * @type {Object}\n * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.\n * @property {Array.<Array.<number>>} colors List of [r, g, b] values for each channel.\n * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.\n * @property {Array} loader PixelSource[]. Assumes multiscale if loader.length > 1.\n * @property {Array} selections Selection to be used for fetching data.\n * @property {number=} opacity Opacity of the layer.\n * @property {string=} colormap String indicating a colormap (default: '').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap\n * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').\n * @property {Array.<number>=} boundingBoxColor [r, g, b] color of the bounding box (default: [255, 0, 0]).\n * @property {number=} boundingBoxOutlineWidth Width of the bounding box in px (default: 1).\n * @property {Array.<number>=} viewportOutlineColor [r, g, b] color of the outline (default: [255, 190, 0]).\n * @property {number=} viewportOutlineWidth Viewport outline width in px (default: 2).\n * @property {String=} id Unique identifier for this layer.\n */\n\n/**\n * @type {{ new <S extends string[]>(...props: import('../types').Viv<LayerProps, S>[]) }}\n * @ignore\n */\nconst OverviewLayer = class extends CompositeLayer {\n  renderLayers() {\n    const {\n      loader,\n      id,\n      zoom,\n      boundingBox,\n      boundingBoxColor,\n      boundingBoxOutlineWidth,\n      viewportOutlineColor,\n      viewportOutlineWidth,\n      overviewScale\n    } = this.props;\n\n    const { width, height } = getImageSize(loader[0]);\n    const z = loader.length - 1;\n    const lowestResolution = loader[z];\n\n    const overview = new ImageLayer(this.props, {\n      id: `viewport-${id}`,\n      modelMatrix: new Matrix4().scale(2 ** z * overviewScale),\n      loader: lowestResolution\n    });\n    const boundingBoxOutline = new PolygonLayer({\n      id: `bounding-box-overview-${id}`,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: [boundingBox],\n      getPolygon: f => f,\n      filled: false,\n      stroked: true,\n      getLineColor: boundingBoxColor,\n      getLineWidth: boundingBoxOutlineWidth * 2 ** zoom\n    });\n    const viewportOutline = new PolygonLayer({\n      id: `viewport-outline-${id}`,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: [\n        [\n          [0, 0],\n          [width * overviewScale, 0],\n          [width * overviewScale, height * overviewScale],\n          [0, height * overviewScale]\n        ]\n      ],\n      getPolygon: f => f,\n      filled: false,\n      stroked: true,\n      getLineColor: viewportOutlineColor,\n      getLineWidth: viewportOutlineWidth * 2 ** zoom\n    });\n    const layers = [overview, boundingBoxOutline, viewportOutline];\n    return layers;\n  }\n};\n\nOverviewLayer.layerName = 'OverviewLayer';\nOverviewLayer.defaultProps = defaultProps$3;\n\nfunction getVivId(id) {\n  return `-#${id}#`;\n}\n/**\n * Create a boudning box from a viewport based on passed-in viewState.\n * @param {viewState} Object The viewState for a certain viewport.\n * @returns {View} The DeckGL View for this viewport.\n */\nfunction makeBoundingBox(viewState) {\n  const viewport = new OrthographicView().makeViewport({\n    // From the current `detail` viewState, we need its projection matrix (actually the inverse).\n    viewState,\n    height: viewState.height,\n    width: viewState.width\n  });\n  // Use the inverse of the projection matrix to map screen to the view space.\n  return [\n    viewport.unproject([0, 0]),\n    viewport.unproject([viewport.width, 0]),\n    viewport.unproject([viewport.width, viewport.height]),\n    viewport.unproject([0, viewport.height])\n  ];\n}\n\n/**\n * Create an initial view state that centers the image in the viewport at the zoom level that fills the dimensions in `viewSize`.\n * @param {Object} loader (PixelSource[] | PixelSource)\n * @param {Object} viewSize { height, width } object giving dimensions of the viewport for deducing the right zoom level to center the image.\n * @param {Object=} zoomBackOff A positive number which controls how far zoomed out the view state is from filling the entire viewport (default is 0 so the image fully fills the view).\n * SideBySideViewer and PictureInPictureViewer use .5 when setting viewState automatically in their default behavior, so the viewport is slightly zoomed out from the image\n * filling the whole screen.  1 unit of zoomBackOff (so a passed-in value of 1) corresponds to a 2x zooming out.\n * @param {Boolean=} use3d Whether or not to return a view state that can be used with the 3d viewer\n * @param {Boolean=} modelMatrix If using a transformation matrix, passing it in here will allow this function to properly center the volume.\n * @returns {Object} A default initial view state that centers the image within the view: { target: [x, y, 0], zoom: -zoom }.\n */\nfunction getDefaultInitialViewState(\n  loader,\n  viewSize,\n  zoomBackOff = 0,\n  use3d = false,\n  modelMatrix\n) {\n  const source = Array.isArray(loader) ? loader[0] : loader;\n  const { width, height } = getImageSize(source);\n  const depth = source.shape[source.labels.indexOf('z')];\n  const zoom =\n    Math.log2(Math.min(viewSize.width / width, viewSize.height / height)) -\n    zoomBackOff;\n  const physicalSizeScalingMatrix = getPhysicalSizeScalingMatrix(source);\n  const loaderInitialViewState = {\n    target: (modelMatrix || new Matrix4()).transformPoint(\n      (use3d ? physicalSizeScalingMatrix : new Matrix4()).transformPoint([\n        width / 2,\n        height / 2,\n        use3d ? depth / 2 : 0\n      ])\n    ),\n    zoom\n  };\n  return loaderInitialViewState;\n}\n\n/**\n * Creates the layers for viewing an image in detail.\n * @param {String} id The identifier of the view.\n * @param {Object} props The layer properties.\n * @returns {Array} An array of layers.\n */\nfunction getImageLayers(id, props) {\n  const {\n    selections,\n    newselections,\n    transitionFields,\n    transitionOnViewportLoad,\n    onViewportLoad,\n    ...layerProps\n  } = props;\n  const { loader } = layerProps;\n  // Grab name of PixelSource if a class instance (works for Tiff & Zarr).\n  const sourceName = loader[0]?.constructor?.name;\n\n  // Create at least one layer even without selections so that the tests pass.\n  const Layer = loader.length > 1 ? MultiscaleImageLayer : ImageLayer;\n  const layerLoader = loader.length > 1 ? loader : loader[0];\n  const layers = [selections, newselections]\n    .filter((s, i) => i === 0 || s)\n    .map((s, i) => {\n      const suffix =\n        s && s[0] ? `-${transitionFields.map(f => s[0][f]).join('-')}` : '';\n      const newProps =\n        i !== 0\n          ? {\n              onViewportLoad: args => {\n                // Slightly delay to avoid issues with a render in the middle of a deck.gl layer state update.\n                setTimeout(() => {\n                  onViewportLoad(args);\n                  transitionOnViewportLoad(args);\n                }, 0);\n              }\n            }\n          : { onViewportLoad };\n      if (loader.length > 1 && i !== 0) {\n        newProps.refinementStrategy = 'never';\n        newProps.excludeBackground = true;\n      }\n      return new Layer({\n        ...layerProps,\n        ...newProps,\n        selections: s,\n        id: `${sourceName}${getVivId(id)}${suffix}`,\n        viewportId: id,\n        loader: layerLoader\n      });\n    });\n  return layers;\n}\n\nfunction getPosition(boundingBox, position, length) {\n  const viewLength = boundingBox[2][0] - boundingBox[0][0];\n  switch (position) {\n    case 'bottom-right': {\n      const yCoord =\n        boundingBox[2][1] - (boundingBox[2][1] - boundingBox[0][1]) * length;\n      const xLeftCoord = boundingBox[2][0] - viewLength * length;\n      return [yCoord, xLeftCoord];\n    }\n    case 'top-right': {\n      const yCoord = (boundingBox[2][1] - boundingBox[0][1]) * length;\n      const xLeftCoord = boundingBox[2][0] - viewLength * length;\n      return [yCoord, xLeftCoord];\n    }\n    case 'top-left': {\n      const yCoord = (boundingBox[2][1] - boundingBox[0][1]) * length;\n      const xLeftCoord = viewLength * length;\n      return [yCoord, xLeftCoord];\n    }\n    case 'bottom-left': {\n      const yCoord =\n        boundingBox[2][1] - (boundingBox[2][1] - boundingBox[0][1]) * length;\n      const xLeftCoord = viewLength * length;\n      return [yCoord, xLeftCoord];\n    }\n    default: {\n      throw new Error(`Position ${position} not found`);\n    }\n  }\n}\n\nconst defaultProps$2 = {\n  pickable: { type: 'boolean', value: true, compare: true },\n  viewState: {\n    type: 'object',\n    value: { zoom: 0, target: [0, 0, 0] },\n    compare: true\n  },\n  unit: { type: 'string', value: '', compare: true },\n  size: { type: 'number', value: 1, compare: true },\n  position: { type: 'string', value: 'bottom-right', compare: true },\n  length: { type: 'number', value: 0.085, compare: true }\n};\n/**\n * @typedef LayerProps\n * @type {Object}\n * @property {String} unit Physical unit size per pixel at full resolution.\n * @property {Number} size Physical size of a pixel.\n * @property {Object} viewState The current viewState for the desired view.  We cannot internally use this.context.viewport because it is one frame behind:\n * https://github.com/visgl/deck.gl/issues/4504\n * @property {Array=} boundingBox Boudning box of the view in which this should render.\n * @property {string=} id Id from the parent layer.\n * @property {number=} length Value from 0 to 1 representing the portion of the view to be used for the length part of the scale bar.\n */\n\n/**\n * @type {{ new(...props: LayerProps[]) }}\n * @ignore\n */\nconst ScaleBarLayer = class extends CompositeLayer {\n  renderLayers() {\n    const { id, unit, size, position, viewState, length } = this.props;\n    const boundingBox = makeBoundingBox(viewState);\n    const { zoom } = viewState;\n    const viewLength = boundingBox[2][0] - boundingBox[0][0];\n    const barLength = viewLength * 0.05;\n    // This is a good heuristic for stopping the bar tick marks from getting too small\n    // and/or the text squishing up into the bar.\n    const barHeight = Math.max(\n      2 ** (-zoom + 1.5),\n      (boundingBox[2][1] - boundingBox[0][1]) * 0.007\n    );\n    const numUnits = barLength * size;\n    const [yCoord, xLeftCoord] = getPosition(boundingBox, position, length);\n    const lengthBar = new LineLayer({\n      id: `scale-bar-length-${id}`,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: [\n        [\n          [xLeftCoord, yCoord],\n          [xLeftCoord + barLength, yCoord]\n        ]\n      ],\n      getSourcePosition: d => d[0],\n      getTargetPosition: d => d[1],\n      getWidth: 2,\n      getColor: [220, 220, 220]\n    });\n    const tickBoundsLeft = new LineLayer({\n      id: `scale-bar-height-left-${id}`,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: [\n        [\n          [xLeftCoord, yCoord - barHeight],\n          [xLeftCoord, yCoord + barHeight]\n        ]\n      ],\n      getSourcePosition: d => d[0],\n      getTargetPosition: d => d[1],\n      getWidth: 2,\n      getColor: [220, 220, 220]\n    });\n    const tickBoundsRight = new LineLayer({\n      id: `scale-bar-height-right-${id}`,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: [\n        [\n          [xLeftCoord + barLength, yCoord - barHeight],\n          [xLeftCoord + barLength, yCoord + barHeight]\n        ]\n      ],\n      getSourcePosition: d => d[0],\n      getTargetPosition: d => d[1],\n      getWidth: 2,\n      getColor: [220, 220, 220]\n    });\n    const textLayer = new TextLayer({\n      id: `units-label-layer-${id}`,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: [\n        {\n          text: String(numUnits).slice(0, 5).replace(/\\.$/, '') + unit,\n          position: [xLeftCoord + barLength * 0.5, yCoord + barHeight * 4]\n        }\n      ],\n      getColor: [220, 220, 220, 255],\n      getSize: 12,\n      fontFamily: DEFAULT_FONT_FAMILY,\n      sizeUnits: 'meters',\n      sizeScale: 2 ** -zoom,\n      characterSet: [...unit.split(''), ...range(10).map(i => String(i)), '.']\n    });\n    return [lengthBar, tickBoundsLeft, tickBoundsRight, textLayer];\n  }\n};\n\nScaleBarLayer.layerName = 'ScaleBarLayer';\nScaleBarLayer.defaultProps = defaultProps$2;\n\nvar vs = \"#version 300 es\\n#define GLSLIFY 1\\n#define SHADER_NAME xr-layer-vertex-shader\\nin vec3 positions;uniform vec3 eye_pos;uniform mat4 proj;uniform mat4 model;uniform mat4 view;uniform mat4 scale;uniform mat4 resolution;out vec3 vray_dir;flat out vec3 transformed_eye;void main(){gl_Position=proj*view*model*scale*resolution*vec4(positions,1.);/*This first diagram is a skewed volume(i.e a \\\"shear\\\" model matrix applied)top down with the eye marked as #,all in world space^___|__\\\\|\\\\\\\\|\\\\|____|||\\n#\\nThis next diagram shows the volume after the inverse model matrix has placed it back in model coordinates,but the eye still in world space.^___|___|||||||__|__||||\\n#\\nFinally,we apply the inverse model matrix transformation to the eye as well to bring it too into world space.Notice that the ray here matches the \\\"voxels\\\" through which the first ray also passes,as desired.^____/__|/||/||/____|///\\n#\\n*/transformed_eye=(inverse(resolution)*inverse(scale)*inverse(model)*(vec4(eye_pos,1.))).xyz;vray_dir=positions-transformed_eye;}\"; // eslint-disable-line\n\nvar fs$1 = \"#version 300 es\\nprecision highp int;precision highp float;precision highp SAMPLER_TYPE;\\n#define GLSLIFY 1\\nuniform highp SAMPLER_TYPE volume0;uniform highp SAMPLER_TYPE volume1;uniform highp SAMPLER_TYPE volume2;uniform highp SAMPLER_TYPE volume3;uniform highp SAMPLER_TYPE volume4;uniform highp SAMPLER_TYPE volume5;uniform vec3 scaledDimensions;uniform mat4 scale;uniform vec3 normals[NUM_PLANES];uniform float distances[NUM_PLANES];uniform vec2 contrastLimits[6];uniform vec3 colors[6];uniform vec2 xSlice;uniform vec2 ySlice;uniform vec2 zSlice;in vec3 vray_dir;flat in vec3 transformed_eye;out vec4 color;vec2 intersect_box(vec3 orig,vec3 dir){vec3 box_min=vec3(xSlice[0],ySlice[0],zSlice[0]);vec3 box_max=vec3(xSlice[1],ySlice[1],zSlice[1]);vec3 inv_dir=1./dir;vec3 tmin_tmp=(box_min-orig)*inv_dir;vec3 tmax_tmp=(box_max-orig)*inv_dir;vec3 tmin=min(tmin_tmp,tmax_tmp);vec3 tmax=max(tmin_tmp,tmax_tmp);float t0=max(tmin.x,max(tmin.y,tmin.z));float t1=min(tmax.x,min(tmax.y,tmax.z));vec2 val=vec2(t0,t1);return val;}float linear_to_srgb(float x){if(x<=0.0031308f){return 12.92f*x;}return 1.055f*pow(x,1.f/2.4f)-0.055f;}float wang_hash(int seed){seed=(seed ^ 61)^(seed>>16);seed*=9;seed=seed ^(seed>>4);seed*=0x27d4eb2d;seed=seed ^(seed>>15);return float(seed % 2147483647)/float(2147483647);}void main(void){vec3 ray_dir=normalize(vray_dir);vec2 t_hit=intersect_box(transformed_eye,ray_dir);if(t_hit.x>t_hit.y){discard;}t_hit.x=max(t_hit.x,0.);vec3 dt_vec=1./(scale*vec4(abs(ray_dir),1.)).xyz;float dt=1.*min(dt_vec.x,min(dt_vec.y,dt_vec.z));float offset=wang_hash(int(gl_FragCoord.x+640.*gl_FragCoord.y));vec3 p=transformed_eye+(t_hit.x+offset*dt)*ray_dir;_BEFORE_RENDERfor(float t=t_hit.x;t<t_hit.y;t+=dt){float canShow=1.;for(int i=0;i<NUM_PLANES;i+=1){canShow*=max(0.,sign(dot(normals[i],p)+distances[i]));}float canShowXCoordinate=max(p.x-0.,0.)*max(1.-p.x,0.);float canShowYCoordinate=max(p.y-0.,0.)*max(1.-p.y,0.);float canShowZCoordinate=max(p.z-0.,0.)*max(1.-p.z,0.);float canShowCoordinate=float(ceil(canShowXCoordinate*canShowYCoordinate*canShowZCoordinate));canShow=canShowCoordinate*canShow;float intensityValue0=canShow*sample_and_apply_contrast_limits(volume0,p,contrastLimits[0]);float intensityValue1=canShow*sample_and_apply_contrast_limits(volume1,p,contrastLimits[1]);float intensityValue2=canShow*sample_and_apply_contrast_limits(volume2,p,contrastLimits[2]);float intensityValue3=canShow*sample_and_apply_contrast_limits(volume3,p,contrastLimits[3]);float intensityValue4=canShow*sample_and_apply_contrast_limits(volume4,p,contrastLimits[4]);float intensityValue5=canShow*sample_and_apply_contrast_limits(volume5,p,contrastLimits[5]);_RENDERp+=ray_dir*dt;}_AFTER_RENDERcolor.r=linear_to_srgb(color.r);color.g=linear_to_srgb(color.g);color.b=linear_to_srgb(color.b);}\"; // eslint-disable-line\n\nvar fs = \"#define GLSLIFY 1\\nvec4 jet(float x_17){const float e0=0.0;const vec4 v0=vec4(0,0,0.5137254901960784,1);const float e1=0.125;const vec4 v1=vec4(0,0.23529411764705882,0.6666666666666666,1);const float e2=0.375;const vec4 v2=vec4(0.0196078431372549,1,1,1);const float e3=0.625;const vec4 v3=vec4(1,1,0,1);const float e4=0.875;const vec4 v4=vec4(0.9803921568627451,0,0,1);const float e5=1.0;const vec4 v5=vec4(0.5019607843137255,0,0,1);float a0=smoothstep(e0,e1,x_17);float a1=smoothstep(e1,e2,x_17);float a2=smoothstep(e2,e3,x_17);float a3=smoothstep(e3,e4,x_17);float a4=smoothstep(e4,e5,x_17);return max(mix(v0,v1,a0)*step(e0,x_17)*step(x_17,e1),max(mix(v1,v2,a1)*step(e1,x_17)*step(x_17,e2),max(mix(v2,v3,a2)*step(e2,x_17)*step(x_17,e3),max(mix(v3,v4,a3)*step(e3,x_17)*step(x_17,e4),mix(v4,v5,a4)*step(e4,x_17)*step(x_17,e5)))));}vec4 hsv(float x_18){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=0.169;const vec4 v1=vec4(0.9921568627450981,1,0.00784313725490196,1);const float e2=0.173;const vec4 v2=vec4(0.9686274509803922,1,0.00784313725490196,1);const float e3=0.337;const vec4 v3=vec4(0,0.9882352941176471,0.01568627450980392,1);const float e4=0.341;const vec4 v4=vec4(0,0.9882352941176471,0.0392156862745098,1);const float e5=0.506;const vec4 v5=vec4(0.00392156862745098,0.9764705882352941,1,1);const float e6=0.671;const vec4 v6=vec4(0.00784313725490196,0,0.9921568627450981,1);const float e7=0.675;const vec4 v7=vec4(0.03137254901960784,0,0.9921568627450981,1);const float e8=0.839;const vec4 v8=vec4(1,0,0.984313725490196,1);const float e9=0.843;const vec4 v9=vec4(1,0,0.9607843137254902,1);const float e10=1.0;const vec4 v10=vec4(1,0,0.023529411764705882,1);float a0=smoothstep(e0,e1,x_18);float a1=smoothstep(e1,e2,x_18);float a2=smoothstep(e2,e3,x_18);float a3=smoothstep(e3,e4,x_18);float a4=smoothstep(e4,e5,x_18);float a5=smoothstep(e5,e6,x_18);float a6=smoothstep(e6,e7,x_18);float a7=smoothstep(e7,e8,x_18);float a8=smoothstep(e8,e9,x_18);float a9=smoothstep(e9,e10,x_18);return max(mix(v0,v1,a0)*step(e0,x_18)*step(x_18,e1),max(mix(v1,v2,a1)*step(e1,x_18)*step(x_18,e2),max(mix(v2,v3,a2)*step(e2,x_18)*step(x_18,e3),max(mix(v3,v4,a3)*step(e3,x_18)*step(x_18,e4),max(mix(v4,v5,a4)*step(e4,x_18)*step(x_18,e5),max(mix(v5,v6,a5)*step(e5,x_18)*step(x_18,e6),max(mix(v6,v7,a6)*step(e6,x_18)*step(x_18,e7),max(mix(v7,v8,a7)*step(e7,x_18)*step(x_18,e8),max(mix(v8,v9,a8)*step(e8,x_18)*step(x_18,e9),mix(v9,v10,a9)*step(e9,x_18)*step(x_18,e10))))))))));}vec4 hot(float x_13){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.3;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.6;const vec4 v2=vec4(1,0.8235294117647058,0,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_13);float a1=smoothstep(e1,e2,x_13);float a2=smoothstep(e2,e3,x_13);return max(mix(v0,v1,a0)*step(e0,x_13)*step(x_13,e1),max(mix(v1,v2,a1)*step(e1,x_13)*step(x_13,e2),mix(v2,v3,a2)*step(e2,x_13)*step(x_13,e3)));}vec4 cool(float x_24){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.4549019607843137,0,0.8549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);const float e3=0.38;const vec4 v3=vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);const float e4=0.5;const vec4 v4=vec4(0,0.8,0.7725490196078432,1);const float e5=0.63;const vec4 v5=vec4(0,0.9686274509803922,0.5725490196078431,1);const float e6=0.75;const vec4 v6=vec4(0,1,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.1568627450980392,1,0.03137254901960784,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_24);float a1=smoothstep(e1,e2,x_24);float a2=smoothstep(e2,e3,x_24);float a3=smoothstep(e3,e4,x_24);float a4=smoothstep(e4,e5,x_24);float a5=smoothstep(e5,e6,x_24);float a6=smoothstep(e6,e7,x_24);float a7=smoothstep(e7,e8,x_24);return max(mix(v0,v1,a0)*step(e0,x_24)*step(x_24,e1),max(mix(v1,v2,a1)*step(e1,x_24)*step(x_24,e2),max(mix(v2,v3,a2)*step(e2,x_24)*step(x_24,e3),max(mix(v3,v4,a3)*step(e3,x_24)*step(x_24,e4),max(mix(v4,v5,a4)*step(e4,x_24)*step(x_24,e5),max(mix(v5,v6,a5)*step(e5,x_24)*step(x_24,e6),max(mix(v6,v7,a6)*step(e6,x_24)*step(x_24,e7),mix(v7,v8,a7)*step(e7,x_24)*step(x_24,e8))))))));}vec4 spring(float x_5){const float e0=0.0;const vec4 v0=vec4(1,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_5);return mix(v0,v1,a0)*step(e0,x_5)*step(x_5,e1);}vec4 summer(float x_12){const float e0=0.0;const vec4 v0=vec4(0,0.5019607843137255,0.4,1);const float e1=1.0;const vec4 v1=vec4(1,1,0.4,1);float a0=smoothstep(e0,e1,x_12);return mix(v0,v1,a0)*step(e0,x_12)*step(x_12,e1);}vec4 autumn(float x_25){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_25);return mix(v0,v1,a0)*step(e0,x_25)*step(x_25,e1);}vec4 winter(float x_16){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(0,1,0.5019607843137255,1);float a0=smoothstep(e0,e1,x_16);return mix(v0,v1,a0)*step(e0,x_16)*step(x_16,e1);}vec4 bone(float x_15){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.376;const vec4 v1=vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);const float e2=0.753;const vec4 v2=vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_15);float a1=smoothstep(e1,e2,x_15);float a2=smoothstep(e2,e3,x_15);return max(mix(v0,v1,a0)*step(e0,x_15)*step(x_15,e1),max(mix(v1,v2,a1)*step(e1,x_15)*step(x_15,e2),mix(v2,v3,a2)*step(e2,x_15)*step(x_15,e3)));}vec4 copper(float x_10){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.804;const vec4 v1=vec4(1,0.6274509803921569,0.4,1);const float e2=1.0;const vec4 v2=vec4(1,0.7803921568627451,0.4980392156862745,1);float a0=smoothstep(e0,e1,x_10);float a1=smoothstep(e1,e2,x_10);return max(mix(v0,v1,a0)*step(e0,x_10)*step(x_10,e1),mix(v1,v2,a1)*step(e1,x_10)*step(x_10,e2));}vec4 greys(float x_4){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_4);return mix(v0,v1,a0)*step(e0,x_4)*step(x_4,e1);}vec4 yignbu(float x_32){const float e0=0.0;const vec4 v0=vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);const float e1=0.125;const vec4 v1=vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);const float e2=0.25;const vec4 v2=vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);const float e3=0.375;const vec4 v3=vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);const float e4=0.5;const vec4 v4=vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);const float e5=0.625;const vec4 v5=vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);const float e7=0.875;const vec4 v7=vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8509803921568627,1);float a0=smoothstep(e0,e1,x_32);float a1=smoothstep(e1,e2,x_32);float a2=smoothstep(e2,e3,x_32);float a3=smoothstep(e3,e4,x_32);float a4=smoothstep(e4,e5,x_32);float a5=smoothstep(e5,e6,x_32);float a6=smoothstep(e6,e7,x_32);float a7=smoothstep(e7,e8,x_32);return max(mix(v0,v1,a0)*step(e0,x_32)*step(x_32,e1),max(mix(v1,v2,a1)*step(e1,x_32)*step(x_32,e2),max(mix(v2,v3,a2)*step(e2,x_32)*step(x_32,e3),max(mix(v3,v4,a3)*step(e3,x_32)*step(x_32,e4),max(mix(v4,v5,a4)*step(e4,x_32)*step(x_32,e5),max(mix(v5,v6,a5)*step(e5,x_32)*step(x_32,e6),max(mix(v6,v7,a6)*step(e6,x_32)*step(x_32,e7),mix(v7,v8,a7)*step(e7,x_32)*step(x_32,e8))))))));}vec4 greens(float x_34){const float e0=0.0;const vec4 v0=vec4(0,0.26666666666666666,0.10588235294117647,1);const float e1=0.125;const vec4 v1=vec4(0,0.42745098039215684,0.17254901960784313,1);const float e2=0.25;const vec4 v2=vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);const float e3=0.375;const vec4 v3=vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);const float e4=0.5;const vec4 v4=vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);const float e5=0.625;const vec4 v5=vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);const float e7=0.875;const vec4 v7=vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);const float e8=1.0;const vec4 v8=vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);float a0=smoothstep(e0,e1,x_34);float a1=smoothstep(e1,e2,x_34);float a2=smoothstep(e2,e3,x_34);float a3=smoothstep(e3,e4,x_34);float a4=smoothstep(e4,e5,x_34);float a5=smoothstep(e5,e6,x_34);float a6=smoothstep(e6,e7,x_34);float a7=smoothstep(e7,e8,x_34);return max(mix(v0,v1,a0)*step(e0,x_34)*step(x_34,e1),max(mix(v1,v2,a1)*step(e1,x_34)*step(x_34,e2),max(mix(v2,v3,a2)*step(e2,x_34)*step(x_34,e3),max(mix(v3,v4,a3)*step(e3,x_34)*step(x_34,e4),max(mix(v4,v5,a4)*step(e4,x_34)*step(x_34,e5),max(mix(v5,v6,a5)*step(e5,x_34)*step(x_34,e6),max(mix(v6,v7,a6)*step(e6,x_34)*step(x_34,e7),mix(v7,v8,a7)*step(e7,x_34)*step(x_34,e8))))))));}vec4 yiorrd(float x_41){const float e0=0.0;const vec4 v0=vec4(0.5019607843137255,0,0.14901960784313725,1);const float e1=0.125;const vec4 v1=vec4(0.7411764705882353,0,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);const float e3=0.375;const vec4 v3=vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);const float e4=0.5;const vec4 v4=vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);const float e5=0.625;const vec4 v5=vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);const float e6=0.75;const vec4 v6=vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);const float e7=0.875;const vec4 v7=vec4(1,0.9294117647058824,0.6274509803921569,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8,1);float a0=smoothstep(e0,e1,x_41);float a1=smoothstep(e1,e2,x_41);float a2=smoothstep(e2,e3,x_41);float a3=smoothstep(e3,e4,x_41);float a4=smoothstep(e4,e5,x_41);float a5=smoothstep(e5,e6,x_41);float a6=smoothstep(e6,e7,x_41);float a7=smoothstep(e7,e8,x_41);return max(mix(v0,v1,a0)*step(e0,x_41)*step(x_41,e1),max(mix(v1,v2,a1)*step(e1,x_41)*step(x_41,e2),max(mix(v2,v3,a2)*step(e2,x_41)*step(x_41,e3),max(mix(v3,v4,a3)*step(e3,x_41)*step(x_41,e4),max(mix(v4,v5,a4)*step(e4,x_41)*step(x_41,e5),max(mix(v5,v6,a5)*step(e5,x_41)*step(x_41,e6),max(mix(v6,v7,a6)*step(e6,x_41)*step(x_41,e7),mix(v7,v8,a7)*step(e7,x_41)*step(x_41,e8))))))));}vec4 bluered(float x_23){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_23);return mix(v0,v1,a0)*step(e0,x_23)*step(x_23,e1);}vec4 rdbu(float x_1){const float e0=0.0;const vec4 v0=vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);const float e1=0.35;const vec4 v1=vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);const float e2=0.5;const vec4 v2=vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);const float e3=0.6;const vec4 v3=vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);const float e4=0.7;const vec4 v4=vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);const float e5=1.0;const vec4 v5=vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);float a0=smoothstep(e0,e1,x_1);float a1=smoothstep(e1,e2,x_1);float a2=smoothstep(e2,e3,x_1);float a3=smoothstep(e3,e4,x_1);float a4=smoothstep(e4,e5,x_1);return max(mix(v0,v1,a0)*step(e0,x_1)*step(x_1,e1),max(mix(v1,v2,a1)*step(e1,x_1)*step(x_1,e2),max(mix(v2,v3,a2)*step(e2,x_1)*step(x_1,e3),max(mix(v3,v4,a3)*step(e3,x_1)*step(x_1,e4),mix(v4,v5,a4)*step(e4,x_1)*step(x_1,e5)))));}vec4 picnic(float x_42){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=0.1;const vec4 v1=vec4(0.2,0.6,1,1);const float e2=0.2;const vec4 v2=vec4(0.4,0.8,1,1);const float e3=0.3;const vec4 v3=vec4(0.6,0.8,1,1);const float e4=0.4;const vec4 v4=vec4(0.8,0.8,1,1);const float e5=0.5;const vec4 v5=vec4(1,1,1,1);const float e6=0.6;const vec4 v6=vec4(1,0.8,1,1);const float e7=0.7;const vec4 v7=vec4(1,0.6,1,1);const float e8=0.8;const vec4 v8=vec4(1,0.4,0.8,1);const float e9=0.9;const vec4 v9=vec4(1,0.4,0.4,1);const float e10=1.0;const vec4 v10=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_42);float a1=smoothstep(e1,e2,x_42);float a2=smoothstep(e2,e3,x_42);float a3=smoothstep(e3,e4,x_42);float a4=smoothstep(e4,e5,x_42);float a5=smoothstep(e5,e6,x_42);float a6=smoothstep(e6,e7,x_42);float a7=smoothstep(e7,e8,x_42);float a8=smoothstep(e8,e9,x_42);float a9=smoothstep(e9,e10,x_42);return max(mix(v0,v1,a0)*step(e0,x_42)*step(x_42,e1),max(mix(v1,v2,a1)*step(e1,x_42)*step(x_42,e2),max(mix(v2,v3,a2)*step(e2,x_42)*step(x_42,e3),max(mix(v3,v4,a3)*step(e3,x_42)*step(x_42,e4),max(mix(v4,v5,a4)*step(e4,x_42)*step(x_42,e5),max(mix(v5,v6,a5)*step(e5,x_42)*step(x_42,e6),max(mix(v6,v7,a6)*step(e6,x_42)*step(x_42,e7),max(mix(v7,v8,a7)*step(e7,x_42)*step(x_42,e8),max(mix(v8,v9,a8)*step(e8,x_42)*step(x_42,e9),mix(v9,v10,a9)*step(e9,x_42)*step(x_42,e10))))))))));}vec4 rainbow(float x_31){const float e0=0.0;const vec4 v0=vec4(0.5882352941176471,0,0.35294117647058826,1);const float e1=0.125;const vec4 v1=vec4(0,0,0.7843137254901961,1);const float e2=0.25;const vec4 v2=vec4(0,0.09803921568627451,1,1);const float e3=0.375;const vec4 v3=vec4(0,0.596078431372549,1,1);const float e4=0.5;const vec4 v4=vec4(0.17254901960784313,1,0.5882352941176471,1);const float e5=0.625;const vec4 v5=vec4(0.592156862745098,1,0,1);const float e6=0.75;const vec4 v6=vec4(1,0.9176470588235294,0,1);const float e7=0.875;const vec4 v7=vec4(1,0.43529411764705883,0,1);const float e8=1.0;const vec4 v8=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_31);float a1=smoothstep(e1,e2,x_31);float a2=smoothstep(e2,e3,x_31);float a3=smoothstep(e3,e4,x_31);float a4=smoothstep(e4,e5,x_31);float a5=smoothstep(e5,e6,x_31);float a6=smoothstep(e6,e7,x_31);float a7=smoothstep(e7,e8,x_31);return max(mix(v0,v1,a0)*step(e0,x_31)*step(x_31,e1),max(mix(v1,v2,a1)*step(e1,x_31)*step(x_31,e2),max(mix(v2,v3,a2)*step(e2,x_31)*step(x_31,e3),max(mix(v3,v4,a3)*step(e3,x_31)*step(x_31,e4),max(mix(v4,v5,a4)*step(e4,x_31)*step(x_31,e5),max(mix(v5,v6,a5)*step(e5,x_31)*step(x_31,e6),max(mix(v6,v7,a6)*step(e6,x_31)*step(x_31,e7),mix(v7,v8,a7)*step(e7,x_31)*step(x_31,e8))))))));}vec4 portland(float x_21){const float e0=0.0;const vec4 v0=vec4(0.047058823529411764,0.2,0.5137254901960784,1);const float e1=0.25;const vec4 v1=vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);const float e2=0.5;const vec4 v2=vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);const float e3=0.75;const vec4 v3=vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);const float e4=1.0;const vec4 v4=vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);float a0=smoothstep(e0,e1,x_21);float a1=smoothstep(e1,e2,x_21);float a2=smoothstep(e2,e3,x_21);float a3=smoothstep(e3,e4,x_21);return max(mix(v0,v1,a0)*step(e0,x_21)*step(x_21,e1),max(mix(v1,v2,a1)*step(e1,x_21)*step(x_21,e2),max(mix(v2,v3,a2)*step(e2,x_21)*step(x_21,e3),mix(v3,v4,a3)*step(e3,x_21)*step(x_21,e4))));}vec4 blackbody(float x_38){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.2;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.4;const vec4 v2=vec4(0.9019607843137255,0.8235294117647058,0,1);const float e3=0.7;const vec4 v3=vec4(1,1,1,1);const float e4=1.0;const vec4 v4=vec4(0.6274509803921569,0.7843137254901961,1,1);float a0=smoothstep(e0,e1,x_38);float a1=smoothstep(e1,e2,x_38);float a2=smoothstep(e2,e3,x_38);float a3=smoothstep(e3,e4,x_38);return max(mix(v0,v1,a0)*step(e0,x_38)*step(x_38,e1),max(mix(v1,v2,a1)*step(e1,x_38)*step(x_38,e2),max(mix(v2,v3,a2)*step(e2,x_38)*step(x_38,e3),mix(v3,v4,a3)*step(e3,x_38)*step(x_38,e4))));}vec4 earth(float x_29){const float e0=0.0;const vec4 v0=vec4(0,0,0.5098039215686274,1);const float e1=0.1;const vec4 v1=vec4(0,0.7058823529411765,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);const float e3=0.4;const vec4 v3=vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);const float e4=0.6;const vec4 v4=vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);const float e5=1.0;const vec4 v5=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_29);float a1=smoothstep(e1,e2,x_29);float a2=smoothstep(e2,e3,x_29);float a3=smoothstep(e3,e4,x_29);float a4=smoothstep(e4,e5,x_29);return max(mix(v0,v1,a0)*step(e0,x_29)*step(x_29,e1),max(mix(v1,v2,a1)*step(e1,x_29)*step(x_29,e2),max(mix(v2,v3,a2)*step(e2,x_29)*step(x_29,e3),max(mix(v3,v4,a3)*step(e3,x_29)*step(x_29,e4),mix(v4,v5,a4)*step(e4,x_29)*step(x_29,e5)))));}vec4 electric(float x_9){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.15;const vec4 v1=vec4(0.11764705882352941,0,0.39215686274509803,1);const float e2=0.4;const vec4 v2=vec4(0.47058823529411764,0,0.39215686274509803,1);const float e3=0.6;const vec4 v3=vec4(0.6274509803921569,0.35294117647058826,0,1);const float e4=0.8;const vec4 v4=vec4(0.9019607843137255,0.7843137254901961,0,1);const float e5=1.0;const vec4 v5=vec4(1,0.9803921568627451,0.8627450980392157,1);float a0=smoothstep(e0,e1,x_9);float a1=smoothstep(e1,e2,x_9);float a2=smoothstep(e2,e3,x_9);float a3=smoothstep(e3,e4,x_9);float a4=smoothstep(e4,e5,x_9);return max(mix(v0,v1,a0)*step(e0,x_9)*step(x_9,e1),max(mix(v1,v2,a1)*step(e1,x_9)*step(x_9,e2),max(mix(v2,v3,a2)*step(e2,x_9)*step(x_9,e3),max(mix(v3,v4,a3)*step(e3,x_9)*step(x_9,e4),mix(v4,v5,a4)*step(e4,x_9)*step(x_9,e5)))));}vec4 alpha(float x_0){const float e0=0.0;const vec4 v0=vec4(1,1,1,0);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_0);return mix(v0,v1,a0)*step(e0,x_0)*step(x_0,e1);}vec4 viridis(float x_22){const float e0=0.0;const vec4 v0=vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);const float e1=0.13;const vec4 v1=vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);const float e4=0.5;const vec4 v4=vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);const float e5=0.63;const vec4 v5=vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);const float e6=0.75;const vec4 v6=vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);const float e7=0.88;const vec4 v7=vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);float a0=smoothstep(e0,e1,x_22);float a1=smoothstep(e1,e2,x_22);float a2=smoothstep(e2,e3,x_22);float a3=smoothstep(e3,e4,x_22);float a4=smoothstep(e4,e5,x_22);float a5=smoothstep(e5,e6,x_22);float a6=smoothstep(e6,e7,x_22);float a7=smoothstep(e7,e8,x_22);return max(mix(v0,v1,a0)*step(e0,x_22)*step(x_22,e1),max(mix(v1,v2,a1)*step(e1,x_22)*step(x_22,e2),max(mix(v2,v3,a2)*step(e2,x_22)*step(x_22,e3),max(mix(v3,v4,a3)*step(e3,x_22)*step(x_22,e4),max(mix(v4,v5,a4)*step(e4,x_22)*step(x_22,e5),max(mix(v5,v6,a5)*step(e5,x_22)*step(x_22,e6),max(mix(v6,v7,a6)*step(e6,x_22)*step(x_22,e7),mix(v7,v8,a7)*step(e7,x_22)*step(x_22,e8))))))));}vec4 inferno(float x_30){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);const float e3=0.38;const vec4 v3=vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);const float e4=0.5;const vec4 v4=vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);const float e5=0.63;const vec4 v5=vec4(0.8901960784313725,0.34901960784313724,0.2,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,1,0.6431372549019608,1);float a0=smoothstep(e0,e1,x_30);float a1=smoothstep(e1,e2,x_30);float a2=smoothstep(e2,e3,x_30);float a3=smoothstep(e3,e4,x_30);float a4=smoothstep(e4,e5,x_30);float a5=smoothstep(e5,e6,x_30);float a6=smoothstep(e6,e7,x_30);float a7=smoothstep(e7,e8,x_30);return max(mix(v0,v1,a0)*step(e0,x_30)*step(x_30,e1),max(mix(v1,v2,a1)*step(e1,x_30)*step(x_30,e2),max(mix(v2,v3,a2)*step(e2,x_30)*step(x_30,e3),max(mix(v3,v4,a3)*step(e3,x_30)*step(x_30,e4),max(mix(v4,v5,a4)*step(e4,x_30)*step(x_30,e5),max(mix(v5,v6,a5)*step(e5,x_30)*step(x_30,e6),max(mix(v6,v7,a6)*step(e6,x_30)*step(x_30,e7),mix(v7,v8,a7)*step(e7,x_30)*step(x_30,e8))))))));}vec4 magma(float x_33){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);const float e2=0.25;const vec4 v2=vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);const float e4=0.5;const vec4 v4=vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);const float e6=0.75;const vec4 v6=vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);float a0=smoothstep(e0,e1,x_33);float a1=smoothstep(e1,e2,x_33);float a2=smoothstep(e2,e3,x_33);float a3=smoothstep(e3,e4,x_33);float a4=smoothstep(e4,e5,x_33);float a5=smoothstep(e5,e6,x_33);float a6=smoothstep(e6,e7,x_33);float a7=smoothstep(e7,e8,x_33);return max(mix(v0,v1,a0)*step(e0,x_33)*step(x_33,e1),max(mix(v1,v2,a1)*step(e1,x_33)*step(x_33,e2),max(mix(v2,v3,a2)*step(e2,x_33)*step(x_33,e3),max(mix(v3,v4,a3)*step(e3,x_33)*step(x_33,e4),max(mix(v4,v5,a4)*step(e4,x_33)*step(x_33,e5),max(mix(v5,v6,a5)*step(e5,x_33)*step(x_33,e6),max(mix(v6,v7,a6)*step(e6,x_33)*step(x_33,e7),mix(v7,v8,a7)*step(e7,x_33)*step(x_33,e8))))))));}vec4 plasma(float x_3){const float e0=0.0;const vec4 v0=vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);const float e1=0.13;const vec4 v1=vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);const float e2=0.25;const vec4 v2=vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);const float e4=0.5;const vec4 v4=vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);const float e6=0.75;const vec4 v6=vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);const float e7=0.88;const vec4 v7=vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);float a0=smoothstep(e0,e1,x_3);float a1=smoothstep(e1,e2,x_3);float a2=smoothstep(e2,e3,x_3);float a3=smoothstep(e3,e4,x_3);float a4=smoothstep(e4,e5,x_3);float a5=smoothstep(e5,e6,x_3);float a6=smoothstep(e6,e7,x_3);float a7=smoothstep(e7,e8,x_3);return max(mix(v0,v1,a0)*step(e0,x_3)*step(x_3,e1),max(mix(v1,v2,a1)*step(e1,x_3)*step(x_3,e2),max(mix(v2,v3,a2)*step(e2,x_3)*step(x_3,e3),max(mix(v3,v4,a3)*step(e3,x_3)*step(x_3,e4),max(mix(v4,v5,a4)*step(e4,x_3)*step(x_3,e5),max(mix(v5,v6,a5)*step(e5,x_3)*step(x_3,e6),max(mix(v6,v7,a6)*step(e6,x_3)*step(x_3,e7),mix(v7,v8,a7)*step(e7,x_3)*step(x_3,e8))))))));}vec4 warm(float x_43){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.6745098039215687,0,0.7333333333333333,1);const float e2=0.25;const vec4 v2=vec4(0.8588235294117647,0,0.6666666666666666,1);const float e3=0.38;const vec4 v3=vec4(1,0,0.5098039215686274,1);const float e4=0.5;const vec4 v4=vec4(1,0.24705882352941178,0.2901960784313726,1);const float e5=0.63;const vec4 v5=vec4(1,0.4823529411764706,0,1);const float e6=0.75;const vec4 v6=vec4(0.9176470588235294,0.6901960784313725,0,1);const float e7=0.88;const vec4 v7=vec4(0.7450980392156863,0.8941176470588236,0,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_43);float a1=smoothstep(e1,e2,x_43);float a2=smoothstep(e2,e3,x_43);float a3=smoothstep(e3,e4,x_43);float a4=smoothstep(e4,e5,x_43);float a5=smoothstep(e5,e6,x_43);float a6=smoothstep(e6,e7,x_43);float a7=smoothstep(e7,e8,x_43);return max(mix(v0,v1,a0)*step(e0,x_43)*step(x_43,e1),max(mix(v1,v2,a1)*step(e1,x_43)*step(x_43,e2),max(mix(v2,v3,a2)*step(e2,x_43)*step(x_43,e3),max(mix(v3,v4,a3)*step(e3,x_43)*step(x_43,e4),max(mix(v4,v5,a4)*step(e4,x_43)*step(x_43,e5),max(mix(v5,v6,a5)*step(e5,x_43)*step(x_43,e6),max(mix(v6,v7,a6)*step(e6,x_43)*step(x_43,e7),mix(v7,v8,a7)*step(e7,x_43)*step(x_43,e8))))))));}vec4 rainbow_soft_1310269270(float x_14){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.1;const vec4 v1=vec4(0.7803921568627451,0,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(1,0,0.4745098039215686,1);const float e3=0.3;const vec4 v3=vec4(1,0.4235294117647059,0,1);const float e4=0.4;const vec4 v4=vec4(0.8705882352941177,0.7607843137254902,0,1);const float e5=0.5;const vec4 v5=vec4(0.5882352941176471,1,0,1);const float e6=0.6;const vec4 v6=vec4(0,1,0.21568627450980393,1);const float e7=0.7;const vec4 v7=vec4(0,0.9647058823529412,0.5882352941176471,1);const float e8=0.8;const vec4 v8=vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);const float e9=0.9;const vec4 v9=vec4(0.403921568627451,0.2,0.9215686274509803,1);const float e10=1.0;const vec4 v10=vec4(0.48627450980392156,0,0.7294117647058823,1);float a0=smoothstep(e0,e1,x_14);float a1=smoothstep(e1,e2,x_14);float a2=smoothstep(e2,e3,x_14);float a3=smoothstep(e3,e4,x_14);float a4=smoothstep(e4,e5,x_14);float a5=smoothstep(e5,e6,x_14);float a6=smoothstep(e6,e7,x_14);float a7=smoothstep(e7,e8,x_14);float a8=smoothstep(e8,e9,x_14);float a9=smoothstep(e9,e10,x_14);return max(mix(v0,v1,a0)*step(e0,x_14)*step(x_14,e1),max(mix(v1,v2,a1)*step(e1,x_14)*step(x_14,e2),max(mix(v2,v3,a2)*step(e2,x_14)*step(x_14,e3),max(mix(v3,v4,a3)*step(e3,x_14)*step(x_14,e4),max(mix(v4,v5,a4)*step(e4,x_14)*step(x_14,e5),max(mix(v5,v6,a5)*step(e5,x_14)*step(x_14,e6),max(mix(v6,v7,a6)*step(e6,x_14)*step(x_14,e7),max(mix(v7,v8,a7)*step(e7,x_14)*step(x_14,e8),max(mix(v8,v9,a8)*step(e8,x_14)*step(x_14,e9),mix(v9,v10,a9)*step(e9,x_14)*step(x_14,e10))))))))));}vec4 bathymetry(float x_36){const float e0=0.0;const vec4 v0=vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);const float e1=0.13;const vec4 v1=vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);const float e2=0.25;const vec4 v2=vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);const float e4=0.5;const vec4 v4=vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);const float e5=0.63;const vec4 v5=vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.996078431372549,0.8,1);float a0=smoothstep(e0,e1,x_36);float a1=smoothstep(e1,e2,x_36);float a2=smoothstep(e2,e3,x_36);float a3=smoothstep(e3,e4,x_36);float a4=smoothstep(e4,e5,x_36);float a5=smoothstep(e5,e6,x_36);float a6=smoothstep(e6,e7,x_36);float a7=smoothstep(e7,e8,x_36);return max(mix(v0,v1,a0)*step(e0,x_36)*step(x_36,e1),max(mix(v1,v2,a1)*step(e1,x_36)*step(x_36,e2),max(mix(v2,v3,a2)*step(e2,x_36)*step(x_36,e3),max(mix(v3,v4,a3)*step(e3,x_36)*step(x_36,e4),max(mix(v4,v5,a4)*step(e4,x_36)*step(x_36,e5),max(mix(v5,v6,a5)*step(e5,x_36)*step(x_36,e6),max(mix(v6,v7,a6)*step(e6,x_36)*step(x_36,e7),mix(v7,v8,a7)*step(e7,x_36)*step(x_36,e8))))))));}vec4 cdom(float x_7){const float e0=0.0;const vec4 v0=vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);const float e1=0.13;const vec4 v1=vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);const float e2=0.25;const vec4 v2=vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);const float e3=0.38;const vec4 v3=vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);const float e5=0.63;const vec4 v5=vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);const float e6=0.75;const vec4 v6=vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);float a0=smoothstep(e0,e1,x_7);float a1=smoothstep(e1,e2,x_7);float a2=smoothstep(e2,e3,x_7);float a3=smoothstep(e3,e4,x_7);float a4=smoothstep(e4,e5,x_7);float a5=smoothstep(e5,e6,x_7);float a6=smoothstep(e6,e7,x_7);float a7=smoothstep(e7,e8,x_7);return max(mix(v0,v1,a0)*step(e0,x_7)*step(x_7,e1),max(mix(v1,v2,a1)*step(e1,x_7)*step(x_7,e2),max(mix(v2,v3,a2)*step(e2,x_7)*step(x_7,e3),max(mix(v3,v4,a3)*step(e3,x_7)*step(x_7,e4),max(mix(v4,v5,a4)*step(e4,x_7)*step(x_7,e5),max(mix(v5,v6,a5)*step(e5,x_7)*step(x_7,e6),max(mix(v6,v7,a6)*step(e6,x_7)*step(x_7,e7),mix(v7,v8,a7)*step(e7,x_7)*step(x_7,e8))))))));}vec4 chlorophyll(float x_6){const float e0=0.0;const vec4 v0=vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);const float e1=0.13;const vec4 v1=vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);const float e3=0.38;const vec4 v3=vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);const float e4=0.5;const vec4 v4=vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);const float e5=0.63;const vec4 v5=vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);const float e6=0.75;const vec4 v6=vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);const float e7=0.88;const vec4 v7=vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);const float e8=1.0;const vec4 v8=vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);float a0=smoothstep(e0,e1,x_6);float a1=smoothstep(e1,e2,x_6);float a2=smoothstep(e2,e3,x_6);float a3=smoothstep(e3,e4,x_6);float a4=smoothstep(e4,e5,x_6);float a5=smoothstep(e5,e6,x_6);float a6=smoothstep(e6,e7,x_6);float a7=smoothstep(e7,e8,x_6);return max(mix(v0,v1,a0)*step(e0,x_6)*step(x_6,e1),max(mix(v1,v2,a1)*step(e1,x_6)*step(x_6,e2),max(mix(v2,v3,a2)*step(e2,x_6)*step(x_6,e3),max(mix(v3,v4,a3)*step(e3,x_6)*step(x_6,e4),max(mix(v4,v5,a4)*step(e4,x_6)*step(x_6,e5),max(mix(v5,v6,a5)*step(e5,x_6)*step(x_6,e6),max(mix(v6,v7,a6)*step(e6,x_6)*step(x_6,e7),mix(v7,v8,a7)*step(e7,x_6)*step(x_6,e8))))))));}vec4 density(float x_19){const float e0=0.0;const vec4 v0=vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);const float e2=0.25;const vec4 v2=vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);const float e3=0.38;const vec4 v3=vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);const float e4=0.5;const vec4 v4=vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);const float e5=0.63;const vec4 v5=vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);const float e6=0.75;const vec4 v6=vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);const float e7=0.88;const vec4 v7=vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);const float e8=1.0;const vec4 v8=vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);float a0=smoothstep(e0,e1,x_19);float a1=smoothstep(e1,e2,x_19);float a2=smoothstep(e2,e3,x_19);float a3=smoothstep(e3,e4,x_19);float a4=smoothstep(e4,e5,x_19);float a5=smoothstep(e5,e6,x_19);float a6=smoothstep(e6,e7,x_19);float a7=smoothstep(e7,e8,x_19);return max(mix(v0,v1,a0)*step(e0,x_19)*step(x_19,e1),max(mix(v1,v2,a1)*step(e1,x_19)*step(x_19,e2),max(mix(v2,v3,a2)*step(e2,x_19)*step(x_19,e3),max(mix(v3,v4,a3)*step(e3,x_19)*step(x_19,e4),max(mix(v4,v5,a4)*step(e4,x_19)*step(x_19,e5),max(mix(v5,v6,a5)*step(e5,x_19)*step(x_19,e6),max(mix(v6,v7,a6)*step(e6,x_19)*step(x_19,e7),mix(v7,v8,a7)*step(e7,x_19)*step(x_19,e8))))))));}vec4 freesurface_blue_3154355989(float x_35){const float e0=0.0;const vec4 v0=vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);const float e1=0.13;const vec4 v1=vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);const float e3=0.38;const vec4 v3=vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);const float e4=0.5;const vec4 v4=vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);const float e5=0.63;const vec4 v5=vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);const float e6=0.75;const vec4 v6=vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);const float e7=0.88;const vec4 v7=vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_35);float a1=smoothstep(e1,e2,x_35);float a2=smoothstep(e2,e3,x_35);float a3=smoothstep(e3,e4,x_35);float a4=smoothstep(e4,e5,x_35);float a5=smoothstep(e5,e6,x_35);float a6=smoothstep(e6,e7,x_35);float a7=smoothstep(e7,e8,x_35);return max(mix(v0,v1,a0)*step(e0,x_35)*step(x_35,e1),max(mix(v1,v2,a1)*step(e1,x_35)*step(x_35,e2),max(mix(v2,v3,a2)*step(e2,x_35)*step(x_35,e3),max(mix(v3,v4,a3)*step(e3,x_35)*step(x_35,e4),max(mix(v4,v5,a4)*step(e4,x_35)*step(x_35,e5),max(mix(v5,v6,a5)*step(e5,x_35)*step(x_35,e6),max(mix(v6,v7,a6)*step(e6,x_35)*step(x_35,e7),mix(v7,v8,a7)*step(e7,x_35)*step(x_35,e8))))))));}vec4 freesurface_red_1679163293(float x_20){const float e0=0.0;const vec4 v0=vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);const float e2=0.25;const vec4 v2=vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);const float e3=0.38;const vec4 v3=vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);const float e4=0.5;const vec4 v4=vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);const float e5=0.63;const vec4 v5=vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);const float e6=0.75;const vec4 v6=vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_20);float a1=smoothstep(e1,e2,x_20);float a2=smoothstep(e2,e3,x_20);float a3=smoothstep(e3,e4,x_20);float a4=smoothstep(e4,e5,x_20);float a5=smoothstep(e5,e6,x_20);float a6=smoothstep(e6,e7,x_20);float a7=smoothstep(e7,e8,x_20);return max(mix(v0,v1,a0)*step(e0,x_20)*step(x_20,e1),max(mix(v1,v2,a1)*step(e1,x_20)*step(x_20,e2),max(mix(v2,v3,a2)*step(e2,x_20)*step(x_20,e3),max(mix(v3,v4,a3)*step(e3,x_20)*step(x_20,e4),max(mix(v4,v5,a4)*step(e4,x_20)*step(x_20,e5),max(mix(v5,v6,a5)*step(e5,x_20)*step(x_20,e6),max(mix(v6,v7,a6)*step(e6,x_20)*step(x_20,e7),mix(v7,v8,a7)*step(e7,x_20)*step(x_20,e8))))))));}vec4 oxygen(float x_11){const float e0=0.0;const vec4 v0=vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);const float e1=0.13;const vec4 v1=vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);const float e2=0.25;const vec4 v2=vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);const float e5=0.63;const vec4 v5=vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);const float e6=0.75;const vec4 v6=vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);const float e8=1.0;const vec4 v8=vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);float a0=smoothstep(e0,e1,x_11);float a1=smoothstep(e1,e2,x_11);float a2=smoothstep(e2,e3,x_11);float a3=smoothstep(e3,e4,x_11);float a4=smoothstep(e4,e5,x_11);float a5=smoothstep(e5,e6,x_11);float a6=smoothstep(e6,e7,x_11);float a7=smoothstep(e7,e8,x_11);return max(mix(v0,v1,a0)*step(e0,x_11)*step(x_11,e1),max(mix(v1,v2,a1)*step(e1,x_11)*step(x_11,e2),max(mix(v2,v3,a2)*step(e2,x_11)*step(x_11,e3),max(mix(v3,v4,a3)*step(e3,x_11)*step(x_11,e4),max(mix(v4,v5,a4)*step(e4,x_11)*step(x_11,e5),max(mix(v5,v6,a5)*step(e5,x_11)*step(x_11,e6),max(mix(v6,v7,a6)*step(e6,x_11)*step(x_11,e7),mix(v7,v8,a7)*step(e7,x_11)*step(x_11,e8))))))));}vec4 par(float x_28){const float e0=0.0;const vec4 v0=vec4(0.2,0.0784313725490196,0.09411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);const float e2=0.25;const vec4 v2=vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);const float e3=0.38;const vec4 v3=vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);const float e4=0.5;const vec4 v4=vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);const float e5=0.63;const vec4 v5=vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);const float e6=0.75;const vec4 v6=vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);const float e7=0.88;const vec4 v7=vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);const float e8=1.0;const vec4 v8=vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);float a0=smoothstep(e0,e1,x_28);float a1=smoothstep(e1,e2,x_28);float a2=smoothstep(e2,e3,x_28);float a3=smoothstep(e3,e4,x_28);float a4=smoothstep(e4,e5,x_28);float a5=smoothstep(e5,e6,x_28);float a6=smoothstep(e6,e7,x_28);float a7=smoothstep(e7,e8,x_28);return max(mix(v0,v1,a0)*step(e0,x_28)*step(x_28,e1),max(mix(v1,v2,a1)*step(e1,x_28)*step(x_28,e2),max(mix(v2,v3,a2)*step(e2,x_28)*step(x_28,e3),max(mix(v3,v4,a3)*step(e3,x_28)*step(x_28,e4),max(mix(v4,v5,a4)*step(e4,x_28)*step(x_28,e5),max(mix(v5,v6,a5)*step(e5,x_28)*step(x_28,e6),max(mix(v6,v7,a6)*step(e6,x_28)*step(x_28,e7),mix(v7,v8,a7)*step(e7,x_28)*step(x_28,e8))))))));}vec4 phase(float x_39){const float e0=0.0;const vec4 v0=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);const float e3=0.38;const vec4 v3=vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);const float e4=0.5;const vec4 v4=vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);const float e5=0.63;const vec4 v5=vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);const float e6=0.75;const vec4 v6=vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);const float e7=0.88;const vec4 v7=vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);const float e8=1.0;const vec4 v8=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);float a0=smoothstep(e0,e1,x_39);float a1=smoothstep(e1,e2,x_39);float a2=smoothstep(e2,e3,x_39);float a3=smoothstep(e3,e4,x_39);float a4=smoothstep(e4,e5,x_39);float a5=smoothstep(e5,e6,x_39);float a6=smoothstep(e6,e7,x_39);float a7=smoothstep(e7,e8,x_39);return max(mix(v0,v1,a0)*step(e0,x_39)*step(x_39,e1),max(mix(v1,v2,a1)*step(e1,x_39)*step(x_39,e2),max(mix(v2,v3,a2)*step(e2,x_39)*step(x_39,e3),max(mix(v3,v4,a3)*step(e3,x_39)*step(x_39,e4),max(mix(v4,v5,a4)*step(e4,x_39)*step(x_39,e5),max(mix(v5,v6,a5)*step(e5,x_39)*step(x_39,e6),max(mix(v6,v7,a6)*step(e6,x_39)*step(x_39,e7),mix(v7,v8,a7)*step(e7,x_39)*step(x_39,e8))))))));}vec4 salinity(float x_26){const float e0=0.0;const vec4 v0=vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);const float e1=0.13;const vec4 v1=vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);const float e2=0.25;const vec4 v2=vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);const float e3=0.38;const vec4 v3=vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);const float e4=0.5;const vec4 v4=vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);const float e5=0.63;const vec4 v5=vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);const float e7=0.88;const vec4 v7=vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);float a0=smoothstep(e0,e1,x_26);float a1=smoothstep(e1,e2,x_26);float a2=smoothstep(e2,e3,x_26);float a3=smoothstep(e3,e4,x_26);float a4=smoothstep(e4,e5,x_26);float a5=smoothstep(e5,e6,x_26);float a6=smoothstep(e6,e7,x_26);float a7=smoothstep(e7,e8,x_26);return max(mix(v0,v1,a0)*step(e0,x_26)*step(x_26,e1),max(mix(v1,v2,a1)*step(e1,x_26)*step(x_26,e2),max(mix(v2,v3,a2)*step(e2,x_26)*step(x_26,e3),max(mix(v3,v4,a3)*step(e3,x_26)*step(x_26,e4),max(mix(v4,v5,a4)*step(e4,x_26)*step(x_26,e5),max(mix(v5,v6,a5)*step(e5,x_26)*step(x_26,e6),max(mix(v6,v7,a6)*step(e6,x_26)*step(x_26,e7),mix(v7,v8,a7)*step(e7,x_26)*step(x_26,e8))))))));}vec4 temperature(float x_8){const float e0=0.0;const vec4 v0=vec4(0.01568627450980392,0.13725490196078433,0.2,1);const float e1=0.13;const vec4 v1=vec4(0.09019607843137255,0.2,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);const float e4=0.5;const vec4 v4=vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);const float e5=0.63;const vec4 v5=vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);const float e8=1.0;const vec4 v8=vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);float a0=smoothstep(e0,e1,x_8);float a1=smoothstep(e1,e2,x_8);float a2=smoothstep(e2,e3,x_8);float a3=smoothstep(e3,e4,x_8);float a4=smoothstep(e4,e5,x_8);float a5=smoothstep(e5,e6,x_8);float a6=smoothstep(e6,e7,x_8);float a7=smoothstep(e7,e8,x_8);return max(mix(v0,v1,a0)*step(e0,x_8)*step(x_8,e1),max(mix(v1,v2,a1)*step(e1,x_8)*step(x_8,e2),max(mix(v2,v3,a2)*step(e2,x_8)*step(x_8,e3),max(mix(v3,v4,a3)*step(e3,x_8)*step(x_8,e4),max(mix(v4,v5,a4)*step(e4,x_8)*step(x_8,e5),max(mix(v5,v6,a5)*step(e5,x_8)*step(x_8,e6),max(mix(v6,v7,a6)*step(e6,x_8)*step(x_8,e7),mix(v7,v8,a7)*step(e7,x_8)*step(x_8,e8))))))));}vec4 turbidity(float x_40){const float e0=0.0;const vec4 v0=vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);const float e1=0.13;const vec4 v1=vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);const float e3=0.38;const vec4 v3=vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);const float e4=0.5;const vec4 v4=vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);const float e5=0.63;const vec4 v5=vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);const float e6=0.75;const vec4 v6=vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);const float e8=1.0;const vec4 v8=vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);float a0=smoothstep(e0,e1,x_40);float a1=smoothstep(e1,e2,x_40);float a2=smoothstep(e2,e3,x_40);float a3=smoothstep(e3,e4,x_40);float a4=smoothstep(e4,e5,x_40);float a5=smoothstep(e5,e6,x_40);float a6=smoothstep(e6,e7,x_40);float a7=smoothstep(e7,e8,x_40);return max(mix(v0,v1,a0)*step(e0,x_40)*step(x_40,e1),max(mix(v1,v2,a1)*step(e1,x_40)*step(x_40,e2),max(mix(v2,v3,a2)*step(e2,x_40)*step(x_40,e3),max(mix(v3,v4,a3)*step(e3,x_40)*step(x_40,e4),max(mix(v4,v5,a4)*step(e4,x_40)*step(x_40,e5),max(mix(v5,v6,a5)*step(e5,x_40)*step(x_40,e6),max(mix(v6,v7,a6)*step(e6,x_40)*step(x_40,e7),mix(v7,v8,a7)*step(e7,x_40)*step(x_40,e8))))))));}vec4 velocity_blue_297387650(float x_2){const float e0=0.0;const vec4 v0=vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);const float e1=0.13;const vec4 v1=vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);const float e3=0.38;const vec4 v3=vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);const float e4=0.5;const vec4 v4=vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);const float e5=0.63;const vec4 v5=vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);const float e6=0.75;const vec4 v6=vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);const float e7=0.88;const vec4 v7=vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);float a0=smoothstep(e0,e1,x_2);float a1=smoothstep(e1,e2,x_2);float a2=smoothstep(e2,e3,x_2);float a3=smoothstep(e3,e4,x_2);float a4=smoothstep(e4,e5,x_2);float a5=smoothstep(e5,e6,x_2);float a6=smoothstep(e6,e7,x_2);float a7=smoothstep(e7,e8,x_2);return max(mix(v0,v1,a0)*step(e0,x_2)*step(x_2,e1),max(mix(v1,v2,a1)*step(e1,x_2)*step(x_2,e2),max(mix(v2,v3,a2)*step(e2,x_2)*step(x_2,e3),max(mix(v3,v4,a3)*step(e3,x_2)*step(x_2,e4),max(mix(v4,v5,a4)*step(e4,x_2)*step(x_2,e5),max(mix(v5,v6,a5)*step(e5,x_2)*step(x_2,e6),max(mix(v6,v7,a6)*step(e6,x_2)*step(x_2,e7),mix(v7,v8,a7)*step(e7,x_2)*step(x_2,e8))))))));}vec4 velocity_green_2558432129(float x_27){const float e0=0.0;const vec4 v0=vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);const float e1=0.13;const vec4 v1=vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);const float e3=0.38;const vec4 v3=vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);const float e4=0.5;const vec4 v4=vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);const float e5=0.63;const vec4 v5=vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);const float e6=0.75;const vec4 v6=vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);const float e7=0.88;const vec4 v7=vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);const float e8=1.0;const vec4 v8=vec4(1,0.9921568627450981,0.803921568627451,1);float a0=smoothstep(e0,e1,x_27);float a1=smoothstep(e1,e2,x_27);float a2=smoothstep(e2,e3,x_27);float a3=smoothstep(e3,e4,x_27);float a4=smoothstep(e4,e5,x_27);float a5=smoothstep(e5,e6,x_27);float a6=smoothstep(e6,e7,x_27);float a7=smoothstep(e7,e8,x_27);return max(mix(v0,v1,a0)*step(e0,x_27)*step(x_27,e1),max(mix(v1,v2,a1)*step(e1,x_27)*step(x_27,e2),max(mix(v2,v3,a2)*step(e2,x_27)*step(x_27,e3),max(mix(v3,v4,a3)*step(e3,x_27)*step(x_27,e4),max(mix(v4,v5,a4)*step(e4,x_27)*step(x_27,e5),max(mix(v5,v6,a5)*step(e5,x_27)*step(x_27,e6),max(mix(v6,v7,a6)*step(e6,x_27)*step(x_27,e7),mix(v7,v8,a7)*step(e7,x_27)*step(x_27,e8))))))));}vec4 cubehelix(float x_37){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.07;const vec4 v1=vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);const float e2=0.13;const vec4 v2=vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);const float e3=0.2;const vec4 v3=vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);const float e4=0.27;const vec4 v4=vec4(0.6313725490196078,0,0.5764705882352941,1);const float e5=0.33;const vec4 v5=vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);const float e6=0.4;const vec4 v6=vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);const float e7=0.47;const vec4 v7=vec4(1,0.11372549019607843,0.3803921568627451,1);const float e8=0.53;const vec4 v8=vec4(1,0.21176470588235294,0.27058823529411763,1);const float e9=0.6;const vec4 v9=vec4(1,0.3333333333333333,0.1803921568627451,1);const float e10=0.67;const vec4 v10=vec4(1,0.47058823529411764,0.13333333333333333,1);const float e11=0.73;const vec4 v11=vec4(1,0.615686274509804,0.1450980392156863,1);const float e12=0.8;const vec4 v12=vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);const float e13=0.87;const vec4 v13=vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);const float e14=0.93;const vec4 v14=vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);const float e15=1.0;const vec4 v15=vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);float a0=smoothstep(e0,e1,x_37);float a1=smoothstep(e1,e2,x_37);float a2=smoothstep(e2,e3,x_37);float a3=smoothstep(e3,e4,x_37);float a4=smoothstep(e4,e5,x_37);float a5=smoothstep(e5,e6,x_37);float a6=smoothstep(e6,e7,x_37);float a7=smoothstep(e7,e8,x_37);float a8=smoothstep(e8,e9,x_37);float a9=smoothstep(e9,e10,x_37);float a10=smoothstep(e10,e11,x_37);float a11=smoothstep(e11,e12,x_37);float a12=smoothstep(e12,e13,x_37);float a13=smoothstep(e13,e14,x_37);float a14=smoothstep(e14,e15,x_37);return max(mix(v0,v1,a0)*step(e0,x_37)*step(x_37,e1),max(mix(v1,v2,a1)*step(e1,x_37)*step(x_37,e2),max(mix(v2,v3,a2)*step(e2,x_37)*step(x_37,e3),max(mix(v3,v4,a3)*step(e3,x_37)*step(x_37,e4),max(mix(v4,v5,a4)*step(e4,x_37)*step(x_37,e5),max(mix(v5,v6,a5)*step(e5,x_37)*step(x_37,e6),max(mix(v6,v7,a6)*step(e6,x_37)*step(x_37,e7),max(mix(v7,v8,a7)*step(e7,x_37)*step(x_37,e8),max(mix(v8,v9,a8)*step(e8,x_37)*step(x_37,e9),max(mix(v9,v10,a9)*step(e9,x_37)*step(x_37,e10),max(mix(v10,v11,a10)*step(e10,x_37)*step(x_37,e11),max(mix(v11,v12,a11)*step(e11,x_37)*step(x_37,e12),max(mix(v12,v13,a12)*step(e12,x_37)*step(x_37,e13),max(mix(v13,v14,a13)*step(e13,x_37)*step(x_37,e14),mix(v14,v15,a14)*step(e14,x_37)*step(x_37,e15)))))))))))))));}float sample_and_apply_contrast_limits(SAMPLER_TYPE channel,vec3 vTexCoord,vec2 contrastLimits){float fragIntensity=float(texture(channel,vTexCoord).r);float contrastLimitsAppliedToIntensity=(fragIntensity-contrastLimits[0])/max(0.0005,(contrastLimits[1]-contrastLimits[0]));return max(0.,contrastLimitsAppliedToIntensity);}vec4 colormap(float intensity,float opacity){return vec4(COLORMAP_FUNCTION(min(1.,intensity)).xyz,opacity);}\"; // eslint-disable-line\n\nvar channels = {\n  name: 'channel-intensity-module',\n  fs\n};\n\nconst RENDERING_MODES_BLEND = {\n  [RENDERING_MODES.MAX_INTENSITY_PROJECTION]: {\n    _BEFORE_RENDER: `\\\n      float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);\n    `,\n    _RENDER: `\\\n    \n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\n      for(int i = 0; i < 6; i++) {\n        if(intensityArray[i] > maxVals[i]) {\n          maxVals[i] = intensityArray[i];\n        }\n      }\n    `,\n    _AFTER_RENDER: `\\\n      vec3 rgbCombo = vec3(0.0);\n      for(int i = 0; i < 6; i++) {\n        rgbCombo += max(0.0, min(1.0, maxVals[i])) * vec3(colors[i]);\n      }\n      color = vec4(rgbCombo, 1.0);\n    `\n  },\n  [RENDERING_MODES.MIN_INTENSITY_PROJECTION]: {\n    _BEFORE_RENDER: `\\\n      float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);\n    `,\n    _RENDER: `\\\n    \n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\n      for(int i = 0; i < 6; i++) {\n        if(intensityArray[i] < minVals[i]) {\n          minVals[i] = intensityArray[i];\n        }\n      }\n    `,\n    _AFTER_RENDER: `\\\n      vec3 rgbCombo = vec3(0.0);\n      for(int i = 0; i < 6; i++) {\n        rgbCombo += max(0.0, min(1.0, minVals[i])) * vec3(colors[i]);\n      }\n      color = vec4(rgbCombo, 1.0);\n    `\n  },\n  [RENDERING_MODES.ADDITIVE]: {\n    _BEFORE_RENDER: ``,\n    _RENDER: `\\\n      vec3 rgbCombo = vec3(0.0);\n      vec3 hsvCombo = vec3(0.0);\n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n      float total = 0.0;\n      for(int i = 0; i < 6; i++) {\n        float intensityValue = intensityArray[i];\n        rgbCombo += max(0.0, min(1.0, intensityValue)) * colors[i];\n        total += intensityValue;\n      }\n      // Do not go past 1 in opacity.\n      total = min(total, 1.0);\n      vec4 val_color = vec4(rgbCombo, total);\n      // Opacity correction\n      val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);\n      color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n      color.a += (1.0 - color.a) * val_color.a;\n      if (color.a >= 0.95) {\n        break;\n      }\n    `,\n    _AFTER_RENDER: ``\n  }\n};\n\nconst RENDERING_MODES_COLORMAP = {\n  [RENDERING_MODES.MAX_INTENSITY_PROJECTION]: {\n    _BEFORE_RENDER: `\\\n      float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);\n    `,\n    _RENDER: `\\\n    \n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\n      for(int i = 0; i < 6; i++) {\n        if(intensityArray[i] > maxVals[i]) {\n          maxVals[i] = intensityArray[i];\n        }\n      }\n    `,\n    _AFTER_RENDER: `\\\n      float total = 0.0;\n      for(int i = 0; i < 6; i++) {\n        total += maxVals[i];\n      }\n      // Do not go past 1 in opacity/colormap value.\n      total = min(total, 1.0);\n      color = colormap(total, total);\n    `\n  },\n  [RENDERING_MODES.MIN_INTENSITY_PROJECTION]: {\n    _BEFORE_RENDER: `\\\n      float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);\n    `,\n    _RENDER: `\\\n    \n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\n      for(int i = 0; i < 6; i++) {\n        if(intensityArray[i] < minVals[i]) {\n          minVals[i] = intensityArray[i];\n        }\n      }\n    `,\n    _AFTER_RENDER: `\\\n      float total = 0.0;\n      for(int i = 0; i < 6; i++) {\n        total += minVals[i];\n      }\n      // Do not go past 1 in opacity/colormap value.\n      total = min(total, 1.0);\n      color = colormap(total, total);\n    `\n  },\n  [RENDERING_MODES.ADDITIVE]: {\n    _BEFORE_RENDER: ``,\n    _RENDER: `\\\n    float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\t\tfloat total = 0.0;\n\n\t\tfor(int i = 0; i < 6; i++) {\n\t\t\ttotal += intensityArray[i];\n\t\t}\n\t\t// Do not go past 1 in opacity/colormap value.\n\t\ttotal = min(total, 1.0);\n\n\t\tvec4 val_color = colormap(total, total);\n\n\t\t// Opacity correction\n\t\tval_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);\n\t\tcolor.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n\t\tcolor.a += (1.0 - color.a) * val_color.a;\n\t\tif (color.a >= 0.95) {\n\t\t\tbreak;\n\t\t}\n    p += ray_dir * dt;\n    `,\n    _AFTER_RENDER: ``\n  }\n};\n\n/* This is largely an adaptation of Will Usher's excellent blog post/code:\nhttps://github.com/Twinklebear/webgl-volume-raycaster\nWithout his app, this would have been exponentially more difficult to do, so we thank him dearly.\n\nThe major changes are:\n\n- Code has been adapted to the luma.gl/deck.gl framework instead of more-or-less pure WebGL.\n\n- We use a coordinate system that will allow overlays/other figures on our vertex shader/javascript via the `uniform mat4 scale` that matches raw pixel size multiplied by\nthe ratio of physical sizes (if present) to the world space, just like our 2D layers.  Will implements everything in a unit cube (I think?) centered at the origin.\n\n- We use an OrbitView which is a similar camera to what Will has, but stops gimbal lock from happening\nby stopping full rotations whereas Will implements a camera that allows for full rotations without gimbal lock via quaternions.\nWe have an open issue for implementing this deck.gl: https://github.com/visgl/deck.gl/issues/5364\n\n- We have a multi-channel use case and have a few tweaks in the fragment shader to handle that.\n\n- We convert all of our data to Float32Array so we can use LINEAR sampling while also maintaing the dynamic range and integrity of the data.\n\n- Will uses a colormap via a sampled texture, which is a very good idea, but not something we are geared up for in 2D, so not something we will do in 3D either: \nhttps://github.com/visgl/luma.gl/issues/1415\n\n- We allow for multiple rendering settings (Max/Min Int. Proj., Additive, etc.)\n\n- We allow for arbtirary affine transformations via deck.gl's modelMatrix prop and have updated the vertex shader accordingly.\nMore information about that is detailed in the comments there.\n*/\n\n// prettier-ignore\nconst CUBE_STRIP = [\n\t1, 1, 0,\n\t0, 1, 0,\n\t1, 1, 1,\n\t0, 1, 1,\n\t0, 0, 1,\n\t0, 1, 0,\n\t0, 0, 0,\n\t1, 1, 0,\n\t1, 0, 0,\n\t1, 1, 1,\n\t1, 0, 1,\n\t0, 0, 1,\n\t1, 0, 0,\n\t0, 0, 0\n];\nconst NUM_PLANES_DEFAULT = 1;\n\nconst defaultProps$1 = {\n  pickable: false,\n  coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n  channelData: { type: 'object', value: {}, compare: true },\n  colors: { type: 'array', value: [], compare: true },\n  contrastLimits: { type: 'array', value: [], compare: true },\n  dtype: { type: 'string', value: 'Uint8', compare: true },\n  colormap: { type: 'string', value: '', compare: true },\n  xSlice: { type: 'array', value: null, compare: true },\n  ySlice: { type: 'array', value: null, compare: true },\n  zSlice: { type: 'array', value: null, compare: true },\n  clippingPlanes: { type: 'array', value: [], compare: true },\n  renderingMode: {\n    type: 'string',\n    value: RENDERING_MODES.ADDITIVE,\n    compare: true\n  },\n  resolutionMatrix: { type: 'object', value: new Matrix4(), compare: true }\n};\n\nfunction getRenderingAttrs() {\n  const values = getDtypeValues('Float32');\n  return {\n    ...values,\n    sampler: values.sampler.replace('2D', '3D'),\n    cast: data => new Float32Array(data)\n  };\n}\n\nfunction removeExtraColormapFunctionsFromShader(colormap) {\n  // Always include viridis so shaders compile,\n  // but otherwise we discard all other colormaps via a regex.\n  // With all the colormaps, the shaders were too large\n  // and crashed our computers when we loaded volumes too large.\n  const discardColormaps = COLORMAPS.filter(\n    i => i !== (colormap || 'viridis')\n  ).map(i => i.replace(/-/g, '_'));\n  const discardRegex = new RegExp(\n    `vec4 (${discardColormaps.join(\n      '(_([0-9]*))?|'\n    )})\\\\(float x_[0-9]+\\\\){([^}]+)}`,\n    'g'\n  );\n  const channelsModules = {\n    ...channels,\n    fs: channels.fs.replace(discardRegex, ''),\n    defines: {\n      COLORMAP_FUNCTION: colormap || 'viridis'\n    }\n  };\n  return channelsModules;\n}\n\n/**\n * @typedef LayerProps\n * @type {Object}\n * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.\n * @property {Array.<Array.<number>>} colors List of [r, g, b] values for each channel.\n * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.\n * @property {string} dtype Dtype for the layer.\n * @property {string=} colormap String indicating a colormap (default: '').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap\n * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').\n * @property {string=} renderingMode One of Maximum Intensity Projection, Minimum Intensity Projection, or Additive\n * @property {Object=} modelMatrix A column major affine transformation to be applied to the volume.\n * @property {Array.<number>=} xSlice 0-width (physical coordinates) interval on which to slice the volume.\n * @property {Array.<number>=} ySlice 0-height (physical coordinates) interval on which to slice the volume.\n * @property {Array.<number>=} zSlice 0-depth (physical coordinates) interval on which to slice the volume.\n * @property {Array.<Object>=} clippingPlanes List of math.gl [Plane](https://math.gl/modules/culling/docs/api-reference/plane) objects.\n * @property {Object=} resolutionMatrix Matrix for scaling the volume based on the (downsampled) resolution being displayed.\n */\n\n/**\n * @type {{ new <S extends string[]>(...props: import('../../../types').Viv<LayerProps>[]) }}\n * @ignore\n */\nconst XR3DLayer = class extends Layer {\n  initializeState() {\n    const { gl } = this.context;\n    this.setState({\n      model: this._getModel(gl)\n    });\n    // This tells WebGL how to read row data from the texture.  For example, the default here is 4 (i.e for RGBA, one byte per channel) so\n    // each row of data is expected to be a multiple of 4.  This setting (i.e 1) allows us to have non-multiple-of-4 row sizes.  For example, for 2 byte (16 bit data),\n    // we could use 2 as the value and it would still work, but 1 also works fine (and is more flexible for 8 bit - 1 byte - textures as well).\n    // https://stackoverflow.com/questions/42789896/webgl-error-arraybuffer-not-big-enough-for-request-in-case-of-gl-luminance\n    gl.pixelStorei(GL.UNPACK_ALIGNMENT, 1);\n    gl.pixelStorei(GL.PACK_ALIGNMENT, 1);\n  }\n\n  /**\n   * This function compiles the shaders and the projection module.\n   */\n  getShaders() {\n    const { colormap, renderingMode, clippingPlanes } = this.props;\n    const { sampler } = getRenderingAttrs();\n    const { _BEFORE_RENDER, _RENDER, _AFTER_RENDER } = colormap\n      ? RENDERING_MODES_COLORMAP[renderingMode]\n      : RENDERING_MODES_BLEND[renderingMode];\n    const channelsModules = removeExtraColormapFunctionsFromShader(colormap);\n    return super.getShaders({\n      vs,\n      fs: fs$1\n        .replace('_BEFORE_RENDER', _BEFORE_RENDER)\n        .replace('_RENDER', _RENDER)\n        .replace('_AFTER_RENDER', _AFTER_RENDER),\n      defines: {\n        SAMPLER_TYPE: sampler,\n        COLORMAP_FUNCTION: colormap || 'viridis',\n        NUM_PLANES: String(clippingPlanes.length || NUM_PLANES_DEFAULT)\n      },\n      modules: [channelsModules]\n    });\n  }\n\n  /**\n   * This function finalizes state by clearing all textures from the WebGL context\n   */\n  finalizeState() {\n    super.finalizeState();\n\n    if (this.state.textures) {\n      Object.values(this.state.textures).forEach(tex => tex && tex.delete());\n    }\n  }\n\n  /**\n   * This function updates state by retriggering model creation (shader compilation and attribute binding)\n   * and loading any textures that need be loading.\n   */\n  updateState({ props, oldProps, changeFlags }) {\n    // setup model first\n    if (\n      changeFlags.extensionsChanged ||\n      props.colormap !== oldProps.colormap ||\n      props.renderingMode !== oldProps.renderingMode ||\n      props.clippingPlanes.length !== oldProps.clippingPlanes.length\n    ) {\n      const { gl } = this.context;\n      if (this.state.model) {\n        this.state.model.delete();\n      }\n      this.setState({ model: this._getModel(gl) });\n    }\n    if (\n      props.channelData &&\n      props?.channelData?.data !== oldProps?.channelData?.data\n    ) {\n      this.loadTexture(props.channelData);\n    }\n  }\n\n  /**\n   * This function creates the luma.gl model.\n   */\n  _getModel(gl) {\n    if (!gl) {\n      return null;\n    }\n    return new Model(gl, {\n      ...this.getShaders(),\n      geometry: new Geometry({\n        drawMode: gl.TRIANGLE_STRIP,\n        attributes: {\n          positions: new Float32Array(CUBE_STRIP)\n        }\n      })\n    });\n  }\n\n  /**\n   * This function runs the shaders and draws to the canvas\n   */\n  draw({ uniforms }) {\n    const { textures, model, scaleMatrix } = this.state;\n    const {\n      contrastLimits,\n      colors,\n      xSlice,\n      ySlice,\n      zSlice,\n      modelMatrix,\n      channelsVisible,\n      domain,\n      dtype,\n      clippingPlanes,\n      resolutionMatrix\n    } = this.props;\n    const {\n      viewMatrix,\n      viewMatrixInverse,\n      projectionMatrix\n    } = this.context.viewport;\n    if (textures && model && scaleMatrix) {\n      const { paddedContrastLimits, paddedColors } = padColorsAndWindows({\n        contrastLimits,\n        colors,\n        channelsVisible,\n        domain,\n        dtype\n      });\n      const invertedScaleMatrix = scaleMatrix.clone().invert();\n      const invertedResolutionMatrix = resolutionMatrix.clone().invert();\n      const paddedClippingPlanes = padWithDefault(\n        clippingPlanes.map(p =>\n          p\n            .clone()\n            .transform(invertedScaleMatrix)\n            .transform(invertedResolutionMatrix)\n        ),\n        new Plane([1, 0, 0]),\n        clippingPlanes.length || NUM_PLANES_DEFAULT\n      );\n      // Need to flatten for shaders.\n      const normals = paddedClippingPlanes.map(plane => plane.normal).flat();\n      const distances = paddedClippingPlanes.map(plane => plane.distance);\n      model\n        .setUniforms({\n          ...uniforms,\n          ...textures,\n          contrastLimits: paddedContrastLimits,\n          colors: paddedColors,\n          xSlice: new Float32Array(\n            xSlice\n              ? xSlice.map(i => i / scaleMatrix[0] / resolutionMatrix[0])\n              : [0, 1]\n          ),\n          ySlice: new Float32Array(\n            ySlice\n              ? ySlice.map(i => i / scaleMatrix[5] / resolutionMatrix[5])\n              : [0, 1]\n          ),\n          zSlice: new Float32Array(\n            zSlice\n              ? zSlice.map(i => i / scaleMatrix[10] / resolutionMatrix[10])\n              : [0, 1]\n          ),\n          eye_pos: new Float32Array([\n            viewMatrixInverse[12],\n            viewMatrixInverse[13],\n            viewMatrixInverse[14]\n          ]),\n          view: viewMatrix,\n          proj: projectionMatrix,\n          scale: scaleMatrix,\n          resolution: resolutionMatrix,\n          model: modelMatrix || new Matrix4(),\n          normals,\n          distances\n        })\n        .draw();\n    }\n  }\n\n  /**\n   * This function loads all textures from incoming resolved promises/data from the loaders by calling `dataToTexture`\n   */\n  loadTexture(channelData) {\n    const textures = {\n      volume0: null,\n      volume1: null,\n      volume2: null,\n      volume3: null,\n      volume4: null,\n      volume5: null\n    };\n    if (this.state.textures) {\n      Object.values(this.state.textures).forEach(tex => tex && tex.delete());\n    }\n    if (\n      channelData &&\n      Object.keys(channelData).length > 0 &&\n      channelData.data\n    ) {\n      const { height, width, depth } = channelData;\n      channelData.data.forEach((d, i) => {\n        textures[`volume${i}`] = this.dataToTexture(d, width, height, depth);\n      }, this);\n      this.setState({\n        textures,\n        scaleMatrix: new Matrix4().scale(\n          this.props.physicalSizeScalingMatrix.transformPoint([\n            width,\n            height,\n            depth\n          ])\n        )\n      });\n    }\n  }\n\n  /**\n   * This function creates textures from the data\n   */\n  dataToTexture(data, width, height, depth) {\n    const attrs = getRenderingAttrs();\n    const texture = new Texture3D(this.context.gl, {\n      width,\n      height,\n      depth,\n      data: attrs.cast?.(data) ?? data,\n      // ? Seems to be a luma.gl bug.  Looks like Texture2D is wrong or this is but these are flipped somewhere.\n      format: attrs.dataFormat,\n      dataFormat: attrs.format,\n      type: attrs.type,\n      mipmaps: false,\n      parameters: {\n        [GL.TEXTURE_MIN_FILTER]: GL.LINEAR,\n        [GL.TEXTURE_MAG_FILTER]: GL.LINEAR,\n        [GL.TEXTURE_WRAP_S]: GL.CLAMP_TO_EDGE,\n        [GL.TEXTURE_WRAP_T]: GL.CLAMP_TO_EDGE,\n        [GL.TEXTURE_WRAP_R]: GL.CLAMP_TO_EDGE\n      }\n    });\n    return texture;\n  }\n};\n\nXR3DLayer.layerName = 'XR3DLayer';\nXR3DLayer.defaultProps = defaultProps$1;\n\n/* global globalThis */\n\n/**\n * Creates a single continguous TypedArray that can visualized as a volume in 3D space where the y-axis going up is positive,\n * the x-axis going right is positive, and the z-axis coming out of the screen is positive.\n * To do this, and keep the orientation, we must anti-diagonally transpose each slice of raster data so that the (0, 0) data point is transformed\n * to the top right.  If you start the camera looking at the 0th slice (or rotate from looking at the final slice) in 3D, this becomes more apparent.\n * Of note here is that in 2D rendering, the y-axis is positive in the downward direction.\n *\n * @param {object} props\n * @param {object} props.source PixelSource\n * @param {object} props.selection A single selection for the PixelSource\n * @param {object} props.onUpdate A callback for progress that is called twice during the loading of each plane, once when the promsie resolves and once when it is loaded into the final contiguous buffer.\n * @param {object} props.downsampleDepth This is the number by which to downsample on the z direction, usually `2 ** resolution` where `resolution` is that of the `PixelSource` in the image pyramid.\n * The idea here is to get every `downsampleDepth` raster slice so that proper scaling is maintained (just liek a 2D image pyramid).\n * @return {TypedArray}\n * @ignore\n */\nasync function getVolume({\n  source,\n  selection,\n  onUpdate = () => {},\n  downsampleDepth = 1,\n  signal\n}) {\n  const { shape, labels, dtype } = source;\n  const { height, width } = getImageSize(source);\n  const depth = shape[labels.indexOf('z')];\n  const depthDownsampled = Math.max(1, Math.floor(depth / downsampleDepth));\n  const rasterSize = height * width;\n  const name = `${dtype}Array`;\n  const TypedArray = globalThis[name];\n  const volumeData = new TypedArray(rasterSize * depthDownsampled);\n  await Promise.all(\n    new Array(depthDownsampled).fill(0).map(async (_, z) => {\n      const depthSelection = {\n        ...selection,\n        z: z * downsampleDepth\n      };\n      const { data: rasterData } = await source.getRaster({\n        selection: depthSelection,\n        signal\n      });\n      let r = 0;\n      onUpdate();\n      // For now this process fills in each raster plane anti-diagonally transposed.\n      // This is to ensure that the image looks right in three dimensional space.\n      while (r < rasterSize) {\n        const volIndex = z * rasterSize + (rasterSize - r - 1);\n        const rasterIndex =\n          ((width - r - 1) % width) + width * Math.floor(r / width);\n        volumeData[volIndex] = rasterData[rasterIndex];\n        r += 1;\n      }\n      onUpdate();\n    })\n  );\n  return {\n    data: volumeData,\n    height,\n    width,\n    depth: depthDownsampled\n  };\n}\n\nconst getTextLayer = (text, viewport, id) => {\n  return new TextLayer({\n    id: `text-${id}`,\n    coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n    data: [\n      {\n        text,\n        position: viewport.position\n      }\n    ],\n    getColor: [220, 220, 220, 255],\n    getSize: 25,\n    sizeUnits: 'meters',\n    sizeScale: 2 ** -viewport.zoom,\n    fontFamily: 'Helvetica'\n  });\n};\n\nconst defaultProps = {\n  pickable: false,\n  coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n  contrastLimits: { type: 'array', value: [], compare: true },\n  channelsVisible: { type: 'array', value: [], compare: true },\n  colors: { type: 'array', value: [], compare: true },\n  colormap: { type: 'string', value: '', compare: true },\n  selections: { type: 'array', value: [], compare: true },\n  resolution: { type: 'number', value: 0, compare: true },\n  domain: { type: 'array', value: [], compare: true },\n  loader: {\n    type: 'object',\n    value: [\n      {\n        getRaster: async () => ({ data: [], height: 0, width: 0 }),\n        dtype: 'Uint16',\n        shape: [1],\n        labels: ['z']\n      }\n    ],\n    compare: true\n  },\n  xSlice: { type: 'array', value: null, compare: true },\n  ySlice: { type: 'array', value: null, compare: true },\n  zSlice: { type: 'array', value: null, compare: true },\n  clippingPlanes: { type: 'array', value: [], compare: true },\n  renderingMode: {\n    type: 'string',\n    value: RENDERING_MODES.MAX_INTENSITY_PROJECTION,\n    compare: true\n  },\n  onUpdate: { type: 'function', value: () => {}, compare: true },\n  useProgressIndicator: { type: 'boolean', value: true, compare: true },\n  useWebGL1Warning: { type: 'boolean', value: true, compare: true }\n};\n\n/**\n * @typedef LayerProps\n * @type {Object}\n * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.\n * @property {Array.<Array.<number>>} colors List of [r, g, b] values for each channel.\n * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.\n * @property {Array} loader PixelSource[]. Represents an N-dimensional image.\n * @property {Array} selections Selection to be used for fetching data.\n * @property {string=} colormap String indicating a colormap (default: '').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap\n * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').\n * @property {number=} resolution Resolution at which you would like to see the volume and load it into memory (0 highest, loader.length -1 the lowest default 0)\n * @property {string=} renderingMode One of Maximum Intensity Projection, Minimum Intensity Projection, or Additive\n * @property {Object=} modelMatrix A column major affine transformation to be applied to the volume.\n * @property {Array.<number>=} xSlice 0-width (physical coordinates) interval on which to slice the volume.\n * @property {Array.<number>=} ySlice 0-height (physical coordinates) interval on which to slice the volume.\n * @property {Array.<number>=} zSlice 0-depth (physical coordinates) interval on which to slice the volume.\n * @property {function=} onViewportLoad Function that gets called when the data in the viewport loads.\n * @property {Array.<Object>=} clippingPlanes List of math.gl [Plane](https://math.gl/modules/culling/docs/api-reference/plane) objects.\n * @property {boolean=} useProgressIndicator Whether or not to use the default progress text + indicator (default is true)\n * @property {boolean=} useWebGL1Warning Whether or not to use the default WebGL1 warning (default is true)\n * @property {function=} onUpdate A callback to be used for getting updates of the progress, ({ progress }) => {}\n */\n\n/**\n * @type {{ new <S extends string[]>(...props: import('../../types').Viv<LayerProps, S>[]) }}\n * @ignore\n */\nconst VolumeLayer = class extends CompositeLayer {\n  clearState() {\n    this.setState({\n      height: null,\n      width: null,\n      depth: null,\n      data: null,\n      physicalSizeScalingMatrix: null,\n      resolutionMatrix: null,\n      progress: 0,\n      abortController: null\n    });\n  }\n\n  finalizeState() {\n    this.state.abortController.abort();\n  }\n\n  updateState({ oldProps, props }) {\n    const loaderChanged = props.loader !== oldProps.loader;\n    const resolutionChanged = props.resolution !== oldProps.resolution;\n    const selectionsChanged = props.selections !== oldProps.selections;\n    // Only fetch new data to render if loader has changed\n    if (resolutionChanged) {\n      // Clear last volume.\n      this.clearState();\n    }\n    if (loaderChanged || selectionsChanged || resolutionChanged) {\n      const {\n        loader,\n        selections = [],\n        resolution,\n        onViewportLoad\n      } = this.props;\n      const source = loader[resolution];\n      let progress = 0;\n      const totalRequests =\n        // eslint-disable-next-line no-bitwise\n        (source.shape[source.labels.indexOf('z')] >> resolution) *\n        selections.length;\n      const onUpdate = () => {\n        progress += 0.5 / totalRequests;\n        if (this.props.onUpdate) {\n          this.props.onUpdate({ progress });\n        }\n        this.setState({ progress });\n      };\n      const abortController = new AbortController();\n      this.setState({ abortController });\n      const { signal } = abortController;\n      const volumePromises = selections.map(selection =>\n        getVolume({\n          selection,\n          source,\n          onUpdate,\n          downsampleDepth: 2 ** resolution,\n          signal\n        })\n      );\n      const physicalSizeScalingMatrix = getPhysicalSizeScalingMatrix(\n        loader[resolution]\n      );\n\n      Promise.all(volumePromises).then(volumes => {\n        if (onViewportLoad) {\n          onViewportLoad(volumes);\n        }\n        const volume = {\n          data: volumes.map(d => d.data),\n          width: volumes[0].width,\n          height: volumes[0].height,\n          depth: volumes[0].depth\n        };\n\n        this.setState({\n          ...volume,\n          physicalSizeScalingMatrix,\n          resolutionMatrix: new Matrix4().scale(2 ** resolution)\n        });\n      });\n    }\n  }\n\n  renderLayers() {\n    const {\n      loader,\n      id,\n      resolution,\n      useProgressIndicator,\n      useWebGL1Warning\n    } = this.props;\n    const { dtype } = loader[resolution];\n    const {\n      data,\n      width,\n      height,\n      depth,\n      progress,\n      physicalSizeScalingMatrix,\n      resolutionMatrix\n    } = this.state;\n    const { gl } = this.context;\n    if (!isWebGL2(gl) && useWebGL1Warning) {\n      const { viewport } = this.context;\n      return getTextLayer(\n        [\n          'Volume rendering is only available on browsers that support WebGL2. If you',\n          'are using Safari, you can turn on WebGL2 by navigating in the top menubar',\n          'to check Develop > Experimental Features > WebGL 2.0 and then refreshing',\n          'the page.'\n        ].join('\\n'),\n        viewport,\n        id\n      );\n    }\n    if (!(width && height) && useProgressIndicator) {\n      const { viewport } = this.context;\n      return getTextLayer(\n        `Loading Volume ${String((progress || 0) * 100).slice(0, 5)}%...`,\n        viewport,\n        id\n      );\n    }\n    return new XR3DLayer(this.props, {\n      channelData: { data, width, height, depth },\n      id: `XR3DLayer-${0}-${height}-${width}-${0}-${resolution}-${id}`,\n      physicalSizeScalingMatrix,\n      parameters: {\n        [GL.CULL_FACE]: true,\n        [GL.CULL_FACE_MODE]: GL.FRONT,\n        [GL.DEPTH_TEST]: false,\n        blendFunc: [GL.SRC_ALPHA, GL.ONE],\n        blend: true\n      },\n      resolutionMatrix,\n      dtype\n    });\n  }\n};\n\nVolumeLayer.layerName = 'VolumeLayer';\nVolumeLayer.defaultProps = defaultProps;\n\nconst areViewStatesEqual = (viewState, otherViewState) => {\n  return otherViewState === viewState || viewState?.zoom === otherViewState?.zoom && viewState?.rotationX === otherViewState?.rotationX && viewState?.rotationOrbit === otherViewState?.rotationOrbit && equal(viewState?.target, otherViewState?.target);\n};\nclass VivViewerWrapper extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      viewStates: {}\n    };\n    const { viewStates } = this.state;\n    const { views, viewStates: initialViewStates } = this.props;\n    views.forEach((view) => {\n      viewStates[view.id] = view.filterViewState({\n        viewState: initialViewStates.find((v) => v.id === view.id)\n      });\n    });\n    this._onViewStateChange = this._onViewStateChange.bind(this);\n    this.layerFilter = this.layerFilter.bind(this);\n    this.onHover = this.onHover.bind(this);\n  }\n  layerFilter({ layer, viewport }) {\n    return layer.id.includes(getVivId(viewport.id));\n  }\n  _onViewStateChange({ viewId, viewState, interactionState, oldViewState }) {\n    const { views, onViewStateChange } = this.props;\n    viewState = onViewStateChange && onViewStateChange({\n      viewId,\n      viewState,\n      interactionState,\n      oldViewState\n    }) || viewState;\n    this.setState((prevState) => {\n      const viewStates = {};\n      views.forEach((view) => {\n        const currentViewState = prevState.viewStates[view.id];\n        viewStates[view.id] = view.filterViewState({\n          viewState: { ...viewState, id: viewId },\n          oldViewState,\n          currentViewState\n        });\n      });\n      return { viewStates };\n    });\n    return viewState;\n  }\n  componentDidUpdate(prevProps) {\n    const { props } = this;\n    const { views } = props;\n    const viewStates = { ...this.state.viewStates };\n    let anyChanged = false;\n    views.forEach((view) => {\n      const currViewState = props.viewStates?.find((viewState) => viewState.id === view.id);\n      if (!currViewState) {\n        return;\n      }\n      const prevViewState = prevProps.viewStates?.find((viewState) => viewState.id === view.id);\n      if (areViewStatesEqual(currViewState, prevViewState)) {\n        return;\n      }\n      anyChanged = true;\n      const { height, width } = view;\n      viewStates[view.id] = view.filterViewState({\n        viewState: {\n          ...currViewState,\n          height,\n          width,\n          id: view.id\n        }\n      });\n    });\n    if (anyChanged) {\n      this.setState({ viewStates });\n    }\n  }\n  static getDerivedStateFromProps(props, prevState) {\n    const { views, viewStates: viewStatesProps } = props;\n    if (views.some((view) => !prevState.viewStates[view.id] || view.height !== prevState.viewStates[view.id].height || view.width !== prevState.viewStates[view.id].width)) {\n      const viewStates = {};\n      views.forEach((view) => {\n        const { height, width } = view;\n        const currentViewState = prevState.viewStates[view.id];\n        viewStates[view.id] = view.filterViewState({\n          viewState: {\n            ...currentViewState || viewStatesProps.find((v) => v.id === view.id),\n            height,\n            width,\n            id: view.id\n          }\n        });\n      });\n      return { viewStates };\n    }\n    return prevState;\n  }\n  onHover(info, event) {\n    const { tile, coordinate, sourceLayer: layer } = info;\n    const { onHover, hoverHooks } = this.props;\n    if (onHover) {\n      onHover(info, event);\n    }\n    if (!hoverHooks || !coordinate || !layer) {\n      return null;\n    }\n    const { handleValue = () => {\n    }, handleCoordnate = () => {\n    } } = hoverHooks;\n    let hoverData;\n    if (layer.id.includes(\"Tiled\")) {\n      if (!tile?.content) {\n        return null;\n      }\n      const { content, bbox, z } = tile;\n      if (!content.data || !bbox) {\n        return null;\n      }\n      const { data, width, height } = content;\n      const { left, right, top, bottom } = bbox;\n      const bounds = [\n        left,\n        data.height < layer.tileSize ? height : bottom,\n        data.width < layer.tileSize ? width : right,\n        top\n      ];\n      if (!data) {\n        return null;\n      }\n      const layerZoomScale = Math.max(1, 2 ** Math.round(-z));\n      const dataCoords = [\n        Math.floor((coordinate[0] - bounds[0]) / layerZoomScale),\n        Math.floor((coordinate[1] - bounds[3]) / layerZoomScale)\n      ];\n      const coords = dataCoords[1] * width + dataCoords[0];\n      hoverData = data.map((d) => d[coords]);\n    } else {\n      const { channelData } = layer.props;\n      if (!channelData) {\n        return null;\n      }\n      const { data, width, height } = channelData;\n      if (!data || !width || !height) {\n        return null;\n      }\n      const bounds = [0, height, width, 0];\n      const { zoom } = layer.context.viewport;\n      const layerZoomScale = Math.max(1, 2 ** Math.floor(-zoom));\n      const dataCoords = [\n        Math.floor((coordinate[0] - bounds[0]) / layerZoomScale),\n        Math.floor((coordinate[1] - bounds[3]) / layerZoomScale)\n      ];\n      const coords = dataCoords[1] * width + dataCoords[0];\n      hoverData = data.map((d) => d[coords]);\n    }\n    handleValue(hoverData);\n    handleCoordnate(coordinate);\n  }\n  _renderLayers() {\n    const { onHover } = this;\n    const { viewStates } = this.state;\n    const { views, layerProps } = this.props;\n    return views.map((view, i) => view.getLayers({\n      viewStates,\n      props: {\n        ...layerProps[i],\n        onHover\n      }\n    }));\n  }\n  render() {\n    const { views, randomize, useDevicePixels = true, deckProps } = this.props;\n    const { viewStates } = this.state;\n    const deckGLViews = views.map((view) => view.getDeckGlView());\n    if (randomize) {\n      const random = Math.random();\n      const holdFirstElement = deckGLViews[0];\n      const randomWieghted = random * 1.49;\n      const randomizedIndex = Math.round(randomWieghted * (views.length - 1));\n      deckGLViews[0] = deckGLViews[randomizedIndex];\n      deckGLViews[randomizedIndex] = holdFirstElement;\n    }\n    return /* @__PURE__ */ React.createElement(DeckGL, {\n      ...deckProps ?? {},\n      layerFilter: this.layerFilter,\n      layers: this._renderLayers(),\n      onViewStateChange: this._onViewStateChange,\n      views: deckGLViews,\n      viewState: viewStates,\n      useDevicePixels,\n      getCursor: ({ isDragging }) => {\n        return isDragging ? \"grabbing\" : \"crosshair\";\n      }\n    });\n  }\n}\nconst VivViewer = (props) => /* @__PURE__ */ React.createElement(VivViewerWrapper, {\n  ...props\n});\n\n/**\n * This class generates a layer and a view for use in the VivViewer\n * @param {Object} args\n * @param {string} args.id id for this VivView.\n * @param {Object} args.height Width of the view.\n * @param {Object} args.width Height of the view.\n * @param {string} args.id Id for the current view\n * @param {number=} args.x X (top-left) location on the screen for the current view\n * @param {number=} args.y Y (top-left) location on the screen for the current view\n */\nclass VivView {\n  constructor({ id, x = 0, y = 0, height, width }) {\n    this.width = width;\n    this.height = height;\n    this.id = id;\n    this.x = x;\n    this.y = y;\n  }\n\n  /**\n   * Create a DeckGL view based on this class.\n   * @returns {View} The DeckGL View for this class.\n   */\n  getDeckGlView() {\n    return new OrthographicView({\n      controller: true,\n      id: this.id,\n      height: this.height,\n      width: this.width,\n      x: this.x,\n      y: this.y\n    });\n  }\n\n  /**\n   * Create a viewState for this class, checking the id to make sure this class and veiwState match.\n   * @param {Object} args\n   * @param {object} [args.viewState] incoming ViewState object from deck.gl update.\n   * @param {object} [args.oldViewState] old ViewState object from deck.gl.\n   * @param {object} [args.currentViewState] current ViewState object in react state.\n   * @returns {?object} ViewState for this class (or null by default if the ids do not match).\n   */\n  filterViewState({ viewState }) {\n    const { id, height, width } = this;\n    return viewState.id === id ? { height, width, ...viewState } : null;\n  }\n\n  /**\n   * Create a layer for this instance.\n   * @param {Object} args\n   * @param {Object<string,Object>} args.viewStates ViewStates for all current views.\n   * @param {Object} args.props Props for this instance.\n   * @returns {Layer} Instance of a layer.\n   */\n  // eslint-disable-next-line class-methods-use-this,no-unused-vars\n  getLayers({ viewStates, props }) {}\n}\n\n/* eslint-disable max-classes-per-file */\n\nconst OVERVIEW_VIEW_ID = 'overview';\n\nclass OverviewState {}\n\nclass OverviewController extends Controller {\n  constructor(props) {\n    super(OverviewState, props);\n    this.events = ['click'];\n  }\n\n  handleEvent(event) {\n    if (event.type !== 'click') {\n      return;\n    }\n    let [x, y] = this.getCenter(event);\n    const { width, height, zoom, scale } = this.controllerStateProps;\n    if (x < 0 || y < 0 || x > width || y > height) {\n      return;\n    }\n    const scaleFactor = 1 / (2 ** zoom * scale);\n    x *= scaleFactor;\n    y *= scaleFactor;\n    if (this.onViewStateChange) {\n      this.onViewStateChange({ viewState: { target: [x, y, 0] } });\n    }\n  }\n}\n\n/**\n * This class generates a OverviewLayer and a view for use in the VivViewer as an overview to a Detailview (they must be used in conjection).\n * From the base class VivView, only the initialViewState argument is used.  This class uses private methods to position its x and y from the\n * additional arguments:\n * @param {Object} args\n * @param {Object} args.id for thie VivView\n * @param {Object} args.loader PixelSource[], where each PixelSource is decreasing in shape. If length == 1, not multiscale.\n * @param {number} args.detailHeight Height of the detail view.\n * @param {number} args.detailWidth Width of the detail view.\n * @param {number} [args.scale] Scale of this viewport relative to the detail. Default is .2.\n * @param {number} [args.margin] Margin to be offset from the the corner of the other viewport. Default is 25.\n * @param {string} [args.position] Location of the viewport - one of \"bottom-right\", \"top-right\", \"top-left\", \"bottom-left.\"  Default is 'bottom-right'.\n * @param {number} [args.minimumWidth] Absolute lower bound for how small the viewport should scale. Default is 150.\n * @param {number} [args.maximumWidth] Absolute upper bound for how large the viewport should scale. Default is 350.\n * @param {number} [args.minimumHeight] Absolute lower bound for how small the viewport should scale. Default is 150.\n * @param {number} [args.maximumHeight] Absolute upper bound for how large the viewport should scale. Default is 350.\n * @param {Boolean} [args.clickCenter] Click to center the default view. Default is true.\n * */\nclass OverviewView extends VivView {\n  constructor({\n    id,\n    loader,\n    detailHeight,\n    detailWidth,\n    scale = 0.2,\n    margin = 25,\n    position = 'bottom-right',\n    minimumWidth = 150,\n    maximumWidth = 350,\n    minimumHeight = 150,\n    maximumHeight = 350,\n    clickCenter = true\n  }) {\n    super({ id });\n    this.margin = margin;\n    this.loader = loader;\n    this.position = position;\n    this.detailHeight = detailHeight;\n    this.detailWidth = detailWidth;\n    this._setHeightWidthScale({\n      detailWidth,\n      detailHeight,\n      scale,\n      minimumWidth,\n      maximumWidth,\n      minimumHeight,\n      maximumHeight\n    });\n    this._setXY();\n    this.clickCenter = clickCenter;\n  }\n\n  /**\n   * Set the image-pixel scale and height and width based on detail view.\n   */\n  _setHeightWidthScale({\n    detailWidth,\n    detailHeight,\n    scale,\n    minimumWidth,\n    maximumWidth,\n    minimumHeight,\n    maximumHeight\n  }) {\n    const numLevels = this.loader.length;\n    const { width: rasterWidth, height: rasterHeight } = getImageSize(\n      this.loader[0]\n    );\n\n    this._imageWidth = rasterWidth;\n    this._imageHeight = rasterHeight;\n\n    if (rasterWidth > rasterHeight) {\n      const heightWidthRatio = rasterHeight / rasterWidth;\n      this.width = Math.min(\n        maximumWidth,\n        Math.max(detailWidth * scale, minimumWidth)\n      );\n      this.height = this.width * heightWidthRatio;\n      this.scale = (2 ** (numLevels - 1) / rasterWidth) * this.width;\n    } else {\n      const widthHeightRatio = rasterWidth / rasterHeight;\n      this.height = Math.min(\n        maximumHeight,\n        Math.max(detailHeight * scale, minimumHeight)\n      );\n      this.width = this.height * widthHeightRatio;\n      this.scale = (2 ** (numLevels - 1) / rasterHeight) * this.height;\n    }\n  }\n\n  /**\n   * Set the x and y (top left corner) of this overview relative to the detail.\n   */\n  _setXY() {\n    const { height, width, margin, position, detailWidth, detailHeight } = this;\n    switch (position) {\n      case 'bottom-right': {\n        this.x = detailWidth - width - margin;\n        this.y = detailHeight - height - margin;\n        break;\n      }\n      case 'top-right': {\n        this.x = detailWidth - width - margin;\n        this.y = margin;\n        break;\n      }\n      case 'top-left': {\n        this.x = margin;\n        this.y = margin;\n        break;\n      }\n      case 'bottom-left': {\n        this.x = margin;\n        this.y = detailHeight - height - margin;\n        break;\n      }\n      default: {\n        throw new Error(\n          `overviewLocation prop needs to be one of ['bottom-right', 'top-right', 'top-left', 'bottom-left']`\n        );\n      }\n    }\n  }\n\n  getDeckGlView() {\n    const { scale, clickCenter } = this;\n    const controller = clickCenter && { type: OverviewController, scale };\n    return new OrthographicView({\n      controller,\n      id: this.id,\n      height: this.height,\n      width: this.width,\n      x: this.x,\n      y: this.y,\n      clear: true\n    });\n  }\n\n  filterViewState({ viewState }) {\n    // Scale the view as the overviewScale changes with screen resizing - basically, do not react to any view state changes.\n    const { _imageWidth, _imageHeight, scale } = this;\n    return {\n      ...viewState,\n      height: this.height,\n      width: this.width,\n      id: this.id,\n      target: [(_imageWidth * scale) / 2, (_imageHeight * scale) / 2, 0],\n      zoom: -(this.loader.length - 1)\n    };\n  }\n\n  getLayers({ viewStates, props }) {\n    const { detail, overview } = viewStates;\n    if (!detail) {\n      throw new Error('Overview requires a viewState with id detail');\n    }\n    // Scale the bounding box.\n    const boundingBox = makeBoundingBox(detail).map(coords =>\n      coords.map(e => e * this.scale)\n    );\n    const overviewLayer = new OverviewLayer(props, {\n      id: getVivId(this.id),\n      boundingBox,\n      overviewScale: this.scale,\n      zoom: -overview.zoom\n    });\n    return [overviewLayer];\n  }\n}\n\nconst DETAIL_VIEW_ID = 'detail';\n\n/**\n * This class generates a MultiscaleImageLayer and a view for use in the VivViewer as a detailed view.\n * It takes the same arguments for its constructor as its base class VivView.\n * */\nclass DetailView extends VivView {\n  getLayers({ props, viewStates }) {\n    const { loader } = props;\n    const { id, height, width } = this;\n    const layerViewState = viewStates[id];\n    const layers = getImageLayers(id, props);\n\n    // Inspect the first pixel source for physical sizes\n    if (loader[0]?.meta?.physicalSizes?.x) {\n      const { size, unit } = loader[0].meta.physicalSizes.x;\n      layers.push(\n        new ScaleBarLayer({\n          id: getVivId(id),\n          loader,\n          unit,\n          size,\n          viewState: { ...layerViewState, height, width }\n        })\n      );\n    }\n\n    return layers;\n  }\n\n  filterViewState({ viewState, currentViewState }) {\n    if (viewState.id === OVERVIEW_VIEW_ID) {\n      const { target } = viewState;\n      if (target) {\n        return { ...currentViewState, target };\n      }\n    }\n    return super.filterViewState({ viewState });\n  }\n}\n\n/**\n * This class generates a MultiscaleImageLayer and a view for use in the SideBySideViewer.\n * It is linked with its other views as controlled by `linkedIds`, `zoomLock`, and `panLock` parameters.\n * It takes the same arguments for its constructor as its base class VivView plus the following:\n * @param {Object} args\n * @param {Array<String>} args.linkedIds Ids of the other views to which this could be locked via zoom/pan.\n * @param {Boolean} args.panLock Whether or not we lock pan.\n * @param {Boolean} args.zoomLock Whether or not we lock zoom.\n * @param {Array=} args.viewportOutlineColor Outline color of the border (default [255, 255, 255])\n * @param {number=} args.viewportOutlineWidth Default outline width (default 10)\n * @param {number=} args.x X (top-left) location on the screen for the current view\n * @param {number=} args.y Y (top-left) location on the screen for the current view\n * @param {number} args.height Width of the view.\n * @param {number} args.width Height of the view.\n * @param {string} args.id id of the View\n * */\nclass SideBySideView extends VivView {\n  constructor({\n    id,\n    x = 0,\n    y = 0,\n    height,\n    width,\n    linkedIds = [],\n    panLock = true,\n    zoomLock = true,\n    viewportOutlineColor = [255, 255, 255],\n    viewportOutlineWidth = 10\n  }) {\n    super({ id, x, y, height, width });\n    this.linkedIds = linkedIds;\n    this.panLock = panLock;\n    this.zoomLock = zoomLock;\n    this.viewportOutlineColor = viewportOutlineColor;\n    this.viewportOutlineWidth = viewportOutlineWidth;\n  }\n\n  filterViewState({ viewState, oldViewState, currentViewState }) {\n    const { id: viewStateId } = viewState;\n    const { id, linkedIds, panLock, zoomLock } = this;\n    if (\n      oldViewState &&\n      linkedIds.indexOf(viewStateId) !== -1 &&\n      (zoomLock || panLock)\n    ) {\n      const thisViewState = {\n        height: currentViewState.height,\n        width: currentViewState.width,\n        target: [],\n        zoom: null\n      };\n      const [currentX, currentY] = currentViewState.target;\n      if (zoomLock) {\n        const dZoom = viewState.zoom - oldViewState.zoom;\n        thisViewState.zoom = currentViewState.zoom + dZoom;\n      } else {\n        thisViewState.zoom = currentViewState.zoom;\n      }\n      if (panLock) {\n        const [oldX, oldY] = oldViewState.target;\n        const [newX, newY] = viewState.target;\n        const dx = newX - oldX;\n        const dy = newY - oldY;\n        thisViewState.target.push(currentX + dx);\n        thisViewState.target.push(currentY + dy);\n      } else {\n        thisViewState.target.push(currentX);\n        thisViewState.target.push(currentY);\n      }\n      return {\n        id,\n        target: thisViewState.target,\n        zoom: thisViewState.zoom,\n        height: thisViewState.height,\n        width: thisViewState.width\n      };\n    }\n    return viewState.id === id\n      ? {\n          id,\n          target: viewState.target,\n          zoom: viewState.zoom,\n          height: viewState.height,\n          width: viewState.width\n        }\n      : {\n          id,\n          target: currentViewState.target,\n          zoom: currentViewState.zoom,\n          height: currentViewState.height,\n          width: currentViewState.width\n        };\n  }\n\n  getLayers({ props, viewStates }) {\n    const { loader } = props;\n    const {\n      id,\n      viewportOutlineColor,\n      viewportOutlineWidth,\n      height,\n      width\n    } = this;\n    const layerViewState = viewStates[id];\n    const boundingBox = makeBoundingBox({ ...layerViewState, height, width });\n    const layers = getImageLayers(id, props);\n\n    const border = new PolygonLayer({\n      id: `viewport-outline-${getVivId(id)}`,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: [boundingBox],\n      getPolygon: f => f,\n      filled: false,\n      stroked: true,\n      getLineColor: viewportOutlineColor,\n      getLineWidth: viewportOutlineWidth * 2 ** -layerViewState.zoom\n    });\n    layers.push(border);\n\n    if (loader[0]?.meta?.physicalSizes?.x) {\n      const { size, unit } = loader[0].meta.physicalSizes.x;\n      layers.push(\n        new ScaleBarLayer({\n          id: getVivId(id),\n          loader,\n          unit,\n          size,\n          viewState: { ...layerViewState, height, width }\n        })\n      );\n    }\n\n    return layers;\n  }\n}\n\n/**\n * This class generates a VolumeLayer and a view for use in the VivViewer as volumetric rendering.\n * @param {Object} args\n * @param {Array<number>} args.target Centered target for the camera (used if useFixedAxis is true)\n * @param {Boolean} args.useFixedAxis Whether or not to fix the axis of the camera.\n * */\nclass VolumeView extends VivView {\n  constructor({ target, useFixedAxis, ...args }) {\n    super(args);\n    this.target = target;\n    this.useFixedAxis = useFixedAxis;\n  }\n\n  getDeckGlView() {\n    const { height, width, id, x, y } = this;\n    return new OrbitView({\n      id,\n      controller: true,\n      height,\n      width,\n      x,\n      y,\n      orbitAxis: 'Y'\n    });\n  }\n\n  filterViewState({ viewState }) {\n    const { id, target, useFixedAxis } = this;\n    return viewState.id === id\n      ? {\n          ...viewState,\n          // fix the center of the camera if desired\n          target: useFixedAxis ? target : viewState.target\n        }\n      : null;\n  }\n\n  getLayers({ props }) {\n    const { loader } = props;\n    const { id } = this;\n\n    const layers = [\n      new VolumeLayer(props, {\n        id: `${loader.type}${getVivId(id)}`\n      })\n    ];\n\n    return layers;\n  }\n}\n\nfunction useGlobalSelection(selections, transitionFields) {\n  // viewportSelection is the last selection that had an onViewportLoad callback.\n  const [viewportSelection, setViewportSelection] = useState(selections);\n  let onViewportLoad;\n  let newselections = null;\n  let oldselections = selections;\n  if (\n    selections?.length &&\n    viewportSelection?.length &&\n    transitionFields.some(f => selections[0][f] !== viewportSelection[0][f])\n  ) {\n    // onViewportLoad is a property of TileLayer that is passed through:\n    // https://deck.gl/docs/api-reference/geo-layers/tile-layer#onviewportload\n    onViewportLoad = () => setViewportSelection(selections);\n    // Set newselections to cause the creation of an extra tile layer.\n    newselections = selections;\n    oldselections = viewportSelection;\n  }\n  return { newselections, oldselections, onViewportLoad };\n}\n\nconst PictureInPictureViewer = (props) => {\n  const {\n    loader,\n    contrastLimits,\n    colors,\n    channelsVisible,\n    viewStates: viewStatesProp,\n    colormap,\n    overview,\n    overviewOn,\n    selections,\n    hoverHooks = { handleValue: () => {\n    }, handleCoordinate: () => {\n    } },\n    height,\n    width,\n    isLensOn = false,\n    lensSelection = 0,\n    lensRadius = 100,\n    lensBorderColor = [255, 255, 255],\n    lensBorderRadius = 0.02,\n    clickCenter = true,\n    transparentColor,\n    onViewStateChange,\n    onHover,\n    transitionFields = GLOBAL_SLIDER_DIMENSION_FIELDS,\n    onViewportLoad,\n    deckProps\n  } = props;\n  const {\n    newselections,\n    oldselections,\n    onViewportLoad: transitionOnViewportLoad\n  } = useGlobalSelection(selections, transitionFields);\n  const detailViewState = viewStatesProp?.find((v) => v.id === DETAIL_VIEW_ID);\n  const baseViewState = useMemo(() => {\n    return detailViewState || getDefaultInitialViewState(loader, { height, width }, 0.5);\n  }, [loader, detailViewState]);\n  const detailView = new DetailView({\n    id: DETAIL_VIEW_ID,\n    height,\n    width\n  });\n  const layerConfig = {\n    loader,\n    contrastLimits,\n    colors,\n    channelsVisible,\n    selections: oldselections,\n    newselections,\n    onViewportLoad,\n    transitionOnViewportLoad,\n    transitionFields,\n    colormap,\n    isLensOn,\n    lensSelection,\n    lensRadius,\n    lensBorderColor,\n    lensBorderRadius,\n    transparentColor\n  };\n  const views = [detailView];\n  const layerProps = [layerConfig];\n  const viewStates = [{ ...baseViewState, id: DETAIL_VIEW_ID }];\n  if (overviewOn && loader) {\n    const overviewViewState = viewStatesProp?.find((v) => v.id === OVERVIEW_VIEW_ID) || { ...baseViewState, id: OVERVIEW_VIEW_ID };\n    const overviewView = new OverviewView({\n      id: OVERVIEW_VIEW_ID,\n      loader,\n      detailHeight: height,\n      detailWidth: width,\n      clickCenter,\n      ...overview\n    });\n    views.push(overviewView);\n    layerProps.push(layerConfig);\n    viewStates.push(overviewViewState);\n  }\n  if (!loader)\n    return null;\n  return /* @__PURE__ */ React.createElement(VivViewer, {\n    layerProps,\n    views,\n    viewStates,\n    hoverHooks,\n    onViewStateChange,\n    onHover,\n    deckProps\n  });\n};\n\nconst SideBySideViewer = (props) => {\n  const {\n    loader,\n    contrastLimits,\n    colors,\n    channelsVisible,\n    viewStates: viewStatesProp,\n    colormap,\n    panLock,\n    selections,\n    zoomLock,\n    height,\n    width,\n    isLensOn = false,\n    lensSelection = 0,\n    lensRadius = 100,\n    lensBorderColor = [255, 255, 255],\n    lensBorderRadius = 0.02,\n    transparentColor,\n    onViewStateChange,\n    onHover,\n    transitionFields = GLOBAL_SLIDER_DIMENSION_FIELDS,\n    onViewportLoad,\n    deckProps\n  } = props;\n  const {\n    newselections,\n    oldselections,\n    onViewportLoad: transitionOnViewportLoad\n  } = useGlobalSelection(selections, transitionFields);\n  const leftViewState = viewStatesProp?.find((v) => v.id === \"left\");\n  const rightViewState = viewStatesProp?.find((v) => v.id === \"right\");\n  const viewStates = useMemo(() => {\n    if (leftViewState && rightViewState) {\n      return viewStatesProp;\n    }\n    const defaultViewState = getDefaultInitialViewState(loader, { height, width: width / 2 }, 0.5);\n    return [\n      leftViewState || { ...defaultViewState, id: \"left\" },\n      rightViewState || { ...defaultViewState, id: \"right\" }\n    ];\n  }, [loader, leftViewState, rightViewState]);\n  const detailViewLeft = new SideBySideView({\n    id: \"left\",\n    linkedIds: [\"right\"],\n    panLock,\n    zoomLock,\n    height,\n    width: width / 2\n  });\n  const detailViewRight = new SideBySideView({\n    id: \"right\",\n    x: width / 2,\n    linkedIds: [\"left\"],\n    panLock,\n    zoomLock,\n    height,\n    width: width / 2\n  });\n  const layerConfig = {\n    loader,\n    contrastLimits,\n    colors,\n    channelsVisible,\n    selections: oldselections,\n    newselections,\n    onViewportLoad,\n    transitionOnViewportLoad,\n    transitionFields,\n    colormap,\n    isLensOn,\n    lensSelection,\n    lensRadius,\n    lensBorderColor,\n    lensBorderRadius,\n    transparentColor\n  };\n  const views = [detailViewRight, detailViewLeft];\n  const layerProps = [layerConfig, layerConfig];\n  return loader ? /* @__PURE__ */ React.createElement(VivViewer, {\n    layerProps,\n    views,\n    randomize: true,\n    onViewStateChange,\n    onHover,\n    viewStates,\n    deckProps\n  }) : null;\n};\n\nconst VolumeViewer = (props) => {\n  const {\n    loader,\n    contrastLimits,\n    colors,\n    channelsVisible,\n    selections,\n    colormap,\n    resolution = Math.max(0, loader.length - 1),\n    modelMatrix,\n    onViewStateChange,\n    renderingMode = RENDERING_MODES.ADDITIVE,\n    xSlice = null,\n    ySlice = null,\n    zSlice = null,\n    onViewportLoad,\n    height: screenHeight,\n    width: screenWidth,\n    viewStates: viewStatesProp,\n    clippingPlanes = [],\n    useFixedAxis = true\n  } = props;\n  const volumeViewState = viewStatesProp?.find((state) => state?.id === \"3d\");\n  const initialViewState = useMemo(() => {\n    if (volumeViewState) {\n      return volumeViewState;\n    }\n    const viewState = getDefaultInitialViewState(loader, { height: screenHeight, width: screenWidth }, 1, true, modelMatrix);\n    return {\n      ...viewState,\n      rotationX: 0,\n      rotationOrbit: 0\n    };\n  }, [loader, resolution, modelMatrix]);\n  const viewStates = [volumeViewState || { ...initialViewState, id: \"3d\" }];\n  const volumeView = new VolumeView({\n    id: \"3d\",\n    target: viewStates[0].target,\n    useFixedAxis\n  });\n  const layerConfig = {\n    loader,\n    contrastLimits,\n    colors,\n    channelsVisible,\n    selections,\n    colormap,\n    xSlice,\n    ySlice,\n    zSlice,\n    resolution,\n    renderingMode,\n    modelMatrix,\n    onViewportLoad: () => setTimeout(onViewportLoad, 0),\n    clippingPlanes\n  };\n  const views = [volumeView];\n  const layerProps = [layerConfig];\n  return loader ? /* @__PURE__ */ React.createElement(VivViewer, {\n    layerProps,\n    views,\n    viewStates,\n    onViewStateChange,\n    useDevicePixels: false\n  }) : null;\n};\n\nconst VIV_PROXY_KEY = \"__viv\";\nconst OFFSETS_PROXY_KEY = `${VIV_PROXY_KEY}-offsets`;\nfunction checkProxies(tiff) {\n  if (!isProxy(tiff, OFFSETS_PROXY_KEY)) {\n    console.warn(\"GeoTIFF source is missing offsets proxy.\");\n  }\n}\nfunction isProxy(tiff, proxyFlag) {\n  return tiff[proxyFlag];\n}\nfunction createOffsetsProxy(tiff, offsets) {\n  const get = (target, key) => {\n    if (key === \"getImage\") {\n      return (index) => {\n        if (!(index in target.ifdRequests) && index in offsets) {\n          const offset = offsets[index];\n          target.ifdRequests[index] = target.parseFileDirectoryAt(offset);\n        }\n        return target.getImage(index);\n      };\n    }\n    if (key === OFFSETS_PROXY_KEY) {\n      return true;\n    }\n    return Reflect.get(target, key);\n  };\n  return new Proxy(tiff, { get });\n}\n\nconst encodedJs = \"KGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CgogIGZ1bmN0aW9uIGRlY29kZVJvd0FjYyhyb3csIHN0cmlkZSkgewogICAgbGV0IGxlbmd0aCA9IHJvdy5sZW5ndGggLSBzdHJpZGU7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIGRvIHsKICAgICAgZm9yIChsZXQgaSA9IHN0cmlkZTsgaSA+IDA7IGktLSkgewogICAgICAgIHJvd1tvZmZzZXQgKyBzdHJpZGVdICs9IHJvd1tvZmZzZXRdOwogICAgICAgIG9mZnNldCsrOwogICAgICB9CgogICAgICBsZW5ndGggLT0gc3RyaWRlOwogICAgfSB3aGlsZSAobGVuZ3RoID4gMCk7CiAgfQoKICBmdW5jdGlvbiBkZWNvZGVSb3dGbG9hdGluZ1BvaW50KHJvdywgc3RyaWRlLCBieXRlc1BlclNhbXBsZSkgewogICAgbGV0IGluZGV4ID0gMDsKICAgIGxldCBjb3VudCA9IHJvdy5sZW5ndGg7CiAgICBjb25zdCB3YyA9IGNvdW50IC8gYnl0ZXNQZXJTYW1wbGU7CgogICAgd2hpbGUgKGNvdW50ID4gc3RyaWRlKSB7CiAgICAgIGZvciAobGV0IGkgPSBzdHJpZGU7IGkgPiAwOyAtLWkpIHsKICAgICAgICByb3dbaW5kZXggKyBzdHJpZGVdICs9IHJvd1tpbmRleF07CiAgICAgICAgKytpbmRleDsKICAgICAgfQogICAgICBjb3VudCAtPSBzdHJpZGU7CiAgICB9CgogICAgY29uc3QgY29weSA9IHJvdy5zbGljZSgpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3YzsgKytpKSB7CiAgICAgIGZvciAobGV0IGIgPSAwOyBiIDwgYnl0ZXNQZXJTYW1wbGU7ICsrYikgewogICAgICAgIHJvd1soYnl0ZXNQZXJTYW1wbGUgKiBpKSArIGJdID0gY29weVsoKGJ5dGVzUGVyU2FtcGxlIC0gYiAtIDEpICogd2MpICsgaV07CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFwcGx5UHJlZGljdG9yKGJsb2NrLCBwcmVkaWN0b3IsIHdpZHRoLCBoZWlnaHQsIGJpdHNQZXJTYW1wbGUsCiAgICBwbGFuYXJDb25maWd1cmF0aW9uKSB7CiAgICBpZiAoIXByZWRpY3RvciB8fCBwcmVkaWN0b3IgPT09IDEpIHsKICAgICAgcmV0dXJuIGJsb2NrOwogICAgfQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYml0c1BlclNhbXBsZS5sZW5ndGg7ICsraSkgewogICAgICBpZiAoYml0c1BlclNhbXBsZVtpXSAlIDggIT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1doZW4gZGVjb2Rpbmcgd2l0aCBwcmVkaWN0b3IsIG9ubHkgbXVsdGlwbGUgb2YgOCBiaXRzIGFyZSBzdXBwb3J0ZWQuJyk7CiAgICAgIH0KICAgICAgaWYgKGJpdHNQZXJTYW1wbGVbaV0gIT09IGJpdHNQZXJTYW1wbGVbMF0pIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1doZW4gZGVjb2Rpbmcgd2l0aCBwcmVkaWN0b3IsIGFsbCBzYW1wbGVzIG11c3QgaGF2ZSB0aGUgc2FtZSBzaXplLicpOwogICAgICB9CiAgICB9CgogICAgY29uc3QgYnl0ZXNQZXJTYW1wbGUgPSBiaXRzUGVyU2FtcGxlWzBdIC8gODsKICAgIGNvbnN0IHN0cmlkZSA9IHBsYW5hckNvbmZpZ3VyYXRpb24gPT09IDIgPyAxIDogYml0c1BlclNhbXBsZS5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7ICsraSkgewogICAgICAvLyBMYXN0IHN0cmlwIHdpbGwgYmUgdHJ1bmNhdGVkIGlmIGhlaWdodCAlIHN0cmlwSGVpZ2h0ICE9IDAKICAgICAgaWYgKGkgKiBzdHJpZGUgKiB3aWR0aCAqIGJ5dGVzUGVyU2FtcGxlID49IGJsb2NrLmJ5dGVMZW5ndGgpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBsZXQgcm93OwogICAgICBpZiAocHJlZGljdG9yID09PSAyKSB7IC8vIGhvcml6b250YWwgcHJlZGljdGlvbgogICAgICAgIHN3aXRjaCAoYml0c1BlclNhbXBsZVswXSkgewogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICByb3cgPSBuZXcgVWludDhBcnJheSgKICAgICAgICAgICAgICBibG9jaywgaSAqIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgcm93ID0gbmV3IFVpbnQxNkFycmF5KAogICAgICAgICAgICAgIGJsb2NrLCBpICogc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwgc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSAvIDIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgcm93ID0gbmV3IFVpbnQzMkFycmF5KAogICAgICAgICAgICAgIGJsb2NrLCBpICogc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwgc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSAvIDQsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQcmVkaWN0b3IgMiBub3QgYWxsb3dlZCB3aXRoICR7Yml0c1BlclNhbXBsZVswXX0gYml0cyBwZXIgc2FtcGxlLmApOwogICAgICAgIH0KICAgICAgICBkZWNvZGVSb3dBY2Mocm93LCBzdHJpZGUpOwogICAgICB9IGVsc2UgaWYgKHByZWRpY3RvciA9PT0gMykgeyAvLyBob3Jpem9udGFsIGZsb2F0aW5nIHBvaW50CiAgICAgICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkoCiAgICAgICAgICBibG9jaywgaSAqIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsCiAgICAgICAgKTsKICAgICAgICBkZWNvZGVSb3dGbG9hdGluZ1BvaW50KHJvdywgc3RyaWRlLCBieXRlc1BlclNhbXBsZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBibG9jazsKICB9CgogIGNsYXNzIEJhc2VEZWNvZGVyIHsKICAgIGFzeW5jIGRlY29kZShmaWxlRGlyZWN0b3J5LCBidWZmZXIpIHsKICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHRoaXMuZGVjb2RlQmxvY2soYnVmZmVyKTsKICAgICAgY29uc3QgcHJlZGljdG9yID0gZmlsZURpcmVjdG9yeS5QcmVkaWN0b3IgfHwgMTsKICAgICAgaWYgKHByZWRpY3RvciAhPT0gMSkgewogICAgICAgIGNvbnN0IGlzVGlsZWQgPSAhZmlsZURpcmVjdG9yeS5TdHJpcE9mZnNldHM7CiAgICAgICAgY29uc3QgdGlsZVdpZHRoID0gaXNUaWxlZCA/IGZpbGVEaXJlY3RvcnkuVGlsZVdpZHRoIDogZmlsZURpcmVjdG9yeS5JbWFnZVdpZHRoOwogICAgICAgIGNvbnN0IHRpbGVIZWlnaHQgPSBpc1RpbGVkID8gZmlsZURpcmVjdG9yeS5UaWxlTGVuZ3RoIDogKAogICAgICAgICAgZmlsZURpcmVjdG9yeS5Sb3dzUGVyU3RyaXAgfHwgZmlsZURpcmVjdG9yeS5JbWFnZUxlbmd0aAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGFwcGx5UHJlZGljdG9yKAogICAgICAgICAgZGVjb2RlZCwgcHJlZGljdG9yLCB0aWxlV2lkdGgsIHRpbGVIZWlnaHQsIGZpbGVEaXJlY3RvcnkuQml0c1BlclNhbXBsZSwKICAgICAgICAgIGZpbGVEaXJlY3RvcnkuUGxhbmFyQ29uZmlndXJhdGlvbiwKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiBkZWNvZGVkOwogICAgfQogIH0KCiAgY2xhc3MgUmF3RGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICByZXR1cm4gYnVmZmVyOwogICAgfQogIH0KCiAgbGV0IEEsST1udWxsO2Z1bmN0aW9uIGcoKXtyZXR1cm4gbnVsbCE9PUkmJkkuYnVmZmVyPT09QS5tZW1vcnkuYnVmZmVyfHwoST1uZXcgVWludDhBcnJheShBLm1lbW9yeS5idWZmZXIpKSxJfWxldCBCPTA7bGV0IFE9bnVsbDtmdW5jdGlvbiBDKCl7cmV0dXJuIG51bGwhPT1RJiZRLmJ1ZmZlcj09PUEubWVtb3J5LmJ1ZmZlcnx8KFE9bmV3IEludDMyQXJyYXkoQS5tZW1vcnkuYnVmZmVyKSksUX1hc3luYyBmdW5jdGlvbiBFKEkpe3ZvaWQgMD09PUkmJihJPSIiLnJlcGxhY2UoL1wuanMkLywiX2JnLndhc20iKSk7KCJzdHJpbmciPT10eXBlb2YgSXx8ImZ1bmN0aW9uIj09dHlwZW9mIFJlcXVlc3QmJkkgaW5zdGFuY2VvZiBSZXF1ZXN0fHwiZnVuY3Rpb24iPT10eXBlb2YgVVJMJiZJIGluc3RhbmNlb2YgVVJMKSYmKEk9ZmV0Y2goSSkpO2NvbnN0e2luc3RhbmNlOmcsbW9kdWxlOkJ9PWF3YWl0IGFzeW5jIGZ1bmN0aW9uKEEsSSl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFJlc3BvbnNlJiZBIGluc3RhbmNlb2YgUmVzcG9uc2Upe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyl0cnl7cmV0dXJuIGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nKEEsSSl9Y2F0Y2goSSl7aWYoImFwcGxpY2F0aW9uL3dhc20iPT1BLmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKSl0aHJvdyBJO2NvbnNvbGUud2FybigiYFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nYCBmYWlsZWQgYmVjYXVzZSB5b3VyIHNlcnZlciBkb2VzIG5vdCBzZXJ2ZSB3YXNtIHdpdGggYGFwcGxpY2F0aW9uL3dhc21gIE1JTUUgdHlwZS4gRmFsbGluZyBiYWNrIHRvIGBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZWAgd2hpY2ggaXMgc2xvd2VyLiBPcmlnaW5hbCBlcnJvcjpcbiIsSSk7fWNvbnN0IGc9YXdhaXQgQS5hcnJheUJ1ZmZlcigpO3JldHVybiBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShnLEkpfXtjb25zdCBnPWF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKEEsSSk7cmV0dXJuIGcgaW5zdGFuY2VvZiBXZWJBc3NlbWJseS5JbnN0YW5jZT97aW5zdGFuY2U6Zyxtb2R1bGU6QX06Z319KGF3YWl0IEkse30pO3JldHVybiBBPWcuZXhwb3J0cyxFLl9fd2JpbmRnZW5fd2FzbV9tb2R1bGU9QixBfXZhciBEPU9iamVjdC5mcmVlemUoe19fcHJvdG9fXzpudWxsLGRlY29tcHJlc3M6ZnVuY3Rpb24oSSxRKXt0cnl7Y29uc3QgRj1BLl9fd2JpbmRnZW5fYWRkX3RvX3N0YWNrX3BvaW50ZXIoLTE2KTt2YXIgRT1mdW5jdGlvbihBLEkpe2NvbnN0IFE9SSgxKkEubGVuZ3RoKTtyZXR1cm4gZygpLnNldChBLFEvMSksQj1BLmxlbmd0aCxRfShJLEEuX193YmluZGdlbl9tYWxsb2MpLEQ9QjtBLmRlY29tcHJlc3MoRixFLEQsUSk7dmFyIGk9QygpW0YvNCswXSx3PUMoKVtGLzQrMV0sRz0obz1pLE49dyxnKCkuc3ViYXJyYXkoby8xLG8vMStOKSkuc2xpY2UoKTtyZXR1cm4gQS5fX3diaW5kZ2VuX2ZyZWUoaSwxKncpLEd9ZmluYWxseXtBLl9fd2JpbmRnZW5fYWRkX3RvX3N0YWNrX3BvaW50ZXIoMTYpO312YXIgbyxOO30sZGVmYXVsdDpFfSk7Y29uc3QgaT1bNjIsMCwwLDAsNjMsNTIsNTMsNTQsNTUsNTYsNTcsNTgsNTksNjAsNjEsMCwwLDAsMCwwLDAsMCwwLDEsMiwzLDQsNSw2LDcsOCw5LDEwLDExLDEyLDEzLDE0LDE1LDE2LDE3LDE4LDE5LDIwLDIxLDIyLDIzLDI0LDI1LDAsMCwwLDAsMCwwLDI2LDI3LDI4LDI5LDMwLDMxLDMyLDMzLDM0LDM1LDM2LDM3LDM4LDM5LDQwLDQxLDQyLDQzLDQ0LDQ1LDQ2LDQ3LDQ4LDQ5LDUwLDUxXTtmdW5jdGlvbiB3KEEpe3JldHVybiBpW0EtNDNdfWNvbnN0IEc9ZnVuY3Rpb24oQSl7bGV0IEksZz1BLmVuZHNXaXRoKCI9PSIpPzI6QS5lbmRzV2l0aCgiPSIpPzE6MCxCPUEubGVuZ3RoLFE9bmV3IFVpbnQ4QXJyYXkoQi80KjMpO2ZvcihsZXQgZz0wLEM9MDtnPEI7Zys9NCxDKz0zKUk9dyhBLmNoYXJDb2RlQXQoZykpPDwxOHx3KEEuY2hhckNvZGVBdChnKzEpKTw8MTJ8dyhBLmNoYXJDb2RlQXQoZysyKSk8PDZ8dyhBLmNoYXJDb2RlQXQoZyszKSksUVtDXT1JPj4xNixRW0MrMV09ST4+OCYyNTUsUVtDKzJdPTI1NSZJO3JldHVybiBRLnN1YmFycmF5KDAsUS5sZW5ndGgtZyl9KCJBR0Z6YlFFQUFBQUJXUTVnQW45L0FYOWdBMzkvZndGL1lBSi9md0JnQVg4QVlBTi9mMzhBWUFGL0FYOWdCSDkvZjM4QVlBUi9mMzkvQVg5Z0JuOS9mMzkvZndCZ0FYOEJmbUFBQUdBRmYzOS9mMzhBWUFWL2YzOS9md0YvWUFKK2Z3Ri9BMjFzQlFnSUN3TUJBZ1VNQVFBQkFBSUFCUUFDQWdZR0RRWURBZ0FDQUFBRUJBUUNBZ1lHQUFZQkJnSUhBd1FEQkFRREF3QURCUU1EQkFRRUJBUUNBZ0FIQUFRQUFnTUJBZ2NGQkFJREFRVUNBZ0lEQWdJREF3Y0NBUUFBQkFJQUNnQUFBUUFGQWdBREJRa0pDUU1DQkFVQmNBRXJLd1VEQVFBUkJna0Jmd0ZCZ0lEQUFBc0hYd1VHYldWdGIzSjVBZ0FLWkdWamIyMXdjbVZ6Y3dBbkgxOWZkMkpwYm1SblpXNWZZV1JrWDNSdlgzTjBZV05yWDNCdmFXNTBaWElBWWhGZlgzZGlhVzVrWjJWdVgyMWhiR3h2WXdCTUQxOWZkMkpwYm1SblpXNWZabkpsWlFCV0NUQUJBRUVCQ3lwcUpEVUNabVZETlFGbVpVTmhhMnBYREQxcFZCb2hTVnRUYUdkZlhERU9YbGhxYVFzY1FXQWJQMlFLc3VnQmJOTXFBZ2gvQVg0Q1FBSkFBa0FDUUNBQVFmVUJUd1JBSUFCQnpmOTdUdzBDSUFCQkMyb2lBRUY0Y1NFR1FaQ253QUFvQWdBaUNFVU5BVUVBSUFacklRUUNRQUpBQW45QkFDQUFRUWgySWdCRkRRQWFRUjhnQmtILy8vOEhTdzBBR2lBR1FRWWdBR2NpQUd0QkgzRjJRUUZ4SUFCQkFYUnJRVDVxQ3lJSFFRSjBRWnlwd0FCcUtBSUFJZ0FFUUNBR1FRQkJHU0FIUVFGMmEwRWZjU0FIUVI5R0czUWhBZ05BQWtBZ0FFRUVhaWdDQUVGNGNTSUZJQVpKRFFBZ0JTQUdheUlGSUFSUERRQWdBQ0VESUFVaUJBMEFRUUFoQkF3REN5QUFRUlJxS0FJQUlnVWdBU0FGSUFBZ0FrRWRka0VFY1dwQkVHb29BZ0FpQUVjYklBRWdCUnNoQVNBQ1FRRjBJUUlnQUEwQUN5QUJCRUFnQVNFQURBSUxJQU1OQWd0QkFDRURRUUlnQjBFZmNYUWlBRUVBSUFCcmNpQUljU0lBUlEwRElBQkJBQ0FBYTNGb1FRSjBRWnlwd0FCcUtBSUFJZ0JGRFFNTEEwQWdBQ0FESUFCQkJHb29BZ0JCZUhFaUFpQUdUeUFDSUFacklnSWdCRWx4SWdFYklRTWdBaUFFSUFFYklRUWdBQ2dDRUNJQ0JIOGdBZ1VnQUVFVWFpZ0NBQXNpQUEwQUN5QURSUTBDQzBHY3FzQUFLQUlBSWdBZ0JrOUJBQ0FFSUFBZ0JtdFBHdzBCSUFNb0FoZ2hCd0pBQWtBZ0F5QURLQUlNSWdGR0JFQWdBMEVVUVJBZ0EwRVVhaUlDS0FJQUlnRWJhaWdDQUNJQURRRkJBQ0VCREFJTElBTW9BZ2dpQUNBQk5nSU1JQUVnQURZQ0NBd0JDeUFDSUFOQkVHb2dBUnNoQWdOQUlBSWhCU0FBSWdGQkZHb2lBaWdDQUNJQVJRUkFJQUZCRUdvaEFpQUJLQUlRSVFBTElBQU5BQXNnQlVFQU5nSUFDd0pBSUFkRkRRQUNRQ0FESUFNb0FoeEJBblJCbktuQUFHb2lBQ2dDQUVjRVFDQUhRUkJCRkNBSEtBSVFJQU5HRzJvZ0FUWUNBQ0FCUlEwQ0RBRUxJQUFnQVRZQ0FDQUJEUUJCa0tmQUFFR1FwOEFBS0FJQVFYNGdBeWdDSEhkeE5nSUFEQUVMSUFFZ0J6WUNHQ0FES0FJUUlnQUVRQ0FCSUFBMkFoQWdBQ0FCTmdJWUN5QURRUlJxS0FJQUlnQkZEUUFnQVVFVWFpQUFOZ0lBSUFBZ0FUWUNHQXNDUUNBRVFSQlBCRUFnQXlBR1FRTnlOZ0lFSUFNZ0Jtb2lCU0FFUVFGeU5nSUVJQVFnQldvZ0JEWUNBQ0FFUVlBQ1R3UkFJQVZDQURjQ0VDQUZBbjlCQUNBRVFRaDJJZ0JGRFFBYVFSOGdCRUgvLy84SFN3MEFHaUFFUVFZZ0FHY2lBR3RCSDNGMlFRRnhJQUJCQVhSclFUNXFDeUlBTmdJY0lBQkJBblJCbktuQUFHb2hBZ0pBQWtBQ1FBSkFRWkNud0FBb0FnQWlBVUVCSUFCQkgzRjBJZ1p4QkVBZ0FpZ0NBQ0lDUVFScUtBSUFRWGh4SUFSSERRRWdBaUVBREFJTFFaQ253QUFnQVNBR2NqWUNBQ0FDSUFVMkFnQU1Bd3NnQkVFQVFSa2dBRUVCZG10QkgzRWdBRUVmUmh0MElRRURRQ0FDSUFGQkhYWkJCSEZxUVJCcUlnWW9BZ0FpQUVVTkFpQUJRUUYwSVFFZ0FDRUNJQUJCQkdvb0FnQkJlSEVnQkVjTkFBc0xJQUFvQWdnaUFpQUZOZ0lNSUFBZ0JUWUNDQ0FGUVFBMkFoZ2dCU0FBTmdJTUlBVWdBallDQ0F3RUN5QUdJQVUyQWdBTElBVWdBallDR0NBRklBVTJBZ3dnQlNBRk5nSUlEQUlMSUFSQkEzWWlBa0VEZEVHVXA4QUFhaUVBQW45QmpLZkFBQ2dDQUNJQlFRRWdBblFpQW5FRVFDQUFLQUlJREFFTFFZeW53QUFnQVNBQ2NqWUNBQ0FBQ3lFQ0lBQWdCVFlDQ0NBQ0lBVTJBZ3dnQlNBQU5nSU1JQVVnQWpZQ0NBd0JDeUFESUFRZ0Jtb2lBRUVEY2pZQ0JDQUFJQU5xSWdBZ0FDZ0NCRUVCY2pZQ0JBc2dBMEVJYWc4TEFrQUNRRUdNcDhBQUtBSUFJZ0ZCRUNBQVFRdHFRWGh4SUFCQkMwa2JJZ1pCQTNZaUFIWWlBa0VEY1VVRVFDQUdRWnlxd0FBb0FnQk5EUU1nQWcwQlFaQ253QUFvQWdBaUFFVU5BeUFBUVFBZ0FHdHhhRUVDZEVHY3FjQUFhaWdDQUNJQlFRUnFLQUlBUVhoeElBWnJJUVFnQVNFQ0EwQWdBU2dDRUNJQVJRUkFJQUZCRkdvb0FnQWlBRVVOQkFzZ0FFRUVhaWdDQUVGNGNTQUdheUlCSUFRZ0FTQUVTU0lCR3lFRUlBQWdBaUFCR3lFQ0lBQWhBUXdBQ3dBTEFrQWdBa0YvYzBFQmNTQUFhaUlBUVFOMFFZeW53QUJxSWdOQkVHb29BZ0FpQWtFSWFpSUZLQUlBSWdRZ0EwRUlhaUlEUndSQUlBUWdBellDRENBRElBUTJBZ2dNQVF0QmpLZkFBQ0FCUVg0Z0FIZHhOZ0lBQ3lBQ0lBQkJBM1FpQUVFRGNqWUNCQ0FBSUFKcUlnQWdBQ2dDQkVFQmNqWUNCQ0FGRHdzQ1FFRUNJQUIwSWdSQkFDQUVhM0lnQWlBQWRIRWlBRUVBSUFCcmNXZ2lBa0VEZEVHTXA4QUFhaUlEUVJCcUtBSUFJZ0JCQ0dvaUJTZ0NBQ0lFSUFOQkNHb2lBMGNFUUNBRUlBTTJBZ3dnQXlBRU5nSUlEQUVMUVl5bndBQWdBVUYrSUFKM2NUWUNBQXNnQUNBR1FRTnlOZ0lFSUFBZ0Jtb2lBeUFDUVFOMElnSWdCbXNpQVVFQmNqWUNCQ0FBSUFKcUlBRTJBZ0JCbktyQUFDZ0NBQ0lBQkVBZ0FFRURkaUlFUVFOMFFaU253QUJxSVFCQnBLckFBQ2dDQUNFQ0FuOUJqS2ZBQUNnQ0FDSUdRUUVnQkVFZmNYUWlCSEVFUUNBQUtBSUlEQUVMUVl5bndBQWdCQ0FHY2pZQ0FDQUFDeUVFSUFBZ0FqWUNDQ0FFSUFJMkFnd2dBaUFBTmdJTUlBSWdCRFlDQ0F0QnBLckFBQ0FETmdJQVFaeXF3QUFnQVRZQ0FDQUZEd3NnQWlnQ0dDRUhBa0FDUUNBQ0lBSW9BZ3dpQVVZRVFDQUNRUlJCRUNBQ1FSUnFJZ0VvQWdBaUF4dHFLQUlBSWdBTkFVRUFJUUVNQWdzZ0FpZ0NDQ0lBSUFFMkFnd2dBU0FBTmdJSURBRUxJQUVnQWtFUWFpQURHeUVEQTBBZ0F5RUZJQUFpQVVFVWFpSURLQUlBSWdCRkJFQWdBVUVRYWlFRElBRW9BaEFoQUFzZ0FBMEFDeUFGUVFBMkFnQUxJQWRGRFFNZ0FpQUNLQUljUVFKMFFaeXB3QUJxSWdBb0FnQkhCRUFnQjBFUVFSUWdCeWdDRUNBQ1JodHFJQUUyQWdBZ0FVVU5CQXdEQ3lBQUlBRTJBZ0FnQVEwQ1FaQ253QUJCa0tmQUFDZ0NBRUYrSUFJb0FoeDNjVFlDQUF3REN3SkFBa0FDUUFKQUFrQkJuS3JBQUNnQ0FDSUFJQVpKQkVCQm9LckFBQ2dDQUNJQUlBWkxEUU5CQUNFQ0lBWkJyNEFFYWlJQVFSQjJRQUFpQVVGL1JnMEdJQUZCRUhRaUJVVU5Ca0dzcXNBQUlBQkJnSUI4Y1NJRVFheXF3QUFvQWdCcUlnQTJBZ0JCc0tyQUFFR3dxc0FBS0FJQUlnRWdBQ0FCSUFCTEd6WUNBRUdvcXNBQUtBSUFJZ05GRFFGQnRLckFBQ0VBQTBBZ0FDZ0NBQ0lCSUFBb0FnUWlCMm9nQlVZTkF5QUFLQUlJSWdBTkFBc01CQXRCcEtyQUFDZ0NBQ0VDQW44Z0FDQUdheUlCUVE5TkJFQkJwS3JBQUVFQU5nSUFRWnlxd0FCQkFEWUNBQ0FDSUFCQkEzSTJBZ1FnQUNBQ2FpSUJRUVJxSVFBZ0FTZ0NCRUVCY2d3QkMwR2Nxc0FBSUFFMkFnQkJwS3JBQUNBQ0lBWnFJZ1EyQWdBZ0JDQUJRUUZ5TmdJRUlBQWdBbW9nQVRZQ0FDQUNRUVJxSVFBZ0JrRURjZ3NoQVNBQUlBRTJBZ0FnQWtFSWFnOExRY2lxd0FBb0FnQWlBRUVBSUFBZ0JVMGJSUVJBUWNpcXdBQWdCVFlDQUF0QnpLckFBRUgvSHpZQ0FFRzBxc0FBSUFVMkFnQkJ3S3JBQUVFQU5nSUFRYmlxd0FBZ0JEWUNBRUdncDhBQVFaU253QUEyQWdCQnFLZkFBRUdjcDhBQU5nSUFRWnlud0FCQmxLZkFBRFlDQUVHd3A4QUFRYVNud0FBMkFnQkJwS2ZBQUVHY3A4QUFOZ0lBUWJpbndBQkJyS2ZBQURZQ0FFR3NwOEFBUWFTbndBQTJBZ0JCd0tmQUFFRzBwOEFBTmdJQVFiU253QUJCcktmQUFEWUNBRUhJcDhBQVFieW53QUEyQWdCQnZLZkFBRUcwcDhBQU5nSUFRZENud0FCQnhLZkFBRFlDQUVIRXA4QUFRYnlud0FBMkFnQkIyS2ZBQUVITXA4QUFOZ0lBUWN5bndBQkJ4S2ZBQURZQ0FFSGdwOEFBUWRTbndBQTJBZ0JCMUtmQUFFSE1wOEFBTmdJQVFkeW53QUJCMUtmQUFEWUNBRUhvcDhBQVFkeW53QUEyQWdCQjVLZkFBRUhjcDhBQU5nSUFRZkNud0FCQjVLZkFBRFlDQUVIc3A4QUFRZVNud0FBMkFnQkIrS2ZBQUVIc3A4QUFOZ0lBUWZTbndBQkI3S2ZBQURZQ0FFR0FxTUFBUWZTbndBQTJBZ0JCL0tmQUFFSDBwOEFBTmdJQVFZaW93QUJCL0tmQUFEWUNBRUdFcU1BQVFmeW53QUEyQWdCQmtLakFBRUdFcU1BQU5nSUFRWXlvd0FCQmhLakFBRFlDQUVHWXFNQUFRWXlvd0FBMkFnQkJsS2pBQUVHTXFNQUFOZ0lBUWFDb3dBQkJsS2pBQURZQ0FFR29xTUFBUVp5b3dBQTJBZ0JCbktqQUFFR1VxTUFBTmdJQVFiQ293QUJCcEtqQUFEWUNBRUdrcU1BQVFaeW93QUEyQWdCQnVLakFBRUdzcU1BQU5nSUFRYXlvd0FCQnBLakFBRFlDQUVIQXFNQUFRYlNvd0FBMkFnQkJ0S2pBQUVHc3FNQUFOZ0lBUWNpb3dBQkJ2S2pBQURZQ0FFRzhxTUFBUWJTb3dBQTJBZ0JCMEtqQUFFSEVxTUFBTmdJQVFjU293QUJCdktqQUFEWUNBRUhZcU1BQVFjeW93QUEyQWdCQnpLakFBRUhFcU1BQU5nSUFRZUNvd0FCQjFLakFBRFlDQUVIVXFNQUFRY3lvd0FBMkFnQkI2S2pBQUVIY3FNQUFOZ0lBUWR5b3dBQkIxS2pBQURZQ0FFSHdxTUFBUWVTb3dBQTJBZ0JCNUtqQUFFSGNxTUFBTmdJQVFmaW93QUJCN0tqQUFEWUNBRUhzcU1BQVFlU293QUEyQWdCQmdLbkFBRUgwcU1BQU5nSUFRZlNvd0FCQjdLakFBRFlDQUVHSXFjQUFRZnlvd0FBMkFnQkIvS2pBQUVIMHFNQUFOZ0lBUVpDcHdBQkJoS25BQURZQ0FFR0VxY0FBUWZ5b3dBQTJBZ0JCbUtuQUFFR01xY0FBTmdJQVFZeXB3QUJCaEtuQUFEWUNBRUdvcXNBQUlBVTJBZ0JCbEtuQUFFR01xY0FBTmdJQVFhQ3F3QUFnQkVGWWFpSUFOZ0lBSUFVZ0FFRUJjallDQkNBQUlBVnFRU2cyQWdSQnhLckFBRUdBZ0lBQk5nSUFEQU1MSUFCQkRHb29BZ0FnQlNBRFRYSWdBU0FEUzNJTkFTQUFJQVFnQjJvMkFnUkJxS3JBQUVHb3FzQUFLQUlBSWdCQkQycEJlSEVpQVVGNGFqWUNBRUdncXNBQVFhQ3F3QUFvQWdBZ0JHb2lCQ0FBSUFGcmFrRUlhaUlETmdJQUlBRkJmR29nQTBFQmNqWUNBQ0FBSUFScVFTZzJBZ1JCeEtyQUFFR0FnSUFCTmdJQURBSUxRYUNxd0FBZ0FDQUdheUlDTmdJQVFhaXF3QUJCcUtyQUFDZ0NBQ0lBSUFacUlnRTJBZ0FnQVNBQ1FRRnlOZ0lFSUFBZ0JrRURjallDQkNBQVFRaHFJUUlNQWd0QnlLckFBRUhJcXNBQUtBSUFJZ0FnQlNBQUlBVkpHellDQUNBRUlBVnFJUUZCdEtyQUFDRUFBa0FEUUNBQklBQW9BZ0JIQkVBZ0FDZ0NDQ0lBRFFFTUFnc0xJQUJCREdvb0FnQU5BQ0FBSUFVMkFnQWdBQ0FBS0FJRUlBUnFOZ0lFSUFVZ0JrRURjallDQkNBRklBWnFJUUFnQVNBRmF5QUdheUVHQWtBQ1FDQUJRYWlxd0FBb0FnQkhCRUJCcEtyQUFDZ0NBQ0FCUmcwQklBRkJCR29vQWdBaUFrRURjVUVCUmdSQUlBRWdBa0Y0Y1NJQ0VCRWdBaUFHYWlFR0lBRWdBbW9oQVFzZ0FTQUJLQUlFUVg1eE5nSUVJQUFnQmtFQmNqWUNCQ0FBSUFacUlBWTJBZ0FnQmtHQUFrOEVRQ0FBUWdBM0FoQWdBQUovUVFBZ0JrRUlkaUlDUlEwQUdrRWZJQVpCLy8vL0Iwc05BQm9nQmtFR0lBSm5JZ0pyUVI5eGRrRUJjU0FDUVFGMGEwRSthZ3NpQVRZQ0hDQUJRUUowUVp5cHdBQnFJUUlDUUFKQUFrQUNRRUdRcDhBQUtBSUFJZ1JCQVNBQlFSOXhkQ0lEY1FSQUlBSW9BZ0FpQWtFRWFpZ0NBRUY0Y1NBR1J3MEJJQUloQkF3Q0MwR1FwOEFBSUFNZ0JISTJBZ0FnQWlBQU5nSUFEQU1MSUFaQkFFRVpJQUZCQVhaclFSOXhJQUZCSDBZYmRDRUJBMEFnQWlBQlFSMTJRUVJ4YWtFUWFpSURLQUlBSWdSRkRRSWdBVUVCZENFQklBUWlBa0VFYWlnQ0FFRjRjU0FHUncwQUN3c2dCQ2dDQ0NJQ0lBQTJBZ3dnQkNBQU5nSUlJQUJCQURZQ0dDQUFJQVEyQWd3Z0FDQUNOZ0lJREFVTElBTWdBRFlDQUFzZ0FDQUNOZ0lZSUFBZ0FEWUNEQ0FBSUFBMkFnZ01Bd3NnQmtFRGRpSUJRUU4wUVpTbndBQnFJUUlDZjBHTXA4QUFLQUlBSWdSQkFTQUJkQ0lCY1FSQUlBSW9BZ2dNQVF0QmpLZkFBQ0FCSUFSeU5nSUFJQUlMSVFFZ0FpQUFOZ0lJSUFFZ0FEWUNEQ0FBSUFJMkFnd2dBQ0FCTmdJSURBSUxRYWlxd0FBZ0FEWUNBRUdncXNBQVFhQ3F3QUFvQWdBZ0Jtb2lBallDQUNBQUlBSkJBWEkyQWdRTUFRdEJwS3JBQUNBQU5nSUFRWnlxd0FCQm5LckFBQ2dDQUNBR2FpSUNOZ0lBSUFBZ0FrRUJjallDQkNBQUlBSnFJQUkyQWdBTElBVkJDR29QQzBHMHFzQUFJUUFEUUFKQUlBQW9BZ0FpQVNBRFRRUkFJQUVnQUNnQ0JHb2lCeUFEU3cwQkN5QUFLQUlJSVFBTUFRc0xRYWlxd0FBZ0JUWUNBRUdncXNBQUlBUkJXR29pQURZQ0FDQUZJQUJCQVhJMkFnUWdBQ0FGYWtFb05nSUVRY1Nxd0FCQmdJQ0FBVFlDQUNBRElBZEJZR3BCZUhGQmVHb2lBQ0FBSUFOQkVHcEpHeUlCUVJzMkFnUkJ0S3JBQUNrQ0FDRUpJQUZCRUdwQnZLckFBQ2tDQURjQ0FDQUJJQWszQWdoQndLckFBRUVBTmdJQVFiaXF3QUFnQkRZQ0FFRzBxc0FBSUFVMkFnQkJ2S3JBQUNBQlFRaHFOZ0lBSUFGQkhHb2hBQU5BSUFCQkJ6WUNBQ0FISUFCQkJHb2lBRXNOQUFzZ0FTQURSZzBBSUFFZ0FTZ0NCRUYrY1RZQ0JDQURJQUVnQTJzaUJVRUJjallDQkNBQklBVTJBZ0FnQlVHQUFrOEVRQ0FEUWdBM0FoQWdBMEVjYWdKL1FRQWdCVUVJZGlJQVJRMEFHa0VmSUFWQi8vLy9CMHNOQUJvZ0JVRUdJQUJuSWdCclFSOXhka0VCY1NBQVFRRjBhMEUrYWdzaUFEWUNBQ0FBUVFKMFFaeXB3QUJxSVFFQ1FBSkFBa0FDUUVHUXA4QUFLQUlBSWdSQkFTQUFRUjl4ZENJSGNRUkFJQUVvQWdBaUJFRUVhaWdDQUVGNGNTQUZSdzBCSUFRaEFBd0NDMEdRcDhBQUlBUWdCM0kyQWdBZ0FTQUROZ0lBSUFOQkdHb2dBVFlDQUF3REN5QUZRUUJCR1NBQVFRRjJhMEVmY1NBQVFSOUdHM1FoQVFOQUlBUWdBVUVkZGtFRWNXcEJFR29pQnlnQ0FDSUFSUTBDSUFGQkFYUWhBU0FBSVFRZ0FFRUVhaWdDQUVGNGNTQUZSdzBBQ3dzZ0FDZ0NDQ0lCSUFNMkFnd2dBQ0FETmdJSUlBTkJHR3BCQURZQ0FDQURJQUEyQWd3Z0F5QUJOZ0lJREFNTElBY2dBellDQUNBRFFSaHFJQVEyQWdBTElBTWdBellDRENBRElBTTJBZ2dNQVFzZ0JVRURkaUlCUVFOMFFaU253QUJxSVFBQ2YwR01wOEFBS0FJQUlnUkJBU0FCZENJQmNRUkFJQUFvQWdnTUFRdEJqS2ZBQUNBQklBUnlOZ0lBSUFBTElRRWdBQ0FETmdJSUlBRWdBellDRENBRElBQTJBZ3dnQXlBQk5nSUlDMEdncXNBQUtBSUFJZ0FnQmswTkFFR2dxc0FBSUFBZ0Jtc2lBallDQUVHb3FzQUFRYWlxd0FBb0FnQWlBQ0FHYWlJQk5nSUFJQUVnQWtFQmNqWUNCQ0FBSUFaQkEzSTJBZ1FnQUVFSWFnOExJQUlQQ3lBQklBYzJBaGdnQWlnQ0VDSUFCRUFnQVNBQU5nSVFJQUFnQVRZQ0dBc2dBa0VVYWlnQ0FDSUFSUTBBSUFGQkZHb2dBRFlDQUNBQUlBRTJBaGdMQWtBZ0JFRVFUd1JBSUFJZ0JrRURjallDQkNBQ0lBWnFJZ01nQkVFQmNqWUNCQ0FESUFScUlBUTJBZ0JCbktyQUFDZ0NBQ0lBQkVBZ0FFRURkaUlGUVFOMFFaU253QUJxSVFCQnBLckFBQ2dDQUNFQkFuOUJqS2ZBQUNnQ0FDSUdRUUVnQlVFZmNYUWlCWEVFUUNBQUtBSUlEQUVMUVl5bndBQWdCU0FHY2pZQ0FDQUFDeUVGSUFBZ0FUWUNDQ0FGSUFFMkFnd2dBU0FBTmdJTUlBRWdCVFlDQ0F0QnBLckFBQ0FETmdJQVFaeXF3QUFnQkRZQ0FBd0JDeUFDSUFRZ0Jtb2lBRUVEY2pZQ0JDQUFJQUpxSWdBZ0FDZ0NCRUVCY2pZQ0JBc2dBa0VJYWd2aEVBSVNmd0orSXdCQmdBRnJJZ1lrQUNBR0lBTTJBaXdnQmlBQ05nSW9Ba0FDZndKQUFrQUNRQUpBSUFFdEFFZEZCRUFnQVNrRE9DRVlJQUZDQURjRE9BSi9JQmhDLy84RGcxQkZCRUFnR0VJd2lLY2hFU0FZUWhDSXB5RU1JQmhDSUlpbkRBRUxJQVpCSUdvZ0FTQUdRU2hxRUNzZ0JpOEJJRVVFUUVFQklRME1CZ3RCQXlFTklBWXZBU0lpRENJQ0lBRXZBVUJQRFFVZ0FpQUJMd0ZDUmcwQ0lBRXZBVVFnREVILy93TnhSZzBESUFGQkdHb29BZ0JGRFFVZ0FVRW9haUFCUVJCcUlnY2dEQkFtR2lBQktBSVlJZ0lnREVILy93TnhJZ3BORFFRZ0J5Z0NBQ0FLUVFKMGFpSUNMUUFDSVJFZ0FpOEJBQXNoRXlBR1FSaHFJQUZCS0dvUVFpQUdLQUlZSVFJQ1FDQUdLQUljSWdjZ0JVMEVRQ0FIRFFGQkFTRVNRUUVoRFNBRklRZEJBUXdIQ3lBRlJRUkFRUUVoRFVFQUlRZEJBUXdIQ3lBRUlBSWdCUkJMR2lBQlFUQnFJZ0lnQWlnQ0FDQUZhallDQUVHSWc4QUFJUVJCQUNFTlFRQWhCMEVCREFZTElBUWdBaUFIRUVzZ0FVRXdhaUlDSUFJb0FnQWdCMm8yQWdBZ0Iyb2hCQ0FGSUFkcklRZEJBQ0VOUVFFTUJRc2dBRUVDT2dBSUlBQkNBRGNDQUF3RkN5QUJJQUV0QUVZaUIwRUJhaUlDT2dBS0lBRkJBU0FIUVE5eGRFRUNhanNCUUNBQlFYOGdBa0VQY1hSQmYzTTdBUWdnQVVFUWFpQUhFQTFCQUNFTVFRQWhEU0FGSVFkQkFBd0RDeUFCUVFFNkFFZEJBaUVOREFFTElBb2dBa0hvaHNBQUVEWUFDMEVBSVF3Z0JTRUhRUUFMSVFJZ0JrRTRha0VBTmdJQUlBWkNBRGNETUNBR1FjZ0Fha0VBTmdJQUlBWkNBRGNEUUNBR1Fmd0Fha0VBTmdJQUlBWkI5QUJxUVFBMkFnQWdCa0hzQUdwQkFEWUNBQ0FHUWVRQWFrRUFOZ0lBSUFaQjNBQnFRUUEyQWdBZ0JrSFlpY0FBTmdKNElBWkIySW5BQURZQ2NDQUdRZGlKd0FBMkFtZ2dCa0hZaWNBQU5nSmdJQVpCMkluQUFEWUNXQ0FHUVFBMkFsUWdCa0hZaWNBQU5nSlFBa0FDZndKQUlBSkZEUUFnQVVFUWFpRVVJQUZCS0dvaEZTQUdRY2dBYWlFWElBWkJQbW9oRmdKQUFrQUNRQUpBQWtBQ1FBSkFBa0FEUUFKQUFrQWdCdzBBSUFaQkVHb2dGUkJDSUFZb0FoUkZEUUJCQUNFSERBRUxJQUVnQmtFb2FoQVlRUUFoQ3lBWElSQkJBQ0VPQWtBQ1FBSkFBa0FDUUFKQUFrQUNRQUpBQTBBZ0FTMEFDeUlDSUFFdEFBb2lDRWtOQVNBQklBSWdDR3M2QUFzZ0JrRXdhaUFMYWlJS0lBRXZBUWdpQWlBQktRTUFJQWl0aVNJWXAzRTdBUUFnQVNBWUlBS3RRbitGUW9DQWZJU0ROd01BSUE0RVFDQU9RWDlxUVFWTERRVWdCeUFMSUJacUx3RUFJZ0pKRFFZZ0VDQUVOZ0lBSUJCQkJHb2dBallDQUNBSElBSnJJUWNnQWlBRWFpRUVDeUFCTHdGQUlnSWdEbXBCLy84RGNTQUJMd0VJSUFFdEFFaHJRZi8vQTNGR0RRSWdDaThCQUNJS0lBRXZBVUpHSUFvZ0FrOXlEUUlnQ2lBQkx3RkVSZzBDSUFFb0FpUWlBaUFLVFEwR0lBY2dBU2dDSENBS1FRRjBhaThCQUNJQ1NRMENJQTVCQVdvaERpQUxJQlpxUVFKcUlBSTdBUUFnRUVFSWFpRVFJQXRCQW1vaUMwRU1SdzBBQzBFR0lRNUJCU0VRSUFZdkFUb2hDQXdIQ3lBT0RRRkJBU0FOSUJJYklRME1DQXNnRGtFQmFpRU9DeUFPUVFkUERRTWdCa0V3YWlBT1FYOXFJaEJCQVhScUx3RUFJUWdnRUEwRUlBd2hDZ3dGQ3lBT1FYOXFRUVpCbUlUQUFCQTJBQXRCNklIQUFFRWpRZmlDd0FBUVNBQUxJQW9nQWtHb2hNQUFFRFlBQ3lBT1FRWkJ1SVRBQUJBM0FBc2dCa0hRQUdvaEFpQUdRVEJxSVFzRFFDQUdRUWhxSUJRZ0ZDQUxMd0VBSWdvZ0FpZ0NBQ0FDUVFScUtBSUFFQ2tnREJBaklBWXRBQW9oRVNBR0x3RUlJUk1nQVNBQkx3RkFRUUZxT3dGQUlBdEJBbW9oQ3lBQ1FRaHFJUUlnQ2lFTUlCQkJmMm9pRUEwQUN5QU9RUU4wSUFacVFVQnJJZ0lvQWdRaENTQUNRUUEyQWdRZ0FpZ0NBQ0VQSUFKQmlJUEFBRFlDQUFzZ0NDSU1JQUV2QVVKR0RRTUNRQ0FCTHdGRUlBaEhCRUFnQ0NBQkx3RkFJZ0pORFFGQkF5RU5RUUFNRFFzZ0FVRUJPZ0JIUVFJaERVRUFEQXdMQW44Z0J3Si9Ba0FDUUNBQ0lBaEhCRUFnQVNnQ0pDSUNJQWhMRFFFZ0NDQUNRZGlFd0FBUU5nQUxJQUVvQWlRaUFpQUtRZi8vQTNFaUNFME5DQ0FISUFFb0Fod2dDRUVCZEdvdkFRQkJBV3BCLy84RGNTSUNUdzBCSUE4RVFDQUJLQUlzSWdJZ0NVa05DaUFCS0FJb0lBOGdDUkJMR2lBQklBazJBakFnQVNBSk5nSTBDMEVBSVE4Z0ZSQXpJUXRCQVF3REN5QUhJQUVvQWh3Z0NFRUJkR292QVFBaUFra0VRRUVBSVE4Z0ZTQVVJQXdRSmlFTFFRRU1Bd3NnRkNBTUlBUWdBaEFwSVFzZ0Fnd0JDeUFQUlFSQUlBRW9BaXdpQ0NBQktBSTBJZ2xKRFFrZ0ZTZ0NBQ0VQQ3lBSlJRMEVJQWtnQWtzTkNTQVBMUUFBSVFzZ0JDQVBJQWtRU3lBQ0lBbEdEUW9nQ1dvZ0N6b0FBQ0FDQ3lJSmF5RUhJQWtnQkNJUGFpRUVRUUFMSUFFb0FoaEIveDlOQkVBZ0JpQVVJQXNnQ2hBaklBRXZBVUFoRUNBR0xRQUNJUkVnQmk4QkFDRVRBa0FnQVMwQUNpSUlRUXRMRFFBZ0VDQUJMd0VJSWdvZ0FTMEFTR3RCLy84RGNVY05BQ0FCSUFoQkFXbzZBQW9nQVNBS1FRRjBRUUZ5T3dFSUN5QUJJQkJCQVdvN0FVQUxRUUFoRWtVTkFRc0xRZ0VoR1NBUFJRMEtJQUVvQWl3aUFpQUpTUTBISUFFb0FpZ2dEeUFKRUVzYUlBRWdDVFlDTUNBQklBazJBalFNQ2d0QkFFRUFRWWlGd0FBUU5nQUxJQUVRTkF3R0N5QUlJQUpCeUlUQUFCQTJBQXNnQ1NBQ1FlaUV3QUFRTndBTElBa2dDRUg0aE1BQUVEY0FDeUFKSUFKQm1JWEFBQkEzQUF0QkFFRUFRYWlGd0FBUU5nQUxJQWtnQWtHNGhjQUFFRGNBQzBFQUN5RU1RUUFoRTBFQUlSRUxJQUFnQlNBSGF6WUNCQ0FBSUFNZ0JpZ0NMQ0lDYXpZQ0FDQUFRUUFnRFNBRElBSkxHeUFOSUExQkFVWWJPZ0FJSUFFZ0RLMUMvLzhEZzBJUWhpQVpoQ0FUclVMLy93T0RRaUNHaENBUnJVTC9BWU5DTUlhRU53TTRDeUFHUVlBQmFpUUFDOVlRQWhGL0FuNGpBRUdBQVdzaUJpUUFJQVlnQXpZQ0xDQUdJQUkyQWlnQ1FBSi9Ba0FDUUFKQUFrQWdBUzBBUjBVRVFDQUJLUU00SVJjZ0FVSUFOd000QW44Z0YwTC8vd09EVUVVRVFDQVhRakNJcHlFUklCZENFSWluSVF3Z0YwSWdpS2NNQVFzZ0JrRWdhaUFCSUFaQktHb1FMaUFHTHdFZ1JRUkFRUUVoRFF3R0MwRURJUTBnQmk4QklpSU1JZ0lnQVM4QlFFOE5CU0FDSUFFdkFVSkdEUUlnQVM4QlJDQU1RZi8vQTNGR0RRTWdBVUVZYWlnQ0FFVU5CU0FCUVNocUlBRkJFR29pQnlBTUVDWWFJQUVvQWhnaUFpQU1RZi8vQTNFaUNVME5CQ0FIS0FJQUlBbEJBblJxSWdJdEFBSWhFU0FDTHdFQUN5RVNJQVpCR0dvZ0FVRW9haEJDSUFZb0FoZ2hBZ0pBSUFZb0Fod2lCeUFGVFFSQUlBY05BVUVCSVFoQkFTRU5JQVVoQjBFQkRBY0xJQVZGQkVCQkFTRU5RUUFoQjBFQkRBY0xJQVFnQWlBRkVFc2FJQUZCTUdvaUFpQUNLQUlBSUFWcU5nSUFRWWlEd0FBaEJFRUFJUTFCQUNFSFFRRU1CZ3NnQkNBQ0lBY1FTeUFCUVRCcUlnSWdBaWdDQUNBSGFqWUNBQ0FIYWlFRUlBVWdCMnNoQjBFQUlRMUJBUXdGQ3lBQVFRSTZBQWdnQUVJQU53SUFEQVVMSUFFZ0FTMEFSaUlIUVFGcUlnSTZBQW9nQVVFQklBZEJEM0YwUVFKcU93RkFJQUZCZnlBQ1FROXhkRUYvY3pzQkNDQUJRUkJxSUFjUURVRUFJUXhCQUNFTklBVWhCMEVBREFNTElBRkJBVG9BUjBFQ0lRME1BUXNnQ1NBQ1FlaUd3QUFRTmdBTFFRQWhEQ0FGSVFkQkFBc2hBaUFHUVRocVFRQTJBZ0FnQmtJQU53TXdJQVpCeUFCcVFRQTJBZ0FnQmtJQU53TkFJQVpCL0FCcVFRQTJBZ0FnQmtIMEFHcEJBRFlDQUNBR1Fld0Fha0VBTmdJQUlBWkI1QUJxUVFBMkFnQWdCa0hjQUdwQkFEWUNBQ0FHUWRpSndBQTJBbmdnQmtIWWljQUFOZ0p3SUFaQjJJbkFBRFlDYUNBR1FkaUp3QUEyQW1BZ0JrSFlpY0FBTmdKWUlBWkJBRFlDVkNBR1FkaUp3QUEyQWxBQ1FBSi9Ba0FnQWtVTkFDQUJRUkJxSVJNZ0FVRW9haUVVSUFaQnlBQnFJUllnQmtFK2FpRVZBa0FDUUFKQUFrQUNRQUpBQWtBQ1FBTkFBa0FDUUNBSERRQWdCa0VRYWlBVUVFSWdCaWdDRkVVTkFFRUFJUWNNQVFzZ0FTQUdRU2hxRUNCQkFDRUxJQlloRUVFQUlRNENRQUpBQWtBQ1FBSkFBa0FDUUFKQUFrQURRQ0FCTFFBTElnSWdBUzBBQ2lJSlNRMEJJQUVnQWlBSmF6b0FDeUFCSUFFcEF3QWlGeUFKclVJL2c0ZzNBd0FnQmtFd2FpQUxhaUlKSUFFdkFRZ2dGNmR4T3dFQUlBNEVRQ0FPUVg5cVFRVkxEUVVnQnlBTElCVnFMd0VBSWdKSkRRWWdFQ0FFTmdJQUlCQkJCR29nQWpZQ0FDQUhJQUpySVFjZ0FpQUVhaUVFQ3lBQkx3RkFJZ0lnRG1wQi8vOERjU0FCTHdFSUlBRXRBRWhyUWYvL0EzRkdEUUlnQ1M4QkFDSUpJQUV2QVVKR0lBa2dBazl5RFFJZ0NTQUJMd0ZFUmcwQ0lBRW9BaVFpQWlBSlRRMEdJQWNnQVNnQ0hDQUpRUUYwYWk4QkFDSUNTUTBDSUE1QkFXb2hEaUFMSUJWcVFRSnFJQUk3QVFBZ0VFRUlhaUVRSUF0QkFtb2lDMEVNUncwQUMwRUdJUTVCQlNFUUlBWXZBVG9oQ0F3SEN5QU9EUUZCQVNBTklBZ2JJUTBNQ0FzZ0RrRUJhaUVPQ3lBT1FRZFBEUU1nQmtFd2FpQU9RWDlxSWhCQkFYUnFMd0VBSVFnZ0VBMEVJQXdoQ1F3RkN5QU9RWDlxUVFaQm1JVEFBQkEyQUF0QjZJSEFBRUVqUWZpQ3dBQVFTQUFMSUFrZ0FrR29oTUFBRURZQUN5QU9RUVpCdUlUQUFCQTNBQXNnQmtIUUFHb2hBaUFHUVRCcUlRc0RRQ0FHUVFocUlCTWdFeUFMTHdFQUlna2dBaWdDQUNBQ1FRUnFLQUlBRUNrZ0RCQWpJQVl0QUFvaEVTQUdMd0VJSVJJZ0FTQUJMd0ZBUVFGcU93RkFJQXRCQW1vaEN5QUNRUWhxSVFJZ0NTRU1JQkJCZjJvaUVBMEFDeUFPUVFOMElBWnFRVUJySWdJb0FnUWhDaUFDUVFBMkFnUWdBaWdDQUNFUElBSkJpSVBBQURZQ0FBc2dDQ0lNSUFFdkFVSkdEUU1DUUNBQkx3RkVJQWhIQkVBZ0NDQUJMd0ZBSWdKTkRRRkJBeUVOUVFBTURRc2dBVUVCT2dCSFFRSWhEVUVBREF3TEFuOGdCd0ovQWtBQ1FDQUNJQWhIQkVBZ0FTZ0NKQ0lDSUFoTERRRWdDQ0FDUWRpRXdBQVFOZ0FMSUFFb0FpUWlBaUFKUWYvL0EzRWlDRTBOQ0NBSElBRW9BaHdnQ0VFQmRHb3ZBUUJCQVdwQi8vOERjU0lDVHcwQklBOEVRQ0FCS0FJc0lnSWdDa2tOQ2lBQktBSW9JQThnQ2hCTEdpQUJJQW8yQWpBZ0FTQUtOZ0kwQzBFQUlROGdGQkF6SVF0QkFRd0RDeUFISUFFb0Fod2dDRUVCZEdvdkFRQWlBa2tFUUVFQUlROGdGQ0FUSUF3UUppRUxRUUVNQXdzZ0V5QU1JQVFnQWhBcElRc2dBZ3dCQ3lBUFJRUkFJQUVvQWl3aUNDQUJLQUkwSWdwSkRRa2dGQ2dDQUNFUEN5QUtSUTBFSUFvZ0Frc05DU0FQTFFBQUlRc2dCQ0FQSUFvUVN5QUNJQXBHRFFvZ0Ntb2dDem9BQUNBQ0N5SUtheUVISUFvZ0JDSVBhaUVFUVFBTElBRW9BaGhCL3g5TkJFQWdCaUFUSUFzZ0NSQWpJQUV2QVVBaEVDQUdMUUFDSVJFZ0JpOEJBQ0VTQWtBZ0FTMEFDaUlJUVF0TERRQWdFQ0FCTHdFSUlna2dBUzBBU0d0Qi8vOERjVWNOQUNBQklBaEJBV282QUFvZ0FTQUpRUUYwUVFGeU93RUlDeUFCSUJCQkFXbzdBVUFMUVFBaENFVU5BUXNMUWdFaEdDQVBSUTBLSUFFb0Fpd2lBaUFLU1EwSElBRW9BaWdnRHlBS0VFc2FJQUVnQ2pZQ01DQUJJQW8yQWpRTUNndEJBRUVBUVlpRndBQVFOZ0FMSUFFUU5Bd0dDeUFJSUFKQnlJVEFBQkEyQUFzZ0NpQUNRZWlFd0FBUU53QUxJQW9nQ0VINGhNQUFFRGNBQ3lBS0lBSkJtSVhBQUJBM0FBdEJBRUVBUWFpRndBQVFOZ0FMSUFvZ0FrRzRoY0FBRURjQUMwRUFDeUVNUVFBaEVrRUFJUkVMSUFBZ0JTQUhhellDQkNBQUlBTWdCaWdDTENJQ2F6WUNBQ0FBUVFBZ0RTQURJQUpMR3lBTklBMUJBVVliT2dBSUlBRWdESzFDLy84RGcwSVFoaUFZaENBU3JVTC8vd09EUWlDR2hDQVJyVUwvQVlOQ01JYUVOd000Q3lBR1FZQUJhaVFBQzZvSUFRWi9Jd0JCOEFCcklnVWtBQ0FGSUFNMkFnd2dCU0FDTmdJSVFRRWhCeUFCSVFZQ1FDQUJRWUVDU1EwQVFRQWdBV3NoQ1VHQUFpRUlBMEFDUUNBSUlBRlBEUUJCQUNFSElBQWdDR29zQUFCQnYzOU1EUUFnQ0NFR0RBSUxJQWhCZjJvaEJrRUFJUWNnQ0VFQlJnMEJJQWdnQ1dvZ0JpRUlRUUZIRFFBTEN5QUZJQVkyQWhRZ0JTQUFOZ0lRSUFWQkFFRUZJQWNiTmdJY0lBVkI4SXZBQUVIQWtzQUFJQWNiTmdJWUFrQUNmd0pBQWtBZ0FpQUJTeUlISUFNZ0FVdHlSUVJBSUFJZ0Ewc05BUUpBSUFKRklBRWdBa1p5UlFSQUlBRWdBazBOQVNBQUlBSnFMQUFBUVVCSURRRUxJQU1oQWdzZ0JTQUNOZ0lnSUFKQkFDQUJJQUpIRzBVRVFDQUNJUWNNQXdzZ0FVRUJhaUVEQTBBQ1FDQUNJQUZQRFFBZ0FDQUNhaXdBQUVGQVNBMEFJQUloQnlBRlFTUnFEQVVMSUFKQmYyb2hCeUFDUVFGR0RRTWdBaUFEUmlBSElRSkZEUUFMREFJTElBVWdBaUFESUFjYk5nSW9JQVZCeEFCcVFRTTJBZ0FnQlVIY0FHcEJIVFlDQUNBRlFkUUFha0VkTmdJQUlBVkNBemNDTkNBRlFlaVN3QUEyQWpBZ0JVRWNOZ0pNSUFVZ0JVSElBR28yQWtBZ0JTQUZRUmhxTmdKWUlBVWdCVUVRYWpZQ1VDQUZJQVZCS0dvMkFrZ01Bd3NnQlVIa0FHcEJIVFlDQUNBRlFkd0Fha0VkTmdJQUlBVkIxQUJxUVJ3MkFnQWdCVUhFQUdwQkJEWUNBQ0FGUWdRM0FqUWdCVUdrazhBQU5nSXdJQVZCSERZQ1RDQUZJQVZCeUFCcU5nSkFJQVVnQlVFWWFqWUNZQ0FGSUFWQkVHbzJBbGdnQlNBRlFReHFOZ0pRSUFVZ0JVRUlhallDU0F3Q0N5QUZRU1JxQ3lFSUFrQWdBU0FIUmcwQVFRRWhBd0pBQWtBQ1FDQUFJQWRxSWdZc0FBQWlBa0YvVEFSQVFRQWhBeUFBSUFGcUlnRWhBQ0FCSUFaQkFXcEhCRUFnQmkwQUFVRS9jU0VESUFaQkFtb2hBQXNnQWtFZmNTRUpJQUpCL3dGeFFkOEJTdzBCSUFNZ0NVRUdkSEloQWd3Q0N5QUZJQUpCL3dGeE5nSWtJQVZCS0dvaEFRd0NDMEVBSVFvZ0FTRUdJQUFnQVVjRVFDQUFMUUFBUVQ5eElRb2dBRUVCYWlFR0N5QUtJQU5CQm5SeUlRQWdBa0gvQVhGQjhBRkpCRUFnQUNBSlFReDBjaUVDREFFTFFRQWhBaUFCSUFaSEJIOGdCaTBBQUVFL2NRVkJBQXNnQ1VFU2RFR0FnUEFBY1NBQVFRWjBjbklpQWtHQWdNUUFSZzBDQ3lBRklBSTJBaVJCQVNFRElBVkJLR29oQVNBQ1FZQUJTUTBBUVFJaEF5QUNRWUFRU1EwQVFRTkJCQ0FDUVlDQUJFa2JJUU1MSUFVZ0J6WUNLQ0FGSUFNZ0IybzJBaXdnQlVIRUFHcEJCVFlDQUNBRlFld0Fha0VkTmdJQUlBVkI1QUJxUVIwMkFnQWdCVUhjQUdwQkhqWUNBQ0FGUWRRQWFrRWZOZ0lBSUFWQ0JUY0NOQ0FGUWZpVHdBQTJBakFnQlNBQk5nSllJQVVnQ0RZQ1VDQUZRUncyQWt3Z0JTQUZRY2dBYWpZQ1FDQUZJQVZCR0dvMkFtZ2dCU0FGUVJCcU5nSmdJQVVnQlVFZ2FqWUNTQXdCQzBIOGk4QUFRU3NnQkJCSUFBc2dCVUV3YWlBRUVGRUFDOUlJQVFWL0lBQkJlR29pQVNBQVFYeHFLQUlBSWdOQmVIRWlBR29oQWdKQUFrQWdBMEVCY1EwQUlBTkJBM0ZGRFFFZ0FTZ0NBQ0lESUFCcUlRQWdBU0FEYXlJQlFhU3F3QUFvQWdCR0JFQWdBaWdDQkVFRGNVRURSdzBCUVp5cXdBQWdBRFlDQUNBQ0lBSW9BZ1JCZm5FMkFnUWdBU0FBUVFGeU5nSUVJQUFnQVdvZ0FEWUNBQThMSUFFZ0F4QVJDd0pBSUFKQkJHb2lCQ2dDQUNJRFFRSnhCRUFnQkNBRFFYNXhOZ0lBSUFFZ0FFRUJjallDQkNBQUlBRnFJQUEyQWdBTUFRc0NRQ0FDUWFpcXdBQW9BZ0JIQkVCQnBLckFBQ2dDQUNBQ1JnMEJJQUlnQTBGNGNTSUNFQkVnQVNBQUlBSnFJZ0JCQVhJMkFnUWdBQ0FCYWlBQU5nSUFJQUZCcEtyQUFDZ0NBRWNOQWtHY3FzQUFJQUEyQWdBUEMwR29xc0FBSUFFMkFnQkJvS3JBQUVHZ3FzQUFLQUlBSUFCcUlnQTJBZ0FnQVNBQVFRRnlOZ0lFUWFTcXdBQW9BZ0FnQVVZRVFFR2Nxc0FBUVFBMkFnQkJwS3JBQUVFQU5nSUFDMEhFcXNBQUtBSUFJZ0lnQUU4TkFrR29xc0FBS0FJQUlnQkZEUUlDUUVHZ3FzQUFLQUlBSWdOQktVa05BRUcwcXNBQUlRRURRQ0FCS0FJQUlnUWdBRTBFUUNBRUlBRW9BZ1JxSUFCTERRSUxJQUVvQWdnaUFRMEFDd3RCektyQUFBSi9RZjhmUWJ5cXdBQW9BZ0FpQUVVTkFCcEJBQ0VCQTBBZ0FVRUJhaUVCSUFBb0FnZ2lBQTBBQ3lBQlFmOGZJQUZCL3g5TEd3czJBZ0FnQXlBQ1RRMENRY1Nxd0FCQmZ6WUNBQThMUWFTcXdBQWdBVFlDQUVHY3FzQUFRWnlxd0FBb0FnQWdBR29pQURZQ0FDQUJJQUJCQVhJMkFnUWdBQ0FCYWlBQU5nSUFEd3RCektyQUFBSi9Ba0FnQUVHQUFrOEVRQ0FCUWdBM0FoQWdBVUVjYWdKL1FRQWdBRUVJZGlJQ1JRMEFHa0VmSUFCQi8vLy9CMHNOQUJvZ0FFRUdJQUpuSWdKclFSOXhka0VCY1NBQ1FRRjBhMEUrYWdzaUF6WUNBQ0FEUVFKMFFaeXB3QUJxSVFJQ1FBSkFBa0FDUUFKQVFaQ253QUFvQWdBaUJFRUJJQU5CSDNGMElnVnhCRUFnQWlnQ0FDSUNRUVJxS0FJQVFYaHhJQUJIRFFFZ0FpRUREQUlMUVpDbndBQWdCQ0FGY2pZQ0FDQUNJQUUyQWdBTUF3c2dBRUVBUVJrZ0EwRUJkbXRCSDNFZ0EwRWZSaHQwSVFRRFFDQUNJQVJCSFhaQkJIRnFRUkJxSWdVb0FnQWlBMFVOQWlBRVFRRjBJUVFnQXlJQ1FRUnFLQUlBUVhoeElBQkhEUUFMQ3lBREtBSUlJZ0FnQVRZQ0RDQURJQUUyQWdnZ0FVRVlha0VBTmdJQUlBRWdBellDRENBQklBQTJBZ2dNQWdzZ0JTQUJOZ0lBQ3lBQlFSaHFJQUkyQWdBZ0FTQUJOZ0lNSUFFZ0FUWUNDQXRCektyQUFFSE1xc0FBS0FJQVFYOXFJZ0EyQWdBZ0FBMERRYnlxd0FBb0FnQWlBQTBCUWY4ZkRBSUxJQUJCQTNZaUFrRURkRUdVcDhBQWFpRUFBbjlCaktmQUFDZ0NBQ0lEUVFFZ0FuUWlBbkVFUUNBQUtBSUlEQUVMUVl5bndBQWdBaUFEY2pZQ0FDQUFDeUVDSUFBZ0FUWUNDQ0FDSUFFMkFnd2dBU0FBTmdJTUlBRWdBallDQ0E4TFFRQWhBUU5BSUFGQkFXb2hBU0FBS0FJSUlnQU5BQXNnQVVIL0h5QUJRZjhmU3hzTE5nSUFDd3VXQndFS2Z5QUFLQUlRSVFNQ1FBSkFBa0FnQUNnQ0NDSU1RUUZIQkVBZ0EwRUJSZzBCREFNTElBTkJBVWNOQVFzZ0FTQUNhaUVEQWtBQ1FDQUFRUlJxS0FJQUlnaEZCRUFnQVNFRURBRUxJQUVoQkFOQUlBTWdCQ0lIUmcwQ0lBZEJBV29oQkFKQUlBY3NBQUFpQmtGL1NnMEFJQVpCL3dGeElRa0NmeUFESUFSR0JFQkJBQ0VLSUFNTUFRc2dCeTBBQVVFL2NTRUtJQWRCQW1vaUJBc2hCaUFKUWVBQlNRMEFBbjhnQXlBR1JnUkFRUUFoQ3lBRERBRUxJQVl0QUFCQlAzRWhDeUFHUVFGcUlnUUxJUVlnQ1VId0FVa05BQ0FESUFaR0JIOUJBQVVnQmtFQmFpRUVJQVl0QUFCQlAzRUxJQWxCRW5SQmdJRHdBSEVnQ2tFTWRISWdDMEVHZEhKeVFZQ0F4QUJHRFFNTElBUWdCMnNnQldvaEJTQUlRWDlxSWdnTkFBc0xJQU1nQkVZTkFBSkFJQVFzQUFBaUIwRi9TZzBBQW44Z0F5QUVRUUZxUmdSQUlBTWhDRUVBREFFTElBUkJBbW9oQ0NBRUxRQUJRVDl4UVFaMEN5QUhRZjhCY1VIZ0FVa05BQUovSUFNZ0NFWUVRQ0FESVFaQkFBd0JDeUFJUVFGcUlRWWdDQzBBQUVFL2NRc2dCMEgvQVhGQjhBRkpEUUFnQjBIL0FYRWhCM0loQkNBRElBWkdCSDlCQUFVZ0JpMEFBRUUvY1FzZ0IwRVNkRUdBZ1BBQWNTQUVRUVowY25KQmdJREVBRVlOQVFzQ1FDQUZSU0FDSUFWR2NrVUVRRUVBSVFNZ0JTQUNUdzBCSUFFZ0JXb3NBQUJCUUVnTkFRc2dBU0VEQ3lBRklBSWdBeHNoQWlBRElBRWdBeHNoQVFzZ0RFRUJSZzBBREFFTEFrQWdBZ1JBUVFBaEJDQUNJUVVnQVNFREEwQWdCQ0FETFFBQVFjQUJjVUdBQVVacUlRUWdBMEVCYWlFRElBVkJmMm9pQlEwQUN5QUNJQVJySUFBb0Fnd2lCazhOQWtFQUlRUWdBaUVGSUFFaEF3TkFJQVFnQXkwQUFFSEFBWEZCZ0FGR2FpRUVJQU5CQVdvaEF5QUZRWDlxSWdVTkFBc01BUXRCQUNFRUlBQW9BZ3dpQmcwQURBRUxRUUFoQXlBRUlBSnJJQVpxSWdRaEJRSkFBa0FDUUVFQUlBQXRBQ0FpQmlBR1FRTkdHMEVEY1VFQmF3NERBUUFCQWdzZ0JFRUJkaUVESUFSQkFXcEJBWFloQlF3QkMwRUFJUVVnQkNFREN5QURRUUZxSVFNQ1FBTkFJQU5CZjJvaUF3UkFJQUFvQWhnZ0FDZ0NCQ0FBS0FJY0tBSVFFUUFBUlEwQkRBSUxDeUFBS0FJRUlRUWdBQ2dDR0NBQklBSWdBQ2dDSENnQ0RCRUJBQTBBSUFWQkFXb2hBeUFBS0FJY0lRRWdBQ2dDR0NFQUEwQWdBMEYvYWlJRFJRUkFRUUFQQ3lBQUlBUWdBU2dDRUJFQUFFVU5BQXNMUVFFUEN5QUFLQUlZSUFFZ0FpQUFRUnhxS0FJQUtBSU1FUUVBQzdzR0FRUi9JQUFnQVdvaEFnSkFBa0FnQUVFRWFpZ0NBQ0lEUVFGeERRQWdBMEVEY1VVTkFTQUFLQUlBSWdNZ0FXb2hBU0FBSUFOcklnQkJwS3JBQUNnQ0FFWUVRQ0FDS0FJRVFRTnhRUU5IRFFGQm5LckFBQ0FCTmdJQUlBSWdBaWdDQkVGK2NUWUNCQ0FBSUFGQkFYSTJBZ1FnQWlBQk5nSUFEd3NnQUNBREVCRUxBa0FnQWtFRWFpZ0NBQ0lEUVFKeEJFQWdBa0VFYWlBRFFYNXhOZ0lBSUFBZ0FVRUJjallDQkNBQUlBRnFJQUUyQWdBTUFRc0NRQ0FDUWFpcXdBQW9BZ0JIQkVCQnBLckFBQ2dDQUNBQ1JnMEJJQUlnQTBGNGNTSUNFQkVnQUNBQklBSnFJZ0ZCQVhJMkFnUWdBQ0FCYWlBQk5nSUFJQUJCcEtyQUFDZ0NBRWNOQWtHY3FzQUFJQUUyQWdBUEMwR29xc0FBSUFBMkFnQkJvS3JBQUVHZ3FzQUFLQUlBSUFGcUlnRTJBZ0FnQUNBQlFRRnlOZ0lFSUFCQnBLckFBQ2dDQUVjTkFrR2Nxc0FBUVFBMkFnQkJwS3JBQUVFQU5nSUFEd3RCcEtyQUFDQUFOZ0lBUVp5cXdBQkJuS3JBQUNnQ0FDQUJhaUlCTmdJQUlBQWdBVUVCY2pZQ0JDQUFJQUZxSUFFMkFnQVBDeUFCUVlBQ1R3UkFJQUJDQURjQ0VDQUFRUnhxQW45QkFDQUJRUWgySWdKRkRRQWFRUjhnQVVILy8vOEhTdzBBR2lBQlFRWWdBbWNpQW10QkgzRjJRUUZ4SUFKQkFYUnJRVDVxQ3lJRE5nSUFJQU5CQW5SQm5LbkFBR29oQWdKQUFrQUNRQUpBUVpDbndBQW9BZ0FpQkVFQklBTkJIM0YwSWdWeEJFQWdBaWdDQUNJQ1FRUnFLQUlBUVhoeElBRkhEUUVnQWlFRERBSUxRWkNud0FBZ0JDQUZjallDQUNBQ0lBQTJBZ0FNQXdzZ0FVRUFRUmtnQTBFQmRtdEJIM0VnQTBFZlJodDBJUVFEUUNBQ0lBUkJIWFpCQkhGcVFSQnFJZ1VvQWdBaUEwVU5BaUFFUVFGMElRUWdBeUlDUVFScUtBSUFRWGh4SUFGSERRQUxDeUFES0FJSUlnRWdBRFlDRENBRElBQTJBZ2dnQUVFWWFrRUFOZ0lBSUFBZ0F6WUNEQ0FBSUFFMkFnZ1BDeUFGSUFBMkFnQUxJQUJCR0dvZ0FqWUNBQ0FBSUFBMkFnd2dBQ0FBTmdJSUR3c2dBVUVEZGlJQ1FRTjBRWlNud0FCcUlRRUNmMEdNcDhBQUtBSUFJZ05CQVNBQ2RDSUNjUVJBSUFFb0FnZ01BUXRCaktmQUFDQUNJQU55TmdJQUlBRUxJUUlnQVNBQU5nSUlJQUlnQURZQ0RDQUFJQUUyQWd3Z0FDQUNOZ0lJQ3d1cUJnRUhmd0pBQWtBQ1FBSkFBa0FDUUFKQUFrQWdBRUdBZ0FSUEJFQWdBRUdBZ0FoSkRRRWdBRUcxMlhOcVFiWGJLMGtnQUVIaWkzUnFRZUlMU1hJZ0FFR2ZxSFJxUVo4WVNTQUFRZDdpZEdwQkRrbHljaUFBUWY3Ly93QnhRWjd3Q2tZZ0FFR2lzblZxUVNKSmNpQUFRY3VSZFdwQkMwbHljZzBDSUFCQjhJTTRTUThMSUFCQmdQNERjVUVJZGlFR1FlaVV3QUFoQVNBQVFmOEJjU0VIQTBBQ1FDQUJRUUpxSVFVZ0FpQUJMUUFCSWdScUlRTWdCaUFCTFFBQUlnRkhCRUFnQVNBR1N3MEJJQU1oQWlBRklnRkJ1cFhBQUVjTkFnd0JDeUFESUFKSkRRUWdBMEdpQWtzTkJTQUNRYnFWd0FCcUlRRUNRQU5BSUFSRkRRRWdCRUYvYWlFRUlBRXRBQUFnQVVFQmFpRUJJQWRIRFFBTFFRQWhCQXdFQ3lBRElRSWdCU0lCUWJxVndBQkhEUUVMQ3lBQVFmLy9BM0VoQTBIY2w4QUFJUUZCQVNFRUEwQWdBVUVCYWlFQUFuOGdBQ0FCTFFBQUlnSkJHSFJCR0hVaUJVRUFUZzBBR2lBQVFaR2F3QUJHRFFZZ0FTMEFBU0FGUWY4QWNVRUlkSEloQWlBQlFRSnFDeUVCSUFNZ0Ftc2lBMEVBU0EwQ0lBUkJBWE1oQkNBQlFaR2F3QUJIRFFBTERBRUxJQUJCZ1A0RGNVRUlkaUVHUVpHYXdBQWhBU0FBUWY4QmNTRUhBMEFDUUNBQlFRSnFJUVVnQWlBQkxRQUJJZ1JxSVFNZ0JpQUJMUUFBSWdGSEJFQWdBU0FHU3cwQklBTWhBaUFGSWdGQjNackFBRWNOQWd3QkN5QURJQUpKRFFZZ0EwR3ZBVXNOQnlBQ1FkMmF3QUJxSVFFQ1FBTkFJQVJGRFFFZ0JFRi9haUVFSUFFdEFBQWdBVUVCYWlFQklBZEhEUUFMUVFBaEJBd0RDeUFESVFJZ0JTSUJRZDJhd0FCSERRRUxDeUFBUWYvL0EzRWhBMEdNbk1BQUlRRkJBU0VFQTBBZ0FVRUJhaUVBQW44Z0FDQUJMUUFBSWdKQkdIUkJHSFVpQlVFQVRnMEFHaUFBUWErZndBQkdEUWdnQVMwQUFTQUZRZjhBY1VFSWRISWhBaUFCUVFKcUN5RUJJQU1nQW1zaUEwRUFTQTBCSUFSQkFYTWhCQ0FCUWErZndBQkhEUUFMQ3lBRVFRRnhEd3NnQWlBRFFjaVV3QUFRT0FBTElBTkJvZ0pCeUpUQUFCQTNBQXRCL0l2QUFFRXJRZGlVd0FBUVNBQUxJQUlnQTBISWxNQUFFRGdBQ3lBRFFhOEJRY2lVd0FBUU53QUxRZnlMd0FCQkswSFlsTUFBRUVnQUM3RUZBUWQvUVN0QmdJREVBQ0FBS0FJQUlnbEJBWEVpQlJzaENpQUVJQVZxSVFnQ1FDQUpRUVJ4UlFSQVFRQWhBUXdCQ3lBQ0JFQWdBaUVHSUFFaEJRTkFJQWNnQlMwQUFFSEFBWEZCZ0FGR2FpRUhJQVZCQVdvaEJTQUdRWDlxSWdZTkFBc0xJQUlnQ0dvZ0Iyc2hDQXNDUUFKQUlBQW9BZ2hCQVVjRVFDQUFJQW9nQVNBQ0VFWU5BUXdDQ3lBQVFReHFLQUlBSWdZZ0NFMEVRQ0FBSUFvZ0FTQUNFRVlOQVF3Q0N3SkFBa0FDUUFKQUlBbEJDSEVFUUNBQUtBSUVJUWtnQUVFd05nSUVJQUF0QUNBaEN5QUFRUUU2QUNBZ0FDQUtJQUVnQWhCR0RRVkJBQ0VGSUFZZ0NHc2lBU0VDUVFFZ0FDMEFJQ0lHSUFaQkEwWWJRUU54UVFGckRnTUNBUUlEQzBFQUlRVWdCaUFJYXlJR0lRZ0NRQUpBQWtCQkFTQUFMUUFnSWdjZ0IwRURSaHRCQTNGQkFXc09Bd0VBQVFJTElBWkJBWFloQlNBR1FRRnFRUUYySVFnTUFRdEJBQ0VJSUFZaEJRc2dCVUVCYWlFRkEwQWdCVUYvYWlJRlJRMEVJQUFvQWhnZ0FDZ0NCQ0FBS0FJY0tBSVFFUUFBUlEwQUMwRUJEd3NnQVVFQmRpRUZJQUZCQVdwQkFYWWhBZ3dCQzBFQUlRSWdBU0VGQ3lBRlFRRnFJUVVDUUFOQUlBVkJmMm9pQlVVTkFTQUFLQUlZSUFBb0FnUWdBQ2dDSENnQ0VCRUFBRVVOQUF0QkFROExJQUFvQWdRaEFTQUFLQUlZSUFNZ0JDQUFLQUljS0FJTUVRRUFEUUVnQWtFQmFpRUhJQUFvQWh3aEFpQUFLQUlZSVFNRFFDQUhRWDlxSWdjRVFDQURJQUVnQWlnQ0VCRUFBRVVOQVF3REN3c2dBQ0FMT2dBZ0lBQWdDVFlDQkVFQUR3c2dBQ2dDQkNFRklBQWdDaUFCSUFJUVJnMEFJQUFvQWhnZ0F5QUVJQUFvQWh3b0Fnd1JBUUFOQUNBSVFRRnFJUWNnQUNnQ0hDRUJJQUFvQWhnaEFBTkFJQWRCZjJvaUIwVUVRRUVBRHdzZ0FDQUZJQUVvQWhBUkFBQkZEUUFMQzBFQkR3c2dBQ2dDR0NBRElBUWdBRUVjYWlnQ0FDZ0NEQkVCQUF2MEJRRUtmeU1BUVRCcklnTWtBQ0FEUVNScUlBRTJBZ0FnQTBFRE9nQW9JQU5DZ0lDQWdJQUVOd01JSUFNZ0FEWUNJQ0FEUVFBMkFoZ2dBMEVBTmdJUUFuOENRQUpBQWtBZ0FpZ0NDQ0lFQkVBZ0FpZ0NBQ0VHSUFJb0FnUWlDQ0FDUVF4cUtBSUFJZ1VnQlNBSVN4c2lCVVVOQVNBQUlBWW9BZ0FnQmlnQ0JDQUJLQUlNRVFFQURRTWdCa0VNYWlFQUlBSW9BaFFoQnlBQ0tBSVFJUW9nQlNFSkEwQWdBeUFFUVJ4cUxRQUFPZ0FvSUFNZ0JFRUVhaWtDQUVJZ2lUY0RDQ0FFUVJocUtBSUFJUUpCQUNFTFFRQWhBUUpBQWtBQ1FDQUVRUlJxS0FJQVFRRnJEZ0lBQWdFTElBSWdCMDhFUUNBQ0lBZEJ0SkRBQUJBMkFBc2dBa0VEZENBS2FpSU1LQUlFUVNCSERRRWdEQ2dDQUNnQ0FDRUNDMEVCSVFFTElBTWdBallDRkNBRElBRTJBaEFnQkVFUWFpZ0NBQ0VDQWtBQ1FBSkFJQVJCREdvb0FnQkJBV3NPQWdBQ0FRc2dBaUFIVHdSQUlBSWdCMEcwa01BQUVEWUFDeUFDUVFOMElBcHFJZ0VvQWdSQklFY05BU0FCS0FJQUtBSUFJUUlMUVFFaEN3c2dBeUFDTmdJY0lBTWdDellDR0NBRUtBSUFJZ0VnQjBrRVFDQUtJQUZCQTNScUlnRW9BZ0FnQTBFSWFpQUJLQUlFRVFBQURRVWdDVUYvYWlJSlJRMEVJQVJCSUdvaEJDQUFRWHhxSVFFZ0FDZ0NBQ0VDSUFCQkNHb2hBQ0FES0FJZ0lBRW9BZ0FnQWlBREtBSWtLQUlNRVFFQVJRMEJEQVVMQ3lBQklBZEJwSkRBQUJBMkFBc2dBaWdDQUNFR0lBSW9BZ1FpQ0NBQ1FSUnFLQUlBSWdVZ0JTQUlTeHNpQlVVTkFDQUNLQUlRSVFRZ0FDQUdLQUlBSUFZb0FnUWdBU2dDREJFQkFBMENJQVpCREdvaEFDQUZJUUlEUUNBRUtBSUFJQU5CQ0dvZ0JFRUVhaWdDQUJFQUFBMERJQUpCZjJvaUFrVU5BaUFFUVFocUlRUWdBRUY4YWlFQklBQW9BZ0FoQ1NBQVFRaHFJUUFnQXlnQ0lDQUJLQUlBSUFrZ0F5Z0NKQ2dDREJFQkFFVU5BQXNNQWd0QkFDRUZDeUFJSUFWTEJFQWdBeWdDSUNBR0lBVkJBM1JxSWdBb0FnQWdBQ2dDQkNBREtBSWtLQUlNRVFFQURRRUxRUUFNQVF0QkFRc2dBMEV3YWlRQUM0MEZBUWQvQWtBZ0FVSE0vM3RMRFFCQkVDQUJRUXRxUVhoeElBRkJDMGtiSVFJZ0FFRjhhaUlGS0FJQUlnWkJlSEVoQXdKQUFrQUNRQUpBQWtBQ1FDQUdRUU54QkVBZ0FFRjRhaUlISUFOcUlRZ2dBeUFDVHcwQlFhaXF3QUFvQWdBZ0NFWU5Ba0drcXNBQUtBSUFJQWhHRFFNZ0NFRUVhaWdDQUNJR1FRSnhEUVlnQmtGNGNTSUdJQU5xSWdNZ0FrOE5CQXdHQ3lBQ1FZQUNTU0FESUFKQkJISkpjaUFESUFKclFZR0FDRTl5RFFVTUJBc2dBeUFDYXlJQlFSQkpEUU1nQlNBQ0lBWkJBWEZ5UVFKeU5nSUFJQUlnQjJvaUJDQUJRUU55TmdJRUlBZ2dDQ2dDQkVFQmNqWUNCQ0FFSUFFUUJnd0RDMEdncXNBQUtBSUFJQU5xSWdNZ0FrME5BeUFGSUFJZ0JrRUJjWEpCQW5JMkFnQWdBaUFIYWlJQklBTWdBbXNpQkVFQmNqWUNCRUdncXNBQUlBUTJBZ0JCcUtyQUFDQUJOZ0lBREFJTFFaeXF3QUFvQWdBZ0Eyb2lBeUFDU1EwQ0FrQWdBeUFDYXlJQlFROU5CRUFnQlNBR1FRRnhJQU55UVFKeU5nSUFJQU1nQjJvaUFTQUJLQUlFUVFGeU5nSUVRUUFoQVF3QkN5QUZJQUlnQmtFQmNYSkJBbkkyQWdBZ0FpQUhhaUlFSUFGQkFYSTJBZ1FnQXlBSGFpSUNJQUUyQWdBZ0FpQUNLQUlFUVg1eE5nSUVDMEdrcXNBQUlBUTJBZ0JCbktyQUFDQUJOZ0lBREFFTElBZ2dCaEFSSUFNZ0Ftc2lBVUVRVHdSQUlBVWdBaUFGS0FJQVFRRnhja0VDY2pZQ0FDQUNJQWRxSWdRZ0FVRURjallDQkNBRElBZHFJZ0lnQWlnQ0JFRUJjallDQkNBRUlBRVFCZ3dCQ3lBRklBTWdCU2dDQUVFQmNYSkJBbkkyQWdBZ0F5QUhhaUlCSUFFb0FnUkJBWEkyQWdRTElBQWhCQXdCQ3lBQkVBQWlBa1VOQUNBQ0lBQWdBVUY4UVhnZ0JTZ0NBQ0lFUVFOeEd5QUVRWGh4YWlJRUlBUWdBVXNiRUVzZ0FCQUVEd3NnQkF2MEJBRUpmeU1BUVRCcklnUWtBQUpBQW44Z0FnUkFJQVJCS0dvaENRTkFBa0FnQUNnQ0NDMEFBRVVOQUNBQUtBSUFRY2lOd0FCQkJDQUFLQUlFS0FJTUVRRUFSUTBBUVFFTUF3c2dCRUVLTmdJb0lBUkNpb0NBZ0JBM0F5QWdCQ0FDTmdJY1FRQWhCU0FFUVFBMkFoZ2dCQ0FDTmdJVUlBUWdBVFlDRUVFQklRY2dBU0VHSUFJaUF5RUlBbjhDUUFKQUEwQWdCU0FHYWlFR0lBUWdCMnBCSjJvdEFBQWhDZ0pBQWtBQ1FDQURRUWROQkVBZ0EwVU5BU0FJSUFWcklRdEJBQ0VEQTBBZ0F5QUdhaTBBQUNBS1JnMEVJQXNnQTBFQmFpSURSdzBBQ3d3QkN5QUVRUWhxSUFvZ0JpQURFQlFnQkNnQ0NFRUJSZzBCSUFRb0Fod2hDQXNnQkNBSU5nSVlEQVFMSUFRb0Fnd2hBeUFFS0FJa0lRY2dCQ2dDR0NFRkN5QUVJQU1nQldwQkFXb2lCVFlDR0FKQUFrQWdCU0FIU1FSQUlBUW9BaFFoQXd3QkN5QUVLQUlVSWdNZ0JVa05BQ0FIUVFWUERRTWdCU0FIYXlJR0lBUW9BaEJxSWdnZ0NVWU5BU0FJSUFrZ0J4QkVSUTBCQ3lBRUtBSWNJZ2dnQlVrZ0F5QUlTWElOQXlBSUlBVnJJUU1nQkNnQ0VDRUdEQUVMQ3lBQUtBSUlRUUU2QUFBZ0JrRUJhZ3dDQ3lBSFFRUkJzSkxBQUJBM0FBc2dBQ2dDQ0VFQU9nQUFJQUlMSVFNZ0FDZ0NCQ0VHSUFBb0FnQWhCUUpBQWtBZ0EwVWdBaUFEUm5KRkJFQWdBaUFEU3dSQUlBRWdBMm9pQnl3QUFFRy9mMG9OQWdzZ0FTQUNRUUFnQTBITWpjQUFFQU1BQ3lBRklBRWdBeUFHS0FJTUVRRUFSUTBCUVFFTUJBdEJBU0FGSUFFZ0F5QUdLQUlNRVFFQURRTWFJQWNzQUFCQnYzOU1EUVFMSUFFZ0Eyb2hBU0FDSUFOcklnSU5BQXNMUVFBTElBUkJNR29rQUE4TElBRWdBaUFESUFKQjNJM0FBQkFEQUF1NkF3RUVmeU1BUVJCcklnSWtBQ0FBS0FJQUlRUUNRQUpBQWtBQ2Z3SkFBa0FnQVVHQUFVOEVRQ0FDUVFBMkFnd2dBVUdBRUVrTkFTQUNRUXhxSVFBZ0FVR0FnQVJKQkVBZ0FpQUJRVDl4UVlBQmNqb0FEaUFDSUFGQkRIWkI0QUZ5T2dBTUlBSWdBVUVHZGtFL2NVR0FBWEk2QUExQkF5RUJEQVlMSUFJZ0FVRS9jVUdBQVhJNkFBOGdBaUFCUVJKMlFmQUJjam9BRENBQ0lBRkJCblpCUDNGQmdBRnlPZ0FPSUFJZ0FVRU1ka0UvY1VHQUFYSTZBQTFCQkNFQkRBVUxJQVFvQWdnaUFDQUVRUVJxS0FJQVJ3UkFJQVFvQWdBaEJRd0VDd0pBSUFCQkFXb2lBeUFBU1EwQUlBQkJBWFFpQlNBRElBVWdBMHNiSWdOQkNDQURRUWhMR3lFRElBQUVRQ0FEUVFCSURRRWdCQ2dDQUNJRlJRMERJQVVnQUVFQklBTVFWUXdFQ3lBRFFRQk9EUUlMRUYwQUN5QUNJQUZCUDNGQmdBRnlPZ0FOSUFJZ0FVRUdka0hBQVhJNkFBd2dBa0VNYWlFQVFRSWhBUXdEQ3lBRFFRRVFXUXNpQlFSQUlBUWdCVFlDQUNBRVFRUnFJQU0yQWdBZ0JDZ0NDQ0VBREFFTElBTkJBUkJqQUFzZ0FDQUZhaUFCT2dBQUlBUWdCQ2dDQ0VFQmFqWUNDQXdCQ3lBRUlBQWdBQ0FCYWhBZkN5QUNRUkJxSkFCQkFBdTBBd0VFZnlBQVFRQTJBZ2dnQUVFVWFrRUFOZ0lBSUFGQkQzRWhCQ0FBUVF4cUlRSkJBQ0VCQTBBZ0FDZ0NCQ0FCUmdSQUlBQWdBUkE4SUFBb0FnZ2hBUXNnQUNnQ0FDQUJRUUowYWlJQklBTTZBQUlnQVVFQU93RUFJQUFnQUNnQ0NFRUJhallDQ0NBQUtBSVVJZ0VnQUNnQ0VFWUVRQ0FDSUFFUU95QUFLQUlVSVFFTElBQW9BZ3dnQVVFQmRHcEJBVHNCQUNBQUlBQW9BaFJCQVdvMkFoUWdBQ2dDQ0NFQklBTkJBV29pQlNFRElBVkIvLzhEY1NBRWRrVU5BQXNnQUNnQ0JDQUJSZ1JBSUFBZ0FSQThJQUFvQWdnaEFRc2dBQ2dDQUNBQlFRSjBhaUlCUVFBNkFBSWdBVUVBT3dFQUlBQWdBQ2dDQ0VFQmFqWUNDQ0FBS0FJVUlnRWdBQ2dDRUVZRVFDQUNJQUVRT3lBQUtBSVVJUUVMSUFBb0Fnd2dBVUVCZEdwQkFEc0JBQ0FBSUFBb0FoUkJBV28yQWhRZ0FDZ0NDQ0lCSUFBb0FnUkdCRUFnQUNBQkVEd2dBQ2dDQ0NFQkN5QUFLQUlBSUFGQkFuUnFJZ0ZCQURvQUFpQUJRUUE3QVFBZ0FDQUFLQUlJUVFGcU5nSUlJQUFvQWhRaUFTQUFLQUlRUmdSQUlBSWdBUkE3SUFBb0FoUWhBUXNnQUNnQ0RDQUJRUUYwYWtFQU93RUFJQUFnQUNnQ0ZFRUJhallDRkF2K0F3SURmd0YrSUFFb0FoaEJKeUFCUVJ4cUtBSUFLQUlRRVFBQVJRUkFRZlFBSVFOQkFpRUNBa0FDUUFKQUFrQUNRQUpBSUFBb0FnQWlBRUYzYWc0ZkJRRURBd0FEQXdNREF3TURBd01EQXdNREF3TURBd01EQXdRREF3TURCQUlMUWZJQUlRTU1CQXRCN2dBaEF3d0RDeUFBUWR3QVJnMEJDd0ovQW40Q1FDQUFFQTlGQkVBZ0FCQUhSUTBCUVFFTUF3c2dBRUVCY21kQkFuWkJCM090UW9DQWdJRFFBSVFNQVFzZ0FFRUJjbWRCQW5aQkIzT3RRb0NBZ0lEUUFJUUxJUVZCQXdzaEFpQUFJUU1NQVFzZ0FDRURDd05BSUFJaEJFSGNBQ0VBUVFFaEFnSkFBbjRDUUFKQUFrQUNRQ0FFUVFGckRnTUJCUUFDQ3dKQUFrQUNRQUpBSUFWQ0lJaW5RZjhCY1VFQmF3NEZBd0lCQUFZRkMwSDFBQ0VBSUFWQy8vLy8vNDlnZzBLQWdJQ0FNSVFNQmd0Qit3QWhBQ0FGUXYvLy8vK1BZSU5DZ0lDQWdDQ0VEQVVMUVRCQjF3QWdBeUFGcHlJRVFRSjBRUnh4ZGtFUGNTSUFRUXBKR3lBQWFpRUFJQVZDZjN4Qy8vLy8vdytESUFWQ2dJQ0FnSENEaENBRURRUWFJQVZDLy8vLy80OWdnMEtBZ0lDQUVJUU1CQXRCL1FBaEFDQUZRdi8vLy8rUFlJTU1Bd3RCQUNFQ0lBTWhBQXdEQ3lBQktBSVlRU2NnQVNnQ0hDZ0NFQkVBQUE4TElBVkMvLy8vLzQ5Z2cwS0FnSUNBd0FDRUN5RUZRUU1oQWdzZ0FTZ0NHQ0FBSUFFb0Fod29BaEFSQUFCRkRRQUxDMEVCQzZBREFRVi9Ba0FDUUVFQVFROGdBRUdrbWdSSkd5SUJJQUZCQ0dvaUFTQUJRUUowUVppZ3dBQnFLQUlBUVF0MElBQkJDM1FpQWtzYklnRWdBVUVFYWlJQklBRkJBblJCbUtEQUFHb29BZ0JCQzNRZ0Frc2JJZ0VnQVVFQ2FpSUJJQUZCQW5SQm1LREFBR29vQWdCQkMzUWdBa3NiSWdFZ0FVRUJhaUlCSUFGQkFuUkJtS0RBQUdvb0FnQkJDM1FnQWtzYklnTkJBblJCbUtEQUFHb29BZ0JCQzNRaUFTQUNSaUFCSUFKSmFpQURhaUlDUVI1TkJFQkJzUVVoQkNBQ1FSNUhCRUFnQWtFQ2RFR2NvTUFBYWlnQ0FFRVZkaUVFQzBFQUlRRWdBa0YvYWlJRElBSk5CRUFnQTBFZlR3MERJQU5CQW5SQm1LREFBR29vQWdCQi8vLy9BSEVoQVFzQ1FDQUVJQUpCQW5SQm1LREFBR29vQWdCQkZYWWlBMEVCYWtZTkFDQUFJQUZySVFJZ0EwR3hCU0FEUWJFRlN4c2hCU0FFUVg5cUlRRkJBQ0VBQTBBZ0F5QUZSZzBESUFBZ0EwR1VvY0FBYWkwQUFHb2lBQ0FDU3cwQklBRWdBMEVCYWlJRFJ3MEFDeUFCSVFNTElBTkJBWEVQQ3lBQ1FSOUIySi9BQUJBMkFBc2dCVUd4QlVIb244QUFFRFlBQ3lBRFFSOUIrSi9BQUJBMkFBdm9BZ0VGZndKQVFjMy9leUFBUVJBZ0FFRVFTeHNpQUdzZ0FVME5BQ0FBUVJBZ0FVRUxha0Y0Y1NBQlFRdEpHeUlFYWtFTWFoQUFJZ0pGRFFBZ0FrRjRhaUVCQWtBZ0FFRi9haUlESUFKeFJRUkFJQUVoQUF3QkN5QUNRWHhxSWdVb0FnQWlCa0Y0Y1NBQ0lBTnFRUUFnQUd0eFFYaHFJZ0lnQUNBQ2FpQUNJQUZyUVJCTEd5SUFJQUZySWdKcklRTWdCa0VEY1FSQUlBQWdBeUFBS0FJRVFRRnhja0VDY2pZQ0JDQUFJQU5xSWdNZ0F5Z0NCRUVCY2pZQ0JDQUZJQUlnQlNnQ0FFRUJjWEpCQW5JMkFnQWdBQ0FBS0FJRVFRRnlOZ0lFSUFFZ0FoQUdEQUVMSUFFb0FnQWhBU0FBSUFNMkFnUWdBQ0FCSUFKcU5nSUFDd0pBSUFCQkJHb29BZ0FpQVVFRGNVVU5BQ0FCUVhoeElnSWdCRUVRYWswTkFDQUFRUVJxSUFRZ0FVRUJjWEpCQW5JMkFnQWdBQ0FFYWlJQklBSWdCR3NpQkVFRGNqWUNCQ0FBSUFKcUlnSWdBaWdDQkVFQmNqWUNCQ0FCSUFRUUJnc2dBRUVJYWlFREN5QURDNFVEQVFSL0FrQUNRQ0FCUVlBQ1R3UkFJQUJCR0dvb0FnQWhCQUpBQWtBZ0FDQUFLQUlNSWdKR0JFQWdBRUVVUVJBZ0FFRVVhaUlDS0FJQUlnTWJhaWdDQUNJQkRRRkJBQ0VDREFJTElBQW9BZ2dpQVNBQ05nSU1JQUlnQVRZQ0NBd0JDeUFDSUFCQkVHb2dBeHNoQXdOQUlBTWhCU0FCSWdKQkZHb2lBeWdDQUNJQlJRUkFJQUpCRUdvaEF5QUNLQUlRSVFFTElBRU5BQXNnQlVFQU5nSUFDeUFFUlEwQ0lBQWdBRUVjYWlnQ0FFRUNkRUdjcWNBQWFpSUJLQUlBUndSQUlBUkJFRUVVSUFRb0FoQWdBRVliYWlBQ05nSUFJQUpGRFFNTUFnc2dBU0FDTmdJQUlBSU5BVUdRcDhBQVFaQ253QUFvQWdCQmZpQUFLQUljZDNFMkFnQVBDeUFBUVF4cUtBSUFJZ0lnQUVFSWFpZ0NBQ0lBUndSQUlBQWdBallDRENBQ0lBQTJBZ2dQQzBHTXA4QUFRWXlud0FBb0FnQkJmaUFCUVFOMmQzRTJBZ0FNQVFzZ0FpQUVOZ0lZSUFBb0FoQWlBUVJBSUFJZ0FUWUNFQ0FCSUFJMkFoZ0xJQUJCRkdvb0FnQWlBRVVOQUNBQ1FSUnFJQUEyQWdBZ0FDQUNOZ0lZQ3d1akF3SUVmd0orSXdCQlFHb2lBaVFBUVFFaEJBSkFJQUF0QUFRTkFDQUFMUUFGSVFVZ0FDZ0NBQ0lETFFBQVFRUnhSUVJBSUFNb0FoaEI4WTNBQUVIempjQUFJQVViUVFKQkF5QUZHeUFEUVJ4cUtBSUFLQUlNRVFFQURRRWdBQ2dDQUNJREtBSVlRYzZtd0FCQkJ5QURRUnhxS0FJQUtBSU1FUUVBRFFFZ0FDZ0NBQ0lES0FJWVFhZU13QUJCQWlBRFFSeHFLQUlBS0FJTUVRRUFEUUVnQVNBQUtBSUFRWlNnd0FBb0FnQVJBQUFoQkF3QkN5QUZSUVJBSUFNb0FoaEI3STNBQUVFRElBTkJIR29vQWdBb0Fnd1JBUUFOQVNBQUtBSUFJUU1MSUFKQkFUb0FGeUFDUVRScVFiQ053QUEyQWdBZ0FpQURLUUlZTndNSUlBSWdBa0VYYWpZQ0VDQURLUUlJSVFZZ0F5a0NFQ0VISUFJZ0F5MEFJRG9BT0NBQ0lBYzNBeWdnQWlBR053TWdJQUlnQXlrQ0FEY0RHQ0FDSUFKQkNHbzJBakFnQWtFSWFrSE9wc0FBUVFjUUN3MEFJQUpCQ0dwQnA0ekFBRUVDRUFzTkFDQUJJQUpCR0dwQmxLREFBQ2dDQUJFQUFBMEFJQUlvQWpCQjc0M0FBRUVDSUFJb0FqUW9BZ3dSQVFBaEJBc2dBRUVCT2dBRklBQWdCRG9BQkNBQ1FVQnJKQUFMNWdJQ0JuOEJmaU1BUVRCcklnUWtBQ0FFUVJCcUVDb2dCQ0FFS0FJVUlnVTJBaHdnQkNBRUtBSVFJZ1kyQWhnZ0JFRUlhaUFEUVFBUVFDQUVLUU1JSVFvZ0FFRUFOZ0lJSUFBZ0NqY0NBQUpBQWtBZ0F3UkFRUUFoQmtFQUlRVURRQ0FBSUFWQmdDQVFPaUFBSUFNZ0FDZ0NCQ0lISUFjZ0Ewc2JFRThnQmlBQ1N3MENJQUFvQWdBaENDQUFLQUlJSWdjZ0JVa05BeUFFUVNCcUlBUkJHR29pQ1NnQ0FDQUJJQVpxSUFJZ0Jtc2dCU0FJYWlBSElBVnJJQWtvQWdRb0Fnd1JDQUFnQkNnQ0pDQUZhaUVISUFRb0FpQWhDQ0FBS0FJSUlnVWdCMDhFUUNBQUtBSUFHaUFBSUFjMkFnZ2dCeUVGQ3lBRUxRQW9RUUpIQkVBZ0JpQUlhaUVHSUFVZ0Ewa05BUXNMSUFRb0FoZ2hCaUFFS0FJY0lRVUxJQVlnQlNnQ0FCRURBQ0FFS0FJY0lnQW9BZ2dhSUFRb0FoZ2hBU0FBS0FJRUJFQWdBUkFFQ3lBRVFUQnFKQUFQQ3lBR0lBSkJ5SUhBQUJBNUFBc2dCU0FIUWRpQndBQVFPUUFMMkFJQkJYOENRQUpBQWtBQ1FBSkFJQUpCQTJwQmZIRWdBbXNpQkVVTkFDQURJQVFnQkNBRFN4c2lCVVVOQUVFQUlRUWdBVUgvQVhFaEJnSkFBMEFnQWlBRWFpMEFBQ0FHUmcwQklBVWdCRUVCYWlJRVJ3MEFDeUFGSUFOQmVHb2lCRTBOQWd3REMwRUJJUWNNQXdzZ0EwRjRhaUVFUVFBaEJRc2dBVUgvQVhGQmdZS0VDR3doQmdOQUlBSWdCV29pQjBFRWFpZ0NBQ0FHY3lJSVFYOXpJQWhCLy8zN2QycHhJQWNvQWdBZ0JuTWlCMEYvY3lBSFFmLzkrM2RxY1hKQmdJR0NoSGh4UlFSQUlBVkJDR29pQlNBRVRRMEJDd3NnQlNBRFN3MENDMEVBSVFZQ2YwRUFJQU1nQlVZTkFCb2dBaUFGYWlFQ0lBTWdCV3NoQmtFQUlRUWdBVUgvQVhFaEFRSkFBMEFnQWlBRWFpMEFBQ0FCUmcwQklBWWdCRUVCYWlJRVJ3MEFDMEVBREFFTElBUWhCa0VCQ3lFSElBVWdCbW9oQkFzZ0FDQUVOZ0lFSUFBZ0J6WUNBQThMSUFVZ0EwSG9rTUFBRURrQUM3NENBZ1YvQVg0akFFRXdheUlFSkFCQkp5RUNBa0FnQUVLUXpnQlVCRUFnQUNFSERBRUxBMEFnQkVFSmFpQUNhaUlEUVh4cUlBQWdBRUtRemdDQUlnZENrTTRBZm4ybklnVkIvLzhEY1VIa0FHNGlCa0VCZEVHbWpzQUFhaThBQURzQUFDQURRWDVxSUFVZ0JrSGtBR3hyUWYvL0EzRkJBWFJCcG83QUFHb3ZBQUE3QUFBZ0FrRjhhaUVDSUFCQy84SFhMMVlnQnlFQURRQUxDeUFIcHlJRFFlTUFTZ1JBSUFKQmZtb2lBaUFFUVFscWFpQUhweUlESUFOQi8vOERjVUhrQUc0aUEwSGtBR3hyUWYvL0EzRkJBWFJCcG83QUFHb3ZBQUE3QUFBTEFrQWdBMEVLVGdSQUlBSkJmbW9pQWlBRVFRbHFhaUFEUVFGMFFhYU93QUJxTHdBQU93QUFEQUVMSUFKQmYyb2lBaUFFUVFscWFpQURRVEJxT2dBQUN5QUJRZkNMd0FCQkFDQUVRUWxxSUFKcVFTY2dBbXNRQ0NBRVFUQnFKQUFMb3dJQ0JIOEJmaU1BUVVCcUlnUWtBQUpBQWtBQ1FDQUNJQU5xSWdNZ0FrOEVRQ0FCS0FJRUlRVWdCRUVZYWtLQmdJQ0FFRGNEQUNBRUtBSWNJZ0pCZjJvaUJpQUVLQUlZYWtFQUlBSnJJZ2R4clNBRlFRRjBJZ1VnQXlBRklBTkxHeUlEUVFnZ0EwRUlTeHV0ZmlJSVFpQ0lweUFDUlhJTkFTQUNhVUVCUmdSQUlBaW5JQVpxSUFkeElRTU1Bd3NnQkVFd2FoQXdBQXNnQkVFSWFpQURRUUFRV2lBQUlBUXBBd2czQWdSQkFTRUNEQUlMUVFBaEFnc2dCRUV3YWlBQkVFMGdCRUVnYWlBRElBSWdCRUV3YWhBbFFRRWhBaUFFUVNocUtBSUFJUU1nQkNnQ0pDRUZJQVFvQWlCQkFVY0VRQ0FCSUFVZ0F4QmFRUUFoQWd3QkN5QUVRUkJxSUFVZ0F4QmFJQUFnQkNrREVEY0NCQXNnQUNBQ05nSUFJQVJCUUdza0FBdXVBZ0VJZnlNQVFUQnJJZ0VrQUVHQUlDRUNJQUZCR0dvUUx5QUJLQUljSVFRZ0FTZ0NHQ0VGSUFGQkVHb1FNaUFCS0FJVUlRWWdBU2dDRUNFSElBRkJDR3BCZ0NCQkFSQkFJQUZCZ0NBMkFpZ2dBU0FCS0FJTUlnZzJBaVFnQVNBQktBSUlJZ00yQWlBZ0NFR0JJRThFUUNBQlFTQnFRWUFnRUVVZ0FTZ0NJQ0VESUFFb0FpZ2hBZ3NnQUVFQU93QkhJQUJCQURzQk9DQUFJQU0yQWlnZ0FDQUZOZ0lRSUFCQkNEb0FSaUFBUVFBNkFBc2dBRUlBTndNQUlBQkJNR3BDQURjREFDQUFRU3hxSUFJMkFnQWdBRUVrYWtFQU5nSUFJQUJCSUdvZ0JqWUNBQ0FBUVJ4cUlBYzJBZ0FnQUVFWWFrRUFOZ0lBSUFCQkZHb2dCRFlDQUNBQVFRazZBQW9nQUVHQUFqc0JRaUFBUVlFQ093RkVJQUJCZ2dJN0FVQWdBRUgvQXpzQkNDQUJRVEJxSkFBTHh3SUNCWDhCZmlNQVFSQnJJZ01rQUNBQUxRQUxJUUlnQTBJQU53TUlJQUVvQWdBaEJRSkFBa0FnQUFKL0lBRW9BZ1FpQkVIQUFDQUNheUlHUWZnQmNVRURkaUlDU1FSQUlBUkJDVThOQWlBRFFRaHFJQVVnQkJCTEdpQUJRUUEyQWdRZ0FVR0lnOEFBTmdJQUlBUkJBM1FNQVFzZ0JrSC9BWEZCeUFCUERRSWdBMEVJYWlBRklBSVFTeG9nQVNBRUlBSnJOZ0lFSUFFZ0FpQUZhallDQUNBR1FmZ0JjUXNnQUMwQUN5SUJham9BQ3lBQUlBQXBBd0FnQXlrRENDSUhRamlHSUFkQ0tJWkNnSUNBZ0lDQXdQOEFnNFFnQjBJWWhrS0FnSUNBZ09BL2d5QUhRZ2lHUW9DQWdJRHdINE9FaENBSFFnaUlRb0NBZ1BnUGd5QUhRaGlJUW9DQS9BZURoQ0FIUWlpSVFvRCtBNE1nQjBJNGlJU0VoQ0FCUVQ5eHJZaUVOd01BSUFOQkVHb2tBQThMSUFSQkNFSFloY0FBRURjQUN5QUNRUWhCeUlYQUFCQTNBQXVxQWdFRGZ5TUFRWUFCYXlJRUpBQUNRQUpBQW44Q1FDQUJLQUlBSWdOQkVIRkZCRUFnQUNnQ0FDRUNJQU5CSUhFTkFTQUNyU0FCRUJVTUFnc2dBQ2dDQUNFQ1FRQWhBQU5BSUFBZ0JHcEIvd0JxSUFKQkQzRWlBMEV3Y2lBRFFkY0FhaUFEUVFwSkd6b0FBQ0FBUVg5cUlRQWdBa0VFZGlJQ0RRQUxJQUJCZ0FGcUlnSkJnUUZQRFFJZ0FVR2tqc0FBUVFJZ0FDQUVha0dBQVdwQkFDQUFheEFJREFFTFFRQWhBQU5BSUFBZ0JHcEIvd0JxSUFKQkQzRWlBMEV3Y2lBRFFUZHFJQU5CQ2trYk9nQUFJQUJCZjJvaEFDQUNRUVIySWdJTkFBc2dBRUdBQVdvaUFrR0JBVThOQWlBQlFhU093QUJCQWlBQUlBUnFRWUFCYWtFQUlBQnJFQWdMSUFSQmdBRnFKQUFQQ3lBQ1FZQUJRWlNPd0FBUU9RQUxJQUpCZ0FGQmxJN0FBQkE1QUF1eEFnRUVmeU1BUVVCcUlnSWtBQ0FCS0FJRUlnTkZCRUFnQVVFRWFpRURJQUVvQWdBaEJDQUNRUUEyQWlBZ0FrSUJOd01ZSUFJZ0FrRVlhallDSkNBQ1FUaHFJQVJCRUdvcEFnQTNBd0FnQWtFd2FpQUVRUWhxS1FJQU53TUFJQUlnQkNrQ0FEY0RLQ0FDUVNScVFkaUp3QUFnQWtFb2FoQUpHaUFDUVJCcUlnUWdBaWdDSURZQ0FDQUNJQUlwQXhnM0F3Z0NRQ0FCS0FJRUlnVkZEUUFnQVVFSWFpZ0NBRVVOQUNBRkVBUUxJQU1nQWlrRENEY0NBQ0FEUVFocUlBUW9BZ0EyQWdBZ0F5Z0NBQ0VEQ3lBQlFRRTJBZ1FnQVVFTWFpZ0NBQ0VFSUFGQkNHb2lBU2dDQUNFRklBRkNBRGNDQUVFTVFRUVFXU0lCUlFSQVFReEJCQkJqQUFzZ0FTQUVOZ0lJSUFFZ0JUWUNCQ0FCSUFNMkFnQWdBRUdRaThBQU5nSUVJQUFnQVRZQ0FDQUNRVUJySkFBTC9BRUJBbjhqQUVFUWF5SUNKQUFnQUNnQ0FDQUNRUUEyQWd3Q2Z3SkFBa0FnQVVHQUFVOEVRQ0FCUVlBUVNRMEJJQUpCREdvaEFDQUJRWUNBQkU4TkFpQUNJQUZCUDNGQmdBRnlPZ0FPSUFJZ0FVRU1ka0hnQVhJNkFBd2dBaUFCUVFaMlFUOXhRWUFCY2pvQURVRUREQU1MSUFJZ0FUb0FEQ0FDUVF4cUlRQkJBUXdDQ3lBQ0lBRkJQM0ZCZ0FGeU9nQU5JQUlnQVVFR2RrSEFBWEk2QUF3Z0FrRU1haUVBUVFJTUFRc2dBaUFCUVQ5eFFZQUJjam9BRHlBQ0lBRkJFblpCOEFGeU9nQU1JQUlnQVVFR2RrRS9jVUdBQVhJNkFBNGdBaUFCUVF4MlFUOXhRWUFCY2pvQURVRUVDeUVCSUFBZ0FSQUxJQUpCRUdva0FBdjVBUUVDZnlNQVFSQnJJZ0lrQUNBQ1FRQTJBZ3dDZndKQUFrQWdBVUdBQVU4RVFDQUJRWUFRU1EwQklBSkJER29oQXlBQlFZQ0FCRThOQWlBQ0lBRkJQM0ZCZ0FGeU9nQU9JQUlnQVVFTWRrSGdBWEk2QUF3Z0FpQUJRUVoyUVQ5eFFZQUJjam9BRFVFRERBTUxJQUlnQVRvQURDQUNRUXhxSVFOQkFRd0NDeUFDSUFGQlAzRkJnQUZ5T2dBTklBSWdBVUVHZGtIQUFYSTZBQXdnQWtFTWFpRURRUUlNQVFzZ0FpQUJRVDl4UVlBQmNqb0FEeUFDSUFGQkVuWkI4QUZ5T2dBTUlBSWdBVUVHZGtFL2NVR0FBWEk2QUE0Z0FpQUJRUXgyUVQ5eFFZQUJjam9BRFVFRUN5RUJJQUFnQXlBQkVBc2dBa0VRYWlRQUMvd0JBUU4vSXdCQklHc2lCQ1FBQWtBZ0FrRUJhaUlESUFKUEJFQWdBU2dDQkNJQ1FRRjBJZ1VnQXlBRklBTkxHeUlEUVFRZ0EwRUVTeHNpQTBILy8vLy9BM0VnQTBaQkFYUWhCU0FEUVFKMElRTUNRQ0FDQkVBZ0JFRVlha0VDTmdJQUlBUWdBa0VDZERZQ0ZDQUVJQUVvQWdBMkFoQU1BUXNnQkVFQU5nSVFDeUFFSUFNZ0JTQUVRUkJxRUNWQkFTRUNJQVJCQ0dvb0FnQWhBeUFFS0FJRUlRVWdCQ2dDQUVFQlJ3UkFJQUVnQlRZQ0FDQUJJQU5CQW5ZMkFnUkJBQ0VDREFJTElBQWdCVFlDQkNBQVFRaHFJQU0yQWdBTUFRc2dBQ0FETmdJRUlBQkJDR3BCQURZQ0FFRUJJUUlMSUFBZ0FqWUNBQ0FFUVNCcUpBQUw4QUVCQkg4akFFRWdheUlFSkFBQ1FDQUNRUUZxSWdNZ0FrOEVRQ0FCS0FJRUlnVkJBWFFpQWlBRElBSWdBMHNiSWdOQkJDQURRUVJMR3lJRElBTnFJZ1lnQTA5QkFYUWhBd0pBSUFVRVFDQUVRUmhxUVFJMkFnQWdCQ0FDTmdJVUlBUWdBU2dDQURZQ0VBd0JDeUFFUVFBMkFoQUxJQVFnQmlBRElBUkJFR29RSlVFQklRSWdCRUVJYWlnQ0FDRURJQVFvQWdRaEJTQUVLQUlBUVFGSEJFQWdBU0FGTmdJQUlBRWdBMEVCZGpZQ0JFRUFJUUlNQWdzZ0FDQUZOZ0lFSUFCQkNHb2dBellDQUF3QkN5QUFJQU0yQWdRZ0FFRUlha0VBTmdJQVFRRWhBZ3NnQUNBQ05nSUFJQVJCSUdva0FBdlpBUUVEZndKQUlBQkJCR29vQWdBaUJDQUFRUWhxS0FJQUlnTnJJQUlnQVdzaUJVOEVRQ0FBS0FJQUlRUU1BUXNDZndKQUFrQWdBeUFGYWlJQ0lBTkpEUUFnQkVFQmRDSURJQUlnQXlBQ1N4c2lBa0VJSUFKQkNFc2JJUUlnQkFSQUlBSkJBRWdOQVNBQUtBSUFJZ05GRFFJZ0F5QUVRUUVnQWhCVkRBTUxJQUpCQUU0TkFRc1FYUUFMSUFKQkFSQlpDeUlFQkVBZ0FDQUVOZ0lBSUFCQkJHb2dBallDQUNBQVFRaHFLQUlBSVFNTUFRc2dBa0VCRUdNQUN5QURJQVJxSUFFZ0JSQkxHaUFBUVFocUlnQWdBQ2dDQUNBRmFqWUNBQXZvQVFFRmZ5TUFRUkJySWdNa0FDQUFMUUFMSVFJZ0EwSUFOd01JSUFFb0FnQWhCUUpBQWtBZ0FBSi9JQUVvQWdRaUJFSEFBQ0FDYXlJR1FmZ0JjVUVEZGlJQ1NRUkFJQVJCQ1U4TkFpQURRUWhxSUFVZ0JCQkxHaUFCUVFBMkFnUWdBVUdJZzhBQU5nSUFJQVJCQTNRTUFRc2dCa0gvQVhGQnlBQlBEUUlnQTBFSWFpQUZJQUlRU3hvZ0FTQUVJQUpyTmdJRUlBRWdBaUFGYWpZQ0FDQUdRZmdCY1FzZ0FDMEFDeUlCYWpvQUN5QUFJQUFwQXdBZ0F5a0RDQ0FCUVQ5eHJZYUVOd01BSUFOQkVHb2tBQThMSUFSQkNFSDRoY0FBRURjQUN5QUNRUWhCNklYQUFCQTNBQXZjQVFFRWZ5TUFRVUJxSWdJa0FDQUJRUVJxSVFRZ0FTZ0NCRVVFUUNBQktBSUFJUU1nQWtFQU5nSWdJQUpDQVRjREdDQUNJQUpCR0dvMkFpUWdBa0U0YWlBRFFSQnFLUUlBTndNQUlBSkJNR29nQTBFSWFpa0NBRGNEQUNBQ0lBTXBBZ0EzQXlnZ0FrRWtha0hZaWNBQUlBSkJLR29RQ1JvZ0FrRVFhaUlESUFJb0FpQTJBZ0FnQWlBQ0tRTVlOd01JQWtBZ0FTZ0NCQ0lGUlEwQUlBRkJDR29vQWdCRkRRQWdCUkFFQ3lBRUlBSXBBd2czQWdBZ0JFRUlhaUFES0FJQU5nSUFDeUFBUVpDTHdBQTJBZ1FnQUNBRU5nSUFJQUpCUUdza0FBdVlBZ0VDZnlNQVFTQnJJZ1FrQUVFQklRVkJpS2ZBQUVHSXA4QUFLQUlBUVFGcU5nSUFBa0FDUUFKQVFkQ3F3QUFvQWdCQkFVY0VRRUhRcXNBQVFvR0FnSUFRTndNQURBRUxRZFNxd0FCQjFLckFBQ2dDQUVFQmFpSUZOZ0lBSUFWQkFrc05BUXNnQkNBRE5nSWNJQVFnQWpZQ0dDQUVRZkNKd0FBMkFoUWdCRUh3aWNBQU5nSVFRZnltd0FBb0FnQWlBa0YvVEEwQVFmeW13QUFnQWtFQmFpSUNOZ0lBUWZ5bXdBQkJoS2ZBQUNnQ0FDSURCSDlCZ0tmQUFDZ0NBQ0FFUVFocUlBQWdBU2dDRUJFQ0FDQUVJQVFwQXdnM0F4QWdCRUVRYWlBREtBSU1FUUlBUWZ5bXdBQW9BZ0FGSUFJTFFYOXFOZ0lBSUFWQkFVME5BUXNBQ3lNQVFSQnJJZ0lrQUNBQ0lBRTJBZ3dnQWlBQU5nSUlBQXZNQVFFQ2Z5QUJRUlJxS0FJQUlnVWdBMEgvL3dOeElnUkxCRUFnQVNnQ0RDQUVRUUYwYWk4QkFDRUZJQUVvQWdnaUJDQUJLQUlFUmdSQUlBRWdCQkE4SUFFb0FnZ2hCQXNnQVNnQ0FDQUVRUUowYWlJRUlBSTZBQUlnQkNBRE93RUFJQUVnQVNnQ0NFRUJhallDQ0NBQktBSVVJZ1FnQVVFUWFpZ0NBRVlFUUNBQlFReHFJQVFRT3lBQktBSVVJUVFMSUFFb0Fnd2dCRUVCZEdvZ0JVRUJhanNCQUNBQklBRW9BaFJCQVdvMkFoUWdBQ0FDT2dBQ0lBQWdBenNCQUE4TElBUWdCVUg0aHNBQUVEWUFDOFFCQVFKL0l3QkJFR3NpQWlRQUlBSWdBYTFDZ0lDQWdCQkNBQ0FCS0FJWVFjV213QUJCQ1NBQlFSeHFLQUlBS0FJTUVRRUFHNFEzQXdBZ0FpQUFOZ0lNSUFJZ0FrRU1haEFTSUFJdEFBUWhBU0FDTFFBRkJFQWdBVUgvQVhFaEFDQUNBbjlCQVNBQURRQWFJQUlvQWdBaUFFRWNhaWdDQUNnQ0RDRUJJQUFvQWhnaEF5QUFMUUFBUVFSeFJRUkFJQU5COTQzQUFFRUNJQUVSQVFBTUFRc2dBMEgyamNBQVFRRWdBUkVCQUFzaUFUb0FCQXNnQWtFUWFpUUFJQUZCL3dGeFFRQkhDNm9CQVFKL0FrQUNRQUpBSUFJRVFFRUJJUVFnQVVFQVRnMEJEQUlMSUFBZ0FUWUNCRUVCSVFRTUFRc0NRQUpBQWtBQ1FBSkFJQU1vQWdBaUJVVUVRQ0FCUlEwQkRBTUxJQU1vQWdRaUF3MEJJQUVOQWdzZ0FpRUREQU1MSUFVZ0F5QUNJQUVRVlNJRFJRMEJEQUlMSUFFZ0FoQlpJZ01OQVFzZ0FDQUJOZ0lFSUFJaEFRd0NDeUFBSUFNMkFnUkJBQ0VFREFFTFFRQWhBUXNnQUNBRU5nSUFJQUJCQ0dvZ0FUWUNBQXVmQVFFRGZ5QUFRZ0EzQWdnQ1FDQUJRUlJxS0FJQUlnUWdBa0gvL3dOeElnTkxCRUFnQVNnQ0RDQURRUUYwYWk4QkFDRURJQUFvQWdRaEJDQUFRUUEyQWdRZ0FDZ0NBQ0VGSUFCQkFUWUNBQ0FFSUFOSkRRRWdBU0FDSUFVZ0F4QXBJQUFvQWdRRVFDQUFLQUlBRUFRTElBQWdBellDRENBQUlBUTJBZ1FnQUNBRk5nSUFEd3NnQXlBRVFiaUd3QUFRTmdBTElBTWdCRUhJaHNBQUVEY0FDNGNCQVFKL0l3QkJNR3NpQkNRQUlBUkJJR29pQlNBQ05nSUlJQVVnQWpZQ0JDQUZJQUUyQWdBZ0JFRUlhaUFFUVNCcUVFNGdCRUVRYWlBRUtBSUlJZ0VnQkNnQ0RDSUNJQU1RRXlBQ0JFQWdBUkFFQ3lBRVFTaHFJQVJCR0dvb0FnQTJBZ0FnQkNBRUtRTVFOd01nSUFRZ0JFRWdhaEJPSUFBZ0JDa0RBRGNEQUNBRVFUQnFKQUFMZ2dFQkJuOGpBRUVRYXlJREpBQWdBQ0FBS0FJSUlBRVFPaUFBS0FJQUlRVWdBQ2dDQ0NFQ0lBTkJDR3BCQVNBQkVGb2dBaUFGYWlFRUlBTW9BZ3dpQmlBREtBSUlJZ2RMQkVBZ0JDQUdJQWRyRUZJZ0JTQUNJQVpxSUFkcklnSnFJUVFMSUFBZ0FRUi9JQVJCQURvQUFDQUNRUUZxQlNBQ0N6WUNDQ0FEUVJCcUpBQUxqZ0VCQTM4Z0FDZ0NDQ0lFSUFGQi8vOERjU0lGU3dSQUlBTUVRQ0FBS0FJQUlRUWdBa0YvYWlFRklBRWhBQU5BSUFRZ0FFSC8vd054UVFKMGFpSUdMd0VBSVFBZ0F5QUZhaUFHTFFBQ09nQUFJQUFnQVNBQUlBRkIvLzhEY1VrYklRQWdBMEYvYWlJRERRQUxJQUl0QUFBUEMwRUFRUUJCbUlmQUFCQTJBQXNnQlVFQmFpQUVRWWlId0FBUU53QUxhQUVDZnlNQVFkQUFheUlDSkFBakFFRXdheUlCSkFBZ0FVRUlPZ0FQSUFGQk1Hb2tBQ0FDRUJkQjBBQkJDQkJaSWdFRVFDQUJJQUpCMEFBUVN4b2dBVUVCT2dCSUlBQkJwSVBBQURZQ0JDQUFJQUUyQWdBZ0FrSFFBR29rQUE4TFFkQUFRUWdRWXdBTGdBRUNBbjhCZmlBQkxRQUxJZ1FnQVMwQUNpSURTUVJBSUFFZ0FoQVlJQUV0QUFzaEJDQUJMUUFLSVFNTElBUWdBMEgvQVhGSkJIOUJBQVVnQVNBRUlBTnJPZ0FMSUFFZ0FTa0RBQ0FEcllraUJTQUJMd0VJSWdHdFFuK0ZRb0NBZklTRE53TUFJQUVnQmFkeElRTkJBUXNoQVNBQUlBTTdBUUlnQUNBQk93RUFDNklCQVFOL0l3QkJFR3NpQVNRQUlBQW9BZ0FpQWtFVWFpZ0NBQ0VEQWtBQ2Z3SkFBa0FnQWlnQ0JBNENBQUVEQ3lBRERRSkJBQ0VDUWZDSndBQU1BUXNnQXcwQklBSW9BZ0FpQXlnQ0JDRUNJQU1vQWdBTElRTWdBU0FDTmdJRUlBRWdBellDQUNBQlFmeUt3QUFnQUNnQ0JDZ0NDQ0FBS0FJSUVDSUFDeUFCUVFBMkFnUWdBU0FDTmdJQUlBRkI2SXJBQUNBQUtBSUVLQUlJSUFBb0FnZ1FJZ0FMZ1FFQkEzOGdBU2dDQkNJRElBSlBCRUFDUUNBRFJRMEFJQUVvQWdBaEJBSkFBa0FnQWtVRVFFRUJJUU1nQkJBRURBRUxJQVFnQTBFQklBSVFWU0lEUlEwQkN5QUJJQUkyQWdRZ0FTQUROZ0lBREFFTElBQWdBallDQkNBQVFRaHFRUUUyQWdCQkFTRUZDeUFBSUFVMkFnQVBDMEdVaU1BQVFTUkJ1SWpBQUJCSUFBdDFBZ0ovQVg0Z0FTMEFDeUlFSUFFdEFBb2lBMGtFUUNBQklBSVFJQ0FCTFFBTElRUWdBUzBBQ2lFREN5QUVJQU5CL3dGeFNRUi9RUUFGSUFFZ0JDQURhem9BQ3lBQklBRXBBd0FpQlNBRHJVSS9nNGczQXdBZ0FTOEJDQ0FGcDNFaEEwRUJDeUVCSUFBZ0F6c0JBaUFBSUFFN0FRQUxNQUVCZndKQUFrQkJnSUFCUVFJUVdTSUJEUUVNQUF0QmdJQUJRUUlRWXdBTElBQWdBVFlDQUNBQVFZQWdOZ0lFQzRZQkFRRi9Jd0JCUUdvaUFTUUFJQUZCS3pZQ0RDQUJRWUNCd0FBMkFnZ2dBVUdzZ2NBQU5nSVVJQUVnQURZQ0VDQUJRU3hxUVFJMkFnQWdBVUU4YWtFaE5nSUFJQUZDQWpjQ0hDQUJRYXlNd0FBMkFoZ2dBVUVkTmdJMElBRWdBVUV3YWpZQ0tDQUJJQUZCRUdvMkFqZ2dBU0FCUVFocU5nSXdJQUZCR0dwQjhJREFBQkJSQUF0eEFRTi9Jd0JCSUdzaUFpUUFBa0FnQUNBQkVCa05BQ0FCUVJ4cUtBSUFJUU1nQVNnQ0dDQUNRUnhxUVFBMkFnQWdBa0h3aThBQU5nSVlJQUpDQVRjQ0RDQUNRZlNMd0FBMkFnZ2dBeUFDUVFocUVBa05BQ0FBUVFScUlBRVFHU0FDUVNCcUpBQVBDeUFDUVNCcUpBQkJBUXN3QVFGL0FrQUNRRUdBd0FCQkFoQlpJZ0VOQVF3QUMwR0F3QUJCQWhCakFBc2dBQ0FCTmdJQUlBQkJnQ0EyQWdRTGV3RUNmd0pBQWtBZ0FDZ0NCQ0lCQkVBZ0FDZ0NEQ0lDSUFGUERRRWdBQ2dDQUNJQklBSnFJQUV0QUFBNkFBQWdBRUVBTmdJSUlBQWdBQ2dDREVFQmFqWUNEQ0FBS0FJRVJRMENJQUFvQWdBdEFBQVBDMEVBUVFCQmlJYkFBQkEyQUFzZ0FpQUJRWmlHd0FBUU5nQUxRUUJCQUVHb2hzQUFFRFlBQzJnQkFuOGdBQ0FBTFFCR0lnRkJBV29pQWpvQUNpQUFRUUVnQVVFUGNYUkJBbW9pQVRzQlFDQUFRWDhnQWtFUGNYUkJmM003QVFnZ0FFRVlhaWdDQUNBQlFmLy9BM0VpQVU4RVFDQUFJQUUyQWhnTElBQkJKR29vQWdBZ0FVOEVRQ0FBSUFFMkFpUUxDMUFCQVg4Z0FFRVVhaWdDQUNJQlJTQUJRUUowUlhKRkJFQWdBQ2dDRUJBRUN5QUFRU0JxS0FJQUlnRkZJQUZCQVhSRmNrVUVRQ0FBS0FJY0VBUUxJQUJCTEdvb0FnQUVRQ0FBS0FJb0VBUUxDMndCQVg4akFFRXdheUlESkFBZ0F5QUJOZ0lFSUFNZ0FEWUNBQ0FEUVJ4cVFRSTJBZ0FnQTBFc2FrRWNOZ0lBSUFOQ0FqY0NEQ0FEUVlDTndBQTJBZ2dnQTBFY05nSWtJQU1nQTBFZ2FqWUNHQ0FESUFNMkFpZ2dBeUFEUVFScU5nSWdJQU5CQ0dvZ0FoQlJBQXRzQVFGL0l3QkJNR3NpQXlRQUlBTWdBVFlDQkNBRElBQTJBZ0FnQTBFY2FrRUNOZ0lBSUFOQkxHcEJIRFlDQUNBRFFnSTNBZ3dnQTBITWtjQUFOZ0lJSUFOQkhEWUNKQ0FESUFOQklHbzJBaGdnQXlBRFFRUnFOZ0lvSUFNZ0F6WUNJQ0FEUVFocUlBSVFVUUFMYkFFQmZ5TUFRVEJySWdNa0FDQURJQUUyQWdRZ0F5QUFOZ0lBSUFOQkhHcEJBallDQUNBRFFTeHFRUncyQWdBZ0EwSUNOd0lNSUFOQmdKTEFBRFlDQ0NBRFFSdzJBaVFnQXlBRFFTQnFOZ0lZSUFNZ0EwRUVhallDS0NBRElBTTJBaUFnQTBFSWFpQUNFRkVBQzJ3QkFYOGpBRUV3YXlJREpBQWdBeUFCTmdJRUlBTWdBRFlDQUNBRFFSeHFRUUkyQWdBZ0EwRXNha0VjTmdJQUlBTkNBamNDRENBRFFheVJ3QUEyQWdnZ0EwRWNOZ0lrSUFNZ0EwRWdhallDR0NBRElBTkJCR28yQWlnZ0F5QUROZ0lnSUFOQkNHb2dBaEJSQUF0Y0FRRi9Jd0JCRUdzaUF5UUFBa0FnQUNnQ0JDQUJheUFDVHdSQUlBTkJBRFlDQUF3QkN5QURJQUFnQVNBQ0VCWWdBeWdDQUVFQlJ3MEFJQU5CQ0dvb0FnQWlBQVJBSUFNb0FnUWdBQkJqQUFzUVhRQUxJQU5CRUdva0FBdGFBUUYvSXdCQkVHc2lBaVFBQWtBZ0FDZ0NCQ0FCYTBFQlR3UkFJQUpCQURZQ0FBd0JDeUFDSUFBZ0FSQWVJQUlvQWdCQkFVY05BQ0FDUVFocUtBSUFJZ0FFUUNBQ0tBSUVJQUFRWXdBTEVGMEFDeUFDUVJCcUpBQUxXZ0VCZnlNQVFSQnJJZ0lrQUFKQUlBQW9BZ1FnQVd0QkFVOEVRQ0FDUVFBMkFnQU1BUXNnQWlBQUlBRVFIU0FDS0FJQVFRRkhEUUFnQWtFSWFpZ0NBQ0lBQkVBZ0FpZ0NCQ0FBRUdNQUN4QmRBQXNnQWtFUWFpUUFDMWtCQVg4akFFRWdheUlDSkFBZ0FpQUFLQUlBTmdJRUlBSkJHR29nQVVFUWFpa0NBRGNEQUNBQ1FSQnFJQUZCQ0dvcEFnQTNBd0FnQWlBQktRSUFOd01JSUFKQkJHcEIySW5BQUNBQ1FRaHFFQWtnQWtFZ2FpUUFDMFlBQWtCQkNDQUNTUVJBQW45QkNDQUNTUVJBSUFJZ0F4QVFEQUVMSUFNUUFBc2lBZzBCUVFBUEN5QUFJQU1RQ2c4TElBSWdBQ0FESUFFZ0FTQURTeHNRU3lBQUVBUUxXUUVCZnlNQVFTQnJJZ0lrQUNBQ0lBQW9BZ0EyQWdRZ0FrRVlhaUFCUVJCcUtRSUFOd01BSUFKQkVHb2dBVUVJYWlrQ0FEY0RBQ0FDSUFFcEFnQTNBd2dnQWtFRWFrSHdqOEFBSUFKQkNHb1FDU0FDUVNCcUpBQUxXUUFDUUFKQUFrQWdBVUYvU2dSQUFrQWdBZ1JBSUFFTkFRd0VDeUFCUlEwRElBRkJBUkJaSWdJTkJBd0NDeUFCRUVjaUFrVU5BUXdEQ3hCZEFBc2dBVUVCRUdNQUMwRUJJUUlMSUFBZ0FUWUNCQ0FBSUFJMkFnQUxWZ0VCZnlNQVFTQnJJZ0lrQUNBQ0lBQTJBZ1FnQWtFWWFpQUJRUkJxS1FJQU53TUFJQUpCRUdvZ0FVRUlhaWtDQURjREFDQUNJQUVwQWdBM0F3Z2dBa0VFYWtId2o4QUFJQUpCQ0dvUUNTQUNRU0JxSkFBTFdRRURmd0pBSUFFb0Fnd2lBaUFCS0FJSUlnTlBCRUFnQVNnQ0JDSUVJQUpKRFFFZ0FTZ0NBQ0VCSUFBZ0FpQURhellDQkNBQUlBRWdBMm8yQWdBUEN5QURJQUpCMkliQUFCQTRBQXNnQWlBRVFkaUd3QUFRTndBTFZRRUJmeUFBUVJCcUlBQXRBRVlRRFNBQVFRQTZBRWNnQUVFQU93RTRJQUJCTUdwQ0FEY0RBQ0FBUVFBNkFBc2dBRUlBTndNQUlBQWdBQzBBUmtFQmFpSUJPZ0FLSUFCQmZ5QUJRUTl4ZEVGL2N6c0JDQXREQVFOL0FrQWdBa1VOQUFOQUlBQXRBQUFpQkNBQkxRQUFJZ1ZHQkVBZ0FFRUJhaUVBSUFGQkFXb2hBU0FDUVg5cUlnSU5BUXdDQ3dzZ0JDQUZheUVEQ3lBREMwVUJBWDhqQUVFUWF5SUNKQUFnQWlBQUlBRVFMUUpBSUFJb0FnQkJBVVlFUUNBQ1FRaHFLQUlBSWdCRkRRRWdBaWdDQkNBQUVHTUFDeUFDUVJCcUpBQVBDeEJkQUF0S0FBSi9JQUZCZ0lERUFFY0VRRUVCSUFBb0FoZ2dBU0FBUVJ4cUtBSUFLQUlRRVFBQURRRWFDeUFDUlFSQVFRQVBDeUFBS0FJWUlBSWdBeUFBUVJ4cUtBSUFLQUlNRVFFQUN3c21BUUYvQWtBZ0FCQUFJZ0ZGRFFBZ0FVRjhhaTBBQUVFRGNVVU5BQ0FCSUFBUVVnc2dBUXRIQVFGL0l3QkJJR3NpQXlRQUlBTkJGR3BCQURZQ0FDQURRZkNMd0FBMkFoQWdBMElCTndJRUlBTWdBVFlDSENBRElBQTJBaGdnQXlBRFFSaHFOZ0lBSUFNZ0FoQlJBQXRFQVFKL0lBRW9BZ1FoQWlBQktBSUFJUU5CQ0VFRUVGa2lBVVVFUUVFSVFRUVFZd0FMSUFFZ0FqWUNCQ0FCSUFNMkFnQWdBRUdnaThBQU5nSUVJQUFnQVRZQ0FBdGJBUU4vSXdCQkVHc2lBU1FBSUFBb0Fnd2lBa1VFUUVHQWlzQUFRU3RCeUlyQUFCQklBQXNnQUNnQ0NDSURSUVJBUVlDS3dBQkJLMEhZaXNBQUVFZ0FDeUFCSUFJMkFnZ2dBU0FBTmdJRUlBRWdBellDQUNBQkVGQUFDek1CQVg4Z0FnUkFJQUFoQXdOQUlBTWdBUzBBQURvQUFDQUJRUUZxSVFFZ0EwRUJhaUVESUFKQmYyb2lBZzBBQ3dzZ0FBc3NBQUpBSUFCQmZFMEVRQ0FBUlFSQVFRUWhBQXdDQ3lBQUlBQkJmVWxCQW5RUVdTSUFEUUVMQUFzZ0FBc3hBUUYvSUFFb0FnUWlBZ1JBSUFBZ0FqWUNCQ0FBUVFocVFRRTJBZ0FnQUNBQktBSUFOZ0lBRHdzZ0FFRUFOZ0lBQ3pFQkFYOGdBQ0FCS0FJRUlBRW9BZ2dpQWtzRWZ5QUJJQUlRUlNBQktBSUlCU0FDQ3pZQ0JDQUFJQUVvQWdBMkFnQUxLQUVCZnlBQUtBSUlJZ0lnQVU4RVFDQUFLQUlBR2lBQUlBRTJBZ2dQQ3lBQUlBRWdBbXNRS0Fzc0FRRi9Jd0JCRUdzaUFTUUFJQUZCQ0dvZ0FFRUlhaWdDQURZQ0FDQUJJQUFwQWdBM0F3QWdBUkFzQUFzMEFRRi9Jd0JCRUdzaUFpUUFJQUlnQVRZQ0RDQUNJQUEyQWdnZ0FrRzhqTUFBTmdJRUlBSkI4SXZBQURZQ0FDQUNFRW9BQ3lFQUlBRUVRQU5BSUFCQkFEb0FBQ0FBUVFGcUlRQWdBVUYvYWlJQkRRQUxDd3NnQVFGL0FrQWdBQ2dDQUNJQlJRMEFJQUJCQkdvb0FnQkZEUUFnQVJBRUN3c2dBUUYvQWtBZ0FDZ0NCQ0lCUlEwQUlBQkJDR29vQWdCRkRRQWdBUkFFQ3dzTUFDQUFJQUVnQWlBREVENExDd0FnQVFSQUlBQVFCQXNMRWdBZ0FDZ0NBQ0FCSUFFZ0Ftb1FIMEVBQ3hRQUlBQW9BZ0FnQVNBQUtBSUVLQUlNRVFBQUN4a0FBbjlCQ0NBQlNRUkFJQUVnQUJBUURBRUxJQUFRQUFzTEVBQWdBQ0FDTmdJRUlBQWdBVFlDQUFzVEFDQUFRYUNMd0FBMkFnUWdBQ0FCTmdJQUN4QUFJQUVnQUNnQ0FDQUFLQUlFRUFVTEVRQkJ6SXZBQUVFUlFlQ0x3QUFRU0FBTERnQWdBQ2dDQUJvRFFBd0FDd0FMQ3dBZ0FEVUNBQ0FCRUJVTERRQWdBQ2dDQUNBQklBSVFDd3NMQUNBQU1RQUFJQUVRRlFzTEFDQUFJd0JxSkFBakFBc1pBQ0FBSUFGQitLYkFBQ2dDQUNJQVFRNGdBQnNSQWdBQUN3MEFJQUZCeEpEQUFFRUNFQVVMQ1FBZ0FFRUFPZ0JIQ3djQUlBQXRBRWNMRFFCQzlQbWU1dTZqcXZuK0FBc05BRUwzdU83NnFzelY3dVVBQ3d3QVF1blFvdHZNb3VxN1Jnc0RBQUVMQXdBQkN3dmZKZ0VBUVlDQXdBQUwxU1l2VlhObGNuTXZabTA0TVRNdkxuSjFjM1IxY0M5MGIyOXNZMmhoYVc1ekwzTjBZV0pzWlMxNE9EWmZOalF0WVhCd2JHVXRaR0Z5ZDJsdUwyeHBZaTl5ZFhOMGJHbGlMM055WXk5eWRYTjBMMnhwWW5KaGNua3ZZMjl5WlM5emNtTXZZV3hzYjJNdmJHRjViM1YwTG5KekFBQVFBSEFBQUFBTEFRQUFPUUFBQUdOaGJHeGxaQ0JnVW1WemRXeDBPanAxYm5keVlYQW9LV0FnYjI0Z1lXNGdZRVZ5Y21BZ2RtRnNkV1VBQVFBQUFBQUFBQUFCQUFBQUFnQUFBSE55WXk5c2FXSXVjbk1BQUx3QUVBQUtBQUFBR3dBQUFBNEFBQUM4QUJBQUNnQUFBQndBQUFBU0FBQUFZWE56WlhKMGFXOXVJR1poYVd4bFpEb2diV2xrSUR3OUlITmxiR1l1YkdWdUtDa3ZWWE5sY25NdlptMDRNVE12TG5KMWMzUjFjQzkwYjI5c1kyaGhhVzV6TDNOMFlXSnNaUzE0T0RaZk5qUXRZWEJ3YkdVdFpHRnlkMmx1TDJ4cFlpOXlkWE4wYkdsaUwzTnlZeTl5ZFhOMEwyeHBZbkpoY25rdlkyOXlaUzl6Y21NdmMyeHBZMlV2Ylc5a0xuSnpDd0VRQUcwQUFBRDlCQUFBQ1FBQUFBTUFBQUJRQUFBQUNBQUFBQVFBQUFBRkFBQUFCZ0FBQUFjQUFBQUlBQUFBVUFBQUFBZ0FBQUFKQUFBQUNnQUFBQXNBQUFBTUFBQUFMMVZ6WlhKekwyWnRPREV6THk1allYSm5ieTl5WldkcGMzUnllUzl6Y21NdloybDBhSFZpTG1OdmJTMHhaV05qTmpJNU9XUmlPV1ZqT0RJekwzZGxaWHBzTFRBdU1TNDBMM055WXk5a1pXTnZaR1V1Y25NQUFNQUJFQUJXQUFBQVdnSUFBQjhBQUFEQUFSQUFWZ0FBQUcwQ0FBQWJBQUFBd0FFUUFGWUFBQUNDQWdBQUpnQUFBTUFCRUFCV0FBQUFxd0lBQUJFQUFBREFBUkFBVmdBQUFLMENBQUFSQUFBQXdBRVFBRllBQUFDNUFnQUFHUUFBQU1BQkVBQldBQUFBelFJQUFDSUFBQURBQVJBQVZnQUFBTThDQUFBYkFBQUF3QUVRQUZZQUFBRFFBZ0FBRlFBQUFNQUJFQUJXQUFBQTBRSUFBQlVBQUFEQUFSQUFWZ0FBQVBvQ0FBQU5BQUFBd0FFUUFGWUFBQUJGQXdBQUVRQUFBTUFCRUFCV0FBQUFTd01BQUJFQUFBREFBUkFBVmdBQUFJb0RBQUFSQUFBQXdBRVFBRllBQUFDUUF3QUFFUUFBQU1BQkVBQldBQUFBdkFNQUFDY0FBQURBQVJBQVZnQUFBTHdEQUFBSkFBQUF3QUVRQUZZQUFBQy9Bd0FBQ1FBQUFNQUJFQUJXQUFBQXhnTUFBQlVBQUFEQUFSQUFWZ0FBQU1rREFBQVlBQUFBd0FFUUFGWUFBQURTQXdBQUNnQUFBTUFCRUFCV0FBQUErQU1BQUFvQUFBREFBUkFBVmdBQUFBVUVBQUFWQUFBQXdBRVFBRllBQUFBTkJBQUFGZ0FBQU1BQkVBQldBQUFBR0FRQUFBa0FBQUF2VlhObGNuTXZabTA0TVRNdkxuSjFjM1IxY0M5MGIyOXNZMmhoYVc1ekwzTjBZV0pzWlMxNE9EWmZOalF0WVhCd2JHVXRaR0Z5ZDJsdUwyeHBZaTl5ZFhOMGJHbGlMM055WXk5eWRYTjBMMnhwWW5KaGNua3ZZV3hzYjJNdmMzSmpMM0poZDE5MlpXTXVjbk5VY21sbFpDQjBieUJ6YUhKcGJtc2dkRzhnWVNCc1lYSm5aWElnWTJGd1lXTnBkSG1vQXhBQWJBQUFBTVVCQUFBSkFBQUFUV0Y0YVcxMWJTQmpiMlJsSUhOcGVtVWdNVElnY21WeGRXbHlaV1FzSUdkdmRDQUFTQVFRQUNNQUFBQXZWWE5sY25NdlptMDRNVE12TG1OaGNtZHZMM0psWjJsemRISjVMM055WXk5bmFYUm9kV0l1WTI5dExURmxZMk0yTWprNVpHSTVaV000TWpNdmQyVmxlbXd0TUM0eExqUXZjM0pqTDJ4cFlpNXljd0IwQkJBQVV3QUFBRTBBQUFBRkFBQUFEd0FBQUFRQUFBQUVBQUFBRUFBQUFCRUFBQUFTQUFBQUR3QUFBQUFBQUFBQkFBQUFFd0FBQUdOaGJHeGxaQ0JnVDNCMGFXOXVPanAxYm5keVlYQW9LV0FnYjI0Z1lTQmdUbTl1WldBZ2RtRnNkV1ZzYVdKeVlYSjVMM04wWkM5emNtTXZjR0Z1YVdOcmFXNW5Mbkp6QUNzRkVBQWNBQUFBN1FFQUFCOEFBQUFyQlJBQUhBQUFBTzRCQUFBZUFBQUFGQUFBQUJBQUFBQUVBQUFBRlFBQUFCWUFBQUFQQUFBQUNBQUFBQVFBQUFBWEFBQUFHQUFBQUJrQUFBQU1BQUFBQkFBQUFCb0FBQUFQQUFBQUNBQUFBQVFBQUFBYkFBQUFiR2xpY21GeWVTOWhiR3h2WXk5emNtTXZjbUYzWDNabFl5NXljMk5oY0dGamFYUjVJRzkyWlhKbWJHOTNBQUFBc0FVUUFCd0FBQUFlQWdBQUJRQUFBR0F1TGdEeEJSQUFBZ0FBQUdOaGJHeGxaQ0JnVDNCMGFXOXVPanAxYm5keVlYQW9LV0FnYjI0Z1lTQmdUbTl1WldBZ2RtRnNkV1U2SUFBQUFQQUZFQUFBQUFBQUp3WVFBQUlBQUFBaUFBQUFBQUFBQUFFQUFBQWpBQUFBYVc1a1pYZ2diM1YwSUc5bUlHSnZkVzVrY3pvZ2RHaGxJR3hsYmlCcGN5QWdZblYwSUhSb1pTQnBibVJsZUNCcGN5QUFBRXdHRUFBZ0FBQUFiQVlRQUJJQUFBQnNhV0p5WVhKNUwyTnZjbVV2YzNKakwyWnRkQzlpZFdsc1pHVnljeTV5Y3lJQUFBQU1BQUFBQkFBQUFDUUFBQUFsQUFBQUpnQUFBQ0FnSUNDUUJoQUFJQUFBQURJQUFBQWhBQUFBa0FZUUFDQUFBQUF6QUFBQUVnQUFBQ0I3Q2l3S0xDQWdleUI5SUgxc2FXSnlZWEo1TDJOdmNtVXZjM0pqTDJadGRDOXVkVzB1Y25QNUJoQUFHd0FBQUdVQUFBQVVBQUFBTUhnd01EQXhNREl3TXpBME1EVXdOakEzTURnd09URXdNVEV4TWpFek1UUXhOVEUyTVRjeE9ERTVNakF5TVRJeU1qTXlOREkxTWpZeU56STRNamt6TURNeE16SXpNek0wTXpVek5qTTNNemd6T1RRd05ERTBNalF6TkRRME5UUTJORGMwT0RRNU5UQTFNVFV5TlRNMU5EVTFOVFkxTnpVNE5UazJNRFl4TmpJMk16WTBOalUyTmpZM05qZzJPVGN3TnpFM01qY3pOelEzTlRjMk56YzNPRGM1T0RBNE1UZ3lPRE00TkRnMU9EWTROemc0T0RrNU1Ea3hPVEk1TXprME9UVTVOamszT1RnNU9RQUFJZ0FBQUFRQUFBQUVBQUFBSndBQUFDZ0FBQUFwQUFBQWJHbGljbUZ5ZVM5amIzSmxMM055WXk5bWJYUXZiVzlrTG5KekFBZ0lFQUFiQUFBQVZRUUFBQkVBQUFBSUNCQUFHd0FBQUY4RUFBQWtBQUFBS0Nsc2FXSnlZWEo1TDJOdmNtVXZjM0pqTDNOc2FXTmxMMjFsYldOb2NpNXljd0FBUmdnUUFDQUFBQUJhQUFBQUJRQUFBSEpoYm1kbElITjBZWEowSUdsdVpHVjRJQ0J2ZFhRZ2IyWWdjbUZ1WjJVZ1ptOXlJSE5zYVdObElHOW1JR3hsYm1kMGFDQjRDQkFBRWdBQUFJb0lFQUFpQUFBQWNtRnVaMlVnWlc1a0lHbHVaR1Y0SUx3SUVBQVFBQUFBaWdnUUFDSUFBQUJ6YkdsalpTQnBibVJsZUNCemRHRnlkSE1nWVhRZ0lHSjFkQ0JsYm1SeklHRjBJQURjQ0JBQUZnQUFBUElJRUFBTkFBQUFiR2xpY21GeWVTOWpiM0psTDNOeVl5OXpkSEl2Y0dGMGRHVnliaTV5Y3dBUUNSQUFId0FBQUxBQkFBQW1BQUFBV3k0dUxsMWllWFJsSUdsdVpHVjRJQ0JwY3lCdmRYUWdiMllnWW05MWJtUnpJRzltSUdBQUFFVUpFQUFMQUFBQVVBa1FBQllBQUFEd0JSQUFBUUFBQUdKbFoybHVJRHc5SUdWdVpDQW9JRHc5SUNrZ2QyaGxiaUJ6YkdsamFXNW5JR0FBQUlBSkVBQU9BQUFBamdrUUFBUUFBQUNTQ1JBQUVBQUFBUEFGRUFBQkFBQUFJR2x6SUc1dmRDQmhJR05vWVhJZ1ltOTFibVJoY25rN0lHbDBJR2x6SUdsdWMybGtaU0FnS0dKNWRHVnpJQ2tnYjJZZ1lFVUpFQUFMQUFBQXhBa1FBQ1lBQUFEcUNSQUFDQUFBQVBJSkVBQUdBQUFBOEFVUUFBRUFBQUJzYVdKeVlYSjVMMk52Y21VdmMzSmpMM1Z1YVdOdlpHVXZjSEpwYm5SaFlteGxMbkp6QUFBQUlBb1FBQ1VBQUFBS0FBQUFIQUFBQUNBS0VBQWxBQUFBR2dBQUFEWUFBQUFBQVFNRkJRWUdBd2NHQ0FnSkVRb2NDeGtNRkEwUURnMFBCQkFERWhJVENSWUJGd1VZQWhrREdnY2NBaDBCSHhZZ0F5c0RMQUl0Q3k0Qk1BTXhBaklCcHdLcEFxb0Vxd2o2QXZzRi9RVCtBLzhKclhoNWk0MmlNRmRZaTR5UUhCM2REZzlMVFB2OExpOC9YRjFmdGVLRWpZNlJrcW14dXJ2RnhzbkszdVRsL3dBRUVSSXBNVFEzT2pzOVNVcGRoSTZTcWJHMHVydkd5czdQNU9VQUJBME9FUklwTVRRNk8wVkdTVXBlWkdXRWtadWR5YzdQRFJFcFJVbFhaR1dOa2FtMHVydkZ5ZC9rNWZBTkVVVkpaR1dBaExLOHZyL1YxL0R4ZzRXTHBLYSt2OFhIenMvYTIwaVl2YzNHenM5SlRrOVhXVjVmaVk2UHNiYTN2OEhHeDljUkZoZGJYUGIzL3YrQURXMXgzdDhPRHg5dWJ4d2RYMzErcnErN3ZQb1dGeDRmUmtkT1QxaGFYRjUrZjdYRjFOWGM4UEgxY25PUGRIV1dMMThtTGkrbnI3ZS94OC9YMzVwQWw1Z3dqeC9Bd2M3L1RrOWFXd2NJRHhBbkwrN3ZibTgzUFQ5Q1JaQ1IvdjlUWjNYSXlkRFIyTm5uL3Y4QUlGOGlndDhFZ2tRSUd3UUdFWUdzRG9Dck5TZ0xnT0FER1FnQkJDOEVOQVFIQXdFSEJnY1JDbEFQRWdkVkJ3TUVIQW9KQXdnREJ3TUNBd01EREFRRkF3c0dBUTRWQlRvREVRY0dCUkFIVndjQ0J4VU5VQVJEQXkwREFRUVJCZzhNT2dRZEpWOGdiUVJxSllESUJZS3dBeG9HZ3YwRFdRY1ZDeGNKRkF3VURHb0dDZ1lhQmxrSEt3VkdDaXdFREFRQkF6RUxMQVFhQmdzRGdLd0dDZ1loUDB3RUxRTjBDRHdERHdNOEJ6Z0lLd1dDL3hFWUNDOFJMUU1nRUNFUGdJd0VncGNaQ3hXSWxBVXZCVHNIQWc0WUNZQ3pMWFFNZ05ZYURBV0Evd1dBM3d6dURRT0VqUU0zQ1lGY0ZJQzRDSURMS2pnRENnWTRDRVlJREFaMEN4NERXZ1JaQ1lDREdCd0tGZ2xNQklDS0JxdWtEQmNFTWFFRWdkb21Cd3dGQllDbEVZRnRFSGdvS2daTUJJQ05CSUMrQXhzRER3MEFCZ0VCQXdFRUFnZ0lDUUlLQlFzQ0RnUVFBUkVDRWdVVEVSUUJGUUlYQWhrTkhBVWRDQ1FCYWdOckFyd0MwUUxVRE5VSjFnTFhBdG9CNEFYaEF1Z0M3aUR3QlBnQytRTDZBdnNCRENjN1BrNVBqNTZlbndZSENUWTlQbGJ6ME5FRUZCZzJOMVpYZjZxdXI3MDE0QktIaVk2ZUJBME9FUklwTVRRNlJVWkpTazVQWkdWY3RyY2JIQWNJQ2dzVUZ6WTVPcWlwMk5rSk41Q1JxQWNLT3o1bWFZK1NiMS91NzFwaW1wc25LRldkb0tHanBLZW9yYnE4eEFZTERCVWRPajlGVWFhbnpNMmdCeGthSWlVK1A4WEdCQ0FqSlNZb016ZzZTRXBNVUZOVlZsaGFYRjVnWTJWbWEzTjRmWCtLcEtxdnNNRFFycTk1ekc1dmsxNGlld1VEQkMwRFpnTUJMeTZBZ2gwRE1ROGNCQ1FKSGdVckJVUUVEaXFBcWdZa0JDUUVLQWcwQ3dHQWtJRTNDUllLQ0lDWU9RTmpDQWt3RmdVaEF4c0ZBVUE0QkVzRkx3UUtCd2tIUUNBbkJBd0pOZ002QlJvSEJBd0hVRWszTXcwekJ5NElDb0VtVWs0b0NDcFdIQlFYQ1U0RUhnOUREaGtIQ2daSUNDY0pkUXMvUVNvR093VUtCbEVHQVFVUUF3V0FpMkllU0FnS2dLWmVJa1VMQ2dZTkV6a0hDallzQkJDQXdEeGtVd3hJQ1FwR1JSdElDRk1kT1lFSFJnb2RBMGRKTndNT0NBb0dPUWNLZ1RZWmdMY0JEeklOZzV0bWRRdUF4SXE4aEMrUDBZSkhvYm1DT1FjcUJBSmdKZ3BHQ2lnRkU0S3dXMlZMQkRrSEVVQUZDd0lPbC9nSWhOWXFDYUwzZ1I4eEF4RUVDSUdNaVFSckJRMERDUWNRazJDQTlncHpDRzRYUm9DYUZBeFhDUm1BaDRGSEE0VkNEeFdGVUN1QTFTMERHZ1FDZ1hBNkJRR0ZBSURYS1V3RUNnUUNneEZFVEQyQXdqd0dBUVJWQlJzMEFvRU9MQVJrREZZS2dLNDRIUTBzQkFrSEFnNEdnSnFEMkFnTkF3MERkQXhaQnd3VURBUTRDQW9HS0FnaVRvRlVEQlVEQXdVSENSa0hCd2tERFFjcGdNc2xDb1FHYkdsaWNtRnllUzlqYjNKbEwzTnlZeTkxYm1samIyUmxMM1Z1YVdOdlpHVmZaR0YwWVM1eWN3Q3ZEeEFBS0FBQUFFc0FBQUFvQUFBQXJ3OFFBQ2dBQUFCWEFBQUFGZ0FBQUs4UEVBQW9BQUFBVWdBQUFENEFBQUFpQUFBQUJBQUFBQVFBQUFBcUFBQUFBQU1BQUlNRUlBQ1JCV0FBWFJPZ0FCSVhvQjRNSU9BZTd5d2dLeW93b0N0dnBtQXNBcWpnTEI3NzRDMEEvcUExbnYvZ05mMEJZVFlCQ3FFMkpBMWhONnNPNFRndkdDRTVNQnhoUnZNZW9VcndhbUZPVDIraFRwMjhJVTlsMGVGUEFOb2hVQURnNFZFdzRXRlQ3T0toVk5EbzRWUWdBQzVWOEFHL1ZRQndBQWNBTFFFQkFRSUJBZ0VCU0Fzd0ZSQUJaUWNDQmdJQ0FRUWpBUjRiV3dzNkNRa0JHQVFCQ1FFREFRVXJBM2NQQVNBM0FRRUJCQWdFQVFNSENnSWRBVG9CQVFFQ0JBZ0JDUUVLQWhvQkFnSTVBUVFDQkFJQ0F3TUJIZ0lEQVFzQ09RRUVCUUVDQkFFVUFoWUdBUUU2QVFFQ0FRUUlBUWNEQ2dJZUFUc0JBUUVNQVFrQktBRURBVGtEQlFNQkJBY0NDd0lkQVRvQkFnRUNBUU1CQlFJSEFnc0NIQUk1QWdFQkFnUUlBUWtCQ2dJZEFVZ0JCQUVDQXdFQkNBRlJBUUlIREFoaUFRSUpDd1pLQWhzQkFRRUJBVGNPQVFVQkFnVUxBU1FKQVdZRUFRWUJBZ0lDR1FJRUF4QUVEUUVDQWdZQkR3RUFBd0FESFFNZEFoNENRQUlCQndnQkFnc0pBUzBEZHdJaUFYWURCQUlKQVFZRDJ3SUNBVG9CQVFjQkFRRUJBZ2dHQ2dJQk1CRS9CREFIQVFFRkFTZ0pEQUlnQkFJQ0FRTTRBUUVDQXdFQkF6b0lBZ0tZQXdFTkFRY0VBUVlCQXdMR09nRUZBQUhESVFBRGpRRmdJQUFHYVFJQUJBRUtJQUpRQWdBQkF3RUVBUmtDQlFHWEFob1NEUUVtQ0JrTExnTXdBUUlFQWdJbkFVTUdBZ0lDQWd3QkNBRXZBVE1CQVFNQ0FnVUNBUUVxQWdnQjdnRUNBUVFCQUFFQUVCQVFBQUlBQWVJQmxRVUFBd0VDQlFRb0F3UUJwUUlBQkFBQ21RdXdBVFlQT0FNeEJBSUNSUU1rQlFFSVBnRU1BalFKQ2dRQ0FWOERBZ0VCQWdZQm9BRURDQlVDT1FJQkFRRUJGZ0VPQndNRnd3Z0NBd0VCRndGUkFRSUdBUUVDQVFFQ0FRTHJBUUlFQmdJQkFoc0NWUWdDQVFFQ2FnRUJBUUlHQVFGbEF3SUVBUVVBQ1FFQzlRRUtBZ0VCQkFHUUJBSUNCQUVnQ2lnR0FnUUlBUWtHQWdNdURRRUNBQWNCQmdFQlVoWUNCd0VDQVFKNkJnTUJBUUlCQndFQlNBSURBUUVCQUFJQUJUc0hBQUUvQkZFQkFBSUFBUUVEQkFVSUNBSUhIZ1NVQXdBM0JESUlBUTRCRmdVQkR3QUhBUkVDQndFQ0FRVUFCd0FFQUFkdEJ3QmdnUEFBVEdGNWIzVjBSWEp5Y0hKcGRtRjBaUUI3Q1hCeWIyUjFZMlZ5Y3dJSWJHRnVaM1ZoWjJVQkJGSjFjM1FBREhCeWIyTmxjM05sWkMxaWVRTUZjblZ6ZEdNZE1TNDBPUzR3SUNobE1UZzROR0U0WlRNZ01qQXlNQzB4TWkweU9Ta0dkMkZzY25WekJqQXVNVGd1TUF4M1lYTnRMV0pwYm1SblpXNFNNQzR5TGpjd0lDaGlOak0xTldNeU56QXAiKTtsZXQgbzthc3luYyBmdW5jdGlvbiBOKEEsSSl7b3x8KG89YXdhaXQoYXN5bmMoKT0+KGF3YWl0IEUoRyksRCkpKCkpO2NvbnN0IGc9by5kZWNvbXByZXNzKEEsSSk7aWYoMD09PWcubGVuZ3RoKXRocm93IEVycm9yKCJGYWlsZWQgdG8gZGVjb2RlIHdpdGggTFpXIGRlY29kZXIuIik7cmV0dXJuIGd9CgogIGNsYXNzIExaV0RlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBjb25zdHJ1Y3RvcihmaWxlRGlyZWN0b3J5KSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIGNvbnN0IHdpZHRoID0gZmlsZURpcmVjdG9yeS5UaWxlV2lkdGggfHwgZmlsZURpcmVjdG9yeS5JbWFnZVdpZHRoOwogICAgICBjb25zdCBoZWlnaHQgPSBmaWxlRGlyZWN0b3J5LlRpbGVMZW5ndGggfHwgZmlsZURpcmVjdG9yeS5JbWFnZUxlbmd0aDsKICAgICAgY29uc3QgbmJ5dGVzID0gZmlsZURpcmVjdG9yeS5CaXRzUGVyU2FtcGxlWzBdIC8gODsKICAgICAgdGhpcy5tYXhVbmNvbXByZXNzZWRTaXplID0gd2lkdGggKiBoZWlnaHQgKiBuYnl0ZXM7CiAgICB9CgogICAgYXN5bmMgZGVjb2RlQmxvY2soYnVmZmVyKSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IE4oYnl0ZXMsIHRoaXMubWF4VW5jb21wcmVzc2VkU2l6ZSk7CiAgICAgIHJldHVybiBkZWNvZGVkLmJ1ZmZlcjsKICAgIH0KICB9CgogIC8qIC0qLSB0YWItd2lkdGg6IDI7IGluZGVudC10YWJzLW1vZGU6IG5pbDsgYy1iYXNpYy1vZmZzZXQ6IDIgLSotIC8KICAvKiB2aW06IHNldCBzaGlmdHdpZHRoPTIgdGFic3RvcD0yIGF1dG9pbmRlbnQgY2luZGVudCBleHBhbmR0YWI6ICovCiAgLyoKICAgICBDb3B5cmlnaHQgMjAxMSBub3RtYXN0ZXJ5ZXQKICAgICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgICAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAqLwoKICAvLyAtIFRoZSBKUEVHIHNwZWNpZmljYXRpb24gY2FuIGJlIGZvdW5kIGluIHRoZSBJVFUgQ0NJVFQgUmVjb21tZW5kYXRpb24gVC44MQogIC8vICAgKHd3dy53My5vcmcvR3JhcGhpY3MvSlBFRy9pdHUtdDgxLnBkZikKICAvLyAtIFRoZSBKRklGIHNwZWNpZmljYXRpb24gY2FuIGJlIGZvdW5kIGluIHRoZSBKUEVHIEZpbGUgSW50ZXJjaGFuZ2UgRm9ybWF0CiAgLy8gICAod3d3LnczLm9yZy9HcmFwaGljcy9KUEVHL2pmaWYzLnBkZikKICAvLyAtIFRoZSBBZG9iZSBBcHBsaWNhdGlvbi1TcGVjaWZpYyBKUEVHIG1hcmtlcnMgaW4gdGhlIFN1cHBvcnRpbmcgdGhlIERDVCBGaWx0ZXJzCiAgLy8gICBpbiBQb3N0U2NyaXB0IExldmVsIDIsIFRlY2huaWNhbCBOb3RlICM1MTE2CiAgLy8gICAocGFydG5lcnMuYWRvYmUuY29tL3B1YmxpYy9kZXZlbG9wZXIvZW4vcHMvc2RrLzUxMTYuRENUX0ZpbHRlci5wZGYpCgoKICBjb25zdCBkY3RaaWdaYWcgPSBuZXcgSW50MzJBcnJheShbCiAgICAwLAogICAgMSwgOCwKICAgIDE2LCA5LCAyLAogICAgMywgMTAsIDE3LCAyNCwKICAgIDMyLCAyNSwgMTgsIDExLCA0LAogICAgNSwgMTIsIDE5LCAyNiwgMzMsIDQwLAogICAgNDgsIDQxLCAzNCwgMjcsIDIwLCAxMywgNiwKICAgIDcsIDE0LCAyMSwgMjgsIDM1LCA0MiwgNDksIDU2LAogICAgNTcsIDUwLCA0MywgMzYsIDI5LCAyMiwgMTUsCiAgICAyMywgMzAsIDM3LCA0NCwgNTEsIDU4LAogICAgNTksIDUyLCA0NSwgMzgsIDMxLAogICAgMzksIDQ2LCA1MywgNjAsCiAgICA2MSwgNTQsIDQ3LAogICAgNTUsIDYyLAogICAgNjMsCiAgXSk7CgogIGNvbnN0IGRjdENvczEgPSA0MDE3OyAvLyBjb3MocGkvMTYpCiAgY29uc3QgZGN0U2luMSA9IDc5OTsgLy8gc2luKHBpLzE2KQogIGNvbnN0IGRjdENvczMgPSAzNDA2OyAvLyBjb3MoMypwaS8xNikKICBjb25zdCBkY3RTaW4zID0gMjI3NjsgLy8gc2luKDMqcGkvMTYpCiAgY29uc3QgZGN0Q29zNiA9IDE1Njc7IC8vIGNvcyg2KnBpLzE2KQogIGNvbnN0IGRjdFNpbjYgPSAzNzg0OyAvLyBzaW4oNipwaS8xNikKICBjb25zdCBkY3RTcXJ0MiA9IDU3OTM7IC8vIHNxcnQoMikKICBjb25zdCBkY3RTcXJ0MWQyID0gMjg5NjsvLyBzcXJ0KDIpIC8gMgoKICBmdW5jdGlvbiBidWlsZEh1ZmZtYW5UYWJsZShjb2RlTGVuZ3RocywgdmFsdWVzKSB7CiAgICBsZXQgayA9IDA7CiAgICBjb25zdCBjb2RlID0gW107CiAgICBsZXQgbGVuZ3RoID0gMTY7CiAgICB3aGlsZSAobGVuZ3RoID4gMCAmJiAhY29kZUxlbmd0aHNbbGVuZ3RoIC0gMV0pIHsKICAgICAgLS1sZW5ndGg7CiAgICB9CiAgICBjb2RlLnB1c2goeyBjaGlsZHJlbjogW10sIGluZGV4OiAwIH0pOwoKICAgIGxldCBwID0gY29kZVswXTsKICAgIGxldCBxOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvZGVMZW5ndGhzW2ldOyBqKyspIHsKICAgICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gdmFsdWVzW2tdOwogICAgICAgIHdoaWxlIChwLmluZGV4ID4gMCkgewogICAgICAgICAgcCA9IGNvZGUucG9wKCk7CiAgICAgICAgfQogICAgICAgIHAuaW5kZXgrKzsKICAgICAgICBjb2RlLnB1c2gocCk7CiAgICAgICAgd2hpbGUgKGNvZGUubGVuZ3RoIDw9IGkpIHsKICAgICAgICAgIGNvZGUucHVzaChxID0geyBjaGlsZHJlbjogW10sIGluZGV4OiAwIH0pOwogICAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgICBwID0gcTsKICAgICAgICB9CiAgICAgICAgaysrOwogICAgICB9CiAgICAgIGlmIChpICsgMSA8IGxlbmd0aCkgewogICAgICAgIC8vIHAgaGVyZSBwb2ludHMgdG8gbGFzdCBjb2RlCiAgICAgICAgY29kZS5wdXNoKHEgPSB7IGNoaWxkcmVuOiBbXSwgaW5kZXg6IDAgfSk7CiAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgcCA9IHE7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjb2RlWzBdLmNoaWxkcmVuOwogIH0KCiAgZnVuY3Rpb24gZGVjb2RlU2NhbihkYXRhLCBpbml0aWFsT2Zmc2V0LAogICAgZnJhbWUsIGNvbXBvbmVudHMsIHJlc2V0SW50ZXJ2YWwsCiAgICBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwKICAgIHN1Y2Nlc3NpdmVQcmV2LCBzdWNjZXNzaXZlKSB7CiAgICBjb25zdCB7IG1jdXNQZXJMaW5lLCBwcm9ncmVzc2l2ZSB9ID0gZnJhbWU7CgogICAgY29uc3Qgc3RhcnRPZmZzZXQgPSBpbml0aWFsT2Zmc2V0OwogICAgbGV0IG9mZnNldCA9IGluaXRpYWxPZmZzZXQ7CiAgICBsZXQgYml0c0RhdGEgPSAwOwogICAgbGV0IGJpdHNDb3VudCA9IDA7CiAgICBmdW5jdGlvbiByZWFkQml0KCkgewogICAgICBpZiAoYml0c0NvdW50ID4gMCkgewogICAgICAgIGJpdHNDb3VudC0tOwogICAgICAgIHJldHVybiAoYml0c0RhdGEgPj4gYml0c0NvdW50KSAmIDE7CiAgICAgIH0KICAgICAgYml0c0RhdGEgPSBkYXRhW29mZnNldCsrXTsKICAgICAgaWYgKGJpdHNEYXRhID09PSAweEZGKSB7CiAgICAgICAgY29uc3QgbmV4dEJ5dGUgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICBpZiAobmV4dEJ5dGUpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgdW5leHBlY3RlZCBtYXJrZXI6ICR7KChiaXRzRGF0YSA8PCA4KSB8IG5leHRCeXRlKS50b1N0cmluZygxNil9YCk7CiAgICAgICAgfQogICAgICAgIC8vIHVuc3R1ZmYgMAogICAgICB9CiAgICAgIGJpdHNDb3VudCA9IDc7CiAgICAgIHJldHVybiBiaXRzRGF0YSA+Pj4gNzsKICAgIH0KICAgIGZ1bmN0aW9uIGRlY29kZUh1ZmZtYW4odHJlZSkgewogICAgICBsZXQgbm9kZSA9IHRyZWU7CiAgICAgIGxldCBiaXQ7CiAgICAgIHdoaWxlICgoYml0ID0gcmVhZEJpdCgpKSAhPT0gbnVsbCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbmQtYXNzaWduCiAgICAgICAgbm9kZSA9IG5vZGVbYml0XTsKICAgICAgICBpZiAodHlwZW9mIG5vZGUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBub2RlICE9PSAnb2JqZWN0JykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGh1ZmZtYW4gc2VxdWVuY2UnKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiByZWNlaXZlKGluaXRpYWxMZW5ndGgpIHsKICAgICAgbGV0IGxlbmd0aCA9IGluaXRpYWxMZW5ndGg7CiAgICAgIGxldCBuID0gMDsKICAgICAgd2hpbGUgKGxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBiaXQgPSByZWFkQml0KCk7CiAgICAgICAgaWYgKGJpdCA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgbiA9IChuIDw8IDEpIHwgYml0OwogICAgICAgIC0tbGVuZ3RoOwogICAgICB9CiAgICAgIHJldHVybiBuOwogICAgfQogICAgZnVuY3Rpb24gcmVjZWl2ZUFuZEV4dGVuZChsZW5ndGgpIHsKICAgICAgY29uc3QgbiA9IHJlY2VpdmUobGVuZ3RoKTsKICAgICAgaWYgKG4gPj0gMSA8PCAobGVuZ3RoIC0gMSkpIHsKICAgICAgICByZXR1cm4gbjsKICAgICAgfQogICAgICByZXR1cm4gbiArICgtMSA8PCBsZW5ndGgpICsgMTsKICAgIH0KICAgIGZ1bmN0aW9uIGRlY29kZUJhc2VsaW5lKGNvbXBvbmVudCwgenopIHsKICAgICAgY29uc3QgdCA9IGRlY29kZUh1ZmZtYW4oY29tcG9uZW50Lmh1ZmZtYW5UYWJsZURDKTsKICAgICAgY29uc3QgZGlmZiA9IHQgPT09IDAgPyAwIDogcmVjZWl2ZUFuZEV4dGVuZCh0KTsKICAgICAgY29tcG9uZW50LnByZWQgKz0gZGlmZjsKICAgICAgenpbMF0gPSBjb21wb25lbnQucHJlZDsKICAgICAgbGV0IGsgPSAxOwogICAgICB3aGlsZSAoayA8IDY0KSB7CiAgICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgICAgY29uc3QgcyA9IHJzICYgMTU7CiAgICAgICAgY29uc3QgciA9IHJzID4+IDQ7CiAgICAgICAgaWYgKHMgPT09IDApIHsKICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBrICs9IDE2OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBrICs9IHI7CiAgICAgICAgICBjb25zdCB6ID0gZGN0WmlnWmFnW2tdOwogICAgICAgICAgenpbel0gPSByZWNlaXZlQW5kRXh0ZW5kKHMpOwogICAgICAgICAgaysrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZGVjb2RlRENGaXJzdChjb21wb25lbnQsIHp6KSB7CiAgICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICAgIGNvbnN0IGRpZmYgPSB0ID09PSAwID8gMCA6IChyZWNlaXZlQW5kRXh0ZW5kKHQpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICBjb21wb25lbnQucHJlZCArPSBkaWZmOwogICAgICB6elswXSA9IGNvbXBvbmVudC5wcmVkOwogICAgfQogICAgZnVuY3Rpb24gZGVjb2RlRENTdWNjZXNzaXZlKGNvbXBvbmVudCwgenopIHsKICAgICAgenpbMF0gfD0gcmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmU7CiAgICB9CiAgICBsZXQgZW9icnVuID0gMDsKICAgIGZ1bmN0aW9uIGRlY29kZUFDRmlyc3QoY29tcG9uZW50LCB6eikgewogICAgICBpZiAoZW9icnVuID4gMCkgewogICAgICAgIGVvYnJ1bi0tOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgayA9IHNwZWN0cmFsU3RhcnQ7CiAgICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgICAgd2hpbGUgKGsgPD0gZSkgewogICAgICAgIGNvbnN0IHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgIGNvbnN0IHMgPSBycyAmIDE1OwogICAgICAgIGNvbnN0IHIgPSBycyA+PiA0OwogICAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgICBpZiAociA8IDE1KSB7CiAgICAgICAgICAgIGVvYnJ1biA9IHJlY2VpdmUocikgKyAoMSA8PCByKSAtIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgayArPSAxNjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgayArPSByOwogICAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgICAgIHp6W3pdID0gcmVjZWl2ZUFuZEV4dGVuZChzKSAqICgxIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgaysrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgIGxldCBzdWNjZXNzaXZlQUNOZXh0VmFsdWU7CiAgICBmdW5jdGlvbiBkZWNvZGVBQ1N1Y2Nlc3NpdmUoY29tcG9uZW50LCB6eikgewogICAgICBsZXQgayA9IHNwZWN0cmFsU3RhcnQ7CiAgICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgICAgbGV0IHIgPSAwOwogICAgICB3aGlsZSAoayA8PSBlKSB7CiAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSB6elt6XSA8IDAgPyAtMSA6IDE7CiAgICAgICAgc3dpdGNoIChzdWNjZXNzaXZlQUNTdGF0ZSkgewogICAgICAgICAgY2FzZSAwOiB7IC8vIGluaXRpYWwgc3RhdGUKICAgICAgICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgICAgICAgIGNvbnN0IHMgPSBycyAmIDE1OwogICAgICAgICAgICByID0gcnMgPj4gNDsKICAgICAgICAgICAgaWYgKHMgPT09IDApIHsKICAgICAgICAgICAgICBpZiAociA8IDE1KSB7CiAgICAgICAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcik7CiAgICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHIgPSAxNjsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHMgIT09IDEpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBBQ24gZW5jb2RpbmcnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDTmV4dFZhbHVlID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IHIgPyAyIDogMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZQogICAgICAgICAgfQogICAgICAgICAgY2FzZSAxOiAvLyBza2lwcGluZyByIHplcm8gaXRlbXMKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgaWYgKHp6W3pdKSB7CiAgICAgICAgICAgICAgenpbel0gKz0gKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKSAqIGRpcmVjdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByLS07CiAgICAgICAgICAgICAgaWYgKHIgPT09IDApIHsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDIgPyAzIDogMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM6IC8vIHNldCB2YWx1ZSBmb3IgYSB6ZXJvIGl0ZW0KICAgICAgICAgICAgaWYgKHp6W3pdKSB7CiAgICAgICAgICAgICAgenpbel0gKz0gKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKSAqIGRpcmVjdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB6elt6XSA9IHN1Y2Nlc3NpdmVBQ05leHRWYWx1ZSA8PCBzdWNjZXNzaXZlOwogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNDogLy8gZW9iCiAgICAgICAgICAgIGlmICh6elt6XSkgewogICAgICAgICAgICAgIHp6W3pdICs9IChyZWFkQml0KCkgPDwgc3VjY2Vzc2l2ZSkgKiBkaXJlY3Rpb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGsrKzsKICAgICAgfQogICAgICBpZiAoc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDQpIHsKICAgICAgICBlb2JydW4tLTsKICAgICAgICBpZiAoZW9icnVuID09PSAwKSB7CiAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBkZWNvZGVNY3UoY29tcG9uZW50LCBkZWNvZGVGdW5jdGlvbiwgbWN1LCByb3csIGNvbCkgewogICAgICBjb25zdCBtY3VSb3cgPSAobWN1IC8gbWN1c1BlckxpbmUpIHwgMDsKICAgICAgY29uc3QgbWN1Q29sID0gbWN1ICUgbWN1c1BlckxpbmU7CiAgICAgIGNvbnN0IGJsb2NrUm93ID0gKG1jdVJvdyAqIGNvbXBvbmVudC52KSArIHJvdzsKICAgICAgY29uc3QgYmxvY2tDb2wgPSAobWN1Q29sICogY29tcG9uZW50LmgpICsgY29sOwogICAgICBkZWNvZGVGdW5jdGlvbihjb21wb25lbnQsIGNvbXBvbmVudC5ibG9ja3NbYmxvY2tSb3ddW2Jsb2NrQ29sXSk7CiAgICB9CiAgICBmdW5jdGlvbiBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZUZ1bmN0aW9uLCBtY3UpIHsKICAgICAgY29uc3QgYmxvY2tSb3cgPSAobWN1IC8gY29tcG9uZW50LmJsb2Nrc1BlckxpbmUpIHwgMDsKICAgICAgY29uc3QgYmxvY2tDb2wgPSBtY3UgJSBjb21wb25lbnQuYmxvY2tzUGVyTGluZTsKICAgICAgZGVjb2RlRnVuY3Rpb24oY29tcG9uZW50LCBjb21wb25lbnQuYmxvY2tzW2Jsb2NrUm93XVtibG9ja0NvbF0pOwogICAgfQoKICAgIGNvbnN0IGNvbXBvbmVudHNMZW5ndGggPSBjb21wb25lbnRzLmxlbmd0aDsKICAgIGxldCBjb21wb25lbnQ7CiAgICBsZXQgaTsKICAgIGxldCBqOwogICAgbGV0IGs7CiAgICBsZXQgbjsKICAgIGxldCBkZWNvZGVGbjsKICAgIGlmIChwcm9ncmVzc2l2ZSkgewogICAgICBpZiAoc3BlY3RyYWxTdGFydCA9PT0gMCkgewogICAgICAgIGRlY29kZUZuID0gc3VjY2Vzc2l2ZVByZXYgPT09IDAgPyBkZWNvZGVEQ0ZpcnN0IDogZGVjb2RlRENTdWNjZXNzaXZlOwogICAgICB9IGVsc2UgewogICAgICAgIGRlY29kZUZuID0gc3VjY2Vzc2l2ZVByZXYgPT09IDAgPyBkZWNvZGVBQ0ZpcnN0IDogZGVjb2RlQUNTdWNjZXNzaXZlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBkZWNvZGVGbiA9IGRlY29kZUJhc2VsaW5lOwogICAgfQoKICAgIGxldCBtY3UgPSAwOwogICAgbGV0IG1hcmtlcjsKICAgIGxldCBtY3VFeHBlY3RlZDsKICAgIGlmIChjb21wb25lbnRzTGVuZ3RoID09PSAxKSB7CiAgICAgIG1jdUV4cGVjdGVkID0gY29tcG9uZW50c1swXS5ibG9ja3NQZXJMaW5lICogY29tcG9uZW50c1swXS5ibG9ja3NQZXJDb2x1bW47CiAgICB9IGVsc2UgewogICAgICBtY3VFeHBlY3RlZCA9IG1jdXNQZXJMaW5lICogZnJhbWUubWN1c1BlckNvbHVtbjsKICAgIH0KCiAgICBjb25zdCB1c2VkUmVzZXRJbnRlcnZhbCA9IHJlc2V0SW50ZXJ2YWwgfHwgbWN1RXhwZWN0ZWQ7CgogICAgd2hpbGUgKG1jdSA8IG1jdUV4cGVjdGVkKSB7CiAgICAgIC8vIHJlc2V0IGludGVydmFsIHN0dWZmCiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb21wb25lbnRzW2ldLnByZWQgPSAwOwogICAgICB9CiAgICAgIGVvYnJ1biA9IDA7CgogICAgICBpZiAoY29tcG9uZW50c0xlbmd0aCA9PT0gMSkgewogICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbMF07CiAgICAgICAgZm9yIChuID0gMDsgbiA8IHVzZWRSZXNldEludGVydmFsOyBuKyspIHsKICAgICAgICAgIGRlY29kZUJsb2NrKGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSk7CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChuID0gMDsgbiA8IHVzZWRSZXNldEludGVydmFsOyBuKyspIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1tpXTsKICAgICAgICAgICAgY29uc3QgeyBoLCB2IH0gPSBjb21wb25lbnQ7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB2OyBqKyspIHsKICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgaDsgaysrKSB7CiAgICAgICAgICAgICAgICBkZWNvZGVNY3UoY29tcG9uZW50LCBkZWNvZGVGbiwgbWN1LCBqLCBrKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG1jdSsrOwoKICAgICAgICAgIC8vIElmIHdlJ3ZlIHJlYWNoZWQgb3VyIGV4cGVjdGVkIE1DVSdzLCBzdG9wIGRlY29kaW5nCiAgICAgICAgICBpZiAobWN1ID09PSBtY3VFeHBlY3RlZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGZpbmQgbWFya2VyCiAgICAgIGJpdHNDb3VudCA9IDA7CiAgICAgIG1hcmtlciA9IChkYXRhW29mZnNldF0gPDwgOCkgfCBkYXRhW29mZnNldCArIDFdOwogICAgICBpZiAobWFya2VyIDwgMHhGRjAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdtYXJrZXIgd2FzIG5vdCBmb3VuZCcpOwogICAgICB9CgogICAgICBpZiAobWFya2VyID49IDB4RkZEMCAmJiBtYXJrZXIgPD0gMHhGRkQ3KSB7IC8vIFJTVHgKICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgfSBlbHNlIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQgLSBzdGFydE9mZnNldDsKICB9CgogIGZ1bmN0aW9uIGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSB7CiAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgY29uc3QgeyBibG9ja3NQZXJMaW5lLCBibG9ja3NQZXJDb2x1bW4gfSA9IGNvbXBvbmVudDsKICAgIGNvbnN0IHNhbXBsZXNQZXJMaW5lID0gYmxvY2tzUGVyTGluZSA8PCAzOwogICAgY29uc3QgUiA9IG5ldyBJbnQzMkFycmF5KDY0KTsKICAgIGNvbnN0IHIgPSBuZXcgVWludDhBcnJheSg2NCk7CgogICAgLy8gQSBwb3J0IG9mIHBvcHBsZXIncyBJRENUIG1ldGhvZCB3aGljaCBpbiB0dXJuIGlzIHRha2VuIGZyb206CiAgICAvLyAgIENocmlzdG9waCBMb2VmZmxlciwgQWRyaWFhbiBMaWd0ZW5iZXJnLCBHZW9yZ2UgUy4gTW9zY2h5dHosCiAgICAvLyAgICJQcmFjdGljYWwgRmFzdCAxLUQgRENUIEFsZ29yaXRobXMgd2l0aCAxMSBNdWx0aXBsaWNhdGlvbnMiLAogICAgLy8gICBJRUVFIEludGwuIENvbmYuIG9uIEFjb3VzdGljcywgU3BlZWNoICYgU2lnbmFsIFByb2Nlc3NpbmcsIDE5ODksCiAgICAvLyAgIDk4OC05OTEuCiAgICBmdW5jdGlvbiBxdWFudGl6ZUFuZEludmVyc2UoenosIGRhdGFPdXQsIGRhdGFJbikgewogICAgICBjb25zdCBxdCA9IGNvbXBvbmVudC5xdWFudGl6YXRpb25UYWJsZTsKICAgICAgbGV0IHYwOwogICAgICBsZXQgdjE7CiAgICAgIGxldCB2MjsKICAgICAgbGV0IHYzOwogICAgICBsZXQgdjQ7CiAgICAgIGxldCB2NTsKICAgICAgbGV0IHY2OwogICAgICBsZXQgdjc7CiAgICAgIGxldCB0OwogICAgICBjb25zdCBwID0gZGF0YUluOwogICAgICBsZXQgaTsKCiAgICAgIC8vIGRlcXVhbnQKICAgICAgZm9yIChpID0gMDsgaSA8IDY0OyBpKyspIHsKICAgICAgICBwW2ldID0genpbaV0gKiBxdFtpXTsKICAgICAgfQoKICAgICAgLy8gaW52ZXJzZSBEQ1Qgb24gcm93cwogICAgICBmb3IgKGkgPSAwOyBpIDwgODsgKytpKSB7CiAgICAgICAgY29uc3Qgcm93ID0gOCAqIGk7CgogICAgICAgIC8vIGNoZWNrIGZvciBhbGwtemVybyBBQyBjb2VmZmljaWVudHMKICAgICAgICBpZiAocFsxICsgcm93XSA9PT0gMCAmJiBwWzIgKyByb3ddID09PSAwICYmIHBbMyArIHJvd10gPT09IDAKICAgICAgICAgICYmIHBbNCArIHJvd10gPT09IDAgJiYgcFs1ICsgcm93XSA9PT0gMCAmJiBwWzYgKyByb3ddID09PSAwCiAgICAgICAgICAmJiBwWzcgKyByb3ddID09PSAwKSB7CiAgICAgICAgICB0ID0gKChkY3RTcXJ0MiAqIHBbMCArIHJvd10pICsgNTEyKSA+PiAxMDsKICAgICAgICAgIHBbMCArIHJvd10gPSB0OwogICAgICAgICAgcFsxICsgcm93XSA9IHQ7CiAgICAgICAgICBwWzIgKyByb3ddID0gdDsKICAgICAgICAgIHBbMyArIHJvd10gPSB0OwogICAgICAgICAgcFs0ICsgcm93XSA9IHQ7CiAgICAgICAgICBwWzUgKyByb3ddID0gdDsKICAgICAgICAgIHBbNiArIHJvd10gPSB0OwogICAgICAgICAgcFs3ICsgcm93XSA9IHQ7CiAgICAgICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZQogICAgICAgIH0KCiAgICAgICAgLy8gc3RhZ2UgNAogICAgICAgIHYwID0gKChkY3RTcXJ0MiAqIHBbMCArIHJvd10pICsgMTI4KSA+PiA4OwogICAgICAgIHYxID0gKChkY3RTcXJ0MiAqIHBbNCArIHJvd10pICsgMTI4KSA+PiA4OwogICAgICAgIHYyID0gcFsyICsgcm93XTsKICAgICAgICB2MyA9IHBbNiArIHJvd107CiAgICAgICAgdjQgPSAoKGRjdFNxcnQxZDIgKiAocFsxICsgcm93XSAtIHBbNyArIHJvd10pKSArIDEyOCkgPj4gODsKICAgICAgICB2NyA9ICgoZGN0U3FydDFkMiAqIChwWzEgKyByb3ddICsgcFs3ICsgcm93XSkpICsgMTI4KSA+PiA4OwogICAgICAgIHY1ID0gcFszICsgcm93XSA8PCA0OwogICAgICAgIHY2ID0gcFs1ICsgcm93XSA8PCA0OwoKICAgICAgICAvLyBzdGFnZSAzCiAgICAgICAgdCA9ICh2MCAtIHYxICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYxICsgMSkgPj4gMTsKICAgICAgICB2MSA9IHQ7CiAgICAgICAgdCA9ICgodjIgKiBkY3RTaW42KSArICh2MyAqIGRjdENvczYpICsgMTI4KSA+PiA4OwogICAgICAgIHYyID0gKCh2MiAqIGRjdENvczYpIC0gKHYzICogZGN0U2luNikgKyAxMjgpID4+IDg7CiAgICAgICAgdjMgPSB0OwogICAgICAgIHQgPSAodjQgLSB2NiArIDEpID4+IDE7CiAgICAgICAgdjQgPSAodjQgKyB2NiArIDEpID4+IDE7CiAgICAgICAgdjYgPSB0OwogICAgICAgIHQgPSAodjcgKyB2NSArIDEpID4+IDE7CiAgICAgICAgdjUgPSAodjcgLSB2NSArIDEpID4+IDE7CiAgICAgICAgdjcgPSB0OwoKICAgICAgICAvLyBzdGFnZSAyCiAgICAgICAgdCA9ICh2MCAtIHYzICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYzICsgMSkgPj4gMTsKICAgICAgICB2MyA9IHQ7CiAgICAgICAgdCA9ICh2MSAtIHYyICsgMSkgPj4gMTsKICAgICAgICB2MSA9ICh2MSArIHYyICsgMSkgPj4gMTsKICAgICAgICB2MiA9IHQ7CiAgICAgICAgdCA9ICgodjQgKiBkY3RTaW4zKSArICh2NyAqIGRjdENvczMpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjQgPSAoKHY0ICogZGN0Q29zMykgLSAodjcgKiBkY3RTaW4zKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY3ID0gdDsKICAgICAgICB0ID0gKCh2NSAqIGRjdFNpbjEpICsgKHY2ICogZGN0Q29zMSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2NSA9ICgodjUgKiBkY3RDb3MxKSAtICh2NiAqIGRjdFNpbjEpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjYgPSB0OwoKICAgICAgICAvLyBzdGFnZSAxCiAgICAgICAgcFswICsgcm93XSA9IHYwICsgdjc7CiAgICAgICAgcFs3ICsgcm93XSA9IHYwIC0gdjc7CiAgICAgICAgcFsxICsgcm93XSA9IHYxICsgdjY7CiAgICAgICAgcFs2ICsgcm93XSA9IHYxIC0gdjY7CiAgICAgICAgcFsyICsgcm93XSA9IHYyICsgdjU7CiAgICAgICAgcFs1ICsgcm93XSA9IHYyIC0gdjU7CiAgICAgICAgcFszICsgcm93XSA9IHYzICsgdjQ7CiAgICAgICAgcFs0ICsgcm93XSA9IHYzIC0gdjQ7CiAgICAgIH0KCiAgICAgIC8vIGludmVyc2UgRENUIG9uIGNvbHVtbnMKICAgICAgZm9yIChpID0gMDsgaSA8IDg7ICsraSkgewogICAgICAgIGNvbnN0IGNvbCA9IGk7CgogICAgICAgIC8vIGNoZWNrIGZvciBhbGwtemVybyBBQyBjb2VmZmljaWVudHMKICAgICAgICBpZiAocFsoMSAqIDgpICsgY29sXSA9PT0gMCAmJiBwWygyICogOCkgKyBjb2xdID09PSAwICYmIHBbKDMgKiA4KSArIGNvbF0gPT09IDAKICAgICAgICAgICYmIHBbKDQgKiA4KSArIGNvbF0gPT09IDAgJiYgcFsoNSAqIDgpICsgY29sXSA9PT0gMCAmJiBwWyg2ICogOCkgKyBjb2xdID09PSAwCiAgICAgICAgICAmJiBwWyg3ICogOCkgKyBjb2xdID09PSAwKSB7CiAgICAgICAgICB0ID0gKChkY3RTcXJ0MiAqIGRhdGFJbltpICsgMF0pICsgODE5MikgPj4gMTQ7CiAgICAgICAgICBwWygwICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDEgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgcFsoMiAqIDgpICsgY29sXSA9IHQ7CiAgICAgICAgICBwWygzICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDQgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgcFsoNSAqIDgpICsgY29sXSA9IHQ7CiAgICAgICAgICBwWyg2ICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDcgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgY29udGludWU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29udGludWUKICAgICAgICB9CgogICAgICAgIC8vIHN0YWdlIDQKICAgICAgICB2MCA9ICgoZGN0U3FydDIgKiBwWygwICogOCkgKyBjb2xdKSArIDIwNDgpID4+IDEyOwogICAgICAgIHYxID0gKChkY3RTcXJ0MiAqIHBbKDQgKiA4KSArIGNvbF0pICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjIgPSBwWygyICogOCkgKyBjb2xdOwogICAgICAgIHYzID0gcFsoNiAqIDgpICsgY29sXTsKICAgICAgICB2NCA9ICgoZGN0U3FydDFkMiAqIChwWygxICogOCkgKyBjb2xdIC0gcFsoNyAqIDgpICsgY29sXSkpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjcgPSAoKGRjdFNxcnQxZDIgKiAocFsoMSAqIDgpICsgY29sXSArIHBbKDcgKiA4KSArIGNvbF0pKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY1ID0gcFsoMyAqIDgpICsgY29sXTsKICAgICAgICB2NiA9IHBbKDUgKiA4KSArIGNvbF07CgogICAgICAgIC8vIHN0YWdlIDMKICAgICAgICB0ID0gKHYwIC0gdjEgKyAxKSA+PiAxOwogICAgICAgIHYwID0gKHYwICsgdjEgKyAxKSA+PiAxOwogICAgICAgIHYxID0gdDsKICAgICAgICB0ID0gKCh2MiAqIGRjdFNpbjYpICsgKHYzICogZGN0Q29zNikgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2MiA9ICgodjIgKiBkY3RDb3M2KSAtICh2MyAqIGRjdFNpbjYpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjMgPSB0OwogICAgICAgIHQgPSAodjQgLSB2NiArIDEpID4+IDE7CiAgICAgICAgdjQgPSAodjQgKyB2NiArIDEpID4+IDE7CiAgICAgICAgdjYgPSB0OwogICAgICAgIHQgPSAodjcgKyB2NSArIDEpID4+IDE7CiAgICAgICAgdjUgPSAodjcgLSB2NSArIDEpID4+IDE7CiAgICAgICAgdjcgPSB0OwoKICAgICAgICAvLyBzdGFnZSAyCiAgICAgICAgdCA9ICh2MCAtIHYzICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYzICsgMSkgPj4gMTsKICAgICAgICB2MyA9IHQ7CiAgICAgICAgdCA9ICh2MSAtIHYyICsgMSkgPj4gMTsKICAgICAgICB2MSA9ICh2MSArIHYyICsgMSkgPj4gMTsKICAgICAgICB2MiA9IHQ7CiAgICAgICAgdCA9ICgodjQgKiBkY3RTaW4zKSArICh2NyAqIGRjdENvczMpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjQgPSAoKHY0ICogZGN0Q29zMykgLSAodjcgKiBkY3RTaW4zKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY3ID0gdDsKICAgICAgICB0ID0gKCh2NSAqIGRjdFNpbjEpICsgKHY2ICogZGN0Q29zMSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2NSA9ICgodjUgKiBkY3RDb3MxKSAtICh2NiAqIGRjdFNpbjEpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjYgPSB0OwoKICAgICAgICAvLyBzdGFnZSAxCiAgICAgICAgcFsoMCAqIDgpICsgY29sXSA9IHYwICsgdjc7CiAgICAgICAgcFsoNyAqIDgpICsgY29sXSA9IHYwIC0gdjc7CiAgICAgICAgcFsoMSAqIDgpICsgY29sXSA9IHYxICsgdjY7CiAgICAgICAgcFsoNiAqIDgpICsgY29sXSA9IHYxIC0gdjY7CiAgICAgICAgcFsoMiAqIDgpICsgY29sXSA9IHYyICsgdjU7CiAgICAgICAgcFsoNSAqIDgpICsgY29sXSA9IHYyIC0gdjU7CiAgICAgICAgcFsoMyAqIDgpICsgY29sXSA9IHYzICsgdjQ7CiAgICAgICAgcFsoNCAqIDgpICsgY29sXSA9IHYzIC0gdjQ7CiAgICAgIH0KCiAgICAgIC8vIGNvbnZlcnQgdG8gOC1iaXQgaW50ZWdlcnMKICAgICAgZm9yIChpID0gMDsgaSA8IDY0OyArK2kpIHsKICAgICAgICBjb25zdCBzYW1wbGUgPSAxMjggKyAoKHBbaV0gKyA4KSA+PiA0KTsKICAgICAgICBpZiAoc2FtcGxlIDwgMCkgewogICAgICAgICAgZGF0YU91dFtpXSA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChzYW1wbGUgPiAwWEZGKSB7CiAgICAgICAgICBkYXRhT3V0W2ldID0gMHhGRjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YU91dFtpXSA9IHNhbXBsZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmb3IgKGxldCBibG9ja1JvdyA9IDA7IGJsb2NrUm93IDwgYmxvY2tzUGVyQ29sdW1uOyBibG9ja1JvdysrKSB7CiAgICAgIGNvbnN0IHNjYW5MaW5lID0gYmxvY2tSb3cgPDwgMzsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgICAgICBsaW5lcy5wdXNoKG5ldyBVaW50OEFycmF5KHNhbXBsZXNQZXJMaW5lKSk7CiAgICAgIH0KICAgICAgZm9yIChsZXQgYmxvY2tDb2wgPSAwOyBibG9ja0NvbCA8IGJsb2Nrc1BlckxpbmU7IGJsb2NrQ29sKyspIHsKICAgICAgICBxdWFudGl6ZUFuZEludmVyc2UoY29tcG9uZW50LmJsb2Nrc1tibG9ja1Jvd11bYmxvY2tDb2xdLCByLCBSKTsKCiAgICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgICAgY29uc3Qgc2FtcGxlID0gYmxvY2tDb2wgPDwgMzsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDg7IGorKykgewogICAgICAgICAgY29uc3QgbGluZSA9IGxpbmVzW3NjYW5MaW5lICsgal07CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykgewogICAgICAgICAgICBsaW5lW3NhbXBsZSArIGldID0gcltvZmZzZXQrK107CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gbGluZXM7CiAgfQoKICBjbGFzcyBKcGVnU3RyZWFtUmVhZGVyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmpmaWYgPSBudWxsOwogICAgICB0aGlzLmFkb2JlID0gbnVsbDsKCiAgICAgIHRoaXMucXVhbnRpemF0aW9uVGFibGVzID0gW107CiAgICAgIHRoaXMuaHVmZm1hblRhYmxlc0FDID0gW107CiAgICAgIHRoaXMuaHVmZm1hblRhYmxlc0RDID0gW107CiAgICAgIHRoaXMucmVzZXRGcmFtZXMoKTsKICAgIH0KCiAgICByZXNldEZyYW1lcygpIHsKICAgICAgdGhpcy5mcmFtZXMgPSBbXTsKICAgIH0KCiAgICBwYXJzZShkYXRhKSB7CiAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAvLyBjb25zdCB7IGxlbmd0aCB9ID0gZGF0YTsKICAgICAgZnVuY3Rpb24gcmVhZFVpbnQxNigpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IChkYXRhW29mZnNldF0gPDwgOCkgfCBkYXRhW29mZnNldCArIDFdOwogICAgICAgIG9mZnNldCArPSAyOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiByZWFkRGF0YUJsb2NrKCkgewogICAgICAgIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICBjb25zdCBhcnJheSA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggLSAyKTsKICAgICAgICBvZmZzZXQgKz0gYXJyYXkubGVuZ3RoOwogICAgICAgIHJldHVybiBhcnJheTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwcmVwYXJlQ29tcG9uZW50cyhmcmFtZSkgewogICAgICAgIGxldCBtYXhIID0gMDsKICAgICAgICBsZXQgbWF4ViA9IDA7CiAgICAgICAgbGV0IGNvbXBvbmVudDsKICAgICAgICBsZXQgY29tcG9uZW50SWQ7CiAgICAgICAgZm9yIChjb21wb25lbnRJZCBpbiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICAgICAgICBpZiAoZnJhbWUuY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eShjb21wb25lbnRJZCkpIHsKICAgICAgICAgICAgY29tcG9uZW50ID0gZnJhbWUuY29tcG9uZW50c1tjb21wb25lbnRJZF07CiAgICAgICAgICAgIGlmIChtYXhIIDwgY29tcG9uZW50LmgpIHsKICAgICAgICAgICAgICBtYXhIID0gY29tcG9uZW50Lmg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1heFYgPCBjb21wb25lbnQudikgewogICAgICAgICAgICAgIG1heFYgPSBjb21wb25lbnQudjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBtY3VzUGVyTGluZSA9IE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDggLyBtYXhIKTsKICAgICAgICBjb25zdCBtY3VzUGVyQ29sdW1uID0gTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDggLyBtYXhWKTsKICAgICAgICBmb3IgKGNvbXBvbmVudElkIGluIGZyYW1lLmNvbXBvbmVudHMpIHsKICAgICAgICAgIGlmIChmcmFtZS5jb21wb25lbnRzLmhhc093blByb3BlcnR5KGNvbXBvbmVudElkKSkgewogICAgICAgICAgICBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXTsKICAgICAgICAgICAgY29uc3QgYmxvY2tzUGVyTGluZSA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2FtcGxlc1BlckxpbmUgLyA4KSAqIGNvbXBvbmVudC5oIC8gbWF4SCk7CiAgICAgICAgICAgIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2NhbkxpbmVzIC8gOCkgKiBjb21wb25lbnQudiAvIG1heFYpOwogICAgICAgICAgICBjb25zdCBibG9ja3NQZXJMaW5lRm9yTWN1ID0gbWN1c1BlckxpbmUgKiBjb21wb25lbnQuaDsKICAgICAgICAgICAgY29uc3QgYmxvY2tzUGVyQ29sdW1uRm9yTWN1ID0gbWN1c1BlckNvbHVtbiAqIGNvbXBvbmVudC52OwogICAgICAgICAgICBjb25zdCBibG9ja3MgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3NQZXJDb2x1bW5Gb3JNY3U7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IHJvdyA9IFtdOwogICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmxvY2tzUGVyTGluZUZvck1jdTsgaisrKSB7CiAgICAgICAgICAgICAgICByb3cucHVzaChuZXcgSW50MzJBcnJheSg2NCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBibG9ja3MucHVzaChyb3cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lID0gYmxvY2tzUGVyTGluZTsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2Nrc1BlckNvbHVtbiA9IGJsb2Nrc1BlckNvbHVtbjsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrcyA9IGJsb2NrczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnJhbWUubWF4SCA9IG1heEg7CiAgICAgICAgZnJhbWUubWF4ViA9IG1heFY7CiAgICAgICAgZnJhbWUubWN1c1BlckxpbmUgPSBtY3VzUGVyTGluZTsKICAgICAgICBmcmFtZS5tY3VzUGVyQ29sdW1uID0gbWN1c1BlckNvbHVtbjsKICAgICAgfQoKICAgICAgbGV0IGZpbGVNYXJrZXIgPSByZWFkVWludDE2KCk7CiAgICAgIGlmIChmaWxlTWFya2VyICE9PSAweEZGRDgpIHsgLy8gU09JIChTdGFydCBvZiBJbWFnZSkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NPSSBub3QgZm91bmQnKTsKICAgICAgfQoKICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoKTsKICAgICAgd2hpbGUgKGZpbGVNYXJrZXIgIT09IDB4RkZEOSkgeyAvLyBFT0kgKEVuZCBvZiBpbWFnZSkKICAgICAgICBzd2l0Y2ggKGZpbGVNYXJrZXIpIHsKICAgICAgICAgIGNhc2UgMHhGRjAwOiBicmVhazsKICAgICAgICAgIGNhc2UgMHhGRkUwOiAvLyBBUFAwIChBcHBsaWNhdGlvbiBTcGVjaWZpYykKICAgICAgICAgIGNhc2UgMHhGRkUxOiAvLyBBUFAxCiAgICAgICAgICBjYXNlIDB4RkZFMjogLy8gQVBQMgogICAgICAgICAgY2FzZSAweEZGRTM6IC8vIEFQUDMKICAgICAgICAgIGNhc2UgMHhGRkU0OiAvLyBBUFA0CiAgICAgICAgICBjYXNlIDB4RkZFNTogLy8gQVBQNQogICAgICAgICAgY2FzZSAweEZGRTY6IC8vIEFQUDYKICAgICAgICAgIGNhc2UgMHhGRkU3OiAvLyBBUFA3CiAgICAgICAgICBjYXNlIDB4RkZFODogLy8gQVBQOAogICAgICAgICAgY2FzZSAweEZGRTk6IC8vIEFQUDkKICAgICAgICAgIGNhc2UgMHhGRkVBOiAvLyBBUFAxMAogICAgICAgICAgY2FzZSAweEZGRUI6IC8vIEFQUDExCiAgICAgICAgICBjYXNlIDB4RkZFQzogLy8gQVBQMTIKICAgICAgICAgIGNhc2UgMHhGRkVEOiAvLyBBUFAxMwogICAgICAgICAgY2FzZSAweEZGRUU6IC8vIEFQUDE0CiAgICAgICAgICBjYXNlIDB4RkZFRjogLy8gQVBQMTUKICAgICAgICAgIGNhc2UgMHhGRkZFOiB7IC8vIENPTSAoQ29tbWVudCkKICAgICAgICAgICAgY29uc3QgYXBwRGF0YSA9IHJlYWREYXRhQmxvY2soKTsKCiAgICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweEZGRTApIHsKICAgICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0QSAmJiBhcHBEYXRhWzFdID09PSAweDQ2ICYmIGFwcERhdGFbMl0gPT09IDB4NDkKICAgICAgICAgICAgICAgICYmIGFwcERhdGFbM10gPT09IDB4NDYgJiYgYXBwRGF0YVs0XSA9PT0gMCkgeyAvLyAnSkZJRlx4MDAnCiAgICAgICAgICAgICAgICB0aGlzLmpmaWYgPSB7CiAgICAgICAgICAgICAgICAgIHZlcnNpb246IHsgbWFqb3I6IGFwcERhdGFbNV0sIG1pbm9yOiBhcHBEYXRhWzZdIH0sCiAgICAgICAgICAgICAgICAgIGRlbnNpdHlVbml0czogYXBwRGF0YVs3XSwKICAgICAgICAgICAgICAgICAgeERlbnNpdHk6IChhcHBEYXRhWzhdIDw8IDgpIHwgYXBwRGF0YVs5XSwKICAgICAgICAgICAgICAgICAgeURlbnNpdHk6IChhcHBEYXRhWzEwXSA8PCA4KSB8IGFwcERhdGFbMTFdLAogICAgICAgICAgICAgICAgICB0aHVtYldpZHRoOiBhcHBEYXRhWzEyXSwKICAgICAgICAgICAgICAgICAgdGh1bWJIZWlnaHQ6IGFwcERhdGFbMTNdLAogICAgICAgICAgICAgICAgICB0aHVtYkRhdGE6IGFwcERhdGEuc3ViYXJyYXkoMTQsIDE0ICsgKDMgKiBhcHBEYXRhWzEyXSAqIGFwcERhdGFbMTNdKSksCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBUT0RPIEFQUDEgLSBFeGlmCiAgICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweEZGRUUpIHsKICAgICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0MSAmJiBhcHBEYXRhWzFdID09PSAweDY0ICYmIGFwcERhdGFbMl0gPT09IDB4NkYKICAgICAgICAgICAgICAgICYmIGFwcERhdGFbM10gPT09IDB4NjIgJiYgYXBwRGF0YVs0XSA9PT0gMHg2NSAmJiBhcHBEYXRhWzVdID09PSAwKSB7IC8vICdBZG9iZVx4MDAnCiAgICAgICAgICAgICAgICB0aGlzLmFkb2JlID0gewogICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBhcHBEYXRhWzZdLAogICAgICAgICAgICAgICAgICBmbGFnczA6IChhcHBEYXRhWzddIDw8IDgpIHwgYXBwRGF0YVs4XSwKICAgICAgICAgICAgICAgICAgZmxhZ3MxOiAoYXBwRGF0YVs5XSA8PCA4KSB8IGFwcERhdGFbMTBdLAogICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db2RlOiBhcHBEYXRhWzExXSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMHhGRkRCOiB7IC8vIERRVCAoRGVmaW5lIFF1YW50aXphdGlvbiBUYWJsZXMpCiAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlc0xlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGVzRW5kID0gcXVhbnRpemF0aW9uVGFibGVzTGVuZ3RoICsgb2Zmc2V0IC0gMjsKICAgICAgICAgICAgd2hpbGUgKG9mZnNldCA8IHF1YW50aXphdGlvblRhYmxlc0VuZCkgewogICAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICAgIGNvbnN0IHRhYmxlRGF0YSA9IG5ldyBJbnQzMkFycmF5KDY0KTsKICAgICAgICAgICAgICBpZiAoKHF1YW50aXphdGlvblRhYmxlU3BlYyA+PiA0KSA9PT0gMCkgeyAvLyA4IGJpdCB2YWx1ZXMKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgICBjb25zdCB6ID0gZGN0WmlnWmFnW2pdOwogICAgICAgICAgICAgICAgICB0YWJsZURhdGFbel0gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKChxdWFudGl6YXRpb25UYWJsZVNwZWMgPj4gNCkgPT09IDEpIHsgLy8gMTYgYml0CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDY0OyBqKyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW3pdID0gcmVhZFVpbnQxNigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RRVDogaW52YWxpZCB0YWJsZSBzcGVjJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMucXVhbnRpemF0aW9uVGFibGVzW3F1YW50aXphdGlvblRhYmxlU3BlYyAmIDE1XSA9IHRhYmxlRGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDB4RkZDMDogLy8gU09GMCAoU3RhcnQgb2YgRnJhbWUsIEJhc2VsaW5lIERDVCkKICAgICAgICAgIGNhc2UgMHhGRkMxOiAvLyBTT0YxIChTdGFydCBvZiBGcmFtZSwgRXh0ZW5kZWQgRENUKQogICAgICAgICAgY2FzZSAweEZGQzI6IHsgLy8gU09GMiAoU3RhcnQgb2YgRnJhbWUsIFByb2dyZXNzaXZlIERDVCkKICAgICAgICAgICAgcmVhZFVpbnQxNigpOyAvLyBza2lwIGRhdGEgbGVuZ3RoCiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gewogICAgICAgICAgICAgIGV4dGVuZGVkOiAoZmlsZU1hcmtlciA9PT0gMHhGRkMxKSwKICAgICAgICAgICAgICBwcm9ncmVzc2l2ZTogKGZpbGVNYXJrZXIgPT09IDB4RkZDMiksCiAgICAgICAgICAgICAgcHJlY2lzaW9uOiBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgICBzY2FuTGluZXM6IHJlYWRVaW50MTYoKSwKICAgICAgICAgICAgICBzYW1wbGVzUGVyTGluZTogcmVhZFVpbnQxNigpLAogICAgICAgICAgICAgIGNvbXBvbmVudHM6IHt9LAogICAgICAgICAgICAgIGNvbXBvbmVudHNPcmRlcjogW10sCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgbGV0IGNvbXBvbmVudElkOwogICAgICAgICAgICAvLyBsZXQgbWF4SCA9IDA7CiAgICAgICAgICAgIC8vIGxldCBtYXhWID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21wb25lbnRzQ291bnQ7IGkrKykgewogICAgICAgICAgICAgIGNvbXBvbmVudElkID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICAgIGNvbnN0IGggPSBkYXRhW29mZnNldCArIDFdID4+IDQ7CiAgICAgICAgICAgICAgY29uc3QgdiA9IGRhdGFbb2Zmc2V0ICsgMV0gJiAxNTsKICAgICAgICAgICAgICBjb25zdCBxSWQgPSBkYXRhW29mZnNldCArIDJdOwogICAgICAgICAgICAgIGZyYW1lLmNvbXBvbmVudHNPcmRlci5wdXNoKGNvbXBvbmVudElkKTsKICAgICAgICAgICAgICBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXSA9IHsKICAgICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgICAgcXVhbnRpemF0aW9uSWR4OiBxSWQsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBvZmZzZXQgKz0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcmVwYXJlQ29tcG9uZW50cyhmcmFtZSk7CiAgICAgICAgICAgIHRoaXMuZnJhbWVzLnB1c2goZnJhbWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDB4RkZDNDogeyAvLyBESFQgKERlZmluZSBIdWZmbWFuIFRhYmxlcykKICAgICAgICAgICAgY29uc3QgaHVmZm1hbkxlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDI7IGkgPCBodWZmbWFuTGVuZ3RoOykgewogICAgICAgICAgICAgIGNvbnN0IGh1ZmZtYW5UYWJsZVNwZWMgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICBjb25zdCBjb2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgICBsZXQgY29kZUxlbmd0aFN1bSA9IDA7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgaisrLCBvZmZzZXQrKykgewogICAgICAgICAgICAgICAgY29kZUxlbmd0aHNbal0gPSBkYXRhW29mZnNldF07CiAgICAgICAgICAgICAgICBjb2RlTGVuZ3RoU3VtICs9IGNvZGVMZW5ndGhzW2pdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBodWZmbWFuVmFsdWVzID0gbmV3IFVpbnQ4QXJyYXkoY29kZUxlbmd0aFN1bSk7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2RlTGVuZ3RoU3VtOyBqKyssIG9mZnNldCsrKSB7CiAgICAgICAgICAgICAgICBodWZmbWFuVmFsdWVzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpICs9IDE3ICsgY29kZUxlbmd0aFN1bTsKCiAgICAgICAgICAgICAgaWYgKChodWZmbWFuVGFibGVTcGVjID4+IDQpID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmh1ZmZtYW5UYWJsZXNEQ1todWZmbWFuVGFibGVTcGVjICYgMTVdID0gYnVpbGRIdWZmbWFuVGFibGUoCiAgICAgICAgICAgICAgICAgIGNvZGVMZW5ndGhzLCBodWZmbWFuVmFsdWVzLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5odWZmbWFuVGFibGVzQUNbaHVmZm1hblRhYmxlU3BlYyAmIDE1XSA9IGJ1aWxkSHVmZm1hblRhYmxlKAogICAgICAgICAgICAgICAgICBjb2RlTGVuZ3RocywgaHVmZm1hblZhbHVlcywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMHhGRkREOiAvLyBEUkkgKERlZmluZSBSZXN0YXJ0IEludGVydmFsKQogICAgICAgICAgICByZWFkVWludDE2KCk7IC8vIHNraXAgZGF0YSBsZW5ndGgKICAgICAgICAgICAgdGhpcy5yZXNldEludGVydmFsID0gcmVhZFVpbnQxNigpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDB4RkZEQTogeyAvLyBTT1MgKFN0YXJ0IG9mIFNjYW4pCiAgICAgICAgICAgIHJlYWRVaW50MTYoKTsgLy8gc2tpcCBsZW5ndGgKICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3JzQ291bnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IHRoaXMuZnJhbWVzWzBdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlbGVjdG9yc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2RhdGFbb2Zmc2V0KytdXTsKICAgICAgICAgICAgICBjb25zdCB0YWJsZVNwZWMgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlREMgPSB0aGlzLmh1ZmZtYW5UYWJsZXNEQ1t0YWJsZVNwZWMgPj4gNF07CiAgICAgICAgICAgICAgY29tcG9uZW50Lmh1ZmZtYW5UYWJsZUFDID0gdGhpcy5odWZmbWFuVGFibGVzQUNbdGFibGVTcGVjICYgMTVdOwogICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChjb21wb25lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHNwZWN0cmFsU3RhcnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3Qgc3BlY3RyYWxFbmQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3Qgc3VjY2Vzc2l2ZUFwcHJveGltYXRpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkID0gZGVjb2RlU2NhbihkYXRhLCBvZmZzZXQsCiAgICAgICAgICAgICAgZnJhbWUsIGNvbXBvbmVudHMsIHRoaXMucmVzZXRJbnRlcnZhbCwKICAgICAgICAgICAgICBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwKICAgICAgICAgICAgICBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiA+PiA0LCBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiAmIDE1KTsKICAgICAgICAgICAgb2Zmc2V0ICs9IHByb2Nlc3NlZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAweEZGRkY6IC8vIEZpbGwgYnl0ZXMKICAgICAgICAgICAgaWYgKGRhdGFbb2Zmc2V0XSAhPT0gMHhGRikgeyAvLyBBdm9pZCBza2lwcGluZyBhIHZhbGlkIG1hcmtlci4KICAgICAgICAgICAgICBvZmZzZXQtLTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAoZGF0YVtvZmZzZXQgLSAzXSA9PT0gMHhGRgogICAgICAgICAgICAgICYmIGRhdGFbb2Zmc2V0IC0gMl0gPj0gMHhDMCAmJiBkYXRhW29mZnNldCAtIDJdIDw9IDB4RkUpIHsKICAgICAgICAgICAgICAvLyBjb3VsZCBiZSBpbmNvcnJlY3QgZW5jb2RpbmcgLS0gbGFzdCAweEZGIGJ5dGUgb2YgdGhlIHByZXZpb3VzCiAgICAgICAgICAgICAgLy8gYmxvY2sgd2FzIGVhdGVuIGJ5IHRoZSBlbmNvZGVyCiAgICAgICAgICAgICAgb2Zmc2V0IC09IDM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmtub3duIEpQRUcgbWFya2VyICR7ZmlsZU1hcmtlci50b1N0cmluZygxNil9YCk7CiAgICAgICAgfQogICAgICAgIGZpbGVNYXJrZXIgPSByZWFkVWludDE2KCk7CiAgICAgIH0KICAgIH0KCiAgICBnZXRSZXN1bHQoKSB7CiAgICAgIGNvbnN0IHsgZnJhbWVzIH0gPSB0aGlzOwogICAgICBpZiAodGhpcy5mcmFtZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdubyBmcmFtZXMgd2VyZSBkZWNvZGVkJyk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5mcmFtZXMubGVuZ3RoID4gMSkgewogICAgICAgIGNvbnNvbGUud2FybignbW9yZSB0aGFuIG9uZSBmcmFtZSBpcyBub3Qgc3VwcG9ydGVkJyk7CiAgICAgIH0KCiAgICAgIC8vIHNldCBlYWNoIGZyYW1lJ3MgY29tcG9uZW50cyBxdWFudGl6YXRpb24gdGFibGUKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZyYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNwID0gdGhpcy5mcmFtZXNbaV0uY29tcG9uZW50czsKICAgICAgICBmb3IgKGNvbnN0IGogb2YgT2JqZWN0LmtleXMoY3ApKSB7CiAgICAgICAgICBjcFtqXS5xdWFudGl6YXRpb25UYWJsZSA9IHRoaXMucXVhbnRpemF0aW9uVGFibGVzW2NwW2pdLnF1YW50aXphdGlvbklkeF07CiAgICAgICAgICBkZWxldGUgY3Bbal0ucXVhbnRpemF0aW9uSWR4OwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgZnJhbWUgPSBmcmFtZXNbMF07CiAgICAgIGNvbnN0IHsgY29tcG9uZW50cywgY29tcG9uZW50c09yZGVyIH0gPSBmcmFtZTsKICAgICAgY29uc3Qgb3V0Q29tcG9uZW50cyA9IFtdOwogICAgICBjb25zdCB3aWR0aCA9IGZyYW1lLnNhbXBsZXNQZXJMaW5lOwogICAgICBjb25zdCBoZWlnaHQgPSBmcmFtZS5zY2FuTGluZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbXBvbmVudHNPcmRlci5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGNvbXBvbmVudHNbY29tcG9uZW50c09yZGVyW2ldXTsKICAgICAgICBvdXRDb21wb25lbnRzLnB1c2goewogICAgICAgICAgbGluZXM6IGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSwKICAgICAgICAgIHNjYWxlWDogY29tcG9uZW50LmggLyBmcmFtZS5tYXhILAogICAgICAgICAgc2NhbGVZOiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYsCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KHdpZHRoICogaGVpZ2h0ICogb3V0Q29tcG9uZW50cy5sZW5ndGgpOwogICAgICBsZXQgb2kgPSAwOwogICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgKyt5KSB7CiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgKyt4KSB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG91dENvbXBvbmVudHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gb3V0Q29tcG9uZW50c1tpXTsKICAgICAgICAgICAgb3V0W29pXSA9IGNvbXBvbmVudC5saW5lc1swIHwgeSAqIGNvbXBvbmVudC5zY2FsZVldWzAgfCB4ICogY29tcG9uZW50LnNjYWxlWF07CiAgICAgICAgICAgICsrb2k7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgfQoKICBjbGFzcyBKcGVnRGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGNvbnN0cnVjdG9yKGZpbGVEaXJlY3RvcnkpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5yZWFkZXIgPSBuZXcgSnBlZ1N0cmVhbVJlYWRlcigpOwogICAgICBpZiAoZmlsZURpcmVjdG9yeS5KUEVHVGFibGVzKSB7CiAgICAgICAgdGhpcy5yZWFkZXIucGFyc2UoZmlsZURpcmVjdG9yeS5KUEVHVGFibGVzKTsKICAgICAgfQogICAgfQoKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICB0aGlzLnJlYWRlci5yZXNldEZyYW1lcygpOwogICAgICB0aGlzLnJlYWRlci5wYXJzZShuZXcgVWludDhBcnJheShidWZmZXIpKTsKICAgICAgcmV0dXJuIHRoaXMucmVhZGVyLmdldFJlc3VsdCgpLmJ1ZmZlcjsKICAgIH0KICB9CgogIC8qISBwYWtvIDIuMC40IGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlY2EvcGFrbyBAbGljZW5zZSAoTUlUIEFORCBabGliKSAqLwogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICAvKiBlc2xpbnQtZGlzYWJsZSBzcGFjZS11bmFyeS1vcHMgKi8KCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLy9jb25zdCBaX0ZJTFRFUkVEICAgICAgICAgID0gMTsKICAvL2NvbnN0IFpfSFVGRk1BTl9PTkxZICAgICAgPSAyOwogIC8vY29uc3QgWl9STEUgICAgICAgICAgICAgICA9IDM7CiAgY29uc3QgWl9GSVhFRCQxICAgICAgICAgICAgICAgPSA0OwogIC8vY29uc3QgWl9ERUZBVUxUX1NUUkFURUdZICA9IDA7CgogIC8qIFBvc3NpYmxlIHZhbHVlcyBvZiB0aGUgZGF0YV90eXBlIGZpZWxkICh0aG91Z2ggc2VlIGluZmxhdGUoKSkgKi8KICBjb25zdCBaX0JJTkFSWSAgICAgICAgICAgICAgPSAwOwogIGNvbnN0IFpfVEVYVCAgICAgICAgICAgICAgICA9IDE7CiAgLy9jb25zdCBaX0FTQ0lJICAgICAgICAgICAgID0gMTsgLy8gPSBaX1RFWFQKICBjb25zdCBaX1VOS05PV04kMSAgICAgICAgICAgICA9IDI7CgogIC8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKICBmdW5jdGlvbiB6ZXJvJDEoYnVmKSB7IGxldCBsZW4gPSBidWYubGVuZ3RoOyB3aGlsZSAoLS1sZW4gPj0gMCkgeyBidWZbbGVuXSA9IDA7IH0gfQoKICAvLyBGcm9tIHp1dGlsLmgKCiAgY29uc3QgU1RPUkVEX0JMT0NLID0gMDsKICBjb25zdCBTVEFUSUNfVFJFRVMgPSAxOwogIGNvbnN0IERZTl9UUkVFUyAgICA9IDI7CiAgLyogVGhlIHRocmVlIGtpbmRzIG9mIGJsb2NrIHR5cGUgKi8KCiAgY29uc3QgTUlOX01BVENIJDEgICAgPSAzOwogIGNvbnN0IE1BWF9NQVRDSCQxICAgID0gMjU4OwogIC8qIFRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIG1hdGNoIGxlbmd0aHMgKi8KCiAgLy8gRnJvbSBkZWZsYXRlLmgKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBJbnRlcm5hbCBjb21wcmVzc2lvbiBzdGF0ZS4KICAgKi8KCiAgY29uc3QgTEVOR1RIX0NPREVTJDEgID0gMjk7CiAgLyogbnVtYmVyIG9mIGxlbmd0aCBjb2Rlcywgbm90IGNvdW50aW5nIHRoZSBzcGVjaWFsIEVORF9CTE9DSyBjb2RlICovCgogIGNvbnN0IExJVEVSQUxTJDEgICAgICA9IDI1NjsKICAvKiBudW1iZXIgb2YgbGl0ZXJhbCBieXRlcyAwLi4yNTUgKi8KCiAgY29uc3QgTF9DT0RFUyQxICAgICAgID0gTElURVJBTFMkMSArIDEgKyBMRU5HVEhfQ09ERVMkMTsKICAvKiBudW1iZXIgb2YgTGl0ZXJhbCBvciBMZW5ndGggY29kZXMsIGluY2x1ZGluZyB0aGUgRU5EX0JMT0NLIGNvZGUgKi8KCiAgY29uc3QgRF9DT0RFUyQxICAgICAgID0gMzA7CiAgLyogbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGVzICovCgogIGNvbnN0IEJMX0NPREVTJDEgICAgICA9IDE5OwogIC8qIG51bWJlciBvZiBjb2RlcyB1c2VkIHRvIHRyYW5zZmVyIHRoZSBiaXQgbGVuZ3RocyAqLwoKICBjb25zdCBIRUFQX1NJWkUkMSAgICAgPSAyICogTF9DT0RFUyQxICsgMTsKICAvKiBtYXhpbXVtIGhlYXAgc2l6ZSAqLwoKICBjb25zdCBNQVhfQklUUyQxICAgICAgPSAxNTsKICAvKiBBbGwgY29kZXMgbXVzdCBub3QgZXhjZWVkIE1BWF9CSVRTIGJpdHMgKi8KCiAgY29uc3QgQnVmX3NpemUgICAgICA9IDE2OwogIC8qIHNpemUgb2YgYml0IGJ1ZmZlciBpbiBiaV9idWYgKi8KCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIENvbnN0YW50cwogICAqLwoKICBjb25zdCBNQVhfQkxfQklUUyA9IDc7CiAgLyogQml0IGxlbmd0aCBjb2RlcyBtdXN0IG5vdCBleGNlZWQgTUFYX0JMX0JJVFMgYml0cyAqLwoKICBjb25zdCBFTkRfQkxPQ0sgICA9IDI1NjsKICAvKiBlbmQgb2YgYmxvY2sgbGl0ZXJhbCBjb2RlICovCgogIGNvbnN0IFJFUF8zXzYgICAgID0gMTY7CiAgLyogcmVwZWF0IHByZXZpb3VzIGJpdCBsZW5ndGggMy02IHRpbWVzICgyIGJpdHMgb2YgcmVwZWF0IGNvdW50KSAqLwoKICBjb25zdCBSRVBaXzNfMTAgICA9IDE3OwogIC8qIHJlcGVhdCBhIHplcm8gbGVuZ3RoIDMtMTAgdGltZXMgICgzIGJpdHMgb2YgcmVwZWF0IGNvdW50KSAqLwoKICBjb25zdCBSRVBaXzExXzEzOCA9IDE4OwogIC8qIHJlcGVhdCBhIHplcm8gbGVuZ3RoIDExLTEzOCB0aW1lcyAgKDcgYml0cyBvZiByZXBlYXQgY291bnQpICovCgogIC8qIGVzbGludC1kaXNhYmxlIGNvbW1hLXNwYWNpbmcsYXJyYXktYnJhY2tldC1zcGFjaW5nICovCiAgY29uc3QgZXh0cmFfbGJpdHMgPSAgIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggbGVuZ3RoIGNvZGUgKi8KICAgIG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMSwxLDEsMSwyLDIsMiwyLDMsMywzLDMsNCw0LDQsNCw1LDUsNSw1LDBdKTsKCiAgY29uc3QgZXh0cmFfZGJpdHMgPSAgIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggZGlzdGFuY2UgY29kZSAqLwogICAgbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMSwxLDIsMiwzLDMsNCw0LDUsNSw2LDYsNyw3LDgsOCw5LDksMTAsMTAsMTEsMTEsMTIsMTIsMTMsMTNdKTsKCiAgY29uc3QgZXh0cmFfYmxiaXRzID0gIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggYml0IGxlbmd0aCBjb2RlICovCiAgICBuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyLDMsN10pOwoKICBjb25zdCBibF9vcmRlciA9CiAgICBuZXcgVWludDhBcnJheShbMTYsMTcsMTgsMCw4LDcsOSw2LDEwLDUsMTEsNCwxMiwzLDEzLDIsMTQsMSwxNV0pOwogIC8qIGVzbGludC1lbmFibGUgY29tbWEtc3BhY2luZyxhcnJheS1icmFja2V0LXNwYWNpbmcgKi8KCiAgLyogVGhlIGxlbmd0aHMgb2YgdGhlIGJpdCBsZW5ndGggY29kZXMgYXJlIHNlbnQgaW4gb3JkZXIgb2YgZGVjcmVhc2luZwogICAqIHByb2JhYmlsaXR5LCB0byBhdm9pZCB0cmFuc21pdHRpbmcgdGhlIGxlbmd0aHMgZm9yIHVudXNlZCBiaXQgbGVuZ3RoIGNvZGVzLgogICAqLwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBMb2NhbCBkYXRhLiBUaGVzZSBhcmUgaW5pdGlhbGl6ZWQgb25seSBvbmNlLgogICAqLwoKICAvLyBXZSBwcmUtZmlsbCBhcnJheXMgd2l0aCAwIHRvIGF2b2lkIHVuaW5pdGlhbGl6ZWQgZ2FwcwoKICBjb25zdCBESVNUX0NPREVfTEVOID0gNTEyOyAvKiBzZWUgZGVmaW5pdGlvbiBvZiBhcnJheSBkaXN0X2NvZGUgYmVsb3cgKi8KCiAgLy8gISEhISBVc2UgZmxhdCBhcnJheSBpbnN0ZWFkIG9mIHN0cnVjdHVyZSwgRnJlcSA9IGkqMiwgTGVuID0gaSoyKzEKICBjb25zdCBzdGF0aWNfbHRyZWUgID0gbmV3IEFycmF5KChMX0NPREVTJDEgKyAyKSAqIDIpOwogIHplcm8kMShzdGF0aWNfbHRyZWUpOwogIC8qIFRoZSBzdGF0aWMgbGl0ZXJhbCB0cmVlLiBTaW5jZSB0aGUgYml0IGxlbmd0aHMgYXJlIGltcG9zZWQsIHRoZXJlIGlzIG5vCiAgICogbmVlZCBmb3IgdGhlIExfQ09ERVMgZXh0cmEgY29kZXMgdXNlZCBkdXJpbmcgaGVhcCBjb25zdHJ1Y3Rpb24uIEhvd2V2ZXIKICAgKiBUaGUgY29kZXMgMjg2IGFuZCAyODcgYXJlIG5lZWRlZCB0byBidWlsZCBhIGNhbm9uaWNhbCB0cmVlIChzZWUgX3RyX2luaXQKICAgKiBiZWxvdykuCiAgICovCgogIGNvbnN0IHN0YXRpY19kdHJlZSAgPSBuZXcgQXJyYXkoRF9DT0RFUyQxICogMik7CiAgemVybyQxKHN0YXRpY19kdHJlZSk7CiAgLyogVGhlIHN0YXRpYyBkaXN0YW5jZSB0cmVlLiAoQWN0dWFsbHkgYSB0cml2aWFsIHRyZWUgc2luY2UgYWxsIGNvZGVzIHVzZQogICAqIDUgYml0cy4pCiAgICovCgogIGNvbnN0IF9kaXN0X2NvZGUgICAgPSBuZXcgQXJyYXkoRElTVF9DT0RFX0xFTik7CiAgemVybyQxKF9kaXN0X2NvZGUpOwogIC8qIERpc3RhbmNlIGNvZGVzLiBUaGUgZmlyc3QgMjU2IHZhbHVlcyBjb3JyZXNwb25kIHRvIHRoZSBkaXN0YW5jZXMKICAgKiAzIC4uIDI1OCwgdGhlIGxhc3QgMjU2IHZhbHVlcyBjb3JyZXNwb25kIHRvIHRoZSB0b3AgOCBiaXRzIG9mCiAgICogdGhlIDE1IGJpdCBkaXN0YW5jZXMuCiAgICovCgogIGNvbnN0IF9sZW5ndGhfY29kZSAgPSBuZXcgQXJyYXkoTUFYX01BVENIJDEgLSBNSU5fTUFUQ0gkMSArIDEpOwogIHplcm8kMShfbGVuZ3RoX2NvZGUpOwogIC8qIGxlbmd0aCBjb2RlIGZvciBlYWNoIG5vcm1hbGl6ZWQgbWF0Y2ggbGVuZ3RoICgwID09IE1JTl9NQVRDSCkgKi8KCiAgY29uc3QgYmFzZV9sZW5ndGggICA9IG5ldyBBcnJheShMRU5HVEhfQ09ERVMkMSk7CiAgemVybyQxKGJhc2VfbGVuZ3RoKTsKICAvKiBGaXJzdCBub3JtYWxpemVkIGxlbmd0aCBmb3IgZWFjaCBjb2RlICgwID0gTUlOX01BVENIKSAqLwoKICBjb25zdCBiYXNlX2Rpc3QgICAgID0gbmV3IEFycmF5KERfQ09ERVMkMSk7CiAgemVybyQxKGJhc2VfZGlzdCk7CiAgLyogRmlyc3Qgbm9ybWFsaXplZCBkaXN0YW5jZSBmb3IgZWFjaCBjb2RlICgwID0gZGlzdGFuY2Ugb2YgMSkgKi8KCgogIGZ1bmN0aW9uIFN0YXRpY1RyZWVEZXNjKHN0YXRpY190cmVlLCBleHRyYV9iaXRzLCBleHRyYV9iYXNlLCBlbGVtcywgbWF4X2xlbmd0aCkgewoKICAgIHRoaXMuc3RhdGljX3RyZWUgID0gc3RhdGljX3RyZWU7ICAvKiBzdGF0aWMgdHJlZSBvciBOVUxMICovCiAgICB0aGlzLmV4dHJhX2JpdHMgICA9IGV4dHJhX2JpdHM7ICAgLyogZXh0cmEgYml0cyBmb3IgZWFjaCBjb2RlIG9yIE5VTEwgKi8KICAgIHRoaXMuZXh0cmFfYmFzZSAgID0gZXh0cmFfYmFzZTsgICAvKiBiYXNlIGluZGV4IGZvciBleHRyYV9iaXRzICovCiAgICB0aGlzLmVsZW1zICAgICAgICA9IGVsZW1zOyAgICAgICAgLyogbWF4IG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgdHJlZSAqLwogICAgdGhpcy5tYXhfbGVuZ3RoICAgPSBtYXhfbGVuZ3RoOyAgIC8qIG1heCBiaXQgbGVuZ3RoIGZvciB0aGUgY29kZXMgKi8KCiAgICAvLyBzaG93IGlmIGBzdGF0aWNfdHJlZWAgaGFzIGRhdGEgb3IgZHVtbXkgLSBuZWVkZWQgZm9yIG1vbm9tb3JwaGljIG9iamVjdHMKICAgIHRoaXMuaGFzX3N0cmVlICAgID0gc3RhdGljX3RyZWUgJiYgc3RhdGljX3RyZWUubGVuZ3RoOwogIH0KCgogIGxldCBzdGF0aWNfbF9kZXNjOwogIGxldCBzdGF0aWNfZF9kZXNjOwogIGxldCBzdGF0aWNfYmxfZGVzYzsKCgogIGZ1bmN0aW9uIFRyZWVEZXNjKGR5bl90cmVlLCBzdGF0X2Rlc2MpIHsKICAgIHRoaXMuZHluX3RyZWUgPSBkeW5fdHJlZTsgICAgIC8qIHRoZSBkeW5hbWljIHRyZWUgKi8KICAgIHRoaXMubWF4X2NvZGUgPSAwOyAgICAgICAgICAgIC8qIGxhcmdlc3QgY29kZSB3aXRoIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogICAgdGhpcy5zdGF0X2Rlc2MgPSBzdGF0X2Rlc2M7ICAgLyogdGhlIGNvcnJlc3BvbmRpbmcgc3RhdGljIHRyZWUgKi8KICB9CgoKCiAgY29uc3QgZF9jb2RlID0gKGRpc3QpID0+IHsKCiAgICByZXR1cm4gZGlzdCA8IDI1NiA/IF9kaXN0X2NvZGVbZGlzdF0gOiBfZGlzdF9jb2RlWzI1NiArIChkaXN0ID4+PiA3KV07CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIE91dHB1dCBhIHNob3J0IExTQiBmaXJzdCBvbiB0aGUgc3RyZWFtLgogICAqIElOIGFzc2VydGlvbjogdGhlcmUgaXMgZW5vdWdoIHJvb20gaW4gcGVuZGluZ0J1Zi4KICAgKi8KICBjb25zdCBwdXRfc2hvcnQgPSAocywgdykgPT4gewogIC8vICAgIHB1dF9ieXRlKHMsICh1Y2gpKCh3KSAmIDB4ZmYpKTsKICAvLyAgICBwdXRfYnl0ZShzLCAodWNoKSgodXNoKSh3KSA+PiA4KSk7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9ICh3KSAmIDB4ZmY7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9ICh3ID4+PiA4KSAmIDB4ZmY7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSB2YWx1ZSBvbiBhIGdpdmVuIG51bWJlciBvZiBiaXRzLgogICAqIElOIGFzc2VydGlvbjogbGVuZ3RoIDw9IDE2IGFuZCB2YWx1ZSBmaXRzIGluIGxlbmd0aCBiaXRzLgogICAqLwogIGNvbnN0IHNlbmRfYml0cyA9IChzLCB2YWx1ZSwgbGVuZ3RoKSA9PiB7CgogICAgaWYgKHMuYmlfdmFsaWQgPiAoQnVmX3NpemUgLSBsZW5ndGgpKSB7CiAgICAgIHMuYmlfYnVmIHw9ICh2YWx1ZSA8PCBzLmJpX3ZhbGlkKSAmIDB4ZmZmZjsKICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgICAgcy5iaV9idWYgPSB2YWx1ZSA+PiAoQnVmX3NpemUgLSBzLmJpX3ZhbGlkKTsKICAgICAgcy5iaV92YWxpZCArPSBsZW5ndGggLSBCdWZfc2l6ZTsKICAgIH0gZWxzZSB7CiAgICAgIHMuYmlfYnVmIHw9ICh2YWx1ZSA8PCBzLmJpX3ZhbGlkKSAmIDB4ZmZmZjsKICAgICAgcy5iaV92YWxpZCArPSBsZW5ndGg7CiAgICB9CiAgfTsKCgogIGNvbnN0IHNlbmRfY29kZSA9IChzLCBjLCB0cmVlKSA9PiB7CgogICAgc2VuZF9iaXRzKHMsIHRyZWVbYyAqIDJdLyouQ29kZSovLCB0cmVlW2MgKiAyICsgMV0vKi5MZW4qLyk7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFJldmVyc2UgdGhlIGZpcnN0IGxlbiBiaXRzIG9mIGEgY29kZSwgdXNpbmcgc3RyYWlnaHRmb3J3YXJkIGNvZGUgKGEgZmFzdGVyCiAgICogbWV0aG9kIHdvdWxkIHVzZSBhIHRhYmxlKQogICAqIElOIGFzc2VydGlvbjogMSA8PSBsZW4gPD0gMTUKICAgKi8KICBjb25zdCBiaV9yZXZlcnNlID0gKGNvZGUsIGxlbikgPT4gewoKICAgIGxldCByZXMgPSAwOwogICAgZG8gewogICAgICByZXMgfD0gY29kZSAmIDE7CiAgICAgIGNvZGUgPj4+PSAxOwogICAgICByZXMgPDw9IDE7CiAgICB9IHdoaWxlICgtLWxlbiA+IDApOwogICAgcmV0dXJuIHJlcyA+Pj4gMTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogRmx1c2ggdGhlIGJpdCBidWZmZXIsIGtlZXBpbmcgYXQgbW9zdCA3IGJpdHMgaW4gaXQuCiAgICovCiAgY29uc3QgYmlfZmx1c2ggPSAocykgPT4gewoKICAgIGlmIChzLmJpX3ZhbGlkID09PSAxNikgewogICAgICBwdXRfc2hvcnQocywgcy5iaV9idWYpOwogICAgICBzLmJpX2J1ZiA9IDA7CiAgICAgIHMuYmlfdmFsaWQgPSAwOwoKICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+PSA4KSB7CiAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gcy5iaV9idWYgJiAweGZmOwogICAgICBzLmJpX2J1ZiA+Pj0gODsKICAgICAgcy5iaV92YWxpZCAtPSA4OwogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb21wdXRlIHRoZSBvcHRpbWFsIGJpdCBsZW5ndGhzIGZvciBhIHRyZWUgYW5kIHVwZGF0ZSB0aGUgdG90YWwgYml0IGxlbmd0aAogICAqIGZvciB0aGUgY3VycmVudCBibG9jay4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBmaWVsZHMgZnJlcSBhbmQgZGFkIGFyZSBzZXQsIGhlYXBbaGVhcF9tYXhdIGFuZAogICAqICAgIGFib3ZlIGFyZSB0aGUgdHJlZSBub2RlcyBzb3J0ZWQgYnkgaW5jcmVhc2luZyBmcmVxdWVuY3kuCiAgICogT1VUIGFzc2VydGlvbnM6IHRoZSBmaWVsZCBsZW4gaXMgc2V0IHRvIHRoZSBvcHRpbWFsIGJpdCBsZW5ndGgsIHRoZQogICAqICAgICBhcnJheSBibF9jb3VudCBjb250YWlucyB0aGUgZnJlcXVlbmNpZXMgZm9yIGVhY2ggYml0IGxlbmd0aC4KICAgKiAgICAgVGhlIGxlbmd0aCBvcHRfbGVuIGlzIHVwZGF0ZWQ7IHN0YXRpY19sZW4gaXMgYWxzbyB1cGRhdGVkIGlmIHN0cmVlIGlzCiAgICogICAgIG5vdCBudWxsLgogICAqLwogIGNvbnN0IGdlbl9iaXRsZW4gPSAocywgZGVzYykgPT4KICAvLyAgICBkZWZsYXRlX3N0YXRlICpzOwogIC8vICAgIHRyZWVfZGVzYyAqZGVzYzsgICAgLyogdGhlIHRyZWUgZGVzY3JpcHRvciAqLwogIHsKICAgIGNvbnN0IHRyZWUgICAgICAgICAgICA9IGRlc2MuZHluX3RyZWU7CiAgICBjb25zdCBtYXhfY29kZSAgICAgICAgPSBkZXNjLm1heF9jb2RlOwogICAgY29uc3Qgc3RyZWUgICAgICAgICAgID0gZGVzYy5zdGF0X2Rlc2Muc3RhdGljX3RyZWU7CiAgICBjb25zdCBoYXNfc3RyZWUgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5oYXNfc3RyZWU7CiAgICBjb25zdCBleHRyYSAgICAgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5leHRyYV9iaXRzOwogICAgY29uc3QgYmFzZSAgICAgICAgICAgID0gZGVzYy5zdGF0X2Rlc2MuZXh0cmFfYmFzZTsKICAgIGNvbnN0IG1heF9sZW5ndGggICAgICA9IGRlc2Muc3RhdF9kZXNjLm1heF9sZW5ndGg7CiAgICBsZXQgaDsgICAgICAgICAgICAgIC8qIGhlYXAgaW5kZXggKi8KICAgIGxldCBuLCBtOyAgICAgICAgICAgLyogaXRlcmF0ZSBvdmVyIHRoZSB0cmVlIGVsZW1lbnRzICovCiAgICBsZXQgYml0czsgICAgICAgICAgIC8qIGJpdCBsZW5ndGggKi8KICAgIGxldCB4Yml0czsgICAgICAgICAgLyogZXh0cmEgYml0cyAqLwogICAgbGV0IGY7ICAgICAgICAgICAgICAvKiBmcmVxdWVuY3kgKi8KICAgIGxldCBvdmVyZmxvdyA9IDA7ICAgLyogbnVtYmVyIG9mIGVsZW1lbnRzIHdpdGggYml0IGxlbmd0aCB0b28gbGFyZ2UgKi8KCiAgICBmb3IgKGJpdHMgPSAwOyBiaXRzIDw9IE1BWF9CSVRTJDE7IGJpdHMrKykgewogICAgICBzLmJsX2NvdW50W2JpdHNdID0gMDsKICAgIH0KCiAgICAvKiBJbiBhIGZpcnN0IHBhc3MsIGNvbXB1dGUgdGhlIG9wdGltYWwgYml0IGxlbmd0aHMgKHdoaWNoIG1heQogICAgICogb3ZlcmZsb3cgaW4gdGhlIGNhc2Ugb2YgdGhlIGJpdCBsZW5ndGggdHJlZSkuCiAgICAgKi8KICAgIHRyZWVbcy5oZWFwW3MuaGVhcF9tYXhdICogMiArIDFdLyouTGVuKi8gPSAwOyAvKiByb290IG9mIHRoZSBoZWFwICovCgogICAgZm9yIChoID0gcy5oZWFwX21heCArIDE7IGggPCBIRUFQX1NJWkUkMTsgaCsrKSB7CiAgICAgIG4gPSBzLmhlYXBbaF07CiAgICAgIGJpdHMgPSB0cmVlW3RyZWVbbiAqIDIgKyAxXS8qLkRhZCovICogMiArIDFdLyouTGVuKi8gKyAxOwogICAgICBpZiAoYml0cyA+IG1heF9sZW5ndGgpIHsKICAgICAgICBiaXRzID0gbWF4X2xlbmd0aDsKICAgICAgICBvdmVyZmxvdysrOwogICAgICB9CiAgICAgIHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gYml0czsKICAgICAgLyogV2Ugb3ZlcndyaXRlIHRyZWVbbl0uRGFkIHdoaWNoIGlzIG5vIGxvbmdlciBuZWVkZWQgKi8KCiAgICAgIGlmIChuID4gbWF4X2NvZGUpIHsgY29udGludWU7IH0gLyogbm90IGEgbGVhZiBub2RlICovCgogICAgICBzLmJsX2NvdW50W2JpdHNdKys7CiAgICAgIHhiaXRzID0gMDsKICAgICAgaWYgKG4gPj0gYmFzZSkgewogICAgICAgIHhiaXRzID0gZXh0cmFbbiAtIGJhc2VdOwogICAgICB9CiAgICAgIGYgPSB0cmVlW24gKiAyXS8qLkZyZXEqLzsKICAgICAgcy5vcHRfbGVuICs9IGYgKiAoYml0cyArIHhiaXRzKTsKICAgICAgaWYgKGhhc19zdHJlZSkgewogICAgICAgIHMuc3RhdGljX2xlbiArPSBmICogKHN0cmVlW24gKiAyICsgMV0vKi5MZW4qLyArIHhiaXRzKTsKICAgICAgfQogICAgfQogICAgaWYgKG92ZXJmbG93ID09PSAwKSB7IHJldHVybjsgfQoKICAgIC8vIFRyYWNlKChzdGRlcnIsIlxuYml0IGxlbmd0aCBvdmVyZmxvd1xuIikpOwogICAgLyogVGhpcyBoYXBwZW5zIGZvciBleGFtcGxlIG9uIG9iajIgYW5kIHBpYyBvZiB0aGUgQ2FsZ2FyeSBjb3JwdXMgKi8KCiAgICAvKiBGaW5kIHRoZSBmaXJzdCBiaXQgbGVuZ3RoIHdoaWNoIGNvdWxkIGluY3JlYXNlOiAqLwogICAgZG8gewogICAgICBiaXRzID0gbWF4X2xlbmd0aCAtIDE7CiAgICAgIHdoaWxlIChzLmJsX2NvdW50W2JpdHNdID09PSAwKSB7IGJpdHMtLTsgfQogICAgICBzLmJsX2NvdW50W2JpdHNdLS07ICAgICAgLyogbW92ZSBvbmUgbGVhZiBkb3duIHRoZSB0cmVlICovCiAgICAgIHMuYmxfY291bnRbYml0cyArIDFdICs9IDI7IC8qIG1vdmUgb25lIG92ZXJmbG93IGl0ZW0gYXMgaXRzIGJyb3RoZXIgKi8KICAgICAgcy5ibF9jb3VudFttYXhfbGVuZ3RoXS0tOwogICAgICAvKiBUaGUgYnJvdGhlciBvZiB0aGUgb3ZlcmZsb3cgaXRlbSBhbHNvIG1vdmVzIG9uZSBzdGVwIHVwLAogICAgICAgKiBidXQgdGhpcyBkb2VzIG5vdCBhZmZlY3QgYmxfY291bnRbbWF4X2xlbmd0aF0KICAgICAgICovCiAgICAgIG92ZXJmbG93IC09IDI7CiAgICB9IHdoaWxlIChvdmVyZmxvdyA+IDApOwoKICAgIC8qIE5vdyByZWNvbXB1dGUgYWxsIGJpdCBsZW5ndGhzLCBzY2FubmluZyBpbiBpbmNyZWFzaW5nIGZyZXF1ZW5jeS4KICAgICAqIGggaXMgc3RpbGwgZXF1YWwgdG8gSEVBUF9TSVpFLiAoSXQgaXMgc2ltcGxlciB0byByZWNvbnN0cnVjdCBhbGwKICAgICAqIGxlbmd0aHMgaW5zdGVhZCBvZiBmaXhpbmcgb25seSB0aGUgd3Jvbmcgb25lcy4gVGhpcyBpZGVhIGlzIHRha2VuCiAgICAgKiBmcm9tICdhcicgd3JpdHRlbiBieSBIYXJ1aGlrbyBPa3VtdXJhLikKICAgICAqLwogICAgZm9yIChiaXRzID0gbWF4X2xlbmd0aDsgYml0cyAhPT0gMDsgYml0cy0tKSB7CiAgICAgIG4gPSBzLmJsX2NvdW50W2JpdHNdOwogICAgICB3aGlsZSAobiAhPT0gMCkgewogICAgICAgIG0gPSBzLmhlYXBbLS1oXTsKICAgICAgICBpZiAobSA+IG1heF9jb2RlKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgaWYgKHRyZWVbbSAqIDIgKyAxXS8qLkxlbiovICE9PSBiaXRzKSB7CiAgICAgICAgICAvLyBUcmFjZSgoc3RkZXJyLCJjb2RlICVkIGJpdHMgJWQtPiVkXG4iLCBtLCB0cmVlW21dLkxlbiwgYml0cykpOwogICAgICAgICAgcy5vcHRfbGVuICs9IChiaXRzIC0gdHJlZVttICogMiArIDFdLyouTGVuKi8pICogdHJlZVttICogMl0vKi5GcmVxKi87CiAgICAgICAgICB0cmVlW20gKiAyICsgMV0vKi5MZW4qLyA9IGJpdHM7CiAgICAgICAgfQogICAgICAgIG4tLTsKICAgICAgfQogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBHZW5lcmF0ZSB0aGUgY29kZXMgZm9yIGEgZ2l2ZW4gdHJlZSBhbmQgYml0IGNvdW50cyAod2hpY2ggbmVlZCBub3QgYmUKICAgKiBvcHRpbWFsKS4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBhcnJheSBibF9jb3VudCBjb250YWlucyB0aGUgYml0IGxlbmd0aCBzdGF0aXN0aWNzIGZvcgogICAqIHRoZSBnaXZlbiB0cmVlIGFuZCB0aGUgZmllbGQgbGVuIGlzIHNldCBmb3IgYWxsIHRyZWUgZWxlbWVudHMuCiAgICogT1VUIGFzc2VydGlvbjogdGhlIGZpZWxkIGNvZGUgaXMgc2V0IGZvciBhbGwgdHJlZSBlbGVtZW50cyBvZiBub24KICAgKiAgICAgemVybyBjb2RlIGxlbmd0aC4KICAgKi8KICBjb25zdCBnZW5fY29kZXMgPSAodHJlZSwgbWF4X2NvZGUsIGJsX2NvdW50KSA9PgogIC8vICAgIGN0X2RhdGEgKnRyZWU7ICAgICAgICAgICAgIC8qIHRoZSB0cmVlIHRvIGRlY29yYXRlICovCiAgLy8gICAgaW50IG1heF9jb2RlOyAgICAgICAgICAgICAgLyogbGFyZ2VzdCBjb2RlIHdpdGggbm9uIHplcm8gZnJlcXVlbmN5ICovCiAgLy8gICAgdXNoZiAqYmxfY291bnQ7ICAgICAgICAgICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCAqLwogIHsKICAgIGNvbnN0IG5leHRfY29kZSA9IG5ldyBBcnJheShNQVhfQklUUyQxICsgMSk7IC8qIG5leHQgY29kZSB2YWx1ZSBmb3IgZWFjaCBiaXQgbGVuZ3RoICovCiAgICBsZXQgY29kZSA9IDA7ICAgICAgICAgICAgICAvKiBydW5uaW5nIGNvZGUgdmFsdWUgKi8KICAgIGxldCBiaXRzOyAgICAgICAgICAgICAgICAgIC8qIGJpdCBpbmRleCAqLwogICAgbGV0IG47ICAgICAgICAgICAgICAgICAgICAgLyogY29kZSBpbmRleCAqLwoKICAgIC8qIFRoZSBkaXN0cmlidXRpb24gY291bnRzIGFyZSBmaXJzdCB1c2VkIHRvIGdlbmVyYXRlIHRoZSBjb2RlIHZhbHVlcwogICAgICogd2l0aG91dCBiaXQgcmV2ZXJzYWwuCiAgICAgKi8KICAgIGZvciAoYml0cyA9IDE7IGJpdHMgPD0gTUFYX0JJVFMkMTsgYml0cysrKSB7CiAgICAgIG5leHRfY29kZVtiaXRzXSA9IGNvZGUgPSAoY29kZSArIGJsX2NvdW50W2JpdHMgLSAxXSkgPDwgMTsKICAgIH0KICAgIC8qIENoZWNrIHRoYXQgdGhlIGJpdCBjb3VudHMgaW4gYmxfY291bnQgYXJlIGNvbnNpc3RlbnQuIFRoZSBsYXN0IGNvZGUKICAgICAqIG11c3QgYmUgYWxsIG9uZXMuCiAgICAgKi8KICAgIC8vQXNzZXJ0IChjb2RlICsgYmxfY291bnRbTUFYX0JJVFNdLTEgPT0gKDE8PE1BWF9CSVRTKS0xLAogICAgLy8gICAgICAgICJpbmNvbnNpc3RlbnQgYml0IGNvdW50cyIpOwogICAgLy9UcmFjZXYoKHN0ZGVyciwiXG5nZW5fY29kZXM6IG1heF9jb2RlICVkICIsIG1heF9jb2RlKSk7CgogICAgZm9yIChuID0gMDsgIG4gPD0gbWF4X2NvZGU7IG4rKykgewogICAgICBsZXQgbGVuID0gdHJlZVtuICogMiArIDFdLyouTGVuKi87CiAgICAgIGlmIChsZW4gPT09IDApIHsgY29udGludWU7IH0KICAgICAgLyogTm93IHJldmVyc2UgdGhlIGJpdHMgKi8KICAgICAgdHJlZVtuICogMl0vKi5Db2RlKi8gPSBiaV9yZXZlcnNlKG5leHRfY29kZVtsZW5dKyssIGxlbik7CgogICAgICAvL1RyYWNlY3YodHJlZSAhPSBzdGF0aWNfbHRyZWUsIChzdGRlcnIsIlxubiAlM2QgJWMgbCAlMmQgYyAlNHggKCV4KSAiLAogICAgICAvLyAgICAgbiwgKGlzZ3JhcGgobikgPyBuIDogJyAnKSwgbGVuLCB0cmVlW25dLkNvZGUsIG5leHRfY29kZVtsZW5dLTEpKTsKICAgIH0KICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogSW5pdGlhbGl6ZSB0aGUgdmFyaW91cyAnY29uc3RhbnQnIHRhYmxlcy4KICAgKi8KICBjb25zdCB0cl9zdGF0aWNfaW5pdCA9ICgpID0+IHsKCiAgICBsZXQgbjsgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgdHJlZSBlbGVtZW50cyAqLwogICAgbGV0IGJpdHM7ICAgICAvKiBiaXQgY291bnRlciAqLwogICAgbGV0IGxlbmd0aDsgICAvKiBsZW5ndGggdmFsdWUgKi8KICAgIGxldCBjb2RlOyAgICAgLyogY29kZSB2YWx1ZSAqLwogICAgbGV0IGRpc3Q7ICAgICAvKiBkaXN0YW5jZSBpbmRleCAqLwogICAgY29uc3QgYmxfY291bnQgPSBuZXcgQXJyYXkoTUFYX0JJVFMkMSArIDEpOwogICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCBmb3IgYW4gb3B0aW1hbCB0cmVlICovCgogICAgLy8gZG8gY2hlY2sgaW4gX3RyX2luaXQoKQogICAgLy9pZiAoc3RhdGljX2luaXRfZG9uZSkgcmV0dXJuOwoKICAgIC8qIEZvciBzb21lIGVtYmVkZGVkIHRhcmdldHMsIGdsb2JhbCB2YXJpYWJsZXMgYXJlIG5vdCBpbml0aWFsaXplZDogKi8KICAvKiNpZmRlZiBOT19JTklUX0dMT0JBTF9QT0lOVEVSUwogICAgc3RhdGljX2xfZGVzYy5zdGF0aWNfdHJlZSA9IHN0YXRpY19sdHJlZTsKICAgIHN0YXRpY19sX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2xiaXRzOwogICAgc3RhdGljX2RfZGVzYy5zdGF0aWNfdHJlZSA9IHN0YXRpY19kdHJlZTsKICAgIHN0YXRpY19kX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2RiaXRzOwogICAgc3RhdGljX2JsX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2JsYml0czsKICAjZW5kaWYqLwoKICAgIC8qIEluaXRpYWxpemUgdGhlIG1hcHBpbmcgbGVuZ3RoICgwLi4yNTUpIC0+IGxlbmd0aCBjb2RlICgwLi4yOCkgKi8KICAgIGxlbmd0aCA9IDA7CiAgICBmb3IgKGNvZGUgPSAwOyBjb2RlIDwgTEVOR1RIX0NPREVTJDEgLSAxOyBjb2RlKyspIHsKICAgICAgYmFzZV9sZW5ndGhbY29kZV0gPSBsZW5ndGg7CiAgICAgIGZvciAobiA9IDA7IG4gPCAoMSA8PCBleHRyYV9sYml0c1tjb2RlXSk7IG4rKykgewogICAgICAgIF9sZW5ndGhfY29kZVtsZW5ndGgrK10gPSBjb2RlOwogICAgICB9CiAgICB9CiAgICAvL0Fzc2VydCAobGVuZ3RoID09IDI1NiwgInRyX3N0YXRpY19pbml0OiBsZW5ndGggIT0gMjU2Iik7CiAgICAvKiBOb3RlIHRoYXQgdGhlIGxlbmd0aCAyNTUgKG1hdGNoIGxlbmd0aCAyNTgpIGNhbiBiZSByZXByZXNlbnRlZAogICAgICogaW4gdHdvIGRpZmZlcmVudCB3YXlzOiBjb2RlIDI4NCArIDUgYml0cyBvciBjb2RlIDI4NSwgc28gd2UKICAgICAqIG92ZXJ3cml0ZSBsZW5ndGhfY29kZVsyNTVdIHRvIHVzZSB0aGUgYmVzdCBlbmNvZGluZzoKICAgICAqLwogICAgX2xlbmd0aF9jb2RlW2xlbmd0aCAtIDFdID0gY29kZTsKCiAgICAvKiBJbml0aWFsaXplIHRoZSBtYXBwaW5nIGRpc3QgKDAuLjMySykgLT4gZGlzdCBjb2RlICgwLi4yOSkgKi8KICAgIGRpc3QgPSAwOwogICAgZm9yIChjb2RlID0gMDsgY29kZSA8IDE2OyBjb2RlKyspIHsKICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdDsKICAgICAgZm9yIChuID0gMDsgbiA8ICgxIDw8IGV4dHJhX2RiaXRzW2NvZGVdKTsgbisrKSB7CiAgICAgICAgX2Rpc3RfY29kZVtkaXN0KytdID0gY29kZTsKICAgICAgfQogICAgfQogICAgLy9Bc3NlcnQgKGRpc3QgPT0gMjU2LCAidHJfc3RhdGljX2luaXQ6IGRpc3QgIT0gMjU2Iik7CiAgICBkaXN0ID4+PSA3OyAvKiBmcm9tIG5vdyBvbiwgYWxsIGRpc3RhbmNlcyBhcmUgZGl2aWRlZCBieSAxMjggKi8KICAgIGZvciAoOyBjb2RlIDwgRF9DT0RFUyQxOyBjb2RlKyspIHsKICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdCA8PCA3OwogICAgICBmb3IgKG4gPSAwOyBuIDwgKDEgPDwgKGV4dHJhX2RiaXRzW2NvZGVdIC0gNykpOyBuKyspIHsKICAgICAgICBfZGlzdF9jb2RlWzI1NiArIGRpc3QrK10gPSBjb2RlOwogICAgICB9CiAgICB9CiAgICAvL0Fzc2VydCAoZGlzdCA9PSAyNTYsICJ0cl9zdGF0aWNfaW5pdDogMjU2K2Rpc3QgIT0gNTEyIik7CgogICAgLyogQ29uc3RydWN0IHRoZSBjb2RlcyBvZiB0aGUgc3RhdGljIGxpdGVyYWwgdHJlZSAqLwogICAgZm9yIChiaXRzID0gMDsgYml0cyA8PSBNQVhfQklUUyQxOyBiaXRzKyspIHsKICAgICAgYmxfY291bnRbYml0c10gPSAwOwogICAgfQoKICAgIG4gPSAwOwogICAgd2hpbGUgKG4gPD0gMTQzKSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA4OwogICAgICBuKys7CiAgICAgIGJsX2NvdW50WzhdKys7CiAgICB9CiAgICB3aGlsZSAobiA8PSAyNTUpIHsKICAgICAgc3RhdGljX2x0cmVlW24gKiAyICsgMV0vKi5MZW4qLyA9IDk7CiAgICAgIG4rKzsKICAgICAgYmxfY291bnRbOV0rKzsKICAgIH0KICAgIHdoaWxlIChuIDw9IDI3OSkgewogICAgICBzdGF0aWNfbHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gNzsKICAgICAgbisrOwogICAgICBibF9jb3VudFs3XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjg3KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA4OwogICAgICBuKys7CiAgICAgIGJsX2NvdW50WzhdKys7CiAgICB9CiAgICAvKiBDb2RlcyAyODYgYW5kIDI4NyBkbyBub3QgZXhpc3QsIGJ1dCB3ZSBtdXN0IGluY2x1ZGUgdGhlbSBpbiB0aGUKICAgICAqIHRyZWUgY29uc3RydWN0aW9uIHRvIGdldCBhIGNhbm9uaWNhbCBIdWZmbWFuIHRyZWUgKGxvbmdlc3QgY29kZQogICAgICogYWxsIG9uZXMpCiAgICAgKi8KICAgIGdlbl9jb2RlcyhzdGF0aWNfbHRyZWUsIExfQ09ERVMkMSArIDEsIGJsX2NvdW50KTsKCiAgICAvKiBUaGUgc3RhdGljIGRpc3RhbmNlIHRyZWUgaXMgdHJpdmlhbDogKi8KICAgIGZvciAobiA9IDA7IG4gPCBEX0NPREVTJDE7IG4rKykgewogICAgICBzdGF0aWNfZHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gNTsKICAgICAgc3RhdGljX2R0cmVlW24gKiAyXS8qLkNvZGUqLyA9IGJpX3JldmVyc2UobiwgNSk7CiAgICB9CgogICAgLy8gTm93IGRhdGEgcmVhZHkgYW5kIHdlIGNhbiBpbml0IHN0YXRpYyB0cmVlcwogICAgc3RhdGljX2xfZGVzYyA9IG5ldyBTdGF0aWNUcmVlRGVzYyhzdGF0aWNfbHRyZWUsIGV4dHJhX2xiaXRzLCBMSVRFUkFMUyQxICsgMSwgTF9DT0RFUyQxLCBNQVhfQklUUyQxKTsKICAgIHN0YXRpY19kX2Rlc2MgPSBuZXcgU3RhdGljVHJlZURlc2Moc3RhdGljX2R0cmVlLCBleHRyYV9kYml0cywgMCwgICAgICAgICAgRF9DT0RFUyQxLCBNQVhfQklUUyQxKTsKICAgIHN0YXRpY19ibF9kZXNjID0gbmV3IFN0YXRpY1RyZWVEZXNjKG5ldyBBcnJheSgwKSwgZXh0cmFfYmxiaXRzLCAwLCAgICAgICAgIEJMX0NPREVTJDEsIE1BWF9CTF9CSVRTKTsKCiAgICAvL3N0YXRpY19pbml0X2RvbmUgPSB0cnVlOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBJbml0aWFsaXplIGEgbmV3IGJsb2NrLgogICAqLwogIGNvbnN0IGluaXRfYmxvY2sgPSAocykgPT4gewoKICAgIGxldCBuOyAvKiBpdGVyYXRlcyBvdmVyIHRyZWUgZWxlbWVudHMgKi8KCiAgICAvKiBJbml0aWFsaXplIHRoZSB0cmVlcy4gKi8KICAgIGZvciAobiA9IDA7IG4gPCBMX0NPREVTJDE7ICBuKyspIHsgcy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovID0gMDsgfQogICAgZm9yIChuID0gMDsgbiA8IERfQ09ERVMkMTsgIG4rKykgeyBzLmR5bl9kdHJlZVtuICogMl0vKi5GcmVxKi8gPSAwOyB9CiAgICBmb3IgKG4gPSAwOyBuIDwgQkxfQ09ERVMkMTsgbisrKSB7IHMuYmxfdHJlZVtuICogMl0vKi5GcmVxKi8gPSAwOyB9CgogICAgcy5keW5fbHRyZWVbRU5EX0JMT0NLICogMl0vKi5GcmVxKi8gPSAxOwogICAgcy5vcHRfbGVuID0gcy5zdGF0aWNfbGVuID0gMDsKICAgIHMubGFzdF9saXQgPSBzLm1hdGNoZXMgPSAwOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGbHVzaCB0aGUgYml0IGJ1ZmZlciBhbmQgYWxpZ24gdGhlIG91dHB1dCBvbiBhIGJ5dGUgYm91bmRhcnkKICAgKi8KICBjb25zdCBiaV93aW5kdXAgPSAocykgPT4KICB7CiAgICBpZiAocy5iaV92YWxpZCA+IDgpIHsKICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+IDApIHsKICAgICAgLy9wdXRfYnl0ZShzLCAoQnl0ZSlzLT5iaV9idWYpOwogICAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHMuYmlfYnVmOwogICAgfQogICAgcy5iaV9idWYgPSAwOwogICAgcy5iaV92YWxpZCA9IDA7CiAgfTsKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogQ29weSBhIHN0b3JlZCBibG9jaywgc3RvcmluZyBmaXJzdCB0aGUgbGVuZ3RoIGFuZCBpdHMKICAgKiBvbmUncyBjb21wbGVtZW50IGlmIHJlcXVlc3RlZC4KICAgKi8KICBjb25zdCBjb3B5X2Jsb2NrID0gKHMsIGJ1ZiwgbGVuLCBoZWFkZXIpID0+CiAgLy9EZWZsYXRlU3RhdGUgKnM7CiAgLy9jaGFyZiAgICAqYnVmOyAgICAvKiB0aGUgaW5wdXQgZGF0YSAqLwogIC8vdW5zaWduZWQgbGVuOyAgICAgLyogaXRzIGxlbmd0aCAqLwogIC8vaW50ICAgICAgaGVhZGVyOyAgLyogdHJ1ZSBpZiBibG9jayBoZWFkZXIgbXVzdCBiZSB3cml0dGVuICovCiAgewogICAgYmlfd2luZHVwKHMpOyAgICAgICAgLyogYWxpZ24gb24gYnl0ZSBib3VuZGFyeSAqLwoKICAgIGlmIChoZWFkZXIpIHsKICAgICAgcHV0X3Nob3J0KHMsIGxlbik7CiAgICAgIHB1dF9zaG9ydChzLCB+bGVuKTsKICAgIH0KICAvLyAgd2hpbGUgKGxlbi0tKSB7CiAgLy8gICAgcHV0X2J5dGUocywgKmJ1ZisrKTsKICAvLyAgfQogICAgcy5wZW5kaW5nX2J1Zi5zZXQocy53aW5kb3cuc3ViYXJyYXkoYnVmLCBidWYgKyBsZW4pLCBzLnBlbmRpbmcpOwogICAgcy5wZW5kaW5nICs9IGxlbjsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb21wYXJlcyB0byBzdWJ0cmVlcywgdXNpbmcgdGhlIHRyZWUgZGVwdGggYXMgdGllIGJyZWFrZXIgd2hlbgogICAqIHRoZSBzdWJ0cmVlcyBoYXZlIGVxdWFsIGZyZXF1ZW5jeS4gVGhpcyBtaW5pbWl6ZXMgdGhlIHdvcnN0IGNhc2UgbGVuZ3RoLgogICAqLwogIGNvbnN0IHNtYWxsZXIgPSAodHJlZSwgbiwgbSwgZGVwdGgpID0+IHsKCiAgICBjb25zdCBfbjIgPSBuICogMjsKICAgIGNvbnN0IF9tMiA9IG0gKiAyOwogICAgcmV0dXJuICh0cmVlW19uMl0vKi5GcmVxKi8gPCB0cmVlW19tMl0vKi5GcmVxKi8gfHwKICAgICAgICAgICAodHJlZVtfbjJdLyouRnJlcSovID09PSB0cmVlW19tMl0vKi5GcmVxKi8gJiYgZGVwdGhbbl0gPD0gZGVwdGhbbV0pKTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBSZXN0b3JlIHRoZSBoZWFwIHByb3BlcnR5IGJ5IG1vdmluZyBkb3duIHRoZSB0cmVlIHN0YXJ0aW5nIGF0IG5vZGUgaywKICAgKiBleGNoYW5naW5nIGEgbm9kZSB3aXRoIHRoZSBzbWFsbGVzdCBvZiBpdHMgdHdvIHNvbnMgaWYgbmVjZXNzYXJ5LCBzdG9wcGluZwogICAqIHdoZW4gdGhlIGhlYXAgcHJvcGVydHkgaXMgcmUtZXN0YWJsaXNoZWQgKGVhY2ggZmF0aGVyIHNtYWxsZXIgdGhhbiBpdHMKICAgKiB0d28gc29ucykuCiAgICovCiAgY29uc3QgcHFkb3duaGVhcCA9IChzLCB0cmVlLCBrKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgY3RfZGF0YSAqdHJlZTsgIC8qIHRoZSB0cmVlIHRvIHJlc3RvcmUgKi8KICAvLyAgICBpbnQgazsgICAgICAgICAgICAgICAvKiBub2RlIHRvIG1vdmUgZG93biAqLwogIHsKICAgIGNvbnN0IHYgPSBzLmhlYXBba107CiAgICBsZXQgaiA9IGsgPDwgMTsgIC8qIGxlZnQgc29uIG9mIGsgKi8KICAgIHdoaWxlIChqIDw9IHMuaGVhcF9sZW4pIHsKICAgICAgLyogU2V0IGogdG8gdGhlIHNtYWxsZXN0IG9mIHRoZSB0d28gc29uczogKi8KICAgICAgaWYgKGogPCBzLmhlYXBfbGVuICYmCiAgICAgICAgc21hbGxlcih0cmVlLCBzLmhlYXBbaiArIDFdLCBzLmhlYXBbal0sIHMuZGVwdGgpKSB7CiAgICAgICAgaisrOwogICAgICB9CiAgICAgIC8qIEV4aXQgaWYgdiBpcyBzbWFsbGVyIHRoYW4gYm90aCBzb25zICovCiAgICAgIGlmIChzbWFsbGVyKHRyZWUsIHYsIHMuaGVhcFtqXSwgcy5kZXB0aCkpIHsgYnJlYWs7IH0KCiAgICAgIC8qIEV4Y2hhbmdlIHYgd2l0aCB0aGUgc21hbGxlc3Qgc29uICovCiAgICAgIHMuaGVhcFtrXSA9IHMuaGVhcFtqXTsKICAgICAgayA9IGo7CgogICAgICAvKiBBbmQgY29udGludWUgZG93biB0aGUgdHJlZSwgc2V0dGluZyBqIHRvIHRoZSBsZWZ0IHNvbiBvZiBrICovCiAgICAgIGogPDw9IDE7CiAgICB9CiAgICBzLmhlYXBba10gPSB2OwogIH07CgoKICAvLyBpbmxpbmVkIG1hbnVhbGx5CiAgLy8gY29uc3QgU01BTExFU1QgPSAxOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTZW5kIHRoZSBibG9jayBkYXRhIGNvbXByZXNzZWQgdXNpbmcgdGhlIGdpdmVuIEh1ZmZtYW4gdHJlZXMKICAgKi8KICBjb25zdCBjb21wcmVzc19ibG9jayA9IChzLCBsdHJlZSwgZHRyZWUpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICBjb25zdCBjdF9kYXRhICpsdHJlZTsgLyogbGl0ZXJhbCB0cmVlICovCiAgLy8gICAgY29uc3QgY3RfZGF0YSAqZHRyZWU7IC8qIGRpc3RhbmNlIHRyZWUgKi8KICB7CiAgICBsZXQgZGlzdDsgICAgICAgICAgIC8qIGRpc3RhbmNlIG9mIG1hdGNoZWQgc3RyaW5nICovCiAgICBsZXQgbGM7ICAgICAgICAgICAgIC8qIG1hdGNoIGxlbmd0aCBvciB1bm1hdGNoZWQgY2hhciAoaWYgZGlzdCA9PSAwKSAqLwogICAgbGV0IGx4ID0gMDsgICAgICAgICAvKiBydW5uaW5nIGluZGV4IGluIGxfYnVmICovCiAgICBsZXQgY29kZTsgICAgICAgICAgIC8qIHRoZSBjb2RlIHRvIHNlbmQgKi8KICAgIGxldCBleHRyYTsgICAgICAgICAgLyogbnVtYmVyIG9mIGV4dHJhIGJpdHMgdG8gc2VuZCAqLwoKICAgIGlmIChzLmxhc3RfbGl0ICE9PSAwKSB7CiAgICAgIGRvIHsKICAgICAgICBkaXN0ID0gKHMucGVuZGluZ19idWZbcy5kX2J1ZiArIGx4ICogMl0gPDwgOCkgfCAocy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyICsgMV0pOwogICAgICAgIGxjID0gcy5wZW5kaW5nX2J1ZltzLmxfYnVmICsgbHhdOwogICAgICAgIGx4Kys7CgogICAgICAgIGlmIChkaXN0ID09PSAwKSB7CiAgICAgICAgICBzZW5kX2NvZGUocywgbGMsIGx0cmVlKTsgLyogc2VuZCBhIGxpdGVyYWwgYnl0ZSAqLwogICAgICAgICAgLy9UcmFjZWN2KGlzZ3JhcGgobGMpLCAoc3RkZXJyLCIgJyVjJyAiLCBsYykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvKiBIZXJlLCBsYyBpcyB0aGUgbWF0Y2ggbGVuZ3RoIC0gTUlOX01BVENIICovCiAgICAgICAgICBjb2RlID0gX2xlbmd0aF9jb2RlW2xjXTsKICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlICsgTElURVJBTFMkMSArIDEsIGx0cmVlKTsgLyogc2VuZCB0aGUgbGVuZ3RoIGNvZGUgKi8KICAgICAgICAgIGV4dHJhID0gZXh0cmFfbGJpdHNbY29kZV07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgbGMgLT0gYmFzZV9sZW5ndGhbY29kZV07CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBsYywgZXh0cmEpOyAgICAgICAvKiBzZW5kIHRoZSBleHRyYSBsZW5ndGggYml0cyAqLwogICAgICAgICAgfQogICAgICAgICAgZGlzdC0tOyAvKiBkaXN0IGlzIG5vdyB0aGUgbWF0Y2ggZGlzdGFuY2UgLSAxICovCiAgICAgICAgICBjb2RlID0gZF9jb2RlKGRpc3QpOwogICAgICAgICAgLy9Bc3NlcnQgKGNvZGUgPCBEX0NPREVTLCAiYmFkIGRfY29kZSIpOwoKICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlLCBkdHJlZSk7ICAgICAgIC8qIHNlbmQgdGhlIGRpc3RhbmNlIGNvZGUgKi8KICAgICAgICAgIGV4dHJhID0gZXh0cmFfZGJpdHNbY29kZV07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgZGlzdCAtPSBiYXNlX2Rpc3RbY29kZV07CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBkaXN0LCBleHRyYSk7ICAgLyogc2VuZCB0aGUgZXh0cmEgZGlzdGFuY2UgYml0cyAqLwogICAgICAgICAgfQogICAgICAgIH0gLyogbGl0ZXJhbCBvciBtYXRjaCBwYWlyID8gKi8KCiAgICAgICAgLyogQ2hlY2sgdGhhdCB0aGUgb3ZlcmxheSBiZXR3ZWVuIHBlbmRpbmdfYnVmIGFuZCBkX2J1ZitsX2J1ZiBpcyBvazogKi8KICAgICAgICAvL0Fzc2VydCgodUludCkocy0+cGVuZGluZykgPCBzLT5saXRfYnVmc2l6ZSArIDIqbHgsCiAgICAgICAgLy8gICAgICAgInBlbmRpbmdCdWYgb3ZlcmZsb3ciKTsKCiAgICAgIH0gd2hpbGUgKGx4IDwgcy5sYXN0X2xpdCk7CiAgICB9CgogICAgc2VuZF9jb2RlKHMsIEVORF9CTE9DSywgbHRyZWUpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb25zdHJ1Y3Qgb25lIEh1ZmZtYW4gdHJlZSBhbmQgYXNzaWducyB0aGUgY29kZSBiaXQgc3RyaW5ncyBhbmQgbGVuZ3Rocy4KICAgKiBVcGRhdGUgdGhlIHRvdGFsIGJpdCBsZW5ndGggZm9yIHRoZSBjdXJyZW50IGJsb2NrLgogICAqIElOIGFzc2VydGlvbjogdGhlIGZpZWxkIGZyZXEgaXMgc2V0IGZvciBhbGwgdHJlZSBlbGVtZW50cy4KICAgKiBPVVQgYXNzZXJ0aW9uczogdGhlIGZpZWxkcyBsZW4gYW5kIGNvZGUgYXJlIHNldCB0byB0aGUgb3B0aW1hbCBiaXQgbGVuZ3RoCiAgICogICAgIGFuZCBjb3JyZXNwb25kaW5nIGNvZGUuIFRoZSBsZW5ndGggb3B0X2xlbiBpcyB1cGRhdGVkOyBzdGF0aWNfbGVuIGlzCiAgICogICAgIGFsc28gdXBkYXRlZCBpZiBzdHJlZSBpcyBub3QgbnVsbC4gVGhlIGZpZWxkIG1heF9jb2RlIGlzIHNldC4KICAgKi8KICBjb25zdCBidWlsZF90cmVlID0gKHMsIGRlc2MpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICB0cmVlX2Rlc2MgKmRlc2M7IC8qIHRoZSB0cmVlIGRlc2NyaXB0b3IgKi8KICB7CiAgICBjb25zdCB0cmVlICAgICA9IGRlc2MuZHluX3RyZWU7CiAgICBjb25zdCBzdHJlZSAgICA9IGRlc2Muc3RhdF9kZXNjLnN0YXRpY190cmVlOwogICAgY29uc3QgaGFzX3N0cmVlID0gZGVzYy5zdGF0X2Rlc2MuaGFzX3N0cmVlOwogICAgY29uc3QgZWxlbXMgICAgPSBkZXNjLnN0YXRfZGVzYy5lbGVtczsKICAgIGxldCBuLCBtOyAgICAgICAgICAvKiBpdGVyYXRlIG92ZXIgaGVhcCBlbGVtZW50cyAqLwogICAgbGV0IG1heF9jb2RlID0gLTE7IC8qIGxhcmdlc3QgY29kZSB3aXRoIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogICAgbGV0IG5vZGU7ICAgICAgICAgIC8qIG5ldyBub2RlIGJlaW5nIGNyZWF0ZWQgKi8KCiAgICAvKiBDb25zdHJ1Y3QgdGhlIGluaXRpYWwgaGVhcCwgd2l0aCBsZWFzdCBmcmVxdWVudCBlbGVtZW50IGluCiAgICAgKiBoZWFwW1NNQUxMRVNUXS4gVGhlIHNvbnMgb2YgaGVhcFtuXSBhcmUgaGVhcFsyKm5dIGFuZCBoZWFwWzIqbisxXS4KICAgICAqIGhlYXBbMF0gaXMgbm90IHVzZWQuCiAgICAgKi8KICAgIHMuaGVhcF9sZW4gPSAwOwogICAgcy5oZWFwX21heCA9IEhFQVBfU0laRSQxOwoKICAgIGZvciAobiA9IDA7IG4gPCBlbGVtczsgbisrKSB7CiAgICAgIGlmICh0cmVlW24gKiAyXS8qLkZyZXEqLyAhPT0gMCkgewogICAgICAgIHMuaGVhcFsrK3MuaGVhcF9sZW5dID0gbWF4X2NvZGUgPSBuOwogICAgICAgIHMuZGVwdGhbbl0gPSAwOwoKICAgICAgfSBlbHNlIHsKICAgICAgICB0cmVlW24gKiAyICsgMV0vKi5MZW4qLyA9IDA7CiAgICAgIH0KICAgIH0KCiAgICAvKiBUaGUgcGt6aXAgZm9ybWF0IHJlcXVpcmVzIHRoYXQgYXQgbGVhc3Qgb25lIGRpc3RhbmNlIGNvZGUgZXhpc3RzLAogICAgICogYW5kIHRoYXQgYXQgbGVhc3Qgb25lIGJpdCBzaG91bGQgYmUgc2VudCBldmVuIGlmIHRoZXJlIGlzIG9ubHkgb25lCiAgICAgKiBwb3NzaWJsZSBjb2RlLiBTbyB0byBhdm9pZCBzcGVjaWFsIGNoZWNrcyBsYXRlciBvbiB3ZSBmb3JjZSBhdCBsZWFzdAogICAgICogdHdvIGNvZGVzIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeS4KICAgICAqLwogICAgd2hpbGUgKHMuaGVhcF9sZW4gPCAyKSB7CiAgICAgIG5vZGUgPSBzLmhlYXBbKytzLmhlYXBfbGVuXSA9IChtYXhfY29kZSA8IDIgPyArK21heF9jb2RlIDogMCk7CiAgICAgIHRyZWVbbm9kZSAqIDJdLyouRnJlcSovID0gMTsKICAgICAgcy5kZXB0aFtub2RlXSA9IDA7CiAgICAgIHMub3B0X2xlbi0tOwoKICAgICAgaWYgKGhhc19zdHJlZSkgewogICAgICAgIHMuc3RhdGljX2xlbiAtPSBzdHJlZVtub2RlICogMiArIDFdLyouTGVuKi87CiAgICAgIH0KICAgICAgLyogbm9kZSBpcyAwIG9yIDEgc28gaXQgZG9lcyBub3QgaGF2ZSBleHRyYSBiaXRzICovCiAgICB9CiAgICBkZXNjLm1heF9jb2RlID0gbWF4X2NvZGU7CgogICAgLyogVGhlIGVsZW1lbnRzIGhlYXBbaGVhcF9sZW4vMisxIC4uIGhlYXBfbGVuXSBhcmUgbGVhdmVzIG9mIHRoZSB0cmVlLAogICAgICogZXN0YWJsaXNoIHN1Yi1oZWFwcyBvZiBpbmNyZWFzaW5nIGxlbmd0aHM6CiAgICAgKi8KICAgIGZvciAobiA9IChzLmhlYXBfbGVuID4+IDEvKmludCAvMiovKTsgbiA+PSAxOyBuLS0pIHsgcHFkb3duaGVhcChzLCB0cmVlLCBuKTsgfQoKICAgIC8qIENvbnN0cnVjdCB0aGUgSHVmZm1hbiB0cmVlIGJ5IHJlcGVhdGVkbHkgY29tYmluaW5nIHRoZSBsZWFzdCB0d28KICAgICAqIGZyZXF1ZW50IG5vZGVzLgogICAgICovCiAgICBub2RlID0gZWxlbXM7ICAgICAgICAgICAgICAvKiBuZXh0IGludGVybmFsIG5vZGUgb2YgdGhlIHRyZWUgKi8KICAgIGRvIHsKICAgICAgLy9wcXJlbW92ZShzLCB0cmVlLCBuKTsgIC8qIG4gPSBub2RlIG9mIGxlYXN0IGZyZXF1ZW5jeSAqLwogICAgICAvKioqIHBxcmVtb3ZlICoqKi8KICAgICAgbiA9IHMuaGVhcFsxLypTTUFMTEVTVCovXTsKICAgICAgcy5oZWFwWzEvKlNNQUxMRVNUKi9dID0gcy5oZWFwW3MuaGVhcF9sZW4tLV07CiAgICAgIHBxZG93bmhlYXAocywgdHJlZSwgMS8qU01BTExFU1QqLyk7CiAgICAgIC8qKiovCgogICAgICBtID0gcy5oZWFwWzEvKlNNQUxMRVNUKi9dOyAvKiBtID0gbm9kZSBvZiBuZXh0IGxlYXN0IGZyZXF1ZW5jeSAqLwoKICAgICAgcy5oZWFwWy0tcy5oZWFwX21heF0gPSBuOyAvKiBrZWVwIHRoZSBub2RlcyBzb3J0ZWQgYnkgZnJlcXVlbmN5ICovCiAgICAgIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gbTsKCiAgICAgIC8qIENyZWF0ZSBhIG5ldyBub2RlIGZhdGhlciBvZiBuIGFuZCBtICovCiAgICAgIHRyZWVbbm9kZSAqIDJdLyouRnJlcSovID0gdHJlZVtuICogMl0vKi5GcmVxKi8gKyB0cmVlW20gKiAyXS8qLkZyZXEqLzsKICAgICAgcy5kZXB0aFtub2RlXSA9IChzLmRlcHRoW25dID49IHMuZGVwdGhbbV0gPyBzLmRlcHRoW25dIDogcy5kZXB0aFttXSkgKyAxOwogICAgICB0cmVlW24gKiAyICsgMV0vKi5EYWQqLyA9IHRyZWVbbSAqIDIgKyAxXS8qLkRhZCovID0gbm9kZTsKCiAgICAgIC8qIGFuZCBpbnNlcnQgdGhlIG5ldyBub2RlIGluIHRoZSBoZWFwICovCiAgICAgIHMuaGVhcFsxLypTTUFMTEVTVCovXSA9IG5vZGUrKzsKICAgICAgcHFkb3duaGVhcChzLCB0cmVlLCAxLypTTUFMTEVTVCovKTsKCiAgICB9IHdoaWxlIChzLmhlYXBfbGVuID49IDIpOwoKICAgIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gcy5oZWFwWzEvKlNNQUxMRVNUKi9dOwoKICAgIC8qIEF0IHRoaXMgcG9pbnQsIHRoZSBmaWVsZHMgZnJlcSBhbmQgZGFkIGFyZSBzZXQuIFdlIGNhbiBub3cKICAgICAqIGdlbmVyYXRlIHRoZSBiaXQgbGVuZ3Rocy4KICAgICAqLwogICAgZ2VuX2JpdGxlbihzLCBkZXNjKTsKCiAgICAvKiBUaGUgZmllbGQgbGVuIGlzIG5vdyBzZXQsIHdlIGNhbiBnZW5lcmF0ZSB0aGUgYml0IGNvZGVzICovCiAgICBnZW5fY29kZXModHJlZSwgbWF4X2NvZGUsIHMuYmxfY291bnQpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTY2FuIGEgbGl0ZXJhbCBvciBkaXN0YW5jZSB0cmVlIHRvIGRldGVybWluZSB0aGUgZnJlcXVlbmNpZXMgb2YgdGhlIGNvZGVzCiAgICogaW4gdGhlIGJpdCBsZW5ndGggdHJlZS4KICAgKi8KICBjb25zdCBzY2FuX3RyZWUgPSAocywgdHJlZSwgbWF4X2NvZGUpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICBjdF9kYXRhICp0cmVlOyAgIC8qIHRoZSB0cmVlIHRvIGJlIHNjYW5uZWQgKi8KICAvLyAgICBpbnQgbWF4X2NvZGU7ICAgIC8qIGFuZCBpdHMgbGFyZ2VzdCBjb2RlIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogIHsKICAgIGxldCBuOyAgICAgICAgICAgICAgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgYWxsIHRyZWUgZWxlbWVudHMgKi8KICAgIGxldCBwcmV2bGVuID0gLTE7ICAgICAgICAgIC8qIGxhc3QgZW1pdHRlZCBsZW5ndGggKi8KICAgIGxldCBjdXJsZW47ICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBvZiBjdXJyZW50IGNvZGUgKi8KCiAgICBsZXQgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXS8qLkxlbiovOyAvKiBsZW5ndGggb2YgbmV4dCBjb2RlICovCgogICAgbGV0IGNvdW50ID0gMDsgICAgICAgICAgICAgLyogcmVwZWF0IGNvdW50IG9mIHRoZSBjdXJyZW50IGNvZGUgKi8KICAgIGxldCBtYXhfY291bnQgPSA3OyAgICAgICAgIC8qIG1heCByZXBlYXQgY291bnQgKi8KICAgIGxldCBtaW5fY291bnQgPSA0OyAgICAgICAgIC8qIG1pbiByZXBlYXQgY291bnQgKi8KCiAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICBtYXhfY291bnQgPSAxMzg7CiAgICAgIG1pbl9jb3VudCA9IDM7CiAgICB9CiAgICB0cmVlWyhtYXhfY29kZSArIDEpICogMiArIDFdLyouTGVuKi8gPSAweGZmZmY7IC8qIGd1YXJkICovCgogICAgZm9yIChuID0gMDsgbiA8PSBtYXhfY29kZTsgbisrKSB7CiAgICAgIGN1cmxlbiA9IG5leHRsZW47CiAgICAgIG5leHRsZW4gPSB0cmVlWyhuICsgMSkgKiAyICsgMV0vKi5MZW4qLzsKCiAgICAgIGlmICgrK2NvdW50IDwgbWF4X2NvdW50ICYmIGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIGNvbnRpbnVlOwoKICAgICAgfSBlbHNlIGlmIChjb3VudCA8IG1pbl9jb3VudCkgewogICAgICAgIHMuYmxfdHJlZVtjdXJsZW4gKiAyXS8qLkZyZXEqLyArPSBjb3VudDsKCiAgICAgIH0gZWxzZSBpZiAoY3VybGVuICE9PSAwKSB7CgogICAgICAgIGlmIChjdXJsZW4gIT09IHByZXZsZW4pIHsgcy5ibF90cmVlW2N1cmxlbiAqIDJdLyouRnJlcSovKys7IH0KICAgICAgICBzLmJsX3RyZWVbUkVQXzNfNiAqIDJdLyouRnJlcSovKys7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgICAgcy5ibF90cmVlW1JFUFpfM18xMCAqIDJdLyouRnJlcSovKys7CgogICAgICB9IGVsc2UgewogICAgICAgIHMuYmxfdHJlZVtSRVBaXzExXzEzOCAqIDJdLyouRnJlcSovKys7CiAgICAgIH0KCiAgICAgIGNvdW50ID0gMDsKICAgICAgcHJldmxlbiA9IGN1cmxlbjsKCiAgICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICAgIG1pbl9jb3VudCA9IDM7CgogICAgICB9IGVsc2UgaWYgKGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIG1heF9jb3VudCA9IDY7CiAgICAgICAgbWluX2NvdW50ID0gMzsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWF4X2NvdW50ID0gNzsKICAgICAgICBtaW5fY291bnQgPSA0OwogICAgICB9CiAgICB9CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSBsaXRlcmFsIG9yIGRpc3RhbmNlIHRyZWUgaW4gY29tcHJlc3NlZCBmb3JtLCB1c2luZyB0aGUgY29kZXMgaW4KICAgKiBibF90cmVlLgogICAqLwogIGNvbnN0IHNlbmRfdHJlZSA9IChzLCB0cmVlLCBtYXhfY29kZSkgPT4KICAvLyAgICBkZWZsYXRlX3N0YXRlICpzOwogIC8vICAgIGN0X2RhdGEgKnRyZWU7IC8qIHRoZSB0cmVlIHRvIGJlIHNjYW5uZWQgKi8KICAvLyAgICBpbnQgbWF4X2NvZGU7ICAgICAgIC8qIGFuZCBpdHMgbGFyZ2VzdCBjb2RlIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogIHsKICAgIGxldCBuOyAgICAgICAgICAgICAgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgYWxsIHRyZWUgZWxlbWVudHMgKi8KICAgIGxldCBwcmV2bGVuID0gLTE7ICAgICAgICAgIC8qIGxhc3QgZW1pdHRlZCBsZW5ndGggKi8KICAgIGxldCBjdXJsZW47ICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBvZiBjdXJyZW50IGNvZGUgKi8KCiAgICBsZXQgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXS8qLkxlbiovOyAvKiBsZW5ndGggb2YgbmV4dCBjb2RlICovCgogICAgbGV0IGNvdW50ID0gMDsgICAgICAgICAgICAgLyogcmVwZWF0IGNvdW50IG9mIHRoZSBjdXJyZW50IGNvZGUgKi8KICAgIGxldCBtYXhfY291bnQgPSA3OyAgICAgICAgIC8qIG1heCByZXBlYXQgY291bnQgKi8KICAgIGxldCBtaW5fY291bnQgPSA0OyAgICAgICAgIC8qIG1pbiByZXBlYXQgY291bnQgKi8KCiAgICAvKiB0cmVlW21heF9jb2RlKzFdLkxlbiA9IC0xOyAqLyAgLyogZ3VhcmQgYWxyZWFkeSBzZXQgKi8KICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgbWluX2NvdW50ID0gMzsKICAgIH0KCiAgICBmb3IgKG4gPSAwOyBuIDw9IG1heF9jb2RlOyBuKyspIHsKICAgICAgY3VybGVuID0gbmV4dGxlbjsKICAgICAgbmV4dGxlbiA9IHRyZWVbKG4gKyAxKSAqIDIgKyAxXS8qLkxlbiovOwoKICAgICAgaWYgKCsrY291bnQgPCBtYXhfY291bnQgJiYgY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgICAgY29udGludWU7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDwgbWluX2NvdW50KSB7CiAgICAgICAgZG8geyBzZW5kX2NvZGUocywgY3VybGVuLCBzLmJsX3RyZWUpOyB9IHdoaWxlICgtLWNvdW50ICE9PSAwKTsKCiAgICAgIH0gZWxzZSBpZiAoY3VybGVuICE9PSAwKSB7CiAgICAgICAgaWYgKGN1cmxlbiAhPT0gcHJldmxlbikgewogICAgICAgICAgc2VuZF9jb2RlKHMsIGN1cmxlbiwgcy5ibF90cmVlKTsKICAgICAgICAgIGNvdW50LS07CiAgICAgICAgfQogICAgICAgIC8vQXNzZXJ0KGNvdW50ID49IDMgJiYgY291bnQgPD0gNiwgIiAzXzY/Iik7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUF8zXzYsIHMuYmxfdHJlZSk7CiAgICAgICAgc2VuZF9iaXRzKHMsIGNvdW50IC0gMywgMik7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUFpfM18xMCwgcy5ibF90cmVlKTsKICAgICAgICBzZW5kX2JpdHMocywgY291bnQgLSAzLCAzKTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUFpfMTFfMTM4LCBzLmJsX3RyZWUpOwogICAgICAgIHNlbmRfYml0cyhzLCBjb3VudCAtIDExLCA3KTsKICAgICAgfQoKICAgICAgY291bnQgPSAwOwogICAgICBwcmV2bGVuID0gY3VybGVuOwogICAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgICBtaW5fY291bnQgPSAzOwoKICAgICAgfSBlbHNlIGlmIChjdXJsZW4gPT09IG5leHRsZW4pIHsKICAgICAgICBtYXhfY291bnQgPSA2OwogICAgICAgIG1pbl9jb3VudCA9IDM7CgogICAgICB9IGVsc2UgewogICAgICAgIG1heF9jb3VudCA9IDc7CiAgICAgICAgbWluX2NvdW50ID0gNDsKICAgICAgfQogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb25zdHJ1Y3QgdGhlIEh1ZmZtYW4gdHJlZSBmb3IgdGhlIGJpdCBsZW5ndGhzIGFuZCByZXR1cm4gdGhlIGluZGV4IGluCiAgICogYmxfb3JkZXIgb2YgdGhlIGxhc3QgYml0IGxlbmd0aCBjb2RlIHRvIHNlbmQuCiAgICovCiAgY29uc3QgYnVpbGRfYmxfdHJlZSA9IChzKSA9PiB7CgogICAgbGV0IG1heF9ibGluZGV4OyAgLyogaW5kZXggb2YgbGFzdCBiaXQgbGVuZ3RoIGNvZGUgb2Ygbm9uIHplcm8gZnJlcSAqLwoKICAgIC8qIERldGVybWluZSB0aGUgYml0IGxlbmd0aCBmcmVxdWVuY2llcyBmb3IgbGl0ZXJhbCBhbmQgZGlzdGFuY2UgdHJlZXMgKi8KICAgIHNjYW5fdHJlZShzLCBzLmR5bl9sdHJlZSwgcy5sX2Rlc2MubWF4X2NvZGUpOwogICAgc2Nhbl90cmVlKHMsIHMuZHluX2R0cmVlLCBzLmRfZGVzYy5tYXhfY29kZSk7CgogICAgLyogQnVpbGQgdGhlIGJpdCBsZW5ndGggdHJlZTogKi8KICAgIGJ1aWxkX3RyZWUocywgcy5ibF9kZXNjKTsKICAgIC8qIG9wdF9sZW4gbm93IGluY2x1ZGVzIHRoZSBsZW5ndGggb2YgdGhlIHRyZWUgcmVwcmVzZW50YXRpb25zLCBleGNlcHQKICAgICAqIHRoZSBsZW5ndGhzIG9mIHRoZSBiaXQgbGVuZ3RocyBjb2RlcyBhbmQgdGhlIDUrNSs0IGJpdHMgZm9yIHRoZSBjb3VudHMuCiAgICAgKi8KCiAgICAvKiBEZXRlcm1pbmUgdGhlIG51bWJlciBvZiBiaXQgbGVuZ3RoIGNvZGVzIHRvIHNlbmQuIFRoZSBwa3ppcCBmb3JtYXQKICAgICAqIHJlcXVpcmVzIHRoYXQgYXQgbGVhc3QgNCBiaXQgbGVuZ3RoIGNvZGVzIGJlIHNlbnQuIChhcHBub3RlLnR4dCBzYXlzCiAgICAgKiAzIGJ1dCB0aGUgYWN0dWFsIHZhbHVlIHVzZWQgaXMgNC4pCiAgICAgKi8KICAgIGZvciAobWF4X2JsaW5kZXggPSBCTF9DT0RFUyQxIC0gMTsgbWF4X2JsaW5kZXggPj0gMzsgbWF4X2JsaW5kZXgtLSkgewogICAgICBpZiAocy5ibF90cmVlW2JsX29yZGVyW21heF9ibGluZGV4XSAqIDIgKyAxXS8qLkxlbiovICE9PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIC8qIFVwZGF0ZSBvcHRfbGVuIHRvIGluY2x1ZGUgdGhlIGJpdCBsZW5ndGggdHJlZSBhbmQgY291bnRzICovCiAgICBzLm9wdF9sZW4gKz0gMyAqIChtYXhfYmxpbmRleCArIDEpICsgNSArIDUgKyA0OwogICAgLy9UcmFjZXYoKHN0ZGVyciwgIlxuZHluIHRyZWVzOiBkeW4gJWxkLCBzdGF0ICVsZCIsCiAgICAvLyAgICAgICAgcy0+b3B0X2xlbiwgcy0+c3RhdGljX2xlbikpOwoKICAgIHJldHVybiBtYXhfYmxpbmRleDsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2VuZCB0aGUgaGVhZGVyIGZvciBhIGJsb2NrIHVzaW5nIGR5bmFtaWMgSHVmZm1hbiB0cmVlczogdGhlIGNvdW50cywgdGhlCiAgICogbGVuZ3RocyBvZiB0aGUgYml0IGxlbmd0aCBjb2RlcywgdGhlIGxpdGVyYWwgdHJlZSBhbmQgdGhlIGRpc3RhbmNlIHRyZWUuCiAgICogSU4gYXNzZXJ0aW9uOiBsY29kZXMgPj0gMjU3LCBkY29kZXMgPj0gMSwgYmxjb2RlcyA+PSA0LgogICAqLwogIGNvbnN0IHNlbmRfYWxsX3RyZWVzID0gKHMsIGxjb2RlcywgZGNvZGVzLCBibGNvZGVzKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgaW50IGxjb2RlcywgZGNvZGVzLCBibGNvZGVzOyAvKiBudW1iZXIgb2YgY29kZXMgZm9yIGVhY2ggdHJlZSAqLwogIHsKICAgIGxldCByYW5rOyAgICAgICAgICAgICAgICAgICAgLyogaW5kZXggaW4gYmxfb3JkZXIgKi8KCiAgICAvL0Fzc2VydCAobGNvZGVzID49IDI1NyAmJiBkY29kZXMgPj0gMSAmJiBibGNvZGVzID49IDQsICJub3QgZW5vdWdoIGNvZGVzIik7CiAgICAvL0Fzc2VydCAobGNvZGVzIDw9IExfQ09ERVMgJiYgZGNvZGVzIDw9IERfQ09ERVMgJiYgYmxjb2RlcyA8PSBCTF9DT0RFUywKICAgIC8vICAgICAgICAidG9vIG1hbnkgY29kZXMiKTsKICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmJsIGNvdW50czogIikpOwogICAgc2VuZF9iaXRzKHMsIGxjb2RlcyAtIDI1NywgNSk7IC8qIG5vdCArMjU1IGFzIHN0YXRlZCBpbiBhcHBub3RlLnR4dCAqLwogICAgc2VuZF9iaXRzKHMsIGRjb2RlcyAtIDEsICAgNSk7CiAgICBzZW5kX2JpdHMocywgYmxjb2RlcyAtIDQsICA0KTsgLyogbm90IC0zIGFzIHN0YXRlZCBpbiBhcHBub3RlLnR4dCAqLwogICAgZm9yIChyYW5rID0gMDsgcmFuayA8IGJsY29kZXM7IHJhbmsrKykgewogICAgICAvL1RyYWNldigoc3RkZXJyLCAiXG5ibCBjb2RlICUyZCAiLCBibF9vcmRlcltyYW5rXSkpOwogICAgICBzZW5kX2JpdHMocywgcy5ibF90cmVlW2JsX29yZGVyW3JhbmtdICogMiArIDFdLyouTGVuKi8sIDMpOwogICAgfQogICAgLy9UcmFjZXYoKHN0ZGVyciwgIlxuYmwgdHJlZTogc2VudCAlbGQiLCBzLT5iaXRzX3NlbnQpKTsKCiAgICBzZW5kX3RyZWUocywgcy5keW5fbHRyZWUsIGxjb2RlcyAtIDEpOyAvKiBsaXRlcmFsIHRyZWUgKi8KICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmxpdCB0cmVlOiBzZW50ICVsZCIsIHMtPmJpdHNfc2VudCkpOwoKICAgIHNlbmRfdHJlZShzLCBzLmR5bl9kdHJlZSwgZGNvZGVzIC0gMSk7IC8qIGRpc3RhbmNlIHRyZWUgKi8KICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmRpc3QgdHJlZTogc2VudCAlbGQiLCBzLT5iaXRzX3NlbnQpKTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogQ2hlY2sgaWYgdGhlIGRhdGEgdHlwZSBpcyBURVhUIG9yIEJJTkFSWSwgdXNpbmcgdGhlIGZvbGxvd2luZyBhbGdvcml0aG06CiAgICogLSBURVhUIGlmIHRoZSB0d28gY29uZGl0aW9ucyBiZWxvdyBhcmUgc2F0aXNmaWVkOgogICAqICAgIGEpIFRoZXJlIGFyZSBubyBub24tcG9ydGFibGUgY29udHJvbCBjaGFyYWN0ZXJzIGJlbG9uZ2luZyB0byB0aGUKICAgKiAgICAgICAiYmxhY2sgbGlzdCIgKDAuLjYsIDE0Li4yNSwgMjguLjMxKS4KICAgKiAgICBiKSBUaGVyZSBpcyBhdCBsZWFzdCBvbmUgcHJpbnRhYmxlIGNoYXJhY3RlciBiZWxvbmdpbmcgdG8gdGhlCiAgICogICAgICAgIndoaXRlIGxpc3QiICg5IHtUQUJ9LCAxMCB7TEZ9LCAxMyB7Q1J9LCAzMi4uMjU1KS4KICAgKiAtIEJJTkFSWSBvdGhlcndpc2UuCiAgICogLSBUaGUgZm9sbG93aW5nIHBhcnRpYWxseS1wb3J0YWJsZSBjb250cm9sIGNoYXJhY3RlcnMgZm9ybSBhCiAgICogICAiZ3JheSBsaXN0IiB0aGF0IGlzIGlnbm9yZWQgaW4gdGhpcyBkZXRlY3Rpb24gYWxnb3JpdGhtOgogICAqICAgKDcge0JFTH0sIDgge0JTfSwgMTEge1ZUfSwgMTIge0ZGfSwgMjYge1NVQn0sIDI3IHtFU0N9KS4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBmaWVsZHMgRnJlcSBvZiBkeW5fbHRyZWUgYXJlIHNldC4KICAgKi8KICBjb25zdCBkZXRlY3RfZGF0YV90eXBlID0gKHMpID0+IHsKICAgIC8qIGJsYWNrX21hc2sgaXMgdGhlIGJpdCBtYXNrIG9mIGJsYWNrLWxpc3RlZCBieXRlcwogICAgICogc2V0IGJpdHMgMC4uNiwgMTQuLjI1LCBhbmQgMjguLjMxCiAgICAgKiAweGYzZmZjMDdmID0gYmluYXJ5IDExMTEwMDExMTExMTExMTExMTAwMDAwMDAxMTExMTExCiAgICAgKi8KICAgIGxldCBibGFja19tYXNrID0gMHhmM2ZmYzA3ZjsKICAgIGxldCBuOwoKICAgIC8qIENoZWNrIGZvciBub24tdGV4dHVhbCAoImJsYWNrLWxpc3RlZCIpIGJ5dGVzLiAqLwogICAgZm9yIChuID0gMDsgbiA8PSAzMTsgbisrLCBibGFja19tYXNrID4+Pj0gMSkgewogICAgICBpZiAoKGJsYWNrX21hc2sgJiAxKSAmJiAocy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovICE9PSAwKSkgewogICAgICAgIHJldHVybiBaX0JJTkFSWTsKICAgICAgfQogICAgfQoKICAgIC8qIENoZWNrIGZvciB0ZXh0dWFsICgid2hpdGUtbGlzdGVkIikgYnl0ZXMuICovCiAgICBpZiAocy5keW5fbHRyZWVbOSAqIDJdLyouRnJlcSovICE9PSAwIHx8IHMuZHluX2x0cmVlWzEwICogMl0vKi5GcmVxKi8gIT09IDAgfHwKICAgICAgICBzLmR5bl9sdHJlZVsxMyAqIDJdLyouRnJlcSovICE9PSAwKSB7CiAgICAgIHJldHVybiBaX1RFWFQ7CiAgICB9CiAgICBmb3IgKG4gPSAzMjsgbiA8IExJVEVSQUxTJDE7IG4rKykgewogICAgICBpZiAocy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovICE9PSAwKSB7CiAgICAgICAgcmV0dXJuIFpfVEVYVDsKICAgICAgfQogICAgfQoKICAgIC8qIFRoZXJlIGFyZSBubyAiYmxhY2stbGlzdGVkIiBvciAid2hpdGUtbGlzdGVkIiBieXRlczoKICAgICAqIHRoaXMgc3RyZWFtIGVpdGhlciBpcyBlbXB0eSBvciBoYXMgdG9sZXJhdGVkICgiZ3JheS1saXN0ZWQiKSBieXRlcyBvbmx5LgogICAgICovCiAgICByZXR1cm4gWl9CSU5BUlk7CiAgfTsKCgogIGxldCBzdGF0aWNfaW5pdF9kb25lID0gZmFsc2U7CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIEluaXRpYWxpemUgdGhlIHRyZWUgZGF0YSBzdHJ1Y3R1cmVzIGZvciBhIG5ldyB6bGliIHN0cmVhbS4KICAgKi8KICBjb25zdCBfdHJfaW5pdCQxID0gKHMpID0+CiAgewoKICAgIGlmICghc3RhdGljX2luaXRfZG9uZSkgewogICAgICB0cl9zdGF0aWNfaW5pdCgpOwogICAgICBzdGF0aWNfaW5pdF9kb25lID0gdHJ1ZTsKICAgIH0KCiAgICBzLmxfZGVzYyAgPSBuZXcgVHJlZURlc2Mocy5keW5fbHRyZWUsIHN0YXRpY19sX2Rlc2MpOwogICAgcy5kX2Rlc2MgID0gbmV3IFRyZWVEZXNjKHMuZHluX2R0cmVlLCBzdGF0aWNfZF9kZXNjKTsKICAgIHMuYmxfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmJsX3RyZWUsIHN0YXRpY19ibF9kZXNjKTsKCiAgICBzLmJpX2J1ZiA9IDA7CiAgICBzLmJpX3ZhbGlkID0gMDsKCiAgICAvKiBJbml0aWFsaXplIHRoZSBmaXJzdCBibG9jayBvZiB0aGUgZmlyc3QgZmlsZTogKi8KICAgIGluaXRfYmxvY2socyk7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSBzdG9yZWQgYmxvY2sKICAgKi8KICBjb25zdCBfdHJfc3RvcmVkX2Jsb2NrJDEgPSAocywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSA9PgogIC8vRGVmbGF0ZVN0YXRlICpzOwogIC8vY2hhcmYgKmJ1ZjsgICAgICAgLyogaW5wdXQgYmxvY2sgKi8KICAvL3VsZyBzdG9yZWRfbGVuOyAgIC8qIGxlbmd0aCBvZiBpbnB1dCBibG9jayAqLwogIC8vaW50IGxhc3Q7ICAgICAgICAgLyogb25lIGlmIHRoaXMgaXMgdGhlIGxhc3QgYmxvY2sgZm9yIGEgZmlsZSAqLwogIHsKICAgIHNlbmRfYml0cyhzLCAoU1RPUkVEX0JMT0NLIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOyAgICAvKiBzZW5kIGJsb2NrIHR5cGUgKi8KICAgIGNvcHlfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCB0cnVlKTsgLyogd2l0aCBoZWFkZXIgKi8KICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2VuZCBvbmUgZW1wdHkgc3RhdGljIGJsb2NrIHRvIGdpdmUgZW5vdWdoIGxvb2thaGVhZCBmb3IgaW5mbGF0ZS4KICAgKiBUaGlzIHRha2VzIDEwIGJpdHMsIG9mIHdoaWNoIDcgbWF5IHJlbWFpbiBpbiB0aGUgYml0IGJ1ZmZlci4KICAgKi8KICBjb25zdCBfdHJfYWxpZ24kMSA9IChzKSA9PiB7CiAgICBzZW5kX2JpdHMocywgU1RBVElDX1RSRUVTIDw8IDEsIDMpOwogICAgc2VuZF9jb2RlKHMsIEVORF9CTE9DSywgc3RhdGljX2x0cmVlKTsKICAgIGJpX2ZsdXNoKHMpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBEZXRlcm1pbmUgdGhlIGJlc3QgZW5jb2RpbmcgZm9yIHRoZSBjdXJyZW50IGJsb2NrOiBkeW5hbWljIHRyZWVzLCBzdGF0aWMKICAgKiB0cmVlcyBvciBzdG9yZSwgYW5kIG91dHB1dCB0aGUgZW5jb2RlZCBibG9jayB0byB0aGUgemlwIGZpbGUuCiAgICovCiAgY29uc3QgX3RyX2ZsdXNoX2Jsb2NrJDEgPSAocywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSA9PgogIC8vRGVmbGF0ZVN0YXRlICpzOwogIC8vY2hhcmYgKmJ1ZjsgICAgICAgLyogaW5wdXQgYmxvY2ssIG9yIE5VTEwgaWYgdG9vIG9sZCAqLwogIC8vdWxnIHN0b3JlZF9sZW47ICAgLyogbGVuZ3RoIG9mIGlucHV0IGJsb2NrICovCiAgLy9pbnQgbGFzdDsgICAgICAgICAvKiBvbmUgaWYgdGhpcyBpcyB0aGUgbGFzdCBibG9jayBmb3IgYSBmaWxlICovCiAgewogICAgbGV0IG9wdF9sZW5iLCBzdGF0aWNfbGVuYjsgIC8qIG9wdF9sZW4gYW5kIHN0YXRpY19sZW4gaW4gYnl0ZXMgKi8KICAgIGxldCBtYXhfYmxpbmRleCA9IDA7ICAgICAgICAvKiBpbmRleCBvZiBsYXN0IGJpdCBsZW5ndGggY29kZSBvZiBub24gemVybyBmcmVxICovCgogICAgLyogQnVpbGQgdGhlIEh1ZmZtYW4gdHJlZXMgdW5sZXNzIGEgc3RvcmVkIGJsb2NrIGlzIGZvcmNlZCAqLwogICAgaWYgKHMubGV2ZWwgPiAwKSB7CgogICAgICAvKiBDaGVjayBpZiB0aGUgZmlsZSBpcyBiaW5hcnkgb3IgdGV4dCAqLwogICAgICBpZiAocy5zdHJtLmRhdGFfdHlwZSA9PT0gWl9VTktOT1dOJDEpIHsKICAgICAgICBzLnN0cm0uZGF0YV90eXBlID0gZGV0ZWN0X2RhdGFfdHlwZShzKTsKICAgICAgfQoKICAgICAgLyogQ29uc3RydWN0IHRoZSBsaXRlcmFsIGFuZCBkaXN0YW5jZSB0cmVlcyAqLwogICAgICBidWlsZF90cmVlKHMsIHMubF9kZXNjKTsKICAgICAgLy8gVHJhY2V2KChzdGRlcnIsICJcbmxpdCBkYXRhOiBkeW4gJWxkLCBzdGF0ICVsZCIsIHMtPm9wdF9sZW4sCiAgICAgIC8vICAgICAgICBzLT5zdGF0aWNfbGVuKSk7CgogICAgICBidWlsZF90cmVlKHMsIHMuZF9kZXNjKTsKICAgICAgLy8gVHJhY2V2KChzdGRlcnIsICJcbmRpc3QgZGF0YTogZHluICVsZCwgc3RhdCAlbGQiLCBzLT5vcHRfbGVuLAogICAgICAvLyAgICAgICAgcy0+c3RhdGljX2xlbikpOwogICAgICAvKiBBdCB0aGlzIHBvaW50LCBvcHRfbGVuIGFuZCBzdGF0aWNfbGVuIGFyZSB0aGUgdG90YWwgYml0IGxlbmd0aHMgb2YKICAgICAgICogdGhlIGNvbXByZXNzZWQgYmxvY2sgZGF0YSwgZXhjbHVkaW5nIHRoZSB0cmVlIHJlcHJlc2VudGF0aW9ucy4KICAgICAgICovCgogICAgICAvKiBCdWlsZCB0aGUgYml0IGxlbmd0aCB0cmVlIGZvciB0aGUgYWJvdmUgdHdvIHRyZWVzLCBhbmQgZ2V0IHRoZSBpbmRleAogICAgICAgKiBpbiBibF9vcmRlciBvZiB0aGUgbGFzdCBiaXQgbGVuZ3RoIGNvZGUgdG8gc2VuZC4KICAgICAgICovCiAgICAgIG1heF9ibGluZGV4ID0gYnVpbGRfYmxfdHJlZShzKTsKCiAgICAgIC8qIERldGVybWluZSB0aGUgYmVzdCBlbmNvZGluZy4gQ29tcHV0ZSB0aGUgYmxvY2sgbGVuZ3RocyBpbiBieXRlcy4gKi8KICAgICAgb3B0X2xlbmIgPSAocy5vcHRfbGVuICsgMyArIDcpID4+PiAzOwogICAgICBzdGF0aWNfbGVuYiA9IChzLnN0YXRpY19sZW4gKyAzICsgNykgPj4+IDM7CgogICAgICAvLyBUcmFjZXYoKHN0ZGVyciwgIlxub3B0ICVsdSglbHUpIHN0YXQgJWx1KCVsdSkgc3RvcmVkICVsdSBsaXQgJXUgIiwKICAgICAgLy8gICAgICAgIG9wdF9sZW5iLCBzLT5vcHRfbGVuLCBzdGF0aWNfbGVuYiwgcy0+c3RhdGljX2xlbiwgc3RvcmVkX2xlbiwKICAgICAgLy8gICAgICAgIHMtPmxhc3RfbGl0KSk7CgogICAgICBpZiAoc3RhdGljX2xlbmIgPD0gb3B0X2xlbmIpIHsgb3B0X2xlbmIgPSBzdGF0aWNfbGVuYjsgfQoKICAgIH0gZWxzZSB7CiAgICAgIC8vIEFzc2VydChidWYgIT0gKGNoYXIqKTAsICJsb3N0IGJ1ZiIpOwogICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iID0gc3RvcmVkX2xlbiArIDU7IC8qIGZvcmNlIGEgc3RvcmVkIGJsb2NrICovCiAgICB9CgogICAgaWYgKChzdG9yZWRfbGVuICsgNCA8PSBvcHRfbGVuYikgJiYgKGJ1ZiAhPT0gLTEpKSB7CiAgICAgIC8qIDQ6IHR3byB3b3JkcyBmb3IgdGhlIGxlbmd0aHMgKi8KCiAgICAgIC8qIFRoZSB0ZXN0IGJ1ZiAhPSBOVUxMIGlzIG9ubHkgbmVjZXNzYXJ5IGlmIExJVF9CVUZTSVpFID4gV1NJWkUuCiAgICAgICAqIE90aGVyd2lzZSB3ZSBjYW4ndCBoYXZlIHByb2Nlc3NlZCBtb3JlIHRoYW4gV1NJWkUgaW5wdXQgYnl0ZXMgc2luY2UKICAgICAgICogdGhlIGxhc3QgYmxvY2sgZmx1c2gsIGJlY2F1c2UgY29tcHJlc3Npb24gd291bGQgaGF2ZSBiZWVuCiAgICAgICAqIHN1Y2Nlc3NmdWwuIElmIExJVF9CVUZTSVpFIDw9IFdTSVpFLCBpdCBpcyBuZXZlciB0b28gbGF0ZSB0bwogICAgICAgKiB0cmFuc2Zvcm0gYSBibG9jayBpbnRvIGEgc3RvcmVkIGJsb2NrLgogICAgICAgKi8KICAgICAgX3RyX3N0b3JlZF9ibG9jayQxKHMsIGJ1Ziwgc3RvcmVkX2xlbiwgbGFzdCk7CgogICAgfSBlbHNlIGlmIChzLnN0cmF0ZWd5ID09PSBaX0ZJWEVEJDEgfHwgc3RhdGljX2xlbmIgPT09IG9wdF9sZW5iKSB7CgogICAgICBzZW5kX2JpdHMocywgKFNUQVRJQ19UUkVFUyA8PCAxKSArIChsYXN0ID8gMSA6IDApLCAzKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgc3RhdGljX2x0cmVlLCBzdGF0aWNfZHRyZWUpOwoKICAgIH0gZWxzZSB7CiAgICAgIHNlbmRfYml0cyhzLCAoRFlOX1RSRUVTIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOwogICAgICBzZW5kX2FsbF90cmVlcyhzLCBzLmxfZGVzYy5tYXhfY29kZSArIDEsIHMuZF9kZXNjLm1heF9jb2RlICsgMSwgbWF4X2JsaW5kZXggKyAxKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgcy5keW5fbHRyZWUsIHMuZHluX2R0cmVlKTsKICAgIH0KICAgIC8vIEFzc2VydCAocy0+Y29tcHJlc3NlZF9sZW4gPT0gcy0+Yml0c19zZW50LCAiYmFkIGNvbXByZXNzZWQgc2l6ZSIpOwogICAgLyogVGhlIGFib3ZlIGNoZWNrIGlzIG1hZGUgbW9kIDJeMzIsIGZvciBmaWxlcyBsYXJnZXIgdGhhbiA1MTIgTUIKICAgICAqIGFuZCB1TG9uZyBpbXBsZW1lbnRlZCBvbiAzMiBiaXRzLgogICAgICovCiAgICBpbml0X2Jsb2NrKHMpOwoKICAgIGlmIChsYXN0KSB7CiAgICAgIGJpX3dpbmR1cChzKTsKICAgIH0KICAgIC8vIFRyYWNldigoc3RkZXJyLCJcbmNvbXBybGVuICVsdSglbHUpICIsIHMtPmNvbXByZXNzZWRfbGVuPj4zLAogICAgLy8gICAgICAgcy0+Y29tcHJlc3NlZF9sZW4tNypsYXN0KSk7CiAgfTsKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2F2ZSB0aGUgbWF0Y2ggaW5mbyBhbmQgdGFsbHkgdGhlIGZyZXF1ZW5jeSBjb3VudHMuIFJldHVybiB0cnVlIGlmCiAgICogdGhlIGN1cnJlbnQgYmxvY2sgbXVzdCBiZSBmbHVzaGVkLgogICAqLwogIGNvbnN0IF90cl90YWxseSQxID0gKHMsIGRpc3QsIGxjKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgdW5zaWduZWQgZGlzdDsgIC8qIGRpc3RhbmNlIG9mIG1hdGNoZWQgc3RyaW5nICovCiAgLy8gICAgdW5zaWduZWQgbGM7ICAgIC8qIG1hdGNoIGxlbmd0aC1NSU5fTUFUQ0ggb3IgdW5tYXRjaGVkIGNoYXIgKGlmIGRpc3Q9PTApICovCiAgewogICAgLy9sZXQgb3V0X2xlbmd0aCwgaW5fbGVuZ3RoLCBkY29kZTsKCiAgICBzLnBlbmRpbmdfYnVmW3MuZF9idWYgKyBzLmxhc3RfbGl0ICogMl0gICAgID0gKGRpc3QgPj4+IDgpICYgMHhmZjsKICAgIHMucGVuZGluZ19idWZbcy5kX2J1ZiArIHMubGFzdF9saXQgKiAyICsgMV0gPSBkaXN0ICYgMHhmZjsKCiAgICBzLnBlbmRpbmdfYnVmW3MubF9idWYgKyBzLmxhc3RfbGl0XSA9IGxjICYgMHhmZjsKICAgIHMubGFzdF9saXQrKzsKCiAgICBpZiAoZGlzdCA9PT0gMCkgewogICAgICAvKiBsYyBpcyB0aGUgdW5tYXRjaGVkIGNoYXIgKi8KICAgICAgcy5keW5fbHRyZWVbbGMgKiAyXS8qLkZyZXEqLysrOwogICAgfSBlbHNlIHsKICAgICAgcy5tYXRjaGVzKys7CiAgICAgIC8qIEhlcmUsIGxjIGlzIHRoZSBtYXRjaCBsZW5ndGggLSBNSU5fTUFUQ0ggKi8KICAgICAgZGlzdC0tOyAgICAgICAgICAgICAvKiBkaXN0ID0gbWF0Y2ggZGlzdGFuY2UgLSAxICovCiAgICAgIC8vQXNzZXJ0KCh1c2gpZGlzdCA8ICh1c2gpTUFYX0RJU1QocykgJiYKICAgICAgLy8gICAgICAgKHVzaClsYyA8PSAodXNoKShNQVhfTUFUQ0gtTUlOX01BVENIKSAmJgogICAgICAvLyAgICAgICAodXNoKWRfY29kZShkaXN0KSA8ICh1c2gpRF9DT0RFUywgICJfdHJfdGFsbHk6IGJhZCBtYXRjaCIpOwoKICAgICAgcy5keW5fbHRyZWVbKF9sZW5ndGhfY29kZVtsY10gKyBMSVRFUkFMUyQxICsgMSkgKiAyXS8qLkZyZXEqLysrOwogICAgICBzLmR5bl9kdHJlZVtkX2NvZGUoZGlzdCkgKiAyXS8qLkZyZXEqLysrOwogICAgfQoKICAvLyAoISkgVGhpcyBibG9jayBpcyBkaXNhYmxlZCBpbiB6bGliIGRlZmF1bHRzLAogIC8vIGRvbid0IGVuYWJsZSBpdCBmb3IgYmluYXJ5IGNvbXBhdGliaWxpdHkKCiAgLy8jaWZkZWYgVFJVTkNBVEVfQkxPQ0sKICAvLyAgLyogVHJ5IHRvIGd1ZXNzIGlmIGl0IGlzIHByb2ZpdGFibGUgdG8gc3RvcCB0aGUgY3VycmVudCBibG9jayBoZXJlICovCiAgLy8gIGlmICgocy5sYXN0X2xpdCAmIDB4MWZmZikgPT09IDAgJiYgcy5sZXZlbCA+IDIpIHsKICAvLyAgICAvKiBDb21wdXRlIGFuIHVwcGVyIGJvdW5kIGZvciB0aGUgY29tcHJlc3NlZCBsZW5ndGggKi8KICAvLyAgICBvdXRfbGVuZ3RoID0gcy5sYXN0X2xpdCo4OwogIC8vICAgIGluX2xlbmd0aCA9IHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0OwogIC8vCiAgLy8gICAgZm9yIChkY29kZSA9IDA7IGRjb2RlIDwgRF9DT0RFUzsgZGNvZGUrKykgewogIC8vICAgICAgb3V0X2xlbmd0aCArPSBzLmR5bl9kdHJlZVtkY29kZSoyXS8qLkZyZXEqLyAqICg1ICsgZXh0cmFfZGJpdHNbZGNvZGVdKTsKICAvLyAgICB9CiAgLy8gICAgb3V0X2xlbmd0aCA+Pj49IDM7CiAgLy8gICAgLy9UcmFjZXYoKHN0ZGVyciwiXG5sYXN0X2xpdCAldSwgaW4gJWxkLCBvdXQgfiVsZCglbGQlJSkgIiwKICAvLyAgICAvLyAgICAgICBzLT5sYXN0X2xpdCwgaW5fbGVuZ3RoLCBvdXRfbGVuZ3RoLAogIC8vICAgIC8vICAgICAgIDEwMEwgLSBvdXRfbGVuZ3RoKjEwMEwvaW5fbGVuZ3RoKSk7CiAgLy8gICAgaWYgKHMubWF0Y2hlcyA8IChzLmxhc3RfbGl0Pj4xKS8qaW50IC8yKi8gJiYgb3V0X2xlbmd0aCA8IChpbl9sZW5ndGg+PjEpLyppbnQgLzIqLykgewogIC8vICAgICAgcmV0dXJuIHRydWU7CiAgLy8gICAgfQogIC8vICB9CiAgLy8jZW5kaWYKCiAgICByZXR1cm4gKHMubGFzdF9saXQgPT09IHMubGl0X2J1ZnNpemUgLSAxKTsKICAgIC8qIFdlIGF2b2lkIGVxdWFsaXR5IHdpdGggbGl0X2J1ZnNpemUgYmVjYXVzZSBvZiB3cmFwYXJvdW5kIGF0IDY0SwogICAgICogb24gMTYgYml0IG1hY2hpbmVzIGFuZCBiZWNhdXNlIHN0b3JlZCBibG9ja3MgYXJlIHJlc3RyaWN0ZWQgdG8KICAgICAqIDY0Sy0xIGJ5dGVzLgogICAgICovCiAgfTsKCiAgdmFyIF90cl9pbml0XzEgID0gX3RyX2luaXQkMTsKICB2YXIgX3RyX3N0b3JlZF9ibG9ja18xID0gX3RyX3N0b3JlZF9ibG9jayQxOwogIHZhciBfdHJfZmx1c2hfYmxvY2tfMSAgPSBfdHJfZmx1c2hfYmxvY2skMTsKICB2YXIgX3RyX3RhbGx5XzEgPSBfdHJfdGFsbHkkMTsKICB2YXIgX3RyX2FsaWduXzEgPSBfdHJfYWxpZ24kMTsKCiAgdmFyIHRyZWVzID0gewogIAlfdHJfaW5pdDogX3RyX2luaXRfMSwKICAJX3RyX3N0b3JlZF9ibG9jazogX3RyX3N0b3JlZF9ibG9ja18xLAogIAlfdHJfZmx1c2hfYmxvY2s6IF90cl9mbHVzaF9ibG9ja18xLAogIAlfdHJfdGFsbHk6IF90cl90YWxseV8xLAogIAlfdHJfYWxpZ246IF90cl9hbGlnbl8xCiAgfTsKCiAgLy8gTm90ZTogYWRsZXIzMiB0YWtlcyAxMiUgZm9yIGxldmVsIDAgYW5kIDIlIGZvciBsZXZlbCA2LgogIC8vIEl0IGlzbid0IHdvcnRoIGl0IHRvIG1ha2UgYWRkaXRpb25hbCBvcHRpbWl6YXRpb25zIGFzIGluIG9yaWdpbmFsLgogIC8vIFNtYWxsIHNpemUgaXMgcHJlZmVyYWJsZS4KCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIGNvbnN0IGFkbGVyMzIgPSAoYWRsZXIsIGJ1ZiwgbGVuLCBwb3MpID0+IHsKICAgIGxldCBzMSA9IChhZGxlciAmIDB4ZmZmZikgfDAsCiAgICAgICAgczIgPSAoKGFkbGVyID4+PiAxNikgJiAweGZmZmYpIHwwLAogICAgICAgIG4gPSAwOwoKICAgIHdoaWxlIChsZW4gIT09IDApIHsKICAgICAgLy8gU2V0IGxpbWl0IH4gdHdpY2UgbGVzcyB0aGFuIDU1NTIsIHRvIGtlZXAKICAgICAgLy8gczIgaW4gMzEtYml0cywgYmVjYXVzZSB3ZSBmb3JjZSBzaWduZWQgaW50cy4KICAgICAgLy8gaW4gb3RoZXIgY2FzZSAlPSB3aWxsIGZhaWwuCiAgICAgIG4gPSBsZW4gPiAyMDAwID8gMjAwMCA6IGxlbjsKICAgICAgbGVuIC09IG47CgogICAgICBkbyB7CiAgICAgICAgczEgPSAoczEgKyBidWZbcG9zKytdKSB8MDsKICAgICAgICBzMiA9IChzMiArIHMxKSB8MDsKICAgICAgfSB3aGlsZSAoLS1uKTsKCiAgICAgIHMxICU9IDY1NTIxOwogICAgICBzMiAlPSA2NTUyMTsKICAgIH0KCiAgICByZXR1cm4gKHMxIHwgKHMyIDw8IDE2KSkgfDA7CiAgfTsKCgogIHZhciBhZGxlcjMyXzEgPSBhZGxlcjMyOwoKICAvLyBOb3RlOiB3ZSBjYW4ndCBnZXQgc2lnbmlmaWNhbnQgc3BlZWQgYm9vc3QgaGVyZS4KICAvLyBTbyB3cml0ZSBjb2RlIHRvIG1pbmltaXplIHNpemUgLSBubyBwcmVnZW5lcmF0ZWQgdGFibGVzCiAgLy8gYW5kIGFycmF5IHRvb2xzIGRlcGVuZGVuY2llcy4KCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIC8vIFVzZSBvcmRpbmFyeSBhcnJheSwgc2luY2UgdW50eXBlZCBtYWtlcyBubyBib29zdCBoZXJlCiAgY29uc3QgbWFrZVRhYmxlID0gKCkgPT4gewogICAgbGV0IGMsIHRhYmxlID0gW107CgogICAgZm9yICh2YXIgbiA9IDA7IG4gPCAyNTY7IG4rKykgewogICAgICBjID0gbjsKICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCA4OyBrKyspIHsKICAgICAgICBjID0gKChjICYgMSkgPyAoMHhFREI4ODMyMCBeIChjID4+PiAxKSkgOiAoYyA+Pj4gMSkpOwogICAgICB9CiAgICAgIHRhYmxlW25dID0gYzsKICAgIH0KCiAgICByZXR1cm4gdGFibGU7CiAgfTsKCiAgLy8gQ3JlYXRlIHRhYmxlIG9uIGxvYWQuIEp1c3QgMjU1IHNpZ25lZCBsb25ncy4gTm90IGEgcHJvYmxlbS4KICBjb25zdCBjcmNUYWJsZSA9IG5ldyBVaW50MzJBcnJheShtYWtlVGFibGUoKSk7CgoKICBjb25zdCBjcmMzMiA9IChjcmMsIGJ1ZiwgbGVuLCBwb3MpID0+IHsKICAgIGNvbnN0IHQgPSBjcmNUYWJsZTsKICAgIGNvbnN0IGVuZCA9IHBvcyArIGxlbjsKCiAgICBjcmMgXj0gLTE7CgogICAgZm9yIChsZXQgaSA9IHBvczsgaSA8IGVuZDsgaSsrKSB7CiAgICAgIGNyYyA9IChjcmMgPj4+IDgpIF4gdFsoY3JjIF4gYnVmW2ldKSAmIDB4RkZdOwogICAgfQoKICAgIHJldHVybiAoY3JjIF4gKC0xKSk7IC8vID4+PiAwOwogIH07CgoKICB2YXIgY3JjMzJfMSA9IGNyYzMyOwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgdmFyIG1lc3NhZ2VzID0gewogICAgMjogICAgICAnbmVlZCBkaWN0aW9uYXJ5JywgICAgIC8qIFpfTkVFRF9ESUNUICAgICAgIDIgICovCiAgICAxOiAgICAgICdzdHJlYW0gZW5kJywgICAgICAgICAgLyogWl9TVFJFQU1fRU5EICAgICAgMSAgKi8KICAgIDA6ICAgICAgJycsICAgICAgICAgICAgICAgICAgICAvKiBaX09LICAgICAgICAgICAgICAwICAqLwogICAgJy0xJzogICAnZmlsZSBlcnJvcicsICAgICAgICAgIC8qIFpfRVJSTk8gICAgICAgICAoLTEpICovCiAgICAnLTInOiAgICdzdHJlYW0gZXJyb3InLCAgICAgICAgLyogWl9TVFJFQU1fRVJST1IgICgtMikgKi8KICAgICctMyc6ICAgJ2RhdGEgZXJyb3InLCAgICAgICAgICAvKiBaX0RBVEFfRVJST1IgICAgKC0zKSAqLwogICAgJy00JzogICAnaW5zdWZmaWNpZW50IG1lbW9yeScsIC8qIFpfTUVNX0VSUk9SICAgICAoLTQpICovCiAgICAnLTUnOiAgICdidWZmZXIgZXJyb3InLCAgICAgICAgLyogWl9CVUZfRVJST1IgICAgICgtNSkgKi8KICAgICctNic6ICAgJ2luY29tcGF0aWJsZSB2ZXJzaW9uJyAvKiBaX1ZFUlNJT05fRVJST1IgKC02KSAqLwogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICB2YXIgY29uc3RhbnRzJDIgPSB7CgogICAgLyogQWxsb3dlZCBmbHVzaCB2YWx1ZXM7IHNlZSBkZWZsYXRlKCkgYW5kIGluZmxhdGUoKSBiZWxvdyBmb3IgZGV0YWlscyAqLwogICAgWl9OT19GTFVTSDogICAgICAgICAwLAogICAgWl9QQVJUSUFMX0ZMVVNIOiAgICAxLAogICAgWl9TWU5DX0ZMVVNIOiAgICAgICAyLAogICAgWl9GVUxMX0ZMVVNIOiAgICAgICAzLAogICAgWl9GSU5JU0g6ICAgICAgICAgICA0LAogICAgWl9CTE9DSzogICAgICAgICAgICA1LAogICAgWl9UUkVFUzogICAgICAgICAgICA2LAoKICAgIC8qIFJldHVybiBjb2RlcyBmb3IgdGhlIGNvbXByZXNzaW9uL2RlY29tcHJlc3Npb24gZnVuY3Rpb25zLiBOZWdhdGl2ZSB2YWx1ZXMKICAgICogYXJlIGVycm9ycywgcG9zaXRpdmUgdmFsdWVzIGFyZSB1c2VkIGZvciBzcGVjaWFsIGJ1dCBub3JtYWwgZXZlbnRzLgogICAgKi8KICAgIFpfT0s6ICAgICAgICAgICAgICAgMCwKICAgIFpfU1RSRUFNX0VORDogICAgICAgMSwKICAgIFpfTkVFRF9ESUNUOiAgICAgICAgMiwKICAgIFpfRVJSTk86ICAgICAgICAgICAtMSwKICAgIFpfU1RSRUFNX0VSUk9SOiAgICAtMiwKICAgIFpfREFUQV9FUlJPUjogICAgICAtMywKICAgIFpfTUVNX0VSUk9SOiAgICAgICAtNCwKICAgIFpfQlVGX0VSUk9SOiAgICAgICAtNSwKICAgIC8vWl9WRVJTSU9OX0VSUk9SOiAtNiwKCiAgICAvKiBjb21wcmVzc2lvbiBsZXZlbHMgKi8KICAgIFpfTk9fQ09NUFJFU1NJT046ICAgICAgICAgMCwKICAgIFpfQkVTVF9TUEVFRDogICAgICAgICAgICAgMSwKICAgIFpfQkVTVF9DT01QUkVTU0lPTjogICAgICAgOSwKICAgIFpfREVGQVVMVF9DT01QUkVTU0lPTjogICAtMSwKCgogICAgWl9GSUxURVJFRDogICAgICAgICAgICAgICAxLAogICAgWl9IVUZGTUFOX09OTFk6ICAgICAgICAgICAyLAogICAgWl9STEU6ICAgICAgICAgICAgICAgICAgICAzLAogICAgWl9GSVhFRDogICAgICAgICAgICAgICAgICA0LAogICAgWl9ERUZBVUxUX1NUUkFURUdZOiAgICAgICAwLAoKICAgIC8qIFBvc3NpYmxlIHZhbHVlcyBvZiB0aGUgZGF0YV90eXBlIGZpZWxkICh0aG91Z2ggc2VlIGluZmxhdGUoKSkgKi8KICAgIFpfQklOQVJZOiAgICAgICAgICAgICAgICAgMCwKICAgIFpfVEVYVDogICAgICAgICAgICAgICAgICAgMSwKICAgIC8vWl9BU0NJSTogICAgICAgICAgICAgICAgMSwgLy8gPSBaX1RFWFQgKGRlcHJlY2F0ZWQpCiAgICBaX1VOS05PV046ICAgICAgICAgICAgICAgIDIsCgogICAgLyogVGhlIGRlZmxhdGUgY29tcHJlc3Npb24gbWV0aG9kICovCiAgICBaX0RFRkxBVEVEOiAgICAgICAgICAgICAgIDgKICAgIC8vWl9OVUxMOiAgICAgICAgICAgICAgICAgbnVsbCAvLyBVc2UgLTEgb3IgbnVsbCBpbmxpbmUsIGRlcGVuZGluZyBvbiB2YXIgdHlwZQogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICBjb25zdCB7IF90cl9pbml0LCBfdHJfc3RvcmVkX2Jsb2NrLCBfdHJfZmx1c2hfYmxvY2ssIF90cl90YWxseSwgX3RyX2FsaWduIH0gPSB0cmVlczsKCgoKCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKICBjb25zdCB7CiAgICBaX05PX0ZMVVNIOiBaX05PX0ZMVVNIJDIsIFpfUEFSVElBTF9GTFVTSCwgWl9GVUxMX0ZMVVNIOiBaX0ZVTExfRkxVU0gkMSwgWl9GSU5JU0g6IFpfRklOSVNIJDMsIFpfQkxPQ0s6IFpfQkxPQ0skMSwKICAgIFpfT0s6IFpfT0skMywgWl9TVFJFQU1fRU5EOiBaX1NUUkVBTV9FTkQkMywgWl9TVFJFQU1fRVJST1I6IFpfU1RSRUFNX0VSUk9SJDIsIFpfREFUQV9FUlJPUjogWl9EQVRBX0VSUk9SJDIsIFpfQlVGX0VSUk9SOiBaX0JVRl9FUlJPUiQxLAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiBaX0RFRkFVTFRfQ09NUFJFU1NJT04kMSwKICAgIFpfRklMVEVSRUQsIFpfSFVGRk1BTl9PTkxZLCBaX1JMRSwgWl9GSVhFRCwgWl9ERUZBVUxUX1NUUkFURUdZOiBaX0RFRkFVTFRfU1RSQVRFR1kkMSwKICAgIFpfVU5LTk9XTiwKICAgIFpfREVGTEFURUQ6IFpfREVGTEFURUQkMgogIH0gPSBjb25zdGFudHMkMjsKCiAgLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KCgogIGNvbnN0IE1BWF9NRU1fTEVWRUwgPSA5OwogIC8qIE1heGltdW0gdmFsdWUgZm9yIG1lbUxldmVsIGluIGRlZmxhdGVJbml0MiAqLwogIGNvbnN0IE1BWF9XQklUUyQxID0gMTU7CiAgLyogMzJLIExaNzcgd2luZG93ICovCiAgY29uc3QgREVGX01FTV9MRVZFTCA9IDg7CgoKICBjb25zdCBMRU5HVEhfQ09ERVMgID0gMjk7CiAgLyogbnVtYmVyIG9mIGxlbmd0aCBjb2Rlcywgbm90IGNvdW50aW5nIHRoZSBzcGVjaWFsIEVORF9CTE9DSyBjb2RlICovCiAgY29uc3QgTElURVJBTFMgICAgICA9IDI1NjsKICAvKiBudW1iZXIgb2YgbGl0ZXJhbCBieXRlcyAwLi4yNTUgKi8KICBjb25zdCBMX0NPREVTICAgICAgID0gTElURVJBTFMgKyAxICsgTEVOR1RIX0NPREVTOwogIC8qIG51bWJlciBvZiBMaXRlcmFsIG9yIExlbmd0aCBjb2RlcywgaW5jbHVkaW5nIHRoZSBFTkRfQkxPQ0sgY29kZSAqLwogIGNvbnN0IERfQ09ERVMgICAgICAgPSAzMDsKICAvKiBudW1iZXIgb2YgZGlzdGFuY2UgY29kZXMgKi8KICBjb25zdCBCTF9DT0RFUyAgICAgID0gMTk7CiAgLyogbnVtYmVyIG9mIGNvZGVzIHVzZWQgdG8gdHJhbnNmZXIgdGhlIGJpdCBsZW5ndGhzICovCiAgY29uc3QgSEVBUF9TSVpFICAgICA9IDIgKiBMX0NPREVTICsgMTsKICAvKiBtYXhpbXVtIGhlYXAgc2l6ZSAqLwogIGNvbnN0IE1BWF9CSVRTICA9IDE1OwogIC8qIEFsbCBjb2RlcyBtdXN0IG5vdCBleGNlZWQgTUFYX0JJVFMgYml0cyAqLwoKICBjb25zdCBNSU5fTUFUQ0ggPSAzOwogIGNvbnN0IE1BWF9NQVRDSCA9IDI1ODsKICBjb25zdCBNSU5fTE9PS0FIRUFEID0gKE1BWF9NQVRDSCArIE1JTl9NQVRDSCArIDEpOwoKICBjb25zdCBQUkVTRVRfRElDVCA9IDB4MjA7CgogIGNvbnN0IElOSVRfU1RBVEUgPSA0MjsKICBjb25zdCBFWFRSQV9TVEFURSA9IDY5OwogIGNvbnN0IE5BTUVfU1RBVEUgPSA3MzsKICBjb25zdCBDT01NRU5UX1NUQVRFID0gOTE7CiAgY29uc3QgSENSQ19TVEFURSA9IDEwMzsKICBjb25zdCBCVVNZX1NUQVRFID0gMTEzOwogIGNvbnN0IEZJTklTSF9TVEFURSA9IDY2NjsKCiAgY29uc3QgQlNfTkVFRF9NT1JFICAgICAgPSAxOyAvKiBibG9jayBub3QgY29tcGxldGVkLCBuZWVkIG1vcmUgaW5wdXQgb3IgbW9yZSBvdXRwdXQgKi8KICBjb25zdCBCU19CTE9DS19ET05FICAgICA9IDI7IC8qIGJsb2NrIGZsdXNoIHBlcmZvcm1lZCAqLwogIGNvbnN0IEJTX0ZJTklTSF9TVEFSVEVEID0gMzsgLyogZmluaXNoIHN0YXJ0ZWQsIG5lZWQgb25seSBtb3JlIG91dHB1dCBhdCBuZXh0IGRlZmxhdGUgKi8KICBjb25zdCBCU19GSU5JU0hfRE9ORSAgICA9IDQ7IC8qIGZpbmlzaCBkb25lLCBhY2NlcHQgbm8gbW9yZSBpbnB1dCBvciBvdXRwdXQgKi8KCiAgY29uc3QgT1NfQ09ERSA9IDB4MDM7IC8vIFVuaXggOikgLiBEb24ndCBkZXRlY3QsIHVzZSB0aGlzIGRlZmF1bHQuCgogIGNvbnN0IGVyciA9IChzdHJtLCBlcnJvckNvZGUpID0+IHsKICAgIHN0cm0ubXNnID0gbWVzc2FnZXNbZXJyb3JDb2RlXTsKICAgIHJldHVybiBlcnJvckNvZGU7CiAgfTsKCiAgY29uc3QgcmFuayA9IChmKSA9PiB7CiAgICByZXR1cm4gKChmKSA8PCAxKSAtICgoZikgPiA0ID8gOSA6IDApOwogIH07CgogIGNvbnN0IHplcm8gPSAoYnVmKSA9PiB7CiAgICBsZXQgbGVuID0gYnVmLmxlbmd0aDsgd2hpbGUgKC0tbGVuID49IDApIHsgYnVmW2xlbl0gPSAwOyB9CiAgfTsKCgogIC8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi8KICBsZXQgSEFTSF9aTElCID0gKHMsIHByZXYsIGRhdGEpID0+ICgocHJldiA8PCBzLmhhc2hfc2hpZnQpIF4gZGF0YSkgJiBzLmhhc2hfbWFzazsKICAvLyBUaGlzIGhhc2ggY2F1c2VzIGxlc3MgY29sbGlzaW9ucywgaHR0cHM6Ly9naXRodWIuY29tL25vZGVjYS9wYWtvL2lzc3Vlcy8xMzUKICAvLyBCdXQgYnJlYWtzIGJpbmFyeSBjb21wYXRpYmlsaXR5CiAgLy9sZXQgSEFTSF9GQVNUID0gKHMsIHByZXYsIGRhdGEpID0+ICgocHJldiA8PCA4KSArIChwcmV2ID4+IDgpICsgKGRhdGEgPDwgNCkpICYgcy5oYXNoX21hc2s7CiAgbGV0IEhBU0ggPSBIQVNIX1pMSUI7CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGbHVzaCBhcyBtdWNoIHBlbmRpbmcgb3V0cHV0IGFzIHBvc3NpYmxlLiBBbGwgZGVmbGF0ZSgpIG91dHB1dCBnb2VzCiAgICogdGhyb3VnaCB0aGlzIGZ1bmN0aW9uIHNvIHNvbWUgYXBwbGljYXRpb25zIG1heSB3aXNoIHRvIG1vZGlmeSBpdAogICAqIHRvIGF2b2lkIGFsbG9jYXRpbmcgYSBsYXJnZSBzdHJtLT5vdXRwdXQgYnVmZmVyIGFuZCBjb3B5aW5nIGludG8gaXQuCiAgICogKFNlZSBhbHNvIHJlYWRfYnVmKCkpLgogICAqLwogIGNvbnN0IGZsdXNoX3BlbmRpbmcgPSAoc3RybSkgPT4gewogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CgogICAgLy9fdHJfZmx1c2hfYml0cyhzKTsKICAgIGxldCBsZW4gPSBzLnBlbmRpbmc7CiAgICBpZiAobGVuID4gc3RybS5hdmFpbF9vdXQpIHsKICAgICAgbGVuID0gc3RybS5hdmFpbF9vdXQ7CiAgICB9CiAgICBpZiAobGVuID09PSAwKSB7IHJldHVybjsgfQoKICAgIHN0cm0ub3V0cHV0LnNldChzLnBlbmRpbmdfYnVmLnN1YmFycmF5KHMucGVuZGluZ19vdXQsIHMucGVuZGluZ19vdXQgKyBsZW4pLCBzdHJtLm5leHRfb3V0KTsKICAgIHN0cm0ubmV4dF9vdXQgKz0gbGVuOwogICAgcy5wZW5kaW5nX291dCArPSBsZW47CiAgICBzdHJtLnRvdGFsX291dCArPSBsZW47CiAgICBzdHJtLmF2YWlsX291dCAtPSBsZW47CiAgICBzLnBlbmRpbmcgLT0gbGVuOwogICAgaWYgKHMucGVuZGluZyA9PT0gMCkgewogICAgICBzLnBlbmRpbmdfb3V0ID0gMDsKICAgIH0KICB9OwoKCiAgY29uc3QgZmx1c2hfYmxvY2tfb25seSA9IChzLCBsYXN0KSA9PiB7CiAgICBfdHJfZmx1c2hfYmxvY2socywgKHMuYmxvY2tfc3RhcnQgPj0gMCA/IHMuYmxvY2tfc3RhcnQgOiAtMSksIHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0LCBsYXN0KTsKICAgIHMuYmxvY2tfc3RhcnQgPSBzLnN0cnN0YXJ0OwogICAgZmx1c2hfcGVuZGluZyhzLnN0cm0pOwogIH07CgoKICBjb25zdCBwdXRfYnl0ZSA9IChzLCBiKSA9PiB7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IGI7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBQdXQgYSBzaG9ydCBpbiB0aGUgcGVuZGluZyBidWZmZXIuIFRoZSAxNi1iaXQgdmFsdWUgaXMgcHV0IGluIE1TQiBvcmRlci4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBzdHJlYW0gc3RhdGUgaXMgY29ycmVjdCBhbmQgdGhlcmUgaXMgZW5vdWdoIHJvb20gaW4KICAgKiBwZW5kaW5nX2J1Zi4KICAgKi8KICBjb25zdCBwdXRTaG9ydE1TQiA9IChzLCBiKSA9PiB7CgogICAgLy8gIHB1dF9ieXRlKHMsIChCeXRlKShiID4+IDgpKTsKICAvLyAgcHV0X2J5dGUocywgKEJ5dGUpKGIgJiAweGZmKSk7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IChiID4+PiA4KSAmIDB4ZmY7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IGIgJiAweGZmOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBSZWFkIGEgbmV3IGJ1ZmZlciBmcm9tIHRoZSBjdXJyZW50IGlucHV0IHN0cmVhbSwgdXBkYXRlIHRoZSBhZGxlcjMyCiAgICogYW5kIHRvdGFsIG51bWJlciBvZiBieXRlcyByZWFkLiAgQWxsIGRlZmxhdGUoKSBpbnB1dCBnb2VzIHRocm91Z2gKICAgKiB0aGlzIGZ1bmN0aW9uIHNvIHNvbWUgYXBwbGljYXRpb25zIG1heSB3aXNoIHRvIG1vZGlmeSBpdCB0byBhdm9pZAogICAqIGFsbG9jYXRpbmcgYSBsYXJnZSBzdHJtLT5pbnB1dCBidWZmZXIgYW5kIGNvcHlpbmcgZnJvbSBpdC4KICAgKiAoU2VlIGFsc28gZmx1c2hfcGVuZGluZygpKS4KICAgKi8KICBjb25zdCByZWFkX2J1ZiA9IChzdHJtLCBidWYsIHN0YXJ0LCBzaXplKSA9PiB7CgogICAgbGV0IGxlbiA9IHN0cm0uYXZhaWxfaW47CgogICAgaWYgKGxlbiA+IHNpemUpIHsgbGVuID0gc2l6ZTsgfQogICAgaWYgKGxlbiA9PT0gMCkgeyByZXR1cm4gMDsgfQoKICAgIHN0cm0uYXZhaWxfaW4gLT0gbGVuOwoKICAgIC8vIHptZW1jcHkoYnVmLCBzdHJtLT5uZXh0X2luLCBsZW4pOwogICAgYnVmLnNldChzdHJtLmlucHV0LnN1YmFycmF5KHN0cm0ubmV4dF9pbiwgc3RybS5uZXh0X2luICsgbGVuKSwgc3RhcnQpOwogICAgaWYgKHN0cm0uc3RhdGUud3JhcCA9PT0gMSkgewogICAgICBzdHJtLmFkbGVyID0gYWRsZXIzMl8xKHN0cm0uYWRsZXIsIGJ1ZiwgbGVuLCBzdGFydCk7CiAgICB9CgogICAgZWxzZSBpZiAoc3RybS5zdGF0ZS53cmFwID09PSAyKSB7CiAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMl8xKHN0cm0uYWRsZXIsIGJ1ZiwgbGVuLCBzdGFydCk7CiAgICB9CgogICAgc3RybS5uZXh0X2luICs9IGxlbjsKICAgIHN0cm0udG90YWxfaW4gKz0gbGVuOwoKICAgIHJldHVybiBsZW47CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNldCBtYXRjaF9zdGFydCB0byB0aGUgbG9uZ2VzdCBtYXRjaCBzdGFydGluZyBhdCB0aGUgZ2l2ZW4gc3RyaW5nIGFuZAogICAqIHJldHVybiBpdHMgbGVuZ3RoLiBNYXRjaGVzIHNob3J0ZXIgb3IgZXF1YWwgdG8gcHJldl9sZW5ndGggYXJlIGRpc2NhcmRlZCwKICAgKiBpbiB3aGljaCBjYXNlIHRoZSByZXN1bHQgaXMgZXF1YWwgdG8gcHJldl9sZW5ndGggYW5kIG1hdGNoX3N0YXJ0IGlzCiAgICogZ2FyYmFnZS4KICAgKiBJTiBhc3NlcnRpb25zOiBjdXJfbWF0Y2ggaXMgdGhlIGhlYWQgb2YgdGhlIGhhc2ggY2hhaW4gZm9yIHRoZSBjdXJyZW50CiAgICogICBzdHJpbmcgKHN0cnN0YXJ0KSBhbmQgaXRzIGRpc3RhbmNlIGlzIDw9IE1BWF9ESVNULCBhbmQgcHJldl9sZW5ndGggPj0gMQogICAqIE9VVCBhc3NlcnRpb246IHRoZSBtYXRjaCBsZW5ndGggaXMgbm90IGdyZWF0ZXIgdGhhbiBzLT5sb29rYWhlYWQuCiAgICovCiAgY29uc3QgbG9uZ2VzdF9tYXRjaCA9IChzLCBjdXJfbWF0Y2gpID0+IHsKCiAgICBsZXQgY2hhaW5fbGVuZ3RoID0gcy5tYXhfY2hhaW5fbGVuZ3RoOyAgICAgIC8qIG1heCBoYXNoIGNoYWluIGxlbmd0aCAqLwogICAgbGV0IHNjYW4gPSBzLnN0cnN0YXJ0OyAvKiBjdXJyZW50IHN0cmluZyAqLwogICAgbGV0IG1hdGNoOyAgICAgICAgICAgICAgICAgICAgICAgLyogbWF0Y2hlZCBzdHJpbmcgKi8KICAgIGxldCBsZW47ICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbGVuZ3RoIG9mIGN1cnJlbnQgbWF0Y2ggKi8KICAgIGxldCBiZXN0X2xlbiA9IHMucHJldl9sZW5ndGg7ICAgICAgICAgICAgICAvKiBiZXN0IG1hdGNoIGxlbmd0aCBzbyBmYXIgKi8KICAgIGxldCBuaWNlX21hdGNoID0gcy5uaWNlX21hdGNoOyAgICAgICAgICAgICAvKiBzdG9wIGlmIG1hdGNoIGxvbmcgZW5vdWdoICovCiAgICBjb25zdCBsaW1pdCA9IChzLnN0cnN0YXJ0ID4gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkpID8KICAgICAgICBzLnN0cnN0YXJ0IC0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgOiAwLypOSUwqLzsKCiAgICBjb25zdCBfd2luID0gcy53aW5kb3c7IC8vIHNob3J0Y3V0CgogICAgY29uc3Qgd21hc2sgPSBzLndfbWFzazsKICAgIGNvbnN0IHByZXYgID0gcy5wcmV2OwoKICAgIC8qIFN0b3Agd2hlbiBjdXJfbWF0Y2ggYmVjb21lcyA8PSBsaW1pdC4gVG8gc2ltcGxpZnkgdGhlIGNvZGUsCiAgICAgKiB3ZSBwcmV2ZW50IG1hdGNoZXMgd2l0aCB0aGUgc3RyaW5nIG9mIHdpbmRvdyBpbmRleCAwLgogICAgICovCgogICAgY29uc3Qgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgIGxldCBzY2FuX2VuZDEgID0gX3dpbltzY2FuICsgYmVzdF9sZW4gLSAxXTsKICAgIGxldCBzY2FuX2VuZCAgID0gX3dpbltzY2FuICsgYmVzdF9sZW5dOwoKICAgIC8qIFRoZSBjb2RlIGlzIG9wdGltaXplZCBmb3IgSEFTSF9CSVRTID49IDggYW5kIE1BWF9NQVRDSC0yIG11bHRpcGxlIG9mIDE2LgogICAgICogSXQgaXMgZWFzeSB0byBnZXQgcmlkIG9mIHRoaXMgb3B0aW1pemF0aW9uIGlmIG5lY2Vzc2FyeS4KICAgICAqLwogICAgLy8gQXNzZXJ0KHMtPmhhc2hfYml0cyA+PSA4ICYmIE1BWF9NQVRDSCA9PSAyNTgsICJDb2RlIHRvbyBjbGV2ZXIiKTsKCiAgICAvKiBEbyBub3Qgd2FzdGUgdG9vIG11Y2ggdGltZSBpZiB3ZSBhbHJlYWR5IGhhdmUgYSBnb29kIG1hdGNoOiAqLwogICAgaWYgKHMucHJldl9sZW5ndGggPj0gcy5nb29kX21hdGNoKSB7CiAgICAgIGNoYWluX2xlbmd0aCA+Pj0gMjsKICAgIH0KICAgIC8qIERvIG5vdCBsb29rIGZvciBtYXRjaGVzIGJleW9uZCB0aGUgZW5kIG9mIHRoZSBpbnB1dC4gVGhpcyBpcyBuZWNlc3NhcnkKICAgICAqIHRvIG1ha2UgZGVmbGF0ZSBkZXRlcm1pbmlzdGljLgogICAgICovCiAgICBpZiAobmljZV9tYXRjaCA+IHMubG9va2FoZWFkKSB7IG5pY2VfbWF0Y2ggPSBzLmxvb2thaGVhZDsgfQoKICAgIC8vIEFzc2VydCgodWxnKXMtPnN0cnN0YXJ0IDw9IHMtPndpbmRvd19zaXplLU1JTl9MT09LQUhFQUQsICJuZWVkIGxvb2thaGVhZCIpOwoKICAgIGRvIHsKICAgICAgLy8gQXNzZXJ0KGN1cl9tYXRjaCA8IHMtPnN0cnN0YXJ0LCAibm8gZnV0dXJlIik7CiAgICAgIG1hdGNoID0gY3VyX21hdGNoOwoKICAgICAgLyogU2tpcCB0byBuZXh0IG1hdGNoIGlmIHRoZSBtYXRjaCBsZW5ndGggY2Fubm90IGluY3JlYXNlCiAgICAgICAqIG9yIGlmIHRoZSBtYXRjaCBsZW5ndGggaXMgbGVzcyB0aGFuIDIuICBOb3RlIHRoYXQgdGhlIGNoZWNrcyBiZWxvdwogICAgICAgKiBmb3IgaW5zdWZmaWNpZW50IGxvb2thaGVhZCBvbmx5IG9jY3VyIG9jY2FzaW9uYWxseSBmb3IgcGVyZm9ybWFuY2UKICAgICAgICogcmVhc29ucy4gIFRoZXJlZm9yZSB1bmluaXRpYWxpemVkIG1lbW9yeSB3aWxsIGJlIGFjY2Vzc2VkLCBhbmQKICAgICAgICogY29uZGl0aW9uYWwganVtcHMgd2lsbCBiZSBtYWRlIHRoYXQgZGVwZW5kIG9uIHRob3NlIHZhbHVlcy4KICAgICAgICogSG93ZXZlciB0aGUgbGVuZ3RoIG9mIHRoZSBtYXRjaCBpcyBsaW1pdGVkIHRvIHRoZSBsb29rYWhlYWQsIHNvCiAgICAgICAqIHRoZSBvdXRwdXQgb2YgZGVmbGF0ZSBpcyBub3QgYWZmZWN0ZWQgYnkgdGhlIHVuaW5pdGlhbGl6ZWQgdmFsdWVzLgogICAgICAgKi8KCiAgICAgIGlmIChfd2luW21hdGNoICsgYmVzdF9sZW5dICAgICAhPT0gc2Nhbl9lbmQgIHx8CiAgICAgICAgICBfd2luW21hdGNoICsgYmVzdF9sZW4gLSAxXSAhPT0gc2Nhbl9lbmQxIHx8CiAgICAgICAgICBfd2luW21hdGNoXSAgICAgICAgICAgICAgICAhPT0gX3dpbltzY2FuXSB8fAogICAgICAgICAgX3dpblsrK21hdGNoXSAgICAgICAgICAgICAgIT09IF93aW5bc2NhbiArIDFdKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8qIFRoZSBjaGVjayBhdCBiZXN0X2xlbi0xIGNhbiBiZSByZW1vdmVkIGJlY2F1c2UgaXQgd2lsbCBiZSBtYWRlCiAgICAgICAqIGFnYWluIGxhdGVyLiAoVGhpcyBoZXVyaXN0aWMgaXMgbm90IGFsd2F5cyBhIHdpbi4pCiAgICAgICAqIEl0IGlzIG5vdCBuZWNlc3NhcnkgdG8gY29tcGFyZSBzY2FuWzJdIGFuZCBtYXRjaFsyXSBzaW5jZSB0aGV5CiAgICAgICAqIGFyZSBhbHdheXMgZXF1YWwgd2hlbiB0aGUgb3RoZXIgYnl0ZXMgbWF0Y2gsIGdpdmVuIHRoYXQKICAgICAgICogdGhlIGhhc2gga2V5cyBhcmUgZXF1YWwgYW5kIHRoYXQgSEFTSF9CSVRTID49IDguCiAgICAgICAqLwogICAgICBzY2FuICs9IDI7CiAgICAgIG1hdGNoKys7CiAgICAgIC8vIEFzc2VydCgqc2NhbiA9PSAqbWF0Y2gsICJtYXRjaFsyXT8iKTsKCiAgICAgIC8qIFdlIGNoZWNrIGZvciBpbnN1ZmZpY2llbnQgbG9va2FoZWFkIG9ubHkgZXZlcnkgOHRoIGNvbXBhcmlzb247CiAgICAgICAqIHRoZSAyNTZ0aCBjaGVjayB3aWxsIGJlIG1hZGUgYXQgc3Ryc3RhcnQrMjU4LgogICAgICAgKi8KICAgICAgZG8gewogICAgICAgIC8qanNoaW50IG5vZW1wdHk6ZmFsc2UqLwogICAgICB9IHdoaWxlIChfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICAgIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYKICAgICAgICAgICAgICAgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJgogICAgICAgICAgICAgICBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICAgIHNjYW4gPCBzdHJlbmQpOwoKICAgICAgLy8gQXNzZXJ0KHNjYW4gPD0gcy0+d2luZG93Kyh1bnNpZ25lZCkocy0+d2luZG93X3NpemUtMSksICJ3aWxkIHNjYW4iKTsKCiAgICAgIGxlbiA9IE1BWF9NQVRDSCAtIChzdHJlbmQgLSBzY2FuKTsKICAgICAgc2NhbiA9IHN0cmVuZCAtIE1BWF9NQVRDSDsKCiAgICAgIGlmIChsZW4gPiBiZXN0X2xlbikgewogICAgICAgIHMubWF0Y2hfc3RhcnQgPSBjdXJfbWF0Y2g7CiAgICAgICAgYmVzdF9sZW4gPSBsZW47CiAgICAgICAgaWYgKGxlbiA+PSBuaWNlX21hdGNoKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc2Nhbl9lbmQxICA9IF93aW5bc2NhbiArIGJlc3RfbGVuIC0gMV07CiAgICAgICAgc2Nhbl9lbmQgICA9IF93aW5bc2NhbiArIGJlc3RfbGVuXTsKICAgICAgfQogICAgfSB3aGlsZSAoKGN1cl9tYXRjaCA9IHByZXZbY3VyX21hdGNoICYgd21hc2tdKSA+IGxpbWl0ICYmIC0tY2hhaW5fbGVuZ3RoICE9PSAwKTsKCiAgICBpZiAoYmVzdF9sZW4gPD0gcy5sb29rYWhlYWQpIHsKICAgICAgcmV0dXJuIGJlc3RfbGVuOwogICAgfQogICAgcmV0dXJuIHMubG9va2FoZWFkOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGaWxsIHRoZSB3aW5kb3cgd2hlbiB0aGUgbG9va2FoZWFkIGJlY29tZXMgaW5zdWZmaWNpZW50LgogICAqIFVwZGF0ZXMgc3Ryc3RhcnQgYW5kIGxvb2thaGVhZC4KICAgKgogICAqIElOIGFzc2VydGlvbjogbG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRAogICAqIE9VVCBhc3NlcnRpb25zOiBzdHJzdGFydCA8PSB3aW5kb3dfc2l6ZS1NSU5fTE9PS0FIRUFECiAgICogICAgQXQgbGVhc3Qgb25lIGJ5dGUgaGFzIGJlZW4gcmVhZCwgb3IgYXZhaWxfaW4gPT0gMDsgcmVhZHMgYXJlCiAgICogICAgcGVyZm9ybWVkIGZvciBhdCBsZWFzdCB0d28gYnl0ZXMgKHJlcXVpcmVkIGZvciB0aGUgemlwIHRyYW5zbGF0ZV9lb2wKICAgKiAgICBvcHRpb24gLS0gbm90IHN1cHBvcnRlZCBoZXJlKS4KICAgKi8KICBjb25zdCBmaWxsX3dpbmRvdyA9IChzKSA9PiB7CgogICAgY29uc3QgX3dfc2l6ZSA9IHMud19zaXplOwogICAgbGV0IHAsIG4sIG0sIG1vcmUsIHN0cjsKCiAgICAvL0Fzc2VydChzLT5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFELCAiYWxyZWFkeSBlbm91Z2ggbG9va2FoZWFkIik7CgogICAgZG8gewogICAgICBtb3JlID0gcy53aW5kb3dfc2l6ZSAtIHMubG9va2FoZWFkIC0gcy5zdHJzdGFydDsKCiAgICAgIC8vIEpTIGludHMgaGF2ZSAzMiBiaXQsIGJsb2NrIGJlbG93IG5vdCBuZWVkZWQKICAgICAgLyogRGVhbCB3aXRoICFAIyQlIDY0SyBsaW1pdDogKi8KICAgICAgLy9pZiAoc2l6ZW9mKGludCkgPD0gMikgewogICAgICAvLyAgICBpZiAobW9yZSA9PSAwICYmIHMtPnN0cnN0YXJ0ID09IDAgJiYgcy0+bG9va2FoZWFkID09IDApIHsKICAgICAgLy8gICAgICAgIG1vcmUgPSB3c2l6ZTsKICAgICAgLy8KICAgICAgLy8gIH0gZWxzZSBpZiAobW9yZSA9PSAodW5zaWduZWQpKC0xKSkgewogICAgICAvLyAgICAgICAgLyogVmVyeSB1bmxpa2VseSwgYnV0IHBvc3NpYmxlIG9uIDE2IGJpdCBtYWNoaW5lIGlmCiAgICAgIC8vICAgICAgICAgKiBzdHJzdGFydCA9PSAwICYmIGxvb2thaGVhZCA9PSAxIChpbnB1dCBkb25lIGEgYnl0ZSBhdCB0aW1lKQogICAgICAvLyAgICAgICAgICovCiAgICAgIC8vICAgICAgICBtb3JlLS07CiAgICAgIC8vICAgIH0KICAgICAgLy99CgoKICAgICAgLyogSWYgdGhlIHdpbmRvdyBpcyBhbG1vc3QgZnVsbCBhbmQgdGhlcmUgaXMgaW5zdWZmaWNpZW50IGxvb2thaGVhZCwKICAgICAgICogbW92ZSB0aGUgdXBwZXIgaGFsZiB0byB0aGUgbG93ZXIgb25lIHRvIG1ha2Ugcm9vbSBpbiB0aGUgdXBwZXIgaGFsZi4KICAgICAgICovCiAgICAgIGlmIChzLnN0cnN0YXJ0ID49IF93X3NpemUgKyAoX3dfc2l6ZSAtIE1JTl9MT09LQUhFQUQpKSB7CgogICAgICAgIHMud2luZG93LnNldChzLndpbmRvdy5zdWJhcnJheShfd19zaXplLCBfd19zaXplICsgX3dfc2l6ZSksIDApOwogICAgICAgIHMubWF0Y2hfc3RhcnQgLT0gX3dfc2l6ZTsKICAgICAgICBzLnN0cnN0YXJ0IC09IF93X3NpemU7CiAgICAgICAgLyogd2Ugbm93IGhhdmUgc3Ryc3RhcnQgPj0gTUFYX0RJU1QgKi8KICAgICAgICBzLmJsb2NrX3N0YXJ0IC09IF93X3NpemU7CgogICAgICAgIC8qIFNsaWRlIHRoZSBoYXNoIHRhYmxlIChjb3VsZCBiZSBhdm9pZGVkIHdpdGggMzIgYml0IHZhbHVlcwogICAgICAgICBhdCB0aGUgZXhwZW5zZSBvZiBtZW1vcnkgdXNhZ2UpLiBXZSBzbGlkZSBldmVuIHdoZW4gbGV2ZWwgPT0gMAogICAgICAgICB0byBrZWVwIHRoZSBoYXNoIHRhYmxlIGNvbnNpc3RlbnQgaWYgd2Ugc3dpdGNoIGJhY2sgdG8gbGV2ZWwgPiAwCiAgICAgICAgIGxhdGVyLiAoVXNpbmcgbGV2ZWwgMCBwZXJtYW5lbnRseSBpcyBub3QgYW4gb3B0aW1hbCB1c2FnZSBvZgogICAgICAgICB6bGliLCBzbyB3ZSBkb24ndCBjYXJlIGFib3V0IHRoaXMgcGF0aG9sb2dpY2FsIGNhc2UuKQogICAgICAgICAqLwoKICAgICAgICBuID0gcy5oYXNoX3NpemU7CiAgICAgICAgcCA9IG47CgogICAgICAgIGRvIHsKICAgICAgICAgIG0gPSBzLmhlYWRbLS1wXTsKICAgICAgICAgIHMuaGVhZFtwXSA9IChtID49IF93X3NpemUgPyBtIC0gX3dfc2l6ZSA6IDApOwogICAgICAgIH0gd2hpbGUgKC0tbik7CgogICAgICAgIG4gPSBfd19zaXplOwogICAgICAgIHAgPSBuOwoKICAgICAgICBkbyB7CiAgICAgICAgICBtID0gcy5wcmV2Wy0tcF07CiAgICAgICAgICBzLnByZXZbcF0gPSAobSA+PSBfd19zaXplID8gbSAtIF93X3NpemUgOiAwKTsKICAgICAgICAgIC8qIElmIG4gaXMgbm90IG9uIGFueSBoYXNoIGNoYWluLCBwcmV2W25dIGlzIGdhcmJhZ2UgYnV0CiAgICAgICAgICAgKiBpdHMgdmFsdWUgd2lsbCBuZXZlciBiZSB1c2VkLgogICAgICAgICAgICovCiAgICAgICAgfSB3aGlsZSAoLS1uKTsKCiAgICAgICAgbW9yZSArPSBfd19zaXplOwogICAgICB9CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfaW4gPT09IDApIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgLyogSWYgdGhlcmUgd2FzIG5vIHNsaWRpbmc6CiAgICAgICAqICAgIHN0cnN0YXJ0IDw9IFdTSVpFK01BWF9ESVNULTEgJiYgbG9va2FoZWFkIDw9IE1JTl9MT09LQUhFQUQgLSAxICYmCiAgICAgICAqICAgIG1vcmUgPT0gd2luZG93X3NpemUgLSBsb29rYWhlYWQgLSBzdHJzdGFydAogICAgICAgKiA9PiBtb3JlID49IHdpbmRvd19zaXplIC0gKE1JTl9MT09LQUhFQUQtMSArIFdTSVpFICsgTUFYX0RJU1QtMSkKICAgICAgICogPT4gbW9yZSA+PSB3aW5kb3dfc2l6ZSAtIDIqV1NJWkUgKyAyCiAgICAgICAqIEluIHRoZSBCSUdfTUVNIG9yIE1NQVAgY2FzZSAobm90IHlldCBzdXBwb3J0ZWQpLAogICAgICAgKiAgIHdpbmRvd19zaXplID09IGlucHV0X3NpemUgKyBNSU5fTE9PS0FIRUFEICAmJgogICAgICAgKiAgIHN0cnN0YXJ0ICsgcy0+bG9va2FoZWFkIDw9IGlucHV0X3NpemUgPT4gbW9yZSA+PSBNSU5fTE9PS0FIRUFELgogICAgICAgKiBPdGhlcndpc2UsIHdpbmRvd19zaXplID09IDIqV1NJWkUgc28gbW9yZSA+PSAyLgogICAgICAgKiBJZiB0aGVyZSB3YXMgc2xpZGluZywgbW9yZSA+PSBXU0laRS4gU28gaW4gYWxsIGNhc2VzLCBtb3JlID49IDIuCiAgICAgICAqLwogICAgICAvL0Fzc2VydChtb3JlID49IDIsICJtb3JlIDwgMiIpOwogICAgICBuID0gcmVhZF9idWYocy5zdHJtLCBzLndpbmRvdywgcy5zdHJzdGFydCArIHMubG9va2FoZWFkLCBtb3JlKTsKICAgICAgcy5sb29rYWhlYWQgKz0gbjsKCiAgICAgIC8qIEluaXRpYWxpemUgdGhlIGhhc2ggdmFsdWUgbm93IHRoYXQgd2UgaGF2ZSBzb21lIGlucHV0OiAqLwogICAgICBpZiAocy5sb29rYWhlYWQgKyBzLmluc2VydCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBzdHIgPSBzLnN0cnN0YXJ0IC0gcy5pbnNlcnQ7CiAgICAgICAgcy5pbnNfaCA9IHMud2luZG93W3N0cl07CgogICAgICAgIC8qIFVQREFURV9IQVNIKHMsIHMtPmluc19oLCBzLT53aW5kb3dbc3RyICsgMV0pOyAqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3N0ciArIDFdKTsKICAvLyNpZiBNSU5fTUFUQ0ggIT0gMwogIC8vICAgICAgICBDYWxsIHVwZGF0ZV9oYXNoKCkgTUlOX01BVENILTMgbW9yZSB0aW1lcwogIC8vI2VuZGlmCiAgICAgICAgd2hpbGUgKHMuaW5zZXJ0KSB7CiAgICAgICAgICAvKiBVUERBVEVfSEFTSChzLCBzLT5pbnNfaCwgcy0+d2luZG93W3N0ciArIE1JTl9NQVRDSC0xXSk7ICovCiAgICAgICAgICBzLmluc19oID0gSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzdHIgKyBNSU5fTUFUQ0ggLSAxXSk7CgogICAgICAgICAgcy5wcmV2W3N0ciAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHN0cjsKICAgICAgICAgIHN0cisrOwogICAgICAgICAgcy5pbnNlcnQtLTsKICAgICAgICAgIGlmIChzLmxvb2thaGVhZCArIHMuaW5zZXJ0IDwgTUlOX01BVENIKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAvKiBJZiB0aGUgd2hvbGUgaW5wdXQgaGFzIGxlc3MgdGhhbiBNSU5fTUFUQ0ggYnl0ZXMsIGluc19oIGlzIGdhcmJhZ2UsCiAgICAgICAqIGJ1dCB0aGlzIGlzIG5vdCBpbXBvcnRhbnQgc2luY2Ugb25seSBsaXRlcmFsIGJ5dGVzIHdpbGwgYmUgZW1pdHRlZC4KICAgICAgICovCgogICAgfSB3aGlsZSAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIHMuc3RybS5hdmFpbF9pbiAhPT0gMCk7CgogICAgLyogSWYgdGhlIFdJTl9JTklUIGJ5dGVzIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGN1cnJlbnQgZGF0YSBoYXZlIG5ldmVyIGJlZW4KICAgICAqIHdyaXR0ZW4sIHRoZW4gemVybyB0aG9zZSBieXRlcyBpbiBvcmRlciB0byBhdm9pZCBtZW1vcnkgY2hlY2sgcmVwb3J0cyBvZgogICAgICogdGhlIHVzZSBvZiB1bmluaXRpYWxpemVkIChvciB1bmluaXRpYWxpc2VkIGFzIEp1bGlhbiB3cml0ZXMpIGJ5dGVzIGJ5CiAgICAgKiB0aGUgbG9uZ2VzdCBtYXRjaCByb3V0aW5lcy4gIFVwZGF0ZSB0aGUgaGlnaCB3YXRlciBtYXJrIGZvciB0aGUgbmV4dAogICAgICogdGltZSB0aHJvdWdoIGhlcmUuICBXSU5fSU5JVCBpcyBzZXQgdG8gTUFYX01BVENIIHNpbmNlIHRoZSBsb25nZXN0IG1hdGNoCiAgICAgKiByb3V0aW5lcyBhbGxvdyBzY2FubmluZyB0byBzdHJzdGFydCArIE1BWF9NQVRDSCwgaWdub3JpbmcgbG9va2FoZWFkLgogICAgICovCiAgLy8gIGlmIChzLmhpZ2hfd2F0ZXIgPCBzLndpbmRvd19zaXplKSB7CiAgLy8gICAgY29uc3QgY3VyciA9IHMuc3Ryc3RhcnQgKyBzLmxvb2thaGVhZDsKICAvLyAgICBsZXQgaW5pdCA9IDA7CiAgLy8KICAvLyAgICBpZiAocy5oaWdoX3dhdGVyIDwgY3VycikgewogIC8vICAgICAgLyogUHJldmlvdXMgaGlnaCB3YXRlciBtYXJrIGJlbG93IGN1cnJlbnQgZGF0YSAtLSB6ZXJvIFdJTl9JTklUCiAgLy8gICAgICAgKiBieXRlcyBvciB1cCB0byBlbmQgb2Ygd2luZG93LCB3aGljaGV2ZXIgaXMgbGVzcy4KICAvLyAgICAgICAqLwogIC8vICAgICAgaW5pdCA9IHMud2luZG93X3NpemUgLSBjdXJyOwogIC8vICAgICAgaWYgKGluaXQgPiBXSU5fSU5JVCkKICAvLyAgICAgICAgaW5pdCA9IFdJTl9JTklUOwogIC8vICAgICAgem1lbXplcm8ocy0+d2luZG93ICsgY3VyciwgKHVuc2lnbmVkKWluaXQpOwogIC8vICAgICAgcy0+aGlnaF93YXRlciA9IGN1cnIgKyBpbml0OwogIC8vICAgIH0KICAvLyAgICBlbHNlIGlmIChzLT5oaWdoX3dhdGVyIDwgKHVsZyljdXJyICsgV0lOX0lOSVQpIHsKICAvLyAgICAgIC8qIEhpZ2ggd2F0ZXIgbWFyayBhdCBvciBhYm92ZSBjdXJyZW50IGRhdGEsIGJ1dCBiZWxvdyBjdXJyZW50IGRhdGEKICAvLyAgICAgICAqIHBsdXMgV0lOX0lOSVQgLS0gemVybyBvdXQgdG8gY3VycmVudCBkYXRhIHBsdXMgV0lOX0lOSVQsIG9yIHVwCiAgLy8gICAgICAgKiB0byBlbmQgb2Ygd2luZG93LCB3aGljaGV2ZXIgaXMgbGVzcy4KICAvLyAgICAgICAqLwogIC8vICAgICAgaW5pdCA9ICh1bGcpY3VyciArIFdJTl9JTklUIC0gcy0+aGlnaF93YXRlcjsKICAvLyAgICAgIGlmIChpbml0ID4gcy0+d2luZG93X3NpemUgLSBzLT5oaWdoX3dhdGVyKQogIC8vICAgICAgICBpbml0ID0gcy0+d2luZG93X3NpemUgLSBzLT5oaWdoX3dhdGVyOwogIC8vICAgICAgem1lbXplcm8ocy0+d2luZG93ICsgcy0+aGlnaF93YXRlciwgKHVuc2lnbmVkKWluaXQpOwogIC8vICAgICAgcy0+aGlnaF93YXRlciArPSBpbml0OwogIC8vICAgIH0KICAvLyAgfQogIC8vCiAgLy8gIEFzc2VydCgodWxnKXMtPnN0cnN0YXJ0IDw9IHMtPndpbmRvd19zaXplIC0gTUlOX0xPT0tBSEVBRCwKICAvLyAgICAibm90IGVub3VnaCByb29tIGZvciBzZWFyY2giKTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb3B5IHdpdGhvdXQgY29tcHJlc3Npb24gYXMgbXVjaCBhcyBwb3NzaWJsZSBmcm9tIHRoZSBpbnB1dCBzdHJlYW0sIHJldHVybgogICAqIHRoZSBjdXJyZW50IGJsb2NrIHN0YXRlLgogICAqIFRoaXMgZnVuY3Rpb24gZG9lcyBub3QgaW5zZXJ0IG5ldyBzdHJpbmdzIGluIHRoZSBkaWN0aW9uYXJ5IHNpbmNlCiAgICogdW5jb21wcmVzc2libGUgZGF0YSBpcyBwcm9iYWJseSBub3QgdXNlZnVsLiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQKICAgKiBvbmx5IGZvciB0aGUgbGV2ZWw9MCBjb21wcmVzc2lvbiBvcHRpb24uCiAgICogTk9URTogdGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgb3B0aW1pemVkIHRvIGF2b2lkIGV4dHJhIGNvcHlpbmcgZnJvbQogICAqIHdpbmRvdyB0byBwZW5kaW5nX2J1Zi4KICAgKi8KICBjb25zdCBkZWZsYXRlX3N0b3JlZCA9IChzLCBmbHVzaCkgPT4gewoKICAgIC8qIFN0b3JlZCBibG9ja3MgYXJlIGxpbWl0ZWQgdG8gMHhmZmZmIGJ5dGVzLCBwZW5kaW5nX2J1ZiBpcyBsaW1pdGVkCiAgICAgKiB0byBwZW5kaW5nX2J1Zl9zaXplLCBhbmQgZWFjaCBzdG9yZWQgYmxvY2sgaGFzIGEgNSBieXRlIGhlYWRlcjoKICAgICAqLwogICAgbGV0IG1heF9ibG9ja19zaXplID0gMHhmZmZmOwoKICAgIGlmIChtYXhfYmxvY2tfc2l6ZSA+IHMucGVuZGluZ19idWZfc2l6ZSAtIDUpIHsKICAgICAgbWF4X2Jsb2NrX3NpemUgPSBzLnBlbmRpbmdfYnVmX3NpemUgLSA1OwogICAgfQoKICAgIC8qIENvcHkgYXMgbXVjaCBhcyBwb3NzaWJsZSBmcm9tIGlucHV0IHRvIG91dHB1dDogKi8KICAgIGZvciAoOzspIHsKICAgICAgLyogRmlsbCB0aGUgd2luZG93IGFzIG11Y2ggYXMgcG9zc2libGU6ICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8PSAxKSB7CgogICAgICAgIC8vQXNzZXJ0KHMtPnN0cnN0YXJ0IDwgcy0+d19zaXplK01BWF9ESVNUKHMpIHx8CiAgICAgICAgLy8gIHMtPmJsb2NrX3N0YXJ0ID49IChsb25nKXMtPndfc2l6ZSwgInNsaWRlIHRvbyBsYXRlIik7CiAgLy8gICAgICBpZiAoIShzLnN0cnN0YXJ0IDwgcy53X3NpemUgKyAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSB8fAogIC8vICAgICAgICBzLmJsb2NrX3N0YXJ0ID49IHMud19zaXplKSkgewogIC8vICAgICAgICB0aHJvdyAgbmV3IEVycm9yKCJzbGlkZSB0b28gbGF0ZSIpOwogIC8vICAgICAgfQoKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDAgJiYgZmx1c2ggPT09IFpfTk9fRkxVU0gkMikgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CgogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICAgIH0KICAgICAgLy9Bc3NlcnQocy0+YmxvY2tfc3RhcnQgPj0gMEwsICJibG9jayBnb25lIik7CiAgLy8gICAgaWYgKHMuYmxvY2tfc3RhcnQgPCAwKSB0aHJvdyBuZXcgRXJyb3IoImJsb2NrIGdvbmUiKTsKCiAgICAgIHMuc3Ryc3RhcnQgKz0gcy5sb29rYWhlYWQ7CiAgICAgIHMubG9va2FoZWFkID0gMDsKCiAgICAgIC8qIEVtaXQgYSBzdG9yZWQgYmxvY2sgaWYgcGVuZGluZ19idWYgd2lsbCBiZSBmdWxsOiAqLwogICAgICBjb25zdCBtYXhfc3RhcnQgPSBzLmJsb2NrX3N0YXJ0ICsgbWF4X2Jsb2NrX3NpemU7CgogICAgICBpZiAocy5zdHJzdGFydCA9PT0gMCB8fCBzLnN0cnN0YXJ0ID49IG1heF9zdGFydCkgewogICAgICAgIC8qIHN0cnN0YXJ0ID09IDAgaXMgcG9zc2libGUgd2hlbiB3cmFwYXJvdW5kIG9uIDE2LWJpdCBtYWNoaW5lICovCiAgICAgICAgcy5sb29rYWhlYWQgPSBzLnN0cnN0YXJ0IC0gbWF4X3N0YXJ0OwogICAgICAgIHMuc3Ryc3RhcnQgPSBtYXhfc3RhcnQ7CiAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICAvKioqLwoKCiAgICAgIH0KICAgICAgLyogRmx1c2ggaWYgd2UgbWF5IGhhdmUgdG8gc2xpZGUsIG90aGVyd2lzZSBibG9ja19zdGFydCBtYXkgYmVjb21lCiAgICAgICAqIG5lZ2F0aXZlIGFuZCB0aGUgZGF0YSB3aWxsIGJlIGdvbmU6CiAgICAgICAqLwogICAgICBpZiAocy5zdHJzdGFydCAtIHMuYmxvY2tfc3RhcnQgPj0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkpIHsKICAgICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIC8qKiovCiAgICAgIH0KICAgIH0KCiAgICBzLmluc2VydCA9IDA7CgogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQoKICAgIGlmIChzLnN0cnN0YXJ0ID4gcy5ibG9ja19zdGFydCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KCiAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogIH07CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIENvbXByZXNzIGFzIG11Y2ggYXMgcG9zc2libGUgZnJvbSB0aGUgaW5wdXQgc3RyZWFtLCByZXR1cm4gdGhlIGN1cnJlbnQKICAgKiBibG9jayBzdGF0ZS4KICAgKiBUaGlzIGZ1bmN0aW9uIGRvZXMgbm90IHBlcmZvcm0gbGF6eSBldmFsdWF0aW9uIG9mIG1hdGNoZXMgYW5kIGluc2VydHMKICAgKiBuZXcgc3RyaW5ncyBpbiB0aGUgZGljdGlvbmFyeSBvbmx5IGZvciB1bm1hdGNoZWQgc3RyaW5ncyBvciBmb3Igc2hvcnQKICAgKiBtYXRjaGVzLiBJdCBpcyB1c2VkIG9ubHkgZm9yIHRoZSBmYXN0IGNvbXByZXNzaW9uIG9wdGlvbnMuCiAgICovCiAgY29uc3QgZGVmbGF0ZV9mYXN0ID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGhhc2hfaGVhZDsgICAgICAgIC8qIGhlYWQgb2YgdGhlIGhhc2ggY2hhaW4gKi8KICAgIGxldCBiZmx1c2g7ICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIG5leHQgbWF0Y2gsIHBsdXMgTUlOX01BVENIIGJ5dGVzIHRvIGluc2VydCB0aGUKICAgICAgICogc3RyaW5nIGZvbGxvd2luZyB0aGUgbmV4dCBtYXRjaC4KICAgICAgICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDIpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7IC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICAgICAgfQogICAgICB9CgogICAgICAvKiBJbnNlcnQgdGhlIHN0cmluZyB3aW5kb3dbc3Ryc3RhcnQgLi4gc3Ryc3RhcnQrMl0gaW4gdGhlCiAgICAgICAqIGRpY3Rpb25hcnksIGFuZCBzZXQgaGFzaF9oZWFkIHRvIHRoZSBoZWFkIG9mIHRoZSBoYXNoIGNoYWluOgogICAgICAgKi8KICAgICAgaGFzaF9oZWFkID0gMC8qTklMKi87CiAgICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSk7CiAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAvKioqLwogICAgICB9CgogICAgICAvKiBGaW5kIHRoZSBsb25nZXN0IG1hdGNoLCBkaXNjYXJkaW5nIHRob3NlIDw9IHByZXZfbGVuZ3RoLgogICAgICAgKiBBdCB0aGlzIHBvaW50IHdlIGhhdmUgYWx3YXlzIG1hdGNoX2xlbmd0aCA8IE1JTl9NQVRDSAogICAgICAgKi8KICAgICAgaWYgKGhhc2hfaGVhZCAhPT0gMC8qTklMKi8gJiYgKChzLnN0cnN0YXJ0IC0gaGFzaF9oZWFkKSA8PSAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSkpIHsKICAgICAgICAvKiBUbyBzaW1wbGlmeSB0aGUgY29kZSwgd2UgcHJldmVudCBtYXRjaGVzIHdpdGggdGhlIHN0cmluZwogICAgICAgICAqIG9mIHdpbmRvdyBpbmRleCAwIChpbiBwYXJ0aWN1bGFyIHdlIGhhdmUgdG8gYXZvaWQgYSBtYXRjaAogICAgICAgICAqIG9mIHRoZSBzdHJpbmcgd2l0aCBpdHNlbGYgYXQgdGhlIHN0YXJ0IG9mIHRoZSBpbnB1dCBmaWxlKS4KICAgICAgICAgKi8KICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IGxvbmdlc3RfbWF0Y2gocywgaGFzaF9oZWFkKTsKICAgICAgICAvKiBsb25nZXN0X21hdGNoKCkgc2V0cyBtYXRjaF9zdGFydCAqLwogICAgICB9CiAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvLyBjaGVja19tYXRjaChzLCBzLnN0cnN0YXJ0LCBzLm1hdGNoX3N0YXJ0LCBzLm1hdGNoX2xlbmd0aCk7IC8vIGZvciBkZWJ1ZyBvbmx5CgogICAgICAgIC8qKiogX3RyX3RhbGx5X2Rpc3Qocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgcy5tYXRjaF9sZW5ndGggLSBNSU5fTUFUQ0gsIGJmbHVzaCk7ICoqKi8KICAgICAgICBiZmx1c2ggPSBfdHJfdGFsbHkocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsIHMubWF0Y2hfbGVuZ3RoIC0gTUlOX01BVENIKTsKCiAgICAgICAgcy5sb29rYWhlYWQgLT0gcy5tYXRjaF9sZW5ndGg7CgogICAgICAgIC8qIEluc2VydCBuZXcgc3RyaW5ncyBpbiB0aGUgaGFzaCB0YWJsZSBvbmx5IGlmIHRoZSBtYXRjaCBsZW5ndGgKICAgICAgICAgKiBpcyBub3QgdG9vIGxhcmdlLiBUaGlzIHNhdmVzIHRpbWUgYnV0IGRlZ3JhZGVzIGNvbXByZXNzaW9uLgogICAgICAgICAqLwogICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA8PSBzLm1heF9sYXp5X21hdGNoLyptYXhfaW5zZXJ0X2xlbmd0aCovICYmIHMubG9va2FoZWFkID49IE1JTl9NQVRDSCkgewogICAgICAgICAgcy5tYXRjaF9sZW5ndGgtLTsgLyogc3RyaW5nIGF0IHN0cnN0YXJ0IGFscmVhZHkgaW4gdGFibGUgKi8KICAgICAgICAgIGRvIHsKICAgICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgICAgICBzLmluc19oID0gSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pOwogICAgICAgICAgICBoYXNoX2hlYWQgPSBzLnByZXZbcy5zdHJzdGFydCAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAgICAgLyoqKi8KICAgICAgICAgICAgLyogc3Ryc3RhcnQgbmV2ZXIgZXhjZWVkcyBXU0laRS1NQVhfTUFUQ0gsIHNvIHRoZXJlIGFyZQogICAgICAgICAgICAgKiBhbHdheXMgTUlOX01BVENIIGJ5dGVzIGFoZWFkLgogICAgICAgICAgICAgKi8KICAgICAgICAgIH0gd2hpbGUgKC0tcy5tYXRjaF9sZW5ndGggIT09IDApOwogICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgIH0gZWxzZQogICAgICAgIHsKICAgICAgICAgIHMuc3Ryc3RhcnQgKz0gcy5tYXRjaF9sZW5ndGg7CiAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICAgICAgICBzLmluc19oID0gcy53aW5kb3dbcy5zdHJzdGFydF07CiAgICAgICAgICAvKiBVUERBVEVfSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzLnN0cnN0YXJ0KzFdKTsgKi8KICAgICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyAxXSk7CgogIC8vI2lmIE1JTl9NQVRDSCAhPSAzCiAgLy8gICAgICAgICAgICAgICAgQ2FsbCBVUERBVEVfSEFTSCgpIE1JTl9NQVRDSC0zIG1vcmUgdGltZXMKICAvLyNlbmRpZgogICAgICAgICAgLyogSWYgbG9va2FoZWFkIDwgTUlOX01BVENILCBpbnNfaCBpcyBnYXJiYWdlLCBidXQgaXQgZG9lcyBub3QKICAgICAgICAgICAqIG1hdHRlciBzaW5jZSBpdCB3aWxsIGJlIHJlY29tcHV0ZWQgYXQgbmV4dCBkZWZsYXRlIGNhbGwuCiAgICAgICAgICAgKi8KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogTm8gbWF0Y2gsIG91dHB1dCBhIGxpdGVyYWwgYnl0ZSAqLwogICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCIlYyIsIHMud2luZG93W3Muc3Ryc3RhcnRdKSk7CiAgICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnRdLCBiZmx1c2gpOyAqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKCiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0KICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgLyoqKi8KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAoKHMuc3Ryc3RhcnQgPCAoTUlOX01BVENIIC0gMSkpID8gcy5zdHJzdGFydCA6IE1JTl9NQVRDSCAtIDEpOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQogICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTYW1lIGFzIGFib3ZlLCBidXQgYWNoaWV2ZXMgYmV0dGVyIGNvbXByZXNzaW9uLiBXZSB1c2UgYSBsYXp5CiAgICogZXZhbHVhdGlvbiBmb3IgbWF0Y2hlczogYSBtYXRjaCBpcyBmaW5hbGx5IGFkb3B0ZWQgb25seSBpZiB0aGVyZSBpcwogICAqIG5vIGJldHRlciBtYXRjaCBhdCB0aGUgbmV4dCB3aW5kb3cgcG9zaXRpb24uCiAgICovCiAgY29uc3QgZGVmbGF0ZV9zbG93ID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGhhc2hfaGVhZDsgICAgICAgICAgLyogaGVhZCBvZiBoYXNoIGNoYWluICovCiAgICBsZXQgYmZsdXNoOyAgICAgICAgICAgICAgLyogc2V0IGlmIGN1cnJlbnQgYmxvY2sgbXVzdCBiZSBmbHVzaGVkICovCgogICAgbGV0IG1heF9pbnNlcnQ7CgogICAgLyogUHJvY2VzcyB0aGUgaW5wdXQgYmxvY2suICovCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIG5leHQgbWF0Y2gsIHBsdXMgTUlOX01BVENIIGJ5dGVzIHRvIGluc2VydCB0aGUKICAgICAgICogc3RyaW5nIGZvbGxvd2luZyB0aGUgbmV4dCBtYXRjaC4KICAgICAgICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDIpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgeyBicmVhazsgfSAvKiBmbHVzaCB0aGUgY3VycmVudCBibG9jayAqLwogICAgICB9CgogICAgICAvKiBJbnNlcnQgdGhlIHN0cmluZyB3aW5kb3dbc3Ryc3RhcnQgLi4gc3Ryc3RhcnQrMl0gaW4gdGhlCiAgICAgICAqIGRpY3Rpb25hcnksIGFuZCBzZXQgaGFzaF9oZWFkIHRvIHRoZSBoZWFkIG9mIHRoZSBoYXNoIGNoYWluOgogICAgICAgKi8KICAgICAgaGFzaF9oZWFkID0gMC8qTklMKi87CiAgICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSk7CiAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAvKioqLwogICAgICB9CgogICAgICAvKiBGaW5kIHRoZSBsb25nZXN0IG1hdGNoLCBkaXNjYXJkaW5nIHRob3NlIDw9IHByZXZfbGVuZ3RoLgogICAgICAgKi8KICAgICAgcy5wcmV2X2xlbmd0aCA9IHMubWF0Y2hfbGVuZ3RoOwogICAgICBzLnByZXZfbWF0Y2ggPSBzLm1hdGNoX3N0YXJ0OwogICAgICBzLm1hdGNoX2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CgogICAgICBpZiAoaGFzaF9oZWFkICE9PSAwLypOSUwqLyAmJiBzLnByZXZfbGVuZ3RoIDwgcy5tYXhfbGF6eV9tYXRjaCAmJgogICAgICAgICAgcy5zdHJzdGFydCAtIGhhc2hfaGVhZCA8PSAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKS8qTUFYX0RJU1QocykqLykgewogICAgICAgIC8qIFRvIHNpbXBsaWZ5IHRoZSBjb2RlLCB3ZSBwcmV2ZW50IG1hdGNoZXMgd2l0aCB0aGUgc3RyaW5nCiAgICAgICAgICogb2Ygd2luZG93IGluZGV4IDAgKGluIHBhcnRpY3VsYXIgd2UgaGF2ZSB0byBhdm9pZCBhIG1hdGNoCiAgICAgICAgICogb2YgdGhlIHN0cmluZyB3aXRoIGl0c2VsZiBhdCB0aGUgc3RhcnQgb2YgdGhlIGlucHV0IGZpbGUpLgogICAgICAgICAqLwogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICAgIC8qIGxvbmdlc3RfbWF0Y2goKSBzZXRzIG1hdGNoX3N0YXJ0ICovCgogICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA8PSA1ICYmCiAgICAgICAgICAgKHMuc3RyYXRlZ3kgPT09IFpfRklMVEVSRUQgfHwgKHMubWF0Y2hfbGVuZ3RoID09PSBNSU5fTUFUQ0ggJiYgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQgPiA0MDk2LypUT09fRkFSKi8pKSkgewoKICAgICAgICAgIC8qIElmIHByZXZfbWF0Y2ggaXMgYWxzbyBNSU5fTUFUQ0gsIG1hdGNoX3N0YXJ0IGlzIGdhcmJhZ2UKICAgICAgICAgICAqIGJ1dCB3ZSB3aWxsIGlnbm9yZSB0aGUgY3VycmVudCBtYXRjaCBhbnl3YXkuCiAgICAgICAgICAgKi8KICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLyogSWYgdGhlcmUgd2FzIGEgbWF0Y2ggYXQgdGhlIHByZXZpb3VzIHN0ZXAgYW5kIHRoZSBjdXJyZW50CiAgICAgICAqIG1hdGNoIGlzIG5vdCBiZXR0ZXIsIG91dHB1dCB0aGUgcHJldmlvdXMgbWF0Y2g6CiAgICAgICAqLwogICAgICBpZiAocy5wcmV2X2xlbmd0aCA+PSBNSU5fTUFUQ0ggJiYgcy5tYXRjaF9sZW5ndGggPD0gcy5wcmV2X2xlbmd0aCkgewogICAgICAgIG1heF9pbnNlcnQgPSBzLnN0cnN0YXJ0ICsgcy5sb29rYWhlYWQgLSBNSU5fTUFUQ0g7CiAgICAgICAgLyogRG8gbm90IGluc2VydCBzdHJpbmdzIGluIGhhc2ggdGFibGUgYmV5b25kIHRoaXMuICovCgogICAgICAgIC8vY2hlY2tfbWF0Y2gocywgcy5zdHJzdGFydC0xLCBzLnByZXZfbWF0Y2gsIHMucHJldl9sZW5ndGgpOwoKICAgICAgICAvKioqX3RyX3RhbGx5X2Rpc3Qocywgcy5zdHJzdGFydCAtIDEgLSBzLnByZXZfbWF0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgcy5wcmV2X2xlbmd0aCAtIE1JTl9NQVRDSCwgYmZsdXNoKTsqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIHMuc3Ryc3RhcnQgLSAxIC0gcy5wcmV2X21hdGNoLCBzLnByZXZfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICAvKiBJbnNlcnQgaW4gaGFzaCB0YWJsZSBhbGwgc3RyaW5ncyB1cCB0byB0aGUgZW5kIG9mIHRoZSBtYXRjaC4KICAgICAgICAgKiBzdHJzdGFydC0xIGFuZCBzdHJzdGFydCBhcmUgYWxyZWFkeSBpbnNlcnRlZC4gSWYgdGhlcmUgaXMgbm90CiAgICAgICAgICogZW5vdWdoIGxvb2thaGVhZCwgdGhlIGxhc3QgdHdvIHN0cmluZ3MgYXJlIG5vdCBpbnNlcnRlZCBpbgogICAgICAgICAqIHRoZSBoYXNoIHRhYmxlLgogICAgICAgICAqLwogICAgICAgIHMubG9va2FoZWFkIC09IHMucHJldl9sZW5ndGggLSAxOwogICAgICAgIHMucHJldl9sZW5ndGggLT0gMjsKICAgICAgICBkbyB7CiAgICAgICAgICBpZiAoKytzLnN0cnN0YXJ0IDw9IG1heF9pbnNlcnQpIHsKICAgICAgICAgICAgLyoqKiBJTlNFUlRfU1RSSU5HKHMsIHMuc3Ryc3RhcnQsIGhhc2hfaGVhZCk7ICoqKi8KICAgICAgICAgICAgcy5pbnNfaCA9IEhBU0gocywgcy5pbnNfaCwgcy53aW5kb3dbcy5zdHJzdGFydCArIE1JTl9NQVRDSCAtIDFdKTsKICAgICAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgICAgICAgIC8qKiovCiAgICAgICAgICB9CiAgICAgICAgfSB3aGlsZSAoLS1zLnByZXZfbGVuZ3RoICE9PSAwKTsKICAgICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgICAgIHMuc3Ryc3RhcnQrKzsKCiAgICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgfQogICAgICAgICAgLyoqKi8KICAgICAgICB9CgogICAgICB9IGVsc2UgaWYgKHMubWF0Y2hfYXZhaWxhYmxlKSB7CiAgICAgICAgLyogSWYgdGhlcmUgd2FzIG5vIG1hdGNoIGF0IHRoZSBwcmV2aW91cyBwb3NpdGlvbiwgb3V0cHV0IGEKICAgICAgICAgKiBzaW5nbGUgbGl0ZXJhbC4gSWYgdGhlcmUgd2FzIGEgbWF0Y2ggYnV0IHRoZSBjdXJyZW50IG1hdGNoCiAgICAgICAgICogaXMgbG9uZ2VyLCB0cnVuY2F0ZSB0aGUgcHJldmlvdXMgbWF0Y2ggdG8gYSBzaW5nbGUgbGl0ZXJhbC4KICAgICAgICAgKi8KICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnQtMV0pKTsKICAgICAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydC0xXSwgYmZsdXNoKTsgKioqLwogICAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0IC0gMV0pOwoKICAgICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgICAvKioqIEZMVVNIX0JMT0NLX09OTFkocywgMCkgKioqLwogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICAvKioqLwogICAgICAgIH0KICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogVGhlcmUgaXMgbm8gcHJldmlvdXMgbWF0Y2ggdG8gY29tcGFyZSB3aXRoLCB3YWl0IGZvcgogICAgICAgICAqIHRoZSBuZXh0IHN0ZXAgdG8gZGVjaWRlLgogICAgICAgICAqLwogICAgICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgfQogICAgfQogICAgLy9Bc3NlcnQgKGZsdXNoICE9IFpfTk9fRkxVU0gsICJubyBmbHVzaD8iKTsKICAgIGlmIChzLm1hdGNoX2F2YWlsYWJsZSkgewogICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnQtMV0pKTsKICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnQtMV0sIGJmbHVzaCk7ICoqKi8KICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnQgLSAxXSk7CgogICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICB9CiAgICBzLmluc2VydCA9IHMuc3Ryc3RhcnQgPCBNSU5fTUFUQ0ggLSAxID8gcy5zdHJzdGFydCA6IE1JTl9NQVRDSCAtIDE7CiAgICBpZiAoZmx1c2ggPT09IFpfRklOSVNIJDMpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAxKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICAvKioqLwogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KCiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogRm9yIFpfUkxFLCBzaW1wbHkgbG9vayBmb3IgcnVucyBvZiBieXRlcywgZ2VuZXJhdGUgbWF0Y2hlcyBvbmx5IG9mIGRpc3RhbmNlCiAgICogb25lLiAgRG8gbm90IG1haW50YWluIGEgaGFzaCB0YWJsZS4gIChJdCB3aWxsIGJlIHJlZ2VuZXJhdGVkIGlmIHRoaXMgcnVuIG9mCiAgICogZGVmbGF0ZSBzd2l0Y2hlcyBhd2F5IGZyb20gWl9STEUuKQogICAqLwogIGNvbnN0IGRlZmxhdGVfcmxlID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGJmbHVzaDsgICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KICAgIGxldCBwcmV2OyAgICAgICAgICAgICAgLyogYnl0ZSBhdCBkaXN0YW5jZSBvbmUgdG8gbWF0Y2ggKi8KICAgIGxldCBzY2FuLCBzdHJlbmQ7ICAgICAgLyogc2NhbiBnb2VzIHVwIHRvIHN0cmVuZCBmb3IgbGVuZ3RoIG9mIHJ1biAqLwoKICAgIGNvbnN0IF93aW4gPSBzLndpbmRvdzsKCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIGxvbmdlc3QgcnVuLCBwbHVzIG9uZSBmb3IgdGhlIHVucm9sbGVkIGxvb3AuCiAgICAgICAqLwogICAgICBpZiAocy5sb29rYWhlYWQgPD0gTUFYX01BVENIKSB7CiAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgaWYgKHMubG9va2FoZWFkIDw9IE1BWF9NQVRDSCAmJiBmbHVzaCA9PT0gWl9OT19GTFVTSCQyKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsgYnJlYWs7IH0gLyogZmx1c2ggdGhlIGN1cnJlbnQgYmxvY2sgKi8KICAgICAgfQoKICAgICAgLyogU2VlIGhvdyBtYW55IHRpbWVzIHRoZSBwcmV2aW91cyBieXRlIHJlcGVhdHMgKi8KICAgICAgcy5tYXRjaF9sZW5ndGggPSAwOwogICAgICBpZiAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIICYmIHMuc3Ryc3RhcnQgPiAwKSB7CiAgICAgICAgc2NhbiA9IHMuc3Ryc3RhcnQgLSAxOwogICAgICAgIHByZXYgPSBfd2luW3NjYW5dOwogICAgICAgIGlmIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSkgewogICAgICAgICAgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgLypqc2hpbnQgbm9lbXB0eTpmYWxzZSovCiAgICAgICAgICB9IHdoaWxlIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBzY2FuIDwgc3RyZW5kKTsKICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUFYX01BVENIIC0gKHN0cmVuZCAtIHNjYW4pOwogICAgICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoID4gcy5sb29rYWhlYWQpIHsKICAgICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBzLmxvb2thaGVhZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy9Bc3NlcnQoc2NhbiA8PSBzLT53aW5kb3crKHVJbnQpKHMtPndpbmRvd19zaXplLTEpLCAid2lsZCBzY2FuIik7CiAgICAgIH0KCiAgICAgIC8qIEVtaXQgbWF0Y2ggaWYgaGF2ZSBydW4gb2YgTUlOX01BVENIIG9yIGxvbmdlciwgZWxzZSBlbWl0IGxpdGVyYWwgKi8KICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoID49IE1JTl9NQVRDSCkgewogICAgICAgIC8vY2hlY2tfbWF0Y2gocywgcy5zdHJzdGFydCwgcy5zdHJzdGFydCAtIDEsIHMubWF0Y2hfbGVuZ3RoKTsKCiAgICAgICAgLyoqKiBfdHJfdGFsbHlfZGlzdChzLCAxLCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCwgYmZsdXNoKTsgKioqLwogICAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCAxLCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCk7CgogICAgICAgIHMubG9va2FoZWFkIC09IHMubWF0Y2hfbGVuZ3RoOwogICAgICAgIHMuc3Ryc3RhcnQgKz0gcy5tYXRjaF9sZW5ndGg7CiAgICAgICAgcy5tYXRjaF9sZW5ndGggPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIC8qIE5vIG1hdGNoLCBvdXRwdXQgYSBsaXRlcmFsIGJ5dGUgKi8KICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnRdKSk7CiAgICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnRdLCBiZmx1c2gpOyAqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKCiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0KICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgLyoqKi8KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAwOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQogICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGb3IgWl9IVUZGTUFOX09OTFksIGRvIG5vdCBsb29rIGZvciBtYXRjaGVzLiAgRG8gbm90IG1haW50YWluIGEgaGFzaCB0YWJsZS4KICAgKiAoSXQgd2lsbCBiZSByZWdlbmVyYXRlZCBpZiB0aGlzIHJ1biBvZiBkZWZsYXRlIHN3aXRjaGVzIGF3YXkgZnJvbSBIdWZmbWFuLikKICAgKi8KICBjb25zdCBkZWZsYXRlX2h1ZmYgPSAocywgZmx1c2gpID0+IHsKCiAgICBsZXQgYmZsdXNoOyAgICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGhhdmUgYSBsaXRlcmFsIHRvIHdyaXRlLiAqLwogICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsKICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9OT19GTFVTSCQyKSB7CiAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsgICAgICAvKiBmbHVzaCB0aGUgY3VycmVudCBibG9jayAqLwogICAgICAgIH0KICAgICAgfQoKICAgICAgLyogT3V0cHV0IGEgbGl0ZXJhbCBieXRlICovCiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsIiVjIiwgcy0+d2luZG93W3MtPnN0cnN0YXJ0XSkpOwogICAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydF0sIGJmbHVzaCk7ICoqKi8KICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgcy5zdHJzdGFydCsrOwogICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICAvKioqLwogICAgICB9CiAgICB9CiAgICBzLmluc2VydCA9IDA7CiAgICBpZiAoZmx1c2ggPT09IFpfRklOSVNIJDMpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAxKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICAvKioqLwogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KICAgIHJldHVybiBCU19CTE9DS19ET05FOwogIH07CgogIC8qIFZhbHVlcyBmb3IgbWF4X2xhenlfbWF0Y2gsIGdvb2RfbWF0Y2ggYW5kIG1heF9jaGFpbl9sZW5ndGgsIGRlcGVuZGluZyBvbgogICAqIHRoZSBkZXNpcmVkIHBhY2sgbGV2ZWwgKDAuLjkpLiBUaGUgdmFsdWVzIGdpdmVuIGJlbG93IGhhdmUgYmVlbiB0dW5lZCB0bwogICAqIGV4Y2x1ZGUgd29yc3QgY2FzZSBwZXJmb3JtYW5jZSBmb3IgcGF0aG9sb2dpY2FsIGZpbGVzLiBCZXR0ZXIgdmFsdWVzIG1heSBiZQogICAqIGZvdW5kIGZvciBzcGVjaWZpYyBmaWxlcy4KICAgKi8KICBmdW5jdGlvbiBDb25maWcoZ29vZF9sZW5ndGgsIG1heF9sYXp5LCBuaWNlX2xlbmd0aCwgbWF4X2NoYWluLCBmdW5jKSB7CgogICAgdGhpcy5nb29kX2xlbmd0aCA9IGdvb2RfbGVuZ3RoOwogICAgdGhpcy5tYXhfbGF6eSA9IG1heF9sYXp5OwogICAgdGhpcy5uaWNlX2xlbmd0aCA9IG5pY2VfbGVuZ3RoOwogICAgdGhpcy5tYXhfY2hhaW4gPSBtYXhfY2hhaW47CiAgICB0aGlzLmZ1bmMgPSBmdW5jOwogIH0KCiAgY29uc3QgY29uZmlndXJhdGlvbl90YWJsZSA9IFsKICAgIC8qICAgICAgZ29vZCBsYXp5IG5pY2UgY2hhaW4gKi8KICAgIG5ldyBDb25maWcoMCwgMCwgMCwgMCwgZGVmbGF0ZV9zdG9yZWQpLCAgICAgICAgICAvKiAwIHN0b3JlIG9ubHkgKi8KICAgIG5ldyBDb25maWcoNCwgNCwgOCwgNCwgZGVmbGF0ZV9mYXN0KSwgICAgICAgICAgICAvKiAxIG1heCBzcGVlZCwgbm8gbGF6eSBtYXRjaGVzICovCiAgICBuZXcgQ29uZmlnKDQsIDUsIDE2LCA4LCBkZWZsYXRlX2Zhc3QpLCAgICAgICAgICAgLyogMiAqLwogICAgbmV3IENvbmZpZyg0LCA2LCAzMiwgMzIsIGRlZmxhdGVfZmFzdCksICAgICAgICAgIC8qIDMgKi8KCiAgICBuZXcgQ29uZmlnKDQsIDQsIDE2LCAxNiwgZGVmbGF0ZV9zbG93KSwgICAgICAgICAgLyogNCBsYXp5IG1hdGNoZXMgKi8KICAgIG5ldyBDb25maWcoOCwgMTYsIDMyLCAzMiwgZGVmbGF0ZV9zbG93KSwgICAgICAgICAvKiA1ICovCiAgICBuZXcgQ29uZmlnKDgsIDE2LCAxMjgsIDEyOCwgZGVmbGF0ZV9zbG93KSwgICAgICAgLyogNiAqLwogICAgbmV3IENvbmZpZyg4LCAzMiwgMTI4LCAyNTYsIGRlZmxhdGVfc2xvdyksICAgICAgIC8qIDcgKi8KICAgIG5ldyBDb25maWcoMzIsIDEyOCwgMjU4LCAxMDI0LCBkZWZsYXRlX3Nsb3cpLCAgICAvKiA4ICovCiAgICBuZXcgQ29uZmlnKDMyLCAyNTgsIDI1OCwgNDA5NiwgZGVmbGF0ZV9zbG93KSAgICAgLyogOSBtYXggY29tcHJlc3Npb24gKi8KICBdOwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogSW5pdGlhbGl6ZSB0aGUgImxvbmdlc3QgbWF0Y2giIHJvdXRpbmVzIGZvciBhIG5ldyB6bGliIHN0cmVhbQogICAqLwogIGNvbnN0IGxtX2luaXQgPSAocykgPT4gewoKICAgIHMud2luZG93X3NpemUgPSAyICogcy53X3NpemU7CgogICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovCiAgICB6ZXJvKHMuaGVhZCk7IC8vIEZpbGwgd2l0aCBOSUwgKD0gMCk7CgogICAgLyogU2V0IHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVyczoKICAgICAqLwogICAgcy5tYXhfbGF6eV9tYXRjaCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2xhenk7CiAgICBzLmdvb2RfbWF0Y2ggPSBjb25maWd1cmF0aW9uX3RhYmxlW3MubGV2ZWxdLmdvb2RfbGVuZ3RoOwogICAgcy5uaWNlX21hdGNoID0gY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5uaWNlX2xlbmd0aDsKICAgIHMubWF4X2NoYWluX2xlbmd0aCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2NoYWluOwoKICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICBzLmxvb2thaGVhZCA9IDA7CiAgICBzLmluc2VydCA9IDA7CiAgICBzLm1hdGNoX2xlbmd0aCA9IHMucHJldl9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgcy5pbnNfaCA9IDA7CiAgfTsKCgogIGZ1bmN0aW9uIERlZmxhdGVTdGF0ZSgpIHsKICAgIHRoaXMuc3RybSA9IG51bGw7ICAgICAgICAgICAgLyogcG9pbnRlciBiYWNrIHRvIHRoaXMgemxpYiBzdHJlYW0gKi8KICAgIHRoaXMuc3RhdHVzID0gMDsgICAgICAgICAgICAvKiBhcyB0aGUgbmFtZSBpbXBsaWVzICovCiAgICB0aGlzLnBlbmRpbmdfYnVmID0gbnVsbDsgICAgICAvKiBvdXRwdXQgc3RpbGwgcGVuZGluZyAqLwogICAgdGhpcy5wZW5kaW5nX2J1Zl9zaXplID0gMDsgIC8qIHNpemUgb2YgcGVuZGluZ19idWYgKi8KICAgIHRoaXMucGVuZGluZ19vdXQgPSAwOyAgICAgICAvKiBuZXh0IHBlbmRpbmcgYnl0ZSB0byBvdXRwdXQgdG8gdGhlIHN0cmVhbSAqLwogICAgdGhpcy5wZW5kaW5nID0gMDsgICAgICAgICAgIC8qIG5iIG9mIGJ5dGVzIGluIHRoZSBwZW5kaW5nIGJ1ZmZlciAqLwogICAgdGhpcy53cmFwID0gMDsgICAgICAgICAgICAgIC8qIGJpdCAwIHRydWUgZm9yIHpsaWIsIGJpdCAxIHRydWUgZm9yIGd6aXAgKi8KICAgIHRoaXMuZ3poZWFkID0gbnVsbDsgICAgICAgICAvKiBnemlwIGhlYWRlciBpbmZvcm1hdGlvbiB0byB3cml0ZSAqLwogICAgdGhpcy5nemluZGV4ID0gMDsgICAgICAgICAgIC8qIHdoZXJlIGluIGV4dHJhLCBuYW1lLCBvciBjb21tZW50ICovCiAgICB0aGlzLm1ldGhvZCA9IFpfREVGTEFURUQkMjsgLyogY2FuIG9ubHkgYmUgREVGTEFURUQgKi8KICAgIHRoaXMubGFzdF9mbHVzaCA9IC0xOyAgIC8qIHZhbHVlIG9mIGZsdXNoIHBhcmFtIGZvciBwcmV2aW91cyBkZWZsYXRlIGNhbGwgKi8KCiAgICB0aGlzLndfc2l6ZSA9IDA7ICAvKiBMWjc3IHdpbmRvdyBzaXplICgzMksgYnkgZGVmYXVsdCkgKi8KICAgIHRoaXMud19iaXRzID0gMDsgIC8qIGxvZzIod19zaXplKSAgKDguLjE2KSAqLwogICAgdGhpcy53X21hc2sgPSAwOyAgLyogd19zaXplIC0gMSAqLwoKICAgIHRoaXMud2luZG93ID0gbnVsbDsKICAgIC8qIFNsaWRpbmcgd2luZG93LiBJbnB1dCBieXRlcyBhcmUgcmVhZCBpbnRvIHRoZSBzZWNvbmQgaGFsZiBvZiB0aGUgd2luZG93LAogICAgICogYW5kIG1vdmUgdG8gdGhlIGZpcnN0IGhhbGYgbGF0ZXIgdG8ga2VlcCBhIGRpY3Rpb25hcnkgb2YgYXQgbGVhc3Qgd1NpemUKICAgICAqIGJ5dGVzLiBXaXRoIHRoaXMgb3JnYW5pemF0aW9uLCBtYXRjaGVzIGFyZSBsaW1pdGVkIHRvIGEgZGlzdGFuY2Ugb2YKICAgICAqIHdTaXplLU1BWF9NQVRDSCBieXRlcywgYnV0IHRoaXMgZW5zdXJlcyB0aGF0IElPIGlzIGFsd2F5cwogICAgICogcGVyZm9ybWVkIHdpdGggYSBsZW5ndGggbXVsdGlwbGUgb2YgdGhlIGJsb2NrIHNpemUuCiAgICAgKi8KCiAgICB0aGlzLndpbmRvd19zaXplID0gMDsKICAgIC8qIEFjdHVhbCBzaXplIG9mIHdpbmRvdzogMip3U2l6ZSwgZXhjZXB0IHdoZW4gdGhlIHVzZXIgaW5wdXQgYnVmZmVyCiAgICAgKiBpcyBkaXJlY3RseSB1c2VkIGFzIHNsaWRpbmcgd2luZG93LgogICAgICovCgogICAgdGhpcy5wcmV2ID0gbnVsbDsKICAgIC8qIExpbmsgdG8gb2xkZXIgc3RyaW5nIHdpdGggc2FtZSBoYXNoIGluZGV4LiBUbyBsaW1pdCB0aGUgc2l6ZSBvZiB0aGlzCiAgICAgKiBhcnJheSB0byA2NEssIHRoaXMgbGluayBpcyBtYWludGFpbmVkIG9ubHkgZm9yIHRoZSBsYXN0IDMySyBzdHJpbmdzLgogICAgICogQW4gaW5kZXggaW4gdGhpcyBhcnJheSBpcyB0aHVzIGEgd2luZG93IGluZGV4IG1vZHVsbyAzMksuCiAgICAgKi8KCiAgICB0aGlzLmhlYWQgPSBudWxsOyAgIC8qIEhlYWRzIG9mIHRoZSBoYXNoIGNoYWlucyBvciBOSUwuICovCgogICAgdGhpcy5pbnNfaCA9IDA7ICAgICAgIC8qIGhhc2ggaW5kZXggb2Ygc3RyaW5nIHRvIGJlIGluc2VydGVkICovCiAgICB0aGlzLmhhc2hfc2l6ZSA9IDA7ICAgLyogbnVtYmVyIG9mIGVsZW1lbnRzIGluIGhhc2ggdGFibGUgKi8KICAgIHRoaXMuaGFzaF9iaXRzID0gMDsgICAvKiBsb2cyKGhhc2hfc2l6ZSkgKi8KICAgIHRoaXMuaGFzaF9tYXNrID0gMDsgICAvKiBoYXNoX3NpemUtMSAqLwoKICAgIHRoaXMuaGFzaF9zaGlmdCA9IDA7CiAgICAvKiBOdW1iZXIgb2YgYml0cyBieSB3aGljaCBpbnNfaCBtdXN0IGJlIHNoaWZ0ZWQgYXQgZWFjaCBpbnB1dAogICAgICogc3RlcC4gSXQgbXVzdCBiZSBzdWNoIHRoYXQgYWZ0ZXIgTUlOX01BVENIIHN0ZXBzLCB0aGUgb2xkZXN0CiAgICAgKiBieXRlIG5vIGxvbmdlciB0YWtlcyBwYXJ0IGluIHRoZSBoYXNoIGtleSwgdGhhdCBpczoKICAgICAqICAgaGFzaF9zaGlmdCAqIE1JTl9NQVRDSCA+PSBoYXNoX2JpdHMKICAgICAqLwoKICAgIHRoaXMuYmxvY2tfc3RhcnQgPSAwOwogICAgLyogV2luZG93IHBvc2l0aW9uIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGN1cnJlbnQgb3V0cHV0IGJsb2NrLiBHZXRzCiAgICAgKiBuZWdhdGl2ZSB3aGVuIHRoZSB3aW5kb3cgaXMgbW92ZWQgYmFja3dhcmRzLgogICAgICovCgogICAgdGhpcy5tYXRjaF9sZW5ndGggPSAwOyAgICAgIC8qIGxlbmd0aCBvZiBiZXN0IG1hdGNoICovCiAgICB0aGlzLnByZXZfbWF0Y2ggPSAwOyAgICAgICAgLyogcHJldmlvdXMgbWF0Y2ggKi8KICAgIHRoaXMubWF0Y2hfYXZhaWxhYmxlID0gMDsgICAvKiBzZXQgaWYgcHJldmlvdXMgbWF0Y2ggZXhpc3RzICovCiAgICB0aGlzLnN0cnN0YXJ0ID0gMDsgICAgICAgICAgLyogc3RhcnQgb2Ygc3RyaW5nIHRvIGluc2VydCAqLwogICAgdGhpcy5tYXRjaF9zdGFydCA9IDA7ICAgICAgIC8qIHN0YXJ0IG9mIG1hdGNoaW5nIHN0cmluZyAqLwogICAgdGhpcy5sb29rYWhlYWQgPSAwOyAgICAgICAgIC8qIG51bWJlciBvZiB2YWxpZCBieXRlcyBhaGVhZCBpbiB3aW5kb3cgKi8KCiAgICB0aGlzLnByZXZfbGVuZ3RoID0gMDsKICAgIC8qIExlbmd0aCBvZiB0aGUgYmVzdCBtYXRjaCBhdCBwcmV2aW91cyBzdGVwLiBNYXRjaGVzIG5vdCBncmVhdGVyIHRoYW4gdGhpcwogICAgICogYXJlIGRpc2NhcmRlZC4gVGhpcyBpcyB1c2VkIGluIHRoZSBsYXp5IG1hdGNoIGV2YWx1YXRpb24uCiAgICAgKi8KCiAgICB0aGlzLm1heF9jaGFpbl9sZW5ndGggPSAwOwogICAgLyogVG8gc3BlZWQgdXAgZGVmbGF0aW9uLCBoYXNoIGNoYWlucyBhcmUgbmV2ZXIgc2VhcmNoZWQgYmV5b25kIHRoaXMKICAgICAqIGxlbmd0aC4gIEEgaGlnaGVyIGxpbWl0IGltcHJvdmVzIGNvbXByZXNzaW9uIHJhdGlvIGJ1dCBkZWdyYWRlcyB0aGUKICAgICAqIHNwZWVkLgogICAgICovCgogICAgdGhpcy5tYXhfbGF6eV9tYXRjaCA9IDA7CiAgICAvKiBBdHRlbXB0IHRvIGZpbmQgYSBiZXR0ZXIgbWF0Y2ggb25seSB3aGVuIHRoZSBjdXJyZW50IG1hdGNoIGlzIHN0cmljdGx5CiAgICAgKiBzbWFsbGVyIHRoYW4gdGhpcyB2YWx1ZS4gVGhpcyBtZWNoYW5pc20gaXMgdXNlZCBvbmx5IGZvciBjb21wcmVzc2lvbgogICAgICogbGV2ZWxzID49IDQuCiAgICAgKi8KICAgIC8vIFRoYXQncyBhbGlhcyB0byBtYXhfbGF6eV9tYXRjaCwgZG9uJ3QgdXNlIGRpcmVjdGx5CiAgICAvL3RoaXMubWF4X2luc2VydF9sZW5ndGggPSAwOwogICAgLyogSW5zZXJ0IG5ldyBzdHJpbmdzIGluIHRoZSBoYXNoIHRhYmxlIG9ubHkgaWYgdGhlIG1hdGNoIGxlbmd0aCBpcyBub3QKICAgICAqIGdyZWF0ZXIgdGhhbiB0aGlzIGxlbmd0aC4gVGhpcyBzYXZlcyB0aW1lIGJ1dCBkZWdyYWRlcyBjb21wcmVzc2lvbi4KICAgICAqIG1heF9pbnNlcnRfbGVuZ3RoIGlzIHVzZWQgb25seSBmb3IgY29tcHJlc3Npb24gbGV2ZWxzIDw9IDMuCiAgICAgKi8KCiAgICB0aGlzLmxldmVsID0gMDsgICAgIC8qIGNvbXByZXNzaW9uIGxldmVsICgxLi45KSAqLwogICAgdGhpcy5zdHJhdGVneSA9IDA7ICAvKiBmYXZvciBvciBmb3JjZSBIdWZmbWFuIGNvZGluZyovCgogICAgdGhpcy5nb29kX21hdGNoID0gMDsKICAgIC8qIFVzZSBhIGZhc3RlciBzZWFyY2ggd2hlbiB0aGUgcHJldmlvdXMgbWF0Y2ggaXMgbG9uZ2VyIHRoYW4gdGhpcyAqLwoKICAgIHRoaXMubmljZV9tYXRjaCA9IDA7IC8qIFN0b3Agc2VhcmNoaW5nIHdoZW4gY3VycmVudCBtYXRjaCBleGNlZWRzIHRoaXMgKi8KCiAgICAgICAgICAgICAgICAvKiB1c2VkIGJ5IHRyZWVzLmM6ICovCgogICAgLyogRGlkbid0IHVzZSBjdF9kYXRhIHR5cGVkZWYgYmVsb3cgdG8gc3VwcHJlc3MgY29tcGlsZXIgd2FybmluZyAqLwoKICAgIC8vIHN0cnVjdCBjdF9kYXRhX3MgZHluX2x0cmVlW0hFQVBfU0laRV07ICAgLyogbGl0ZXJhbCBhbmQgbGVuZ3RoIHRyZWUgKi8KICAgIC8vIHN0cnVjdCBjdF9kYXRhX3MgZHluX2R0cmVlWzIqRF9DT0RFUysxXTsgLyogZGlzdGFuY2UgdHJlZSAqLwogICAgLy8gc3RydWN0IGN0X2RhdGFfcyBibF90cmVlWzIqQkxfQ09ERVMrMV07ICAvKiBIdWZmbWFuIHRyZWUgZm9yIGJpdCBsZW5ndGhzICovCgogICAgLy8gVXNlIGZsYXQgYXJyYXkgb2YgRE9VQkxFIHNpemUsIHdpdGggaW50ZXJsZWF2ZWQgZmF0YSwKICAgIC8vIGJlY2F1c2UgSlMgZG9lcyBub3Qgc3VwcG9ydCBlZmZlY3RpdmUKICAgIHRoaXMuZHluX2x0cmVlICA9IG5ldyBVaW50MTZBcnJheShIRUFQX1NJWkUgKiAyKTsKICAgIHRoaXMuZHluX2R0cmVlICA9IG5ldyBVaW50MTZBcnJheSgoMiAqIERfQ09ERVMgKyAxKSAqIDIpOwogICAgdGhpcy5ibF90cmVlICAgID0gbmV3IFVpbnQxNkFycmF5KCgyICogQkxfQ09ERVMgKyAxKSAqIDIpOwogICAgemVybyh0aGlzLmR5bl9sdHJlZSk7CiAgICB6ZXJvKHRoaXMuZHluX2R0cmVlKTsKICAgIHplcm8odGhpcy5ibF90cmVlKTsKCiAgICB0aGlzLmxfZGVzYyAgID0gbnVsbDsgICAgICAgICAvKiBkZXNjLiBmb3IgbGl0ZXJhbCB0cmVlICovCiAgICB0aGlzLmRfZGVzYyAgID0gbnVsbDsgICAgICAgICAvKiBkZXNjLiBmb3IgZGlzdGFuY2UgdHJlZSAqLwogICAgdGhpcy5ibF9kZXNjICA9IG51bGw7ICAgICAgICAgLyogZGVzYy4gZm9yIGJpdCBsZW5ndGggdHJlZSAqLwoKICAgIC8vdXNoIGJsX2NvdW50W01BWF9CSVRTKzFdOwogICAgdGhpcy5ibF9jb3VudCA9IG5ldyBVaW50MTZBcnJheShNQVhfQklUUyArIDEpOwogICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCBmb3IgYW4gb3B0aW1hbCB0cmVlICovCgogICAgLy9pbnQgaGVhcFsyKkxfQ09ERVMrMV07ICAgICAgLyogaGVhcCB1c2VkIHRvIGJ1aWxkIHRoZSBIdWZmbWFuIHRyZWVzICovCiAgICB0aGlzLmhlYXAgPSBuZXcgVWludDE2QXJyYXkoMiAqIExfQ09ERVMgKyAxKTsgIC8qIGhlYXAgdXNlZCB0byBidWlsZCB0aGUgSHVmZm1hbiB0cmVlcyAqLwogICAgemVybyh0aGlzLmhlYXApOwoKICAgIHRoaXMuaGVhcF9sZW4gPSAwOyAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgaGVhcCAqLwogICAgdGhpcy5oZWFwX21heCA9IDA7ICAgICAgICAgICAgICAgLyogZWxlbWVudCBvZiBsYXJnZXN0IGZyZXF1ZW5jeSAqLwogICAgLyogVGhlIHNvbnMgb2YgaGVhcFtuXSBhcmUgaGVhcFsyKm5dIGFuZCBoZWFwWzIqbisxXS4gaGVhcFswXSBpcyBub3QgdXNlZC4KICAgICAqIFRoZSBzYW1lIGhlYXAgYXJyYXkgaXMgdXNlZCB0byBidWlsZCBhbGwgdHJlZXMuCiAgICAgKi8KCiAgICB0aGlzLmRlcHRoID0gbmV3IFVpbnQxNkFycmF5KDIgKiBMX0NPREVTICsgMSk7IC8vdWNoIGRlcHRoWzIqTF9DT0RFUysxXTsKICAgIHplcm8odGhpcy5kZXB0aCk7CiAgICAvKiBEZXB0aCBvZiBlYWNoIHN1YnRyZWUgdXNlZCBhcyB0aWUgYnJlYWtlciBmb3IgdHJlZXMgb2YgZXF1YWwgZnJlcXVlbmN5CiAgICAgKi8KCiAgICB0aGlzLmxfYnVmID0gMDsgICAgICAgICAgLyogYnVmZmVyIGluZGV4IGZvciBsaXRlcmFscyBvciBsZW5ndGhzICovCgogICAgdGhpcy5saXRfYnVmc2l6ZSA9IDA7CiAgICAvKiBTaXplIG9mIG1hdGNoIGJ1ZmZlciBmb3IgbGl0ZXJhbHMvbGVuZ3Rocy4gIFRoZXJlIGFyZSA0IHJlYXNvbnMgZm9yCiAgICAgKiBsaW1pdGluZyBsaXRfYnVmc2l6ZSB0byA2NEs6CiAgICAgKiAgIC0gZnJlcXVlbmNpZXMgY2FuIGJlIGtlcHQgaW4gMTYgYml0IGNvdW50ZXJzCiAgICAgKiAgIC0gaWYgY29tcHJlc3Npb24gaXMgbm90IHN1Y2Nlc3NmdWwgZm9yIHRoZSBmaXJzdCBibG9jaywgYWxsIGlucHV0CiAgICAgKiAgICAgZGF0YSBpcyBzdGlsbCBpbiB0aGUgd2luZG93IHNvIHdlIGNhbiBzdGlsbCBlbWl0IGEgc3RvcmVkIGJsb2NrIGV2ZW4KICAgICAqICAgICB3aGVuIGlucHV0IGNvbWVzIGZyb20gc3RhbmRhcmQgaW5wdXQuICAoVGhpcyBjYW4gYWxzbyBiZSBkb25lIGZvcgogICAgICogICAgIGFsbCBibG9ja3MgaWYgbGl0X2J1ZnNpemUgaXMgbm90IGdyZWF0ZXIgdGhhbiAzMksuKQogICAgICogICAtIGlmIGNvbXByZXNzaW9uIGlzIG5vdCBzdWNjZXNzZnVsIGZvciBhIGZpbGUgc21hbGxlciB0aGFuIDY0Sywgd2UgY2FuCiAgICAgKiAgICAgZXZlbiBlbWl0IGEgc3RvcmVkIGZpbGUgaW5zdGVhZCBvZiBhIHN0b3JlZCBibG9jayAoc2F2aW5nIDUgYnl0ZXMpLgogICAgICogICAgIFRoaXMgaXMgYXBwbGljYWJsZSBvbmx5IGZvciB6aXAgKG5vdCBnemlwIG9yIHpsaWIpLgogICAgICogICAtIGNyZWF0aW5nIG5ldyBIdWZmbWFuIHRyZWVzIGxlc3MgZnJlcXVlbnRseSBtYXkgbm90IHByb3ZpZGUgZmFzdAogICAgICogICAgIGFkYXB0YXRpb24gdG8gY2hhbmdlcyBpbiB0aGUgaW5wdXQgZGF0YSBzdGF0aXN0aWNzLiAoVGFrZSBmb3IKICAgICAqICAgICBleGFtcGxlIGEgYmluYXJ5IGZpbGUgd2l0aCBwb29ybHkgY29tcHJlc3NpYmxlIGNvZGUgZm9sbG93ZWQgYnkKICAgICAqICAgICBhIGhpZ2hseSBjb21wcmVzc2libGUgc3RyaW5nIHRhYmxlLikgU21hbGxlciBidWZmZXIgc2l6ZXMgZ2l2ZQogICAgICogICAgIGZhc3QgYWRhcHRhdGlvbiBidXQgaGF2ZSBvZiBjb3Vyc2UgdGhlIG92ZXJoZWFkIG9mIHRyYW5zbWl0dGluZwogICAgICogICAgIHRyZWVzIG1vcmUgZnJlcXVlbnRseS4KICAgICAqICAgLSBJIGNhbid0IGNvdW50IGFib3ZlIDQKICAgICAqLwoKICAgIHRoaXMubGFzdF9saXQgPSAwOyAgICAgIC8qIHJ1bm5pbmcgaW5kZXggaW4gbF9idWYgKi8KCiAgICB0aGlzLmRfYnVmID0gMDsKICAgIC8qIEJ1ZmZlciBpbmRleCBmb3IgZGlzdGFuY2VzLiBUbyBzaW1wbGlmeSB0aGUgY29kZSwgZF9idWYgYW5kIGxfYnVmIGhhdmUKICAgICAqIHRoZSBzYW1lIG51bWJlciBvZiBlbGVtZW50cy4gVG8gdXNlIGRpZmZlcmVudCBsZW5ndGhzLCBhbiBleHRyYSBmbGFnCiAgICAgKiBhcnJheSB3b3VsZCBiZSBuZWNlc3NhcnkuCiAgICAgKi8KCiAgICB0aGlzLm9wdF9sZW4gPSAwOyAgICAgICAvKiBiaXQgbGVuZ3RoIG9mIGN1cnJlbnQgYmxvY2sgd2l0aCBvcHRpbWFsIHRyZWVzICovCiAgICB0aGlzLnN0YXRpY19sZW4gPSAwOyAgICAvKiBiaXQgbGVuZ3RoIG9mIGN1cnJlbnQgYmxvY2sgd2l0aCBzdGF0aWMgdHJlZXMgKi8KICAgIHRoaXMubWF0Y2hlcyA9IDA7ICAgICAgIC8qIG51bWJlciBvZiBzdHJpbmcgbWF0Y2hlcyBpbiBjdXJyZW50IGJsb2NrICovCiAgICB0aGlzLmluc2VydCA9IDA7ICAgICAgICAvKiBieXRlcyBhdCBlbmQgb2Ygd2luZG93IGxlZnQgdG8gaW5zZXJ0ICovCgoKICAgIHRoaXMuYmlfYnVmID0gMDsKICAgIC8qIE91dHB1dCBidWZmZXIuIGJpdHMgYXJlIGluc2VydGVkIHN0YXJ0aW5nIGF0IHRoZSBib3R0b20gKGxlYXN0CiAgICAgKiBzaWduaWZpY2FudCBiaXRzKS4KICAgICAqLwogICAgdGhpcy5iaV92YWxpZCA9IDA7CiAgICAvKiBOdW1iZXIgb2YgdmFsaWQgYml0cyBpbiBiaV9idWYuICBBbGwgYml0cyBhYm92ZSB0aGUgbGFzdCB2YWxpZCBiaXQKICAgICAqIGFyZSBhbHdheXMgemVyby4KICAgICAqLwoKICAgIC8vIFVzZWQgZm9yIHdpbmRvdyBtZW1vcnkgaW5pdC4gV2Ugc2FmZWx5IGlnbm9yZSBpdCBmb3IgSlMuIFRoYXQgbWFrZXMKICAgIC8vIHNlbnNlIG9ubHkgZm9yIHBvaW50ZXJzIGFuZCBtZW1vcnkgY2hlY2sgdG9vbHMuCiAgICAvL3RoaXMuaGlnaF93YXRlciA9IDA7CiAgICAvKiBIaWdoIHdhdGVyIG1hcmsgb2Zmc2V0IGluIHdpbmRvdyBmb3IgaW5pdGlhbGl6ZWQgYnl0ZXMgLS0gYnl0ZXMgYWJvdmUKICAgICAqIHRoaXMgYXJlIHNldCB0byB6ZXJvIGluIG9yZGVyIHRvIGF2b2lkIG1lbW9yeSBjaGVjayB3YXJuaW5ncyB3aGVuCiAgICAgKiBsb25nZXN0IG1hdGNoIHJvdXRpbmVzIGFjY2VzcyBieXRlcyBwYXN0IHRoZSBpbnB1dC4gIFRoaXMgaXMgdGhlbgogICAgICogdXBkYXRlZCB0byB0aGUgbmV3IGhpZ2ggd2F0ZXIgbWFyay4KICAgICAqLwogIH0KCgogIGNvbnN0IGRlZmxhdGVSZXNldEtlZXAgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDIpOwogICAgfQoKICAgIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IDA7CiAgICBzdHJtLmRhdGFfdHlwZSA9IFpfVU5LTk9XTjsKCiAgICBjb25zdCBzID0gc3RybS5zdGF0ZTsKICAgIHMucGVuZGluZyA9IDA7CiAgICBzLnBlbmRpbmdfb3V0ID0gMDsKCiAgICBpZiAocy53cmFwIDwgMCkgewogICAgICBzLndyYXAgPSAtcy53cmFwOwogICAgICAvKiB3YXMgbWFkZSBuZWdhdGl2ZSBieSBkZWZsYXRlKC4uLiwgWl9GSU5JU0gpOyAqLwogICAgfQogICAgcy5zdGF0dXMgPSAocy53cmFwID8gSU5JVF9TVEFURSA6IEJVU1lfU1RBVEUpOwogICAgc3RybS5hZGxlciA9IChzLndyYXAgPT09IDIpID8KICAgICAgMCAgLy8gY3JjMzIoMCwgWl9OVUxMLCAwKQogICAgOgogICAgICAxOyAvLyBhZGxlcjMyKDAsIFpfTlVMTCwgMCkKICAgIHMubGFzdF9mbHVzaCA9IFpfTk9fRkxVU0gkMjsKICAgIF90cl9pbml0KHMpOwogICAgcmV0dXJuIFpfT0skMzsKICB9OwoKCiAgY29uc3QgZGVmbGF0ZVJlc2V0ID0gKHN0cm0pID0+IHsKCiAgICBjb25zdCByZXQgPSBkZWZsYXRlUmVzZXRLZWVwKHN0cm0pOwogICAgaWYgKHJldCA9PT0gWl9PSyQzKSB7CiAgICAgIGxtX2luaXQoc3RybS5zdGF0ZSk7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH07CgoKICBjb25zdCBkZWZsYXRlU2V0SGVhZGVyID0gKHN0cm0sIGhlYWQpID0+IHsKCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7IH0KICAgIGlmIChzdHJtLnN0YXRlLndyYXAgIT09IDIpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7IH0KICAgIHN0cm0uc3RhdGUuZ3poZWFkID0gaGVhZDsKICAgIHJldHVybiBaX09LJDM7CiAgfTsKCgogIGNvbnN0IGRlZmxhdGVJbml0MiA9IChzdHJtLCBsZXZlbCwgbWV0aG9kLCB3aW5kb3dCaXRzLCBtZW1MZXZlbCwgc3RyYXRlZ3kpID0+IHsKCiAgICBpZiAoIXN0cm0pIHsgLy8gPT09IFpfTlVMTAogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMjsKICAgIH0KICAgIGxldCB3cmFwID0gMTsKCiAgICBpZiAobGV2ZWwgPT09IFpfREVGQVVMVF9DT01QUkVTU0lPTiQxKSB7CiAgICAgIGxldmVsID0gNjsKICAgIH0KCiAgICBpZiAod2luZG93Qml0cyA8IDApIHsgLyogc3VwcHJlc3MgemxpYiB3cmFwcGVyICovCiAgICAgIHdyYXAgPSAwOwogICAgICB3aW5kb3dCaXRzID0gLXdpbmRvd0JpdHM7CiAgICB9CgogICAgZWxzZSBpZiAod2luZG93Qml0cyA+IDE1KSB7CiAgICAgIHdyYXAgPSAyOyAgICAgICAgICAgLyogd3JpdGUgZ3ppcCB3cmFwcGVyIGluc3RlYWQgKi8KICAgICAgd2luZG93Qml0cyAtPSAxNjsKICAgIH0KCgogICAgaWYgKG1lbUxldmVsIDwgMSB8fCBtZW1MZXZlbCA+IE1BWF9NRU1fTEVWRUwgfHwgbWV0aG9kICE9PSBaX0RFRkxBVEVEJDIgfHwKICAgICAgd2luZG93Qml0cyA8IDggfHwgd2luZG93Qml0cyA+IDE1IHx8IGxldmVsIDwgMCB8fCBsZXZlbCA+IDkgfHwKICAgICAgc3RyYXRlZ3kgPCAwIHx8IHN0cmF0ZWd5ID4gWl9GSVhFRCkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDIpOwogICAgfQoKCiAgICBpZiAod2luZG93Qml0cyA9PT0gOCkgewogICAgICB3aW5kb3dCaXRzID0gOTsKICAgIH0KICAgIC8qIHVudGlsIDI1Ni1ieXRlIHdpbmRvdyBidWcgZml4ZWQgKi8KCiAgICBjb25zdCBzID0gbmV3IERlZmxhdGVTdGF0ZSgpOwoKICAgIHN0cm0uc3RhdGUgPSBzOwogICAgcy5zdHJtID0gc3RybTsKCiAgICBzLndyYXAgPSB3cmFwOwogICAgcy5nemhlYWQgPSBudWxsOwogICAgcy53X2JpdHMgPSB3aW5kb3dCaXRzOwogICAgcy53X3NpemUgPSAxIDw8IHMud19iaXRzOwogICAgcy53X21hc2sgPSBzLndfc2l6ZSAtIDE7CgogICAgcy5oYXNoX2JpdHMgPSBtZW1MZXZlbCArIDc7CiAgICBzLmhhc2hfc2l6ZSA9IDEgPDwgcy5oYXNoX2JpdHM7CiAgICBzLmhhc2hfbWFzayA9IHMuaGFzaF9zaXplIC0gMTsKICAgIHMuaGFzaF9zaGlmdCA9IH5+KChzLmhhc2hfYml0cyArIE1JTl9NQVRDSCAtIDEpIC8gTUlOX01BVENIKTsKCiAgICBzLndpbmRvdyA9IG5ldyBVaW50OEFycmF5KHMud19zaXplICogMik7CiAgICBzLmhlYWQgPSBuZXcgVWludDE2QXJyYXkocy5oYXNoX3NpemUpOwogICAgcy5wcmV2ID0gbmV3IFVpbnQxNkFycmF5KHMud19zaXplKTsKCiAgICAvLyBEb24ndCBuZWVkIG1lbSBpbml0IG1hZ2ljIGZvciBKUy4KICAgIC8vcy5oaWdoX3dhdGVyID0gMDsgIC8qIG5vdGhpbmcgd3JpdHRlbiB0byBzLT53aW5kb3cgeWV0ICovCgogICAgcy5saXRfYnVmc2l6ZSA9IDEgPDwgKG1lbUxldmVsICsgNik7IC8qIDE2SyBlbGVtZW50cyBieSBkZWZhdWx0ICovCgogICAgcy5wZW5kaW5nX2J1Zl9zaXplID0gcy5saXRfYnVmc2l6ZSAqIDQ7CgogICAgLy9vdmVybGF5ID0gKHVzaGYgKikgWkFMTE9DKHN0cm0sIHMtPmxpdF9idWZzaXplLCBzaXplb2YodXNoKSsyKTsKICAgIC8vcy0+cGVuZGluZ19idWYgPSAodWNoZiAqKSBvdmVybGF5OwogICAgcy5wZW5kaW5nX2J1ZiA9IG5ldyBVaW50OEFycmF5KHMucGVuZGluZ19idWZfc2l6ZSk7CgogICAgLy8gSXQgaXMgb2Zmc2V0IGZyb20gYHMucGVuZGluZ19idWZgIChzaXplIGlzIGBzLmxpdF9idWZzaXplICogMmApCiAgICAvL3MtPmRfYnVmID0gb3ZlcmxheSArIHMtPmxpdF9idWZzaXplL3NpemVvZih1c2gpOwogICAgcy5kX2J1ZiA9IDEgKiBzLmxpdF9idWZzaXplOwoKICAgIC8vcy0+bF9idWYgPSBzLT5wZW5kaW5nX2J1ZiArICgxK3NpemVvZih1c2gpKSpzLT5saXRfYnVmc2l6ZTsKICAgIHMubF9idWYgPSAoMSArIDIpICogcy5saXRfYnVmc2l6ZTsKCiAgICBzLmxldmVsID0gbGV2ZWw7CiAgICBzLnN0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICBzLm1ldGhvZCA9IG1ldGhvZDsKCiAgICByZXR1cm4gZGVmbGF0ZVJlc2V0KHN0cm0pOwogIH07CgogIGNvbnN0IGRlZmxhdGVJbml0ID0gKHN0cm0sIGxldmVsKSA9PiB7CgogICAgcmV0dXJuIGRlZmxhdGVJbml0MihzdHJtLCBsZXZlbCwgWl9ERUZMQVRFRCQyLCBNQVhfV0JJVFMkMSwgREVGX01FTV9MRVZFTCwgWl9ERUZBVUxUX1NUUkFURUdZJDEpOwogIH07CgoKICBjb25zdCBkZWZsYXRlJDIgPSAoc3RybSwgZmx1c2gpID0+IHsKCiAgICBsZXQgYmVnLCB2YWw7IC8vIGZvciBnemlwIGhlYWRlciB3cml0ZSBvbmx5CgogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlIHx8CiAgICAgIGZsdXNoID4gWl9CTE9DSyQxIHx8IGZsdXNoIDwgMCkgewogICAgICByZXR1cm4gc3RybSA/IGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQyKSA6IFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CgogICAgaWYgKCFzdHJtLm91dHB1dCB8fAogICAgICAgICghc3RybS5pbnB1dCAmJiBzdHJtLmF2YWlsX2luICE9PSAwKSB8fAogICAgICAgIChzLnN0YXR1cyA9PT0gRklOSVNIX1NUQVRFICYmIGZsdXNoICE9PSBaX0ZJTklTSCQzKSkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIChzdHJtLmF2YWlsX291dCA9PT0gMCkgPyBaX0JVRl9FUlJPUiQxIDogWl9TVFJFQU1fRVJST1IkMik7CiAgICB9CgogICAgcy5zdHJtID0gc3RybTsgLyoganVzdCBpbiBjYXNlICovCiAgICBjb25zdCBvbGRfZmx1c2ggPSBzLmxhc3RfZmx1c2g7CiAgICBzLmxhc3RfZmx1c2ggPSBmbHVzaDsKCiAgICAvKiBXcml0ZSB0aGUgaGVhZGVyICovCiAgICBpZiAocy5zdGF0dXMgPT09IElOSVRfU1RBVEUpIHsKCiAgICAgIGlmIChzLndyYXAgPT09IDIpIHsgLy8gR1pJUCBoZWFkZXIKICAgICAgICBzdHJtLmFkbGVyID0gMDsgIC8vY3JjMzIoMEwsIFpfTlVMTCwgMCk7CiAgICAgICAgcHV0X2J5dGUocywgMzEpOwogICAgICAgIHB1dF9ieXRlKHMsIDEzOSk7CiAgICAgICAgcHV0X2J5dGUocywgOCk7CiAgICAgICAgaWYgKCFzLmd6aGVhZCkgeyAvLyBzLT5nemhlYWQgPT0gWl9OVUxMCiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIDApOwogICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIDApOwogICAgICAgICAgcHV0X2J5dGUocywgcy5sZXZlbCA9PT0gOSA/IDIgOgogICAgICAgICAgICAgICAgICAgICAgKHMuc3RyYXRlZ3kgPj0gWl9IVUZGTUFOX09OTFkgfHwgcy5sZXZlbCA8IDIgPwogICAgICAgICAgICAgICAgICAgICAgIDQgOiAwKSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBPU19DT0RFKTsKICAgICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQudGV4dCA/IDEgOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAocy5nemhlYWQuaGNyYyA/IDIgOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAoIXMuZ3poZWFkLmV4dHJhID8gMCA6IDQpICsKICAgICAgICAgICAgICAgICAgICAgICghcy5nemhlYWQubmFtZSA/IDAgOiA4KSArCiAgICAgICAgICAgICAgICAgICAgICAoIXMuZ3poZWFkLmNvbW1lbnQgPyAwIDogMTYpCiAgICAgICAgICApOwogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLnRpbWUgPj4gOCkgJiAweGZmKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIChzLmd6aGVhZC50aW1lID4+IDE2KSAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLnRpbWUgPj4gMjQpICYgMHhmZik7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmxldmVsID09PSA5ID8gMiA6CiAgICAgICAgICAgICAgICAgICAgICAocy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMiA/CiAgICAgICAgICAgICAgICAgICAgICAgNCA6IDApKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLm9zICYgMHhmZik7CiAgICAgICAgICBpZiAocy5nemhlYWQuZXh0cmEgJiYgcy5nemhlYWQuZXh0cmEubGVuZ3RoKSB7CiAgICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLmV4dHJhLmxlbmd0aCAmIDB4ZmYpOwogICAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQuZXh0cmEubGVuZ3RoID4+IDgpICYgMHhmZik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYykgewogICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcsIDApOwogICAgICAgICAgfQogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gRVhUUkFfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgLy8gREVGTEFURSBoZWFkZXIKICAgICAgewogICAgICAgIGxldCBoZWFkZXIgPSAoWl9ERUZMQVRFRCQyICsgKChzLndfYml0cyAtIDgpIDw8IDQpKSA8PCA4OwogICAgICAgIGxldCBsZXZlbF9mbGFncyA9IC0xOwoKICAgICAgICBpZiAocy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMikgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAwOwogICAgICAgIH0gZWxzZSBpZiAocy5sZXZlbCA8IDYpIHsKICAgICAgICAgIGxldmVsX2ZsYWdzID0gMTsKICAgICAgICB9IGVsc2UgaWYgKHMubGV2ZWwgPT09IDYpIHsKICAgICAgICAgIGxldmVsX2ZsYWdzID0gMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAzOwogICAgICAgIH0KICAgICAgICBoZWFkZXIgfD0gKGxldmVsX2ZsYWdzIDw8IDYpOwogICAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7IGhlYWRlciB8PSBQUkVTRVRfRElDVDsgfQogICAgICAgIGhlYWRlciArPSAzMSAtIChoZWFkZXIgJSAzMSk7CgogICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICBwdXRTaG9ydE1TQihzLCBoZWFkZXIpOwoKICAgICAgICAvKiBTYXZlIHRoZSBhZGxlcjMyIG9mIHRoZSBwcmVzZXQgZGljdGlvbmFyeTogKi8KICAgICAgICBpZiAocy5zdHJzdGFydCAhPT0gMCkgewogICAgICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciAmIDB4ZmZmZik7CiAgICAgICAgfQogICAgICAgIHN0cm0uYWRsZXIgPSAxOyAvLyBhZGxlcjMyKDBMLCBaX05VTEwsIDApOwogICAgICB9CiAgICB9CgogIC8vI2lmZGVmIEdaSVAKICAgIGlmIChzLnN0YXR1cyA9PT0gRVhUUkFfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLmV4dHJhLyogIT0gWl9OVUxMKi8pIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7ICAvKiBzdGFydCBvZiBieXRlcyB0byB1cGRhdGUgY3JjICovCgogICAgICAgIHdoaWxlIChzLmd6aW5kZXggPCAocy5nemhlYWQuZXh0cmEubGVuZ3RoICYgMHhmZmZmKSkgewogICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMl8xKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC5leHRyYVtzLmd6aW5kZXhdICYgMHhmZik7CiAgICAgICAgICBzLmd6aW5kZXgrKzsKICAgICAgICB9CiAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgfQogICAgICAgIGlmIChzLmd6aW5kZXggPT09IHMuZ3poZWFkLmV4dHJhLmxlbmd0aCkgewogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gTkFNRV9TVEFURTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgcy5zdGF0dXMgPSBOQU1FX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBpZiAocy5zdGF0dXMgPT09IE5BTUVfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLm5hbWUvKiAhPSBaX05VTEwqLykgewogICAgICAgIGJlZyA9IHMucGVuZGluZzsgIC8qIHN0YXJ0IG9mIGJ5dGVzIHRvIHVwZGF0ZSBjcmMgKi8KICAgICAgICAvL2ludCB2YWw7CgogICAgICAgIGRvIHsKICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgICAgICAgYmVnID0gcy5wZW5kaW5nOwogICAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgICB2YWwgPSAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBKUyBzcGVjaWZpYzogbGl0dGxlIG1hZ2ljIHRvIGFkZCB6ZXJvIHRlcm1pbmF0b3IgdG8gZW5kIG9mIHN0cmluZwogICAgICAgICAgaWYgKHMuZ3ppbmRleCA8IHMuZ3poZWFkLm5hbWUubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhbCA9IHMuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChzLmd6aW5kZXgrKykgJiAweGZmOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHB1dF9ieXRlKHMsIHZhbCk7CiAgICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKCiAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgfQogICAgICAgIGlmICh2YWwgPT09IDApIHsKICAgICAgICAgIHMuZ3ppbmRleCA9IDA7CiAgICAgICAgICBzLnN0YXR1cyA9IENPTU1FTlRfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHMuc3RhdHVzID0gQ09NTUVOVF9TVEFURTsKICAgICAgfQogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBDT01NRU5UX1NUQVRFKSB7CiAgICAgIGlmIChzLmd6aGVhZC5jb21tZW50LyogIT0gWl9OVUxMKi8pIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7ICAvKiBzdGFydCBvZiBieXRlcyB0byB1cGRhdGUgY3JjICovCiAgICAgICAgLy9pbnQgdmFsOwoKICAgICAgICBkbyB7CiAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgICAgIGJlZyA9IHMucGVuZGluZzsKICAgICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgICAgdmFsID0gMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gSlMgc3BlY2lmaWM6IGxpdHRsZSBtYWdpYyB0byBhZGQgemVybyB0ZXJtaW5hdG9yIHRvIGVuZCBvZiBzdHJpbmcKICAgICAgICAgIGlmIChzLmd6aW5kZXggPCBzLmd6aGVhZC5jb21tZW50Lmxlbmd0aCkgewogICAgICAgICAgICB2YWwgPSBzLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQocy5nemluZGV4KyspICYgMHhmZjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhbCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBwdXRfYnl0ZShzLCB2YWwpOwogICAgICAgIH0gd2hpbGUgKHZhbCAhPT0gMCk7CgogICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICAgIH0KICAgICAgICBpZiAodmFsID09PSAwKSB7CiAgICAgICAgICBzLnN0YXR1cyA9IEhDUkNfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHMuc3RhdHVzID0gSENSQ19TVEFURTsKICAgICAgfQogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBIQ1JDX1NUQVRFKSB7CiAgICAgIGlmIChzLmd6aGVhZC5oY3JjKSB7CiAgICAgICAgaWYgKHMucGVuZGluZyArIDIgPiBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgfQogICAgICAgIGlmIChzLnBlbmRpbmcgKyAyIDw9IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gOCkgJiAweGZmKTsKICAgICAgICAgIHN0cm0uYWRsZXIgPSAwOyAvL2NyYzMyKDBMLCBaX05VTEwsIDApOwogICAgICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBzLnN0YXR1cyA9IEJVU1lfU1RBVEU7CiAgICAgIH0KICAgIH0KICAvLyNlbmRpZgoKICAgIC8qIEZsdXNoIGFzIG11Y2ggcGVuZGluZyBvdXRwdXQgYXMgcG9zc2libGUgKi8KICAgIGlmIChzLnBlbmRpbmcgIT09IDApIHsKICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgLyogU2luY2UgYXZhaWxfb3V0IGlzIDAsIGRlZmxhdGUgd2lsbCBiZSBjYWxsZWQgYWdhaW4gd2l0aAogICAgICAgICAqIG1vcmUgb3V0cHV0IHNwYWNlLCBidXQgcG9zc2libHkgd2l0aCBib3RoIHBlbmRpbmcgYW5kCiAgICAgICAgICogYXZhaWxfaW4gZXF1YWwgdG8gemVyby4gVGhlcmUgd29uJ3QgYmUgYW55dGhpbmcgdG8gZG8sCiAgICAgICAgICogYnV0IHRoaXMgaXMgbm90IGFuIGVycm9yIHNpdHVhdGlvbiBzbyBtYWtlIHN1cmUgd2UKICAgICAgICAgKiByZXR1cm4gT0sgaW5zdGVhZCBvZiBCVUZfRVJST1IgYXQgbmV4dCBjYWxsIG9mIGRlZmxhdGU6CiAgICAgICAgICovCiAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgcmV0dXJuIFpfT0skMzsKICAgICAgfQoKICAgICAgLyogTWFrZSBzdXJlIHRoZXJlIGlzIHNvbWV0aGluZyB0byBkbyBhbmQgYXZvaWQgZHVwbGljYXRlIGNvbnNlY3V0aXZlCiAgICAgICAqIGZsdXNoZXMuIEZvciByZXBlYXRlZCBhbmQgdXNlbGVzcyBjYWxscyB3aXRoIFpfRklOSVNILCB3ZSBrZWVwCiAgICAgICAqIHJldHVybmluZyBaX1NUUkVBTV9FTkQgaW5zdGVhZCBvZiBaX0JVRl9FUlJPUi4KICAgICAgICovCiAgICB9IGVsc2UgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDAgJiYgcmFuayhmbHVzaCkgPD0gcmFuayhvbGRfZmx1c2gpICYmCiAgICAgIGZsdXNoICE9PSBaX0ZJTklTSCQzKSB7CiAgICAgIHJldHVybiBlcnIoc3RybSwgWl9CVUZfRVJST1IkMSk7CiAgICB9CgogICAgLyogVXNlciBtdXN0IG5vdCBwcm92aWRlIG1vcmUgaW5wdXQgYWZ0ZXIgdGhlIGZpcnN0IEZJTklTSDogKi8KICAgIGlmIChzLnN0YXR1cyA9PT0gRklOSVNIX1NUQVRFICYmIHN0cm0uYXZhaWxfaW4gIT09IDApIHsKICAgICAgcmV0dXJuIGVycihzdHJtLCBaX0JVRl9FUlJPUiQxKTsKICAgIH0KCiAgICAvKiBTdGFydCBhIG5ldyBibG9jayBvciBjb250aW51ZSB0aGUgY3VycmVudCBvbmUuCiAgICAgKi8KICAgIGlmIChzdHJtLmF2YWlsX2luICE9PSAwIHx8IHMubG9va2FoZWFkICE9PSAwIHx8CiAgICAgIChmbHVzaCAhPT0gWl9OT19GTFVTSCQyICYmIHMuc3RhdHVzICE9PSBGSU5JU0hfU1RBVEUpKSB7CiAgICAgIGxldCBic3RhdGUgPSAocy5zdHJhdGVneSA9PT0gWl9IVUZGTUFOX09OTFkpID8gZGVmbGF0ZV9odWZmKHMsIGZsdXNoKSA6CiAgICAgICAgKHMuc3RyYXRlZ3kgPT09IFpfUkxFID8gZGVmbGF0ZV9ybGUocywgZmx1c2gpIDoKICAgICAgICAgIGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0uZnVuYyhzLCBmbHVzaCkpOwoKICAgICAgaWYgKGJzdGF0ZSA9PT0gQlNfRklOSVNIX1NUQVJURUQgfHwgYnN0YXRlID09PSBCU19GSU5JU0hfRE9ORSkgewogICAgICAgIHMuc3RhdHVzID0gRklOSVNIX1NUQVRFOwogICAgICB9CiAgICAgIGlmIChic3RhdGUgPT09IEJTX05FRURfTU9SRSB8fCBic3RhdGUgPT09IEJTX0ZJTklTSF9TVEFSVEVEKSB7CiAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICBzLmxhc3RfZmx1c2ggPSAtMTsKICAgICAgICAgIC8qIGF2b2lkIEJVRl9FUlJPUiBuZXh0IGNhbGwsIHNlZSBhYm92ZSAqLwogICAgICAgIH0KICAgICAgICByZXR1cm4gWl9PSyQzOwogICAgICAgIC8qIElmIGZsdXNoICE9IFpfTk9fRkxVU0ggJiYgYXZhaWxfb3V0ID09IDAsIHRoZSBuZXh0IGNhbGwKICAgICAgICAgKiBvZiBkZWZsYXRlIHNob3VsZCB1c2UgdGhlIHNhbWUgZmx1c2ggcGFyYW1ldGVyIHRvIG1ha2Ugc3VyZQogICAgICAgICAqIHRoYXQgdGhlIGZsdXNoIGlzIGNvbXBsZXRlLiBTbyB3ZSBkb24ndCBoYXZlIHRvIG91dHB1dCBhbgogICAgICAgICAqIGVtcHR5IGJsb2NrIGhlcmUsIHRoaXMgd2lsbCBiZSBkb25lIGF0IG5leHQgY2FsbC4gVGhpcyBhbHNvCiAgICAgICAgICogZW5zdXJlcyB0aGF0IGZvciBhIHZlcnkgc21hbGwgb3V0cHV0IGJ1ZmZlciwgd2UgZW1pdCBhdCBtb3N0CiAgICAgICAgICogb25lIGVtcHR5IGJsb2NrLgogICAgICAgICAqLwogICAgICB9CiAgICAgIGlmIChic3RhdGUgPT09IEJTX0JMT0NLX0RPTkUpIHsKICAgICAgICBpZiAoZmx1c2ggPT09IFpfUEFSVElBTF9GTFVTSCkgewogICAgICAgICAgX3RyX2FsaWduKHMpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChmbHVzaCAhPT0gWl9CTE9DSyQxKSB7IC8qIEZVTExfRkxVU0ggb3IgU1lOQ19GTFVTSCAqLwoKICAgICAgICAgIF90cl9zdG9yZWRfYmxvY2socywgMCwgMCwgZmFsc2UpOwogICAgICAgICAgLyogRm9yIGEgZnVsbCBmbHVzaCwgdGhpcyBlbXB0eSBibG9jayB3aWxsIGJlIHJlY29nbml6ZWQKICAgICAgICAgICAqIGFzIGEgc3BlY2lhbCBtYXJrZXIgYnkgaW5mbGF0ZV9zeW5jKCkuCiAgICAgICAgICAgKi8KICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9GVUxMX0ZMVVNIJDEpIHsKICAgICAgICAgICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovICAgICAgICAgICAgIC8qIGZvcmdldCBoaXN0b3J5ICovCiAgICAgICAgICAgIHplcm8ocy5oZWFkKTsgLy8gRmlsbCB3aXRoIE5JTCAoPSAwKTsKCiAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgICAgICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgICAgICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7IC8qIGF2b2lkIEJVRl9FUlJPUiBhdCBuZXh0IGNhbGwsIHNlZSBhYm92ZSAqLwogICAgICAgICAgcmV0dXJuIFpfT0skMzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8vQXNzZXJ0KHN0cm0tPmF2YWlsX291dCA+IDAsICJidWcyIik7CiAgICAvL2lmIChzdHJtLmF2YWlsX291dCA8PSAwKSB7IHRocm93IG5ldyBFcnJvcigiYnVnMiIpO30KCiAgICBpZiAoZmx1c2ggIT09IFpfRklOSVNIJDMpIHsgcmV0dXJuIFpfT0skMzsgfQogICAgaWYgKHMud3JhcCA8PSAwKSB7IHJldHVybiBaX1NUUkVBTV9FTkQkMzsgfQoKICAgIC8qIFdyaXRlIHRoZSB0cmFpbGVyICovCiAgICBpZiAocy53cmFwID09PSAyKSB7CiAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgJiAweGZmKTsKICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gOCkgJiAweGZmKTsKICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gMTYpICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLmFkbGVyID4+IDI0KSAmIDB4ZmYpOwogICAgICBwdXRfYnl0ZShzLCBzdHJtLnRvdGFsX2luICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLnRvdGFsX2luID4+IDgpICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLnRvdGFsX2luID4+IDE2KSAmIDB4ZmYpOwogICAgICBwdXRfYnl0ZShzLCAoc3RybS50b3RhbF9pbiA+PiAyNCkgJiAweGZmKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyICYgMHhmZmZmKTsKICAgIH0KCiAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgLyogSWYgYXZhaWxfb3V0IGlzIHplcm8sIHRoZSBhcHBsaWNhdGlvbiB3aWxsIGNhbGwgZGVmbGF0ZSBhZ2FpbgogICAgICogdG8gZmx1c2ggdGhlIHJlc3QuCiAgICAgKi8KICAgIGlmIChzLndyYXAgPiAwKSB7IHMud3JhcCA9IC1zLndyYXA7IH0KICAgIC8qIHdyaXRlIHRoZSB0cmFpbGVyIG9ubHkgb25jZSEgKi8KICAgIHJldHVybiBzLnBlbmRpbmcgIT09IDAgPyBaX09LJDMgOiBaX1NUUkVBTV9FTkQkMzsKICB9OwoKCiAgY29uc3QgZGVmbGF0ZUVuZCA9IChzdHJtKSA9PiB7CgogICAgaWYgKCFzdHJtLyo9PSBaX05VTEwqLyB8fCAhc3RybS5zdGF0ZS8qPT0gWl9OVUxMKi8pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3Qgc3RhdHVzID0gc3RybS5zdGF0ZS5zdGF0dXM7CiAgICBpZiAoc3RhdHVzICE9PSBJTklUX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gRVhUUkFfU1RBVEUgJiYKICAgICAgc3RhdHVzICE9PSBOQU1FX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gQ09NTUVOVF9TVEFURSAmJgogICAgICBzdGF0dXMgIT09IEhDUkNfU1RBVEUgJiYKICAgICAgc3RhdHVzICE9PSBCVVNZX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gRklOSVNIX1NUQVRFCiAgICApIHsKICAgICAgcmV0dXJuIGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQyKTsKICAgIH0KCiAgICBzdHJtLnN0YXRlID0gbnVsbDsKCiAgICByZXR1cm4gc3RhdHVzID09PSBCVVNZX1NUQVRFID8gZXJyKHN0cm0sIFpfREFUQV9FUlJPUiQyKSA6IFpfT0skMzsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIEluaXRpYWxpemVzIHRoZSBjb21wcmVzc2lvbiBkaWN0aW9uYXJ5IGZyb20gdGhlIGdpdmVuIGJ5dGUKICAgKiBzZXF1ZW5jZSB3aXRob3V0IHByb2R1Y2luZyBhbnkgY29tcHJlc3NlZCBvdXRwdXQuCiAgICovCiAgY29uc3QgZGVmbGF0ZVNldERpY3Rpb25hcnkgPSAoc3RybSwgZGljdGlvbmFyeSkgPT4gewoKICAgIGxldCBkaWN0TGVuZ3RoID0gZGljdGlvbmFyeS5sZW5ndGg7CgogICAgaWYgKCFzdHJtLyo9PSBaX05VTEwqLyB8fCAhc3RybS5zdGF0ZS8qPT0gWl9OVUxMKi8pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CiAgICBjb25zdCB3cmFwID0gcy53cmFwOwoKICAgIGlmICh3cmFwID09PSAyIHx8ICh3cmFwID09PSAxICYmIHMuc3RhdHVzICE9PSBJTklUX1NUQVRFKSB8fCBzLmxvb2thaGVhZCkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMjsKICAgIH0KCiAgICAvKiB3aGVuIHVzaW5nIHpsaWIgd3JhcHBlcnMsIGNvbXB1dGUgQWRsZXItMzIgZm9yIHByb3ZpZGVkIGRpY3Rpb25hcnkgKi8KICAgIGlmICh3cmFwID09PSAxKSB7CiAgICAgIC8qIGFkbGVyMzIoc3RybS0+YWRsZXIsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgpOyAqLwogICAgICBzdHJtLmFkbGVyID0gYWRsZXIzMl8xKHN0cm0uYWRsZXIsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIDApOwogICAgfQoKICAgIHMud3JhcCA9IDA7ICAgLyogYXZvaWQgY29tcHV0aW5nIEFkbGVyLTMyIGluIHJlYWRfYnVmICovCgogICAgLyogaWYgZGljdGlvbmFyeSB3b3VsZCBmaWxsIHdpbmRvdywganVzdCByZXBsYWNlIHRoZSBoaXN0b3J5ICovCiAgICBpZiAoZGljdExlbmd0aCA+PSBzLndfc2l6ZSkgewogICAgICBpZiAod3JhcCA9PT0gMCkgeyAgICAgICAgICAgIC8qIGFscmVhZHkgZW1wdHkgb3RoZXJ3aXNlICovCiAgICAgICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovCiAgICAgICAgemVybyhzLmhlYWQpOyAvLyBGaWxsIHdpdGggTklMICg9IDApOwogICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgfQogICAgICAvKiB1c2UgdGhlIHRhaWwgKi8KICAgICAgLy8gZGljdGlvbmFyeSA9IGRpY3Rpb25hcnkuc2xpY2UoZGljdExlbmd0aCAtIHMud19zaXplKTsKICAgICAgbGV0IHRtcERpY3QgPSBuZXcgVWludDhBcnJheShzLndfc2l6ZSk7CiAgICAgIHRtcERpY3Quc2V0KGRpY3Rpb25hcnkuc3ViYXJyYXkoZGljdExlbmd0aCAtIHMud19zaXplLCBkaWN0TGVuZ3RoKSwgMCk7CiAgICAgIGRpY3Rpb25hcnkgPSB0bXBEaWN0OwogICAgICBkaWN0TGVuZ3RoID0gcy53X3NpemU7CiAgICB9CiAgICAvKiBpbnNlcnQgZGljdGlvbmFyeSBpbnRvIHdpbmRvdyBhbmQgaGFzaCAqLwogICAgY29uc3QgYXZhaWwgPSBzdHJtLmF2YWlsX2luOwogICAgY29uc3QgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgIGNvbnN0IGlucHV0ID0gc3RybS5pbnB1dDsKICAgIHN0cm0uYXZhaWxfaW4gPSBkaWN0TGVuZ3RoOwogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uaW5wdXQgPSBkaWN0aW9uYXJ5OwogICAgZmlsbF93aW5kb3cocyk7CiAgICB3aGlsZSAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIKSB7CiAgICAgIGxldCBzdHIgPSBzLnN0cnN0YXJ0OwogICAgICBsZXQgbiA9IHMubG9va2FoZWFkIC0gKE1JTl9NQVRDSCAtIDEpOwogICAgICBkbyB7CiAgICAgICAgLyogVVBEQVRFX0hBU0gocywgcy0+aW5zX2gsIHMtPndpbmRvd1tzdHIgKyBNSU5fTUFUQ0gtMV0pOyAqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3N0ciArIE1JTl9NQVRDSCAtIDFdKTsKCiAgICAgICAgcy5wcmV2W3N0ciAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKCiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gc3RyOwogICAgICAgIHN0cisrOwogICAgICB9IHdoaWxlICgtLW4pOwogICAgICBzLnN0cnN0YXJ0ID0gc3RyOwogICAgICBzLmxvb2thaGVhZCA9IE1JTl9NQVRDSCAtIDE7CiAgICAgIGZpbGxfd2luZG93KHMpOwogICAgfQogICAgcy5zdHJzdGFydCArPSBzLmxvb2thaGVhZDsKICAgIHMuYmxvY2tfc3RhcnQgPSBzLnN0cnN0YXJ0OwogICAgcy5pbnNlcnQgPSBzLmxvb2thaGVhZDsKICAgIHMubG9va2FoZWFkID0gMDsKICAgIHMubWF0Y2hfbGVuZ3RoID0gcy5wcmV2X2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICBzdHJtLm5leHRfaW4gPSBuZXh0OwogICAgc3RybS5pbnB1dCA9IGlucHV0OwogICAgc3RybS5hdmFpbF9pbiA9IGF2YWlsOwogICAgcy53cmFwID0gd3JhcDsKICAgIHJldHVybiBaX09LJDM7CiAgfTsKCgogIHZhciBkZWZsYXRlSW5pdF8xID0gZGVmbGF0ZUluaXQ7CiAgdmFyIGRlZmxhdGVJbml0Ml8xID0gZGVmbGF0ZUluaXQyOwogIHZhciBkZWZsYXRlUmVzZXRfMSA9IGRlZmxhdGVSZXNldDsKICB2YXIgZGVmbGF0ZVJlc2V0S2VlcF8xID0gZGVmbGF0ZVJlc2V0S2VlcDsKICB2YXIgZGVmbGF0ZVNldEhlYWRlcl8xID0gZGVmbGF0ZVNldEhlYWRlcjsKICB2YXIgZGVmbGF0ZV8yJDEgPSBkZWZsYXRlJDI7CiAgdmFyIGRlZmxhdGVFbmRfMSA9IGRlZmxhdGVFbmQ7CiAgdmFyIGRlZmxhdGVTZXREaWN0aW9uYXJ5XzEgPSBkZWZsYXRlU2V0RGljdGlvbmFyeTsKICB2YXIgZGVmbGF0ZUluZm8gPSAncGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSc7CgogIC8qIE5vdCBpbXBsZW1lbnRlZAogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVCb3VuZCA9IGRlZmxhdGVCb3VuZDsKICBtb2R1bGUuZXhwb3J0cy5kZWZsYXRlQ29weSA9IGRlZmxhdGVDb3B5OwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVQYXJhbXMgPSBkZWZsYXRlUGFyYW1zOwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVQZW5kaW5nID0gZGVmbGF0ZVBlbmRpbmc7CiAgbW9kdWxlLmV4cG9ydHMuZGVmbGF0ZVByaW1lID0gZGVmbGF0ZVByaW1lOwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVUdW5lID0gZGVmbGF0ZVR1bmU7CiAgKi8KCiAgdmFyIGRlZmxhdGVfMSQyID0gewogIAlkZWZsYXRlSW5pdDogZGVmbGF0ZUluaXRfMSwKICAJZGVmbGF0ZUluaXQyOiBkZWZsYXRlSW5pdDJfMSwKICAJZGVmbGF0ZVJlc2V0OiBkZWZsYXRlUmVzZXRfMSwKICAJZGVmbGF0ZVJlc2V0S2VlcDogZGVmbGF0ZVJlc2V0S2VlcF8xLAogIAlkZWZsYXRlU2V0SGVhZGVyOiBkZWZsYXRlU2V0SGVhZGVyXzEsCiAgCWRlZmxhdGU6IGRlZmxhdGVfMiQxLAogIAlkZWZsYXRlRW5kOiBkZWZsYXRlRW5kXzEsCiAgCWRlZmxhdGVTZXREaWN0aW9uYXJ5OiBkZWZsYXRlU2V0RGljdGlvbmFyeV8xLAogIAlkZWZsYXRlSW5mbzogZGVmbGF0ZUluZm8KICB9OwoKICBjb25zdCBfaGFzID0gKG9iaiwga2V5KSA9PiB7CiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKICB9OwoKICB2YXIgYXNzaWduID0gZnVuY3Rpb24gKG9iaiAvKmZyb20xLCBmcm9tMiwgZnJvbTMsIC4uLiovKSB7CiAgICBjb25zdCBzb3VyY2VzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHdoaWxlIChzb3VyY2VzLmxlbmd0aCkgewogICAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7CiAgICAgIGlmICghc291cmNlKSB7IGNvbnRpbnVlOyB9CgogICAgICBpZiAodHlwZW9mIHNvdXJjZSAhPT0gJ29iamVjdCcpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHNvdXJjZSArICdtdXN0IGJlIG5vbi1vYmplY3QnKTsKICAgICAgfQoKICAgICAgZm9yIChjb25zdCBwIGluIHNvdXJjZSkgewogICAgICAgIGlmIChfaGFzKHNvdXJjZSwgcCkpIHsKICAgICAgICAgIG9ialtwXSA9IHNvdXJjZVtwXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07CgoKICAvLyBKb2luIGFycmF5IG9mIGNodW5rcyB0byBzaW5nbGUgYXJyYXkuCiAgdmFyIGZsYXR0ZW5DaHVua3MgPSAoY2h1bmtzKSA9PiB7CiAgICAvLyBjYWxjdWxhdGUgZGF0YSBsZW5ndGgKICAgIGxldCBsZW4gPSAwOwoKICAgIGZvciAobGV0IGkgPSAwLCBsID0gY2h1bmtzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBsZW4gKz0gY2h1bmtzW2ldLmxlbmd0aDsKICAgIH0KCiAgICAvLyBqb2luIGNodW5rcwogICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkobGVuKTsKCiAgICBmb3IgKGxldCBpID0gMCwgcG9zID0gMCwgbCA9IGNodW5rcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgbGV0IGNodW5rID0gY2h1bmtzW2ldOwogICAgICByZXN1bHQuc2V0KGNodW5rLCBwb3MpOwogICAgICBwb3MgKz0gY2h1bmsubGVuZ3RoOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgdmFyIGNvbW1vbiA9IHsKICAJYXNzaWduOiBhc3NpZ24sCiAgCWZsYXR0ZW5DaHVua3M6IGZsYXR0ZW5DaHVua3MKICB9OwoKICAvLyBTdHJpbmcgZW5jb2RlL2RlY29kZSBoZWxwZXJzCgoKICAvLyBRdWljayBjaGVjayBpZiB3ZSBjYW4gdXNlIGZhc3QgYXJyYXkgdG8gYmluIHN0cmluZyBjb252ZXJzaW9uCiAgLy8KICAvLyAtIGFwcGx5KEFycmF5KSBjYW4gZmFpbCBvbiBBbmRyb2lkIDIuMgogIC8vIC0gYXBwbHkoVWludDhBcnJheSkgY2FuIGZhaWwgb24gaU9TIDUuMSBTYWZhcmkKICAvLwogIGxldCBTVFJfQVBQTFlfVUlBX09LID0gdHJ1ZTsKCiAgdHJ5IHsgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheSgxKSk7IH0gY2F0Y2ggKF9fKSB7IFNUUl9BUFBMWV9VSUFfT0sgPSBmYWxzZTsgfQoKCiAgLy8gVGFibGUgd2l0aCB1dGY4IGxlbmd0aHMgKGNhbGN1bGF0ZWQgYnkgZmlyc3QgYnl0ZSBvZiBzZXF1ZW5jZSkKICAvLyBOb3RlLCB0aGF0IDUgJiA2LWJ5dGUgdmFsdWVzIGFuZCBzb21lIDQtYnl0ZSB2YWx1ZXMgY2FuIG5vdCBiZSByZXByZXNlbnRlZCBpbiBKUywKICAvLyBiZWNhdXNlIG1heCBwb3NzaWJsZSBjb2RlcG9pbnQgaXMgMHgxMGZmZmYKICBjb25zdCBfdXRmOGxlbiA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgZm9yIChsZXQgcSA9IDA7IHEgPCAyNTY7IHErKykgewogICAgX3V0ZjhsZW5bcV0gPSAocSA+PSAyNTIgPyA2IDogcSA+PSAyNDggPyA1IDogcSA+PSAyNDAgPyA0IDogcSA+PSAyMjQgPyAzIDogcSA+PSAxOTIgPyAyIDogMSk7CiAgfQogIF91dGY4bGVuWzI1NF0gPSBfdXRmOGxlblsyNTRdID0gMTsgLy8gSW52YWxpZCBzZXF1ZW5jZSBzdGFydAoKCiAgLy8gY29udmVydCBzdHJpbmcgdG8gYXJyYXkgKHR5cGVkLCB3aGVuIHBvc3NpYmxlKQogIHZhciBzdHJpbmcyYnVmID0gKHN0cikgPT4gewogICAgaWYgKHR5cGVvZiBUZXh0RW5jb2RlciA9PT0gJ2Z1bmN0aW9uJyAmJiBUZXh0RW5jb2Rlci5wcm90b3R5cGUuZW5jb2RlKSB7CiAgICAgIHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoc3RyKTsKICAgIH0KCiAgICBsZXQgYnVmLCBjLCBjMiwgbV9wb3MsIGksIHN0cl9sZW4gPSBzdHIubGVuZ3RoLCBidWZfbGVuID0gMDsKCiAgICAvLyBjb3VudCBiaW5hcnkgc2l6ZQogICAgZm9yIChtX3BvcyA9IDA7IG1fcG9zIDwgc3RyX2xlbjsgbV9wb3MrKykgewogICAgICBjID0gc3RyLmNoYXJDb2RlQXQobV9wb3MpOwogICAgICBpZiAoKGMgJiAweGZjMDApID09PSAweGQ4MDAgJiYgKG1fcG9zICsgMSA8IHN0cl9sZW4pKSB7CiAgICAgICAgYzIgPSBzdHIuY2hhckNvZGVBdChtX3BvcyArIDEpOwogICAgICAgIGlmICgoYzIgJiAweGZjMDApID09PSAweGRjMDApIHsKICAgICAgICAgIGMgPSAweDEwMDAwICsgKChjIC0gMHhkODAwKSA8PCAxMCkgKyAoYzIgLSAweGRjMDApOwogICAgICAgICAgbV9wb3MrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnVmX2xlbiArPSBjIDwgMHg4MCA/IDEgOiBjIDwgMHg4MDAgPyAyIDogYyA8IDB4MTAwMDAgPyAzIDogNDsKICAgIH0KCiAgICAvLyBhbGxvY2F0ZSBidWZmZXIKICAgIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGJ1Zl9sZW4pOwoKICAgIC8vIGNvbnZlcnQKICAgIGZvciAoaSA9IDAsIG1fcG9zID0gMDsgaSA8IGJ1Zl9sZW47IG1fcG9zKyspIHsKICAgICAgYyA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zKTsKICAgICAgaWYgKChjICYgMHhmYzAwKSA9PT0gMHhkODAwICYmIChtX3BvcyArIDEgPCBzdHJfbGVuKSkgewogICAgICAgIGMyID0gc3RyLmNoYXJDb2RlQXQobV9wb3MgKyAxKTsKICAgICAgICBpZiAoKGMyICYgMHhmYzAwKSA9PT0gMHhkYzAwKSB7CiAgICAgICAgICBjID0gMHgxMDAwMCArICgoYyAtIDB4ZDgwMCkgPDwgMTApICsgKGMyIC0gMHhkYzAwKTsKICAgICAgICAgIG1fcG9zKys7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjIDwgMHg4MCkgewogICAgICAgIC8qIG9uZSBieXRlICovCiAgICAgICAgYnVmW2krK10gPSBjOwogICAgICB9IGVsc2UgaWYgKGMgPCAweDgwMCkgewogICAgICAgIC8qIHR3byBieXRlcyAqLwogICAgICAgIGJ1ZltpKytdID0gMHhDMCB8IChjID4+PiA2KTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyAmIDB4M2YpOwogICAgICB9IGVsc2UgaWYgKGMgPCAweDEwMDAwKSB7CiAgICAgICAgLyogdGhyZWUgYnl0ZXMgKi8KICAgICAgICBidWZbaSsrXSA9IDB4RTAgfCAoYyA+Pj4gMTIpOwogICAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjID4+PiA2ICYgMHgzZik7CiAgICAgICAgYnVmW2krK10gPSAweDgwIHwgKGMgJiAweDNmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBmb3VyIGJ5dGVzICovCiAgICAgICAgYnVmW2krK10gPSAweGYwIHwgKGMgPj4+IDE4KTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyA+Pj4gMTIgJiAweDNmKTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyA+Pj4gNiAmIDB4M2YpOwogICAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjICYgMHgzZik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYnVmOwogIH07CgogIC8vIEhlbHBlcgogIGNvbnN0IGJ1ZjJiaW5zdHJpbmcgPSAoYnVmLCBsZW4pID0+IHsKICAgIC8vIE9uIENocm9tZSwgdGhlIGFyZ3VtZW50cyBpbiBhIGZ1bmN0aW9uIGNhbGwgdGhhdCBhcmUgYWxsb3dlZCBpcyBgNjU1MzRgLgogICAgLy8gSWYgdGhlIGxlbmd0aCBvZiB0aGUgYnVmZmVyIGlzIHNtYWxsZXIgdGhhbiB0aGF0LCB3ZSBjYW4gdXNlIHRoaXMgb3B0aW1pemF0aW9uLAogICAgLy8gb3RoZXJ3aXNlIHdlIHdpbGwgdGFrZSBhIHNsb3dlciBwYXRoLgogICAgaWYgKGxlbiA8IDY1NTM0KSB7CiAgICAgIGlmIChidWYuc3ViYXJyYXkgJiYgU1RSX0FQUExZX1VJQV9PSykgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGJ1Zi5sZW5ndGggPT09IGxlbiA/IGJ1ZiA6IGJ1Zi5zdWJhcnJheSgwLCBsZW4pKTsKICAgICAgfQogICAgfQoKICAgIGxldCByZXN1bHQgPSAnJzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCgogIC8vIGNvbnZlcnQgYXJyYXkgdG8gc3RyaW5nCiAgdmFyIGJ1ZjJzdHJpbmcgPSAoYnVmLCBtYXgpID0+IHsKICAgIGNvbnN0IGxlbiA9IG1heCB8fCBidWYubGVuZ3RoOwoKICAgIGlmICh0eXBlb2YgVGV4dERlY29kZXIgPT09ICdmdW5jdGlvbicgJiYgVGV4dERlY29kZXIucHJvdG90eXBlLmRlY29kZSkgewogICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGJ1Zi5zdWJhcnJheSgwLCBtYXgpKTsKICAgIH0KCiAgICBsZXQgaSwgb3V0OwoKICAgIC8vIFJlc2VydmUgbWF4IHBvc3NpYmxlIGxlbmd0aCAoMiB3b3JkcyBwZXIgY2hhcikKICAgIC8vIE5COiBieSB1bmtub3duIHJlYXNvbnMsIEFycmF5IGlzIHNpZ25pZmljYW50bHkgZmFzdGVyIGZvcgogICAgLy8gICAgIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkgdGhhbiBVaW50MTZBcnJheS4KICAgIGNvbnN0IHV0ZjE2YnVmID0gbmV3IEFycmF5KGxlbiAqIDIpOwoKICAgIGZvciAob3V0ID0gMCwgaSA9IDA7IGkgPCBsZW47KSB7CiAgICAgIGxldCBjID0gYnVmW2krK107CiAgICAgIC8vIHF1aWNrIHByb2Nlc3MgYXNjaWkKICAgICAgaWYgKGMgPCAweDgwKSB7IHV0ZjE2YnVmW291dCsrXSA9IGM7IGNvbnRpbnVlOyB9CgogICAgICBsZXQgY19sZW4gPSBfdXRmOGxlbltjXTsKICAgICAgLy8gc2tpcCA1ICYgNiBieXRlIGNvZGVzCiAgICAgIGlmIChjX2xlbiA+IDQpIHsgdXRmMTZidWZbb3V0KytdID0gMHhmZmZkOyBpICs9IGNfbGVuIC0gMTsgY29udGludWU7IH0KCiAgICAgIC8vIGFwcGx5IG1hc2sgb24gZmlyc3QgYnl0ZQogICAgICBjICY9IGNfbGVuID09PSAyID8gMHgxZiA6IGNfbGVuID09PSAzID8gMHgwZiA6IDB4MDc7CiAgICAgIC8vIGpvaW4gdGhlIHJlc3QKICAgICAgd2hpbGUgKGNfbGVuID4gMSAmJiBpIDwgbGVuKSB7CiAgICAgICAgYyA9IChjIDw8IDYpIHwgKGJ1ZltpKytdICYgMHgzZik7CiAgICAgICAgY19sZW4tLTsKICAgICAgfQoKICAgICAgLy8gdGVybWluYXRlZCBieSBlbmQgb2Ygc3RyaW5nPwogICAgICBpZiAoY19sZW4gPiAxKSB7IHV0ZjE2YnVmW291dCsrXSA9IDB4ZmZmZDsgY29udGludWU7IH0KCiAgICAgIGlmIChjIDwgMHgxMDAwMCkgewogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IGM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyAtPSAweDEwMDAwOwogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IDB4ZDgwMCB8ICgoYyA+PiAxMCkgJiAweDNmZik7CiAgICAgICAgdXRmMTZidWZbb3V0KytdID0gMHhkYzAwIHwgKGMgJiAweDNmZik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYnVmMmJpbnN0cmluZyh1dGYxNmJ1Ziwgb3V0KTsKICB9OwoKCiAgLy8gQ2FsY3VsYXRlIG1heCBwb3NzaWJsZSBwb3NpdGlvbiBpbiB1dGY4IGJ1ZmZlciwKICAvLyB0aGF0IHdpbGwgbm90IGJyZWFrIHNlcXVlbmNlLiBJZiB0aGF0J3Mgbm90IHBvc3NpYmxlCiAgLy8gLSAodmVyeSBzbWFsbCBsaW1pdHMpIHJldHVybiBtYXggc2l6ZSBhcyBpcy4KICAvLwogIC8vIGJ1ZltdIC0gdXRmOCBieXRlcyBhcnJheQogIC8vIG1heCAgIC0gbGVuZ3RoIGxpbWl0IChtYW5kYXRvcnkpOwogIHZhciB1dGY4Ym9yZGVyID0gKGJ1ZiwgbWF4KSA9PiB7CgogICAgbWF4ID0gbWF4IHx8IGJ1Zi5sZW5ndGg7CiAgICBpZiAobWF4ID4gYnVmLmxlbmd0aCkgeyBtYXggPSBidWYubGVuZ3RoOyB9CgogICAgLy8gZ28gYmFjayBmcm9tIGxhc3QgcG9zaXRpb24sIHVudGlsIHN0YXJ0IG9mIHNlcXVlbmNlIGZvdW5kCiAgICBsZXQgcG9zID0gbWF4IC0gMTsKICAgIHdoaWxlIChwb3MgPj0gMCAmJiAoYnVmW3Bvc10gJiAweEMwKSA9PT0gMHg4MCkgeyBwb3MtLTsgfQoKICAgIC8vIFZlcnkgc21hbGwgYW5kIGJyb2tlbiBzZXF1ZW5jZSwKICAgIC8vIHJldHVybiBtYXgsIGJlY2F1c2Ugd2Ugc2hvdWxkIHJldHVybiBzb21ldGhpbmcgYW55d2F5LgogICAgaWYgKHBvcyA8IDApIHsgcmV0dXJuIG1heDsgfQoKICAgIC8vIElmIHdlIGNhbWUgdG8gc3RhcnQgb2YgYnVmZmVyIC0gdGhhdCBtZWFucyBidWZmZXIgaXMgdG9vIHNtYWxsLAogICAgLy8gcmV0dXJuIG1heCB0b28uCiAgICBpZiAocG9zID09PSAwKSB7IHJldHVybiBtYXg7IH0KCiAgICByZXR1cm4gKHBvcyArIF91dGY4bGVuW2J1Zltwb3NdXSA+IG1heCkgPyBwb3MgOiBtYXg7CiAgfTsKCiAgdmFyIHN0cmluZ3MgPSB7CiAgCXN0cmluZzJidWY6IHN0cmluZzJidWYsCiAgCWJ1ZjJzdHJpbmc6IGJ1ZjJzdHJpbmcsCiAgCXV0Zjhib3JkZXI6IHV0Zjhib3JkZXIKICB9OwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgZnVuY3Rpb24gWlN0cmVhbSgpIHsKICAgIC8qIG5leHQgaW5wdXQgYnl0ZSAqLwogICAgdGhpcy5pbnB1dCA9IG51bGw7IC8vIEpTIHNwZWNpZmljLCBiZWNhdXNlIHdlIGhhdmUgbm8gcG9pbnRlcnMKICAgIHRoaXMubmV4dF9pbiA9IDA7CiAgICAvKiBudW1iZXIgb2YgYnl0ZXMgYXZhaWxhYmxlIGF0IGlucHV0ICovCiAgICB0aGlzLmF2YWlsX2luID0gMDsKICAgIC8qIHRvdGFsIG51bWJlciBvZiBpbnB1dCBieXRlcyByZWFkIHNvIGZhciAqLwogICAgdGhpcy50b3RhbF9pbiA9IDA7CiAgICAvKiBuZXh0IG91dHB1dCBieXRlIHNob3VsZCBiZSBwdXQgdGhlcmUgKi8KICAgIHRoaXMub3V0cHV0ID0gbnVsbDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwogICAgdGhpcy5uZXh0X291dCA9IDA7CiAgICAvKiByZW1haW5pbmcgZnJlZSBzcGFjZSBhdCBvdXRwdXQgKi8KICAgIHRoaXMuYXZhaWxfb3V0ID0gMDsKICAgIC8qIHRvdGFsIG51bWJlciBvZiBieXRlcyBvdXRwdXQgc28gZmFyICovCiAgICB0aGlzLnRvdGFsX291dCA9IDA7CiAgICAvKiBsYXN0IGVycm9yIG1lc3NhZ2UsIE5VTEwgaWYgbm8gZXJyb3IgKi8KICAgIHRoaXMubXNnID0gJycvKlpfTlVMTCovOwogICAgLyogbm90IHZpc2libGUgYnkgYXBwbGljYXRpb25zICovCiAgICB0aGlzLnN0YXRlID0gbnVsbDsKICAgIC8qIGJlc3QgZ3Vlc3MgYWJvdXQgdGhlIGRhdGEgdHlwZTogYmluYXJ5IG9yIHRleHQgKi8KICAgIHRoaXMuZGF0YV90eXBlID0gMi8qWl9VTktOT1dOKi87CiAgICAvKiBhZGxlcjMyIHZhbHVlIG9mIHRoZSB1bmNvbXByZXNzZWQgZGF0YSAqLwogICAgdGhpcy5hZGxlciA9IDA7CiAgfQoKICB2YXIgenN0cmVhbSA9IFpTdHJlYW07CgogIGNvbnN0IHRvU3RyaW5nJDEgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwoKICAvKiBQdWJsaWMgY29uc3RhbnRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgogIGNvbnN0IHsKICAgIFpfTk9fRkxVU0g6IFpfTk9fRkxVU0gkMSwgWl9TWU5DX0ZMVVNILCBaX0ZVTExfRkxVU0gsIFpfRklOSVNIOiBaX0ZJTklTSCQyLAogICAgWl9PSzogWl9PSyQyLCBaX1NUUkVBTV9FTkQ6IFpfU1RSRUFNX0VORCQyLAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OLAogICAgWl9ERUZBVUxUX1NUUkFURUdZLAogICAgWl9ERUZMQVRFRDogWl9ERUZMQVRFRCQxCiAgfSA9IGNvbnN0YW50cyQyOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLyoqCiAgICogY2xhc3MgRGVmbGF0ZQogICAqCiAgICogR2VuZXJpYyBKUy1zdHlsZSB3cmFwcGVyIGZvciB6bGliIGNhbGxzLiBJZiB5b3UgZG9uJ3QgbmVlZAogICAqIHN0cmVhbWluZyBiZWhhdmlvdXIgLSB1c2UgbW9yZSBzaW1wbGUgZnVuY3Rpb25zOiBbW2RlZmxhdGVdXSwKICAgKiBbW2RlZmxhdGVSYXddXSBhbmQgW1tnemlwXV0uCiAgICoqLwoKICAvKiBpbnRlcm5hbAogICAqIERlZmxhdGUuY2h1bmtzIC0+IEFycmF5CiAgICoKICAgKiBDaHVua3Mgb2Ygb3V0cHV0IGRhdGEsIGlmIFtbRGVmbGF0ZSNvbkRhdGFdXSBub3Qgb3ZlcnJpZGRlbi4KICAgKiovCgogIC8qKgogICAqIERlZmxhdGUucmVzdWx0IC0+IFVpbnQ4QXJyYXkKICAgKgogICAqIENvbXByZXNzZWQgcmVzdWx0LCBnZW5lcmF0ZWQgYnkgZGVmYXVsdCBbW0RlZmxhdGUjb25EYXRhXV0KICAgKiBhbmQgW1tEZWZsYXRlI29uRW5kXV0gaGFuZGxlcnMuIEZpbGxlZCBhZnRlciB5b3UgcHVzaCBsYXN0IGNodW5rCiAgICogKGNhbGwgW1tEZWZsYXRlI3B1c2hdXSB3aXRoIGBaX0ZJTklTSGAgLyBgdHJ1ZWAgcGFyYW0pLgogICAqKi8KCiAgLyoqCiAgICogRGVmbGF0ZS5lcnIgLT4gTnVtYmVyCiAgICoKICAgKiBFcnJvciBjb2RlIGFmdGVyIGRlZmxhdGUgZmluaXNoZWQuIDAgKFpfT0spIG9uIHN1Y2Nlc3MuCiAgICogWW91IHdpbGwgbm90IG5lZWQgaXQgaW4gcmVhbCBsaWZlLCBiZWNhdXNlIGRlZmxhdGUgZXJyb3JzCiAgICogYXJlIHBvc3NpYmxlIG9ubHkgb24gd3Jvbmcgb3B0aW9ucyBvciBiYWQgYG9uRGF0YWAgLyBgb25FbmRgCiAgICogY3VzdG9tIGhhbmRsZXJzLgogICAqKi8KCiAgLyoqCiAgICogRGVmbGF0ZS5tc2cgLT4gU3RyaW5nCiAgICoKICAgKiBFcnJvciBtZXNzYWdlLCBpZiBbW0RlZmxhdGUuZXJyXV0gIT0gMAogICAqKi8KCgogIC8qKgogICAqIG5ldyBEZWZsYXRlKG9wdGlvbnMpCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGRlZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIENyZWF0ZXMgbmV3IGRlZmxhdG9yIGluc3RhbmNlIHdpdGggc3BlY2lmaWVkIHBhcmFtcy4gVGhyb3dzIGV4Y2VwdGlvbgogICAqIG9uIGJhZCBwYXJhbXMuIFN1cHBvcnRlZCBvcHRpb25zOgogICAqCiAgICogLSBgbGV2ZWxgCiAgICogLSBgd2luZG93Qml0c2AKICAgKiAtIGBtZW1MZXZlbGAKICAgKiAtIGBzdHJhdGVneWAKICAgKiAtIGBkaWN0aW9uYXJ5YAogICAqCiAgICogW2h0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZF0oaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkKQogICAqIGZvciBtb3JlIGluZm9ybWF0aW9uIG9uIHRoZXNlLgogICAqCiAgICogQWRkaXRpb25hbCBvcHRpb25zLCBmb3IgaW50ZXJuYWwgbmVlZHM6CiAgICoKICAgKiAtIGBjaHVua1NpemVgIC0gc2l6ZSBvZiBnZW5lcmF0ZWQgZGF0YSBjaHVua3MgKDE2SyBieSBkZWZhdWx0KQogICAqIC0gYHJhd2AgKEJvb2xlYW4pIC0gZG8gcmF3IGRlZmxhdGUKICAgKiAtIGBnemlwYCAoQm9vbGVhbikgLSBjcmVhdGUgZ3ppcCB3cmFwcGVyCiAgICogLSBgaGVhZGVyYCAoT2JqZWN0KSAtIGN1c3RvbSBoZWFkZXIgZm9yIGd6aXAKICAgKiAgIC0gYHRleHRgIChCb29sZWFuKSAtIHRydWUgaWYgY29tcHJlc3NlZCBkYXRhIGJlbGlldmVkIHRvIGJlIHRleHQKICAgKiAgIC0gYHRpbWVgIChOdW1iZXIpIC0gbW9kaWZpY2F0aW9uIHRpbWUsIHVuaXggdGltZXN0YW1wCiAgICogICAtIGBvc2AgKE51bWJlcikgLSBvcGVyYXRpb24gc3lzdGVtIGNvZGUKICAgKiAgIC0gYGV4dHJhYCAoQXJyYXkpIC0gYXJyYXkgb2YgYnl0ZXMgd2l0aCBleHRyYSBkYXRhIChtYXggNjU1MzYpCiAgICogICAtIGBuYW1lYCAoU3RyaW5nKSAtIGZpbGUgbmFtZSAoYmluYXJ5IHN0cmluZykKICAgKiAgIC0gYGNvbW1lbnRgIChTdHJpbmcpIC0gY29tbWVudCAoYmluYXJ5IHN0cmluZykKICAgKiAgIC0gYGhjcmNgIChCb29sZWFuKSAtIHRydWUgaWYgaGVhZGVyIGNyYyBzaG91bGQgYmUgYWRkZWQKICAgKgogICAqICMjIyMjIEV4YW1wbGU6CiAgICoKICAgKiBgYGBqYXZhc2NyaXB0CiAgICogY29uc3QgcGFrbyA9IHJlcXVpcmUoJ3Bha28nKQogICAqICAgLCBjaHVuazEgPSBuZXcgVWludDhBcnJheShbMSwyLDMsNCw1LDYsNyw4LDldKQogICAqICAgLCBjaHVuazIgPSBuZXcgVWludDhBcnJheShbMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMTgsMTldKTsKICAgKgogICAqIGNvbnN0IGRlZmxhdGUgPSBuZXcgcGFrby5EZWZsYXRlKHsgbGV2ZWw6IDN9KTsKICAgKgogICAqIGRlZmxhdGUucHVzaChjaHVuazEsIGZhbHNlKTsKICAgKiBkZWZsYXRlLnB1c2goY2h1bmsyLCB0cnVlKTsgIC8vIHRydWUgLT4gbGFzdCBjaHVuawogICAqCiAgICogaWYgKGRlZmxhdGUuZXJyKSB7IHRocm93IG5ldyBFcnJvcihkZWZsYXRlLmVycik7IH0KICAgKgogICAqIGNvbnNvbGUubG9nKGRlZmxhdGUucmVzdWx0KTsKICAgKiBgYGAKICAgKiovCiAgZnVuY3Rpb24gRGVmbGF0ZSQxKG9wdGlvbnMpIHsKICAgIHRoaXMub3B0aW9ucyA9IGNvbW1vbi5hc3NpZ24oewogICAgICBsZXZlbDogWl9ERUZBVUxUX0NPTVBSRVNTSU9OLAogICAgICBtZXRob2Q6IFpfREVGTEFURUQkMSwKICAgICAgY2h1bmtTaXplOiAxNjM4NCwKICAgICAgd2luZG93Qml0czogMTUsCiAgICAgIG1lbUxldmVsOiA4LAogICAgICBzdHJhdGVneTogWl9ERUZBVUxUX1NUUkFURUdZCiAgICB9LCBvcHRpb25zIHx8IHt9KTsKCiAgICBsZXQgb3B0ID0gdGhpcy5vcHRpb25zOwoKICAgIGlmIChvcHQucmF3ICYmIChvcHQud2luZG93Qml0cyA+IDApKSB7CiAgICAgIG9wdC53aW5kb3dCaXRzID0gLW9wdC53aW5kb3dCaXRzOwogICAgfQoKICAgIGVsc2UgaWYgKG9wdC5nemlwICYmIChvcHQud2luZG93Qml0cyA+IDApICYmIChvcHQud2luZG93Qml0cyA8IDE2KSkgewogICAgICBvcHQud2luZG93Qml0cyArPSAxNjsKICAgIH0KCiAgICB0aGlzLmVyciAgICA9IDA7ICAgICAgLy8gZXJyb3IgY29kZSwgaWYgaGFwcGVucyAoMCA9IFpfT0spCiAgICB0aGlzLm1zZyAgICA9ICcnOyAgICAgLy8gZXJyb3IgbWVzc2FnZQogICAgdGhpcy5lbmRlZCAgPSBmYWxzZTsgIC8vIHVzZWQgdG8gYXZvaWQgbXVsdGlwbGUgb25FbmQoKSBjYWxscwogICAgdGhpcy5jaHVua3MgPSBbXTsgICAgIC8vIGNodW5rcyBvZiBjb21wcmVzc2VkIGRhdGEKCiAgICB0aGlzLnN0cm0gPSBuZXcgenN0cmVhbSgpOwogICAgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CgogICAgbGV0IHN0YXR1cyA9IGRlZmxhdGVfMSQyLmRlZmxhdGVJbml0MigKICAgICAgdGhpcy5zdHJtLAogICAgICBvcHQubGV2ZWwsCiAgICAgIG9wdC5tZXRob2QsCiAgICAgIG9wdC53aW5kb3dCaXRzLAogICAgICBvcHQubWVtTGV2ZWwsCiAgICAgIG9wdC5zdHJhdGVneQogICAgKTsKCiAgICBpZiAoc3RhdHVzICE9PSBaX09LJDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2VzW3N0YXR1c10pOwogICAgfQoKICAgIGlmIChvcHQuaGVhZGVyKSB7CiAgICAgIGRlZmxhdGVfMSQyLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLCBvcHQuaGVhZGVyKTsKICAgIH0KCiAgICBpZiAob3B0LmRpY3Rpb25hcnkpIHsKICAgICAgbGV0IGRpY3Q7CiAgICAgIC8vIENvbnZlcnQgZGF0YSBpZiBuZWVkZWQKICAgICAgaWYgKHR5cGVvZiBvcHQuZGljdGlvbmFyeSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAvLyBJZiB3ZSBuZWVkIHRvIGNvbXByZXNzIHRleHQsIGNoYW5nZSBlbmNvZGluZyB0byB1dGY4LgogICAgICAgIGRpY3QgPSBzdHJpbmdzLnN0cmluZzJidWYob3B0LmRpY3Rpb25hcnkpOwogICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nJDEuY2FsbChvcHQuZGljdGlvbmFyeSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgICBkaWN0ID0gbmV3IFVpbnQ4QXJyYXkob3B0LmRpY3Rpb25hcnkpOwogICAgICB9IGVsc2UgewogICAgICAgIGRpY3QgPSBvcHQuZGljdGlvbmFyeTsKICAgICAgfQoKICAgICAgc3RhdHVzID0gZGVmbGF0ZV8xJDIuZGVmbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBkaWN0KTsKCiAgICAgIGlmIChzdGF0dXMgIT09IFpfT0skMikgewogICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlc1tzdGF0dXNdKTsKICAgICAgfQoKICAgICAgdGhpcy5fZGljdF9zZXQgPSB0cnVlOwogICAgfQogIH0KCiAgLyoqCiAgICogRGVmbGF0ZSNwdXNoKGRhdGFbLCBmbHVzaF9tb2RlXSkgLT4gQm9vbGVhbgogICAqIC0gZGF0YSAoVWludDhBcnJheXxBcnJheUJ1ZmZlcnxTdHJpbmcpOiBpbnB1dCBkYXRhLiBTdHJpbmdzIHdpbGwgYmUKICAgKiAgIGNvbnZlcnRlZCB0byB1dGY4IGJ5dGUgc2VxdWVuY2UuCiAgICogLSBmbHVzaF9tb2RlIChOdW1iZXJ8Qm9vbGVhbik6IDAuLjYgZm9yIGNvcnJlc3BvbmRpbmcgWl9OT19GTFVTSC4uWl9UUkVFIG1vZGVzLgogICAqICAgU2VlIGNvbnN0YW50cy4gU2tpcHBlZCBvciBgZmFsc2VgIG1lYW5zIFpfTk9fRkxVU0gsIGB0cnVlYCBtZWFucyBaX0ZJTklTSC4KICAgKgogICAqIFNlbmRzIGlucHV0IGRhdGEgdG8gZGVmbGF0ZSBwaXBlLCBnZW5lcmF0aW5nIFtbRGVmbGF0ZSNvbkRhdGFdXSBjYWxscyB3aXRoCiAgICogbmV3IGNvbXByZXNzZWQgY2h1bmtzLiBSZXR1cm5zIGB0cnVlYCBvbiBzdWNjZXNzLiBUaGUgbGFzdCBkYXRhIGJsb2NrIG11c3QKICAgKiBoYXZlIGBmbHVzaF9tb2RlYCBaX0ZJTklTSCAob3IgYHRydWVgKS4gVGhhdCB3aWxsIGZsdXNoIGludGVybmFsIHBlbmRpbmcKICAgKiBidWZmZXJzIGFuZCBjYWxsIFtbRGVmbGF0ZSNvbkVuZF1dLgogICAqCiAgICogT24gZmFpbCBjYWxsIFtbRGVmbGF0ZSNvbkVuZF1dIHdpdGggZXJyb3IgY29kZSBhbmQgcmV0dXJuIGZhbHNlLgogICAqCiAgICogIyMjIyMgRXhhbXBsZQogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIHB1c2goY2h1bmssIGZhbHNlKTsgLy8gcHVzaCBvbmUgb2YgZGF0YSBjaHVua3MKICAgKiAuLi4KICAgKiBwdXNoKGNodW5rLCB0cnVlKTsgIC8vIHB1c2ggbGFzdCBjaHVuawogICAqIGBgYAogICAqKi8KICBEZWZsYXRlJDEucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAoZGF0YSwgZmx1c2hfbW9kZSkgewogICAgY29uc3Qgc3RybSA9IHRoaXMuc3RybTsKICAgIGNvbnN0IGNodW5rU2l6ZSA9IHRoaXMub3B0aW9ucy5jaHVua1NpemU7CiAgICBsZXQgc3RhdHVzLCBfZmx1c2hfbW9kZTsKCiAgICBpZiAodGhpcy5lbmRlZCkgeyByZXR1cm4gZmFsc2U7IH0KCiAgICBpZiAoZmx1c2hfbW9kZSA9PT0gfn5mbHVzaF9tb2RlKSBfZmx1c2hfbW9kZSA9IGZsdXNoX21vZGU7CiAgICBlbHNlIF9mbHVzaF9tb2RlID0gZmx1c2hfbW9kZSA9PT0gdHJ1ZSA/IFpfRklOSVNIJDIgOiBaX05PX0ZMVVNIJDE7CgogICAgLy8gQ29udmVydCBkYXRhIGlmIG5lZWRlZAogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgewogICAgICAvLyBJZiB3ZSBuZWVkIHRvIGNvbXByZXNzIHRleHQsIGNoYW5nZSBlbmNvZGluZyB0byB1dGY4LgogICAgICBzdHJtLmlucHV0ID0gc3RyaW5ncy5zdHJpbmcyYnVmKGRhdGEpOwogICAgfSBlbHNlIGlmICh0b1N0cmluZyQxLmNhbGwoZGF0YSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgc3RybS5pbnB1dCA9IGRhdGE7CiAgICB9CgogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uYXZhaWxfaW4gPSBzdHJtLmlucHV0Lmxlbmd0aDsKCiAgICBmb3IgKDs7KSB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmtTaXplKTsKICAgICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZTsKICAgICAgfQoKICAgICAgLy8gTWFrZSBzdXJlIGF2YWlsX291dCA+IDYgdG8gYXZvaWQgcmVwZWF0aW5nIG1hcmtlcnMKICAgICAgaWYgKChfZmx1c2hfbW9kZSA9PT0gWl9TWU5DX0ZMVVNIIHx8IF9mbHVzaF9tb2RlID09PSBaX0ZVTExfRkxVU0gpICYmIHN0cm0uYXZhaWxfb3V0IDw9IDYpIHsKICAgICAgICB0aGlzLm9uRGF0YShzdHJtLm91dHB1dC5zdWJhcnJheSgwLCBzdHJtLm5leHRfb3V0KSk7CiAgICAgICAgc3RybS5hdmFpbF9vdXQgPSAwOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBzdGF0dXMgPSBkZWZsYXRlXzEkMi5kZWZsYXRlKHN0cm0sIF9mbHVzaF9tb2RlKTsKCiAgICAgIC8vIEVuZGVkID0+IGZsdXNoIGFuZCBmaW5pc2gKICAgICAgaWYgKHN0YXR1cyA9PT0gWl9TVFJFQU1fRU5EJDIpIHsKICAgICAgICBpZiAoc3RybS5uZXh0X291dCA+IDApIHsKICAgICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0LnN1YmFycmF5KDAsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICB9CiAgICAgICAgc3RhdHVzID0gZGVmbGF0ZV8xJDIuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gc3RhdHVzID09PSBaX09LJDI7CiAgICAgIH0KCiAgICAgIC8vIEZsdXNoIGlmIG91dCBidWZmZXIgZnVsbAogICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICB0aGlzLm9uRGF0YShzdHJtLm91dHB1dCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8vIEZsdXNoIGlmIHJlcXVlc3RlZCBhbmQgaGFzIGRhdGEKICAgICAgaWYgKF9mbHVzaF9tb2RlID4gMCAmJiBzdHJtLm5leHRfb3V0ID4gMCkgewogICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0LnN1YmFycmF5KDAsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGlmIChzdHJtLmF2YWlsX2luID09PSAwKSBicmVhazsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKCiAgLyoqCiAgICogRGVmbGF0ZSNvbkRhdGEoY2h1bmspIC0+IFZvaWQKICAgKiAtIGNodW5rIChVaW50OEFycmF5KTogb3V0cHV0IGRhdGEuCiAgICoKICAgKiBCeSBkZWZhdWx0LCBzdG9yZXMgZGF0YSBibG9ja3MgaW4gYGNodW5rc1tdYCBwcm9wZXJ0eSBhbmQgZ2x1ZQogICAqIHRob3NlIGluIGBvbkVuZGAuIE92ZXJyaWRlIHRoaXMgaGFuZGxlciwgaWYgeW91IG5lZWQgYW5vdGhlciBiZWhhdmlvdXIuCiAgICoqLwogIERlZmxhdGUkMS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgICB0aGlzLmNodW5rcy5wdXNoKGNodW5rKTsKICB9OwoKCiAgLyoqCiAgICogRGVmbGF0ZSNvbkVuZChzdGF0dXMpIC0+IFZvaWQKICAgKiAtIHN0YXR1cyAoTnVtYmVyKTogZGVmbGF0ZSBzdGF0dXMuIDAgKFpfT0spIG9uIHN1Y2Nlc3MsCiAgICogICBvdGhlciBpZiBub3QuCiAgICoKICAgKiBDYWxsZWQgb25jZSBhZnRlciB5b3UgdGVsbCBkZWZsYXRlIHRoYXQgdGhlIGlucHV0IHN0cmVhbSBpcwogICAqIGNvbXBsZXRlIChaX0ZJTklTSCkuIEJ5IGRlZmF1bHQgLSBqb2luIGNvbGxlY3RlZCBjaHVua3MsCiAgICogZnJlZSBtZW1vcnkgYW5kIGZpbGwgYHJlc3VsdHNgIC8gYGVycmAgcHJvcGVydGllcy4KICAgKiovCiAgRGVmbGF0ZSQxLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uIChzdGF0dXMpIHsKICAgIC8vIE9uIHN1Y2Nlc3MgLSBqb2luCiAgICBpZiAoc3RhdHVzID09PSBaX09LJDIpIHsKICAgICAgdGhpcy5yZXN1bHQgPSBjb21tb24uZmxhdHRlbkNodW5rcyh0aGlzLmNodW5rcyk7CiAgICB9CiAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgdGhpcy5lcnIgPSBzdGF0dXM7CiAgICB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7CiAgfTsKCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIC8vIFNlZSBzdGF0ZSBkZWZzIGZyb20gaW5mbGF0ZS5qcwogIGNvbnN0IEJBRCQxID0gMzA7ICAgICAgIC8qIGdvdCBhIGRhdGEgZXJyb3IgLS0gcmVtYWluIGhlcmUgdW50aWwgcmVzZXQgKi8KICBjb25zdCBUWVBFJDEgPSAxMjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciB0eXBlIGJpdHMsIGluY2x1ZGluZyBsYXN0LWZsYWcgYml0ICovCgogIC8qCiAgICAgRGVjb2RlIGxpdGVyYWwsIGxlbmd0aCwgYW5kIGRpc3RhbmNlIGNvZGVzIGFuZCB3cml0ZSBvdXQgdGhlIHJlc3VsdGluZwogICAgIGxpdGVyYWwgYW5kIG1hdGNoIGJ5dGVzIHVudGlsIGVpdGhlciBub3QgZW5vdWdoIGlucHV0IG9yIG91dHB1dCBpcwogICAgIGF2YWlsYWJsZSwgYW4gZW5kLW9mLWJsb2NrIGlzIGVuY291bnRlcmVkLCBvciBhIGRhdGEgZXJyb3IgaXMgZW5jb3VudGVyZWQuCiAgICAgV2hlbiBsYXJnZSBlbm91Z2ggaW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIGFyZSBzdXBwbGllZCB0byBpbmZsYXRlKCksIGZvcgogICAgIGV4YW1wbGUsIGEgMTZLIGlucHV0IGJ1ZmZlciBhbmQgYSA2NEsgb3V0cHV0IGJ1ZmZlciwgbW9yZSB0aGFuIDk1JSBvZiB0aGUKICAgICBpbmZsYXRlIGV4ZWN1dGlvbiB0aW1lIGlzIHNwZW50IGluIHRoaXMgcm91dGluZS4KCiAgICAgRW50cnkgYXNzdW1wdGlvbnM6CgogICAgICAgICAgc3RhdGUubW9kZSA9PT0gTEVOCiAgICAgICAgICBzdHJtLmF2YWlsX2luID49IDYKICAgICAgICAgIHN0cm0uYXZhaWxfb3V0ID49IDI1OAogICAgICAgICAgc3RhcnQgPj0gc3RybS5hdmFpbF9vdXQKICAgICAgICAgIHN0YXRlLmJpdHMgPCA4CgogICAgIE9uIHJldHVybiwgc3RhdGUubW9kZSBpcyBvbmUgb2Y6CgogICAgICAgICAgTEVOIC0tIHJhbiBvdXQgb2YgZW5vdWdoIG91dHB1dCBzcGFjZSBvciBlbm91Z2ggYXZhaWxhYmxlIGlucHV0CiAgICAgICAgICBUWVBFIC0tIHJlYWNoZWQgZW5kIG9mIGJsb2NrIGNvZGUsIGluZmxhdGUoKSB0byBpbnRlcnByZXQgbmV4dCBibG9jawogICAgICAgICAgQkFEIC0tIGVycm9yIGluIGJsb2NrIGRhdGEKCiAgICAgTm90ZXM6CgogICAgICAtIFRoZSBtYXhpbXVtIGlucHV0IGJpdHMgdXNlZCBieSBhIGxlbmd0aC9kaXN0YW5jZSBwYWlyIGlzIDE1IGJpdHMgZm9yIHRoZQogICAgICAgIGxlbmd0aCBjb2RlLCA1IGJpdHMgZm9yIHRoZSBsZW5ndGggZXh0cmEsIDE1IGJpdHMgZm9yIHRoZSBkaXN0YW5jZSBjb2RlLAogICAgICAgIGFuZCAxMyBiaXRzIGZvciB0aGUgZGlzdGFuY2UgZXh0cmEuICBUaGlzIHRvdGFscyA0OCBiaXRzLCBvciBzaXggYnl0ZXMuCiAgICAgICAgVGhlcmVmb3JlIGlmIHN0cm0uYXZhaWxfaW4gPj0gNiwgdGhlbiB0aGVyZSBpcyBlbm91Z2ggaW5wdXQgdG8gYXZvaWQKICAgICAgICBjaGVja2luZyBmb3IgYXZhaWxhYmxlIGlucHV0IHdoaWxlIGRlY29kaW5nLgoKICAgICAgLSBUaGUgbWF4aW11bSBieXRlcyB0aGF0IGEgc2luZ2xlIGxlbmd0aC9kaXN0YW5jZSBwYWlyIGNhbiBvdXRwdXQgaXMgMjU4CiAgICAgICAgYnl0ZXMsIHdoaWNoIGlzIHRoZSBtYXhpbXVtIGxlbmd0aCB0aGF0IGNhbiBiZSBjb2RlZC4gIGluZmxhdGVfZmFzdCgpCiAgICAgICAgcmVxdWlyZXMgc3RybS5hdmFpbF9vdXQgPj0gMjU4IGZvciBlYWNoIGxvb3AgdG8gYXZvaWQgY2hlY2tpbmcgZm9yCiAgICAgICAgb3V0cHV0IHNwYWNlLgogICAqLwogIHZhciBpbmZmYXN0ID0gZnVuY3Rpb24gaW5mbGF0ZV9mYXN0KHN0cm0sIHN0YXJ0KSB7CiAgICBsZXQgX2luOyAgICAgICAgICAgICAgICAgICAgLyogbG9jYWwgc3RybS5pbnB1dCAqLwogICAgbGV0IGxhc3Q7ICAgICAgICAgICAgICAgICAgIC8qIGhhdmUgZW5vdWdoIGlucHV0IHdoaWxlIGluIDwgbGFzdCAqLwogICAgbGV0IF9vdXQ7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0ub3V0cHV0ICovCiAgICBsZXQgYmVnOyAgICAgICAgICAgICAgICAgICAgLyogaW5mbGF0ZSgpJ3MgaW5pdGlhbCBzdHJtLm91dHB1dCAqLwogICAgbGV0IGVuZDsgICAgICAgICAgICAgICAgICAgIC8qIHdoaWxlIG91dCA8IGVuZCwgZW5vdWdoIHNwYWNlIGF2YWlsYWJsZSAqLwogIC8vI2lmZGVmIElORkxBVEVfU1RSSUNUCiAgICBsZXQgZG1heDsgICAgICAgICAgICAgICAgICAgLyogbWF4aW11bSBkaXN0YW5jZSBmcm9tIHpsaWIgaGVhZGVyICovCiAgLy8jZW5kaWYKICAgIGxldCB3c2l6ZTsgICAgICAgICAgICAgICAgICAvKiB3aW5kb3cgc2l6ZSBvciB6ZXJvIGlmIG5vdCB1c2luZyB3aW5kb3cgKi8KICAgIGxldCB3aGF2ZTsgICAgICAgICAgICAgICAgICAvKiB2YWxpZCBieXRlcyBpbiB0aGUgd2luZG93ICovCiAgICBsZXQgd25leHQ7ICAgICAgICAgICAgICAgICAgLyogd2luZG93IHdyaXRlIGluZGV4ICovCiAgICAvLyBVc2UgYHNfd2luZG93YCBpbnN0ZWFkIGB3aW5kb3dgLCBhdm9pZCBjb25mbGljdCB3aXRoIGluc3RydW1lbnRhdGlvbiB0b29scwogICAgbGV0IHNfd2luZG93OyAgICAgICAgICAgICAgIC8qIGFsbG9jYXRlZCBzbGlkaW5nIHdpbmRvdywgaWYgd3NpemUgIT0gMCAqLwogICAgbGV0IGhvbGQ7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uaG9sZCAqLwogICAgbGV0IGJpdHM7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uYml0cyAqLwogICAgbGV0IGxjb2RlOyAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0ubGVuY29kZSAqLwogICAgbGV0IGRjb2RlOyAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uZGlzdGNvZGUgKi8KICAgIGxldCBsbWFzazsgICAgICAgICAgICAgICAgICAvKiBtYXNrIGZvciBmaXJzdCBsZXZlbCBvZiBsZW5ndGggY29kZXMgKi8KICAgIGxldCBkbWFzazsgICAgICAgICAgICAgICAgICAvKiBtYXNrIGZvciBmaXJzdCBsZXZlbCBvZiBkaXN0YW5jZSBjb2RlcyAqLwogICAgbGV0IGhlcmU7ICAgICAgICAgICAgICAgICAgIC8qIHJldHJpZXZlZCB0YWJsZSBlbnRyeSAqLwogICAgbGV0IG9wOyAgICAgICAgICAgICAgICAgICAgIC8qIGNvZGUgYml0cywgb3BlcmF0aW9uLCBleHRyYSBiaXRzLCBvciAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICB3aW5kb3cgcG9zaXRpb24sIHdpbmRvdyBieXRlcyB0byBjb3B5ICovCiAgICBsZXQgbGVuOyAgICAgICAgICAgICAgICAgICAgLyogbWF0Y2ggbGVuZ3RoLCB1bnVzZWQgYnl0ZXMgKi8KICAgIGxldCBkaXN0OyAgICAgICAgICAgICAgICAgICAvKiBtYXRjaCBkaXN0YW5jZSAqLwogICAgbGV0IGZyb207ICAgICAgICAgICAgICAgICAgIC8qIHdoZXJlIHRvIGNvcHkgbWF0Y2ggZnJvbSAqLwogICAgbGV0IGZyb21fc291cmNlOwoKCiAgICBsZXQgaW5wdXQsIG91dHB1dDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwoKICAgIC8qIGNvcHkgc3RhdGUgdG8gbG9jYWwgdmFyaWFibGVzICovCiAgICBjb25zdCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICAvL2hlcmUgPSBzdGF0ZS5oZXJlOwogICAgX2luID0gc3RybS5uZXh0X2luOwogICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgbGFzdCA9IF9pbiArIChzdHJtLmF2YWlsX2luIC0gNSk7CiAgICBfb3V0ID0gc3RybS5uZXh0X291dDsKICAgIG91dHB1dCA9IHN0cm0ub3V0cHV0OwogICAgYmVnID0gX291dCAtIChzdGFydCAtIHN0cm0uYXZhaWxfb3V0KTsKICAgIGVuZCA9IF9vdXQgKyAoc3RybS5hdmFpbF9vdXQgLSAyNTcpOwogIC8vI2lmZGVmIElORkxBVEVfU1RSSUNUCiAgICBkbWF4ID0gc3RhdGUuZG1heDsKICAvLyNlbmRpZgogICAgd3NpemUgPSBzdGF0ZS53c2l6ZTsKICAgIHdoYXZlID0gc3RhdGUud2hhdmU7CiAgICB3bmV4dCA9IHN0YXRlLnduZXh0OwogICAgc193aW5kb3cgPSBzdGF0ZS53aW5kb3c7CiAgICBob2xkID0gc3RhdGUuaG9sZDsKICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgbGNvZGUgPSBzdGF0ZS5sZW5jb2RlOwogICAgZGNvZGUgPSBzdGF0ZS5kaXN0Y29kZTsKICAgIGxtYXNrID0gKDEgPDwgc3RhdGUubGVuYml0cykgLSAxOwogICAgZG1hc2sgPSAoMSA8PCBzdGF0ZS5kaXN0Yml0cykgLSAxOwoKCiAgICAvKiBkZWNvZGUgbGl0ZXJhbHMgYW5kIGxlbmd0aC9kaXN0YW5jZXMgdW50aWwgZW5kLW9mLWJsb2NrIG9yIG5vdCBlbm91Z2gKICAgICAgIGlucHV0IGRhdGEgb3Igb3V0cHV0IHNwYWNlICovCgogICAgdG9wOgogICAgZG8gewogICAgICBpZiAoYml0cyA8IDE1KSB7CiAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICBiaXRzICs9IDg7CiAgICAgIH0KCiAgICAgIGhlcmUgPSBsY29kZVtob2xkICYgbG1hc2tdOwoKICAgICAgZG9sZW46CiAgICAgIGZvciAoOzspIHsgLy8gR290byBlbXVsYXRpb24KICAgICAgICBvcCA9IGhlcmUgPj4+IDI0LypoZXJlLmJpdHMqLzsKICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICBvcCA9IChoZXJlID4+PiAxNikgJiAweGZmLypoZXJlLm9wKi87CiAgICAgICAgaWYgKG9wID09PSAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBsaXRlcmFsICovCiAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgaGVyZS52YWwgPj0gMHgyMCAmJiBoZXJlLnZhbCA8IDB4N2YgPwogICAgICAgICAgLy8gICAgICAgICJpbmZsYXRlOiAgICAgICAgIGxpdGVyYWwgJyVjJ1xuIiA6CiAgICAgICAgICAvLyAgICAgICAgImluZmxhdGU6ICAgICAgICAgbGl0ZXJhbCAweCUwMnhcbiIsIGhlcmUudmFsKSk7CiAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGhlcmUgJiAweGZmZmYvKmhlcmUudmFsKi87CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKG9wICYgMTYpIHsgICAgICAgICAgICAgICAgICAgICAvKiBsZW5ndGggYmFzZSAqLwogICAgICAgICAgbGVuID0gaGVyZSAmIDB4ZmZmZi8qaGVyZS52YWwqLzsKICAgICAgICAgIG9wICY9IDE1OyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzICovCiAgICAgICAgICBpZiAob3ApIHsKICAgICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlbiArPSBob2xkICYgKCgxIDw8IG9wKSAtIDEpOwogICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICB9CiAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgICAgbGVuZ3RoICV1XG4iLCBsZW4pKTsKICAgICAgICAgIGlmIChiaXRzIDwgMTUpIHsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICBoZXJlID0gZGNvZGVbaG9sZCAmIGRtYXNrXTsKCiAgICAgICAgICBkb2Rpc3Q6CiAgICAgICAgICBmb3IgKDs7KSB7IC8vIGdvdG8gZW11bGF0aW9uCiAgICAgICAgICAgIG9wID0gaGVyZSA+Pj4gMjQvKmhlcmUuYml0cyovOwogICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICAgIG9wID0gKGhlcmUgPj4+IDE2KSAmIDB4ZmYvKmhlcmUub3AqLzsKCiAgICAgICAgICAgIGlmIChvcCAmIDE2KSB7ICAgICAgICAgICAgICAgICAgICAgIC8qIGRpc3RhbmNlIGJhc2UgKi8KICAgICAgICAgICAgICBkaXN0ID0gaGVyZSAmIDB4ZmZmZi8qaGVyZS52YWwqLzsKICAgICAgICAgICAgICBvcCAmPSAxNTsgICAgICAgICAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzICovCiAgICAgICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIGlmIChiaXRzIDwgb3ApIHsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkaXN0ICs9IGhvbGQgJiAoKDEgPDwgb3ApIC0gMSk7CiAgLy8jaWZkZWYgSU5GTEFURV9TVFJJQ1QKICAgICAgICAgICAgICBpZiAoZGlzdCA+IGRtYXgpIHsKICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgICAgZGlzdGFuY2UgJXVcbiIsIGRpc3QpKTsKICAgICAgICAgICAgICBvcCA9IF9vdXQgLSBiZWc7ICAgICAgICAgICAgICAgIC8qIG1heCBkaXN0YW5jZSBpbiBvdXRwdXQgKi8KICAgICAgICAgICAgICBpZiAoZGlzdCA+IG9wKSB7ICAgICAgICAgICAgICAgIC8qIHNlZSBpZiBjb3B5IGZyb20gd2luZG93ICovCiAgICAgICAgICAgICAgICBvcCA9IGRpc3QgLSBvcDsgICAgICAgICAgICAgICAvKiBkaXN0YW5jZSBiYWNrIGluIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgaWYgKG9wID4gd2hhdmUpIHsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNhbmUpIHsKICAgICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayc7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICAgICAgfQoKICAvLyAoISkgVGhpcyBibG9jayBpcyBkaXNhYmxlZCBpbiB6bGliIGRlZmF1bHRzLAogIC8vIGRvbid0IGVuYWJsZSBpdCBmb3IgYmluYXJ5IGNvbXBhdGliaWxpdHkKICAvLyNpZmRlZiBJTkZMQVRFX0FMTE9XX0lOVkFMSURfRElTVEFOQ0VfVE9PRkFSX0FSUlIKICAvLyAgICAgICAgICAgICAgICBpZiAobGVuIDw9IG9wIC0gd2hhdmUpIHsKICAvLyAgICAgICAgICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSAwOwogIC8vICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1sZW4pOwogIC8vICAgICAgICAgICAgICAgICAgY29udGludWUgdG9wOwogIC8vICAgICAgICAgICAgICAgIH0KICAvLyAgICAgICAgICAgICAgICBsZW4gLT0gb3AgLSB3aGF2ZTsKICAvLyAgICAgICAgICAgICAgICBkbyB7CiAgLy8gICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IDA7CiAgLy8gICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCA+IHdoYXZlKTsKICAvLyAgICAgICAgICAgICAgICBpZiAob3AgPT09IDApIHsKICAvLyAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsKICAvLyAgICAgICAgICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAvLyAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tbGVuKTsKICAvLyAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIHRvcDsKICAvLyAgICAgICAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZyb20gPSAwOyAvLyB3aW5kb3cgaW5kZXgKICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gc193aW5kb3c7CiAgICAgICAgICAgICAgICBpZiAod25leHQgPT09IDApIHsgICAgICAgICAgIC8qIHZlcnkgY29tbW9uIGNhc2UgKi8KICAgICAgICAgICAgICAgICAgZnJvbSArPSB3c2l6ZSAtIG9wOwogICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsgICAgICAgICAvKiBzb21lIGZyb20gd2luZG93ICovCiAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAvKiByZXN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHduZXh0IDwgb3ApIHsgICAgICAvKiB3cmFwIGFyb3VuZCB3aW5kb3cgKi8KICAgICAgICAgICAgICAgICAgZnJvbSArPSB3c2l6ZSArIHduZXh0IC0gb3A7CiAgICAgICAgICAgICAgICAgIG9wIC09IHduZXh0OwogICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsgICAgICAgICAvKiBzb21lIGZyb20gZW5kIG9mIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICAgIGxlbiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHduZXh0IDwgbGVuKSB7ICAvKiBzb21lIGZyb20gc3RhcnQgb2Ygd2luZG93ICovCiAgICAgICAgICAgICAgICAgICAgICBvcCA9IHduZXh0OwogICAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsgICAgICAvKiByZXN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAvKiBjb250aWd1b3VzIGluIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICBmcm9tICs9IHduZXh0IC0gb3A7CiAgICAgICAgICAgICAgICAgIGlmIChvcCA8IGxlbikgeyAgICAgICAgIC8qIHNvbWUgZnJvbSB3aW5kb3cgKi8KICAgICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBzX3dpbmRvd1tmcm9tKytdOwogICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsgIC8qIHJlc3QgZnJvbSBvdXRwdXQgKi8KICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKGxlbiA+IDIpIHsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20rK107CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobGVuKSB7CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgaWYgKGxlbiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20rK107CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAgICAgICAgIC8qIGNvcHkgZGlyZWN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICBkbyB7ICAgICAgICAgICAgICAgICAgICAgICAgLyogbWluaW11bSBsZW5ndGggaXMgdGhyZWUgKi8KICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChsZW4gPiAyKTsKICAgICAgICAgICAgICAgIGlmIChsZW4pIHsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgaWYgKGxlbiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IG91dHB1dFtmcm9tKytdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKChvcCAmIDY0KSA9PT0gMCkgeyAgICAgICAgICAvKiAybmQgbGV2ZWwgZGlzdGFuY2UgY29kZSAqLwogICAgICAgICAgICAgIGhlcmUgPSBkY29kZVsoaGVyZSAmIDB4ZmZmZikvKmhlcmUudmFsKi8gKyAoaG9sZCAmICgoMSA8PCBvcCkgLSAxKSldOwogICAgICAgICAgICAgIGNvbnRpbnVlIGRvZGlzdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIGNvZGUnOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICBicmVhayB0b3A7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOyAvLyBuZWVkIHRvIGVtdWxhdGUgZ290byB2aWEgImNvbnRpbnVlIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmICgob3AgJiA2NCkgPT09IDApIHsgICAgICAgICAgICAgIC8qIDJuZCBsZXZlbCBsZW5ndGggY29kZSAqLwogICAgICAgICAgaGVyZSA9IGxjb2RlWyhoZXJlICYgMHhmZmZmKS8qaGVyZS52YWwqLyArIChob2xkICYgKCgxIDw8IG9wKSAtIDEpKV07CiAgICAgICAgICBjb250aW51ZSBkb2xlbjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAob3AgJiAzMikgeyAgICAgICAgICAgICAgICAgICAgIC8qIGVuZC1vZi1ibG9jayAqLwogICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGVuZCBvZiBibG9ja1xuIikpOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEUkMTsKICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUnOwogICAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7IC8vIG5lZWQgdG8gZW11bGF0ZSBnb3RvIHZpYSAiY29udGludWUiCiAgICAgIH0KICAgIH0gd2hpbGUgKF9pbiA8IGxhc3QgJiYgX291dCA8IGVuZCk7CgogICAgLyogcmV0dXJuIHVudXNlZCBieXRlcyAob24gZW50cnksIGJpdHMgPCA4LCBzbyBpbiB3b24ndCBnbyB0b28gZmFyIGJhY2spICovCiAgICBsZW4gPSBiaXRzID4+IDM7CiAgICBfaW4gLT0gbGVuOwogICAgYml0cyAtPSBsZW4gPDwgMzsKICAgIGhvbGQgJj0gKDEgPDwgYml0cykgLSAxOwoKICAgIC8qIHVwZGF0ZSBzdGF0ZSBhbmQgcmV0dXJuICovCiAgICBzdHJtLm5leHRfaW4gPSBfaW47CiAgICBzdHJtLm5leHRfb3V0ID0gX291dDsKICAgIHN0cm0uYXZhaWxfaW4gPSAoX2luIDwgbGFzdCA/IDUgKyAobGFzdCAtIF9pbikgOiA1IC0gKF9pbiAtIGxhc3QpKTsKICAgIHN0cm0uYXZhaWxfb3V0ID0gKF9vdXQgPCBlbmQgPyAyNTcgKyAoZW5kIC0gX291dCkgOiAyNTcgLSAoX291dCAtIGVuZCkpOwogICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICBzdGF0ZS5iaXRzID0gYml0czsKICAgIHJldHVybjsKICB9OwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgY29uc3QgTUFYQklUUyA9IDE1OwogIGNvbnN0IEVOT1VHSF9MRU5TJDEgPSA4NTI7CiAgY29uc3QgRU5PVUdIX0RJU1RTJDEgPSA1OTI7CiAgLy9jb25zdCBFTk9VR0ggPSAoRU5PVUdIX0xFTlMrRU5PVUdIX0RJU1RTKTsKCiAgY29uc3QgQ09ERVMkMSA9IDA7CiAgY29uc3QgTEVOUyQxID0gMTsKICBjb25zdCBESVNUUyQxID0gMjsKCiAgY29uc3QgbGJhc2UgPSBuZXcgVWludDE2QXJyYXkoWyAvKiBMZW5ndGggY29kZXMgMjU3Li4yODUgYmFzZSAqLwogICAgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMywgMTUsIDE3LCAxOSwgMjMsIDI3LCAzMSwKICAgIDM1LCA0MywgNTEsIDU5LCA2NywgODMsIDk5LCAxMTUsIDEzMSwgMTYzLCAxOTUsIDIyNywgMjU4LCAwLCAwCiAgXSk7CgogIGNvbnN0IGxleHQgPSBuZXcgVWludDhBcnJheShbIC8qIExlbmd0aCBjb2RlcyAyNTcuLjI4NSBleHRyYSAqLwogICAgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNywgMTcsIDE3LCAxNywgMTgsIDE4LCAxOCwgMTgsCiAgICAxOSwgMTksIDE5LCAxOSwgMjAsIDIwLCAyMCwgMjAsIDIxLCAyMSwgMjEsIDIxLCAxNiwgNzIsIDc4CiAgXSk7CgogIGNvbnN0IGRiYXNlID0gbmV3IFVpbnQxNkFycmF5KFsgLyogRGlzdGFuY2UgY29kZXMgMC4uMjkgYmFzZSAqLwogICAgMSwgMiwgMywgNCwgNSwgNywgOSwgMTMsIDE3LCAyNSwgMzMsIDQ5LCA2NSwgOTcsIDEyOSwgMTkzLAogICAgMjU3LCAzODUsIDUxMywgNzY5LCAxMDI1LCAxNTM3LCAyMDQ5LCAzMDczLCA0MDk3LCA2MTQ1LAogICAgODE5MywgMTIyODksIDE2Mzg1LCAyNDU3NywgMCwgMAogIF0pOwoKICBjb25zdCBkZXh0ID0gbmV3IFVpbnQ4QXJyYXkoWyAvKiBEaXN0YW5jZSBjb2RlcyAwLi4yOSBleHRyYSAqLwogICAgMTYsIDE2LCAxNiwgMTYsIDE3LCAxNywgMTgsIDE4LCAxOSwgMTksIDIwLCAyMCwgMjEsIDIxLCAyMiwgMjIsCiAgICAyMywgMjMsIDI0LCAyNCwgMjUsIDI1LCAyNiwgMjYsIDI3LCAyNywKICAgIDI4LCAyOCwgMjksIDI5LCA2NCwgNjQKICBdKTsKCiAgY29uc3QgaW5mbGF0ZV90YWJsZSA9ICh0eXBlLCBsZW5zLCBsZW5zX2luZGV4LCBjb2RlcywgdGFibGUsIHRhYmxlX2luZGV4LCB3b3JrLCBvcHRzKSA9PgogIHsKICAgIGNvbnN0IGJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgLy9oZXJlID0gb3B0cy5oZXJlOyAvKiB0YWJsZSBlbnRyeSBmb3IgZHVwbGljYXRpb24gKi8KCiAgICBsZXQgbGVuID0gMDsgICAgICAgICAgICAgICAvKiBhIGNvZGUncyBsZW5ndGggaW4gYml0cyAqLwogICAgbGV0IHN5bSA9IDA7ICAgICAgICAgICAgICAgLyogaW5kZXggb2YgY29kZSBzeW1ib2xzICovCiAgICBsZXQgbWluID0gMCwgbWF4ID0gMDsgICAgICAgICAgLyogbWluaW11bSBhbmQgbWF4aW11bSBjb2RlIGxlbmd0aHMgKi8KICAgIGxldCByb290ID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBpbmRleCBiaXRzIGZvciByb290IHRhYmxlICovCiAgICBsZXQgY3VyciA9IDA7ICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgaW5kZXggYml0cyBmb3IgY3VycmVudCB0YWJsZSAqLwogICAgbGV0IGRyb3AgPSAwOyAgICAgICAgICAgICAgLyogY29kZSBiaXRzIHRvIGRyb3AgZm9yIHN1Yi10YWJsZSAqLwogICAgbGV0IGxlZnQgPSAwOyAgICAgICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgcHJlZml4IGNvZGVzIGF2YWlsYWJsZSAqLwogICAgbGV0IHVzZWQgPSAwOyAgICAgICAgICAgICAgLyogY29kZSBlbnRyaWVzIGluIHRhYmxlIHVzZWQgKi8KICAgIGxldCBodWZmID0gMDsgICAgICAgICAgICAgIC8qIEh1ZmZtYW4gY29kZSAqLwogICAgbGV0IGluY3I7ICAgICAgICAgICAgICAvKiBmb3IgaW5jcmVtZW50aW5nIGNvZGUsIGluZGV4ICovCiAgICBsZXQgZmlsbDsgICAgICAgICAgICAgIC8qIGluZGV4IGZvciByZXBsaWNhdGluZyBlbnRyaWVzICovCiAgICBsZXQgbG93OyAgICAgICAgICAgICAgIC8qIGxvdyBiaXRzIGZvciBjdXJyZW50IHJvb3QgZW50cnkgKi8KICAgIGxldCBtYXNrOyAgICAgICAgICAgICAgLyogbWFzayBmb3IgbG93IHJvb3QgYml0cyAqLwogICAgbGV0IG5leHQ7ICAgICAgICAgICAgIC8qIG5leHQgYXZhaWxhYmxlIHNwYWNlIGluIHRhYmxlICovCiAgICBsZXQgYmFzZSA9IG51bGw7ICAgICAvKiBiYXNlIHZhbHVlIHRhYmxlIHRvIHVzZSAqLwogICAgbGV0IGJhc2VfaW5kZXggPSAwOwogIC8vICBsZXQgc2hvZXh0cmE7ICAgIC8qIGV4dHJhIGJpdHMgdGFibGUgdG8gdXNlICovCiAgICBsZXQgZW5kOyAgICAgICAgICAgICAgICAgICAgLyogdXNlIGJhc2UgYW5kIGV4dHJhIGZvciBzeW1ib2wgPiBlbmQgKi8KICAgIGNvbnN0IGNvdW50ID0gbmV3IFVpbnQxNkFycmF5KE1BWEJJVFMgKyAxKTsgLy9bTUFYQklUUysxXTsgICAgLyogbnVtYmVyIG9mIGNvZGVzIG9mIGVhY2ggbGVuZ3RoICovCiAgICBjb25zdCBvZmZzID0gbmV3IFVpbnQxNkFycmF5KE1BWEJJVFMgKyAxKTsgLy9bTUFYQklUUysxXTsgICAgIC8qIG9mZnNldHMgaW4gdGFibGUgZm9yIGVhY2ggbGVuZ3RoICovCiAgICBsZXQgZXh0cmEgPSBudWxsOwogICAgbGV0IGV4dHJhX2luZGV4ID0gMDsKCiAgICBsZXQgaGVyZV9iaXRzLCBoZXJlX29wLCBoZXJlX3ZhbDsKCiAgICAvKgogICAgIFByb2Nlc3MgYSBzZXQgb2YgY29kZSBsZW5ndGhzIHRvIGNyZWF0ZSBhIGNhbm9uaWNhbCBIdWZmbWFuIGNvZGUuICBUaGUKICAgICBjb2RlIGxlbmd0aHMgYXJlIGxlbnNbMC4uY29kZXMtMV0uICBFYWNoIGxlbmd0aCBjb3JyZXNwb25kcyB0byB0aGUKICAgICBzeW1ib2xzIDAuLmNvZGVzLTEuICBUaGUgSHVmZm1hbiBjb2RlIGlzIGdlbmVyYXRlZCBieSBmaXJzdCBzb3J0aW5nIHRoZQogICAgIHN5bWJvbHMgYnkgbGVuZ3RoIGZyb20gc2hvcnQgdG8gbG9uZywgYW5kIHJldGFpbmluZyB0aGUgc3ltYm9sIG9yZGVyCiAgICAgZm9yIGNvZGVzIHdpdGggZXF1YWwgbGVuZ3Rocy4gIFRoZW4gdGhlIGNvZGUgc3RhcnRzIHdpdGggYWxsIHplcm8gYml0cwogICAgIGZvciB0aGUgZmlyc3QgY29kZSBvZiB0aGUgc2hvcnRlc3QgbGVuZ3RoLCBhbmQgdGhlIGNvZGVzIGFyZSBpbnRlZ2VyCiAgICAgaW5jcmVtZW50cyBmb3IgdGhlIHNhbWUgbGVuZ3RoLCBhbmQgemVyb3MgYXJlIGFwcGVuZGVkIGFzIHRoZSBsZW5ndGgKICAgICBpbmNyZWFzZXMuICBGb3IgdGhlIGRlZmxhdGUgZm9ybWF0LCB0aGVzZSBiaXRzIGFyZSBzdG9yZWQgYmFja3dhcmRzCiAgICAgZnJvbSB0aGVpciBtb3JlIG5hdHVyYWwgaW50ZWdlciBpbmNyZW1lbnQgb3JkZXJpbmcsIGFuZCBzbyB3aGVuIHRoZQogICAgIGRlY29kaW5nIHRhYmxlcyBhcmUgYnVpbHQgaW4gdGhlIGxhcmdlIGxvb3AgYmVsb3csIHRoZSBpbnRlZ2VyIGNvZGVzCiAgICAgYXJlIGluY3JlbWVudGVkIGJhY2t3YXJkcy4KCiAgICAgVGhpcyByb3V0aW5lIGFzc3VtZXMsIGJ1dCBkb2VzIG5vdCBjaGVjaywgdGhhdCBhbGwgb2YgdGhlIGVudHJpZXMgaW4KICAgICBsZW5zW10gYXJlIGluIHRoZSByYW5nZSAwLi5NQVhCSVRTLiAgVGhlIGNhbGxlciBtdXN0IGFzc3VyZSB0aGlzLgogICAgIDEuLk1BWEJJVFMgaXMgaW50ZXJwcmV0ZWQgYXMgdGhhdCBjb2RlIGxlbmd0aC4gIHplcm8gbWVhbnMgdGhhdCB0aGF0CiAgICAgc3ltYm9sIGRvZXMgbm90IG9jY3VyIGluIHRoaXMgY29kZS4KCiAgICAgVGhlIGNvZGVzIGFyZSBzb3J0ZWQgYnkgY29tcHV0aW5nIGEgY291bnQgb2YgY29kZXMgZm9yIGVhY2ggbGVuZ3RoLAogICAgIGNyZWF0aW5nIGZyb20gdGhhdCBhIHRhYmxlIG9mIHN0YXJ0aW5nIGluZGljZXMgZm9yIGVhY2ggbGVuZ3RoIGluIHRoZQogICAgIHNvcnRlZCB0YWJsZSwgYW5kIHRoZW4gZW50ZXJpbmcgdGhlIHN5bWJvbHMgaW4gb3JkZXIgaW4gdGhlIHNvcnRlZAogICAgIHRhYmxlLiAgVGhlIHNvcnRlZCB0YWJsZSBpcyB3b3JrW10sIHdpdGggdGhhdCBzcGFjZSBiZWluZyBwcm92aWRlZCBieQogICAgIHRoZSBjYWxsZXIuCgogICAgIFRoZSBsZW5ndGggY291bnRzIGFyZSB1c2VkIGZvciBvdGhlciBwdXJwb3NlcyBhcyB3ZWxsLCBpLmUuIGZpbmRpbmcKICAgICB0aGUgbWluaW11bSBhbmQgbWF4aW11bSBsZW5ndGggY29kZXMsIGRldGVybWluaW5nIGlmIHRoZXJlIGFyZSBhbnkKICAgICBjb2RlcyBhdCBhbGwsIGNoZWNraW5nIGZvciBhIHZhbGlkIHNldCBvZiBsZW5ndGhzLCBhbmQgbG9va2luZyBhaGVhZAogICAgIGF0IGxlbmd0aCBjb3VudHMgdG8gZGV0ZXJtaW5lIHN1Yi10YWJsZSBzaXplcyB3aGVuIGJ1aWxkaW5nIHRoZQogICAgIGRlY29kaW5nIHRhYmxlcy4KICAgICAqLwoKICAgIC8qIGFjY3VtdWxhdGUgbGVuZ3RocyBmb3IgY29kZXMgKGFzc3VtZXMgbGVuc1tdIGFsbCBpbiAwLi5NQVhCSVRTKSAqLwogICAgZm9yIChsZW4gPSAwOyBsZW4gPD0gTUFYQklUUzsgbGVuKyspIHsKICAgICAgY291bnRbbGVuXSA9IDA7CiAgICB9CiAgICBmb3IgKHN5bSA9IDA7IHN5bSA8IGNvZGVzOyBzeW0rKykgewogICAgICBjb3VudFtsZW5zW2xlbnNfaW5kZXggKyBzeW1dXSsrOwogICAgfQoKICAgIC8qIGJvdW5kIGNvZGUgbGVuZ3RocywgZm9yY2Ugcm9vdCB0byBiZSB3aXRoaW4gY29kZSBsZW5ndGhzICovCiAgICByb290ID0gYml0czsKICAgIGZvciAobWF4ID0gTUFYQklUUzsgbWF4ID49IDE7IG1heC0tKSB7CiAgICAgIGlmIChjb3VudFttYXhdICE9PSAwKSB7IGJyZWFrOyB9CiAgICB9CiAgICBpZiAocm9vdCA+IG1heCkgewogICAgICByb290ID0gbWF4OwogICAgfQogICAgaWYgKG1heCA9PT0gMCkgeyAgICAgICAgICAgICAgICAgICAgIC8qIG5vIHN5bWJvbHMgdG8gY29kZSBhdCBhbGwgKi8KICAgICAgLy90YWJsZS5vcFtvcHRzLnRhYmxlX2luZGV4XSA9IDY0OyAgLy9oZXJlLm9wID0gKHZhciBjaGFyKTY0OyAgICAvKiBpbnZhbGlkIGNvZGUgbWFya2VyICovCiAgICAgIC8vdGFibGUuYml0c1tvcHRzLnRhYmxlX2luZGV4XSA9IDE7ICAgLy9oZXJlLmJpdHMgPSAodmFyIGNoYXIpMTsKICAgICAgLy90YWJsZS52YWxbb3B0cy50YWJsZV9pbmRleCsrXSA9IDA7ICAgLy9oZXJlLnZhbCA9ICh2YXIgc2hvcnQpMDsKICAgICAgdGFibGVbdGFibGVfaW5kZXgrK10gPSAoMSA8PCAyNCkgfCAoNjQgPDwgMTYpIHwgMDsKCgogICAgICAvL3RhYmxlLm9wW29wdHMudGFibGVfaW5kZXhdID0gNjQ7CiAgICAgIC8vdGFibGUuYml0c1tvcHRzLnRhYmxlX2luZGV4XSA9IDE7CiAgICAgIC8vdGFibGUudmFsW29wdHMudGFibGVfaW5kZXgrK10gPSAwOwogICAgICB0YWJsZVt0YWJsZV9pbmRleCsrXSA9ICgxIDw8IDI0KSB8ICg2NCA8PCAxNikgfCAwOwoKICAgICAgb3B0cy5iaXRzID0gMTsKICAgICAgcmV0dXJuIDA7ICAgICAvKiBubyBzeW1ib2xzLCBidXQgd2FpdCBmb3IgZGVjb2RpbmcgdG8gcmVwb3J0IGVycm9yICovCiAgICB9CiAgICBmb3IgKG1pbiA9IDE7IG1pbiA8IG1heDsgbWluKyspIHsKICAgICAgaWYgKGNvdW50W21pbl0gIT09IDApIHsgYnJlYWs7IH0KICAgIH0KICAgIGlmIChyb290IDwgbWluKSB7CiAgICAgIHJvb3QgPSBtaW47CiAgICB9CgogICAgLyogY2hlY2sgZm9yIGFuIG92ZXItc3Vic2NyaWJlZCBvciBpbmNvbXBsZXRlIHNldCBvZiBsZW5ndGhzICovCiAgICBsZWZ0ID0gMTsKICAgIGZvciAobGVuID0gMTsgbGVuIDw9IE1BWEJJVFM7IGxlbisrKSB7CiAgICAgIGxlZnQgPDw9IDE7CiAgICAgIGxlZnQgLT0gY291bnRbbGVuXTsKICAgICAgaWYgKGxlZnQgPCAwKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9ICAgICAgICAvKiBvdmVyLXN1YnNjcmliZWQgKi8KICAgIH0KICAgIGlmIChsZWZ0ID4gMCAmJiAodHlwZSA9PT0gQ09ERVMkMSB8fCBtYXggIT09IDEpKSB7CiAgICAgIHJldHVybiAtMTsgICAgICAgICAgICAgICAgICAgICAgLyogaW5jb21wbGV0ZSBzZXQgKi8KICAgIH0KCiAgICAvKiBnZW5lcmF0ZSBvZmZzZXRzIGludG8gc3ltYm9sIHRhYmxlIGZvciBlYWNoIGxlbmd0aCBmb3Igc29ydGluZyAqLwogICAgb2Zmc1sxXSA9IDA7CiAgICBmb3IgKGxlbiA9IDE7IGxlbiA8IE1BWEJJVFM7IGxlbisrKSB7CiAgICAgIG9mZnNbbGVuICsgMV0gPSBvZmZzW2xlbl0gKyBjb3VudFtsZW5dOwogICAgfQoKICAgIC8qIHNvcnQgc3ltYm9scyBieSBsZW5ndGgsIGJ5IHN5bWJvbCBvcmRlciB3aXRoaW4gZWFjaCBsZW5ndGggKi8KICAgIGZvciAoc3ltID0gMDsgc3ltIDwgY29kZXM7IHN5bSsrKSB7CiAgICAgIGlmIChsZW5zW2xlbnNfaW5kZXggKyBzeW1dICE9PSAwKSB7CiAgICAgICAgd29ya1tvZmZzW2xlbnNbbGVuc19pbmRleCArIHN5bV1dKytdID0gc3ltOwogICAgICB9CiAgICB9CgogICAgLyoKICAgICBDcmVhdGUgYW5kIGZpbGwgaW4gZGVjb2RpbmcgdGFibGVzLiAgSW4gdGhpcyBsb29wLCB0aGUgdGFibGUgYmVpbmcKICAgICBmaWxsZWQgaXMgYXQgbmV4dCBhbmQgaGFzIGN1cnIgaW5kZXggYml0cy4gIFRoZSBjb2RlIGJlaW5nIHVzZWQgaXMgaHVmZgogICAgIHdpdGggbGVuZ3RoIGxlbi4gIFRoYXQgY29kZSBpcyBjb252ZXJ0ZWQgdG8gYW4gaW5kZXggYnkgZHJvcHBpbmcgZHJvcAogICAgIGJpdHMgb2ZmIG9mIHRoZSBib3R0b20uICBGb3IgY29kZXMgd2hlcmUgbGVuIGlzIGxlc3MgdGhhbiBkcm9wICsgY3VyciwKICAgICB0aG9zZSB0b3AgZHJvcCArIGN1cnIgLSBsZW4gYml0cyBhcmUgaW5jcmVtZW50ZWQgdGhyb3VnaCBhbGwgdmFsdWVzIHRvCiAgICAgZmlsbCB0aGUgdGFibGUgd2l0aCByZXBsaWNhdGVkIGVudHJpZXMuCgogICAgIHJvb3QgaXMgdGhlIG51bWJlciBvZiBpbmRleCBiaXRzIGZvciB0aGUgcm9vdCB0YWJsZS4gIFdoZW4gbGVuIGV4Y2VlZHMKICAgICByb290LCBzdWItdGFibGVzIGFyZSBjcmVhdGVkIHBvaW50ZWQgdG8gYnkgdGhlIHJvb3QgZW50cnkgd2l0aCBhbiBpbmRleAogICAgIG9mIHRoZSBsb3cgcm9vdCBiaXRzIG9mIGh1ZmYuICBUaGlzIGlzIHNhdmVkIGluIGxvdyB0byBjaGVjayBmb3Igd2hlbiBhCiAgICAgbmV3IHN1Yi10YWJsZSBzaG91bGQgYmUgc3RhcnRlZC4gIGRyb3AgaXMgemVybyB3aGVuIHRoZSByb290IHRhYmxlIGlzCiAgICAgYmVpbmcgZmlsbGVkLCBhbmQgZHJvcCBpcyByb290IHdoZW4gc3ViLXRhYmxlcyBhcmUgYmVpbmcgZmlsbGVkLgoKICAgICBXaGVuIGEgbmV3IHN1Yi10YWJsZSBpcyBuZWVkZWQsIGl0IGlzIG5lY2Vzc2FyeSB0byBsb29rIGFoZWFkIGluIHRoZQogICAgIGNvZGUgbGVuZ3RocyB0byBkZXRlcm1pbmUgd2hhdCBzaXplIHN1Yi10YWJsZSBpcyBuZWVkZWQuICBUaGUgbGVuZ3RoCiAgICAgY291bnRzIGFyZSB1c2VkIGZvciB0aGlzLCBhbmQgc28gY291bnRbXSBpcyBkZWNyZW1lbnRlZCBhcyBjb2RlcyBhcmUKICAgICBlbnRlcmVkIGluIHRoZSB0YWJsZXMuCgogICAgIHVzZWQga2VlcHMgdHJhY2sgb2YgaG93IG1hbnkgdGFibGUgZW50cmllcyBoYXZlIGJlZW4gYWxsb2NhdGVkIGZyb20gdGhlCiAgICAgcHJvdmlkZWQgKnRhYmxlIHNwYWNlLiAgSXQgaXMgY2hlY2tlZCBmb3IgTEVOUyBhbmQgRElTVCB0YWJsZXMgYWdhaW5zdAogICAgIHRoZSBjb25zdGFudHMgRU5PVUdIX0xFTlMgYW5kIEVOT1VHSF9ESVNUUyB0byBndWFyZCBhZ2FpbnN0IGNoYW5nZXMgaW4KICAgICB0aGUgaW5pdGlhbCByb290IHRhYmxlIHNpemUgY29uc3RhbnRzLiAgU2VlIHRoZSBjb21tZW50cyBpbiBpbmZ0cmVlcy5oCiAgICAgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgogICAgIHN5bSBpbmNyZW1lbnRzIHRocm91Z2ggYWxsIHN5bWJvbHMsIGFuZCB0aGUgbG9vcCB0ZXJtaW5hdGVzIHdoZW4KICAgICBhbGwgY29kZXMgb2YgbGVuZ3RoIG1heCwgaS5lLiBhbGwgY29kZXMsIGhhdmUgYmVlbiBwcm9jZXNzZWQuICBUaGlzCiAgICAgcm91dGluZSBwZXJtaXRzIGluY29tcGxldGUgY29kZXMsIHNvIGFub3RoZXIgbG9vcCBhZnRlciB0aGlzIG9uZSBmaWxscwogICAgIGluIHRoZSByZXN0IG9mIHRoZSBkZWNvZGluZyB0YWJsZXMgd2l0aCBpbnZhbGlkIGNvZGUgbWFya2Vycy4KICAgICAqLwoKICAgIC8qIHNldCB1cCBmb3IgY29kZSB0eXBlICovCiAgICAvLyBwb29yIG1hbiBvcHRpbWl6YXRpb24gLSB1c2UgaWYtZWxzZSBpbnN0ZWFkIG9mIHN3aXRjaCwKICAgIC8vIHRvIGF2b2lkIGRlb3B0cyBpbiBvbGQgdjgKICAgIGlmICh0eXBlID09PSBDT0RFUyQxKSB7CiAgICAgIGJhc2UgPSBleHRyYSA9IHdvcms7ICAgIC8qIGR1bW15IHZhbHVlLS1ub3QgdXNlZCAqLwogICAgICBlbmQgPSAxOTsKCiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IExFTlMkMSkgewogICAgICBiYXNlID0gbGJhc2U7CiAgICAgIGJhc2VfaW5kZXggLT0gMjU3OwogICAgICBleHRyYSA9IGxleHQ7CiAgICAgIGV4dHJhX2luZGV4IC09IDI1NzsKICAgICAgZW5kID0gMjU2OwoKICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgICAgICAvKiBESVNUUyAqLwogICAgICBiYXNlID0gZGJhc2U7CiAgICAgIGV4dHJhID0gZGV4dDsKICAgICAgZW5kID0gLTE7CiAgICB9CgogICAgLyogaW5pdGlhbGl6ZSBvcHRzIGZvciBsb29wICovCiAgICBodWZmID0gMDsgICAgICAgICAgICAgICAgICAgLyogc3RhcnRpbmcgY29kZSAqLwogICAgc3ltID0gMDsgICAgICAgICAgICAgICAgICAgIC8qIHN0YXJ0aW5nIGNvZGUgc3ltYm9sICovCiAgICBsZW4gPSBtaW47ICAgICAgICAgICAgICAgICAgLyogc3RhcnRpbmcgY29kZSBsZW5ndGggKi8KICAgIG5leHQgPSB0YWJsZV9pbmRleDsgICAgICAgICAgICAgIC8qIGN1cnJlbnQgdGFibGUgdG8gZmlsbCBpbiAqLwogICAgY3VyciA9IHJvb3Q7ICAgICAgICAgICAgICAgIC8qIGN1cnJlbnQgdGFibGUgaW5kZXggYml0cyAqLwogICAgZHJvcCA9IDA7ICAgICAgICAgICAgICAgICAgIC8qIGN1cnJlbnQgYml0cyB0byBkcm9wIGZyb20gY29kZSBmb3IgaW5kZXggKi8KICAgIGxvdyA9IC0xOyAgICAgICAgICAgICAgICAgICAvKiB0cmlnZ2VyIG5ldyBzdWItdGFibGUgd2hlbiBsZW4gPiByb290ICovCiAgICB1c2VkID0gMSA8PCByb290OyAgICAgICAgICAvKiB1c2Ugcm9vdCB0YWJsZSBlbnRyaWVzICovCiAgICBtYXNrID0gdXNlZCAtIDE7ICAgICAgICAgICAgLyogbWFzayBmb3IgY29tcGFyaW5nIGxvdyAqLwoKICAgIC8qIGNoZWNrIGF2YWlsYWJsZSB0YWJsZSBzcGFjZSAqLwogICAgaWYgKCh0eXBlID09PSBMRU5TJDEgJiYgdXNlZCA+IEVOT1VHSF9MRU5TJDEpIHx8CiAgICAgICh0eXBlID09PSBESVNUUyQxICYmIHVzZWQgPiBFTk9VR0hfRElTVFMkMSkpIHsKICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgLyogcHJvY2VzcyBhbGwgY29kZXMgYW5kIG1ha2UgdGFibGUgZW50cmllcyAqLwogICAgZm9yICg7OykgewogICAgICAvKiBjcmVhdGUgdGFibGUgZW50cnkgKi8KICAgICAgaGVyZV9iaXRzID0gbGVuIC0gZHJvcDsKICAgICAgaWYgKHdvcmtbc3ltXSA8IGVuZCkgewogICAgICAgIGhlcmVfb3AgPSAwOwogICAgICAgIGhlcmVfdmFsID0gd29ya1tzeW1dOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHdvcmtbc3ltXSA+IGVuZCkgewogICAgICAgIGhlcmVfb3AgPSBleHRyYVtleHRyYV9pbmRleCArIHdvcmtbc3ltXV07CiAgICAgICAgaGVyZV92YWwgPSBiYXNlW2Jhc2VfaW5kZXggKyB3b3JrW3N5bV1dOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIGhlcmVfb3AgPSAzMiArIDY0OyAgICAgICAgIC8qIGVuZCBvZiBibG9jayAqLwogICAgICAgIGhlcmVfdmFsID0gMDsKICAgICAgfQoKICAgICAgLyogcmVwbGljYXRlIGZvciB0aG9zZSBpbmRpY2VzIHdpdGggbG93IGxlbiBiaXRzIGVxdWFsIHRvIGh1ZmYgKi8KICAgICAgaW5jciA9IDEgPDwgKGxlbiAtIGRyb3ApOwogICAgICBmaWxsID0gMSA8PCBjdXJyOwogICAgICBtaW4gPSBmaWxsOyAgICAgICAgICAgICAgICAgLyogc2F2ZSBvZmZzZXQgdG8gbmV4dCB0YWJsZSAqLwogICAgICBkbyB7CiAgICAgICAgZmlsbCAtPSBpbmNyOwogICAgICAgIHRhYmxlW25leHQgKyAoaHVmZiA+PiBkcm9wKSArIGZpbGxdID0gKGhlcmVfYml0cyA8PCAyNCkgfCAoaGVyZV9vcCA8PCAxNikgfCBoZXJlX3ZhbCB8MDsKICAgICAgfSB3aGlsZSAoZmlsbCAhPT0gMCk7CgogICAgICAvKiBiYWNrd2FyZHMgaW5jcmVtZW50IHRoZSBsZW4tYml0IGNvZGUgaHVmZiAqLwogICAgICBpbmNyID0gMSA8PCAobGVuIC0gMSk7CiAgICAgIHdoaWxlIChodWZmICYgaW5jcikgewogICAgICAgIGluY3IgPj49IDE7CiAgICAgIH0KICAgICAgaWYgKGluY3IgIT09IDApIHsKICAgICAgICBodWZmICY9IGluY3IgLSAxOwogICAgICAgIGh1ZmYgKz0gaW5jcjsKICAgICAgfSBlbHNlIHsKICAgICAgICBodWZmID0gMDsKICAgICAgfQoKICAgICAgLyogZ28gdG8gbmV4dCBzeW1ib2wsIHVwZGF0ZSBjb3VudCwgbGVuICovCiAgICAgIHN5bSsrOwogICAgICBpZiAoLS1jb3VudFtsZW5dID09PSAwKSB7CiAgICAgICAgaWYgKGxlbiA9PT0gbWF4KSB7IGJyZWFrOyB9CiAgICAgICAgbGVuID0gbGVuc1tsZW5zX2luZGV4ICsgd29ya1tzeW1dXTsKICAgICAgfQoKICAgICAgLyogY3JlYXRlIG5ldyBzdWItdGFibGUgaWYgbmVlZGVkICovCiAgICAgIGlmIChsZW4gPiByb290ICYmIChodWZmICYgbWFzaykgIT09IGxvdykgewogICAgICAgIC8qIGlmIGZpcnN0IHRpbWUsIHRyYW5zaXRpb24gdG8gc3ViLXRhYmxlcyAqLwogICAgICAgIGlmIChkcm9wID09PSAwKSB7CiAgICAgICAgICBkcm9wID0gcm9vdDsKICAgICAgICB9CgogICAgICAgIC8qIGluY3JlbWVudCBwYXN0IGxhc3QgdGFibGUgKi8KICAgICAgICBuZXh0ICs9IG1pbjsgICAgICAgICAgICAvKiBoZXJlIG1pbiBpcyAxIDw8IGN1cnIgKi8KCiAgICAgICAgLyogZGV0ZXJtaW5lIGxlbmd0aCBvZiBuZXh0IHRhYmxlICovCiAgICAgICAgY3VyciA9IGxlbiAtIGRyb3A7CiAgICAgICAgbGVmdCA9IDEgPDwgY3VycjsKICAgICAgICB3aGlsZSAoY3VyciArIGRyb3AgPCBtYXgpIHsKICAgICAgICAgIGxlZnQgLT0gY291bnRbY3VyciArIGRyb3BdOwogICAgICAgICAgaWYgKGxlZnQgPD0gMCkgeyBicmVhazsgfQogICAgICAgICAgY3VycisrOwogICAgICAgICAgbGVmdCA8PD0gMTsKICAgICAgICB9CgogICAgICAgIC8qIGNoZWNrIGZvciBlbm91Z2ggc3BhY2UgKi8KICAgICAgICB1c2VkICs9IDEgPDwgY3VycjsKICAgICAgICBpZiAoKHR5cGUgPT09IExFTlMkMSAmJiB1c2VkID4gRU5PVUdIX0xFTlMkMSkgfHwKICAgICAgICAgICh0eXBlID09PSBESVNUUyQxICYmIHVzZWQgPiBFTk9VR0hfRElTVFMkMSkpIHsKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAgLyogcG9pbnQgZW50cnkgaW4gcm9vdCB0YWJsZSB0byBzdWItdGFibGUgKi8KICAgICAgICBsb3cgPSBodWZmICYgbWFzazsKICAgICAgICAvKnRhYmxlLm9wW2xvd10gPSBjdXJyOwogICAgICAgIHRhYmxlLmJpdHNbbG93XSA9IHJvb3Q7CiAgICAgICAgdGFibGUudmFsW2xvd10gPSBuZXh0IC0gb3B0cy50YWJsZV9pbmRleDsqLwogICAgICAgIHRhYmxlW2xvd10gPSAocm9vdCA8PCAyNCkgfCAoY3VyciA8PCAxNikgfCAobmV4dCAtIHRhYmxlX2luZGV4KSB8MDsKICAgICAgfQogICAgfQoKICAgIC8qIGZpbGwgaW4gcmVtYWluaW5nIHRhYmxlIGVudHJ5IGlmIGNvZGUgaXMgaW5jb21wbGV0ZSAoZ3VhcmFudGVlZCB0byBoYXZlCiAgICAgYXQgbW9zdCBvbmUgcmVtYWluaW5nIGVudHJ5LCBzaW5jZSBpZiB0aGUgY29kZSBpcyBpbmNvbXBsZXRlLCB0aGUKICAgICBtYXhpbXVtIGNvZGUgbGVuZ3RoIHRoYXQgd2FzIGFsbG93ZWQgdG8gZ2V0IHRoaXMgZmFyIGlzIG9uZSBiaXQpICovCiAgICBpZiAoaHVmZiAhPT0gMCkgewogICAgICAvL3RhYmxlLm9wW25leHQgKyBodWZmXSA9IDY0OyAgICAgICAgICAgIC8qIGludmFsaWQgY29kZSBtYXJrZXIgKi8KICAgICAgLy90YWJsZS5iaXRzW25leHQgKyBodWZmXSA9IGxlbiAtIGRyb3A7CiAgICAgIC8vdGFibGUudmFsW25leHQgKyBodWZmXSA9IDA7CiAgICAgIHRhYmxlW25leHQgKyBodWZmXSA9ICgobGVuIC0gZHJvcCkgPDwgMjQpIHwgKDY0IDw8IDE2KSB8MDsKICAgIH0KCiAgICAvKiBzZXQgcmV0dXJuIHBhcmFtZXRlcnMgKi8KICAgIC8vb3B0cy50YWJsZV9pbmRleCArPSB1c2VkOwogICAgb3B0cy5iaXRzID0gcm9vdDsKICAgIHJldHVybiAwOwogIH07CgoKICB2YXIgaW5mdHJlZXMgPSBpbmZsYXRlX3RhYmxlOwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCgoKCgoKICBjb25zdCBDT0RFUyA9IDA7CiAgY29uc3QgTEVOUyA9IDE7CiAgY29uc3QgRElTVFMgPSAyOwoKICAvKiBQdWJsaWMgY29uc3RhbnRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgogIGNvbnN0IHsKICAgIFpfRklOSVNIOiBaX0ZJTklTSCQxLCBaX0JMT0NLLCBaX1RSRUVTLAogICAgWl9PSzogWl9PSyQxLCBaX1NUUkVBTV9FTkQ6IFpfU1RSRUFNX0VORCQxLCBaX05FRURfRElDVDogWl9ORUVEX0RJQ1QkMSwgWl9TVFJFQU1fRVJST1I6IFpfU1RSRUFNX0VSUk9SJDEsIFpfREFUQV9FUlJPUjogWl9EQVRBX0VSUk9SJDEsIFpfTUVNX0VSUk9SOiBaX01FTV9FUlJPUiQxLCBaX0JVRl9FUlJPUiwKICAgIFpfREVGTEFURUQKICB9ID0gY29uc3RhbnRzJDI7CgoKICAvKiBTVEFURVMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKICBjb25zdCAgICBIRUFEID0gMTsgICAgICAgLyogaTogd2FpdGluZyBmb3IgbWFnaWMgaGVhZGVyICovCiAgY29uc3QgICAgRkxBR1MgPSAyOyAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIG1ldGhvZCBhbmQgZmxhZ3MgKGd6aXApICovCiAgY29uc3QgICAgVElNRSA9IDM7ICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIG1vZGlmaWNhdGlvbiB0aW1lIChnemlwKSAqLwogIGNvbnN0ICAgIE9TID0gNDsgICAgICAgICAvKiBpOiB3YWl0aW5nIGZvciBleHRyYSBmbGFncyBhbmQgb3BlcmF0aW5nIHN5c3RlbSAoZ3ppcCkgKi8KICBjb25zdCAgICBFWExFTiA9IDU7ICAgICAgLyogaTogd2FpdGluZyBmb3IgZXh0cmEgbGVuZ3RoIChnemlwKSAqLwogIGNvbnN0ICAgIEVYVFJBID0gNjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciBleHRyYSBieXRlcyAoZ3ppcCkgKi8KICBjb25zdCAgICBOQU1FID0gNzsgICAgICAgLyogaTogd2FpdGluZyBmb3IgZW5kIG9mIGZpbGUgbmFtZSAoZ3ppcCkgKi8KICBjb25zdCAgICBDT01NRU5UID0gODsgICAgLyogaTogd2FpdGluZyBmb3IgZW5kIG9mIGNvbW1lbnQgKGd6aXApICovCiAgY29uc3QgICAgSENSQyA9IDk7ICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIGhlYWRlciBjcmMgKGd6aXApICovCiAgY29uc3QgICAgRElDVElEID0gMTA7ICAgIC8qIGk6IHdhaXRpbmcgZm9yIGRpY3Rpb25hcnkgY2hlY2sgdmFsdWUgKi8KICBjb25zdCAgICBESUNUID0gMTE7ICAgICAgLyogd2FpdGluZyBmb3IgaW5mbGF0ZVNldERpY3Rpb25hcnkoKSBjYWxsICovCiAgY29uc3QgICAgICAgIFRZUEUgPSAxMjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciB0eXBlIGJpdHMsIGluY2x1ZGluZyBsYXN0LWZsYWcgYml0ICovCiAgY29uc3QgICAgICAgIFRZUEVETyA9IDEzOyAgICAvKiBpOiBzYW1lLCBidXQgc2tpcCBjaGVjayB0byBleGl0IGluZmxhdGUgb24gbmV3IGJsb2NrICovCiAgY29uc3QgICAgICAgIFNUT1JFRCA9IDE0OyAgICAvKiBpOiB3YWl0aW5nIGZvciBzdG9yZWQgc2l6ZSAobGVuZ3RoIGFuZCBjb21wbGVtZW50KSAqLwogIGNvbnN0ICAgICAgICBDT1BZXyA9IDE1OyAgICAgLyogaS9vOiBzYW1lIGFzIENPUFkgYmVsb3csIGJ1dCBvbmx5IGZpcnN0IHRpbWUgaW4gKi8KICBjb25zdCAgICAgICAgQ09QWSA9IDE2OyAgICAgIC8qIGkvbzogd2FpdGluZyBmb3IgaW5wdXQgb3Igb3V0cHV0IHRvIGNvcHkgc3RvcmVkIGJsb2NrICovCiAgY29uc3QgICAgICAgIFRBQkxFID0gMTc7ICAgICAvKiBpOiB3YWl0aW5nIGZvciBkeW5hbWljIGJsb2NrIHRhYmxlIGxlbmd0aHMgKi8KICBjb25zdCAgICAgICAgTEVOTEVOUyA9IDE4OyAgIC8qIGk6IHdhaXRpbmcgZm9yIGNvZGUgbGVuZ3RoIGNvZGUgbGVuZ3RocyAqLwogIGNvbnN0ICAgICAgICBDT0RFTEVOUyA9IDE5OyAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoL2xpdCBhbmQgZGlzdGFuY2UgY29kZSBsZW5ndGhzICovCiAgY29uc3QgICAgICAgICAgICBMRU5fID0gMjA7ICAgICAgLyogaTogc2FtZSBhcyBMRU4gYmVsb3csIGJ1dCBvbmx5IGZpcnN0IHRpbWUgaW4gKi8KICBjb25zdCAgICAgICAgICAgIExFTiA9IDIxOyAgICAgICAvKiBpOiB3YWl0aW5nIGZvciBsZW5ndGgvbGl0L2VvYiBjb2RlICovCiAgY29uc3QgICAgICAgICAgICBMRU5FWFQgPSAyMjsgICAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoIGV4dHJhIGJpdHMgKi8KICBjb25zdCAgICAgICAgICAgIERJU1QgPSAyMzsgICAgICAvKiBpOiB3YWl0aW5nIGZvciBkaXN0YW5jZSBjb2RlICovCiAgY29uc3QgICAgICAgICAgICBESVNURVhUID0gMjQ7ICAgLyogaTogd2FpdGluZyBmb3IgZGlzdGFuY2UgZXh0cmEgYml0cyAqLwogIGNvbnN0ICAgICAgICAgICAgTUFUQ0ggPSAyNTsgICAgIC8qIG86IHdhaXRpbmcgZm9yIG91dHB1dCBzcGFjZSB0byBjb3B5IHN0cmluZyAqLwogIGNvbnN0ICAgICAgICAgICAgTElUID0gMjY7ICAgICAgIC8qIG86IHdhaXRpbmcgZm9yIG91dHB1dCBzcGFjZSB0byB3cml0ZSBsaXRlcmFsICovCiAgY29uc3QgICAgQ0hFQ0sgPSAyNzsgICAgIC8qIGk6IHdhaXRpbmcgZm9yIDMyLWJpdCBjaGVjayB2YWx1ZSAqLwogIGNvbnN0ICAgIExFTkdUSCA9IDI4OyAgICAvKiBpOiB3YWl0aW5nIGZvciAzMi1iaXQgbGVuZ3RoIChnemlwKSAqLwogIGNvbnN0ICAgIERPTkUgPSAyOTsgICAgICAvKiBmaW5pc2hlZCBjaGVjaywgZG9uZSAtLSByZW1haW4gaGVyZSB1bnRpbCByZXNldCAqLwogIGNvbnN0ICAgIEJBRCA9IDMwOyAgICAgICAvKiBnb3QgYSBkYXRhIGVycm9yIC0tIHJlbWFpbiBoZXJlIHVudGlsIHJlc2V0ICovCiAgY29uc3QgICAgTUVNID0gMzE7ICAgICAgIC8qIGdvdCBhbiBpbmZsYXRlKCkgbWVtb3J5IGVycm9yIC0tIHJlbWFpbiBoZXJlIHVudGlsIHJlc2V0ICovCiAgY29uc3QgICAgU1lOQyA9IDMyOyAgICAgIC8qIGxvb2tpbmcgZm9yIHN5bmNocm9uaXphdGlvbiBieXRlcyB0byByZXN0YXJ0IGluZmxhdGUoKSAqLwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCgogIGNvbnN0IEVOT1VHSF9MRU5TID0gODUyOwogIGNvbnN0IEVOT1VHSF9ESVNUUyA9IDU5MjsKICAvL2NvbnN0IEVOT1VHSCA9ICAoRU5PVUdIX0xFTlMrRU5PVUdIX0RJU1RTKTsKCiAgY29uc3QgTUFYX1dCSVRTID0gMTU7CiAgLyogMzJLIExaNzcgd2luZG93ICovCiAgY29uc3QgREVGX1dCSVRTID0gTUFYX1dCSVRTOwoKCiAgY29uc3QgenN3YXAzMiA9IChxKSA9PiB7CgogICAgcmV0dXJuICAoKChxID4+PiAyNCkgJiAweGZmKSArCiAgICAgICAgICAgICgocSA+Pj4gOCkgJiAweGZmMDApICsKICAgICAgICAgICAgKChxICYgMHhmZjAwKSA8PCA4KSArCiAgICAgICAgICAgICgocSAmIDB4ZmYpIDw8IDI0KSk7CiAgfTsKCgogIGZ1bmN0aW9uIEluZmxhdGVTdGF0ZSgpIHsKICAgIHRoaXMubW9kZSA9IDA7ICAgICAgICAgICAgIC8qIGN1cnJlbnQgaW5mbGF0ZSBtb2RlICovCiAgICB0aGlzLmxhc3QgPSBmYWxzZTsgICAgICAgICAgLyogdHJ1ZSBpZiBwcm9jZXNzaW5nIGxhc3QgYmxvY2sgKi8KICAgIHRoaXMud3JhcCA9IDA7ICAgICAgICAgICAgICAvKiBiaXQgMCB0cnVlIGZvciB6bGliLCBiaXQgMSB0cnVlIGZvciBnemlwICovCiAgICB0aGlzLmhhdmVkaWN0ID0gZmFsc2U7ICAgICAgLyogdHJ1ZSBpZiBkaWN0aW9uYXJ5IHByb3ZpZGVkICovCiAgICB0aGlzLmZsYWdzID0gMDsgICAgICAgICAgICAgLyogZ3ppcCBoZWFkZXIgbWV0aG9kIGFuZCBmbGFncyAoMCBpZiB6bGliKSAqLwogICAgdGhpcy5kbWF4ID0gMDsgICAgICAgICAgICAgIC8qIHpsaWIgaGVhZGVyIG1heCBkaXN0YW5jZSAoSU5GTEFURV9TVFJJQ1QpICovCiAgICB0aGlzLmNoZWNrID0gMDsgICAgICAgICAgICAgLyogcHJvdGVjdGVkIGNvcHkgb2YgY2hlY2sgdmFsdWUgKi8KICAgIHRoaXMudG90YWwgPSAwOyAgICAgICAgICAgICAvKiBwcm90ZWN0ZWQgY29weSBvZiBvdXRwdXQgY291bnQgKi8KICAgIC8vIFRPRE86IG1heSBiZSB7fQogICAgdGhpcy5oZWFkID0gbnVsbDsgICAgICAgICAgIC8qIHdoZXJlIHRvIHNhdmUgZ3ppcCBoZWFkZXIgaW5mb3JtYXRpb24gKi8KCiAgICAvKiBzbGlkaW5nIHdpbmRvdyAqLwogICAgdGhpcy53Yml0cyA9IDA7ICAgICAgICAgICAgIC8qIGxvZyBiYXNlIDIgb2YgcmVxdWVzdGVkIHdpbmRvdyBzaXplICovCiAgICB0aGlzLndzaXplID0gMDsgICAgICAgICAgICAgLyogd2luZG93IHNpemUgb3IgemVybyBpZiBub3QgdXNpbmcgd2luZG93ICovCiAgICB0aGlzLndoYXZlID0gMDsgICAgICAgICAgICAgLyogdmFsaWQgYnl0ZXMgaW4gdGhlIHdpbmRvdyAqLwogICAgdGhpcy53bmV4dCA9IDA7ICAgICAgICAgICAgIC8qIHdpbmRvdyB3cml0ZSBpbmRleCAqLwogICAgdGhpcy53aW5kb3cgPSBudWxsOyAgICAgICAgIC8qIGFsbG9jYXRlZCBzbGlkaW5nIHdpbmRvdywgaWYgbmVlZGVkICovCgogICAgLyogYml0IGFjY3VtdWxhdG9yICovCiAgICB0aGlzLmhvbGQgPSAwOyAgICAgICAgICAgICAgLyogaW5wdXQgYml0IGFjY3VtdWxhdG9yICovCiAgICB0aGlzLmJpdHMgPSAwOyAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGJpdHMgaW4gImluIiAqLwoKICAgIC8qIGZvciBzdHJpbmcgYW5kIHN0b3JlZCBibG9jayBjb3B5aW5nICovCiAgICB0aGlzLmxlbmd0aCA9IDA7ICAgICAgICAgICAgLyogbGl0ZXJhbCBvciBsZW5ndGggb2YgZGF0YSB0byBjb3B5ICovCiAgICB0aGlzLm9mZnNldCA9IDA7ICAgICAgICAgICAgLyogZGlzdGFuY2UgYmFjayB0byBjb3B5IHN0cmluZyBmcm9tICovCgogICAgLyogZm9yIHRhYmxlIGFuZCBjb2RlIGRlY29kaW5nICovCiAgICB0aGlzLmV4dHJhID0gMDsgICAgICAgICAgICAgLyogZXh0cmEgYml0cyBuZWVkZWQgKi8KCiAgICAvKiBmaXhlZCBhbmQgZHluYW1pYyBjb2RlIHRhYmxlcyAqLwogICAgdGhpcy5sZW5jb2RlID0gbnVsbDsgICAgICAgICAgLyogc3RhcnRpbmcgdGFibGUgZm9yIGxlbmd0aC9saXRlcmFsIGNvZGVzICovCiAgICB0aGlzLmRpc3Rjb2RlID0gbnVsbDsgICAgICAgICAvKiBzdGFydGluZyB0YWJsZSBmb3IgZGlzdGFuY2UgY29kZXMgKi8KICAgIHRoaXMubGVuYml0cyA9IDA7ICAgICAgICAgICAvKiBpbmRleCBiaXRzIGZvciBsZW5jb2RlICovCiAgICB0aGlzLmRpc3RiaXRzID0gMDsgICAgICAgICAgLyogaW5kZXggYml0cyBmb3IgZGlzdGNvZGUgKi8KCiAgICAvKiBkeW5hbWljIHRhYmxlIGJ1aWxkaW5nICovCiAgICB0aGlzLm5jb2RlID0gMDsgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGNvZGUgbGVuZ3RoIGNvZGUgbGVuZ3RocyAqLwogICAgdGhpcy5ubGVuID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBsZW5ndGggY29kZSBsZW5ndGhzICovCiAgICB0aGlzLm5kaXN0ID0gMDsgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGUgbGVuZ3RocyAqLwogICAgdGhpcy5oYXZlID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBjb2RlIGxlbmd0aHMgaW4gbGVuc1tdICovCiAgICB0aGlzLm5leHQgPSBudWxsOyAgICAgICAgICAgICAgLyogbmV4dCBhdmFpbGFibGUgc3BhY2UgaW4gY29kZXNbXSAqLwoKICAgIHRoaXMubGVucyA9IG5ldyBVaW50MTZBcnJheSgzMjApOyAvKiB0ZW1wb3Jhcnkgc3RvcmFnZSBmb3IgY29kZSBsZW5ndGhzICovCiAgICB0aGlzLndvcmsgPSBuZXcgVWludDE2QXJyYXkoMjg4KTsgLyogd29yayBhcmVhIGZvciBjb2RlIHRhYmxlIGJ1aWxkaW5nICovCgogICAgLyoKICAgICBiZWNhdXNlIHdlIGRvbid0IGhhdmUgcG9pbnRlcnMgaW4ganMsIHdlIHVzZSBsZW5jb2RlIGFuZCBkaXN0Y29kZSBkaXJlY3RseQogICAgIGFzIGJ1ZmZlcnMgc28gd2UgZG9uJ3QgbmVlZCBjb2RlcwogICAgKi8KICAgIC8vdGhpcy5jb2RlcyA9IG5ldyBJbnQzMkFycmF5KEVOT1VHSCk7ICAgICAgIC8qIHNwYWNlIGZvciBjb2RlIHRhYmxlcyAqLwogICAgdGhpcy5sZW5keW4gPSBudWxsOyAgICAgICAgICAgICAgLyogZHluYW1pYyB0YWJsZSBmb3IgbGVuZ3RoL2xpdGVyYWwgY29kZXMgKEpTIHNwZWNpZmljKSAqLwogICAgdGhpcy5kaXN0ZHluID0gbnVsbDsgICAgICAgICAgICAgLyogZHluYW1pYyB0YWJsZSBmb3IgZGlzdGFuY2UgY29kZXMgKEpTIHNwZWNpZmljKSAqLwogICAgdGhpcy5zYW5lID0gMDsgICAgICAgICAgICAgICAgICAgLyogaWYgZmFsc2UsIGFsbG93IGludmFsaWQgZGlzdGFuY2UgdG9vIGZhciAqLwogICAgdGhpcy5iYWNrID0gMDsgICAgICAgICAgICAgICAgICAgLyogYml0cyBiYWNrIG9mIGxhc3QgdW5wcm9jZXNzZWQgbGVuZ3RoL2xpdCAqLwogICAgdGhpcy53YXMgPSAwOyAgICAgICAgICAgICAgICAgICAgLyogaW5pdGlhbCBsZW5ndGggb2YgbWF0Y2ggKi8KICB9CgoKICBjb25zdCBpbmZsYXRlUmVzZXRLZWVwID0gKHN0cm0pID0+IHsKCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KICAgIGNvbnN0IHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IHN0YXRlLnRvdGFsID0gMDsKICAgIHN0cm0ubXNnID0gJyc7IC8qWl9OVUxMKi8KICAgIGlmIChzdGF0ZS53cmFwKSB7ICAgICAgIC8qIHRvIHN1cHBvcnQgaWxsLWNvbmNlaXZlZCBKYXZhIHRlc3Qgc3VpdGUgKi8KICAgICAgc3RybS5hZGxlciA9IHN0YXRlLndyYXAgJiAxOwogICAgfQogICAgc3RhdGUubW9kZSA9IEhFQUQ7CiAgICBzdGF0ZS5sYXN0ID0gMDsKICAgIHN0YXRlLmhhdmVkaWN0ID0gMDsKICAgIHN0YXRlLmRtYXggPSAzMjc2ODsKICAgIHN0YXRlLmhlYWQgPSBudWxsLypaX05VTEwqLzsKICAgIHN0YXRlLmhvbGQgPSAwOwogICAgc3RhdGUuYml0cyA9IDA7CiAgICAvL3N0YXRlLmxlbmNvZGUgPSBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLm5leHQgPSBzdGF0ZS5jb2RlczsKICAgIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5sZW5keW4gPSBuZXcgSW50MzJBcnJheShFTk9VR0hfTEVOUyk7CiAgICBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLmRpc3RkeW4gPSBuZXcgSW50MzJBcnJheShFTk9VR0hfRElTVFMpOwoKICAgIHN0YXRlLnNhbmUgPSAxOwogICAgc3RhdGUuYmFjayA9IC0xOwogICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6IHJlc2V0XG4iKSk7CiAgICByZXR1cm4gWl9PSyQxOwogIH07CgoKICBjb25zdCBpbmZsYXRlUmVzZXQgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgc3RhdGUud3NpemUgPSAwOwogICAgc3RhdGUud2hhdmUgPSAwOwogICAgc3RhdGUud25leHQgPSAwOwogICAgcmV0dXJuIGluZmxhdGVSZXNldEtlZXAoc3RybSk7CgogIH07CgoKICBjb25zdCBpbmZsYXRlUmVzZXQyID0gKHN0cm0sIHdpbmRvd0JpdHMpID0+IHsKICAgIGxldCB3cmFwOwoKICAgIC8qIGdldCB0aGUgc3RhdGUgKi8KICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIC8qIGV4dHJhY3Qgd3JhcCByZXF1ZXN0IGZyb20gd2luZG93Qml0cyBwYXJhbWV0ZXIgKi8KICAgIGlmICh3aW5kb3dCaXRzIDwgMCkgewogICAgICB3cmFwID0gMDsKICAgICAgd2luZG93Qml0cyA9IC13aW5kb3dCaXRzOwogICAgfQogICAgZWxzZSB7CiAgICAgIHdyYXAgPSAod2luZG93Qml0cyA+PiA0KSArIDE7CiAgICAgIGlmICh3aW5kb3dCaXRzIDwgNDgpIHsKICAgICAgICB3aW5kb3dCaXRzICY9IDE1OwogICAgICB9CiAgICB9CgogICAgLyogc2V0IG51bWJlciBvZiB3aW5kb3cgYml0cywgZnJlZSB3aW5kb3cgaWYgZGlmZmVyZW50ICovCiAgICBpZiAod2luZG93Qml0cyAmJiAod2luZG93Qml0cyA8IDggfHwgd2luZG93Qml0cyA+IDE1KSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgIH0KICAgIGlmIChzdGF0ZS53aW5kb3cgIT09IG51bGwgJiYgc3RhdGUud2JpdHMgIT09IHdpbmRvd0JpdHMpIHsKICAgICAgc3RhdGUud2luZG93ID0gbnVsbDsKICAgIH0KCiAgICAvKiB1cGRhdGUgc3RhdGUgYW5kIHJlc2V0IHRoZSByZXN0IG9mIGl0ICovCiAgICBzdGF0ZS53cmFwID0gd3JhcDsKICAgIHN0YXRlLndiaXRzID0gd2luZG93Qml0czsKICAgIHJldHVybiBpbmZsYXRlUmVzZXQoc3RybSk7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVJbml0MiA9IChzdHJtLCB3aW5kb3dCaXRzKSA9PiB7CgogICAgaWYgKCFzdHJtKSB7IHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOyB9CiAgICAvL3N0cm0ubXNnID0gWl9OVUxMOyAgICAgICAgICAgICAgICAgLyogaW4gY2FzZSB3ZSByZXR1cm4gYW4gZXJyb3IgKi8KCiAgICBjb25zdCBzdGF0ZSA9IG5ldyBJbmZsYXRlU3RhdGUoKTsKCiAgICAvL2lmIChzdGF0ZSA9PT0gWl9OVUxMKSByZXR1cm4gWl9NRU1fRVJST1I7CiAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogYWxsb2NhdGVkXG4iKSk7CiAgICBzdHJtLnN0YXRlID0gc3RhdGU7CiAgICBzdGF0ZS53aW5kb3cgPSBudWxsLypaX05VTEwqLzsKICAgIGNvbnN0IHJldCA9IGluZmxhdGVSZXNldDIoc3RybSwgd2luZG93Qml0cyk7CiAgICBpZiAocmV0ICE9PSBaX09LJDEpIHsKICAgICAgc3RybS5zdGF0ZSA9IG51bGwvKlpfTlVMTCovOwogICAgfQogICAgcmV0dXJuIHJldDsKICB9OwoKCiAgY29uc3QgaW5mbGF0ZUluaXQgPSAoc3RybSkgPT4gewoKICAgIHJldHVybiBpbmZsYXRlSW5pdDIoc3RybSwgREVGX1dCSVRTKTsKICB9OwoKCiAgLyoKICAgUmV0dXJuIHN0YXRlIHdpdGggbGVuZ3RoIGFuZCBkaXN0YW5jZSBkZWNvZGluZyB0YWJsZXMgYW5kIGluZGV4IHNpemVzIHNldCB0bwogICBmaXhlZCBjb2RlIGRlY29kaW5nLiAgTm9ybWFsbHkgdGhpcyByZXR1cm5zIGZpeGVkIHRhYmxlcyBmcm9tIGluZmZpeGVkLmguCiAgIElmIEJVSUxERklYRUQgaXMgZGVmaW5lZCwgdGhlbiBpbnN0ZWFkIHRoaXMgcm91dGluZSBidWlsZHMgdGhlIHRhYmxlcyB0aGUKICAgZmlyc3QgdGltZSBpdCdzIGNhbGxlZCwgYW5kIHJldHVybnMgdGhvc2UgdGFibGVzIHRoZSBmaXJzdCB0aW1lIGFuZAogICB0aGVyZWFmdGVyLiAgVGhpcyByZWR1Y2VzIHRoZSBzaXplIG9mIHRoZSBjb2RlIGJ5IGFib3V0IDJLIGJ5dGVzLCBpbgogICBleGNoYW5nZSBmb3IgYSBsaXR0bGUgZXhlY3V0aW9uIHRpbWUuICBIb3dldmVyLCBCVUlMREZJWEVEIHNob3VsZCBub3QgYmUKICAgdXNlZCBmb3IgdGhyZWFkZWQgYXBwbGljYXRpb25zLCBzaW5jZSB0aGUgcmV3cml0aW5nIG9mIHRoZSB0YWJsZXMgYW5kIHZpcmdpbgogICBtYXkgbm90IGJlIHRocmVhZC1zYWZlLgogICAqLwogIGxldCB2aXJnaW4gPSB0cnVlOwoKICBsZXQgbGVuZml4LCBkaXN0Zml4OyAvLyBXZSBoYXZlIG5vIHBvaW50ZXJzIGluIEpTLCBzbyBrZWVwIHRhYmxlcyBzZXBhcmF0ZQoKCiAgY29uc3QgZml4ZWR0YWJsZXMgPSAoc3RhdGUpID0+IHsKCiAgICAvKiBidWlsZCBmaXhlZCBodWZmbWFuIHRhYmxlcyBpZiBmaXJzdCBjYWxsIChtYXkgbm90IGJlIHRocmVhZCBzYWZlKSAqLwogICAgaWYgKHZpcmdpbikgewogICAgICBsZW5maXggPSBuZXcgSW50MzJBcnJheSg1MTIpOwogICAgICBkaXN0Zml4ID0gbmV3IEludDMyQXJyYXkoMzIpOwoKICAgICAgLyogbGl0ZXJhbC9sZW5ndGggdGFibGUgKi8KICAgICAgbGV0IHN5bSA9IDA7CiAgICAgIHdoaWxlIChzeW0gPCAxNDQpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA4OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyNTYpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA5OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyODApIHsgc3RhdGUubGVuc1tzeW0rK10gPSA3OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyODgpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA4OyB9CgogICAgICBpbmZ0cmVlcyhMRU5TLCAgc3RhdGUubGVucywgMCwgMjg4LCBsZW5maXgsICAgMCwgc3RhdGUud29yaywgeyBiaXRzOiA5IH0pOwoKICAgICAgLyogZGlzdGFuY2UgdGFibGUgKi8KICAgICAgc3ltID0gMDsKICAgICAgd2hpbGUgKHN5bSA8IDMyKSB7IHN0YXRlLmxlbnNbc3ltKytdID0gNTsgfQoKICAgICAgaW5mdHJlZXMoRElTVFMsIHN0YXRlLmxlbnMsIDAsIDMyLCAgIGRpc3RmaXgsIDAsIHN0YXRlLndvcmssIHsgYml0czogNSB9KTsKCiAgICAgIC8qIGRvIHRoaXMganVzdCBvbmNlICovCiAgICAgIHZpcmdpbiA9IGZhbHNlOwogICAgfQoKICAgIHN0YXRlLmxlbmNvZGUgPSBsZW5maXg7CiAgICBzdGF0ZS5sZW5iaXRzID0gOTsKICAgIHN0YXRlLmRpc3Rjb2RlID0gZGlzdGZpeDsKICAgIHN0YXRlLmRpc3RiaXRzID0gNTsKICB9OwoKCiAgLyoKICAgVXBkYXRlIHRoZSB3aW5kb3cgd2l0aCB0aGUgbGFzdCB3c2l6ZSAobm9ybWFsbHkgMzJLKSBieXRlcyB3cml0dGVuIGJlZm9yZQogICByZXR1cm5pbmcuICBJZiB3aW5kb3cgZG9lcyBub3QgZXhpc3QgeWV0LCBjcmVhdGUgaXQuICBUaGlzIGlzIG9ubHkgY2FsbGVkCiAgIHdoZW4gYSB3aW5kb3cgaXMgYWxyZWFkeSBpbiB1c2UsIG9yIHdoZW4gb3V0cHV0IGhhcyBiZWVuIHdyaXR0ZW4gZHVyaW5nIHRoaXMKICAgaW5mbGF0ZSBjYWxsLCBidXQgdGhlIGVuZCBvZiB0aGUgZGVmbGF0ZSBzdHJlYW0gaGFzIG5vdCBiZWVuIHJlYWNoZWQgeWV0LgogICBJdCBpcyBhbHNvIGNhbGxlZCB0byBjcmVhdGUgYSB3aW5kb3cgZm9yIGRpY3Rpb25hcnkgZGF0YSB3aGVuIGEgZGljdGlvbmFyeQogICBpcyBsb2FkZWQuCgogICBQcm92aWRpbmcgb3V0cHV0IGJ1ZmZlcnMgbGFyZ2VyIHRoYW4gMzJLIHRvIGluZmxhdGUoKSBzaG91bGQgcHJvdmlkZSBhIHNwZWVkCiAgIGFkdmFudGFnZSwgc2luY2Ugb25seSB0aGUgbGFzdCAzMksgb2Ygb3V0cHV0IGlzIGNvcGllZCB0byB0aGUgc2xpZGluZyB3aW5kb3cKICAgdXBvbiByZXR1cm4gZnJvbSBpbmZsYXRlKCksIGFuZCBzaW5jZSBhbGwgZGlzdGFuY2VzIGFmdGVyIHRoZSBmaXJzdCAzMksgb2YKICAgb3V0cHV0IHdpbGwgZmFsbCBpbiB0aGUgb3V0cHV0IGRhdGEsIG1ha2luZyBtYXRjaCBjb3BpZXMgc2ltcGxlciBhbmQgZmFzdGVyLgogICBUaGUgYWR2YW50YWdlIG1heSBiZSBkZXBlbmRlbnQgb24gdGhlIHNpemUgb2YgdGhlIHByb2Nlc3NvcidzIGRhdGEgY2FjaGVzLgogICAqLwogIGNvbnN0IHVwZGF0ZXdpbmRvdyA9IChzdHJtLCBzcmMsIGVuZCwgY29weSkgPT4gewoKICAgIGxldCBkaXN0OwogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIC8qIGlmIGl0IGhhc24ndCBiZWVuIGRvbmUgYWxyZWFkeSwgYWxsb2NhdGUgc3BhY2UgZm9yIHRoZSB3aW5kb3cgKi8KICAgIGlmIChzdGF0ZS53aW5kb3cgPT09IG51bGwpIHsKICAgICAgc3RhdGUud3NpemUgPSAxIDw8IHN0YXRlLndiaXRzOwogICAgICBzdGF0ZS53bmV4dCA9IDA7CiAgICAgIHN0YXRlLndoYXZlID0gMDsKCiAgICAgIHN0YXRlLndpbmRvdyA9IG5ldyBVaW50OEFycmF5KHN0YXRlLndzaXplKTsKICAgIH0KCiAgICAvKiBjb3B5IHN0YXRlLT53c2l6ZSBvciBsZXNzIG91dHB1dCBieXRlcyBpbnRvIHRoZSBjaXJjdWxhciB3aW5kb3cgKi8KICAgIGlmIChjb3B5ID49IHN0YXRlLndzaXplKSB7CiAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIHN0YXRlLndzaXplLCBlbmQpLCAwKTsKICAgICAgc3RhdGUud25leHQgPSAwOwogICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgfQogICAgZWxzZSB7CiAgICAgIGRpc3QgPSBzdGF0ZS53c2l6ZSAtIHN0YXRlLnduZXh0OwogICAgICBpZiAoZGlzdCA+IGNvcHkpIHsKICAgICAgICBkaXN0ID0gY29weTsKICAgICAgfQogICAgICAvL3ptZW1jcHkoc3RhdGUtPndpbmRvdyArIHN0YXRlLT53bmV4dCwgZW5kIC0gY29weSwgZGlzdCk7CiAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIGNvcHksIGVuZCAtIGNvcHkgKyBkaXN0KSwgc3RhdGUud25leHQpOwogICAgICBjb3B5IC09IGRpc3Q7CiAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgLy96bWVtY3B5KHN0YXRlLT53aW5kb3csIGVuZCAtIGNvcHksIGNvcHkpOwogICAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIGNvcHksIGVuZCksIDApOwogICAgICAgIHN0YXRlLnduZXh0ID0gY29weTsKICAgICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHN0YXRlLnduZXh0ICs9IGRpc3Q7CiAgICAgICAgaWYgKHN0YXRlLnduZXh0ID09PSBzdGF0ZS53c2l6ZSkgeyBzdGF0ZS53bmV4dCA9IDA7IH0KICAgICAgICBpZiAoc3RhdGUud2hhdmUgPCBzdGF0ZS53c2l6ZSkgeyBzdGF0ZS53aGF2ZSArPSBkaXN0OyB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAwOwogIH07CgoKICBjb25zdCBpbmZsYXRlJDIgPSAoc3RybSwgZmx1c2gpID0+IHsKCiAgICBsZXQgc3RhdGU7CiAgICBsZXQgaW5wdXQsIG91dHB1dDsgICAgICAgICAgLy8gaW5wdXQvb3V0cHV0IGJ1ZmZlcnMKICAgIGxldCBuZXh0OyAgICAgICAgICAgICAgICAgICAvKiBuZXh0IGlucHV0IElOREVYICovCiAgICBsZXQgcHV0OyAgICAgICAgICAgICAgICAgICAgLyogbmV4dCBvdXRwdXQgSU5ERVggKi8KICAgIGxldCBoYXZlLCBsZWZ0OyAgICAgICAgICAgICAvKiBhdmFpbGFibGUgaW5wdXQgYW5kIG91dHB1dCAqLwogICAgbGV0IGhvbGQ7ICAgICAgICAgICAgICAgICAgIC8qIGJpdCBidWZmZXIgKi8KICAgIGxldCBiaXRzOyAgICAgICAgICAgICAgICAgICAvKiBiaXRzIGluIGJpdCBidWZmZXIgKi8KICAgIGxldCBfaW4sIF9vdXQ7ICAgICAgICAgICAgICAvKiBzYXZlIHN0YXJ0aW5nIGF2YWlsYWJsZSBpbnB1dCBhbmQgb3V0cHV0ICovCiAgICBsZXQgY29weTsgICAgICAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIHN0b3JlZCBvciBtYXRjaCBieXRlcyB0byBjb3B5ICovCiAgICBsZXQgZnJvbTsgICAgICAgICAgICAgICAgICAgLyogd2hlcmUgdG8gY29weSBtYXRjaCBieXRlcyBmcm9tICovCiAgICBsZXQgZnJvbV9zb3VyY2U7CiAgICBsZXQgaGVyZSA9IDA7ICAgICAgICAgICAgICAgLyogY3VycmVudCBkZWNvZGluZyB0YWJsZSBlbnRyeSAqLwogICAgbGV0IGhlcmVfYml0cywgaGVyZV9vcCwgaGVyZV92YWw7IC8vIHBha2VkICJoZXJlIiBkZW5vcm1hbGl6ZWQgKEpTIHNwZWNpZmljKQogICAgLy9sZXQgbGFzdDsgICAgICAgICAgICAgICAgICAgLyogcGFyZW50IHRhYmxlIGVudHJ5ICovCiAgICBsZXQgbGFzdF9iaXRzLCBsYXN0X29wLCBsYXN0X3ZhbDsgLy8gcGFrZWQgImxhc3QiIGRlbm9ybWFsaXplZCAoSlMgc3BlY2lmaWMpCiAgICBsZXQgbGVuOyAgICAgICAgICAgICAgICAgICAgLyogbGVuZ3RoIHRvIGNvcHkgZm9yIHJlcGVhdHMsIGJpdHMgdG8gZHJvcCAqLwogICAgbGV0IHJldDsgICAgICAgICAgICAgICAgICAgIC8qIHJldHVybiBjb2RlICovCiAgICBjb25zdCBoYnVmID0gbmV3IFVpbnQ4QXJyYXkoNCk7ICAgIC8qIGJ1ZmZlciBmb3IgZ3ppcCBoZWFkZXIgY3JjIGNhbGN1bGF0aW9uICovCiAgICBsZXQgb3B0czsKCiAgICBsZXQgbjsgLy8gdGVtcG9yYXJ5IHZhcmlhYmxlIGZvciBORUVEX0JJVFMKCiAgICBjb25zdCBvcmRlciA9IC8qIHBlcm11dGF0aW9uIG9mIGNvZGUgbGVuZ3RocyAqLwogICAgICBuZXcgVWludDhBcnJheShbIDE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTUgXSk7CgoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSB8fCAhc3RybS5vdXRwdXQgfHwKICAgICAgICAoIXN0cm0uaW5wdXQgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCkpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CgogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsgc3RhdGUubW9kZSA9IFRZUEVETzsgfSAgICAvKiBza2lwIGNoZWNrICovCgoKICAgIC8vLS0tIExPQUQoKSAtLS0KICAgIHB1dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICBvdXRwdXQgPSBzdHJtLm91dHB1dDsKICAgIGxlZnQgPSBzdHJtLmF2YWlsX291dDsKICAgIG5leHQgPSBzdHJtLm5leHRfaW47CiAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICBoYXZlID0gc3RybS5hdmFpbF9pbjsKICAgIGhvbGQgPSBzdGF0ZS5ob2xkOwogICAgYml0cyA9IHN0YXRlLmJpdHM7CiAgICAvLy0tLQoKICAgIF9pbiA9IGhhdmU7CiAgICBfb3V0ID0gbGVmdDsKICAgIHJldCA9IFpfT0skMTsKCiAgICBpbmZfbGVhdmU6IC8vIGdvdG8gZW11bGF0aW9uCiAgICBmb3IgKDs7KSB7CiAgICAgIHN3aXRjaCAoc3RhdGUubW9kZSkgewogICAgICAgIGNhc2UgSEVBRDoKICAgICAgICAgIGlmIChzdGF0ZS53cmFwID09PSAwKSB7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFRE87CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgLy89PT0gTkVFREJJVFMoMTYpOwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgaWYgKChzdGF0ZS53cmFwICYgMikgJiYgaG9sZCA9PT0gMHg4YjFmKSB7ICAvKiBnemlwIGhlYWRlciAqLwogICAgICAgICAgICBzdGF0ZS5jaGVjayA9IDAvKmNyYzMyKDBMLCBaX05VTEwsIDApKi87CiAgICAgICAgICAgIC8vPT09IENSQzIoc3RhdGUuY2hlY2ssIGhvbGQpOwogICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyXzEoc3RhdGUuY2hlY2ssIGhidWYsIDIsIDApOwogICAgICAgICAgICAvLz09PS8vCgogICAgICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgc3RhdGUubW9kZSA9IEZMQUdTOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLmZsYWdzID0gMDsgICAgICAgICAgIC8qIGV4cGVjdCB6bGliIGhlYWRlciAqLwogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5kb25lID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIShzdGF0ZS53cmFwICYgMSkgfHwgICAvKiBjaGVjayBpZiB6bGliIGhlYWRlciBhbGxvd2VkICovCiAgICAgICAgICAgICgoKGhvbGQgJiAweGZmKS8qQklUUyg4KSovIDw8IDgpICsgKGhvbGQgPj4gOCkpICUgMzEpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW5jb3JyZWN0IGhlYWRlciBjaGVjayc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKChob2xkICYgMHgwZikvKkJJVFMoNCkqLyAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICd1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgLy8tLS0gRFJPUEJJVFMoNCkgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSA0OwogICAgICAgICAgYml0cyAtPSA0OwogICAgICAgICAgLy8tLS0vLwogICAgICAgICAgbGVuID0gKGhvbGQgJiAweDBmKS8qQklUUyg0KSovICsgODsKICAgICAgICAgIGlmIChzdGF0ZS53Yml0cyA9PT0gMCkgewogICAgICAgICAgICBzdGF0ZS53Yml0cyA9IGxlbjsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKGxlbiA+IHN0YXRlLndiaXRzKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgd2luZG93IHNpemUnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyAhISEgcGFrbyBwYXRjaC4gRm9yY2UgdXNlIGBvcHRpb25zLndpbmRvd0JpdHNgIGlmIHBhc3NlZC4KICAgICAgICAgIC8vIFJlcXVpcmVkIHRvIGFsd2F5cyB1c2UgbWF4IHdpbmRvdyBzaXplIGJ5IGRlZmF1bHQuCiAgICAgICAgICBzdGF0ZS5kbWF4ID0gMSA8PCBzdGF0ZS53Yml0czsKICAgICAgICAgIC8vc3RhdGUuZG1heCA9IDEgPDwgbGVuOwoKICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgIHpsaWIgaGVhZGVyIG9rXG4iKSk7CiAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSAxLyphZGxlcjMyKDBMLCBaX05VTEwsIDApKi87CiAgICAgICAgICBzdGF0ZS5tb2RlID0gaG9sZCAmIDB4MjAwID8gRElDVElEIDogVFlQRTsKICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBGTEFHUzoKICAgICAgICAgIC8vPT09IE5FRURCSVRTKDE2KTsgKi8KICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIHN0YXRlLmZsYWdzID0gaG9sZDsKICAgICAgICAgIGlmICgoc3RhdGUuZmxhZ3MgJiAweGZmKSAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICd1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHhlMDAwKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ3Vua25vd24gaGVhZGVyIGZsYWdzIHNldCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC50ZXh0ID0gKChob2xkID4+IDgpICYgMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgLy89PT0gQ1JDMihzdGF0ZS5jaGVjaywgaG9sZCk7CiAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMHhmZjsKICAgICAgICAgICAgaGJ1ZlsxXSA9IChob2xkID4+PiA4KSAmIDB4ZmY7CiAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzJfMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubW9kZSA9IFRJTUU7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBUSU1FOgogICAgICAgICAgLy89PT0gTkVFREJJVFMoMzIpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC50aW1lID0gaG9sZDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBDUkM0KHN0YXRlLmNoZWNrLCBob2xkKQogICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICBoYnVmWzJdID0gKGhvbGQgPj4+IDE2KSAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbM10gPSAoaG9sZCA+Pj4gMjQpICYgMHhmZjsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBoYnVmLCA0LCAwKTsKICAgICAgICAgICAgLy89PT0KICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubW9kZSA9IE9TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgT1M6CiAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICB3aGlsZSAoYml0cyA8IDE2KSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICBzdGF0ZS5oZWFkLnhmbGFncyA9IChob2xkICYgMHhmZik7CiAgICAgICAgICAgIHN0YXRlLmhlYWQub3MgPSAoaG9sZCA+PiA4KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBDUkMyKHN0YXRlLmNoZWNrLCBob2xkKTsKICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAweGZmOwogICAgICAgICAgICBoYnVmWzFdID0gKGhvbGQgPj4+IDgpICYgMHhmZjsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBoYnVmLCAyLCAwKTsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5tb2RlID0gRVhMRU47CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBFWExFTjoKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDQwMCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gaG9sZDsKICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhX2xlbiA9IGhvbGQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgwMjAwKSB7CiAgICAgICAgICAgICAgLy89PT0gQ1JDMihzdGF0ZS5jaGVjaywgaG9sZCk7CiAgICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAweGZmOwogICAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzJfMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhID0gbnVsbC8qWl9OVUxMKi87CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRVhUUkE7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBFWFRSQToKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDQwMCkgewogICAgICAgICAgICBjb3B5ID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICBpZiAoY29weSA+IGhhdmUpIHsgY29weSA9IGhhdmU7IH0KICAgICAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgICAgbGVuID0gc3RhdGUuaGVhZC5leHRyYV9sZW4gLSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLmhlYWQuZXh0cmEpIHsKICAgICAgICAgICAgICAgICAgLy8gVXNlIHVudHlwZWQgYXJyYXkgZm9yIG1vcmUgY29udmVuaWVudCBwcm9jZXNzaW5nIGxhdGVyCiAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBuZXcgVWludDhBcnJheShzdGF0ZS5oZWFkLmV4dHJhX2xlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhLnNldCgKICAgICAgICAgICAgICAgICAgaW5wdXQuc3ViYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgbmV4dCwKICAgICAgICAgICAgICAgICAgICAvLyBleHRyYSBmaWVsZCBpcyBsaW1pdGVkIHRvIDY1NTM2IGJ5dGVzCiAgICAgICAgICAgICAgICAgICAgLy8gLSBubyBuZWVkIGZvciBhZGRpdGlvbmFsIHNpemUgY2hlY2sKICAgICAgICAgICAgICAgICAgICBuZXh0ICsgY29weQogICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAvKmxlbiArIGNvcHkgPiBzdGF0ZS5oZWFkLmV4dHJhX21heCAtIGxlbiA/IHN0YXRlLmhlYWQuZXh0cmFfbWF4IDogY29weSwqLwogICAgICAgICAgICAgICAgICBsZW4KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAvL3ptZW1jcHkoc3RhdGUuaGVhZC5leHRyYSArIGxlbiwgbmV4dCwKICAgICAgICAgICAgICAgIC8vICAgICAgICBsZW4gKyBjb3B5ID4gc3RhdGUuaGVhZC5leHRyYV9tYXggPwogICAgICAgICAgICAgICAgLy8gICAgICAgIHN0YXRlLmhlYWQuZXh0cmFfbWF4IC0gbGVuIDogY29weSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgICAgc3RhdGUubGVuZ3RoIC09IGNvcHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLmxlbmd0aCA9IDA7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gTkFNRTsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIE5BTUU6CiAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDA4MDApIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGNvcHkgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgLy8gVE9ETzogMiBvciAxIGJ5dGVzPwogICAgICAgICAgICAgIGxlbiA9IGlucHV0W25leHQgKyBjb3B5KytdOwogICAgICAgICAgICAgIC8qIHVzZSBjb25zdGFudCBsaW1pdCBiZWNhdXNlIGluIGpzIHdlIHNob3VsZCBub3QgcHJlYWxsb2NhdGUgbWVtb3J5ICovCiAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmCiAgICAgICAgICAgICAgICAgIChzdGF0ZS5sZW5ndGggPCA2NTUzNiAvKnN0YXRlLmhlYWQubmFtZV9tYXgqLykpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlIChsZW4gJiYgY29weSA8IGhhdmUpOwoKICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgwMjAwKSB7CiAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGF2ZSAtPSBjb3B5OwogICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgIGlmIChsZW4pIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5sZW5ndGggPSAwOwogICAgICAgICAgc3RhdGUubW9kZSA9IENPTU1FTlQ7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgxMDAwKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBjb3B5ID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGxlbiA9IGlucHV0W25leHQgKyBjb3B5KytdOwogICAgICAgICAgICAgIC8qIHVzZSBjb25zdGFudCBsaW1pdCBiZWNhdXNlIGluIGpzIHdlIHNob3VsZCBub3QgcHJlYWxsb2NhdGUgbWVtb3J5ICovCiAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmCiAgICAgICAgICAgICAgICAgIChzdGF0ZS5sZW5ndGggPCA2NTUzNiAvKnN0YXRlLmhlYWQuY29tbV9tYXgqLykpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuY29tbWVudCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlIChsZW4gJiYgY29weSA8IGhhdmUpOwogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyXzEoc3RhdGUuY2hlY2ssIGlucHV0LCBjb3B5LCBuZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICAgIG5leHQgKz0gY29weTsKICAgICAgICAgICAgaWYgKGxlbikgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5jb21tZW50ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLm1vZGUgPSBIQ1JDOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgSENSQzoKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgaWYgKGhvbGQgIT09IChzdGF0ZS5jaGVjayAmIDB4ZmZmZikpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdoZWFkZXIgY3JjIG1pc21hdGNoJzsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5oY3JjID0gKChzdGF0ZS5mbGFncyA+PiA5KSAmIDEpOwogICAgICAgICAgICBzdGF0ZS5oZWFkLmRvbmUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMDsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBESUNUSUQ6CiAgICAgICAgICAvLz09PSBORUVEQklUUygzMik7ICovCiAgICAgICAgICB3aGlsZSAoYml0cyA8IDMyKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSB6c3dhcDMyKGhvbGQpOwogICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5tb2RlID0gRElDVDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERJQ1Q6CiAgICAgICAgICBpZiAoc3RhdGUuaGF2ZWRpY3QgPT09IDApIHsKICAgICAgICAgICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgIC8vLS0tCiAgICAgICAgICAgIHJldHVybiBaX05FRURfRElDVCQxOwogICAgICAgICAgfQogICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMS8qYWRsZXIzMigwTCwgWl9OVUxMLCAwKSovOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEU7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBUWVBFOgogICAgICAgICAgaWYgKGZsdXNoID09PSBaX0JMT0NLIHx8IGZsdXNoID09PSBaX1RSRUVTKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgVFlQRURPOgogICAgICAgICAgaWYgKHN0YXRlLmxhc3QpIHsKICAgICAgICAgICAgLy8tLS0gQllURUJJVFMoKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gYml0cyAmIDc7CiAgICAgICAgICAgIGJpdHMgLT0gYml0cyAmIDc7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgc3RhdGUubW9kZSA9IENIRUNLOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAzKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5sYXN0ID0gKGhvbGQgJiAweDAxKS8qQklUUygxKSovOwogICAgICAgICAgLy8tLS0gRFJPUEJJVFMoMSkgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSAxOwogICAgICAgICAgYml0cyAtPSAxOwogICAgICAgICAgLy8tLS0vLwoKICAgICAgICAgIHN3aXRjaCAoKGhvbGQgJiAweDAzKS8qQklUUygyKSovKSB7CiAgICAgICAgICAgIGNhc2UgMDogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHN0b3JlZCBibG9jayAqLwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgc3RvcmVkIGJsb2NrJXNcbiIsCiAgICAgICAgICAgICAgLy8gICAgICAgIHN0YXRlLmxhc3QgPyAiIChsYXN0KSIgOiAiIikpOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBTVE9SRUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGZpeGVkIGJsb2NrICovCiAgICAgICAgICAgICAgZml4ZWR0YWJsZXMoc3RhdGUpOwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgZml4ZWQgY29kZXMgYmxvY2slc1xuIiwKICAgICAgICAgICAgICAvLyAgICAgICAgc3RhdGUubGFzdCA/ICIgKGxhc3QpIiA6ICIiKSk7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IExFTl87ICAgICAgICAgICAgIC8qIGRlY29kZSBjb2RlcyAqLwogICAgICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9UUkVFUykgewogICAgICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoMikgLS0tLy8KICAgICAgICAgICAgICAgIGhvbGQgPj4+PSAyOwogICAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZHluYW1pYyBibG9jayAqLwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgZHluYW1pYyBjb2RlcyBibG9jayVzXG4iLAogICAgICAgICAgICAgIC8vICAgICAgICBzdGF0ZS5sYXN0ID8gIiAobGFzdCkiIDogIiIpKTsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVEFCTEU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGJsb2NrIHR5cGUnOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICB9CiAgICAgICAgICAvLy0tLSBEUk9QQklUUygyKSAtLS0vLwogICAgICAgICAgaG9sZCA+Pj49IDI7CiAgICAgICAgICBiaXRzIC09IDI7CiAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFNUT1JFRDoKICAgICAgICAgIC8vLS0tIEJZVEVCSVRTKCkgLS0tLy8gLyogZ28gdG8gYnl0ZSBib3VuZGFyeSAqLwogICAgICAgICAgaG9sZCA+Pj49IGJpdHMgJiA3OwogICAgICAgICAgYml0cyAtPSBiaXRzICYgNzsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsgKi8KICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIGlmICgoaG9sZCAmIDB4ZmZmZikgIT09ICgoaG9sZCA+Pj4gMTYpIF4gMHhmZmZmKSkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIHN0b3JlZCBibG9jayBsZW5ndGhzJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5sZW5ndGggPSBob2xkICYgMHhmZmZmOwogICAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgIHN0b3JlZCBsZW5ndGggJXVcbiIsCiAgICAgICAgICAvLyAgICAgICAgc3RhdGUubGVuZ3RoKSk7CiAgICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIHN0YXRlLm1vZGUgPSBDT1BZXzsKICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9UUkVFUykgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIENPUFlfOgogICAgICAgICAgc3RhdGUubW9kZSA9IENPUFk7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBDT1BZOgogICAgICAgICAgY29weSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgIGlmIChjb3B5ID4gaGF2ZSkgeyBjb3B5ID0gaGF2ZTsgfQogICAgICAgICAgICBpZiAoY29weSA+IGxlZnQpIHsgY29weSA9IGxlZnQ7IH0KICAgICAgICAgICAgaWYgKGNvcHkgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIC8vLS0tIHptZW1jcHkocHV0LCBuZXh0LCBjb3B5KTsgLS0tCiAgICAgICAgICAgIG91dHB1dC5zZXQoaW5wdXQuc3ViYXJyYXkobmV4dCwgbmV4dCArIGNvcHkpLCBwdXQpOwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICBsZWZ0IC09IGNvcHk7CiAgICAgICAgICAgIHB1dCArPSBjb3B5OwogICAgICAgICAgICBzdGF0ZS5sZW5ndGggLT0gY29weTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgc3RvcmVkIGVuZFxuIikpOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgLy89PT0gTkVFREJJVFMoMTQpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNCkgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubmxlbiA9IChob2xkICYgMHgxZikvKkJJVFMoNSkqLyArIDI1NzsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDUpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLm5kaXN0ID0gKGhvbGQgJiAweDFmKS8qQklUUyg1KSovICsgMTsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDUpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLm5jb2RlID0gKGhvbGQgJiAweDBmKS8qQklUUyg0KSovICsgNDsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDQpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNDsKICAgICAgICAgIGJpdHMgLT0gNDsKICAgICAgICAgIC8vLS0tLy8KICAvLyNpZm5kZWYgUEtaSVBfQlVHX1dPUktBUk9VTkQKICAgICAgICAgIGlmIChzdGF0ZS5ubGVuID4gMjg2IHx8IHN0YXRlLm5kaXN0ID4gMzApIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAndG9vIG1hbnkgbGVuZ3RoIG9yIGRpc3RhbmNlIHN5bWJvbHMnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAvLyNlbmRpZgogICAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgIHRhYmxlIHNpemVzIG9rXG4iKSk7CiAgICAgICAgICBzdGF0ZS5oYXZlID0gMDsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5MRU5TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgTEVOTEVOUzoKICAgICAgICAgIHdoaWxlIChzdGF0ZS5oYXZlIDwgc3RhdGUubmNvZGUpIHsKICAgICAgICAgICAgLy89PT0gTkVFREJJVFMoMyk7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMykgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBzdGF0ZS5sZW5zW29yZGVyW3N0YXRlLmhhdmUrK11dID0gKGhvbGQgJiAweDA3KTsvL0JJVFMoMyk7CiAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDMpIC0tLS8vCiAgICAgICAgICAgIGhvbGQgPj4+PSAzOwogICAgICAgICAgICBiaXRzIC09IDM7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzdGF0ZS5oYXZlIDwgMTkpIHsKICAgICAgICAgICAgc3RhdGUubGVuc1tvcmRlcltzdGF0ZS5oYXZlKytdXSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBXZSBoYXZlIHNlcGFyYXRlIHRhYmxlcyAmIG5vIHBvaW50ZXJzLiAyIGNvbW1lbnRlZCBsaW5lcyBiZWxvdyBub3QgbmVlZGVkLgogICAgICAgICAgLy9zdGF0ZS5uZXh0ID0gc3RhdGUuY29kZXM7CiAgICAgICAgICAvL3N0YXRlLmxlbmNvZGUgPSBzdGF0ZS5uZXh0OwogICAgICAgICAgLy8gU3dpdGNoIHRvIHVzZSBkeW5hbWljIHRhYmxlCiAgICAgICAgICBzdGF0ZS5sZW5jb2RlID0gc3RhdGUubGVuZHluOwogICAgICAgICAgc3RhdGUubGVuYml0cyA9IDc7CgogICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUubGVuYml0cyB9OwogICAgICAgICAgcmV0ID0gaW5mdHJlZXMoQ09ERVMsIHN0YXRlLmxlbnMsIDAsIDE5LCBzdGF0ZS5sZW5jb2RlLCAwLCBzdGF0ZS53b3JrLCBvcHRzKTsKICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSBvcHRzLmJpdHM7CgogICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGNvZGUgbGVuZ3RocyBzZXQnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICBjb2RlIGxlbmd0aHMgb2tcbiIpKTsKICAgICAgICAgIHN0YXRlLmhhdmUgPSAwOwogICAgICAgICAgc3RhdGUubW9kZSA9IENPREVMRU5TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgQ09ERUxFTlM6CiAgICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IHN0YXRlLm5sZW4gKyBzdGF0ZS5uZGlzdCkgewogICAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbaG9sZCAmICgoMSA8PCBzdGF0ZS5sZW5iaXRzKSAtIDEpXTsvKkJJVFMoc3RhdGUubGVuYml0cykqLwogICAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICAgIGhlcmVfb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZjsKICAgICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiAweGZmZmY7CgogICAgICAgICAgICAgIGlmICgoaGVyZV9iaXRzKSA8PSBiaXRzKSB7IGJyZWFrOyB9CiAgICAgICAgICAgICAgLy8tLS0gUFVMTEJZVEUoKSAtLS0vLwogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA8IDE2KSB7CiAgICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoaGVyZS5iaXRzKSAtLS0vLwogICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGhlcmVfdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA9PT0gMTYpIHsKICAgICAgICAgICAgICAgIC8vPT09IE5FRURCSVRTKGhlcmUuYml0cyArIDIpOwogICAgICAgICAgICAgICAgbiA9IGhlcmVfYml0cyArIDI7CiAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgYml0IGxlbmd0aCByZXBlYXQnOwogICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxlbiA9IHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSAtIDFdOwogICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDB4MDMpOy8vQklUUygyKTsKICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDIpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gMjsKICAgICAgICAgICAgICAgIGJpdHMgLT0gMjsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAoaGVyZV92YWwgPT09IDE3KSB7CiAgICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyAzKTsKICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyAzOwogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDB4MDcpOy8vQklUUygzKTsKICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gMzsKICAgICAgICAgICAgICAgIGJpdHMgLT0gMzsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyA3KTsKICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyA3OwogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgICAgICAgY29weSA9IDExICsgKGhvbGQgJiAweDdmKTsvL0JJVFMoNyk7CiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyg3KSAtLS0vLwogICAgICAgICAgICAgICAgaG9sZCA+Pj49IDc7CiAgICAgICAgICAgICAgICBiaXRzIC09IDc7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlICsgY29weSA+IHN0YXRlLm5sZW4gKyBzdGF0ZS5uZGlzdCkgewogICAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCc7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHdoaWxlIChjb3B5LS0pIHsKICAgICAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGxlbjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYW5kbGUgZXJyb3IgYnJlYWtzIGluIHdoaWxlICovCiAgICAgICAgICBpZiAoc3RhdGUubW9kZSA9PT0gQkFEKSB7IGJyZWFrOyB9CgogICAgICAgICAgLyogY2hlY2sgZm9yIGVuZC1vZi1ibG9jayBjb2RlIChiZXR0ZXIgaGF2ZSBvbmUpICovCiAgICAgICAgICBpZiAoc3RhdGUubGVuc1syNTZdID09PSAwKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgY29kZSAtLSBtaXNzaW5nIGVuZC1vZi1ibG9jayc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIC8qIGJ1aWxkIGNvZGUgdGFibGVzIC0tIG5vdGU6IGRvIG5vdCBjaGFuZ2UgdGhlIGxlbmJpdHMgb3IgZGlzdGJpdHMKICAgICAgICAgICAgIHZhbHVlcyBoZXJlICg5IGFuZCA2KSB3aXRob3V0IHJlYWRpbmcgdGhlIGNvbW1lbnRzIGluIGluZnRyZWVzLmgKICAgICAgICAgICAgIGNvbmNlcm5pbmcgdGhlIEVOT1VHSCBjb25zdGFudHMsIHdoaWNoIGRlcGVuZCBvbiB0aG9zZSB2YWx1ZXMgKi8KICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSA5OwoKICAgICAgICAgIG9wdHMgPSB7IGJpdHM6IHN0YXRlLmxlbmJpdHMgfTsKICAgICAgICAgIHJldCA9IGluZnRyZWVzKExFTlMsIHN0YXRlLmxlbnMsIDAsIHN0YXRlLm5sZW4sIHN0YXRlLmxlbmNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgICAgLy8gV2UgaGF2ZSBzZXBhcmF0ZSB0YWJsZXMgJiBubyBwb2ludGVycy4gMiBjb21tZW50ZWQgbGluZXMgYmVsb3cgbm90IG5lZWRlZC4KICAgICAgICAgIC8vIHN0YXRlLm5leHRfaW5kZXggPSBvcHRzLnRhYmxlX2luZGV4OwogICAgICAgICAgc3RhdGUubGVuYml0cyA9IG9wdHMuYml0czsKICAgICAgICAgIC8vIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5uZXh0OwoKICAgICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBsaXRlcmFsL2xlbmd0aHMgc2V0JzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSA2OwogICAgICAgICAgLy9zdGF0ZS5kaXN0Y29kZS5jb3B5KHN0YXRlLmNvZGVzKTsKICAgICAgICAgIC8vIFN3aXRjaCB0byB1c2UgZHluYW1pYyB0YWJsZQogICAgICAgICAgc3RhdGUuZGlzdGNvZGUgPSBzdGF0ZS5kaXN0ZHluOwogICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUuZGlzdGJpdHMgfTsKICAgICAgICAgIHJldCA9IGluZnRyZWVzKERJU1RTLCBzdGF0ZS5sZW5zLCBzdGF0ZS5ubGVuLCBzdGF0ZS5uZGlzdCwgc3RhdGUuZGlzdGNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgICAgLy8gV2UgaGF2ZSBzZXBhcmF0ZSB0YWJsZXMgJiBubyBwb2ludGVycy4gMiBjb21tZW50ZWQgbGluZXMgYmVsb3cgbm90IG5lZWRlZC4KICAgICAgICAgIC8vIHN0YXRlLm5leHRfaW5kZXggPSBvcHRzLnRhYmxlX2luZGV4OwogICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgICAvLyBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLm5leHQ7CgogICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlcyBzZXQnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICdpbmZsYXRlOiAgICAgICBjb2RlcyBva1xuJykpOwogICAgICAgICAgc3RhdGUubW9kZSA9IExFTl87CiAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfVFJFRVMpIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBMRU5fOgogICAgICAgICAgc3RhdGUubW9kZSA9IExFTjsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIExFTjoKICAgICAgICAgIGlmIChoYXZlID49IDYgJiYgbGVmdCA+PSAyNTgpIHsKICAgICAgICAgICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgIC8vLS0tCiAgICAgICAgICAgIGluZmZhc3Qoc3RybSwgX291dCk7CiAgICAgICAgICAgIC8vLS0tIExPQUQoKSAtLS0KICAgICAgICAgICAgcHV0ID0gc3RybS5uZXh0X291dDsKICAgICAgICAgICAgb3V0cHV0ID0gc3RybS5vdXRwdXQ7CiAgICAgICAgICAgIGxlZnQgPSBzdHJtLmF2YWlsX291dDsKICAgICAgICAgICAgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgICAgICAgICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgICAgICAgICBoYXZlID0gc3RybS5hdmFpbF9pbjsKICAgICAgICAgICAgaG9sZCA9IHN0YXRlLmhvbGQ7CiAgICAgICAgICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgICAgICAgICAvLy0tLQoKICAgICAgICAgICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsKICAgICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5iYWNrID0gMDsKICAgICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbaG9sZCAmICgoMSA8PCBzdGF0ZS5sZW5iaXRzKSAtIDEpXTsgIC8qQklUUyhzdGF0ZS5sZW5iaXRzKSovCiAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICBoZXJlX29wID0gKGhlcmUgPj4+IDE2KSAmIDB4ZmY7CiAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgIGlmIChoZXJlX2JpdHMgPD0gYml0cykgeyBicmVhazsgfQogICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYmIChoZXJlX29wICYgMHhmMCkgPT09IDApIHsKICAgICAgICAgICAgbGFzdF9iaXRzID0gaGVyZV9iaXRzOwogICAgICAgICAgICBsYXN0X29wID0gaGVyZV9vcDsKICAgICAgICAgICAgbGFzdF92YWwgPSBoZXJlX3ZhbDsKICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2xhc3RfdmFsICsKICAgICAgICAgICAgICAgICAgICAgICgoaG9sZCAmICgoMSA8PCAobGFzdF9iaXRzICsgbGFzdF9vcCkpIC0gMSkpLypCSVRTKGxhc3QuYml0cyArIGxhc3Qub3ApKi8gPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgaGVyZV9vcCA9IChoZXJlID4+PiAxNikgJiAweGZmOwogICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgICAgaWYgKChsYXN0X2JpdHMgKyBoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMobGFzdC5iaXRzKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gbGFzdF9iaXRzOwogICAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGxhc3RfYml0czsKICAgICAgICAgIH0KICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gaGVyZV9iaXRzOwogICAgICAgICAgc3RhdGUubGVuZ3RoID0gaGVyZV92YWw7CiAgICAgICAgICBpZiAoaGVyZV9vcCA9PT0gMCkgewogICAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgaGVyZS52YWwgPj0gMHgyMCAmJiBoZXJlLnZhbCA8IDB4N2YgPwogICAgICAgICAgICAvLyAgICAgICAgImluZmxhdGU6ICAgICAgICAgbGl0ZXJhbCAnJWMnXG4iIDoKICAgICAgICAgICAgLy8gICAgICAgICJpbmZsYXRlOiAgICAgICAgIGxpdGVyYWwgMHglMDJ4XG4iLCBoZXJlLnZhbCkpOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTElUOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYgMzIpIHsKICAgICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGVuZCBvZiBibG9ja1xuIikpOwogICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYgNjQpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5leHRyYSA9IGhlcmVfb3AgJiAxNTsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5FWFQ7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBMRU5FWFQ6CiAgICAgICAgICBpZiAoc3RhdGUuZXh0cmEpIHsKICAgICAgICAgICAgLy89PT0gTkVFREJJVFMoc3RhdGUuZXh0cmEpOwogICAgICAgICAgICBuID0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBzdGF0ZS5sZW5ndGggKz0gaG9sZCAmICgoMSA8PCBzdGF0ZS5leHRyYSkgLSAxKS8qQklUUyhzdGF0ZS5leHRyYSkqLzsKICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoc3RhdGUuZXh0cmEpIC0tLS8vCiAgICAgICAgICAgIGhvbGQgPj4+PSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgYml0cyAtPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IHN0YXRlLmV4dHJhOwogICAgICAgICAgfQogICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGxlbmd0aCAldVxuIiwgc3RhdGUubGVuZ3RoKSk7CiAgICAgICAgICBzdGF0ZS53YXMgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRElTVDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERJU1Q6CiAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5kaXN0Y29kZVtob2xkICYgKCgxIDw8IHN0YXRlLmRpc3RiaXRzKSAtIDEpXTsvKkJJVFMoc3RhdGUuZGlzdGJpdHMpKi8KICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgIGhlcmVfb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZjsKICAgICAgICAgICAgaGVyZV92YWwgPSBoZXJlICYgMHhmZmZmOwoKICAgICAgICAgICAgaWYgKChoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgLy8tLS0gUFVMTEJZVEUoKSAtLS0vLwogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKGhlcmVfb3AgJiAweGYwKSA9PT0gMCkgewogICAgICAgICAgICBsYXN0X2JpdHMgPSBoZXJlX2JpdHM7CiAgICAgICAgICAgIGxhc3Rfb3AgPSBoZXJlX29wOwogICAgICAgICAgICBsYXN0X3ZhbCA9IGhlcmVfdmFsOwogICAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmRpc3Rjb2RlW2xhc3RfdmFsICsKICAgICAgICAgICAgICAgICAgICAgICgoaG9sZCAmICgoMSA8PCAobGFzdF9iaXRzICsgbGFzdF9vcCkpIC0gMSkpLypCSVRTKGxhc3QuYml0cyArIGxhc3Qub3ApKi8gPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgaGVyZV9vcCA9IChoZXJlID4+PiAxNikgJiAweGZmOwogICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgICAgaWYgKChsYXN0X2JpdHMgKyBoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMobGFzdC5iaXRzKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gbGFzdF9iaXRzOwogICAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGxhc3RfYml0czsKICAgICAgICAgIH0KICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gaGVyZV9iaXRzOwogICAgICAgICAgaWYgKGhlcmVfb3AgJiA2NCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIGNvZGUnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLm9mZnNldCA9IGhlcmVfdmFsOwogICAgICAgICAgc3RhdGUuZXh0cmEgPSAoaGVyZV9vcCkgJiAxNTsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBESVNURVhUOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgRElTVEVYVDoKICAgICAgICAgIGlmIChzdGF0ZS5leHRyYSkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUyhzdGF0ZS5leHRyYSk7CiAgICAgICAgICAgIG4gPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgIHN0YXRlLm9mZnNldCArPSBob2xkICYgKCgxIDw8IHN0YXRlLmV4dHJhKSAtIDEpLypCSVRTKHN0YXRlLmV4dHJhKSovOwogICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhzdGF0ZS5leHRyYSkgLS0tLy8KICAgICAgICAgICAgaG9sZCA+Pj49IHN0YXRlLmV4dHJhOwogICAgICAgICAgICBiaXRzIC09IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIHN0YXRlLmJhY2sgKz0gc3RhdGUuZXh0cmE7CiAgICAgICAgICB9CiAgLy8jaWZkZWYgSU5GTEFURV9TVFJJQ1QKICAgICAgICAgIGlmIChzdGF0ZS5vZmZzZXQgPiBzdGF0ZS5kbWF4KSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgICBkaXN0YW5jZSAldVxuIiwgc3RhdGUub2Zmc2V0KSk7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gTUFUQ0g7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBNQVRDSDoKICAgICAgICAgIGlmIChsZWZ0ID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgY29weSA9IF9vdXQgLSBsZWZ0OwogICAgICAgICAgaWYgKHN0YXRlLm9mZnNldCA+IGNvcHkpIHsgICAgICAgICAvKiBjb3B5IGZyb20gd2luZG93ICovCiAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5vZmZzZXQgLSBjb3B5OwogICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLndoYXZlKSB7CiAgICAgICAgICAgICAgaWYgKHN0YXRlLnNhbmUpIHsKICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgLy8gKCEpIFRoaXMgYmxvY2sgaXMgZGlzYWJsZWQgaW4gemxpYiBkZWZhdWx0cywKICAvLyBkb24ndCBlbmFibGUgaXQgZm9yIGJpbmFyeSBjb21wYXRpYmlsaXR5CiAgLy8jaWZkZWYgSU5GTEFURV9BTExPV19JTlZBTElEX0RJU1RBTkNFX1RPT0ZBUl9BUlJSCiAgLy8gICAgICAgICAgVHJhY2UoKHN0ZGVyciwgImluZmxhdGUuYyB0b28gZmFyXG4iKSk7CiAgLy8gICAgICAgICAgY29weSAtPSBzdGF0ZS53aGF2ZTsKICAvLyAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLmxlbmd0aCkgeyBjb3B5ID0gc3RhdGUubGVuZ3RoOyB9CiAgLy8gICAgICAgICAgaWYgKGNvcHkgPiBsZWZ0KSB7IGNvcHkgPSBsZWZ0OyB9CiAgLy8gICAgICAgICAgbGVmdCAtPSBjb3B5OwogIC8vICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogIC8vICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgIG91dHB1dFtwdXQrK10gPSAwOwogIC8vICAgICAgICAgIH0gd2hpbGUgKC0tY29weSk7CiAgLy8gICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCkgeyBzdGF0ZS5tb2RlID0gTEVOOyB9CiAgLy8gICAgICAgICAgYnJlYWs7CiAgLy8jZW5kaWYKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLnduZXh0KSB7CiAgICAgICAgICAgICAgY29weSAtPSBzdGF0ZS53bmV4dDsKICAgICAgICAgICAgICBmcm9tID0gc3RhdGUud3NpemUgLSBjb3B5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGZyb20gPSBzdGF0ZS53bmV4dCAtIGNvcHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvcHkgPiBzdGF0ZS5sZW5ndGgpIHsgY29weSA9IHN0YXRlLmxlbmd0aDsgfQogICAgICAgICAgICBmcm9tX3NvdXJjZSA9IHN0YXRlLndpbmRvdzsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGNvcHkgZnJvbSBvdXRwdXQgKi8KICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgIGZyb20gPSBwdXQgLSBzdGF0ZS5vZmZzZXQ7CiAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29weSA+IGxlZnQpIHsgY29weSA9IGxlZnQ7IH0KICAgICAgICAgIGxlZnQgLT0gY29weTsKICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogICAgICAgICAgZG8gewogICAgICAgICAgICBvdXRwdXRbcHV0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgIH0gd2hpbGUgKC0tY29weSk7CiAgICAgICAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKSB7IHN0YXRlLm1vZGUgPSBMRU47IH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgTElUOgogICAgICAgICAgaWYgKGxlZnQgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBvdXRwdXRbcHV0KytdID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgbGVmdC0tOwogICAgICAgICAgc3RhdGUubW9kZSA9IExFTjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQ0hFQ0s6CiAgICAgICAgICBpZiAoc3RhdGUud3JhcCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygzMik7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgLy8gVXNlICd8JyBpbnN0ZWFkIG9mICcrJyB0byBtYWtlIHN1cmUgdGhhdCByZXN1bHQgaXMgc2lnbmVkCiAgICAgICAgICAgICAgaG9sZCB8PSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgX291dCAtPSBsZWZ0OwogICAgICAgICAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgICAgICAgICBzdGF0ZS50b3RhbCArPSBfb3V0OwogICAgICAgICAgICBpZiAoX291dCkgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9CiAgICAgICAgICAgICAgICAgIC8qVVBEQVRFKHN0YXRlLmNoZWNrLCBwdXQgLSBfb3V0LCBfb3V0KTsqLwogICAgICAgICAgICAgICAgICAoc3RhdGUuZmxhZ3MgPyBjcmMzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHB1dCAtIF9vdXQpIDogYWRsZXIzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHB1dCAtIF9vdXQpKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX291dCA9IGxlZnQ7CiAgICAgICAgICAgIC8vIE5COiBjcmMzMiBzdG9yZWQgYXMgc2lnbmVkIDMyLWJpdCBpbnQsIHpzd2FwMzIgcmV0dXJucyBzaWduZWQgdG9vCiAgICAgICAgICAgIGlmICgoc3RhdGUuZmxhZ3MgPyBob2xkIDogenN3YXAzMihob2xkKSkgIT09IHN0YXRlLmNoZWNrKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW5jb3JyZWN0IGRhdGEgY2hlY2snOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgIGNoZWNrIG1hdGNoZXMgdHJhaWxlclxuIikpOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUubW9kZSA9IExFTkdUSDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIExFTkdUSDoKICAgICAgICAgIGlmIChzdGF0ZS53cmFwICYmIHN0YXRlLmZsYWdzKSB7CiAgICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsKICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBpZiAoaG9sZCAhPT0gKHN0YXRlLnRvdGFsICYgMHhmZmZmZmZmZikpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbmNvcnJlY3QgbGVuZ3RoIGNoZWNrJzsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICBsZW5ndGggbWF0Y2hlcyB0cmFpbGVyXG4iKSk7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRE9ORTsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERPTkU6CiAgICAgICAgICByZXQgPSBaX1NUUkVBTV9FTkQkMTsKICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICBjYXNlIEJBRDoKICAgICAgICAgIHJldCA9IFpfREFUQV9FUlJPUiQxOwogICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgIGNhc2UgTUVNOgogICAgICAgICAgcmV0dXJuIFpfTUVNX0VSUk9SJDE7CiAgICAgICAgY2FzZSBTWU5DOgogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgICAgfQogICAgfQoKICAgIC8vIGluZl9sZWF2ZSA8LSBoZXJlIGlzIHJlYWwgcGxhY2UgZm9yICJnb3RvIGluZl9sZWF2ZSIsIGVtdWxhdGVkIHZpYSAiYnJlYWsgaW5mX2xlYXZlIgoKICAgIC8qCiAgICAgICBSZXR1cm4gZnJvbSBpbmZsYXRlKCksIHVwZGF0aW5nIHRoZSB0b3RhbCBjb3VudHMgYW5kIHRoZSBjaGVjayB2YWx1ZS4KICAgICAgIElmIHRoZXJlIHdhcyBubyBwcm9ncmVzcyBkdXJpbmcgdGhlIGluZmxhdGUoKSBjYWxsLCByZXR1cm4gYSBidWZmZXIKICAgICAgIGVycm9yLiAgQ2FsbCB1cGRhdGV3aW5kb3coKSB0byBjcmVhdGUgYW5kL29yIHVwZGF0ZSB0aGUgd2luZG93IHN0YXRlLgogICAgICAgTm90ZTogYSBtZW1vcnkgZXJyb3IgZnJvbSBpbmZsYXRlKCkgaXMgbm9uLXJlY292ZXJhYmxlLgogICAgICovCgogICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgc3RybS5uZXh0X291dCA9IHB1dDsKICAgIHN0cm0uYXZhaWxfb3V0ID0gbGVmdDsKICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICBzdHJtLmF2YWlsX2luID0gaGF2ZTsKICAgIHN0YXRlLmhvbGQgPSBob2xkOwogICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAvLy0tLQoKICAgIGlmIChzdGF0ZS53c2l6ZSB8fCAoX291dCAhPT0gc3RybS5hdmFpbF9vdXQgJiYgc3RhdGUubW9kZSA8IEJBRCAmJgogICAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubW9kZSA8IENIRUNLIHx8IGZsdXNoICE9PSBaX0ZJTklTSCQxKSkpIHsKICAgICAgaWYgKHVwZGF0ZXdpbmRvdyhzdHJtLCBzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCwgX291dCAtIHN0cm0uYXZhaWxfb3V0KSkgOwogICAgfQogICAgX2luIC09IHN0cm0uYXZhaWxfaW47CiAgICBfb3V0IC09IHN0cm0uYXZhaWxfb3V0OwogICAgc3RybS50b3RhbF9pbiArPSBfaW47CiAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgc3RhdGUudG90YWwgKz0gX291dDsKICAgIGlmIChzdGF0ZS53cmFwICYmIF9vdXQpIHsKICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gLypVUERBVEUoc3RhdGUuY2hlY2ssIHN0cm0ubmV4dF9vdXQgLSBfb3V0LCBfb3V0KTsqLwogICAgICAgIChzdGF0ZS5mbGFncyA/IGNyYzMyXzEoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgc3RybS5uZXh0X291dCAtIF9vdXQpIDogYWRsZXIzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHN0cm0ubmV4dF9vdXQgLSBfb3V0KSk7CiAgICB9CiAgICBzdHJtLmRhdGFfdHlwZSA9IHN0YXRlLmJpdHMgKyAoc3RhdGUubGFzdCA/IDY0IDogMCkgKwogICAgICAgICAgICAgICAgICAgICAgKHN0YXRlLm1vZGUgPT09IFRZUEUgPyAxMjggOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubW9kZSA9PT0gTEVOXyB8fCBzdGF0ZS5tb2RlID09PSBDT1BZXyA/IDI1NiA6IDApOwogICAgaWYgKCgoX2luID09PSAwICYmIF9vdXQgPT09IDApIHx8IGZsdXNoID09PSBaX0ZJTklTSCQxKSAmJiByZXQgPT09IFpfT0skMSkgewogICAgICByZXQgPSBaX0JVRl9FUlJPUjsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVFbmQgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSAvKnx8IHN0cm0tPnpmcmVlID09IChmcmVlX2Z1bmMpMCovKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogICAgfQoKICAgIGxldCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICBpZiAoc3RhdGUud2luZG93KSB7CiAgICAgIHN0YXRlLndpbmRvdyA9IG51bGw7CiAgICB9CiAgICBzdHJtLnN0YXRlID0gbnVsbDsKICAgIHJldHVybiBaX09LJDE7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVHZXRIZWFkZXIgPSAoc3RybSwgaGVhZCkgPT4gewoKICAgIC8qIGNoZWNrIHN0YXRlICovCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KICAgIGNvbnN0IHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIGlmICgoc3RhdGUud3JhcCAmIDIpID09PSAwKSB7IHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOyB9CgogICAgLyogc2F2ZSBoZWFkZXIgc3RydWN0dXJlICovCiAgICBzdGF0ZS5oZWFkID0gaGVhZDsKICAgIGhlYWQuZG9uZSA9IGZhbHNlOwogICAgcmV0dXJuIFpfT0skMTsKICB9OwoKCiAgY29uc3QgaW5mbGF0ZVNldERpY3Rpb25hcnkgPSAoc3RybSwgZGljdGlvbmFyeSkgPT4gewogICAgY29uc3QgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwoKICAgIGxldCBzdGF0ZTsKICAgIGxldCBkaWN0aWQ7CiAgICBsZXQgcmV0OwoKICAgIC8qIGNoZWNrIHN0YXRlICovCiAgICBpZiAoIXN0cm0gLyogPT0gWl9OVUxMICovIHx8ICFzdHJtLnN0YXRlIC8qID09IFpfTlVMTCAqLykgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIGlmIChzdGF0ZS53cmFwICE9PSAwICYmIHN0YXRlLm1vZGUgIT09IERJQ1QpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CgogICAgLyogY2hlY2sgZm9yIGNvcnJlY3QgZGljdGlvbmFyeSBpZGVudGlmaWVyICovCiAgICBpZiAoc3RhdGUubW9kZSA9PT0gRElDVCkgewogICAgICBkaWN0aWQgPSAxOyAvKiBhZGxlcjMyKDAsIG51bGwsIDApKi8KICAgICAgLyogZGljdGlkID0gYWRsZXIzMihkaWN0aWQsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgpOyAqLwogICAgICBkaWN0aWQgPSBhZGxlcjMyXzEoZGljdGlkLCBkaWN0aW9uYXJ5LCBkaWN0TGVuZ3RoLCAwKTsKICAgICAgaWYgKGRpY3RpZCAhPT0gc3RhdGUuY2hlY2spIHsKICAgICAgICByZXR1cm4gWl9EQVRBX0VSUk9SJDE7CiAgICAgIH0KICAgIH0KICAgIC8qIGNvcHkgZGljdGlvbmFyeSB0byB3aW5kb3cgdXNpbmcgdXBkYXRld2luZG93KCksIHdoaWNoIHdpbGwgYW1lbmQgdGhlCiAgICAgZXhpc3RpbmcgZGljdGlvbmFyeSBpZiBhcHByb3ByaWF0ZSAqLwogICAgcmV0ID0gdXBkYXRld2luZG93KHN0cm0sIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIGRpY3RMZW5ndGgpOwogICAgaWYgKHJldCkgewogICAgICBzdGF0ZS5tb2RlID0gTUVNOwogICAgICByZXR1cm4gWl9NRU1fRVJST1IkMTsKICAgIH0KICAgIHN0YXRlLmhhdmVkaWN0ID0gMTsKICAgIC8vIFRyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICBkaWN0aW9uYXJ5IHNldFxuIikpOwogICAgcmV0dXJuIFpfT0skMTsKICB9OwoKCiAgdmFyIGluZmxhdGVSZXNldF8xID0gaW5mbGF0ZVJlc2V0OwogIHZhciBpbmZsYXRlUmVzZXQyXzEgPSBpbmZsYXRlUmVzZXQyOwogIHZhciBpbmZsYXRlUmVzZXRLZWVwXzEgPSBpbmZsYXRlUmVzZXRLZWVwOwogIHZhciBpbmZsYXRlSW5pdF8xID0gaW5mbGF0ZUluaXQ7CiAgdmFyIGluZmxhdGVJbml0Ml8xID0gaW5mbGF0ZUluaXQyOwogIHZhciBpbmZsYXRlXzIkMSA9IGluZmxhdGUkMjsKICB2YXIgaW5mbGF0ZUVuZF8xID0gaW5mbGF0ZUVuZDsKICB2YXIgaW5mbGF0ZUdldEhlYWRlcl8xID0gaW5mbGF0ZUdldEhlYWRlcjsKICB2YXIgaW5mbGF0ZVNldERpY3Rpb25hcnlfMSA9IGluZmxhdGVTZXREaWN0aW9uYXJ5OwogIHZhciBpbmZsYXRlSW5mbyA9ICdwYWtvIGluZmxhdGUgKGZyb20gTm9kZWNhIHByb2plY3QpJzsKCiAgLyogTm90IGltcGxlbWVudGVkCiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZUNvcHkgPSBpbmZsYXRlQ29weTsKICBtb2R1bGUuZXhwb3J0cy5pbmZsYXRlR2V0RGljdGlvbmFyeSA9IGluZmxhdGVHZXREaWN0aW9uYXJ5OwogIG1vZHVsZS5leHBvcnRzLmluZmxhdGVNYXJrID0gaW5mbGF0ZU1hcms7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVByaW1lID0gaW5mbGF0ZVByaW1lOwogIG1vZHVsZS5leHBvcnRzLmluZmxhdGVTeW5jID0gaW5mbGF0ZVN5bmM7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVN5bmNQb2ludCA9IGluZmxhdGVTeW5jUG9pbnQ7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVVuZGVybWluZSA9IGluZmxhdGVVbmRlcm1pbmU7CiAgKi8KCiAgdmFyIGluZmxhdGVfMSQyID0gewogIAlpbmZsYXRlUmVzZXQ6IGluZmxhdGVSZXNldF8xLAogIAlpbmZsYXRlUmVzZXQyOiBpbmZsYXRlUmVzZXQyXzEsCiAgCWluZmxhdGVSZXNldEtlZXA6IGluZmxhdGVSZXNldEtlZXBfMSwKICAJaW5mbGF0ZUluaXQ6IGluZmxhdGVJbml0XzEsCiAgCWluZmxhdGVJbml0MjogaW5mbGF0ZUluaXQyXzEsCiAgCWluZmxhdGU6IGluZmxhdGVfMiQxLAogIAlpbmZsYXRlRW5kOiBpbmZsYXRlRW5kXzEsCiAgCWluZmxhdGVHZXRIZWFkZXI6IGluZmxhdGVHZXRIZWFkZXJfMSwKICAJaW5mbGF0ZVNldERpY3Rpb25hcnk6IGluZmxhdGVTZXREaWN0aW9uYXJ5XzEsCiAgCWluZmxhdGVJbmZvOiBpbmZsYXRlSW5mbwogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICBmdW5jdGlvbiBHWmhlYWRlcigpIHsKICAgIC8qIHRydWUgaWYgY29tcHJlc3NlZCBkYXRhIGJlbGlldmVkIHRvIGJlIHRleHQgKi8KICAgIHRoaXMudGV4dCAgICAgICA9IDA7CiAgICAvKiBtb2RpZmljYXRpb24gdGltZSAqLwogICAgdGhpcy50aW1lICAgICAgID0gMDsKICAgIC8qIGV4dHJhIGZsYWdzIChub3QgdXNlZCB3aGVuIHdyaXRpbmcgYSBnemlwIGZpbGUpICovCiAgICB0aGlzLnhmbGFncyAgICAgPSAwOwogICAgLyogb3BlcmF0aW5nIHN5c3RlbSAqLwogICAgdGhpcy5vcyAgICAgICAgID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gZXh0cmEgZmllbGQgb3IgWl9OVUxMIGlmIG5vbmUgKi8KICAgIHRoaXMuZXh0cmEgICAgICA9IG51bGw7CiAgICAvKiBleHRyYSBmaWVsZCBsZW5ndGggKHZhbGlkIGlmIGV4dHJhICE9IFpfTlVMTCkgKi8KICAgIHRoaXMuZXh0cmFfbGVuICA9IDA7IC8vIEFjdHVhbGx5LCB3ZSBkb24ndCBuZWVkIGl0IGluIEpTLAogICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnV0IGxlYXZlIGZvciBmZXcgY29kZSBtb2RpZmljYXRpb25zCgogICAgLy8KICAgIC8vIFNldHVwIGxpbWl0cyBpcyBub3QgbmVjZXNzYXJ5IGJlY2F1c2UgaW4ganMgd2Ugc2hvdWxkIG5vdCBwcmVhbGxvY2F0ZSBtZW1vcnkKICAgIC8vIGZvciBpbmZsYXRlIHVzZSBjb25zdGFudCBsaW1pdCBpbiA2NTUzNiBieXRlcwogICAgLy8KCiAgICAvKiBzcGFjZSBhdCBleHRyYSAob25seSB3aGVuIHJlYWRpbmcgaGVhZGVyKSAqLwogICAgLy8gdGhpcy5leHRyYV9tYXggID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gemVyby10ZXJtaW5hdGVkIGZpbGUgbmFtZSBvciBaX05VTEwgKi8KICAgIHRoaXMubmFtZSAgICAgICA9ICcnOwogICAgLyogc3BhY2UgYXQgbmFtZSAob25seSB3aGVuIHJlYWRpbmcgaGVhZGVyKSAqLwogICAgLy8gdGhpcy5uYW1lX21heCAgID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gemVyby10ZXJtaW5hdGVkIGNvbW1lbnQgb3IgWl9OVUxMICovCiAgICB0aGlzLmNvbW1lbnQgICAgPSAnJzsKICAgIC8qIHNwYWNlIGF0IGNvbW1lbnQgKG9ubHkgd2hlbiByZWFkaW5nIGhlYWRlcikgKi8KICAgIC8vIHRoaXMuY29tbV9tYXggICA9IDA7CiAgICAvKiB0cnVlIGlmIHRoZXJlIHdhcyBvciB3aWxsIGJlIGEgaGVhZGVyIGNyYyAqLwogICAgdGhpcy5oY3JjICAgICAgID0gMDsKICAgIC8qIHRydWUgd2hlbiBkb25lIHJlYWRpbmcgZ3ppcCBoZWFkZXIgKG5vdCB1c2VkIHdoZW4gd3JpdGluZyBhIGd6aXAgZmlsZSkgKi8KICAgIHRoaXMuZG9uZSAgICAgICA9IGZhbHNlOwogIH0KCiAgdmFyIGd6aGVhZGVyID0gR1poZWFkZXI7CgogIGNvbnN0IHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKICBjb25zdCB7CiAgICBaX05PX0ZMVVNILCBaX0ZJTklTSCwKICAgIFpfT0ssIFpfU1RSRUFNX0VORCwgWl9ORUVEX0RJQ1QsIFpfU1RSRUFNX0VSUk9SLCBaX0RBVEFfRVJST1IsIFpfTUVNX0VSUk9SCiAgfSA9IGNvbnN0YW50cyQyOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLyoqCiAgICogY2xhc3MgSW5mbGF0ZQogICAqCiAgICogR2VuZXJpYyBKUy1zdHlsZSB3cmFwcGVyIGZvciB6bGliIGNhbGxzLiBJZiB5b3UgZG9uJ3QgbmVlZAogICAqIHN0cmVhbWluZyBiZWhhdmlvdXIgLSB1c2UgbW9yZSBzaW1wbGUgZnVuY3Rpb25zOiBbW2luZmxhdGVdXQogICAqIGFuZCBbW2luZmxhdGVSYXddXS4KICAgKiovCgogIC8qIGludGVybmFsCiAgICogaW5mbGF0ZS5jaHVua3MgLT4gQXJyYXkKICAgKgogICAqIENodW5rcyBvZiBvdXRwdXQgZGF0YSwgaWYgW1tJbmZsYXRlI29uRGF0YV1dIG5vdCBvdmVycmlkZGVuLgogICAqKi8KCiAgLyoqCiAgICogSW5mbGF0ZS5yZXN1bHQgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKgogICAqIFVuY29tcHJlc3NlZCByZXN1bHQsIGdlbmVyYXRlZCBieSBkZWZhdWx0IFtbSW5mbGF0ZSNvbkRhdGFdXQogICAqIGFuZCBbW0luZmxhdGUjb25FbmRdXSBoYW5kbGVycy4gRmlsbGVkIGFmdGVyIHlvdSBwdXNoIGxhc3QgY2h1bmsKICAgKiAoY2FsbCBbW0luZmxhdGUjcHVzaF1dIHdpdGggYFpfRklOSVNIYCAvIGB0cnVlYCBwYXJhbSkuCiAgICoqLwoKICAvKioKICAgKiBJbmZsYXRlLmVyciAtPiBOdW1iZXIKICAgKgogICAqIEVycm9yIGNvZGUgYWZ0ZXIgaW5mbGF0ZSBmaW5pc2hlZC4gMCAoWl9PSykgb24gc3VjY2Vzcy4KICAgKiBTaG91bGQgYmUgY2hlY2tlZCBpZiBicm9rZW4gZGF0YSBwb3NzaWJsZS4KICAgKiovCgogIC8qKgogICAqIEluZmxhdGUubXNnIC0+IFN0cmluZwogICAqCiAgICogRXJyb3IgbWVzc2FnZSwgaWYgW1tJbmZsYXRlLmVycl1dICE9IDAKICAgKiovCgoKICAvKioKICAgKiBuZXcgSW5mbGF0ZShvcHRpb25zKQogICAqIC0gb3B0aW9ucyAoT2JqZWN0KTogemxpYiBpbmZsYXRlIG9wdGlvbnMuCiAgICoKICAgKiBDcmVhdGVzIG5ldyBpbmZsYXRvciBpbnN0YW5jZSB3aXRoIHNwZWNpZmllZCBwYXJhbXMuIFRocm93cyBleGNlcHRpb24KICAgKiBvbiBiYWQgcGFyYW1zLiBTdXBwb3J0ZWQgb3B0aW9uczoKICAgKgogICAqIC0gYHdpbmRvd0JpdHNgCiAgICogLSBgZGljdGlvbmFyeWAKICAgKgogICAqIFtodHRwOi8vemxpYi5uZXQvbWFudWFsLmh0bWwjQWR2YW5jZWRdKGh0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZCkKICAgKiBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGVzZS4KICAgKgogICAqIEFkZGl0aW9uYWwgb3B0aW9ucywgZm9yIGludGVybmFsIG5lZWRzOgogICAqCiAgICogLSBgY2h1bmtTaXplYCAtIHNpemUgb2YgZ2VuZXJhdGVkIGRhdGEgY2h1bmtzICgxNksgYnkgZGVmYXVsdCkKICAgKiAtIGByYXdgIChCb29sZWFuKSAtIGRvIHJhdyBpbmZsYXRlCiAgICogLSBgdG9gIChTdHJpbmcpIC0gaWYgZXF1YWwgdG8gJ3N0cmluZycsIHRoZW4gcmVzdWx0IHdpbGwgYmUgY29udmVydGVkCiAgICogICBmcm9tIHV0ZjggdG8gdXRmMTYgKGphdmFzY3JpcHQpIHN0cmluZy4gV2hlbiBzdHJpbmcgb3V0cHV0IHJlcXVlc3RlZCwKICAgKiAgIGNodW5rIGxlbmd0aCBjYW4gZGlmZmVyIGZyb20gYGNodW5rU2l6ZWAsIGRlcGVuZGluZyBvbiBjb250ZW50LgogICAqCiAgICogQnkgZGVmYXVsdCwgd2hlbiBubyBvcHRpb25zIHNldCwgYXV0b2RldGVjdCBkZWZsYXRlL2d6aXAgZGF0YSBmb3JtYXQgdmlhCiAgICogd3JhcHBlciBoZWFkZXIuCiAgICoKICAgKiAjIyMjIyBFeGFtcGxlOgogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIGNvbnN0IHBha28gPSByZXF1aXJlKCdwYWtvJykKICAgKiBjb25zdCBjaHVuazEgPSBuZXcgVWludDhBcnJheShbMSwyLDMsNCw1LDYsNyw4LDldKQogICAqIGNvbnN0IGNodW5rMiA9IG5ldyBVaW50OEFycmF5KFsxMCwxMSwxMiwxMywxNCwxNSwxNiwxNywxOCwxOV0pOwogICAqCiAgICogY29uc3QgaW5mbGF0ZSA9IG5ldyBwYWtvLkluZmxhdGUoeyBsZXZlbDogM30pOwogICAqCiAgICogaW5mbGF0ZS5wdXNoKGNodW5rMSwgZmFsc2UpOwogICAqIGluZmxhdGUucHVzaChjaHVuazIsIHRydWUpOyAgLy8gdHJ1ZSAtPiBsYXN0IGNodW5rCiAgICoKICAgKiBpZiAoaW5mbGF0ZS5lcnIpIHsgdGhyb3cgbmV3IEVycm9yKGluZmxhdGUuZXJyKTsgfQogICAqCiAgICogY29uc29sZS5sb2coaW5mbGF0ZS5yZXN1bHQpOwogICAqIGBgYAogICAqKi8KICBmdW5jdGlvbiBJbmZsYXRlJDEob3B0aW9ucykgewogICAgdGhpcy5vcHRpb25zID0gY29tbW9uLmFzc2lnbih7CiAgICAgIGNodW5rU2l6ZTogMTAyNCAqIDY0LAogICAgICB3aW5kb3dCaXRzOiAxNSwKICAgICAgdG86ICcnCiAgICB9LCBvcHRpb25zIHx8IHt9KTsKCiAgICBjb25zdCBvcHQgPSB0aGlzLm9wdGlvbnM7CgogICAgLy8gRm9yY2Ugd2luZG93IHNpemUgZm9yIGByYXdgIGRhdGEsIGlmIG5vdCBzZXQgZGlyZWN0bHksCiAgICAvLyBiZWNhdXNlIHdlIGhhdmUgbm8gaGVhZGVyIGZvciBhdXRvZGV0ZWN0LgogICAgaWYgKG9wdC5yYXcgJiYgKG9wdC53aW5kb3dCaXRzID49IDApICYmIChvcHQud2luZG93Qml0cyA8IDE2KSkgewogICAgICBvcHQud2luZG93Qml0cyA9IC1vcHQud2luZG93Qml0czsKICAgICAgaWYgKG9wdC53aW5kb3dCaXRzID09PSAwKSB7IG9wdC53aW5kb3dCaXRzID0gLTE1OyB9CiAgICB9CgogICAgLy8gSWYgYHdpbmRvd0JpdHNgIG5vdCBkZWZpbmVkIChhbmQgbW9kZSBub3QgcmF3KSAtIHNldCBhdXRvZGV0ZWN0IGZsYWcgZm9yIGd6aXAvZGVmbGF0ZQogICAgaWYgKChvcHQud2luZG93Qml0cyA+PSAwKSAmJiAob3B0LndpbmRvd0JpdHMgPCAxNikgJiYKICAgICAgICAhKG9wdGlvbnMgJiYgb3B0aW9ucy53aW5kb3dCaXRzKSkgewogICAgICBvcHQud2luZG93Qml0cyArPSAzMjsKICAgIH0KCiAgICAvLyBHemlwIGhlYWRlciBoYXMgbm8gaW5mbyBhYm91dCB3aW5kb3dzIHNpemUsIHdlIGNhbiBkbyBhdXRvZGV0ZWN0IG9ubHkKICAgIC8vIGZvciBkZWZsYXRlLiBTbywgaWYgd2luZG93IHNpemUgbm90IHNldCwgZm9yY2UgaXQgdG8gbWF4IHdoZW4gZ3ppcCBwb3NzaWJsZQogICAgaWYgKChvcHQud2luZG93Qml0cyA+IDE1KSAmJiAob3B0LndpbmRvd0JpdHMgPCA0OCkpIHsKICAgICAgLy8gYml0IDMgKDE2KSAtPiBnemlwcGVkIGRhdGEKICAgICAgLy8gYml0IDQgKDMyKSAtPiBhdXRvZGV0ZWN0IGd6aXAvZGVmbGF0ZQogICAgICBpZiAoKG9wdC53aW5kb3dCaXRzICYgMTUpID09PSAwKSB7CiAgICAgICAgb3B0LndpbmRvd0JpdHMgfD0gMTU7CiAgICAgIH0KICAgIH0KCiAgICB0aGlzLmVyciAgICA9IDA7ICAgICAgLy8gZXJyb3IgY29kZSwgaWYgaGFwcGVucyAoMCA9IFpfT0spCiAgICB0aGlzLm1zZyAgICA9ICcnOyAgICAgLy8gZXJyb3IgbWVzc2FnZQogICAgdGhpcy5lbmRlZCAgPSBmYWxzZTsgIC8vIHVzZWQgdG8gYXZvaWQgbXVsdGlwbGUgb25FbmQoKSBjYWxscwogICAgdGhpcy5jaHVua3MgPSBbXTsgICAgIC8vIGNodW5rcyBvZiBjb21wcmVzc2VkIGRhdGEKCiAgICB0aGlzLnN0cm0gICA9IG5ldyB6c3RyZWFtKCk7CiAgICB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKCiAgICBsZXQgc3RhdHVzICA9IGluZmxhdGVfMSQyLmluZmxhdGVJbml0MigKICAgICAgdGhpcy5zdHJtLAogICAgICBvcHQud2luZG93Qml0cwogICAgKTsKCiAgICBpZiAoc3RhdHVzICE9PSBaX09LKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlc1tzdGF0dXNdKTsKICAgIH0KCiAgICB0aGlzLmhlYWRlciA9IG5ldyBnemhlYWRlcigpOwoKICAgIGluZmxhdGVfMSQyLmluZmxhdGVHZXRIZWFkZXIodGhpcy5zdHJtLCB0aGlzLmhlYWRlcik7CgogICAgLy8gU2V0dXAgZGljdGlvbmFyeQogICAgaWYgKG9wdC5kaWN0aW9uYXJ5KSB7CiAgICAgIC8vIENvbnZlcnQgZGF0YSBpZiBuZWVkZWQKICAgICAgaWYgKHR5cGVvZiBvcHQuZGljdGlvbmFyeSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBvcHQuZGljdGlvbmFyeSA9IHN0cmluZ3Muc3RyaW5nMmJ1ZihvcHQuZGljdGlvbmFyeSk7CiAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvcHQuZGljdGlvbmFyeSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgICBvcHQuZGljdGlvbmFyeSA9IG5ldyBVaW50OEFycmF5KG9wdC5kaWN0aW9uYXJ5KTsKICAgICAgfQogICAgICBpZiAob3B0LnJhdykgeyAvL0luIHJhdyBtb2RlIHdlIG5lZWQgdG8gc2V0IHRoZSBkaWN0aW9uYXJ5IGVhcmx5CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBvcHQuZGljdGlvbmFyeSk7CiAgICAgICAgaWYgKHN0YXR1cyAhPT0gWl9PSykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2VzW3N0YXR1c10pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogSW5mbGF0ZSNwdXNoKGRhdGFbLCBmbHVzaF9tb2RlXSkgLT4gQm9vbGVhbgogICAqIC0gZGF0YSAoVWludDhBcnJheXxBcnJheUJ1ZmZlcik6IGlucHV0IGRhdGEKICAgKiAtIGZsdXNoX21vZGUgKE51bWJlcnxCb29sZWFuKTogMC4uNiBmb3IgY29ycmVzcG9uZGluZyBaX05PX0ZMVVNILi5aX1RSRUUKICAgKiAgIGZsdXNoIG1vZGVzLiBTZWUgY29uc3RhbnRzLiBTa2lwcGVkIG9yIGBmYWxzZWAgbWVhbnMgWl9OT19GTFVTSCwKICAgKiAgIGB0cnVlYCBtZWFucyBaX0ZJTklTSC4KICAgKgogICAqIFNlbmRzIGlucHV0IGRhdGEgdG8gaW5mbGF0ZSBwaXBlLCBnZW5lcmF0aW5nIFtbSW5mbGF0ZSNvbkRhdGFdXSBjYWxscyB3aXRoCiAgICogbmV3IG91dHB1dCBjaHVua3MuIFJldHVybnMgYHRydWVgIG9uIHN1Y2Nlc3MuIElmIGVuZCBvZiBzdHJlYW0gZGV0ZWN0ZWQsCiAgICogW1tJbmZsYXRlI29uRW5kXV0gd2lsbCBiZSBjYWxsZWQuCiAgICoKICAgKiBgZmx1c2hfbW9kZWAgaXMgbm90IG5lZWRlZCBmb3Igbm9ybWFsIG9wZXJhdGlvbiwgYmVjYXVzZSBlbmQgb2Ygc3RyZWFtCiAgICogZGV0ZWN0ZWQgYXV0b21hdGljYWxseS4gWW91IG1heSB0cnkgdG8gdXNlIGl0IGZvciBhZHZhbmNlZCB0aGluZ3MsIGJ1dAogICAqIHRoaXMgZnVuY3Rpb25hbGl0eSB3YXMgbm90IHRlc3RlZC4KICAgKgogICAqIE9uIGZhaWwgY2FsbCBbW0luZmxhdGUjb25FbmRdXSB3aXRoIGVycm9yIGNvZGUgYW5kIHJldHVybiBmYWxzZS4KICAgKgogICAqICMjIyMjIEV4YW1wbGUKICAgKgogICAqIGBgYGphdmFzY3JpcHQKICAgKiBwdXNoKGNodW5rLCBmYWxzZSk7IC8vIHB1c2ggb25lIG9mIGRhdGEgY2h1bmtzCiAgICogLi4uCiAgICogcHVzaChjaHVuaywgdHJ1ZSk7ICAvLyBwdXNoIGxhc3QgY2h1bmsKICAgKiBgYGAKICAgKiovCiAgSW5mbGF0ZSQxLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGRhdGEsIGZsdXNoX21vZGUpIHsKICAgIGNvbnN0IHN0cm0gPSB0aGlzLnN0cm07CiAgICBjb25zdCBjaHVua1NpemUgPSB0aGlzLm9wdGlvbnMuY2h1bmtTaXplOwogICAgY29uc3QgZGljdGlvbmFyeSA9IHRoaXMub3B0aW9ucy5kaWN0aW9uYXJ5OwogICAgbGV0IHN0YXR1cywgX2ZsdXNoX21vZGUsIGxhc3RfYXZhaWxfb3V0OwoKICAgIGlmICh0aGlzLmVuZGVkKSByZXR1cm4gZmFsc2U7CgogICAgaWYgKGZsdXNoX21vZGUgPT09IH5+Zmx1c2hfbW9kZSkgX2ZsdXNoX21vZGUgPSBmbHVzaF9tb2RlOwogICAgZWxzZSBfZmx1c2hfbW9kZSA9IGZsdXNoX21vZGUgPT09IHRydWUgPyBaX0ZJTklTSCA6IFpfTk9fRkxVU0g7CgogICAgLy8gQ29udmVydCBkYXRhIGlmIG5lZWRlZAogICAgaWYgKHRvU3RyaW5nLmNhbGwoZGF0YSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgc3RybS5pbnB1dCA9IGRhdGE7CiAgICB9CgogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uYXZhaWxfaW4gPSBzdHJtLmlucHV0Lmxlbmd0aDsKCiAgICBmb3IgKDs7KSB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmtTaXplKTsKICAgICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZTsKICAgICAgfQoKICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZShzdHJtLCBfZmx1c2hfbW9kZSk7CgogICAgICBpZiAoc3RhdHVzID09PSBaX05FRURfRElDVCAmJiBkaWN0aW9uYXJ5KSB7CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZVNldERpY3Rpb25hcnkoc3RybSwgZGljdGlvbmFyeSk7CgogICAgICAgIGlmIChzdGF0dXMgPT09IFpfT0spIHsKICAgICAgICAgIHN0YXR1cyA9IGluZmxhdGVfMSQyLmluZmxhdGUoc3RybSwgX2ZsdXNoX21vZGUpOwogICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSBaX0RBVEFfRVJST1IpIHsKICAgICAgICAgIC8vIFJlcGxhY2UgY29kZSB3aXRoIG1vcmUgdmVyYm9zZQogICAgICAgICAgc3RhdHVzID0gWl9ORUVEX0RJQ1Q7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBTa2lwIHNueWMgbWFya2VycyBpZiBtb3JlIGRhdGEgZm9sbG93cyBhbmQgbm90IHJhdyBtb2RlCiAgICAgIHdoaWxlIChzdHJtLmF2YWlsX2luID4gMCAmJgogICAgICAgICAgICAgc3RhdHVzID09PSBaX1NUUkVBTV9FTkQgJiYKICAgICAgICAgICAgIHN0cm0uc3RhdGUud3JhcCA+IDAgJiYKICAgICAgICAgICAgIGRhdGFbc3RybS5uZXh0X2luXSAhPT0gMCkKICAgICAgewogICAgICAgIGluZmxhdGVfMSQyLmluZmxhdGVSZXNldChzdHJtKTsKICAgICAgICBzdGF0dXMgPSBpbmZsYXRlXzEkMi5pbmZsYXRlKHN0cm0sIF9mbHVzaF9tb2RlKTsKICAgICAgfQoKICAgICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICBjYXNlIFpfU1RSRUFNX0VSUk9SOgogICAgICAgIGNhc2UgWl9EQVRBX0VSUk9SOgogICAgICAgIGNhc2UgWl9ORUVEX0RJQ1Q6CiAgICAgICAgY2FzZSBaX01FTV9FUlJPUjoKICAgICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICAgIHRoaXMuZW5kZWQgPSB0cnVlOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyBSZW1lbWJlciByZWFsIGBhdmFpbF9vdXRgIHZhbHVlLCBiZWNhdXNlIHdlIG1heSBwYXRjaCBvdXQgYnVmZmVyIGNvbnRlbnQKICAgICAgLy8gdG8gYWxpZ24gdXRmOCBzdHJpbmdzIGJvdW5kYXJpZXMuCiAgICAgIGxhc3RfYXZhaWxfb3V0ID0gc3RybS5hdmFpbF9vdXQ7CgogICAgICBpZiAoc3RybS5uZXh0X291dCkgewogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCB8fCBzdGF0dXMgPT09IFpfU1RSRUFNX0VORCkgewoKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICdzdHJpbmcnKSB7CgogICAgICAgICAgICBsZXQgbmV4dF9vdXRfdXRmOCA9IHN0cmluZ3MudXRmOGJvcmRlcihzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCk7CgogICAgICAgICAgICBsZXQgdGFpbCA9IHN0cm0ubmV4dF9vdXQgLSBuZXh0X291dF91dGY4OwogICAgICAgICAgICBsZXQgdXRmOHN0ciA9IHN0cmluZ3MuYnVmMnN0cmluZyhzdHJtLm91dHB1dCwgbmV4dF9vdXRfdXRmOCk7CgogICAgICAgICAgICAvLyBtb3ZlIHRhaWwgJiByZWFsaWduIGNvdW50ZXJzCiAgICAgICAgICAgIHN0cm0ubmV4dF9vdXQgPSB0YWlsOwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZSAtIHRhaWw7CiAgICAgICAgICAgIGlmICh0YWlsKSBzdHJtLm91dHB1dC5zZXQoc3RybS5vdXRwdXQuc3ViYXJyYXkobmV4dF9vdXRfdXRmOCwgbmV4dF9vdXRfdXRmOCArIHRhaWwpLCAwKTsKCiAgICAgICAgICAgIHRoaXMub25EYXRhKHV0ZjhzdHIpOwoKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0Lmxlbmd0aCA9PT0gc3RybS5uZXh0X291dCA/IHN0cm0ub3V0cHV0IDogc3RybS5vdXRwdXQuc3ViYXJyYXkoMCwgc3RybS5uZXh0X291dCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gTXVzdCByZXBlYXQgaXRlcmF0aW9uIGlmIG91dCBidWZmZXIgaXMgZnVsbAogICAgICBpZiAoc3RhdHVzID09PSBaX09LICYmIGxhc3RfYXZhaWxfb3V0ID09PSAwKSBjb250aW51ZTsKCiAgICAgIC8vIEZpbmFsaXplIGlmIGVuZCBvZiBzdHJlYW0gcmVhY2hlZC4KICAgICAgaWYgKHN0YXR1cyA9PT0gWl9TVFJFQU1fRU5EKSB7CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDApIGJyZWFrOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH07CgoKICAvKioKICAgKiBJbmZsYXRlI29uRGF0YShjaHVuaykgLT4gVm9pZAogICAqIC0gY2h1bmsgKFVpbnQ4QXJyYXl8U3RyaW5nKTogb3V0cHV0IGRhdGEuIFdoZW4gc3RyaW5nIG91dHB1dCByZXF1ZXN0ZWQsCiAgICogICBlYWNoIGNodW5rIHdpbGwgYmUgc3RyaW5nLgogICAqCiAgICogQnkgZGVmYXVsdCwgc3RvcmVzIGRhdGEgYmxvY2tzIGluIGBjaHVua3NbXWAgcHJvcGVydHkgYW5kIGdsdWUKICAgKiB0aG9zZSBpbiBgb25FbmRgLiBPdmVycmlkZSB0aGlzIGhhbmRsZXIsIGlmIHlvdSBuZWVkIGFub3RoZXIgYmVoYXZpb3VyLgogICAqKi8KICBJbmZsYXRlJDEucHJvdG90eXBlLm9uRGF0YSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgdGhpcy5jaHVua3MucHVzaChjaHVuayk7CiAgfTsKCgogIC8qKgogICAqIEluZmxhdGUjb25FbmQoc3RhdHVzKSAtPiBWb2lkCiAgICogLSBzdGF0dXMgKE51bWJlcik6IGluZmxhdGUgc3RhdHVzLiAwIChaX09LKSBvbiBzdWNjZXNzLAogICAqICAgb3RoZXIgaWYgbm90LgogICAqCiAgICogQ2FsbGVkIGVpdGhlciBhZnRlciB5b3UgdGVsbCBpbmZsYXRlIHRoYXQgdGhlIGlucHV0IHN0cmVhbSBpcwogICAqIGNvbXBsZXRlIChaX0ZJTklTSCkuIEJ5IGRlZmF1bHQgLSBqb2luIGNvbGxlY3RlZCBjaHVua3MsCiAgICogZnJlZSBtZW1vcnkgYW5kIGZpbGwgYHJlc3VsdHNgIC8gYGVycmAgcHJvcGVydGllcy4KICAgKiovCiAgSW5mbGF0ZSQxLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uIChzdGF0dXMpIHsKICAgIC8vIE9uIHN1Y2Nlc3MgLSBqb2luCiAgICBpZiAoc3RhdHVzID09PSBaX09LKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLmNodW5rcy5qb2luKCcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IGNvbW1vbi5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKTsKICAgICAgfQogICAgfQogICAgdGhpcy5jaHVua3MgPSBbXTsKICAgIHRoaXMuZXJyID0gc3RhdHVzOwogICAgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwogIH07CgoKICAvKioKICAgKiBpbmZsYXRlKGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIERlY29tcHJlc3MgYGRhdGFgIHdpdGggaW5mbGF0ZS91bmd6aXAgYW5kIGBvcHRpb25zYC4gQXV0b2RldGVjdAogICAqIGZvcm1hdCB2aWEgd3JhcHBlciBoZWFkZXIgYnkgZGVmYXVsdC4gVGhhdCdzIHdoeSB3ZSBkb24ndCBwcm92aWRlCiAgICogc2VwYXJhdGUgYHVuZ3ppcGAgbWV0aG9kLgogICAqCiAgICogU3VwcG9ydGVkIG9wdGlvbnMgYXJlOgogICAqCiAgICogLSB3aW5kb3dCaXRzCiAgICoKICAgKiBbaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkXShodHRwOi8vemxpYi5uZXQvbWFudWFsLmh0bWwjQWR2YW5jZWQpCiAgICogZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICoKICAgKiBTdWdhciAob3B0aW9ucyk6CiAgICoKICAgKiAtIGByYXdgIChCb29sZWFuKSAtIHNheSB0aGF0IHdlIHdvcmsgd2l0aCByYXcgc3RyZWFtLCBpZiB5b3UgZG9uJ3Qgd2lzaCB0byBzcGVjaWZ5CiAgICogICBuZWdhdGl2ZSB3aW5kb3dCaXRzIGltcGxpY2l0bHkuCiAgICogLSBgdG9gIChTdHJpbmcpIC0gaWYgZXF1YWwgdG8gJ3N0cmluZycsIHRoZW4gcmVzdWx0IHdpbGwgYmUgY29udmVydGVkCiAgICogICBmcm9tIHV0ZjggdG8gdXRmMTYgKGphdmFzY3JpcHQpIHN0cmluZy4gV2hlbiBzdHJpbmcgb3V0cHV0IHJlcXVlc3RlZCwKICAgKiAgIGNodW5rIGxlbmd0aCBjYW4gZGlmZmVyIGZyb20gYGNodW5rU2l6ZWAsIGRlcGVuZGluZyBvbiBjb250ZW50LgogICAqCiAgICoKICAgKiAjIyMjIyBFeGFtcGxlOgogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIGNvbnN0IHBha28gPSByZXF1aXJlKCdwYWtvJyk7CiAgICogY29uc3QgaW5wdXQgPSBwYWtvLmRlZmxhdGUobmV3IFVpbnQ4QXJyYXkoWzEsMiwzLDQsNSw2LDcsOCw5XSkpOwogICAqIGxldCBvdXRwdXQ7CiAgICoKICAgKiB0cnkgewogICAqICAgb3V0cHV0ID0gcGFrby5pbmZsYXRlKGlucHV0KTsKICAgKiB9IGNhdGNoIChlcnIpIHsKICAgKiAgIGNvbnNvbGUubG9nKGVycik7CiAgICogfQogICAqIGBgYAogICAqKi8KICBmdW5jdGlvbiBpbmZsYXRlJDEoaW5wdXQsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGluZmxhdG9yID0gbmV3IEluZmxhdGUkMShvcHRpb25zKTsKCiAgICBpbmZsYXRvci5wdXNoKGlucHV0KTsKCiAgICAvLyBUaGF0IHdpbGwgbmV2ZXIgaGFwcGVucywgaWYgeW91IGRvbid0IGNoZWF0IHdpdGggb3B0aW9ucyA6KQogICAgaWYgKGluZmxhdG9yLmVycikgdGhyb3cgaW5mbGF0b3IubXNnIHx8IG1lc3NhZ2VzW2luZmxhdG9yLmVycl07CgogICAgcmV0dXJuIGluZmxhdG9yLnJlc3VsdDsKICB9CgoKICAvKioKICAgKiBpbmZsYXRlUmF3KGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIFRoZSBzYW1lIGFzIFtbaW5mbGF0ZV1dLCBidXQgY3JlYXRlcyByYXcgZGF0YSwgd2l0aG91dCB3cmFwcGVyCiAgICogKGhlYWRlciBhbmQgYWRsZXIzMiBjcmMpLgogICAqKi8KICBmdW5jdGlvbiBpbmZsYXRlUmF3JDEoaW5wdXQsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgb3B0aW9ucy5yYXcgPSB0cnVlOwogICAgcmV0dXJuIGluZmxhdGUkMShpbnB1dCwgb3B0aW9ucyk7CiAgfQoKCiAgLyoqCiAgICogdW5nemlwKGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIEp1c3Qgc2hvcnRjdXQgdG8gW1tpbmZsYXRlXV0sIGJlY2F1c2UgaXQgYXV0b2RldGVjdHMgZm9ybWF0CiAgICogYnkgaGVhZGVyLmNvbnRlbnQuIERvbmUgZm9yIGNvbnZlbmllbmNlLgogICAqKi8KCgogIHZhciBJbmZsYXRlXzEkMSA9IEluZmxhdGUkMTsKICB2YXIgaW5mbGF0ZV8yID0gaW5mbGF0ZSQxOwogIHZhciBpbmZsYXRlUmF3XzEkMSA9IGluZmxhdGVSYXckMTsKICB2YXIgdW5nemlwJDEgPSBpbmZsYXRlJDE7CiAgdmFyIGNvbnN0YW50cyA9IGNvbnN0YW50cyQyOwoKICB2YXIgaW5mbGF0ZV8xJDEgPSB7CiAgCUluZmxhdGU6IEluZmxhdGVfMSQxLAogIAlpbmZsYXRlOiBpbmZsYXRlXzIsCiAgCWluZmxhdGVSYXc6IGluZmxhdGVSYXdfMSQxLAogIAl1bmd6aXA6IHVuZ3ppcCQxLAogIAljb25zdGFudHM6IGNvbnN0YW50cwogIH07CgogIGNvbnN0IHsgSW5mbGF0ZSwgaW5mbGF0ZSwgaW5mbGF0ZVJhdywgdW5nemlwIH0gPSBpbmZsYXRlXzEkMTsKICB2YXIgaW5mbGF0ZV8xID0gaW5mbGF0ZTsKCiAgY2xhc3MgRGVmbGF0ZURlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgICAgcmV0dXJuIGluZmxhdGVfMShuZXcgVWludDhBcnJheShidWZmZXIpKS5idWZmZXI7CiAgICB9CiAgfQoKICBjbGFzcyBQYWNrYml0c0RlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgICAgY29uc3QgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTsKICAgICAgY29uc3Qgb3V0ID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1ZmZlci5ieXRlTGVuZ3RoOyArK2kpIHsKICAgICAgICBsZXQgaGVhZGVyID0gZGF0YVZpZXcuZ2V0SW50OChpKTsKICAgICAgICBpZiAoaGVhZGVyIDwgMCkgewogICAgICAgICAgY29uc3QgbmV4dCA9IGRhdGFWaWV3LmdldFVpbnQ4KGkgKyAxKTsKICAgICAgICAgIGhlYWRlciA9IC1oZWFkZXI7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSBoZWFkZXI7ICsraikgewogICAgICAgICAgICBvdXQucHVzaChuZXh0KTsKICAgICAgICAgIH0KICAgICAgICAgIGkgKz0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gaGVhZGVyOyArK2opIHsKICAgICAgICAgICAgb3V0LnB1c2goZGF0YVZpZXcuZ2V0VWludDgoaSArIGogKyAxKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpICs9IGhlYWRlciArIDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShvdXQpLmJ1ZmZlcjsKICAgIH0KICB9CgogIHZhciBMZXJjRGVjb2RlID0ge2V4cG9ydHM6IHt9fTsKCiAgLyoganNoaW50IGZvcmluOiBmYWxzZSwgYml0d2lzZTogZmFsc2UgKi8KCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAvKgogIENvcHlyaWdodCAyMDE1LTIwMTggRXNyaQoKICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgogIEEgY29weSBvZiB0aGUgbGljZW5zZSBhbmQgYWRkaXRpb25hbCBub3RpY2VzIGFyZSBsb2NhdGVkIHdpdGggdGhlCiAgc291cmNlIGRpc3RyaWJ1dGlvbiBhdDoKCiAgaHR0cDovL2dpdGh1Yi5jb20vRXNyaS9sZXJjLwoKICBDb250cmlidXRvcnM6ICBKb2hhbm5lcyBTY2htaWQsIChMRVJDIHYxKQogICAgICAgICAgICAgICAgIENoYXlhbmlrYSBLaGF0dWEsIChMRVJDIHYxKQogICAgICAgICAgICAgICAgIFdlbnh1ZSBKdSAoTEVSQyB2MSwgdjIueCkKICAqLwoKICAvKiBDb3B5cmlnaHQgMjAxNS0yMDE4IEVzcmkuIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAgQHByZXNlcnZlICovCgogIC8qKgogICAqIGEgbW9kdWxlIGZvciBkZWNvZGluZyBMRVJDIGJsb2JzCiAgICogQG1vZHVsZSBMZXJjCiAgICovCiAgKGZ1bmN0aW9uKCkgewogICAgLy90aGUgb3JpZ2luYWwgTGVyY0RlY29kZSBmb3IgVmVyc2lvbiAxCiAgICB2YXIgTGVyY0RlY29kZSA9IChmdW5jdGlvbigpIHsKCiAgICAgIC8vIFdBUk5JTkc6IFRoaXMgZGVjb2RlciB2ZXJzaW9uIGNhbiBvbmx5IHJlYWQgb2xkIHZlcnNpb24gMSBMZXJjIGJsb2JzLiBVc2Ugd2l0aCBjYXV0aW9uLgoKICAgICAgLy8gTm90ZTogY3VycmVudGx5LCB0aGlzIG1vZHVsZSBvbmx5IGhhcyBhbiBpbXBsZW1lbnRhdGlvbiBmb3IgZGVjb2RpbmcgTEVSQyBkYXRhLCBub3QgZW5jb2RpbmcuIFRoZSBuYW1lIG9mCiAgICAgIC8vIHRoZSBjbGFzcyB3YXMgY2hvc2VuIHRvIGJlIGZ1dHVyZSBwcm9vZi4KCiAgICAgIHZhciBDbnRaSW1hZ2UgPSB7fTsKCiAgICAgIENudFpJbWFnZS5kZWZhdWx0Tm9EYXRhVmFsdWUgPSAtMy40MDI3OTk5Mzg3OTAxNDg0ZSszODsgLy8gc21hbGxlc3QgRmxvYXQzMiB2YWx1ZQoKICAgICAgLyoqCiAgICAgICAqIERlY29kZSBhIExFUkMgYnl0ZSBzdHJlYW0gYW5kIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgcGl4ZWwgZGF0YSBhbmQgc29tZSByZXF1aXJlZCBhbmQgb3B0aW9uYWwKICAgICAgICogaW5mb3JtYXRpb24gYWJvdXQgaXQsIHN1Y2ggYXMgdGhlIGltYWdlJ3Mgd2lkdGggYW5kIGhlaWdodC4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gaW5wdXQgVGhlIExFUkMgaW5wdXQgYnl0ZSBzdHJlYW0KICAgICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSBEZWNvZGluZyBvcHRpb25zLCBjb250YWluaW5nIGFueSBvZiB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CiAgICAgICAqIEBjb25maWcge251bWJlcn0gW2lucHV0T2Zmc2V0ID0gMF0KICAgICAgICogICAgICAgIFNraXAgdGhlIGZpcnN0IGlucHV0T2Zmc2V0IGJ5dGVzIG9mIHRoZSBpbnB1dCBieXRlIHN0cmVhbS4gQSB2YWxpZCBMRVJDIGZpbGUgaXMgZXhwZWN0ZWQgYXQgdGhhdCBwb3NpdGlvbi4KICAgICAgICogQGNvbmZpZyB7VWludDhBcnJheX0gW2VuY29kZWRNYXNrID0gbnVsbF0KICAgICAgICogICAgICAgIElmIHNwZWNpZmllZCwgdGhlIGRlY29kZXIgd2lsbCBub3QgcmVhZCBtYXNrIGluZm9ybWF0aW9uIGZyb20gdGhlIGlucHV0IGFuZCB1c2UgdGhlIHNwZWNpZmllZCBlbmNvZGVkCiAgICAgICAqICAgICAgICBtYXNrIGRhdGEgaW5zdGVhZC4gTWFzayBoZWFkZXIvZGF0YSBtdXN0IG5vdCBiZSBwcmVzZW50IGluIHRoZSBMRVJDIGJ5dGUgc3RyZWFtIGluIHRoaXMgY2FzZS4KICAgICAgICogQGNvbmZpZyB7bnVtYmVyfSBbbm9EYXRhVmFsdWUgPSBMZXJjQ29kZS5kZWZhdWx0Tm9EYXRhVmFsdWVdCiAgICAgICAqICAgICAgICBQaXhlbCB2YWx1ZSB0byB1c2UgZm9yIG1hc2tlZCBwaXhlbHMuCiAgICAgICAqIEBjb25maWcge0FycmF5QnVmZmVyVmlld3xBcnJheX0gW3BpeGVsVHlwZSA9IEZsb2F0MzJBcnJheV0KICAgICAgICogICAgICAgIFRoZSBkZXNpcmVkIHR5cGUgb2YgdGhlIHBpeGVsRGF0YSBhcnJheSBpbiB0aGUgcmV0dXJuIHZhbHVlLiBOb3RlIHRoYXQgaXQgaXMgdGhlIGNhbGxlcidzIHJlc3BvbnNpYmlsaXR5IHRvCiAgICAgICAqICAgICAgICBwcm92aWRlIGFuIGFwcHJvcHJpYXRlIG5vRGF0YVZhbHVlIGlmIHRoZSBkZWZhdWx0IHBpeGVsVHlwZSBpcyBvdmVycmlkZGVuLgogICAgICAgKiBAY29uZmlnIHtib29sZWFufSBbcmV0dXJuTWFzayA9IGZhbHNlXQogICAgICAgKiAgICAgICAgSWYgdHJ1ZSwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGNvbnRhaW4gYSBtYXNrRGF0YSBwcm9wZXJ0eSBvZiB0eXBlIFVpbnQ4QXJyYXkgd2hpY2ggaGFzIG9uZSBlbGVtZW50IHBlcgogICAgICAgKiAgICAgICAgcGl4ZWwsIHRoZSB2YWx1ZSBvZiB3aGljaCBpcyAxIG9yIDAgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhhdCBwaXhlbCdzIGRhdGEgaXMgcHJlc2VudCBvciBtYXNrZWQuIElmIHRoZQogICAgICAgKiAgICAgICAgaW5wdXQgTEVSQyBkYXRhIGRvZXMgbm90IGNvbnRhaW4gYSBtYXNrLCBtYXNrRGF0YSB3aWxsIG5vdCBiZSByZXR1cm5lZC4KICAgICAgICogQGNvbmZpZyB7Ym9vbGVhbn0gW3JldHVybkVuY29kZWRNYXNrID0gZmFsc2VdCiAgICAgICAqICAgICAgICBJZiB0cnVlLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgY29udGFpbiBhIGVuY29kZWRNYXNrRGF0YSBwcm9wZXJ0eSwgd2hpY2ggY2FuIGJlIHBhc3NlZCBpbnRvIGVuY29kZSgpIGFzCiAgICAgICAqICAgICAgICBlbmNvZGVkTWFzay4KICAgICAgICogQGNvbmZpZyB7Ym9vbGVhbn0gW3JldHVybkZpbGVJbmZvID0gZmFsc2VdCiAgICAgICAqICAgICAgICBJZiB0cnVlLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgaGF2ZSBhIGZpbGVJbmZvIHByb3BlcnR5IHRoYXQgY29udGFpbnMgbWV0YWRhdGEgb2J0YWluZWQgZnJvbSB0aGUKICAgICAgICogICAgICAgIExFUkMgaGVhZGVycyBhbmQgdGhlIGRlY29kaW5nIHByb2Nlc3MuCiAgICAgICAqIEBjb25maWcge2Jvb2xlYW59IFtjb21wdXRlVXNlZEJpdERlcHRocyA9IGZhbHNlXQogICAgICAgKiAgICAgICAgSWYgdHJ1ZSwgdGhlIGZpbGVJbmZvIHByb3BlcnR5IGluIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBjb250YWluIHRoZSBzZXQgb2YgYWxsIGJsb2NrIGJpdCBkZXB0aHMKICAgICAgICogICAgICAgIGVuY291bnRlcmVkIGR1cmluZyBkZWNvZGluZy4gV2lsbCBvbmx5IGhhdmUgYW4gZWZmZWN0IGlmIHJldHVybkZpbGVJbmZvIG9wdGlvbiBpcyB0cnVlLgogICAgICAgKiBAcmV0dXJucyB7e3dpZHRoLCBoZWlnaHQsIHBpeGVsRGF0YSwgbWluVmFsdWUsIG1heFZhbHVlLCBub0RhdGFWYWx1ZSwgbWFza0RhdGEsIGVuY29kZWRNYXNrRGF0YSwgZmlsZUluZm99fQogICAgICAgKi8KICAgICAgQ250WkltYWdlLmRlY29kZSA9IGZ1bmN0aW9uKGlucHV0LCBvcHRpb25zKSB7CiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICAgIHZhciBza2lwTWFzayA9IG9wdGlvbnMuZW5jb2RlZE1hc2tEYXRhIHx8IChvcHRpb25zLmVuY29kZWRNYXNrRGF0YSA9PT0gbnVsbCk7CiAgICAgICAgdmFyIHBhcnNlZERhdGEgPSBwYXJzZShpbnB1dCwgb3B0aW9ucy5pbnB1dE9mZnNldCB8fCAwLCBza2lwTWFzayk7CgogICAgICAgIHZhciBub0RhdGFWYWx1ZSA9IChvcHRpb25zLm5vRGF0YVZhbHVlICE9PSBudWxsKSA/IG9wdGlvbnMubm9EYXRhVmFsdWUgOiBDbnRaSW1hZ2UuZGVmYXVsdE5vRGF0YVZhbHVlOwoKICAgICAgICB2YXIgdW5jb21wcmVzc2VkRGF0YSA9IHVuY29tcHJlc3NQaXhlbFZhbHVlcyhwYXJzZWREYXRhLCBvcHRpb25zLnBpeGVsVHlwZSB8fCBGbG9hdDMyQXJyYXksCiAgICAgICAgICBvcHRpb25zLmVuY29kZWRNYXNrRGF0YSwgbm9EYXRhVmFsdWUsIG9wdGlvbnMucmV0dXJuTWFzayk7CgogICAgICAgIHZhciByZXN1bHQgPSB7CiAgICAgICAgICB3aWR0aDogcGFyc2VkRGF0YS53aWR0aCwKICAgICAgICAgIGhlaWdodDogcGFyc2VkRGF0YS5oZWlnaHQsCiAgICAgICAgICBwaXhlbERhdGE6IHVuY29tcHJlc3NlZERhdGEucmVzdWx0UGl4ZWxzLAogICAgICAgICAgbWluVmFsdWU6IHVuY29tcHJlc3NlZERhdGEubWluVmFsdWUsCiAgICAgICAgICBtYXhWYWx1ZTogcGFyc2VkRGF0YS5waXhlbHMubWF4VmFsdWUsCiAgICAgICAgICBub0RhdGFWYWx1ZTogbm9EYXRhVmFsdWUKICAgICAgICB9OwoKICAgICAgICBpZiAodW5jb21wcmVzc2VkRGF0YS5yZXN1bHRNYXNrKSB7CiAgICAgICAgICByZXN1bHQubWFza0RhdGEgPSB1bmNvbXByZXNzZWREYXRhLnJlc3VsdE1hc2s7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5yZXR1cm5FbmNvZGVkTWFzayAmJiBwYXJzZWREYXRhLm1hc2spIHsKICAgICAgICAgIHJlc3VsdC5lbmNvZGVkTWFza0RhdGEgPSBwYXJzZWREYXRhLm1hc2suYml0c2V0ID8gcGFyc2VkRGF0YS5tYXNrLmJpdHNldCA6IG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5yZXR1cm5GaWxlSW5mbykgewogICAgICAgICAgcmVzdWx0LmZpbGVJbmZvID0gZm9ybWF0RmlsZUluZm8ocGFyc2VkRGF0YSk7CiAgICAgICAgICBpZiAob3B0aW9ucy5jb21wdXRlVXNlZEJpdERlcHRocykgewogICAgICAgICAgICByZXN1bHQuZmlsZUluZm8uYml0RGVwdGhzID0gY29tcHV0ZVVzZWRCaXREZXB0aHMocGFyc2VkRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwoKICAgICAgdmFyIHVuY29tcHJlc3NQaXhlbFZhbHVlcyA9IGZ1bmN0aW9uKGRhdGEsIFR5cGVkQXJyYXlDbGFzcywgbWFza0JpdHNldCwgbm9EYXRhVmFsdWUsIHN0b3JlRGVjb2RlZE1hc2spIHsKICAgICAgICB2YXIgYmxvY2tJZHggPSAwOwogICAgICAgIHZhciBudW1YID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWDsKICAgICAgICB2YXIgbnVtWSA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1k7CiAgICAgICAgdmFyIGJsb2NrV2lkdGggPSBNYXRoLmZsb29yKGRhdGEud2lkdGggLyBudW1YKTsKICAgICAgICB2YXIgYmxvY2tIZWlnaHQgPSBNYXRoLmZsb29yKGRhdGEuaGVpZ2h0IC8gbnVtWSk7CiAgICAgICAgdmFyIHNjYWxlID0gMiAqIGRhdGEubWF4WkVycm9yOwogICAgICAgIHZhciBtaW5WYWx1ZSA9IE51bWJlci5NQVhfVkFMVUUsIGN1cnJlbnRWYWx1ZTsKICAgICAgICBtYXNrQml0c2V0ID0gbWFza0JpdHNldCB8fCAoKGRhdGEubWFzaykgPyBkYXRhLm1hc2suYml0c2V0IDogbnVsbCk7CgogICAgICAgIHZhciByZXN1bHRQaXhlbHMsIHJlc3VsdE1hc2s7CiAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IFR5cGVkQXJyYXlDbGFzcyhkYXRhLndpZHRoICogZGF0YS5oZWlnaHQpOwogICAgICAgIGlmIChzdG9yZURlY29kZWRNYXNrICYmIG1hc2tCaXRzZXQpIHsKICAgICAgICAgIHJlc3VsdE1hc2sgPSBuZXcgVWludDhBcnJheShkYXRhLndpZHRoICogZGF0YS5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICB2YXIgYmxvY2tEYXRhQnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheShibG9ja1dpZHRoICogYmxvY2tIZWlnaHQpOwoKICAgICAgICB2YXIgeHgsIHl5OwogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDw9IG51bVk7IHkrKykgewogICAgICAgICAgdmFyIHRoaXNCbG9ja0hlaWdodCA9ICh5ICE9PSBudW1ZKSA/IGJsb2NrSGVpZ2h0IDogKGRhdGEuaGVpZ2h0ICUgbnVtWSk7CiAgICAgICAgICBpZiAodGhpc0Jsb2NrSGVpZ2h0ID09PSAwKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPD0gbnVtWDsgeCsrKSB7CiAgICAgICAgICAgIHZhciB0aGlzQmxvY2tXaWR0aCA9ICh4ICE9PSBudW1YKSA/IGJsb2NrV2lkdGggOiAoZGF0YS53aWR0aCAlIG51bVgpOwogICAgICAgICAgICBpZiAodGhpc0Jsb2NrV2lkdGggPT09IDApIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG91dFB0ciA9IHkgKiBkYXRhLndpZHRoICogYmxvY2tIZWlnaHQgKyB4ICogYmxvY2tXaWR0aDsKICAgICAgICAgICAgdmFyIG91dFN0cmlkZSA9IGRhdGEud2lkdGggLSB0aGlzQmxvY2tXaWR0aDsKCiAgICAgICAgICAgIHZhciBibG9jayA9IGRhdGEucGl4ZWxzLmJsb2Nrc1tibG9ja0lkeF07CgogICAgICAgICAgICB2YXIgYmxvY2tEYXRhLCBibG9ja1B0ciwgY29uc3RWYWx1ZTsKICAgICAgICAgICAgaWYgKGJsb2NrLmVuY29kaW5nIDwgMikgewogICAgICAgICAgICAgIC8vIGJsb2NrIGlzIGVpdGhlciB1bmNvbXByZXNzZWQgb3IgYml0LXN0dWZmZWQgKGVuY29kaW5ncyAwIGFuZCAxKQogICAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMCkgewogICAgICAgICAgICAgICAgLy8gYmxvY2sgaXMgdW5jb21wcmVzc2VkCiAgICAgICAgICAgICAgICBibG9ja0RhdGEgPSBibG9jay5yYXdEYXRhOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBibG9jayBpcyBiaXQtc3R1ZmZlZAogICAgICAgICAgICAgICAgdW5zdHVmZihibG9jay5zdHVmZmVkRGF0YSwgYmxvY2suYml0c1BlclBpeGVsLCBibG9jay5udW1WYWxpZFBpeGVscywgYmxvY2sub2Zmc2V0LCBzY2FsZSwgYmxvY2tEYXRhQnVmZmVyLCBkYXRhLnBpeGVscy5tYXhWYWx1ZSk7CiAgICAgICAgICAgICAgICBibG9ja0RhdGEgPSBibG9ja0RhdGFCdWZmZXI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJsb2NrUHRyID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMikgewogICAgICAgICAgICAgIC8vIGJsb2NrIGlzIGFsbCAwCiAgICAgICAgICAgICAgY29uc3RWYWx1ZSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgLy8gYmxvY2sgaGFzIGNvbnN0YW50IHZhbHVlIChlbmNvZGluZyA9PT0gMykKICAgICAgICAgICAgICBjb25zdFZhbHVlID0gYmxvY2sub2Zmc2V0OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbWFza0J5dGU7CiAgICAgICAgICAgIGlmIChtYXNrQml0c2V0KSB7CiAgICAgICAgICAgICAgZm9yICh5eSA9IDA7IHl5IDwgdGhpc0Jsb2NrSGVpZ2h0OyB5eSsrKSB7CiAgICAgICAgICAgICAgICBpZiAob3V0UHRyICYgNykgewogICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICBtYXNrQnl0ZSA9IG1hc2tCaXRzZXRbb3V0UHRyID4+IDNdOwogICAgICAgICAgICAgICAgICBtYXNrQnl0ZSA8PD0gb3V0UHRyICYgNzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoeHggPSAwOyB4eCA8IHRoaXNCbG9ja1dpZHRoOyB4eCsrKSB7CiAgICAgICAgICAgICAgICAgIGlmICghKG91dFB0ciAmIDcpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmVhZCBuZXh0IGJ5dGUgZnJvbSBtYXNrCiAgICAgICAgICAgICAgICAgICAgbWFza0J5dGUgPSBtYXNrQml0c2V0W291dFB0ciA+PiAzXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAobWFza0J5dGUgJiAxMjgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBwaXhlbCBkYXRhIHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0TWFzaykgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWFza1tvdXRQdHJdID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gKGJsb2NrLmVuY29kaW5nIDwgMikgPyBibG9ja0RhdGFbYmxvY2tQdHIrK10gOiBjb25zdFZhbHVlOwogICAgICAgICAgICAgICAgICAgIG1pblZhbHVlID0gbWluVmFsdWUgPiBjdXJyZW50VmFsdWUgPyBjdXJyZW50VmFsdWUgOiBtaW5WYWx1ZTsKICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyKytdID0gY3VycmVudFZhbHVlOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHBpeGVsIGRhdGEgbm90IHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0TWFzaykgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWFza1tvdXRQdHJdID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW291dFB0cisrXSA9IG5vRGF0YVZhbHVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG1hc2tCeXRlIDw8PSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gbWFzayBub3QgcHJlc2VudCwgc2ltcGx5IGNvcHkgYmxvY2sgb3ZlcgogICAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA8IDIpIHsKICAgICAgICAgICAgICAgIC8vIGR1cGxpY2F0aW5nIHRoaXMgY29kZSBibG9jayBmb3IgcGVyZm9ybWFuY2UgcmVhc29ucwogICAgICAgICAgICAgICAgLy8gYmxvY2tEYXRhIGNhc2U6CiAgICAgICAgICAgICAgICBmb3IgKHl5ID0gMDsgeXkgPCB0aGlzQmxvY2tIZWlnaHQ7IHl5KyspIHsKICAgICAgICAgICAgICAgICAgZm9yICh4eCA9IDA7IHh4IDwgdGhpc0Jsb2NrV2lkdGg7IHh4KyspIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBibG9ja0RhdGFbYmxvY2tQdHIrK107CiAgICAgICAgICAgICAgICAgICAgbWluVmFsdWUgPSBtaW5WYWx1ZSA+IGN1cnJlbnRWYWx1ZSA/IGN1cnJlbnRWYWx1ZSA6IG1pblZhbHVlOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBjdXJyZW50VmFsdWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBjb25zdFZhbHVlIGNhc2U6CiAgICAgICAgICAgICAgICBtaW5WYWx1ZSA9IG1pblZhbHVlID4gY29uc3RWYWx1ZSA/IGNvbnN0VmFsdWUgOiBtaW5WYWx1ZTsKICAgICAgICAgICAgICAgIGZvciAoeXkgPSAwOyB5eSA8IHRoaXNCbG9ja0hlaWdodDsgeXkrKykgewogICAgICAgICAgICAgICAgICBmb3IgKHh4ID0gMDsgeHggPCB0aGlzQmxvY2tXaWR0aDsgeHgrKykgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBjb25zdFZhbHVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoYmxvY2suZW5jb2RpbmcgPT09IDEpICYmIChibG9ja1B0ciAhPT0gYmxvY2subnVtVmFsaWRQaXhlbHMpKSB7CiAgICAgICAgICAgICAgdGhyb3cgIkJsb2NrIGFuZCBNYXNrIGRvIG5vdCBtYXRjaCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmxvY2tJZHgrKzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZXN1bHRQaXhlbHM6IHJlc3VsdFBpeGVscywKICAgICAgICAgIHJlc3VsdE1hc2s6IHJlc3VsdE1hc2ssCiAgICAgICAgICBtaW5WYWx1ZTogbWluVmFsdWUKICAgICAgICB9OwogICAgICB9OwoKICAgICAgdmFyIGZvcm1hdEZpbGVJbmZvID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAiZmlsZUlkZW50aWZpZXJTdHJpbmciOiBkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nLAogICAgICAgICAgImZpbGVWZXJzaW9uIjogZGF0YS5maWxlVmVyc2lvbiwKICAgICAgICAgICJpbWFnZVR5cGUiOiBkYXRhLmltYWdlVHlwZSwKICAgICAgICAgICJoZWlnaHQiOiBkYXRhLmhlaWdodCwKICAgICAgICAgICJ3aWR0aCI6IGRhdGEud2lkdGgsCiAgICAgICAgICAibWF4WkVycm9yIjogZGF0YS5tYXhaRXJyb3IsCiAgICAgICAgICAiZW9mT2Zmc2V0IjogZGF0YS5lb2ZPZmZzZXQsCiAgICAgICAgICAibWFzayI6IGRhdGEubWFzayA/IHsKICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLm1hc2subnVtQmxvY2tzWCwKICAgICAgICAgICAgIm51bUJsb2Nrc1kiOiBkYXRhLm1hc2subnVtQmxvY2tzWSwKICAgICAgICAgICAgIm51bUJ5dGVzIjogZGF0YS5tYXNrLm51bUJ5dGVzLAogICAgICAgICAgICAibWF4VmFsdWUiOiBkYXRhLm1hc2subWF4VmFsdWUKICAgICAgICAgIH0gOiBudWxsLAogICAgICAgICAgInBpeGVscyI6IHsKICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLnBpeGVscy5udW1CbG9ja3NYLAogICAgICAgICAgICAibnVtQmxvY2tzWSI6IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1ksCiAgICAgICAgICAgICJudW1CeXRlcyI6IGRhdGEucGl4ZWxzLm51bUJ5dGVzLAogICAgICAgICAgICAibWF4VmFsdWUiOiBkYXRhLnBpeGVscy5tYXhWYWx1ZSwKICAgICAgICAgICAgIm5vRGF0YVZhbHVlIjogZGF0YS5ub0RhdGFWYWx1ZQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH07CgogICAgICB2YXIgY29tcHV0ZVVzZWRCaXREZXB0aHMgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIG51bUJsb2NrcyA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1ggKiBkYXRhLnBpeGVscy5udW1CbG9ja3NZOwogICAgICAgIHZhciBiaXREZXB0aHMgPSB7fTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bUJsb2NrczsgaSsrKSB7CiAgICAgICAgICB2YXIgYmxvY2sgPSBkYXRhLnBpeGVscy5ibG9ja3NbaV07CiAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDApIHsKICAgICAgICAgICAgYml0RGVwdGhzLmZsb2F0MzIgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMSkgewogICAgICAgICAgICBiaXREZXB0aHNbYmxvY2suYml0c1BlclBpeGVsXSA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiaXREZXB0aHNbMF0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGJpdERlcHRocyk7CiAgICAgIH07CgogICAgICB2YXIgcGFyc2UgPSBmdW5jdGlvbihpbnB1dCwgZnAsIHNraXBNYXNrKSB7CiAgICAgICAgdmFyIGRhdGEgPSB7fTsKCiAgICAgICAgLy8gRmlsZSBoZWFkZXIKICAgICAgICB2YXIgZmlsZUlkVmlldyA9IG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgMTApOwogICAgICAgIGRhdGEuZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgIGlmIChkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nLnRyaW0oKSAhPT0gIkNudFpJbWFnZSIpIHsKICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGZpbGUgaWRlbnRpZmllciBzdHJpbmc6ICIgKyBkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nOwogICAgICAgIH0KICAgICAgICBmcCArPSAxMDsKICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIDI0KTsKICAgICAgICBkYXRhLmZpbGVWZXJzaW9uID0gdmlldy5nZXRJbnQzMigwLCB0cnVlKTsKICAgICAgICBkYXRhLmltYWdlVHlwZSA9IHZpZXcuZ2V0SW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgZGF0YS5oZWlnaHQgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICBkYXRhLndpZHRoID0gdmlldy5nZXRVaW50MzIoMTIsIHRydWUpOwogICAgICAgIGRhdGEubWF4WkVycm9yID0gdmlldy5nZXRGbG9hdDY0KDE2LCB0cnVlKTsKICAgICAgICBmcCArPSAyNDsKCiAgICAgICAgLy8gTWFzayBIZWFkZXIKICAgICAgICBpZiAoIXNraXBNYXNrKSB7CiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBmcCwgMTYpOwogICAgICAgICAgZGF0YS5tYXNrID0ge307CiAgICAgICAgICBkYXRhLm1hc2subnVtQmxvY2tzWSA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICAgICAgZGF0YS5tYXNrLm51bUJsb2Nrc1ggPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsKICAgICAgICAgIGRhdGEubWFzay5udW1CeXRlcyA9IHZpZXcuZ2V0VWludDMyKDgsIHRydWUpOwogICAgICAgICAgZGF0YS5tYXNrLm1heFZhbHVlID0gdmlldy5nZXRGbG9hdDMyKDEyLCB0cnVlKTsKICAgICAgICAgIGZwICs9IDE2OwoKICAgICAgICAgIC8vIE1hc2sgRGF0YQogICAgICAgICAgaWYgKGRhdGEubWFzay5udW1CeXRlcyA+IDApIHsKICAgICAgICAgICAgdmFyIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChkYXRhLndpZHRoICogZGF0YS5oZWlnaHQgLyA4KSk7CiAgICAgICAgICAgIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIGZwLCBkYXRhLm1hc2subnVtQnl0ZXMpOwogICAgICAgICAgICB2YXIgY250ID0gdmlldy5nZXRJbnQxNigwLCB0cnVlKTsKICAgICAgICAgICAgdmFyIGlwID0gMiwgb3AgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKGNudCA+IDApIHsKICAgICAgICAgICAgICAgIHdoaWxlIChjbnQtLSkgeyBiaXRzZXRbb3ArK10gPSB2aWV3LmdldFVpbnQ4KGlwKyspOyB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB2YWwgPSB2aWV3LmdldFVpbnQ4KGlwKyspOwogICAgICAgICAgICAgICAgY250ID0gLWNudDsKICAgICAgICAgICAgICAgIHdoaWxlIChjbnQtLSkgeyBiaXRzZXRbb3ArK10gPSB2YWw7IH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY250ID0gdmlldy5nZXRJbnQxNihpcCwgdHJ1ZSk7CiAgICAgICAgICAgICAgaXAgKz0gMjsKICAgICAgICAgICAgfSB3aGlsZSAoaXAgPCBkYXRhLm1hc2subnVtQnl0ZXMpOwogICAgICAgICAgICBpZiAoKGNudCAhPT0gLTMyNzY4KSB8fCAob3AgPCBiaXRzZXQubGVuZ3RoKSkgewogICAgICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGVuZCBvZiBtYXNrIFJMRSBlbmNvZGluZyI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YS5tYXNrLmJpdHNldCA9IGJpdHNldDsKICAgICAgICAgICAgZnAgKz0gZGF0YS5tYXNrLm51bUJ5dGVzOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAoKGRhdGEubWFzay5udW1CeXRlcyB8IGRhdGEubWFzay5udW1CbG9ja3NZIHwgZGF0YS5tYXNrLm1heFZhbHVlKSA9PT0gMCkgeyAgLy8gU3BlY2lhbCBjYXNlLCBhbGwgbm9kYXRhCiAgICAgICAgICAgIGRhdGEubWFzay5iaXRzZXQgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwoZGF0YS53aWR0aCAqIGRhdGEuaGVpZ2h0IC8gOCkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUGl4ZWwgSGVhZGVyCiAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIDE2KTsKICAgICAgICBkYXRhLnBpeGVscyA9IHt9OwogICAgICAgIGRhdGEucGl4ZWxzLm51bUJsb2Nrc1kgPSB2aWV3LmdldFVpbnQzMigwLCB0cnVlKTsKICAgICAgICBkYXRhLnBpeGVscy5udW1CbG9ja3NYID0gdmlldy5nZXRVaW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgZGF0YS5waXhlbHMubnVtQnl0ZXMgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICBkYXRhLnBpeGVscy5tYXhWYWx1ZSA9IHZpZXcuZ2V0RmxvYXQzMigxMiwgdHJ1ZSk7CiAgICAgICAgZnAgKz0gMTY7CgogICAgICAgIHZhciBudW1CbG9ja3NYID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWDsKICAgICAgICB2YXIgbnVtQmxvY2tzWSA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1k7CiAgICAgICAgLy8gdGhlIG51bWJlciBvZiBibG9ja3Mgc3BlY2lmaWVkIGluIHRoZSBoZWFkZXIgZG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGJsb2NrcyBhdCB0aGUgZW5kIG9mCiAgICAgICAgLy8gZWFjaCByb3cvY29sdW1uIHdpdGggYSBzcGVjaWFsIHdpZHRoL2hlaWdodCB0aGF0IG1ha2UgdGhlIGltYWdlIGNvbXBsZXRlIGluIGNhc2UgdGhlIHdpZHRoIGlzIG5vdAogICAgICAgIC8vIGV2ZW5seSBkaXZpc2libGUgYnkgdGhlIG51bWJlciBvZiBibG9ja3MuCiAgICAgICAgdmFyIGFjdHVhbE51bUJsb2Nrc1ggPSBudW1CbG9ja3NYICsgKChkYXRhLndpZHRoICUgbnVtQmxvY2tzWCkgPiAwID8gMSA6IDApOwogICAgICAgIHZhciBhY3R1YWxOdW1CbG9ja3NZID0gbnVtQmxvY2tzWSArICgoZGF0YS5oZWlnaHQgJSBudW1CbG9ja3NZKSA+IDAgPyAxIDogMCk7CiAgICAgICAgZGF0YS5waXhlbHMuYmxvY2tzID0gbmV3IEFycmF5KGFjdHVhbE51bUJsb2Nrc1ggKiBhY3R1YWxOdW1CbG9ja3NZKTsKICAgICAgICB2YXIgYmxvY2tJID0gMDsKICAgICAgICBmb3IgKHZhciBibG9ja1kgPSAwOyBibG9ja1kgPCBhY3R1YWxOdW1CbG9ja3NZOyBibG9ja1krKykgewogICAgICAgICAgZm9yICh2YXIgYmxvY2tYID0gMDsgYmxvY2tYIDwgYWN0dWFsTnVtQmxvY2tzWDsgYmxvY2tYKyspIHsKCiAgICAgICAgICAgIC8vIEJsb2NrCiAgICAgICAgICAgIHZhciBzaXplID0gMDsKICAgICAgICAgICAgdmFyIGJ5dGVzTGVmdCA9IGlucHV0LmJ5dGVMZW5ndGggLSBmcDsKICAgICAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIE1hdGgubWluKDEwLCBieXRlc0xlZnQpKTsKICAgICAgICAgICAgdmFyIGJsb2NrID0ge307CiAgICAgICAgICAgIGRhdGEucGl4ZWxzLmJsb2Nrc1tibG9ja0krK10gPSBibG9jazsKICAgICAgICAgICAgdmFyIGhlYWRlckJ5dGUgPSB2aWV3LmdldFVpbnQ4KDApOyBzaXplKys7CiAgICAgICAgICAgIGJsb2NrLmVuY29kaW5nID0gaGVhZGVyQnl0ZSAmIDYzOwogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPiAzKSB7CiAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgZW5jb2RpbmcgKCIgKyBibG9jay5lbmNvZGluZyArICIpIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDIpIHsKICAgICAgICAgICAgICBmcCsrOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoaGVhZGVyQnl0ZSAhPT0gMCkgJiYgKGhlYWRlckJ5dGUgIT09IDIpKSB7CiAgICAgICAgICAgICAgaGVhZGVyQnl0ZSA+Pj0gNjsKICAgICAgICAgICAgICBibG9jay5vZmZzZXRUeXBlID0gaGVhZGVyQnl0ZTsKICAgICAgICAgICAgICBpZiAoaGVhZGVyQnl0ZSA9PT0gMikgewogICAgICAgICAgICAgICAgYmxvY2sub2Zmc2V0ID0gdmlldy5nZXRJbnQ4KDEpOyBzaXplKys7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkZXJCeXRlID09PSAxKSB7CiAgICAgICAgICAgICAgICBibG9jay5vZmZzZXQgPSB2aWV3LmdldEludDE2KDEsIHRydWUpOyBzaXplICs9IDI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkZXJCeXRlID09PSAwKSB7CiAgICAgICAgICAgICAgICBibG9jay5vZmZzZXQgPSB2aWV3LmdldEZsb2F0MzIoMSwgdHJ1ZSk7IHNpemUgKz0gNDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgb2Zmc2V0IHR5cGUiOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGJsb2NrLmVuY29kaW5nID09PSAxKSB7CiAgICAgICAgICAgICAgICBoZWFkZXJCeXRlID0gdmlldy5nZXRVaW50OChzaXplKTsgc2l6ZSsrOwogICAgICAgICAgICAgICAgYmxvY2suYml0c1BlclBpeGVsID0gaGVhZGVyQnl0ZSAmIDYzOwogICAgICAgICAgICAgICAgaGVhZGVyQnl0ZSA+Pj0gNjsKICAgICAgICAgICAgICAgIGJsb2NrLm51bVZhbGlkUGl4ZWxzVHlwZSA9IGhlYWRlckJ5dGU7CiAgICAgICAgICAgICAgICBpZiAoaGVhZGVyQnl0ZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBibG9jay5udW1WYWxpZFBpeGVscyA9IHZpZXcuZ2V0VWludDgoc2l6ZSk7IHNpemUrKzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZGVyQnl0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBibG9jay5udW1WYWxpZFBpeGVscyA9IHZpZXcuZ2V0VWludDE2KHNpemUsIHRydWUpOyBzaXplICs9IDI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRlckJ5dGUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYmxvY2subnVtVmFsaWRQaXhlbHMgPSB2aWV3LmdldFVpbnQzMihzaXplLCB0cnVlKTsgc2l6ZSArPSA0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgdmFsaWQgcGl4ZWwgY291bnQgdHlwZSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZwICs9IHNpemU7CgogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDMpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFycmF5QnVmLCBzdG9yZTg7CiAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMCkgewogICAgICAgICAgICAgIHZhciBudW1QaXhlbHMgPSAoZGF0YS5waXhlbHMubnVtQnl0ZXMgLSAxKSAvIDQ7CiAgICAgICAgICAgICAgaWYgKG51bVBpeGVscyAhPT0gTWF0aC5mbG9vcihudW1QaXhlbHMpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAidW5jb21wcmVzc2VkIGJsb2NrIGhhcyBpbnZhbGlkIGxlbmd0aCI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKG51bVBpeGVscyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgbnVtUGl4ZWxzICogNCkpOwogICAgICAgICAgICAgIHZhciByYXdEYXRhID0gbmV3IEZsb2F0MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgYmxvY2sucmF3RGF0YSA9IHJhd0RhdGE7CiAgICAgICAgICAgICAgZnAgKz0gbnVtUGl4ZWxzICogNDsKICAgICAgICAgICAgfSBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMSkgewogICAgICAgICAgICAgIHZhciBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwoYmxvY2subnVtVmFsaWRQaXhlbHMgKiBibG9jay5iaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgICB2YXIgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKGRhdGFXb3JkcyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICAgICAgYmxvY2suc3R1ZmZlZERhdGEgPSBuZXcgVWludDMyQXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgIGZwICs9IGRhdGFCeXRlczsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkYXRhLmVvZk9mZnNldCA9IGZwOwogICAgICAgIHJldHVybiBkYXRhOwogICAgICB9OwoKICAgICAgdmFyIHVuc3R1ZmYgPSBmdW5jdGlvbihzcmMsIGJpdHNQZXJQaXhlbCwgbnVtUGl4ZWxzLCBvZmZzZXQsIHNjYWxlLCBkZXN0LCBtYXhWYWx1ZSkgewogICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgdmFyIGkgPSAwLCBvOwogICAgICAgIHZhciBiaXRzTGVmdCA9IDA7CiAgICAgICAgdmFyIG4sIGJ1ZmZlcjsKICAgICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgIC8vIGdldCByaWQgb2YgdHJhaWxpbmcgYnl0ZXMgdGhhdCBhcmUgYWxyZWFkeSBwYXJ0IG9mIG5leHQgYmxvY2sKICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgIHNyY1tzcmMubGVuZ3RoIC0gMV0gPDw9IDggKiBudW1JbnZhbGlkVGFpbEJ5dGVzOwoKICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgIGlmIChiaXRzTGVmdCA9PT0gMCkgewogICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgYml0c0xlZnQgLT0gYml0c1BlclBpeGVsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgbiA9ICgoYnVmZmVyICYgYml0TWFzaykgPDwgbWlzc2luZ0JpdHMpICYgYml0TWFzazsKICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgbiArPSAoYnVmZmVyID4+PiBiaXRzTGVmdCk7CiAgICAgICAgICB9CiAgICAgICAgICAvL3BpeGVsIHZhbHVlcyBtYXkgZXhjZWVkIG1heCBkdWUgdG8gcXVhbnRpemF0aW9uCiAgICAgICAgICBkZXN0W29dID0gbiA8IG5tYXggPyBvZmZzZXQgKyBuICogc2NhbGUgOiBtYXhWYWx1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgIH07CgogICAgICByZXR1cm4gQ250WkltYWdlOwogICAgfSkoKTsKCiAgICAvL3ZlcnNpb24gMi4gU3VwcG9ydHMgMi4xLCAyLjIsIDIuMwogICAgdmFyIExlcmMyRGVjb2RlID0gKGZ1bmN0aW9uKCkgewogICAgICAvLyBOb3RlOiBjdXJyZW50bHksIHRoaXMgbW9kdWxlIG9ubHkgaGFzIGFuIGltcGxlbWVudGF0aW9uIGZvciBkZWNvZGluZyBMRVJDIGRhdGEsIG5vdCBlbmNvZGluZy4gVGhlIG5hbWUgb2YKICAgICAgLy8gdGhlIGNsYXNzIHdhcyBjaG9zZW4gdG8gYmUgZnV0dXJlIHByb29mLCBmb2xsb3dpbmcgTGVyY0RlY29kZS4KCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAqIHByaXZhdGUgc3RhdGljIGNsYXNzIGJpdHN1dGZmZXIgdXNlZCBieSBMZXJjMkRlY29kZQogICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICB2YXIgQml0U3R1ZmZlciA9IHsKICAgICAgICAvL21ldGhvZHMgZW5kaW5nIHdpdGggMiBhcmUgZm9yIHRoZSBuZXcgYnl0ZSBvcmRlciB1c2VkIGJ5IExlcmMyLjMgYW5kIGFib3ZlLgogICAgICAgIC8vb3JpZ2luYWxVbnN0dWZmIGlzIHVzZWQgdG8gdW5wYWNrIEh1ZmZtYW4gY29kZSB0YWJsZS4gY29kZSBpcyBkdXBsaWNhdGVkIHRvIHVuc3R1ZmZ4IGZvciBwZXJmb3JtYW5jZSByZWFzb25zLgogICAgICAgIHVuc3R1ZmY6IGZ1bmN0aW9uKHNyYywgZGVzdCwgYml0c1BlclBpeGVsLCBudW1QaXhlbHMsIGx1dEFyciwgb2Zmc2V0LCBzY2FsZSwgbWF4VmFsdWUpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG87CiAgICAgICAgICB2YXIgYml0c0xlZnQgPSAwOwogICAgICAgICAgdmFyIG4sIGJ1ZmZlciwgbWlzc2luZ0JpdHMsIG5tYXg7CgogICAgICAgICAgLy8gZ2V0IHJpZCBvZiB0cmFpbGluZyBieXRlcyB0aGF0IGFyZSBhbHJlYWR5IHBhcnQgb2YgbmV4dCBibG9jawogICAgICAgICAgdmFyIG51bUludmFsaWRUYWlsQnl0ZXMgPSBzcmMubGVuZ3RoICogNCAtIE1hdGguY2VpbChiaXRzUGVyUGl4ZWwgKiBudW1QaXhlbHMgLyA4KTsKICAgICAgICAgIHNyY1tzcmMubGVuZ3RoIC0gMV0gPDw9IDggKiBudW1JbnZhbGlkVGFpbEJ5dGVzOwogICAgICAgICAgaWYgKGx1dEFycikgewogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVzdFtvXSA9IGx1dEFycltuXTsvL29mZnNldCArIGx1dEFycltuXSAqIHNjYWxlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy9waXhlbCB2YWx1ZXMgbWF5IGV4Y2VlZCBtYXggZHVlIHRvIHF1YW50aXphdGlvbgogICAgICAgICAgICAgIGRlc3Rbb10gPSBuIDwgbm1heCA/IG9mZnNldCArIG4gKiBzY2FsZSA6IG1heFZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgdW5zdHVmZkxVVDogZnVuY3Rpb24oc3JjLCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgb2Zmc2V0LCBzY2FsZSwgbWF4VmFsdWUpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG8gPSAwLCBtaXNzaW5nQml0cyA9IDAsIGJpdHNMZWZ0ID0gMCwgbiA9IDA7CiAgICAgICAgICB2YXIgYnVmZmVyOwogICAgICAgICAgdmFyIGRlc3QgPSBbXTsKCiAgICAgICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgICAgc3JjW3NyYy5sZW5ndGggLSAxXSA8PD0gOCAqIG51bUludmFsaWRUYWlsQnl0ZXM7CgogICAgICAgICAgdmFyIG5tYXggPSBNYXRoLmNlaWwoKG1heFZhbHVlIC0gb2Zmc2V0KSAvIHNjYWxlKTsKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gKGJpdHNMZWZ0IC0gYml0c1BlclBpeGVsKSkgJiBiaXRNYXNrOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgbiA9ICgoYnVmZmVyICYgYml0TWFzaykgPDwgbWlzc2luZ0JpdHMpICYgYml0TWFzazsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgbiArPSAoYnVmZmVyID4+PiBiaXRzTGVmdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9kZXN0LnB1c2gobik7CiAgICAgICAgICAgIGRlc3Rbb10gPSBuIDwgbm1heCA/IG9mZnNldCArIG4gKiBzY2FsZSA6IG1heFZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgZGVzdC51bnNoaWZ0KG9mZnNldCk7Ly8xc3Qgb25lCiAgICAgICAgICByZXR1cm4gZGVzdDsKICAgICAgICB9LAoKICAgICAgICB1bnN0dWZmMjogZnVuY3Rpb24oc3JjLCBkZXN0LCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgbHV0QXJyLCBvZmZzZXQsIHNjYWxlLCBtYXhWYWx1ZSkgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbzsKICAgICAgICAgIHZhciBiaXRzTGVmdCA9IDAsIGJpdFBvcyA9IDA7CiAgICAgICAgICB2YXIgbiwgYnVmZmVyLCBtaXNzaW5nQml0czsKICAgICAgICAgIGlmIChsdXRBcnIpIHsKICAgICAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICAgICAgICBiaXRQb3MgPSAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPj0gYml0c1BlclBpeGVsKSB7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgPj4+IGJpdFBvcykgJiBiaXRNYXNrKTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICAgIGJpdFBvcyArPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgICAgbiB8PSAoYnVmZmVyICYgKCgxIDw8IG1pc3NpbmdCaXRzKSAtIDEpKSA8PCAoYml0c1BlclBpeGVsIC0gbWlzc2luZ0JpdHMpOwogICAgICAgICAgICAgICAgYml0UG9zID0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGRlc3Rbb10gPSBsdXRBcnJbbl07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgICAgbiA9ICgoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzayk7CiAgICAgICAgICAgICAgICBiaXRzTGVmdCAtPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICAgIGJpdFBvcyA9IG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvL3BpeGVsIHZhbHVlcyBtYXkgZXhjZWVkIG1heCBkdWUgdG8gcXVhbnRpemF0aW9uCiAgICAgICAgICAgICAgZGVzdFtvXSA9IG4gPCBubWF4ID8gb2Zmc2V0ICsgbiAqIHNjYWxlIDogbWF4VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIHVuc3R1ZmZMVVQyOiBmdW5jdGlvbihzcmMsIGJpdHNQZXJQaXhlbCwgbnVtUGl4ZWxzLCBvZmZzZXQsIHNjYWxlLCBtYXhWYWx1ZSkgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbyA9IDAsIG1pc3NpbmdCaXRzID0gMCwgYml0c0xlZnQgPSAwLCBuID0gMCwgYml0UG9zID0gMDsKICAgICAgICAgIHZhciBidWZmZXI7CiAgICAgICAgICB2YXIgZGVzdCA9IFtdOwogICAgICAgICAgdmFyIG5tYXggPSBNYXRoLmNlaWwoKG1heFZhbHVlIC0gb2Zmc2V0KSAvIHNjYWxlKTsKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2spOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICBiaXRQb3MgPSBtaXNzaW5nQml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2Rlc3QucHVzaChuKTsKICAgICAgICAgICAgZGVzdFtvXSA9IG4gPCBubWF4ID8gb2Zmc2V0ICsgbiAqIHNjYWxlIDogbWF4VmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBkZXN0LnVuc2hpZnQob2Zmc2V0KTsKICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIG9yaWdpbmFsVW5zdHVmZjogZnVuY3Rpb24oc3JjLCBkZXN0LCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscykgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbzsKICAgICAgICAgIHZhciBiaXRzTGVmdCA9IDA7CiAgICAgICAgICB2YXIgbiwgYnVmZmVyLCBtaXNzaW5nQml0czsKCiAgICAgICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgICAgc3JjW3NyYy5sZW5ndGggLSAxXSA8PD0gOCAqIG51bUludmFsaWRUYWlsQnl0ZXM7CgogICAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICAgIGlmIChiaXRzTGVmdCA9PT0gMCkgewogICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiAoYml0c0xlZnQgLSBiaXRzUGVyUGl4ZWwpKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYml0c0xlZnQgLT0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0W29dID0gbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIG9yaWdpbmFsVW5zdHVmZjI6IGZ1bmN0aW9uKHNyYywgZGVzdCwgYml0c1BlclBpeGVsLCBudW1QaXhlbHMpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG87CiAgICAgICAgICB2YXIgYml0c0xlZnQgPSAwLCBiaXRQb3MgPSAwOwogICAgICAgICAgdmFyIG4sIGJ1ZmZlciwgbWlzc2luZ0JpdHM7CiAgICAgICAgICAvL21pY3JvLW9wdGltaXphdGlvbnMKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2spOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICBiaXRQb3MgPSBtaXNzaW5nQml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0W29dID0gbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAqcHJpdmF0ZSBzdGF0aWMgY2xhc3MgdXNlZCBieSBMZXJjMkRlY29kZQogICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIHZhciBMZXJjMkhlbHBlcnMgPSB7CiAgICAgICAgSFVGRk1BTl9MVVRfQklUU19NQVg6IDEyLCAvL3VzZSAyXjEyIGx1dCwgdHJlYXQgaXQgbGlrZSBjb25zdGFudAogICAgICAgIGNvbXB1dGVDaGVja3N1bUZsZXRjaGVyMzI6IGZ1bmN0aW9uKGlucHV0KSB7CgogICAgICAgICAgdmFyIHN1bTEgPSAweGZmZmYsIHN1bTIgPSAweGZmZmY7CiAgICAgICAgICB2YXIgbGVuID0gaW5wdXQubGVuZ3RoOwogICAgICAgICAgdmFyIHdvcmRzID0gTWF0aC5mbG9vcihsZW4gLyAyKTsKICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgIHdoaWxlICh3b3JkcykgewogICAgICAgICAgICB2YXIgdGxlbiA9ICh3b3JkcyA+PSAzNTkpID8gMzU5IDogd29yZHM7CiAgICAgICAgICAgIHdvcmRzIC09IHRsZW47CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBzdW0xICs9IChpbnB1dFtpKytdIDw8IDgpOwogICAgICAgICAgICAgIHN1bTIgKz0gc3VtMSArPSBpbnB1dFtpKytdOwogICAgICAgICAgICB9IHdoaWxlICgtLXRsZW4pOwoKICAgICAgICAgICAgc3VtMSA9IChzdW0xICYgMHhmZmZmKSArIChzdW0xID4+PiAxNik7CiAgICAgICAgICAgIHN1bTIgPSAoc3VtMiAmIDB4ZmZmZikgKyAoc3VtMiA+Pj4gMTYpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGFkZCB0aGUgc3RyYWdnbGVyIGJ5dGUgaWYgaXQgZXhpc3RzCiAgICAgICAgICBpZiAobGVuICYgMSkgewogICAgICAgICAgICBzdW0yICs9IHN1bTEgKz0gKGlucHV0W2ldIDw8IDgpOwogICAgICAgICAgfQogICAgICAgICAgLy8gc2Vjb25kIHJlZHVjdGlvbiBzdGVwIHRvIHJlZHVjZSBzdW1zIHRvIDE2IGJpdHMKICAgICAgICAgIHN1bTEgPSAoc3VtMSAmIDB4ZmZmZikgKyAoc3VtMSA+Pj4gMTYpOwogICAgICAgICAgc3VtMiA9IChzdW0yICYgMHhmZmZmKSArIChzdW0yID4+PiAxNik7CgogICAgICAgICAgcmV0dXJuIChzdW0yIDw8IDE2IHwgc3VtMSkgPj4+IDA7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZEhlYWRlckluZm86IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgICB2YXIgcHRyID0gZGF0YS5wdHI7CiAgICAgICAgICB2YXIgZmlsZUlkVmlldyA9IG5ldyBVaW50OEFycmF5KGlucHV0LCBwdHIsIDYpOwogICAgICAgICAgdmFyIGhlYWRlckluZm8gPSB7fTsKICAgICAgICAgIGhlYWRlckluZm8uZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgICAgaWYgKGhlYWRlckluZm8uZmlsZUlkZW50aWZpZXJTdHJpbmcubGFzdEluZGV4T2YoIkxlcmMyIiwgMCkgIT09IDApIHsKICAgICAgICAgICAgdGhyb3cgIlVuZXhwZWN0ZWQgZmlsZSBpZGVudGlmaWVyIHN0cmluZyAoZXhwZWN0IExlcmMyICk6ICIgKyBoZWFkZXJJbmZvLmZpbGVJZGVudGlmaWVyU3RyaW5nOwogICAgICAgICAgfQogICAgICAgICAgcHRyICs9IDY7CiAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgcHRyLCA4KTsKICAgICAgICAgIHZhciBmaWxlVmVyc2lvbiA9IHZpZXcuZ2V0SW50MzIoMCwgdHJ1ZSk7CiAgICAgICAgICBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uID0gZmlsZVZlcnNpb247CiAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgIGlmIChmaWxlVmVyc2lvbiA+PSAzKSB7CiAgICAgICAgICAgIGhlYWRlckluZm8uY2hlY2tzdW0gPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsgLy9ucm93cwogICAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICAvL2tleXMgc3RhcnQgZnJvbSBoZXJlCiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDEyKTsKICAgICAgICAgIGhlYWRlckluZm8uaGVpZ2h0ID0gdmlldy5nZXRVaW50MzIoMCwgdHJ1ZSk7IC8vbnJvd3MKICAgICAgICAgIGhlYWRlckluZm8ud2lkdGggPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsgLy9uY29scwogICAgICAgICAgcHRyICs9IDg7CiAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gNCkgewogICAgICAgICAgICBoZWFkZXJJbmZvLm51bURpbXMgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaGVhZGVySW5mby5udW1EaW1zID0gMTsKICAgICAgICAgIH0KCiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDQwKTsKICAgICAgICAgIGhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICAgICAgaGVhZGVySW5mby5taWNyb0Jsb2NrU2l6ZSA9IHZpZXcuZ2V0SW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgICBoZWFkZXJJbmZvLmJsb2JTaXplID0gdmlldy5nZXRJbnQzMig4LCB0cnVlKTsKICAgICAgICAgIGhlYWRlckluZm8uaW1hZ2VUeXBlID0gdmlldy5nZXRJbnQzMigxMiwgdHJ1ZSk7CgogICAgICAgICAgaGVhZGVySW5mby5tYXhaRXJyb3IgPSB2aWV3LmdldEZsb2F0NjQoMTYsIHRydWUpOwogICAgICAgICAgaGVhZGVySW5mby56TWluID0gdmlldy5nZXRGbG9hdDY0KDI0LCB0cnVlKTsKICAgICAgICAgIGhlYWRlckluZm8uek1heCA9IHZpZXcuZ2V0RmxvYXQ2NCgzMiwgdHJ1ZSk7CiAgICAgICAgICBwdHIgKz0gNDA7CiAgICAgICAgICBkYXRhLmhlYWRlckluZm8gPSBoZWFkZXJJbmZvOwogICAgICAgICAgZGF0YS5wdHIgPSBwdHI7CgogICAgICAgICAgdmFyIGNoZWNrc3VtLCBrZXlMZW5ndGg7CiAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAgICBrZXlMZW5ndGggPSBmaWxlVmVyc2lvbiA+PSA0ID8gNTIgOiA0ODsKICAgICAgICAgICAgY2hlY2tzdW0gPSB0aGlzLmNvbXB1dGVDaGVja3N1bUZsZXRjaGVyMzIobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciAtIGtleUxlbmd0aCwgaGVhZGVySW5mby5ibG9iU2l6ZSAtIDE0KSk7CiAgICAgICAgICAgIGlmIChjaGVja3N1bSAhPT0gaGVhZGVySW5mby5jaGVja3N1bSkgewogICAgICAgICAgICAgIHRocm93ICJDaGVja3N1bSBmYWlsZWQuIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgY2hlY2tNaW5NYXhSYW5nZXM6IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBPdXRQaXhlbFR5cGVBcnJheSA9IHRoaXMuZ2V0RGF0YVR5cGVBcnJheShoZWFkZXJJbmZvLmltYWdlVHlwZSk7CiAgICAgICAgICB2YXIgcmFuZ2VCeXRlcyA9IGhlYWRlckluZm8ubnVtRGltcyAqIHRoaXMuZ2V0RGF0YVR5cGVTaXplKGhlYWRlckluZm8uaW1hZ2VUeXBlKTsKICAgICAgICAgIHZhciBtaW5WYWx1ZXMgPSB0aGlzLnJlYWRTdWJBcnJheShpbnB1dCwgZGF0YS5wdHIsIE91dFBpeGVsVHlwZUFycmF5LCByYW5nZUJ5dGVzKTsKICAgICAgICAgIHZhciBtYXhWYWx1ZXMgPSB0aGlzLnJlYWRTdWJBcnJheShpbnB1dCwgZGF0YS5wdHIgKyByYW5nZUJ5dGVzLCBPdXRQaXhlbFR5cGVBcnJheSwgcmFuZ2VCeXRlcyk7CiAgICAgICAgICBkYXRhLnB0ciArPSAoMiAqIHJhbmdlQnl0ZXMpOwogICAgICAgICAgdmFyIGksIGVxdWFsID0gdHJ1ZTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWFkZXJJbmZvLm51bURpbXM7IGkrKykgewogICAgICAgICAgICBpZiAobWluVmFsdWVzW2ldICE9PSBtYXhWYWx1ZXNbaV0pIHsKICAgICAgICAgICAgICBlcXVhbCA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBoZWFkZXJJbmZvLm1pblZhbHVlcyA9IG1pblZhbHVlczsKICAgICAgICAgIGhlYWRlckluZm8ubWF4VmFsdWVzID0gbWF4VmFsdWVzOwogICAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgICAgIH0sCgogICAgICAgIHJlYWRTdWJBcnJheTogZnVuY3Rpb24oaW5wdXQsIHB0ciwgT3V0UGl4ZWxUeXBlQXJyYXksIG51bUJ5dGVzKSB7CiAgICAgICAgICB2YXIgcmF3RGF0YTsKICAgICAgICAgIGlmIChPdXRQaXhlbFR5cGVBcnJheSA9PT0gVWludDhBcnJheSkgewogICAgICAgICAgICByYXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmF3RGF0YTsKICAgICAgICB9LAoKICAgICAgICByZWFkTWFzazogZnVuY3Rpb24oaW5wdXQsIGRhdGEpIHsKICAgICAgICAgIHZhciBwdHIgPSBkYXRhLnB0cjsKICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodDsKICAgICAgICAgIHZhciBudW1WYWxpZFBpeGVsID0gaGVhZGVySW5mby5udW1WYWxpZFBpeGVsOwoKICAgICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDQpOwogICAgICAgICAgdmFyIG1hc2sgPSB7fTsKICAgICAgICAgIG1hc2subnVtQnl0ZXMgPSB2aWV3LmdldFVpbnQzMigwLCB0cnVlKTsKICAgICAgICAgIHB0ciArPSA0OwoKICAgICAgICAgIC8vIE1hc2sgRGF0YQogICAgICAgICAgaWYgKCgwID09PSBudW1WYWxpZFBpeGVsIHx8IG51bVBpeGVscyA9PT0gbnVtVmFsaWRQaXhlbCkgJiYgMCAhPT0gbWFzay5udW1CeXRlcykgewogICAgICAgICAgICB0aHJvdyAoImludmFsaWQgbWFzayIpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGJpdHNldCwgcmVzdWx0TWFzazsKICAgICAgICAgIGlmIChudW1WYWxpZFBpeGVsID09PSAwKSB7CiAgICAgICAgICAgIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChudW1QaXhlbHMgLyA4KSk7CiAgICAgICAgICAgIG1hc2suYml0c2V0ID0gYml0c2V0OwogICAgICAgICAgICByZXN1bHRNYXNrID0gbmV3IFVpbnQ4QXJyYXkobnVtUGl4ZWxzKTsKICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0TWFzayA9IHJlc3VsdE1hc2s7CiAgICAgICAgICAgIHB0ciArPSBtYXNrLm51bUJ5dGVzOwogICAgICAgICAgfS8vID8/Pz8/IGVsc2UgaWYgKGRhdGEubWFzay5udW1CeXRlcyA+IDAgJiYgZGF0YS5tYXNrLm51bUJ5dGVzPCBkYXRhLm51bVZhbGlkUGl4ZWwpIHsKICAgICAgICAgIGVsc2UgaWYgKG1hc2subnVtQnl0ZXMgPiAwKSB7CiAgICAgICAgICAgIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChudW1QaXhlbHMgLyA4KSk7CiAgICAgICAgICAgIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIHB0ciwgbWFzay5udW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBjbnQgPSB2aWV3LmdldEludDE2KDAsIHRydWUpOwogICAgICAgICAgICB2YXIgaXAgPSAyLCBvcCA9IDAsIHZhbCA9IDA7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBpZiAoY250ID4gMCkgewogICAgICAgICAgICAgICAgd2hpbGUgKGNudC0tKSB7IGJpdHNldFtvcCsrXSA9IHZpZXcuZ2V0VWludDgoaXArKyk7IH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFsID0gdmlldy5nZXRVaW50OChpcCsrKTsKICAgICAgICAgICAgICAgIGNudCA9IC1jbnQ7CiAgICAgICAgICAgICAgICB3aGlsZSAoY250LS0pIHsgYml0c2V0W29wKytdID0gdmFsOyB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNudCA9IHZpZXcuZ2V0SW50MTYoaXAsIHRydWUpOwogICAgICAgICAgICAgIGlwICs9IDI7CiAgICAgICAgICAgIH0gd2hpbGUgKGlwIDwgbWFzay5udW1CeXRlcyk7CiAgICAgICAgICAgIGlmICgoY250ICE9PSAtMzI3NjgpIHx8IChvcCA8IGJpdHNldC5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgdGhyb3cgIlVuZXhwZWN0ZWQgZW5kIG9mIG1hc2sgUkxFIGVuY29kaW5nIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0TWFzayA9IG5ldyBVaW50OEFycmF5KG51bVBpeGVscyk7CiAgICAgICAgICAgIHZhciBtYiA9IDAsIGsgPSAwOwoKICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgaWYgKGsgJiA3KSB7CiAgICAgICAgICAgICAgICBtYiA9IGJpdHNldFtrID4+IDNdOwogICAgICAgICAgICAgICAgbWIgPDw9IGsgJiA3OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1iID0gYml0c2V0W2sgPj4gM107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChtYiAmIDEyOCkgewogICAgICAgICAgICAgICAgcmVzdWx0TWFza1trXSA9IDE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdE1hc2sgPSByZXN1bHRNYXNrOwoKICAgICAgICAgICAgbWFzay5iaXRzZXQgPSBiaXRzZXQ7CiAgICAgICAgICAgIHB0ciArPSBtYXNrLm51bUJ5dGVzOwogICAgICAgICAgfQogICAgICAgICAgZGF0YS5wdHIgPSBwdHI7CiAgICAgICAgICBkYXRhLm1hc2sgPSBtYXNrOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZERhdGFPbmVTd2VlcDogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgcHRyID0gZGF0YS5wdHI7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBudW1EaW1zID0gaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodDsKICAgICAgICAgIHZhciBpbWFnZVR5cGUgPSBoZWFkZXJJbmZvLmltYWdlVHlwZTsKICAgICAgICAgIHZhciBudW1CeXRlcyA9IGhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCAqIExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUoaW1hZ2VUeXBlKSAqIG51bURpbXM7CiAgICAgICAgICAvL2RhdGEucGl4ZWxzLm51bUJ5dGVzID0gbnVtQnl0ZXM7CiAgICAgICAgICB2YXIgcmF3RGF0YTsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIGlmIChPdXRQaXhlbFR5cGVBcnJheSA9PT0gVWludDhBcnJheSkgewogICAgICAgICAgICByYXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmF3RGF0YS5sZW5ndGggPT09IG51bVBpeGVscyAqIG51bURpbXMpIHsKICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzID0gcmF3RGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgIC8vbWFzawogICAgICAgICAgewogICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobnVtUGl4ZWxzICogbnVtRGltcyk7CiAgICAgICAgICAgIHZhciB6ID0gMCwgayA9IDAsIGkgPSAwLCBuU3RhcnQgPSAwOwogICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICBmb3IgKGk9MDsgaSA8IG51bURpbXM7IGkrKykgewogICAgICAgICAgICAgICAgblN0YXJ0ID0gaSAqIG51bVBpeGVsczsKICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICAgICAgICBpZiAobWFza1trXSkgewogICAgICAgICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVsc1tuU3RhcnQgKyBrXSA9IHJhd0RhdGFbeisrXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgbnVtUGl4ZWxzOyBrKyspIHsKICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVsc1trXSA9IHJhd0RhdGFbeisrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHB0ciArPSBudW1CeXRlczsKICAgICAgICAgIGRhdGEucHRyID0gcHRyOyAgICAgICAvL3JldHVybiBkYXRhOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZEh1ZmZtYW5UcmVlOiBmdW5jdGlvbihpbnB1dCwgZGF0YSkgewogICAgICAgICAgdmFyIEJJVFNfTUFYID0gdGhpcy5IVUZGTUFOX0xVVF9CSVRTX01BWDsgLy84IGlzIHNsb3cgZm9yIHRoZSBsYXJnZSB0ZXN0IGltYWdlCiAgICAgICAgICAvL3ZhciBzaXplX21heCA9IDEgPDwgQklUU19NQVg7CiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIHJlYWRpbmcgY29kZSB0YWJsZQogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIDE2KTsKICAgICAgICAgIGRhdGEucHRyICs9IDE2OwogICAgICAgICAgdmFyIHZlcnNpb24gPSB2aWV3LmdldEludDMyKDAsIHRydWUpOwogICAgICAgICAgaWYgKHZlcnNpb24gPCAyKSB7CiAgICAgICAgICAgIHRocm93ICJ1bnN1cHBvcnRlZCBIdWZmbWFuIHZlcnNpb24iOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHNpemUgPSB2aWV3LmdldEludDMyKDQsIHRydWUpOwogICAgICAgICAgdmFyIGkwID0gdmlldy5nZXRJbnQzMig4LCB0cnVlKTsKICAgICAgICAgIHZhciBpMSA9IHZpZXcuZ2V0SW50MzIoMTIsIHRydWUpOwogICAgICAgICAgaWYgKGkwID49IGkxKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBibG9ja0RhdGFCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoaTEgLSBpMCk7CiAgICAgICAgICBMZXJjMkhlbHBlcnMuZGVjb2RlQml0cyhpbnB1dCwgZGF0YSwgYmxvY2tEYXRhQnVmZmVyKTsKICAgICAgICAgIHZhciBjb2RlVGFibGUgPSBbXTsgLy9zaXplCiAgICAgICAgICB2YXIgaSwgaiwgaywgbGVuOwoKICAgICAgICAgIGZvciAoaSA9IGkwOyBpIDwgaTE7IGkrKykgewogICAgICAgICAgICBqID0gaSAtIChpIDwgc2l6ZSA/IDAgOiBzaXplKTsvL3dyYXAgYXJvdW5kCiAgICAgICAgICAgIGNvZGVUYWJsZVtqXSA9IHsgZmlyc3Q6IGJsb2NrRGF0YUJ1ZmZlcltpIC0gaTBdLCBzZWNvbmQ6IG51bGwgfTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGF0YUJ5dGVzID0gaW5wdXQuYnl0ZUxlbmd0aCAtIGRhdGEucHRyOwogICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IE1hdGguY2VpbChkYXRhQnl0ZXMgLyA0KTsKICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihkYXRhV29yZHMgKiA0KTsKICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICB2YXIgc3R1ZmZlZERhdGEgPSBuZXcgVWludDMyQXJyYXkoYXJyYXlCdWYpOyAvL211c3Qgc3RhcnQgZnJvbSB4KjQKICAgICAgICAgIHZhciBiaXRQb3MgPSAwLCB3b3JkLCBzcmNQdHIgPSAwOwogICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhWzBdOwogICAgICAgICAgZm9yIChpID0gaTA7IGkgPCBpMTsgaSsrKSB7CiAgICAgICAgICAgIGogPSBpIC0gKGkgPCBzaXplID8gMCA6IHNpemUpOy8vd3JhcCBhcm91bmQKICAgICAgICAgICAgbGVuID0gY29kZVRhYmxlW2pdLmZpcnN0OwogICAgICAgICAgICBpZiAobGVuID4gMCkgewogICAgICAgICAgICAgIGNvZGVUYWJsZVtqXS5zZWNvbmQgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBsZW4pOwoKICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPj0gbGVuKSB7CiAgICAgICAgICAgICAgICBiaXRQb3MgKz0gbGVuOwogICAgICAgICAgICAgICAgaWYgKGJpdFBvcyA9PT0gMzIpIHsKICAgICAgICAgICAgICAgICAgYml0UG9zID0gMDsKICAgICAgICAgICAgICAgICAgc3JjUHRyKys7CiAgICAgICAgICAgICAgICAgIHdvcmQgPSBzdHVmZmVkRGF0YVtzcmNQdHJdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGJpdFBvcyArPSBsZW4gLSAzMjsKICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICBjb2RlVGFibGVbal0uc2Vjb25kIHw9IHdvcmQgPj4+ICgzMiAtIGJpdFBvcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy9maW5pc2hlZCByZWFkaW5nIGNvZGUgdGFibGUKCiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIGJ1aWxkaW5nIGx1dAogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgbnVtQml0c0xVVCA9IDAsIG51bUJpdHNMVVRRaWNrID0gMDsKICAgICAgICAgIHZhciB0cmVlID0gbmV3IFRyZWVOb2RlKCk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29kZVRhYmxlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb2RlVGFibGVbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIG51bUJpdHNMVVQgPSBNYXRoLm1heChudW1CaXRzTFVULCBjb2RlVGFibGVbaV0uZmlyc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobnVtQml0c0xVVCA+PSBCSVRTX01BWCkgewogICAgICAgICAgICBudW1CaXRzTFVUUWljayA9IEJJVFNfTUFYOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG51bUJpdHNMVVRRaWNrID0gbnVtQml0c0xVVDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChudW1CaXRzTFVUID49IDMwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJXQVJuaW5nLCBsYXJnZSBOVU0gTFVUIEJJVFMgSVMgIiArIG51bUJpdHNMVVQpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGRlY29kZUx1dCA9IFtdLCBlbnRyeSwgY29kZSwgbnVtRW50cmllcywgamosIGN1cnJlbnRCaXQsIG5vZGU7CiAgICAgICAgICBmb3IgKGkgPSBpMDsgaSA8IGkxOyBpKyspIHsKICAgICAgICAgICAgaiA9IGkgLSAoaSA8IHNpemUgPyAwIDogc2l6ZSk7Ly93cmFwIGFyb3VuZAogICAgICAgICAgICBsZW4gPSBjb2RlVGFibGVbal0uZmlyc3Q7CiAgICAgICAgICAgIGlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgZW50cnkgPSBbbGVuLCBqXTsKICAgICAgICAgICAgICBpZiAobGVuIDw9IG51bUJpdHNMVVRRaWNrKSB7CiAgICAgICAgICAgICAgICBjb2RlID0gY29kZVRhYmxlW2pdLnNlY29uZCA8PCAobnVtQml0c0xVVFFpY2sgLSBsZW4pOwogICAgICAgICAgICAgICAgbnVtRW50cmllcyA9IDEgPDwgKG51bUJpdHNMVVRRaWNrIC0gbGVuKTsKICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1FbnRyaWVzOyBrKyspIHsKICAgICAgICAgICAgICAgICAgZGVjb2RlTHV0W2NvZGUgfCBrXSA9IGVudHJ5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vYnVpbGQgdHJlZQogICAgICAgICAgICAgICAgY29kZSA9IGNvZGVUYWJsZVtqXS5zZWNvbmQ7CiAgICAgICAgICAgICAgICBub2RlID0gdHJlZTsKICAgICAgICAgICAgICAgIGZvciAoamogPSBsZW4gLSAxOyBqaiA+PSAwOyBqai0tKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRCaXQgPSBjb2RlID4+PiBqaiAmIDE7IC8vbm8gbGVmdCBzaGlmdCBhcyBsZW5ndGggY291bGQgYmUgMzAsMzEKICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRCaXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW5vZGUucmlnaHQpIHsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmlnaHQgPSBuZXcgVHJlZU5vZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlLmxlZnQpIHsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUubGVmdCA9IG5ldyBUcmVlTm9kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChqaiA9PT0gMCAmJiAhbm9kZS52YWwpIHsKICAgICAgICAgICAgICAgICAgICBub2RlLnZhbCA9IGVudHJ5WzFdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkZWNvZGVMdXQ6IGRlY29kZUx1dCwKICAgICAgICAgICAgbnVtQml0c0xVVFFpY2s6IG51bUJpdHNMVVRRaWNrLAogICAgICAgICAgICBudW1CaXRzTFVUOiBudW1CaXRzTFVULAogICAgICAgICAgICB0cmVlOiB0cmVlLAogICAgICAgICAgICBzdHVmZmVkRGF0YTogc3R1ZmZlZERhdGEsCiAgICAgICAgICAgIHNyY1B0cjogc3JjUHRyLAogICAgICAgICAgICBiaXRQb3M6IGJpdFBvcwogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICByZWFkSHVmZm1hbjogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBudW1EaW1zID0gaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIGhlaWdodCA9IGRhdGEuaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgICB2YXIgd2lkdGggPSBkYXRhLmhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgbnVtUGl4ZWxzID0gd2lkdGggKiBoZWlnaHQ7CiAgICAgICAgICAvL3ZhciBzaXplX21heCA9IDEgPDwgQklUU19NQVg7CiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIHJlYWRpbmcgaHVmZm1hbiBzdHJ1Y3R1cmUgaW5mbwogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgaHVmZm1hbkluZm8gPSB0aGlzLnJlYWRIdWZmbWFuVHJlZShpbnB1dCwgZGF0YSk7CiAgICAgICAgICB2YXIgZGVjb2RlTHV0ID0gaHVmZm1hbkluZm8uZGVjb2RlTHV0OwogICAgICAgICAgdmFyIHRyZWUgPSBodWZmbWFuSW5mby50cmVlOwogICAgICAgICAgLy9zdHVmZmVkRGF0YSBpbmNsdWRlcyBodWZmbWFuIGhlYWRlcnMKICAgICAgICAgIHZhciBzdHVmZmVkRGF0YSA9IGh1ZmZtYW5JbmZvLnN0dWZmZWREYXRhOwogICAgICAgICAgdmFyIHNyY1B0ciA9IGh1ZmZtYW5JbmZvLnNyY1B0cjsKICAgICAgICAgIHZhciBiaXRQb3MgPSBodWZmbWFuSW5mby5iaXRQb3M7CiAgICAgICAgICB2YXIgbnVtQml0c0xVVFFpY2sgPSBodWZmbWFuSW5mby5udW1CaXRzTFVUUWljazsKICAgICAgICAgIHZhciBudW1CaXRzTFVUID0gaHVmZm1hbkluZm8ubnVtQml0c0xVVDsKICAgICAgICAgIHZhciBvZmZzZXQgPSBkYXRhLmhlYWRlckluZm8uaW1hZ2VUeXBlID09PSAwID8gMTI4IDogMDsKICAgICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICAqICBkZWNvZGUKICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgICAgIHZhciBub2RlLCB2YWwsIGRlbHRhLCBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzaywgdmFsVG1wLCB2YWxUbXBRdWljaywgY3VycmVudEJpdDsKICAgICAgICAgIHZhciBpLCBqLCBrLCBpaTsKICAgICAgICAgIHZhciBwcmV2VmFsID0gMDsKICAgICAgICAgIGlmIChiaXRQb3MgPiAwKSB7CiAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICBiaXRQb3MgPSAwOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHdvcmQgPSBzdHVmZmVkRGF0YVtzcmNQdHJdOwogICAgICAgICAgdmFyIGRlbHRhRW5jb2RlID0gZGF0YS5lbmNvZGVNb2RlID09PSAxOwogICAgICAgICAgdmFyIHJlc3VsdFBpeGVsc0FsbERpbSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShudW1QaXhlbHMgKiBudW1EaW1zKTsKICAgICAgICAgIHZhciByZXN1bHRQaXhlbHMgPSByZXN1bHRQaXhlbHNBbGxEaW07CiAgICAgICAgICB2YXIgaURpbTsKICAgICAgICAgIGZvciAoaURpbSA9IDA7IGlEaW0gPCBoZWFkZXJJbmZvLm51bURpbXM7IGlEaW0rKykgewogICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICAvL2dldCB0aGUgbWVtIGJsb2NrIG9mIGN1cnJlbnQgZGltZW5zaW9uCiAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KHJlc3VsdFBpeGVsc0FsbERpbS5idWZmZXIsIG51bVBpeGVscyAqIGlEaW0sIG51bVBpeGVscyk7CiAgICAgICAgICAgICAgcHJldlZhbCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGEuaGVhZGVySW5mby5udW1WYWxpZFBpeGVsID09PSB3aWR0aCAqIGhlaWdodCkgeyAvL2FsbCB2YWxpZAogICAgICAgICAgICAgIGZvciAoayA9IDAsIGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrLCBrKyspIHsKICAgICAgICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgICAgICAgICAgdmFsVG1wID0gKHdvcmQgPDwgYml0UG9zKSA+Pj4gKDMyIC0gbnVtQml0c0xVVFFpY2spOwogICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPCBudW1CaXRzTFVUUWljaykgewogICAgICAgICAgICAgICAgICAgIHZhbFRtcCB8PSAoKHN0dWZmZWREYXRhW3NyY1B0ciArIDFdKSA+Pj4gKDY0IC0gYml0UG9zIC0gbnVtQml0c0xVVFFpY2spKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkZWNvZGVMdXRbdmFsVG1wUXVpY2tdKSAgICAvLyBpZiB0aGVyZSwgbW92ZSB0aGUgY29ycmVjdCBudW1iZXIgb2YgYml0cyBhbmQgZG9uZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVsxXTsKICAgICAgICAgICAgICAgICAgICBiaXRQb3MgKz0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVswXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWxUbXAgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBudW1CaXRzTFVUKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVQpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcCB8PSAoKHN0dWZmZWREYXRhW3NyY1B0ciArIDFdKSA+Pj4gKDY0IC0gYml0UG9zIC0gbnVtQml0c0xVVCkpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IHRyZWU7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpaSA9IDA7IGlpIDwgbnVtQml0c0xVVDsgaWkrKykgewogICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJpdCA9IHZhbFRtcCA+Pj4gKG51bUJpdHNMVVQgLSBpaSAtIDEpICYgMTsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBjdXJyZW50Qml0ID8gbm9kZS5yaWdodCA6IG5vZGUubGVmdDsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKG5vZGUubGVmdCB8fCBub2RlLnJpZ2h0KSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBub2RlLnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgYml0UG9zID0gYml0UG9zICsgaWkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChiaXRQb3MgPj0gMzIpIHsKICAgICAgICAgICAgICAgICAgICBiaXRQb3MgLT0gMzI7CiAgICAgICAgICAgICAgICAgICAgc3JjUHRyKys7CiAgICAgICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGRlbHRhID0gdmFsIC0gb2Zmc2V0OwogICAgICAgICAgICAgICAgICBpZiAoZGVsdGFFbmNvZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaiA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGRlbHRhICs9IHByZXZWYWw7ICAgIC8vIHVzZSBvdmVyZmxvdwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcmVzdWx0UGl4ZWxzW2sgLSB3aWR0aF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcHJldlZhbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGVsdGEgJj0gMHhGRjsgLy9vdmVyZmxvdwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1trXSA9IGRlbHRhOy8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICBwcmV2VmFsID0gZGVsdGE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW2tdID0gZGVsdGE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7IC8vbm90IGFsbCB2YWxpZCwgdXNlIG1hc2sKICAgICAgICAgICAgICBmb3IgKGsgPSAwLCBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKywgaysrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgICAgICAgICAgICB2YWxUbXAgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBudW1CaXRzTFVUUWljayk7CiAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPCBudW1CaXRzTFVUUWljaykgewogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wIHw9ICgoc3R1ZmZlZERhdGFbc3JjUHRyICsgMV0pID4+PiAoNjQgLSBiaXRQb3MgLSBudW1CaXRzTFVUUWljaykpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlY29kZUx1dFt2YWxUbXBRdWlja10pICAgIC8vIGlmIHRoZXJlLCBtb3ZlIHRoZSBjb3JyZWN0IG51bWJlciBvZiBiaXRzIGFuZCBkb25lCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVsxXTsKICAgICAgICAgICAgICAgICAgICAgIGJpdFBvcyArPSBkZWNvZGVMdXRbdmFsVG1wUXVpY2tdWzBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcCA9ICh3b3JkIDw8IGJpdFBvcykgPj4+ICgzMiAtIG51bUJpdHNMVVQpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsVG1wIHw9ICgoc3R1ZmZlZERhdGFbc3JjUHRyICsgMV0pID4+PiAoNjQgLSBiaXRQb3MgLSBudW1CaXRzTFVUKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcFF1aWNrID0gdmFsVG1wOy8vID4+PiBkZWx0YUJpdHM7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBub2RlID0gdHJlZTsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoaWkgPSAwOyBpaSA8IG51bUJpdHNMVVQ7IGlpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJpdCA9IHZhbFRtcCA+Pj4gKG51bUJpdHNMVVQgLSBpaSAtIDEpICYgMTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGN1cnJlbnRCaXQgPyBub2RlLnJpZ2h0IDogbm9kZS5sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShub2RlLmxlZnQgfHwgbm9kZS5yaWdodCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBub2RlLnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRQb3MgPSBiaXRQb3MgKyBpaSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChiaXRQb3MgPj0gMzIpIHsKICAgICAgICAgICAgICAgICAgICAgIGJpdFBvcyAtPSAzMjsKICAgICAgICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBkZWx0YSA9IHZhbCAtIG9mZnNldDsKICAgICAgICAgICAgICAgICAgICBpZiAoZGVsdGFFbmNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChqID4gMCAmJiBtYXNrW2sgLSAxXSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSBwcmV2VmFsOyAgICAvLyB1c2Ugb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGkgPiAwICYmIG1hc2tbayAtIHdpZHRoXSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSByZXN1bHRQaXhlbHNbayAtIHdpZHRoXTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSBwcmV2VmFsOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGRlbHRhICY9IDB4RkY7IC8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1trXSA9IGRlbHRhOy8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIHByZXZWYWwgPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNba10gPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YS5wdHIgPSBkYXRhLnB0ciArIChzcmNQdHIgKyAxKSAqIDQgKyAoYml0UG9zID4gMCA/IDQgOiAwKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscyA9IHJlc3VsdFBpeGVsc0FsbERpbTsKICAgICAgICB9LAoKICAgICAgICBkZWNvZGVCaXRzOiBmdW5jdGlvbihpbnB1dCwgZGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBvZmZzZXQsIGlEaW0pIHsKICAgICAgICAgIHsKICAgICAgICAgICAgLy9iaXRzdHVmZiBlbmNvZGluZyBpcyAzCiAgICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgICB2YXIgZmlsZVZlcnNpb24gPSBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uOwogICAgICAgICAgICAvL3ZhciBibG9jayA9IHt9OwogICAgICAgICAgICB2YXIgYmxvY2tQdHIgPSAwOwogICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIDUpOy8vdG8gZG8KICAgICAgICAgICAgdmFyIGhlYWRlckJ5dGUgPSB2aWV3LmdldFVpbnQ4KDApOwogICAgICAgICAgICBibG9ja1B0cisrOwogICAgICAgICAgICB2YXIgYml0czY3ID0gaGVhZGVyQnl0ZSA+PiA2OwogICAgICAgICAgICB2YXIgbiA9IChiaXRzNjcgPT09IDApID8gNCA6IDMgLSBiaXRzNjc7CiAgICAgICAgICAgIHZhciBkb0x1dCA9IChoZWFkZXJCeXRlICYgMzIpID4gMCA/IHRydWUgOiBmYWxzZTsvLzV0aCBiaXQKICAgICAgICAgICAgdmFyIG51bUJpdHMgPSBoZWFkZXJCeXRlICYgMzE7CiAgICAgICAgICAgIHZhciBudW1FbGVtZW50cyA9IDA7CiAgICAgICAgICAgIGlmIChuID09PSAxKSB7CiAgICAgICAgICAgICAgbnVtRWxlbWVudHMgPSB2aWV3LmdldFVpbnQ4KGJsb2NrUHRyKTsgYmxvY2tQdHIrKzsKICAgICAgICAgICAgfSBlbHNlIGlmIChuID09PSAyKSB7CiAgICAgICAgICAgICAgbnVtRWxlbWVudHMgPSB2aWV3LmdldFVpbnQxNihibG9ja1B0ciwgdHJ1ZSk7IGJsb2NrUHRyICs9IDI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobiA9PT0gNCkgewogICAgICAgICAgICAgIG51bUVsZW1lbnRzID0gdmlldy5nZXRVaW50MzIoYmxvY2tQdHIsIHRydWUpOyBibG9ja1B0ciArPSA0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93ICJJbnZhbGlkIHZhbGlkIHBpeGVsIGNvdW50IHR5cGUiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vZml4OiBodWZmbWFuIGNvZGVzIGFyZSBiaXQgc3R1ZmZlZCwgYnV0IG5vdCBib3VuZCBieSBkYXRhJ3MgbWF4IHZhbHVlLCBzbyBuZWVkIHRvIHVzZSBvcmlnaW5hbFVuc3R1ZmYKICAgICAgICAgICAgLy9vZmZzZXQgPSBvZmZzZXQgfHwgMDsKICAgICAgICAgICAgdmFyIHNjYWxlID0gMiAqIGhlYWRlckluZm8ubWF4WkVycm9yOwogICAgICAgICAgICB2YXIgc3R1ZmZlZERhdGEsIGFycmF5QnVmLCBzdG9yZTgsIGRhdGFCeXRlcywgZGF0YVdvcmRzOwogICAgICAgICAgICB2YXIgbHV0QXJyLCBsdXREYXRhLCBsdXRCeXRlcywgYml0c1BlclBpeGVsOwogICAgICAgICAgICB2YXIgek1heCA9IGhlYWRlckluZm8ubnVtRGltcyA+IDEgPyBoZWFkZXJJbmZvLm1heFZhbHVlc1tpRGltXSA6IGhlYWRlckluZm8uek1heDsKICAgICAgICAgICAgaWYgKGRvTHV0KSB7CiAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmx1dCsrOwogICAgICAgICAgICAgIGx1dEJ5dGVzID0gdmlldy5nZXRVaW50OChibG9ja1B0cik7CiAgICAgICAgICAgICAgYmxvY2tQdHIrKzsKICAgICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwoKGx1dEJ5dGVzIC0gMSkgKiBudW1CaXRzIC8gOCk7CiAgICAgICAgICAgICAgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKGRhdGFXb3JkcyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKCiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgc3RvcmU4LnNldChuZXcgVWludDhBcnJheShpbnB1dCwgZGF0YS5wdHIsIGRhdGFCeXRlcykpOwoKICAgICAgICAgICAgICBsdXREYXRhID0gbmV3IFVpbnQzMkFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBkYXRhLnB0ciArPSBkYXRhQnl0ZXM7CgogICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCA9IDA7CiAgICAgICAgICAgICAgd2hpbGUgKChsdXRCeXRlcyAtIDEpID4+PiBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCsrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwobnVtRWxlbWVudHMgKiBiaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgICBkYXRhV29yZHMgPSBNYXRoLmNlaWwoZGF0YUJ5dGVzIC8gNCk7CiAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgICAgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIGRhdGEucHRyLCBkYXRhQnl0ZXMpKTsKICAgICAgICAgICAgICBzdHVmZmVkRGF0YSA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gZGF0YUJ5dGVzOwogICAgICAgICAgICAgIGlmIChmaWxlVmVyc2lvbiA+PSAzKSB7CiAgICAgICAgICAgICAgICBsdXRBcnIgPSBCaXRTdHVmZmVyLnVuc3R1ZmZMVVQyKGx1dERhdGEsIG51bUJpdHMsIGx1dEJ5dGVzIC0gMSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbHV0QXJyID0gQml0U3R1ZmZlci51bnN0dWZmTFVUKGx1dERhdGEsIG51bUJpdHMsIGx1dEJ5dGVzIC0gMSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vbHV0QXJyLnVuc2hpZnQoMCk7CiAgICAgICAgICAgICAgaWYgKGZpbGVWZXJzaW9uID49IDMpIHsKICAgICAgICAgICAgICAgIC8vQml0U3R1ZmZlci51bnN0dWZmMihibG9jaywgYmxvY2tEYXRhQnVmZmVyLCBoZWFkZXJJbmZvLnpNYXgpOwogICAgICAgICAgICAgICAgQml0U3R1ZmZlci51bnN0dWZmMihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBsdXRBcnIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEJpdFN0dWZmZXIudW5zdHVmZihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBsdXRBcnIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoImJpdHN0dWZmZXIiKTsKICAgICAgICAgICAgICBkYXRhLmNvdW50ZXIuYml0c3R1ZmZlcisrOwogICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCA9IG51bUJpdHM7CiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgaWYgKGJpdHNQZXJQaXhlbCA+IDApIHsKICAgICAgICAgICAgICAgIGRhdGFCeXRlcyA9IE1hdGguY2VpbChudW1FbGVtZW50cyAqIGJpdHNQZXJQaXhlbCAvIDgpOwogICAgICAgICAgICAgICAgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgICAgICBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICAgICAgICBzdHVmZmVkRGF0YSA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBkYXRhQnl0ZXM7CiAgICAgICAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLm9yaWdpbmFsVW5zdHVmZjIoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgQml0U3R1ZmZlci51bnN0dWZmMihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBmYWxzZSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLm9yaWdpbmFsVW5zdHVmZihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLnVuc3R1ZmYoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cywgZmFsc2UsIG9mZnNldCwgc2NhbGUsIHpNYXgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIHJlYWRUaWxlczogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciB3aWR0aCA9IGhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgICB2YXIgbWljcm9CbG9ja1NpemUgPSBoZWFkZXJJbmZvLm1pY3JvQmxvY2tTaXplOwogICAgICAgICAgdmFyIGltYWdlVHlwZSA9IGhlYWRlckluZm8uaW1hZ2VUeXBlOwogICAgICAgICAgdmFyIGRhdGFUeXBlU2l6ZSA9IExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUoaW1hZ2VUeXBlKTsKICAgICAgICAgIHZhciBudW1CbG9ja3NYID0gTWF0aC5jZWlsKHdpZHRoIC8gbWljcm9CbG9ja1NpemUpOwogICAgICAgICAgdmFyIG51bUJsb2Nrc1kgPSBNYXRoLmNlaWwoaGVpZ2h0IC8gbWljcm9CbG9ja1NpemUpOwogICAgICAgICAgZGF0YS5waXhlbHMubnVtQmxvY2tzWSA9IG51bUJsb2Nrc1k7CiAgICAgICAgICBkYXRhLnBpeGVscy5udW1CbG9ja3NYID0gbnVtQmxvY2tzWDsKICAgICAgICAgIGRhdGEucGl4ZWxzLnB0ciA9IDA7CiAgICAgICAgICB2YXIgcm93ID0gMCwgY29sID0gMCwgYmxvY2tZID0gMCwgYmxvY2tYID0gMCwgdGhpc0Jsb2NrSGVpZ2h0ID0gMCwgdGhpc0Jsb2NrV2lkdGggPSAwLCBieXRlc0xlZnQgPSAwLCBoZWFkZXJCeXRlID0gMCwgYml0czY3ID0gMCwgdGVzdENvZGUgPSAwLCBvdXRQdHIgPSAwLCBvdXRTdHJpZGUgPSAwLCBudW1CeXRlcyA9IDAsIGJ5dGVzbGVmdCA9IDAsIHogPSAwLCBibG9ja1B0ciA9IDA7CiAgICAgICAgICB2YXIgdmlldywgYmxvY2ssIGFycmF5QnVmLCBzdG9yZTgsIHJhd0RhdGE7CiAgICAgICAgICB2YXIgYmxvY2tFbmNvZGluZzsKICAgICAgICAgIHZhciBibG9ja0RhdGFCdWZmZXIgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobWljcm9CbG9ja1NpemUgKiBtaWNyb0Jsb2NrU2l6ZSk7CiAgICAgICAgICB2YXIgbGFzdEJsb2NrSGVpZ2h0ID0gKGhlaWdodCAlIG1pY3JvQmxvY2tTaXplKSB8fCBtaWNyb0Jsb2NrU2l6ZTsKICAgICAgICAgIHZhciBsYXN0QmxvY2tXaWR0aCA9ICh3aWR0aCAlIG1pY3JvQmxvY2tTaXplKSB8fCBtaWNyb0Jsb2NrU2l6ZTsKICAgICAgICAgIHZhciBvZmZzZXRUeXBlLCBvZmZzZXQ7CiAgICAgICAgICB2YXIgbnVtRGltcyA9IGhlYWRlckluZm8ubnVtRGltcywgaURpbTsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIHZhciByZXN1bHRQaXhlbHMgPSBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHM7CiAgICAgICAgICBmb3IgKGJsb2NrWSA9IDA7IGJsb2NrWSA8IG51bUJsb2Nrc1k7IGJsb2NrWSsrKSB7CiAgICAgICAgICAgIHRoaXNCbG9ja0hlaWdodCA9IChibG9ja1kgIT09IG51bUJsb2Nrc1kgLSAxKSA/IG1pY3JvQmxvY2tTaXplIDogbGFzdEJsb2NrSGVpZ2h0OwogICAgICAgICAgICBmb3IgKGJsb2NrWCA9IDA7IGJsb2NrWCA8IG51bUJsb2Nrc1g7IGJsb2NrWCsrKSB7CiAgICAgICAgICAgICAgLy9jb25zb2xlLmRlYnVnKCJ5IiArIGJsb2NrWSArICIgeCIgKyBibG9ja1gpOwogICAgICAgICAgICAgIHRoaXNCbG9ja1dpZHRoID0gKGJsb2NrWCAhPT0gbnVtQmxvY2tzWCAtIDEpID8gbWljcm9CbG9ja1NpemUgOiBsYXN0QmxvY2tXaWR0aDsKCiAgICAgICAgICAgICAgb3V0UHRyID0gYmxvY2tZICogd2lkdGggKiBtaWNyb0Jsb2NrU2l6ZSArIGJsb2NrWCAqIG1pY3JvQmxvY2tTaXplOwogICAgICAgICAgICAgIG91dFN0cmlkZSA9IHdpZHRoIC0gdGhpc0Jsb2NrV2lkdGg7CgoKICAgICAgICAgICAgICBmb3IgKGlEaW0gPSAwOyBpRGltIDwgbnVtRGltczsgaURpbSsrKSB7CiAgICAgICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscy5idWZmZXIsIHdpZHRoICogaGVpZ2h0ICogaURpbSAqIGRhdGFUeXBlU2l6ZSwgd2lkdGggKiBoZWlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnl0ZXNMZWZ0ID0gaW5wdXQuYnl0ZUxlbmd0aCAtIGRhdGEucHRyOwogICAgICAgICAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIE1hdGgubWluKDEwLCBieXRlc0xlZnQpKTsKICAgICAgICAgICAgICAgIGJsb2NrID0ge307CiAgICAgICAgICAgICAgICBibG9ja1B0ciA9IDA7CiAgICAgICAgICAgICAgICBoZWFkZXJCeXRlID0gdmlldy5nZXRVaW50OCgwKTsKICAgICAgICAgICAgICAgIGJsb2NrUHRyKys7CiAgICAgICAgICAgICAgICBiaXRzNjcgPSAoaGVhZGVyQnl0ZSA+PiA2KSAmIDB4RkY7CiAgICAgICAgICAgICAgICB0ZXN0Q29kZSA9IChoZWFkZXJCeXRlID4+IDIpICYgMTU7ICAgIC8vIHVzZSBiaXRzIDIzNDUgZm9yIGludGVncml0eSBjaGVjawogICAgICAgICAgICAgICAgaWYgKHRlc3RDb2RlICE9PSAoKChibG9ja1ggKiBtaWNyb0Jsb2NrU2l6ZSkgPj4gMykgJiAxNSkpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgImludGVncml0eSBpc3N1ZSI7CiAgICAgICAgICAgICAgICAgIC8vcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJsb2NrRW5jb2RpbmcgPSBoZWFkZXJCeXRlICYgMzsKICAgICAgICAgICAgICAgIGlmIChibG9ja0VuY29kaW5nID4gMykgewogICAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBibG9ja1B0cjsKICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgZW5jb2RpbmcgKCIgKyBibG9ja0VuY29kaW5nICsgIikiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoYmxvY2tFbmNvZGluZyA9PT0gMikgeyAvL2NvbnN0YW50IDAKICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmNvbnN0YW50Kys7CiAgICAgICAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJsb2NrRW5jb2RpbmcgPT09IDApIHsgIC8vdW5jb21wcmVzc2VkCiAgICAgICAgICAgICAgICAgIGRhdGEuY291bnRlci51bmNvbXByZXNzZWQrKzsKICAgICAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgICAgIG51bUJ5dGVzID0gdGhpc0Jsb2NrSGVpZ2h0ICogdGhpc0Jsb2NrV2lkdGggKiBkYXRhVHlwZVNpemU7CiAgICAgICAgICAgICAgICAgIGJ5dGVzbGVmdCA9IGlucHV0LmJ5dGVMZW5ndGggLSBkYXRhLnB0cjsKICAgICAgICAgICAgICAgICAgbnVtQnl0ZXMgPSBudW1CeXRlcyA8IGJ5dGVzbGVmdCA/IG51bUJ5dGVzIDogYnl0ZXNsZWZ0OwogICAgICAgICAgICAgICAgICAvL2JpdCBhbGlnbm1lbnQKICAgICAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoKG51bUJ5dGVzICUgZGF0YVR5cGVTaXplKSA9PT0gMCA/IG51bUJ5dGVzIDogKG51bUJ5dGVzICsgZGF0YVR5cGVTaXplIC0gbnVtQnl0ZXMgJSBkYXRhVHlwZVNpemUpKTsKICAgICAgICAgICAgICAgICAgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICAgIHogPSAwOwogICAgICAgICAgICAgICAgICBpZiAobWFzaykgewogICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2tbb3V0UHRyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gcmF3RGF0YVt6KytdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0cisrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7Ly9hbGwgdmFsaWQKICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29sID0gMDsgY29sIDwgdGhpc0Jsb2NrV2lkdGg7IGNvbCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSByYXdEYXRhW3orK107CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSB6ICogZGF0YVR5cGVTaXplOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IC8vMSBvciAzCiAgICAgICAgICAgICAgICAgIG9mZnNldFR5cGUgPSBMZXJjMkhlbHBlcnMuZ2V0RGF0YVR5cGVVc2VkKGltYWdlVHlwZSwgYml0czY3KTsKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gTGVyYzJIZWxwZXJzLmdldE9uZVBpeGVsKGJsb2NrLCBibG9ja1B0ciwgb2Zmc2V0VHlwZSwgdmlldyk7CiAgICAgICAgICAgICAgICAgIGJsb2NrUHRyICs9IExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUob2Zmc2V0VHlwZSk7CiAgICAgICAgICAgICAgICAgIGlmIChibG9ja0VuY29kaW5nID09PSAzKSAvL2NvbnN0YW50IG9mZnNldCB2YWx1ZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmNvbnN0YW50b2Zmc2V0Kys7CiAgICAgICAgICAgICAgICAgICAgLy95b3UgY2FuIGRlbGV0ZSB0aGUgZm9sbG93aW5nIHJlc3VsdE1hc2sgY2FzZSBpbiBmYXZvciBvZiBwZXJmb3JtYW5jZSBiZWNhdXNlIHZhbCBpcyBjb25zdGFudCBhbmQgdXNlcnMgdXNlIG5vZGF0YSBtYXNrLCBvdGhlcndpc2Ugbm9kYXRhdmFsdWUgcG9zdCBwcm9jZXNzaW5nIGhhbmRsZXMgaXQgdG9vLgogICAgICAgICAgICAgICAgICAgIC8vd2hpbGUgdGhlIGFib3ZlIHN0YXRlbWVudCBpcyB0cnVlLCB3ZSdyZSBub3QgZG9pbmcgaXQgYXMgd2Ugd2FudCB0byBrZWVwIGludmFsaWQgcGl4ZWwgdmFsdWUgYXQgMCByYXRoZXIgdGhhbiBhcmJpdHJhcnkgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2spIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXNrW291dFB0cl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gb2Zmc2V0OwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7IC8vYml0c3R1ZmYgZW5jb2RpbmcgaXMgMwogICAgICAgICAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICAgICAgICAgIC8vaGVhdnkgbGlmdGluZwogICAgICAgICAgICAgICAgICAgIExlcmMySGVscGVycy5kZWNvZGVCaXRzKGlucHV0LCBkYXRhLCBibG9ja0RhdGFCdWZmZXIsIG9mZnNldCwgaURpbSk7CiAgICAgICAgICAgICAgICAgICAgYmxvY2tQdHIgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChtYXNrKSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFza1tvdXRQdHJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyXSA9IGJsb2NrRGF0YUJ1ZmZlcltibG9ja1B0cisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyKytdID0gYmxvY2tEYXRhQnVmZmVyW2Jsb2NrUHRyKytdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqCiAgICAgICAgKiAgcHJpdmF0ZSBtZXRob2RzIChoZWxwZXIgbWV0aG9kcykKICAgICAgICAqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgZm9ybWF0RmlsZUluZm86IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJmaWxlSWRlbnRpZmllclN0cmluZyI6IGRhdGEuaGVhZGVySW5mby5maWxlSWRlbnRpZmllclN0cmluZywKICAgICAgICAgICAgImZpbGVWZXJzaW9uIjogZGF0YS5oZWFkZXJJbmZvLmZpbGVWZXJzaW9uLAogICAgICAgICAgICAiaW1hZ2VUeXBlIjogZGF0YS5oZWFkZXJJbmZvLmltYWdlVHlwZSwKICAgICAgICAgICAgImhlaWdodCI6IGRhdGEuaGVhZGVySW5mby5oZWlnaHQsCiAgICAgICAgICAgICJ3aWR0aCI6IGRhdGEuaGVhZGVySW5mby53aWR0aCwKICAgICAgICAgICAgIm51bVZhbGlkUGl4ZWwiOiBkYXRhLmhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCwKICAgICAgICAgICAgIm1pY3JvQmxvY2tTaXplIjogZGF0YS5oZWFkZXJJbmZvLm1pY3JvQmxvY2tTaXplLAogICAgICAgICAgICAiYmxvYlNpemUiOiBkYXRhLmhlYWRlckluZm8uYmxvYlNpemUsCiAgICAgICAgICAgICJtYXhaRXJyb3IiOiBkYXRhLmhlYWRlckluZm8ubWF4WkVycm9yLAogICAgICAgICAgICAicGl4ZWxUeXBlIjogTGVyYzJIZWxwZXJzLmdldFBpeGVsVHlwZShkYXRhLmhlYWRlckluZm8uaW1hZ2VUeXBlKSwKICAgICAgICAgICAgImVvZk9mZnNldCI6IGRhdGEuZW9mT2Zmc2V0LAogICAgICAgICAgICAibWFzayI6IGRhdGEubWFzayA/IHsKICAgICAgICAgICAgICAibnVtQnl0ZXMiOiBkYXRhLm1hc2subnVtQnl0ZXMKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgICJwaXhlbHMiOiB7CiAgICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLnBpeGVscy5udW1CbG9ja3NYLAogICAgICAgICAgICAgICJudW1CbG9ja3NZIjogZGF0YS5waXhlbHMubnVtQmxvY2tzWSwKICAgICAgICAgICAgICAvLyJudW1CeXRlcyI6IGRhdGEucGl4ZWxzLm51bUJ5dGVzLAogICAgICAgICAgICAgICJtYXhWYWx1ZSI6IGRhdGEuaGVhZGVySW5mby56TWF4LAogICAgICAgICAgICAgICJtaW5WYWx1ZSI6IGRhdGEuaGVhZGVySW5mby56TWluLAogICAgICAgICAgICAgICJub0RhdGFWYWx1ZSI6IGRhdGEubm9EYXRhVmFsdWUKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICBjb25zdHJ1Y3RDb25zdGFudFN1cmZhY2U6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIHZhciB2YWwgPSBkYXRhLmhlYWRlckluZm8uek1heDsKICAgICAgICAgIHZhciBudW1EaW1zID0gIGRhdGEuaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGRhdGEuaGVhZGVySW5mby5oZWlnaHQgKiBkYXRhLmhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgbnVtUGl4ZWxBbGxEaW1zID0gbnVtUGl4ZWxzICogbnVtRGltczsKICAgICAgICAgIHZhciBpPTAsIGsgPSAwLCBuU3RhcnQ9MDsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIGlmIChtYXNrKSB7CiAgICAgICAgICAgIGlmIChudW1EaW1zID4gMSkgewogICAgICAgICAgICAgIGZvciAoaT0wOyBpIDwgbnVtRGltczsgaSsrKSB7CiAgICAgICAgICAgICAgICBuU3RhcnQgPSBpICogbnVtUGl4ZWxzOwogICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzW25TdGFydCArIGtdID0gdmFsOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICAgICAgaWYgKG1hc2tba10pIHsKICAgICAgICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzW2tdID0gdmFsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMuZmlsbCkgewogICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscy5maWxsKHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsQWxsRGltczsgaysrKSB7CiAgICAgICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHNba10gPSB2YWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSwKCiAgICAgICAgZ2V0RGF0YVR5cGVBcnJheTogZnVuY3Rpb24odCkgewogICAgICAgICAgdmFyIHRwOwogICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgdHAgPSBJbnQ4QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdHAgPSBVaW50OEFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgICB0cCA9IEludDE2QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzogLy91c2hvcnQKICAgICAgICAgICAgICB0cCA9IFVpbnQxNkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgdHAgPSBJbnQzMkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgdHAgPSBVaW50MzJBcnJheTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIHRwID0gRmxvYXQzMkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgdHAgPSBGbG9hdDY0QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdHAgPSBGbG9hdDMyQXJyYXk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHA7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0UGl4ZWxUeXBlOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICB2YXIgdHA7CiAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgY2FzZSAwOiAvL2NoYXIKICAgICAgICAgICAgICB0cCA9ICJTOCI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdHAgPSAiVTgiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgICB0cCA9ICJTMTYiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgdHAgPSAiVTE2IjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHRwID0gIlMzMiI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICB0cCA9ICJVMzIiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgdHAgPSAiRjMyIjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIHRwID0gIkY2NCI7IC8vbm90IHN1cHBvcnRlZAogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRwID0gIkYzMiI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHA7CiAgICAgICAgfSwKCiAgICAgICAgaXNWYWxpZFBpeGVsVmFsdWU6IGZ1bmN0aW9uKHQsIHZhbCkgewogICAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpc1ZhbGlkOwogICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAtMTI4ICYmIHZhbCA8PSAxMjc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlICAodW5zaWduZWQgY2hhcikKICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IDAgJiYgdmFsIDw9IDI1NTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOiAvL3Nob3J0CiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAtMzI3NjggJiYgdmFsIDw9IDMyNzY3OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAwICYmIHZhbCA8PSA2NTUzNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OiAvL2ludCAzMgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gLTIxNDc0ODM2NDggJiYgdmFsIDw9IDIxNDc0ODM2NDc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNTogLy91aW5pdCAzMgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gMCAmJiB2YWwgPD0gNDI5NDk2NzI5NjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gLTMuNDAyNzk5OTM4NzkwMTQ4NGUrMzggJiYgdmFsIDw9IDMuNDAyNzk5OTM4NzkwMTQ4NGUrMzg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IDVlLTMyNCAmJiB2YWwgPD0gMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaXNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGlzVmFsaWQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0RGF0YVR5cGVTaXplOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICB2YXIgcyA9IDA7CiAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgY2FzZSAwOiAvL3VieXRlCiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgcyA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjogLy9zaG9ydAogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgcyA9IDI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgcyA9IDQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBzID0gODsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBzID0gdDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0sCgogICAgICAgIGdldERhdGFUeXBlVXNlZDogZnVuY3Rpb24oZHQsIHRjKSB7CiAgICAgICAgICB2YXIgdCA9IGR0OwogICAgICAgICAgc3dpdGNoIChkdCkgewogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgY2FzZSA0OiAvL2xvbmcKICAgICAgICAgICAgICB0ID0gZHQgLSB0YzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOiAvL3VzaG9ydAogICAgICAgICAgICBjYXNlIDU6IC8vdWxvbmcKICAgICAgICAgICAgICB0ID0gZHQgLSAyICogdGM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjogLy9mbG9hdAogICAgICAgICAgICAgIGlmICgwID09PSB0YykgewogICAgICAgICAgICAgICAgdCA9IGR0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIGlmICgxID09PSB0YykgewogICAgICAgICAgICAgICAgdCA9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdCA9IDE7Ly9ieXRlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6IC8vZG91YmxlCiAgICAgICAgICAgICAgaWYgKDAgPT09IHRjKSB7CiAgICAgICAgICAgICAgICB0ID0gZHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdCA9IGR0IC0gMiAqIHRjICsgMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdCA9IGR0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0T25lUGl4ZWw6IGZ1bmN0aW9uKGJsb2NrLCBibG9ja1B0ciwgb2Zmc2V0VHlwZSwgdmlldykgewogICAgICAgICAgdmFyIHRlbXAgPSAwOwogICAgICAgICAgc3dpdGNoIChvZmZzZXRUeXBlKSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0SW50OChibG9ja1B0cik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0VWludDgoYmxvY2tQdHIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0SW50MTYoYmxvY2tQdHIsIHRydWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0VWludDE2KGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldEludDMyKGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldFVJbnQzMihibG9ja1B0ciwgdHJ1ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICB0ZW1wID0gdmlldy5nZXRGbG9hdDMyKGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIC8vdGVtcCA9IHZpZXcuZ2V0RmxvYXQ2NChibG9ja1B0ciwgdHJ1ZSk7CiAgICAgICAgICAgICAgLy9ibG9ja1B0ciArPSA4OwogICAgICAgICAgICAgIC8vbGVyYzIgZW5jb2RpbmcgZG9lc250IGhhbmRsZSBmbG9hdCA2NCwgZm9yY2UgdG8gZmxvYXQzMj8/PwogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldEZsb2F0NjQoYmxvY2tQdHIsIHRydWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93ICgidGhlIGRlY29kZXIgZG9lcyBub3QgdW5kZXJzdGFuZCB0aGlzIHBpeGVsIHR5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0ZW1wOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgKnByaXZhdGUgY2xhc3MgZm9yIGEgdHJlZSBub2RlLiBIdWZmbWFuIGNvZGUgaXMgaW4gTGVyYzJIZWxwZXJzCiAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIHZhciBUcmVlTm9kZSA9IGZ1bmN0aW9uKHZhbCwgbGVmdCwgcmlnaHQpIHsKICAgICAgICB0aGlzLnZhbCA9IHZhbDsKICAgICAgICB0aGlzLmxlZnQgPSBsZWZ0OwogICAgICAgIHRoaXMucmlnaHQgPSByaWdodDsKICAgICAgfTsKCiAgICAgIHZhciBMZXJjMkRlY29kZSA9IHsKICAgICAgICAvKgogICAgICAgICogKioqKioqKipyZW1vdmVkIG9wdGlvbnMgY29tcGFyZWQgdG8gTEVSQzEuIFdlIGNhbiBicmluZyBzb21lIG9mIHRoZW0gYmFjayBpZiBuZWVkZWQuCiAgICAgICAgICogcmVtb3ZlZCBwaXhlbCB0eXBlLiBMRVJDMiBpcyB0eXBlZCBhbmQgZG9lc24ndCByZXF1aXJlIHVzZXIgdG8gZ2l2ZSBwaXhlbCB0eXBlCiAgICAgICAgICogY2hhbmdlZCBlbmNvZGVkTWFza0RhdGEgdG8gbWFza0RhdGEuIExFUkMyICdzIGpzIHZlcnNpb24gbWFrZSBpdCBmYXN0ZXIgdG8gdXNlIG1hc2tEYXRhIGRpcmVjdGx5LgogICAgICAgICAqIHJlbW92ZWQgcmV0dXJuTWFzay4gbWFzayBpcyB1c2VkIGJ5IExFUkMyIGludGVybmFsbHkgYW5kIGlzIGNvc3QgZnJlZS4gSW4gY2FzZSBvZiB1c2VyIGlucHV0IG1hc2ssIGl0J3MgcmV0dXJuZWQgYXMgd2VsbCBhbmQgaGFzIG5lZ2xpYmxlIGNvc3QuCiAgICAgICAgICogcmVtb3ZlZCBub2RhdGF2YWx1ZS4gQmVjYXVzZSBMRVJDMiBwaXhlbHMgYXJlIHR5cGVkLCBub2RhdGF2YWx1ZSB3aWxsIHNhY3JpZnkgYSB1c2VmdWwgdmFsdWUgZm9yIG1hbnkgdHlwZXMgKDhiaXQsIDE2Yml0KSBldGMsCiAgICAgICAgICogICAgICAgdXNlciBoYXMgdG8gYmUga25vd2xlZGdhYmxlIGVub3VnaCBhYm91dCByYXN0ZXIgYW5kIHRoZWlyIGRhdGEgdG8gYXZvaWQgdXNhYmlsaXR5IGlzc3Vlcy4gc28gbm9kYXRhIHZhbHVlIGlzIHNpbXBseSByZW1vdmVkIG5vdy4KICAgICAgICAgKiAgICAgICBXZSBjYW4gYWRkIGl0IGJhY2sgbGF0ZXIgaWYgdGhlaXIncyBhIGNsZWFyIHJlcXVpcmVtZW50LgogICAgICAgICAqIHJlbW92ZWQgZW5jb2RlZE1hc2suIFRoaXMgb3B0aW9uIHdhcyBub3QgaW1wbGVtZW50ZWQgaW4gTGVyY0RlY29kZS4gSXQgY2FuIGJlIGRvbmUgYWZ0ZXIgZGVjb2RpbmcgKGxlc3MgZWZmaWNpZW50KQogICAgICAgICAqIHJlbW92ZWQgY29tcHV0ZVVzZWRCaXREZXB0aHMuCiAgICAgICAgICoKICAgICAgICAgKgogICAgICAgICAqIHJlc3BvbnNlIGNoYW5nZXMgY29tcGFyZWQgdG8gTEVSQzEKICAgICAgICAgKiAxLiBlbmNvZGVkTWFza0RhdGEgaXMgbm90IGF2YWlsYWJsZQogICAgICAgICAqIDIuIG5vRGF0YVZhbHVlIGlzIG9wdGlvbmFsIChyZXR1cm5zIG9ubHkgaWYgdXNlcidzIG5vRGF0YVZhbHVlIGlzIHdpdGggaW4gdGhlIHZhbGlkIGRhdGEgdHlwZSByYW5nZSkKICAgICAgICAgKiAzLiBtYXNrRGF0YSBpcyBhbHdheXMgYXZhaWxhYmxlCiAgICAgICAgKi8KICAgICAgICAvKioqKioqKioqKioqKioqKioKICAgICAgICAqICBwdWJsaWMgcHJvcGVydGllcwogICAgICAgICoqKioqKioqKioqKioqKioqKi8KICAgICAgICAvL0hVRkZNQU5fTFVUX0JJVFNfTUFYOiAxMiwgLy91c2UgMl4xMiBsdXQsIG5vdCBjb25maWd1cmFibGUKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqCiAgICAgICAgKiAgcHVibGljIG1ldGhvZHMKICAgICAgICAqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlIGEgTEVSQzIgYnl0ZSBzdHJlYW0gYW5kIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgcGl4ZWwgZGF0YSBhbmQgb3B0aW9uYWwgbWV0YWRhdGEuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBpbnB1dCBUaGUgTEVSQyBpbnB1dCBieXRlIHN0cmVhbQogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gb3B0aW9ucyBEZWNvZGluZyBvcHRpb25zCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmlucHV0T2Zmc2V0XSBUaGUgbnVtYmVyIG9mIGJ5dGVzIHRvIHNraXAgaW4gdGhlIGlucHV0IGJ5dGUgc3RyZWFtLiBBIHZhbGlkIExFUkMgZmlsZSBpcyBleHBlY3RlZCBhdCB0aGF0IHBvc2l0aW9uCiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5yZXR1cm5GaWxlSW5mb10gSWYgdHJ1ZSwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGhhdmUgYSBmaWxlSW5mbyBwcm9wZXJ0eSB0aGF0IGNvbnRhaW5zIG1ldGFkYXRhIG9idGFpbmVkIGZyb20gdGhlIExFUkMgaGVhZGVycyBhbmQgdGhlIGRlY29kaW5nIHByb2Nlc3MKICAgICAgICAgKi8KICAgICAgICBkZWNvZGU6IGZ1bmN0aW9uKC8qYnl0ZSBhcnJheSovIGlucHV0LCAvKm9iamVjdCovIG9wdGlvbnMpIHsKICAgICAgICAgIC8vY3VycmVudGx5IHRoZXJlJ3MgYSBidWcgaW4gdGhlIHNwYXJzZSBhcnJheSwgc28gcGxlYXNlIGRvIG5vdCBzZXQgdG8gZmFsc2UKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdmFyIG5vRGF0YVZhbHVlID0gb3B0aW9ucy5ub0RhdGFWYWx1ZTsKCiAgICAgICAgICAvL2luaXRpYWxpemUKICAgICAgICAgIHZhciBpID0gMCwgZGF0YSA9IHt9OwogICAgICAgICAgZGF0YS5wdHIgPSBvcHRpb25zLmlucHV0T2Zmc2V0IHx8IDA7CiAgICAgICAgICBkYXRhLnBpeGVscyA9IHt9OwoKICAgICAgICAgIC8vIEZpbGUgaGVhZGVyCiAgICAgICAgICBpZiAoIUxlcmMySGVscGVycy5yZWFkSGVhZGVySW5mbyhpbnB1dCwgZGF0YSkpIDsKICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgdmFyIGZpbGVWZXJzaW9uID0gaGVhZGVySW5mby5maWxlVmVyc2lvbjsKICAgICAgICAgIHZhciBPdXRQaXhlbFR5cGVBcnJheSA9IExlcmMySGVscGVycy5nZXREYXRhVHlwZUFycmF5KGhlYWRlckluZm8uaW1hZ2VUeXBlKTsKCiAgICAgICAgICAvLyBNYXNrIEhlYWRlcgogICAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWRNYXNrKGlucHV0LCBkYXRhKTsKICAgICAgICAgIGlmIChoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWwgIT09IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodCAmJiAhZGF0YS5waXhlbHMucmVzdWx0TWFzaykgewogICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRNYXNrID0gb3B0aW9ucy5tYXNrRGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbnVtUGl4ZWxzID0gaGVhZGVySW5mby53aWR0aCAqIGhlYWRlckluZm8uaGVpZ2h0OwogICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KG51bVBpeGVscyAqIGhlYWRlckluZm8ubnVtRGltcyk7CgogICAgICAgICAgZGF0YS5jb3VudGVyID0gewogICAgICAgICAgICBvbmVzd2VlcDogMCwKICAgICAgICAgICAgdW5jb21wcmVzc2VkOiAwLAogICAgICAgICAgICBsdXQ6IDAsCiAgICAgICAgICAgIGJpdHN0dWZmZXI6IDAsCiAgICAgICAgICAgIGNvbnN0YW50OiAwLAogICAgICAgICAgICBjb25zdGFudG9mZnNldDogMAogICAgICAgICAgfTsKICAgICAgICAgIGlmIChoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWwgIT09IDApIHsKICAgICAgICAgICAgLy9ub3QgdGVzdGVkCiAgICAgICAgICAgIGlmIChoZWFkZXJJbmZvLnpNYXggPT09IGhlYWRlckluZm8uek1pbikgLy9jb25zdGFudCBzdXJmYWNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMuY29uc3RydWN0Q29uc3RhbnRTdXJmYWNlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGZpbGVWZXJzaW9uID49IDQgJiYgTGVyYzJIZWxwZXJzLmNoZWNrTWluTWF4UmFuZ2VzKGlucHV0LCBkYXRhKSkgewogICAgICAgICAgICAgIExlcmMySGVscGVycy5jb25zdHJ1Y3RDb25zdGFudFN1cmZhY2UoZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIGRhdGEucHRyLCAyKTsKICAgICAgICAgICAgICB2YXIgYlJlYWREYXRhT25lU3dlZXAgPSB2aWV3LmdldFVpbnQ4KDApOwogICAgICAgICAgICAgIGRhdGEucHRyKys7CiAgICAgICAgICAgICAgaWYgKGJSZWFkRGF0YU9uZVN3ZWVwKSB7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoIk9uZVN3ZWVwIik7CiAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZERhdGFPbmVTd2VlcChpbnB1dCwgZGF0YSwgT3V0UGl4ZWxUeXBlQXJyYXkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vbGVyYzIuMTogLy9iaXRzdHVmZmluZyArIGx1dAogICAgICAgICAgICAgICAgLy9sZXJjMi4yOiAvL2JpdHN0dWZmaW5nICsgbHV0ICsgaHVmZm1hbgogICAgICAgICAgICAgICAgLy9sZXJjMi4zOiBuZXcgYml0c3R1ZmZlcgogICAgICAgICAgICAgICAgaWYgKGZpbGVWZXJzaW9uID4gMSAmJiBoZWFkZXJJbmZvLmltYWdlVHlwZSA8PSAxICYmIE1hdGguYWJzKGhlYWRlckluZm8ubWF4WkVycm9yIC0gMC41KSA8IDAuMDAwMDEpIHsKICAgICAgICAgICAgICAgICAgLy90aGlzIGlzIDIueCBwbHVzIDggYml0ICh1bnNpZ25lZCBhbmQgc2lnbmVkKSBkYXRhLCBwb3NzaWJsaXR5IG9mIEh1ZmZtYW4KICAgICAgICAgICAgICAgICAgdmFyIGZsYWdIdWZmbWFuID0gdmlldy5nZXRVaW50OCgxKTsKICAgICAgICAgICAgICAgICAgZGF0YS5wdHIrKzsKICAgICAgICAgICAgICAgICAgZGF0YS5lbmNvZGVNb2RlID0gZmxhZ0h1ZmZtYW47CiAgICAgICAgICAgICAgICAgIGlmIChmbGFnSHVmZm1hbiA+IDIgfHwgKGZpbGVWZXJzaW9uIDwgNCAmJiBmbGFnSHVmZm1hbiA+IDEpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgSHVmZm1hbiBmbGFnICIgKyBmbGFnSHVmZm1hbjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoZmxhZ0h1ZmZtYW4pIHsvLzEgLSBkZWx0YSBIdWZmbWFuLCAyIC0gSHVmZm1hbgogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkh1ZmZtYW4iKTsKICAgICAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZEh1ZmZtYW4oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJUaWxlcyIpOwogICAgICAgICAgICAgICAgICAgIExlcmMySGVscGVycy5yZWFkVGlsZXMoaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IC8vbGVyYzIueCBub24tOCBiaXQgZGF0YQogICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJUaWxlcyIpOwogICAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZFRpbGVzKGlucHV0LCBkYXRhLCBPdXRQaXhlbFR5cGVBcnJheSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZGF0YS5lb2ZPZmZzZXQgPSBkYXRhLnB0cjsKICAgICAgICAgIHZhciBkaWZmOwogICAgICAgICAgaWYgKG9wdGlvbnMuaW5wdXRPZmZzZXQpIHsKICAgICAgICAgICAgZGlmZiA9IGRhdGEuaGVhZGVySW5mby5ibG9iU2l6ZSArIG9wdGlvbnMuaW5wdXRPZmZzZXQgLSBkYXRhLnB0cjsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRpZmYpID49IDEpIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoImluY29ycmVjdCBlb2Y6IGRhdGFwdHIgIiArIGRhdGEucHRyICsgIiBvZmZzZXQgIiArIG9wdGlvbnMuaW5wdXRPZmZzZXQgKyAiIGJsb2JzaXplICIgKyBkYXRhLmhlYWRlckluZm8uYmxvYlNpemUgKyAiIGRpZmY6ICIgKyBkaWZmKTsKICAgICAgICAgICAgICBkYXRhLmVvZk9mZnNldCA9IG9wdGlvbnMuaW5wdXRPZmZzZXQgKyBkYXRhLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBkaWZmID0gZGF0YS5oZWFkZXJJbmZvLmJsb2JTaXplIC0gZGF0YS5wdHI7CiAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaWZmKSA+PSAxKSB7CiAgICAgICAgICAgICAgLy9jb25zb2xlLmRlYnVnKCJpbmNvcnJlY3QgZmlyc3QgYmFuZCBlb2Y6IGRhdGFwdHIgIiArIGRhdGEucHRyICsgIiBibG9ic2l6ZSAiICsgZGF0YS5oZWFkZXJJbmZvLmJsb2JTaXplICsgIiBkaWZmOiAiICsgZGlmZik7CiAgICAgICAgICAgICAgZGF0YS5lb2ZPZmZzZXQgPSBkYXRhLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVzdWx0ID0gewogICAgICAgICAgICB3aWR0aDogaGVhZGVySW5mby53aWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiBoZWFkZXJJbmZvLmhlaWdodCwKICAgICAgICAgICAgcGl4ZWxEYXRhOiBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMsCiAgICAgICAgICAgIG1pblZhbHVlOiBoZWFkZXJJbmZvLnpNaW4sCiAgICAgICAgICAgIG1heFZhbHVlOiBoZWFkZXJJbmZvLnpNYXgsCiAgICAgICAgICAgIHZhbGlkUGl4ZWxDb3VudDogaGVhZGVySW5mby5udW1WYWxpZFBpeGVsLAogICAgICAgICAgICBkaW1Db3VudDogaGVhZGVySW5mby5udW1EaW1zLAogICAgICAgICAgICBkaW1TdGF0czogewogICAgICAgICAgICAgIG1pblZhbHVlczogaGVhZGVySW5mby5taW5WYWx1ZXMsCiAgICAgICAgICAgICAgbWF4VmFsdWVzOiBoZWFkZXJJbmZvLm1heFZhbHVlcwogICAgICAgICAgICB9LAogICAgICAgICAgICBtYXNrRGF0YTogZGF0YS5waXhlbHMucmVzdWx0TWFzawogICAgICAgICAgICAvL25vRGF0YVZhbHVlOiBub0RhdGFWYWx1ZQogICAgICAgICAgfTsKCiAgICAgICAgICAvL3dlIHNob3VsZCByZW1vdmUgdGhpcyBpZiB0aGVyZSdzIG5vIGV4aXN0aW5nIGNsaWVudAogICAgICAgICAgLy9vcHRpb25hbCBub0RhdGFWYWx1ZSBwcm9jZXNzaW5nLCBpdCdzIHVzZXIncyByZXNwb25zaWJsaXR5CiAgICAgICAgICBpZiAoZGF0YS5waXhlbHMucmVzdWx0TWFzayAmJiBMZXJjMkhlbHBlcnMuaXNWYWxpZFBpeGVsVmFsdWUoaGVhZGVySW5mby5pbWFnZVR5cGUsIG5vRGF0YVZhbHVlKSkgewogICAgICAgICAgICB2YXIgbWFzayA9IGRhdGEucGl4ZWxzLnJlc3VsdE1hc2s7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1QaXhlbHM7IGkrKykgewogICAgICAgICAgICAgIGlmICghbWFza1tpXSkgewogICAgICAgICAgICAgICAgcmVzdWx0LnBpeGVsRGF0YVtpXSA9IG5vRGF0YVZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXN1bHQubm9EYXRhVmFsdWUgPSBub0RhdGFWYWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEubm9EYXRhVmFsdWUgPSBub0RhdGFWYWx1ZTsKICAgICAgICAgIGlmIChvcHRpb25zLnJldHVybkZpbGVJbmZvKSB7CiAgICAgICAgICAgIHJlc3VsdC5maWxlSW5mbyA9IExlcmMySGVscGVycy5mb3JtYXRGaWxlSW5mbyhkYXRhKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0QmFuZENvdW50OiBmdW5jdGlvbigvKmJ5dGUgYXJyYXkqLyBpbnB1dCkgewogICAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgIHZhciB0ZW1wID0ge307CiAgICAgICAgICB0ZW1wLnB0ciA9IDA7CiAgICAgICAgICB0ZW1wLnBpeGVscyA9IHt9OwogICAgICAgICAgd2hpbGUgKGkgPCBpbnB1dC5ieXRlTGVuZ3RoIC0gNTgpIHsKICAgICAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWRIZWFkZXJJbmZvKGlucHV0LCB0ZW1wKTsKICAgICAgICAgICAgaSArPSB0ZW1wLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgIHRlbXAucHRyID0gaTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAgICB9CiAgICAgIH07CgogICAgICByZXR1cm4gTGVyYzJEZWNvZGU7CiAgICB9KSgpOwoKICAgIHZhciBpc1BsYXRmb3JtTGl0dGxlRW5kaWFuID0gKGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSA9IG5ldyBBcnJheUJ1ZmZlcig0KTsKICAgICAgdmFyIGIgPSBuZXcgVWludDhBcnJheShhKTsKICAgICAgdmFyIGMgPSBuZXcgVWludDMyQXJyYXkoYSk7CiAgICAgIGNbMF0gPSAxOwogICAgICByZXR1cm4gYlswXSA9PT0gMTsKICAgIH0pKCk7CgogICAgdmFyIExlcmMgPSB7CiAgICAgIC8qKioqKioqKioqKip3cmFwcGVyKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgLyoqCiAgICAgICAqIEEgd3JhcHBlciBmb3IgZGVjb2RpbmcgYm90aCBMRVJDMSBhbmQgTEVSQzIgYnl0ZSBzdHJlYW1zIGNhcGFibGUgb2YgaGFuZGxpbmcgbXVsdGliYW5kIHBpeGVsIGJsb2NrcyBmb3IgdmFyaW91cyBwaXhlbCB0eXBlcy4KICAgICAgICoKICAgICAgICogQGFsaWFzIG1vZHVsZTpMZXJjCiAgICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGlucHV0IFRoZSBMRVJDIGlucHV0IGJ5dGUgc3RyZWFtCiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gVGhlIGRlY29kaW5nIG9wdGlvbnMgYmVsb3cgYXJlIG9wdGlvbmFsLgogICAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMuaW5wdXRPZmZzZXRdIFRoZSBudW1iZXIgb2YgYnl0ZXMgdG8gc2tpcCBpbiB0aGUgaW5wdXQgYnl0ZSBzdHJlYW0uIEEgdmFsaWQgTGVyYyBmaWxlIGlzIGV4cGVjdGVkIGF0IHRoYXQgcG9zaXRpb24uCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5waXhlbFR5cGVdIChMRVJDMSBvbmx5KSBEZWZhdWx0IHZhbHVlIGlzIEYzMi4gVmFsaWQgcGl4ZWwgdHlwZXMgZm9yIGlucHV0IGFyZSBVOC9TOC9TMTYvVTE2L1MzMi9VMzIvRjMyLgogICAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubm9EYXRhVmFsdWVdIChMRVJDMSBvbmx5KS4gSXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIHRoZSByZXR1cm5lZCBtYXNrIGluc3RlYWQgb2Ygc2V0dGluZyB0aGlzIHZhbHVlLgogICAgICAgKiBAcmV0dXJucyB7e3dpZHRoLCBoZWlnaHQsIHBpeGVscywgcGl4ZWxUeXBlLCBtYXNrLCBzdGF0aXN0aWNzfX0KICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggV2lkdGggb2YgZGVjb2RlZCBpbWFnZS4KICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gaGVpZ2h0IEhlaWdodCBvZiBkZWNvZGVkIGltYWdlLgogICAgICAgICAqIEBwcm9wZXJ0eSB7YXJyYXl9IHBpeGVscyBbYmFuZDEsIGJhbmQyLCDigKZdIEVhY2ggYmFuZCBpcyBhIHR5cGVkIGFycmF5IG9mIHdpZHRoKmhlaWdodC4KICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gcGl4ZWxUeXBlIFRoZSB0eXBlIG9mIHBpeGVscyByZXByZXNlbnRlZCBpbiB0aGUgb3V0cHV0LgogICAgICAgICAqIEBwcm9wZXJ0eSB7bWFza30gbWFzayBUeXBlZCBhcnJheSB3aXRoIGEgc2l6ZSBvZiB3aWR0aCpoZWlnaHQsIG9yIG51bGwgaWYgYWxsIHBpeGVscyBhcmUgdmFsaWQuCiAgICAgICAgICogQHByb3BlcnR5IHthcnJheX0gc3RhdGlzdGljcyBbc3RhdGlzdGljc19iYW5kMSwgc3RhdGlzdGljc19iYW5kMiwg4oCmXSBFYWNoIGVsZW1lbnQgaXMgYSBzdGF0aXN0aWNzIG9iamVjdCByZXByZXNlbnRpbmcgbWluIGFuZCBtYXggdmFsdWVzCiAgICAgICoqLwogICAgICBkZWNvZGU6IGZ1bmN0aW9uKGVuY29kZWREYXRhLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKCFpc1BsYXRmb3JtTGl0dGxlRW5kaWFuKSB7CiAgICAgICAgICB0aHJvdyAiQmlnIGVuZGlhbiBzeXN0ZW0gaXMgbm90IHN1cHBvcnRlZC4iOwogICAgICAgIH0KICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICB2YXIgaW5wdXRPZmZzZXQgPSBvcHRpb25zLmlucHV0T2Zmc2V0IHx8IDA7CiAgICAgICAgdmFyIGZpbGVJZFZpZXcgPSBuZXcgVWludDhBcnJheShlbmNvZGVkRGF0YSwgaW5wdXRPZmZzZXQsIDEwKTsKICAgICAgICB2YXIgZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgIHZhciBsZXJjLCBtYWpvclZlcnNpb247CiAgICAgICAgaWYgKGZpbGVJZGVudGlmaWVyU3RyaW5nLnRyaW0oKSA9PT0gIkNudFpJbWFnZSIpIHsKICAgICAgICAgIGxlcmMgPSBMZXJjRGVjb2RlOwogICAgICAgICAgbWFqb3JWZXJzaW9uID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZmlsZUlkZW50aWZpZXJTdHJpbmcuc3Vic3RyaW5nKDAsIDUpID09PSAiTGVyYzIiKSB7CiAgICAgICAgICBsZXJjID0gTGVyYzJEZWNvZGU7CiAgICAgICAgICBtYWpvclZlcnNpb24gPSAyOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGZpbGUgaWRlbnRpZmllciBzdHJpbmc6ICIgKyBmaWxlSWRlbnRpZmllclN0cmluZzsKICAgICAgICB9CgogICAgICAgIHZhciBpUGxhbmUgPSAwLCBlb2YgPSBlbmNvZGVkRGF0YS5ieXRlTGVuZ3RoIC0gMTAsIGVuY29kZWRNYXNrRGF0YSwgYmFuZE1hc2tzID0gW10sIGJhbmRNYXNrLCBtYXNrRGF0YTsKICAgICAgICB2YXIgZGVjb2RlZFBpeGVsQmxvY2sgPSB7CiAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgIGhlaWdodDogMCwKICAgICAgICAgIHBpeGVsczogW10sCiAgICAgICAgICBwaXhlbFR5cGU6IG9wdGlvbnMucGl4ZWxUeXBlLAogICAgICAgICAgbWFzazogbnVsbCwKICAgICAgICAgIHN0YXRpc3RpY3M6IFtdCiAgICAgICAgfTsKCiAgICAgICAgd2hpbGUgKGlucHV0T2Zmc2V0IDwgZW9mKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gbGVyYy5kZWNvZGUoZW5jb2RlZERhdGEsIHsKICAgICAgICAgICAgaW5wdXRPZmZzZXQ6IGlucHV0T2Zmc2V0LC8vZm9yIGJvdGggbGVyYzEgYW5kIGxlcmMyCiAgICAgICAgICAgIGVuY29kZWRNYXNrRGF0YTogZW5jb2RlZE1hc2tEYXRhLC8vbGVyYzEgb25seQogICAgICAgICAgICBtYXNrRGF0YTogbWFza0RhdGEsLy9sZXJjMiBvbmx5CiAgICAgICAgICAgIHJldHVybk1hc2s6IGlQbGFuZSA9PT0gMCA/IHRydWUgOiBmYWxzZSwvL2xlcmMxIG9ubHkKICAgICAgICAgICAgcmV0dXJuRW5jb2RlZE1hc2s6IGlQbGFuZSA9PT0gMCA/IHRydWUgOiBmYWxzZSwvL2xlcmMxIG9ubHkKICAgICAgICAgICAgcmV0dXJuRmlsZUluZm86IHRydWUsLy9mb3IgYm90aCBsZXJjMSBhbmQgbGVyYzIKICAgICAgICAgICAgcGl4ZWxUeXBlOiBvcHRpb25zLnBpeGVsVHlwZSB8fCBudWxsLC8vbGVyYzEgb25seQogICAgICAgICAgICBub0RhdGFWYWx1ZTogb3B0aW9ucy5ub0RhdGFWYWx1ZSB8fCBudWxsLy9sZXJjMSBvbmx5CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpbnB1dE9mZnNldCA9IHJlc3VsdC5maWxlSW5mby5lb2ZPZmZzZXQ7CiAgICAgICAgICBpZiAoaVBsYW5lID09PSAwKSB7CiAgICAgICAgICAgIGVuY29kZWRNYXNrRGF0YSA9IHJlc3VsdC5lbmNvZGVkTWFza0RhdGE7Ly9sZXJjMQogICAgICAgICAgICBtYXNrRGF0YSA9IHJlc3VsdC5tYXNrRGF0YTsvL2xlcmMyCiAgICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLndpZHRoID0gcmVzdWx0LndpZHRoOwogICAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5oZWlnaHQgPSByZXN1bHQuaGVpZ2h0OwogICAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5kaW1Db3VudCA9IHJlc3VsdC5kaW1Db3VudCB8fCAxOwogICAgICAgICAgICAvL2RlY29kZWRQaXhlbEJsb2NrLmRpbVN0YXRzID0gZGVjb2RlZFBpeGVsQmxvY2suZGltU3RhdHM7CiAgICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnBpeGVsVHlwZSA9IHJlc3VsdC5waXhlbFR5cGUgfHwgcmVzdWx0LmZpbGVJbmZvLnBpeGVsVHlwZTsKICAgICAgICAgICAgZGVjb2RlZFBpeGVsQmxvY2subWFzayA9IHJlc3VsdC5tYXNrRGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYWpvclZlcnNpb24gPjEgJiYgcmVzdWx0LmZpbGVJbmZvLm1hc2sgJiYgcmVzdWx0LmZpbGVJbmZvLm1hc2subnVtQnl0ZXMgPiAwKSB7CiAgICAgICAgICAgIGJhbmRNYXNrcy5wdXNoKHJlc3VsdC5tYXNrRGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgaVBsYW5lKys7CiAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5waXhlbHMucHVzaChyZXN1bHQucGl4ZWxEYXRhKTsKICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnN0YXRpc3RpY3MucHVzaCh7CiAgICAgICAgICAgIG1pblZhbHVlOiByZXN1bHQubWluVmFsdWUsCiAgICAgICAgICAgIG1heFZhbHVlOiByZXN1bHQubWF4VmFsdWUsCiAgICAgICAgICAgIG5vRGF0YVZhbHVlOiByZXN1bHQubm9EYXRhVmFsdWUsCiAgICAgICAgICAgIGRpbVN0YXRzOiByZXN1bHQuZGltU3RhdHMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB2YXIgaSwgaiwgbnVtUGl4ZWxzOwogICAgICAgIGlmIChtYWpvclZlcnNpb24gPiAxICYmIGJhbmRNYXNrcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBudW1QaXhlbHMgPSBkZWNvZGVkUGl4ZWxCbG9jay53aWR0aCAqIGRlY29kZWRQaXhlbEJsb2NrLmhlaWdodDsKICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLmJhbmRNYXNrcyA9IGJhbmRNYXNrczsKICAgICAgICAgIG1hc2tEYXRhID0gbmV3IFVpbnQ4QXJyYXkobnVtUGl4ZWxzKTsKICAgICAgICAgIG1hc2tEYXRhLnNldChiYW5kTWFza3NbMF0pOwogICAgICAgICAgZm9yIChpID0gMTsgaSA8IGJhbmRNYXNrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBiYW5kTWFzayA9IGJhbmRNYXNrc1tpXTsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG51bVBpeGVsczsgaisrKSB7CiAgICAgICAgICAgICAgbWFza0RhdGFbal0gPSBtYXNrRGF0YVtqXSAmIGJhbmRNYXNrW2pdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5tYXNrRGF0YSA9IG1hc2tEYXRhOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRlY29kZWRQaXhlbEJsb2NrOwogICAgICB9CiAgICB9OwoKICAgIGlmIChtb2R1bGUuZXhwb3J0cykgey8qIGpzaGludCBpZ25vcmU6bGluZSAqLwogICAgICAvL2NvbW1vbkpTIG1vZHVsZSAxLjAvMS4xLzEuMS4xIHN5c3RlbXMsIHN1Y2ggYXMgbm9kZUpTCiAgICAgIC8vaHR0cDovL3dpa2kuY29tbW9uanMub3JnL3dpa2kvTW9kdWxlcwogICAgICBtb2R1bGUuZXhwb3J0cyA9IExlcmM7LyoganNoaW50IGlnbm9yZTpsaW5lICovCiAgICB9CiAgICBlbHNlIHsKICAgICAgLy9hc3NpZ24gdG8gdGhpcywgbW9zdCBsaWtlbHkgd2luZG93CiAgICAgIHRoaXMuTGVyYyA9IExlcmM7CiAgICB9CgogIH0pKCk7CiAgfShMZXJjRGVjb2RlKSk7CgogIHZhciBMZXJjID0gTGVyY0RlY29kZS5leHBvcnRzOwoKICBjb25zdCBmaWVsZFRhZ05hbWVzID0gewogICAgLy8gVElGRiBCYXNlbGluZQogICAgMHgwMTNCOiAnQXJ0aXN0JywKICAgIDB4MDEwMjogJ0JpdHNQZXJTYW1wbGUnLAogICAgMHgwMTA5OiAnQ2VsbExlbmd0aCcsCiAgICAweDAxMDg6ICdDZWxsV2lkdGgnLAogICAgMHgwMTQwOiAnQ29sb3JNYXAnLAogICAgMHgwMTAzOiAnQ29tcHJlc3Npb24nLAogICAgMHg4Mjk4OiAnQ29weXJpZ2h0JywKICAgIDB4MDEzMjogJ0RhdGVUaW1lJywKICAgIDB4MDE1MjogJ0V4dHJhU2FtcGxlcycsCiAgICAweDAxMEE6ICdGaWxsT3JkZXInLAogICAgMHgwMTIxOiAnRnJlZUJ5dGVDb3VudHMnLAogICAgMHgwMTIwOiAnRnJlZU9mZnNldHMnLAogICAgMHgwMTIzOiAnR3JheVJlc3BvbnNlQ3VydmUnLAogICAgMHgwMTIyOiAnR3JheVJlc3BvbnNlVW5pdCcsCiAgICAweDAxM0M6ICdIb3N0Q29tcHV0ZXInLAogICAgMHgwMTBFOiAnSW1hZ2VEZXNjcmlwdGlvbicsCiAgICAweDAxMDE6ICdJbWFnZUxlbmd0aCcsCiAgICAweDAxMDA6ICdJbWFnZVdpZHRoJywKICAgIDB4MDEwRjogJ01ha2UnLAogICAgMHgwMTE5OiAnTWF4U2FtcGxlVmFsdWUnLAogICAgMHgwMTE4OiAnTWluU2FtcGxlVmFsdWUnLAogICAgMHgwMTEwOiAnTW9kZWwnLAogICAgMHgwMEZFOiAnTmV3U3ViZmlsZVR5cGUnLAogICAgMHgwMTEyOiAnT3JpZW50YXRpb24nLAogICAgMHgwMTA2OiAnUGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbicsCiAgICAweDAxMUM6ICdQbGFuYXJDb25maWd1cmF0aW9uJywKICAgIDB4MDEyODogJ1Jlc29sdXRpb25Vbml0JywKICAgIDB4MDExNjogJ1Jvd3NQZXJTdHJpcCcsCiAgICAweDAxMTU6ICdTYW1wbGVzUGVyUGl4ZWwnLAogICAgMHgwMTMxOiAnU29mdHdhcmUnLAogICAgMHgwMTE3OiAnU3RyaXBCeXRlQ291bnRzJywKICAgIDB4MDExMTogJ1N0cmlwT2Zmc2V0cycsCiAgICAweDAwRkY6ICdTdWJmaWxlVHlwZScsCiAgICAweDAxMDc6ICdUaHJlc2hob2xkaW5nJywKICAgIDB4MDExQTogJ1hSZXNvbHV0aW9uJywKICAgIDB4MDExQjogJ1lSZXNvbHV0aW9uJywKCiAgICAvLyBUSUZGIEV4dGVuZGVkCiAgICAweDAxNDY6ICdCYWRGYXhMaW5lcycsCiAgICAweDAxNDc6ICdDbGVhbkZheERhdGEnLAogICAgMHgwMTU3OiAnQ2xpcFBhdGgnLAogICAgMHgwMTQ4OiAnQ29uc2VjdXRpdmVCYWRGYXhMaW5lcycsCiAgICAweDAxQjE6ICdEZWNvZGUnLAogICAgMHgwMUIyOiAnRGVmYXVsdEltYWdlQ29sb3InLAogICAgMHgwMTBEOiAnRG9jdW1lbnROYW1lJywKICAgIDB4MDE1MDogJ0RvdFJhbmdlJywKICAgIDB4MDE0MTogJ0hhbGZ0b25lSGludHMnLAogICAgMHgwMTVBOiAnSW5kZXhlZCcsCiAgICAweDAxNUI6ICdKUEVHVGFibGVzJywKICAgIDB4MDExRDogJ1BhZ2VOYW1lJywKICAgIDB4MDEyOTogJ1BhZ2VOdW1iZXInLAogICAgMHgwMTNEOiAnUHJlZGljdG9yJywKICAgIDB4MDEzRjogJ1ByaW1hcnlDaHJvbWF0aWNpdGllcycsCiAgICAweDAyMTQ6ICdSZWZlcmVuY2VCbGFja1doaXRlJywKICAgIDB4MDE1MzogJ1NhbXBsZUZvcm1hdCcsCiAgICAweDAxNTQ6ICdTTWluU2FtcGxlVmFsdWUnLAogICAgMHgwMTU1OiAnU01heFNhbXBsZVZhbHVlJywKICAgIDB4MDIyRjogJ1N0cmlwUm93Q291bnRzJywKICAgIDB4MDE0QTogJ1N1YklGRHMnLAogICAgMHgwMTI0OiAnVDRPcHRpb25zJywKICAgIDB4MDEyNTogJ1Q2T3B0aW9ucycsCiAgICAweDAxNDU6ICdUaWxlQnl0ZUNvdW50cycsCiAgICAweDAxNDM6ICdUaWxlTGVuZ3RoJywKICAgIDB4MDE0NDogJ1RpbGVPZmZzZXRzJywKICAgIDB4MDE0MjogJ1RpbGVXaWR0aCcsCiAgICAweDAxMkQ6ICdUcmFuc2ZlckZ1bmN0aW9uJywKICAgIDB4MDEzRTogJ1doaXRlUG9pbnQnLAogICAgMHgwMTU4OiAnWENsaXBQYXRoVW5pdHMnLAogICAgMHgwMTFFOiAnWFBvc2l0aW9uJywKICAgIDB4MDIxMTogJ1lDYkNyQ29lZmZpY2llbnRzJywKICAgIDB4MDIxMzogJ1lDYkNyUG9zaXRpb25pbmcnLAogICAgMHgwMjEyOiAnWUNiQ3JTdWJTYW1wbGluZycsCiAgICAweDAxNTk6ICdZQ2xpcFBhdGhVbml0cycsCiAgICAweDAxMUY6ICdZUG9zaXRpb24nLAoKICAgIC8vIEVYSUYKICAgIDB4OTIwMjogJ0FwZXJ0dXJlVmFsdWUnLAogICAgMHhBMDAxOiAnQ29sb3JTcGFjZScsCiAgICAweDkwMDQ6ICdEYXRlVGltZURpZ2l0aXplZCcsCiAgICAweDkwMDM6ICdEYXRlVGltZU9yaWdpbmFsJywKICAgIDB4ODc2OTogJ0V4aWYgSUZEJywKICAgIDB4OTAwMDogJ0V4aWZWZXJzaW9uJywKICAgIDB4ODI5QTogJ0V4cG9zdXJlVGltZScsCiAgICAweEEzMDA6ICdGaWxlU291cmNlJywKICAgIDB4OTIwOTogJ0ZsYXNoJywKICAgIDB4QTAwMDogJ0ZsYXNocGl4VmVyc2lvbicsCiAgICAweDgyOUQ6ICdGTnVtYmVyJywKICAgIDB4QTQyMDogJ0ltYWdlVW5pcXVlSUQnLAogICAgMHg5MjA4OiAnTGlnaHRTb3VyY2UnLAogICAgMHg5MjdDOiAnTWFrZXJOb3RlJywKICAgIDB4OTIwMTogJ1NodXR0ZXJTcGVlZFZhbHVlJywKICAgIDB4OTI4NjogJ1VzZXJDb21tZW50JywKCiAgICAvLyBJUFRDCiAgICAweDgzQkI6ICdJUFRDJywKCiAgICAvLyBJQ0MKICAgIDB4ODc3MzogJ0lDQyBQcm9maWxlJywKCiAgICAvLyBYTVAKICAgIDB4MDJCQzogJ1hNUCcsCgogICAgLy8gR0RBTAogICAgMHhBNDgwOiAnR0RBTF9NRVRBREFUQScsCiAgICAweEE0ODE6ICdHREFMX05PREFUQScsCgogICAgLy8gUGhvdG9zaG9wCiAgICAweDg2NDk6ICdQaG90b3Nob3AnLAoKICAgIC8vIEdlb1RpZmYKICAgIDB4ODMwRTogJ01vZGVsUGl4ZWxTY2FsZScsCiAgICAweDg0ODI6ICdNb2RlbFRpZXBvaW50JywKICAgIDB4ODVEODogJ01vZGVsVHJhbnNmb3JtYXRpb24nLAogICAgMHg4N0FGOiAnR2VvS2V5RGlyZWN0b3J5JywKICAgIDB4ODdCMDogJ0dlb0RvdWJsZVBhcmFtcycsCiAgICAweDg3QjE6ICdHZW9Bc2NpaVBhcmFtcycsCgogICAgLy8gTEVSQwogICAgMHhDNUYyOiAnTGVyY1BhcmFtZXRlcnMnLAogIH07CgogIGNvbnN0IGZpZWxkVGFncyA9IHt9OwogIGZvciAoY29uc3Qga2V5IGluIGZpZWxkVGFnTmFtZXMpIHsKICAgIGlmIChmaWVsZFRhZ05hbWVzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgZmllbGRUYWdzW2ZpZWxkVGFnTmFtZXNba2V5XV0gPSBwYXJzZUludChrZXksIDEwKTsKICAgIH0KICB9CgogIFsKICAgIGZpZWxkVGFncy5CaXRzUGVyU2FtcGxlLAogICAgZmllbGRUYWdzLkV4dHJhU2FtcGxlcywKICAgIGZpZWxkVGFncy5TYW1wbGVGb3JtYXQsCiAgICBmaWVsZFRhZ3MuU3RyaXBCeXRlQ291bnRzLAogICAgZmllbGRUYWdzLlN0cmlwT2Zmc2V0cywKICAgIGZpZWxkVGFncy5TdHJpcFJvd0NvdW50cywKICAgIGZpZWxkVGFncy5UaWxlQnl0ZUNvdW50cywKICAgIGZpZWxkVGFncy5UaWxlT2Zmc2V0cywKICAgIGZpZWxkVGFncy5TdWJJRkRzLAogIF07CgogIGNvbnN0IGZpZWxkVHlwZU5hbWVzID0gewogICAgMHgwMDAxOiAnQllURScsCiAgICAweDAwMDI6ICdBU0NJSScsCiAgICAweDAwMDM6ICdTSE9SVCcsCiAgICAweDAwMDQ6ICdMT05HJywKICAgIDB4MDAwNTogJ1JBVElPTkFMJywKICAgIDB4MDAwNjogJ1NCWVRFJywKICAgIDB4MDAwNzogJ1VOREVGSU5FRCcsCiAgICAweDAwMDg6ICdTU0hPUlQnLAogICAgMHgwMDA5OiAnU0xPTkcnLAogICAgMHgwMDBBOiAnU1JBVElPTkFMJywKICAgIDB4MDAwQjogJ0ZMT0FUJywKICAgIDB4MDAwQzogJ0RPVUJMRScsCiAgICAvLyBJRkQgb2Zmc2V0LCBzdWdnZXN0ZWQgYnkgaHR0cHM6Ly9vd2wucGh5LnF1ZWVuc3UuY2EvfnBoaWwvZXhpZnRvb2wvc3RhbmRhcmRzLmh0bWwKICAgIDB4MDAwRDogJ0lGRCcsCiAgICAvLyBpbnRyb2R1Y2VkIGJ5IEJpZ1RJRkYKICAgIDB4MDAxMDogJ0xPTkc4JywKICAgIDB4MDAxMTogJ1NMT05HOCcsCiAgICAweDAwMTI6ICdJRkQ4JywKICB9OwoKICBjb25zdCBmaWVsZFR5cGVzID0ge307CiAgZm9yIChjb25zdCBrZXkgaW4gZmllbGRUeXBlTmFtZXMpIHsKICAgIGlmIChmaWVsZFR5cGVOYW1lcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgIGZpZWxkVHlwZXNbZmllbGRUeXBlTmFtZXNba2V5XV0gPSBwYXJzZUludChrZXksIDEwKTsKICAgIH0KICB9CgogIGNvbnN0IExlcmNQYXJhbWV0ZXJzID0gewogICAgVmVyc2lvbjogMCwKICAgIEFkZENvbXByZXNzaW9uOiAxLAogIH07CgogIGNvbnN0IExlcmNBZGRDb21wcmVzc2lvbiA9IHsKICAgIE5vbmU6IDAsCiAgICBEZWZsYXRlOiAxLAogIH07CgoKICBjb25zdCBnZW9LZXlOYW1lcyA9IHsKICAgIDEwMjQ6ICdHVE1vZGVsVHlwZUdlb0tleScsCiAgICAxMDI1OiAnR1RSYXN0ZXJUeXBlR2VvS2V5JywKICAgIDEwMjY6ICdHVENpdGF0aW9uR2VvS2V5JywKICAgIDIwNDg6ICdHZW9ncmFwaGljVHlwZUdlb0tleScsCiAgICAyMDQ5OiAnR2VvZ0NpdGF0aW9uR2VvS2V5JywKICAgIDIwNTA6ICdHZW9nR2VvZGV0aWNEYXR1bUdlb0tleScsCiAgICAyMDUxOiAnR2VvZ1ByaW1lTWVyaWRpYW5HZW9LZXknLAogICAgMjA1MjogJ0dlb2dMaW5lYXJVbml0c0dlb0tleScsCiAgICAyMDUzOiAnR2VvZ0xpbmVhclVuaXRTaXplR2VvS2V5JywKICAgIDIwNTQ6ICdHZW9nQW5ndWxhclVuaXRzR2VvS2V5JywKICAgIDIwNTU6ICdHZW9nQW5ndWxhclVuaXRTaXplR2VvS2V5JywKICAgIDIwNTY6ICdHZW9nRWxsaXBzb2lkR2VvS2V5JywKICAgIDIwNTc6ICdHZW9nU2VtaU1ham9yQXhpc0dlb0tleScsCiAgICAyMDU4OiAnR2VvZ1NlbWlNaW5vckF4aXNHZW9LZXknLAogICAgMjA1OTogJ0dlb2dJbnZGbGF0dGVuaW5nR2VvS2V5JywKICAgIDIwNjA6ICdHZW9nQXppbXV0aFVuaXRzR2VvS2V5JywKICAgIDIwNjE6ICdHZW9nUHJpbWVNZXJpZGlhbkxvbmdHZW9LZXknLAogICAgMjA2MjogJ0dlb2dUT1dHUzg0R2VvS2V5JywKICAgIDMwNzI6ICdQcm9qZWN0ZWRDU1R5cGVHZW9LZXknLAogICAgMzA3MzogJ1BDU0NpdGF0aW9uR2VvS2V5JywKICAgIDMwNzQ6ICdQcm9qZWN0aW9uR2VvS2V5JywKICAgIDMwNzU6ICdQcm9qQ29vcmRUcmFuc0dlb0tleScsCiAgICAzMDc2OiAnUHJvakxpbmVhclVuaXRzR2VvS2V5JywKICAgIDMwNzc6ICdQcm9qTGluZWFyVW5pdFNpemVHZW9LZXknLAogICAgMzA3ODogJ1Byb2pTdGRQYXJhbGxlbDFHZW9LZXknLAogICAgMzA3OTogJ1Byb2pTdGRQYXJhbGxlbDJHZW9LZXknLAogICAgMzA4MDogJ1Byb2pOYXRPcmlnaW5Mb25nR2VvS2V5JywKICAgIDMwODE6ICdQcm9qTmF0T3JpZ2luTGF0R2VvS2V5JywKICAgIDMwODI6ICdQcm9qRmFsc2VFYXN0aW5nR2VvS2V5JywKICAgIDMwODM6ICdQcm9qRmFsc2VOb3J0aGluZ0dlb0tleScsCiAgICAzMDg0OiAnUHJvakZhbHNlT3JpZ2luTG9uZ0dlb0tleScsCiAgICAzMDg1OiAnUHJvakZhbHNlT3JpZ2luTGF0R2VvS2V5JywKICAgIDMwODY6ICdQcm9qRmFsc2VPcmlnaW5FYXN0aW5nR2VvS2V5JywKICAgIDMwODc6ICdQcm9qRmFsc2VPcmlnaW5Ob3J0aGluZ0dlb0tleScsCiAgICAzMDg4OiAnUHJvakNlbnRlckxvbmdHZW9LZXknLAogICAgMzA4OTogJ1Byb2pDZW50ZXJMYXRHZW9LZXknLAogICAgMzA5MDogJ1Byb2pDZW50ZXJFYXN0aW5nR2VvS2V5JywKICAgIDMwOTE6ICdQcm9qQ2VudGVyTm9ydGhpbmdHZW9LZXknLAogICAgMzA5MjogJ1Byb2pTY2FsZUF0TmF0T3JpZ2luR2VvS2V5JywKICAgIDMwOTM6ICdQcm9qU2NhbGVBdENlbnRlckdlb0tleScsCiAgICAzMDk0OiAnUHJvakF6aW11dGhBbmdsZUdlb0tleScsCiAgICAzMDk1OiAnUHJvalN0cmFpZ2h0VmVydFBvbGVMb25nR2VvS2V5JywKICAgIDMwOTY6ICdQcm9qUmVjdGlmaWVkR3JpZEFuZ2xlR2VvS2V5JywKICAgIDQwOTY6ICdWZXJ0aWNhbENTVHlwZUdlb0tleScsCiAgICA0MDk3OiAnVmVydGljYWxDaXRhdGlvbkdlb0tleScsCiAgICA0MDk4OiAnVmVydGljYWxEYXR1bUdlb0tleScsCiAgICA0MDk5OiAnVmVydGljYWxVbml0c0dlb0tleScsCiAgfTsKCiAgY29uc3QgZ2VvS2V5cyA9IHt9OwogIGZvciAoY29uc3Qga2V5IGluIGdlb0tleU5hbWVzKSB7CiAgICBpZiAoZ2VvS2V5TmFtZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICBnZW9LZXlzW2dlb0tleU5hbWVzW2tleV1dID0gcGFyc2VJbnQoa2V5LCAxMCk7CiAgICB9CiAgfQoKICBjbGFzcyBMZXJjRGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGNvbnN0cnVjdG9yKGZpbGVEaXJlY3RvcnkpIHsKICAgICAgc3VwZXIoKTsKCiAgICAgIHRoaXMucGxhbmFyQ29uZmlndXJhdGlvbiA9IHR5cGVvZiBmaWxlRGlyZWN0b3J5LlBsYW5hckNvbmZpZ3VyYXRpb24gIT09ICd1bmRlZmluZWQnID8gZmlsZURpcmVjdG9yeS5QbGFuYXJDb25maWd1cmF0aW9uIDogMTsKICAgICAgdGhpcy5zYW1wbGVzUGVyUGl4ZWwgPSB0eXBlb2YgZmlsZURpcmVjdG9yeS5TYW1wbGVzUGVyUGl4ZWwgIT09ICd1bmRlZmluZWQnID8gZmlsZURpcmVjdG9yeS5TYW1wbGVzUGVyUGl4ZWwgOiAxOwoKICAgICAgdGhpcy5hZGRDb21wcmVzc2lvbiA9IGZpbGVEaXJlY3RvcnkuTGVyY1BhcmFtZXRlcnNbTGVyY1BhcmFtZXRlcnMuQWRkQ29tcHJlc3Npb25dOwogICAgfQoKICAgIGludGVybGVhdmVQaXhlbHMoYmFuZEludGVybGVhdmVkRGF0YSkgewogICAgICBjb25zdCBwaXhlbEludGVybGVhdmVkRGF0YSA9IG5ldyBiYW5kSW50ZXJsZWF2ZWREYXRhLmNvbnN0cnVjdG9yKGJhbmRJbnRlcmxlYXZlZERhdGEubGVuZ3RoKTsKICAgICAgY29uc3QgbGVuZ3RoUGVyU2FtcGxlID0gYmFuZEludGVybGVhdmVkRGF0YS5sZW5ndGggLyB0aGlzLnNhbXBsZXNQZXJQaXhlbDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGhQZXJTYW1wbGU7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zYW1wbGVzUGVyUGl4ZWw7IGorKykgewogICAgICAgICAgcGl4ZWxJbnRlcmxlYXZlZERhdGFbaSAqIHRoaXMuc2FtcGxlc1BlclBpeGVsICsgal0gPSBiYW5kSW50ZXJsZWF2ZWREYXRhW2kgKyBqICogbGVuZ3RoUGVyU2FtcGxlXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHBpeGVsSW50ZXJsZWF2ZWREYXRhOwogICAgfQoKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICBzd2l0Y2ggKHRoaXMuYWRkQ29tcHJlc3Npb24pIHsKICAgICAgICBjYXNlIExlcmNBZGRDb21wcmVzc2lvbi5Ob25lOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBMZXJjQWRkQ29tcHJlc3Npb24uRGVmbGF0ZToKICAgICAgICAgIGJ1ZmZlciA9IGluZmxhdGVfMShuZXcgVWludDhBcnJheShidWZmZXIpKS5idWZmZXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBMRVJDIGFkZGl0aW9uYWwgY29tcHJlc3Npb24gbWV0aG9kIGlkZW50aWZpZXI6ICR7dGhpcy5hZGRDb21wcmVzc2lvbn1gKTsKICAgICAgfQoKICAgICAgY29uc3QgbGVyY1Jlc3VsdCA9IExlcmMuZGVjb2RlKGJ1ZmZlcik7CiAgICAgIGNvbnN0IGxlcmNEYXRhID0gbGVyY1Jlc3VsdC5waXhlbHNbMF07IC8vIGFsd2F5cyBiYW5kLWludGVybGVhdmVkCiAgICAgIGNvbnN0IGRlY29kZWREYXRhID0gdGhpcy5wbGFuYXJDb25maWd1cmF0aW9uID09PSAxID8gdGhpcy5pbnRlcmxlYXZlUGl4ZWxzKGxlcmNEYXRhKSA6IGxlcmNEYXRhOyAvLyB0cmFuc2Zvcm0gdG8gcGl4ZWwtaW50ZXJsZWF2ZWQgaWYgZXhwZWN0ZWQKICAgICAgcmV0dXJuIGRlY29kZWREYXRhLmJ1ZmZlcjsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldERlY29kZXIoZmlsZURpcmVjdG9yeSkgewogICAgc3dpdGNoIChmaWxlRGlyZWN0b3J5LkNvbXByZXNzaW9uKSB7CiAgICAgIGNhc2UgdW5kZWZpbmVkOgogICAgICBjYXNlIDE6IC8vIG5vIGNvbXByZXNzaW9uCiAgICAgICAgcmV0dXJuIG5ldyBSYXdEZWNvZGVyKCk7CiAgICAgIGNhc2UgNTogLy8gTFpXCiAgICAgICAgcmV0dXJuIG5ldyBMWldEZWNvZGVyKGZpbGVEaXJlY3RvcnkpOwogICAgICBjYXNlIDY6IC8vIEpQRUcKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29sZCBzdHlsZSBKUEVHIGNvbXByZXNzaW9uIGlzIG5vdCBzdXBwb3J0ZWQuJyk7CiAgICAgIGNhc2UgNzogLy8gSlBFRwogICAgICAgIHJldHVybiBuZXcgSnBlZ0RlY29kZXIoZmlsZURpcmVjdG9yeSk7CiAgICAgIGNhc2UgODogLy8gRGVmbGF0ZSBhcyByZWNvZ25pemVkIGJ5IEFkb2JlCiAgICAgIGNhc2UgMzI5NDY6IC8vIERlZmxhdGUgR0RBTCBkZWZhdWx0CiAgICAgICAgcmV0dXJuIG5ldyBEZWZsYXRlRGVjb2RlcigpOwogICAgICBjYXNlIDMyNzczOiAvLyBwYWNrYml0cwogICAgICAgIHJldHVybiBuZXcgUGFja2JpdHNEZWNvZGVyKCk7CiAgICAgIGNhc2UgMzQ4ODc6IC8vIExFUkMKICAgICAgICByZXR1cm4gbmV3IExlcmNEZWNvZGVyKGZpbGVEaXJlY3RvcnkpOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBjb21wcmVzc2lvbiBtZXRob2QgaWRlbnRpZmllcjogJHtmaWxlRGlyZWN0b3J5LkNvbXByZXNzaW9ufWApOwogICAgfQogIH0KCiAgYXN5bmMgZnVuY3Rpb24gZGVjb2RlKGZpbGVEaXJlY3RvcnksIGJ1ZmZlcikgewogICAgY29uc3QgZGVjb2RlciA9IGdldERlY29kZXIoZmlsZURpcmVjdG9yeSk7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZWNvZGVyLmRlY29kZShmaWxlRGlyZWN0b3J5LCBidWZmZXIpOwogICAgc2VsZi5wb3N0TWVzc2FnZShyZXN1bHQsIFtyZXN1bHRdKTsKICB9CiAgaWYgKHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIikgewogICAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGV2ZW50KSA9PiB7CiAgICAgIGNvbnN0IFtuYW1lLCAuLi5hcmdzXSA9IGV2ZW50LmRhdGE7CiAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgIGNhc2UgImRlY29kZSI6CiAgICAgICAgICBkZWNvZGUoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7CiAgfQoKfSkoKTsK\";\n            const blob = typeof window !== \"undefined\" && window.Blob && new Blob([atob(encodedJs)], { type: \"text/javascript;charset=utf-8\" });\n            function WorkerWrapper() {\n              const objURL = blob && (window.URL || window.webkitURL).createObjectURL(blob);\n              try {\n                return objURL ? new Worker(objURL) : new Worker(\"data:application/javascript;base64,\" + encodedJs, {type: \"module\"});\n              } finally {\n                objURL && (window.URL || window.webkitURL).revokeObjectURL(objURL);\n              }\n            }\n\nconst defaultPoolSize = globalThis?.navigator?.hardwareConcurrency ?? 4;\nclass Pool {\n  workers;\n  idleWorkers;\n  waitQueue;\n  decoder;\n  constructor(size = defaultPoolSize) {\n    this.workers = [];\n    this.idleWorkers = [];\n    this.waitQueue = [];\n    this.decoder = null;\n    for (let i = 0; i < size; ++i) {\n      const w = new WorkerWrapper();\n      this.workers.push(w);\n      this.idleWorkers.push(w);\n    }\n  }\n  async decode(fileDirectory, buffer) {\n    const currentWorker = await this.waitForWorker();\n    return new Promise((resolve, reject) => {\n      currentWorker.onmessage = (event) => {\n        this.finishTask(currentWorker);\n        resolve(event.data);\n      };\n      currentWorker.onerror = (error) => {\n        this.finishTask(currentWorker);\n        reject(error);\n      };\n      currentWorker.postMessage([\"decode\", fileDirectory, buffer], [buffer]);\n    });\n  }\n  async waitForWorker() {\n    const idleWorker = this.idleWorkers.pop();\n    if (idleWorker) {\n      return idleWorker;\n    }\n    const waiter = {};\n    const promise = new Promise((resolve) => {\n      waiter.resolve = resolve;\n    });\n    this.waitQueue.push(waiter);\n    return promise;\n  }\n  async finishTask(currentWorker) {\n    const waiter = this.waitQueue.pop();\n    if (waiter) {\n      waiter.resolve(currentWorker);\n    } else {\n      this.idleWorkers.push(currentWorker);\n    }\n  }\n  destroy() {\n    for (let i = 0; i < this.workers.length; ++i) {\n      this.workers[i].terminate();\n    }\n  }\n}\n\nconst PARSER_OPTIONS = {\n  attributeNamePrefix: \"\",\n  attrNodeName: \"attr\",\n  parseNodeValue: true,\n  parseAttributeValue: true,\n  ignoreAttributes: false\n};\nconst parse = (str) => parser.parse(str, PARSER_OPTIONS);\nfunction fromString(str) {\n  const res = parse(str);\n  if (!res.OME) {\n    throw Error(\"Failed to parse OME-XML metadata.\");\n  }\n  return ensureArray(res.OME.Image).map((img) => {\n    const Channels = ensureArray(img.Pixels.Channel).map((c) => {\n      if (\"Color\" in c.attr) {\n        return { ...c.attr, Color: intToRgba(c.attr.Color) };\n      }\n      return { ...c.attr };\n    });\n    const { AquisitionDate = \"\", Description = \"\" } = img;\n    const image = {\n      ...img.attr,\n      AquisitionDate,\n      Description,\n      Pixels: {\n        ...img.Pixels.attr,\n        Channels\n      }\n    };\n    return {\n      ...image,\n      format() {\n        const { Pixels } = image;\n        const sizes = [\"X\", \"Y\", \"Z\"].map((name) => {\n          const size = Pixels[`PhysicalSize${name}`];\n          const unit = Pixels[`PhysicalSize${name}Unit`];\n          return size && unit ? `${size} ${unit}` : \"-\";\n        }).join(\" x \");\n        return {\n          \"Acquisition Date\": image.AquisitionDate,\n          \"Dimensions (XY)\": `${Pixels.SizeX} x ${Pixels.SizeY}`,\n          \"Pixels Type\": Pixels.Type,\n          \"Pixels Size (XYZ)\": sizes,\n          \"Z-sections/Timepoints\": `${Pixels.SizeZ} x ${Pixels.SizeT}`,\n          Channels: Pixels.SizeC\n        };\n      }\n    };\n  });\n}\n\nclass TiffPixelSource {\n  constructor(indexer, dtype, tileSize, shape, labels, meta, pool) {\n    this.dtype = dtype;\n    this.tileSize = tileSize;\n    this.shape = shape;\n    this.labels = labels;\n    this.meta = meta;\n    this.pool = pool;\n    this._indexer = indexer;\n  }\n  _indexer;\n  async getRaster({ selection, signal }) {\n    const image = await this._indexer(selection);\n    return this._readRasters(image, { signal });\n  }\n  async getTile({ x, y, selection, signal }) {\n    const { height, width } = this._getTileExtent(x, y);\n    const x0 = x * this.tileSize;\n    const y0 = y * this.tileSize;\n    const window = [x0, y0, x0 + width, y0 + height];\n    const image = await this._indexer(selection);\n    return this._readRasters(image, { window, width, height, signal });\n  }\n  async _readRasters(image, props) {\n    const interleave = isInterleaved(this.shape);\n    const raster = await image.readRasters({\n      interleave,\n      ...props,\n      pool: this.pool\n    });\n    if (props?.signal?.aborted) {\n      throw SIGNAL_ABORTED;\n    }\n    const data = interleave ? raster : raster[0];\n    return {\n      data,\n      width: raster.width,\n      height: raster.height\n    };\n  }\n  _getTileExtent(x, y) {\n    const { height: zoomLevelHeight, width: zoomLevelWidth } = getImageSize(this);\n    let height = this.tileSize;\n    let width = this.tileSize;\n    const maxXTileCoord = Math.floor(zoomLevelWidth / this.tileSize);\n    const maxYTileCoord = Math.floor(zoomLevelHeight / this.tileSize);\n    if (x === maxXTileCoord) {\n      width = zoomLevelWidth % this.tileSize;\n    }\n    if (y === maxYTileCoord) {\n      height = zoomLevelHeight % this.tileSize;\n    }\n    return { height, width };\n  }\n  onTileError(err) {\n    console.error(err);\n  }\n}\n\nfunction getOmeLegacyIndexer(tiff, rootMeta) {\n  const imgMeta = rootMeta[0];\n  const { SizeT, SizeC, SizeZ } = imgMeta.Pixels;\n  const ifdIndexer = getOmeIFDIndexer(imgMeta);\n  return (sel, pyramidLevel) => {\n    const index = ifdIndexer(sel);\n    const pyramidIndex = pyramidLevel * SizeZ * SizeT * SizeC;\n    return tiff.getImage(index + pyramidIndex);\n  };\n}\nfunction getOmeSubIFDIndexer(tiff, rootMeta) {\n  const imgMeta = rootMeta[0];\n  const ifdIndexer = getOmeIFDIndexer(imgMeta);\n  const ifdCache = new Map();\n  return async (sel, pyramidLevel) => {\n    const index = ifdIndexer(sel);\n    const baseImage = await tiff.getImage(index);\n    if (pyramidLevel === 0) {\n      return baseImage;\n    }\n    const { SubIFDs } = baseImage.fileDirectory;\n    if (!SubIFDs) {\n      throw Error(\"Indexing Error: OME-TIFF is missing SubIFDs.\");\n    }\n    const key = `${sel.t}-${sel.c}-${sel.z}-${pyramidLevel}`;\n    if (!ifdCache.has(key)) {\n      const subIfdOffset = SubIFDs[pyramidLevel - 1];\n      ifdCache.set(key, tiff.parseFileDirectoryAt(subIfdOffset));\n    }\n    const ifd = await ifdCache.get(key);\n    return new baseImage.constructor(ifd.fileDirectory, ifd.geoKeyDirectory, tiff.dataView, tiff.littleEndian, tiff.cache, tiff.source);\n  };\n}\nfunction getOmeIFDIndexer(imgMeta) {\n  const { SizeC, SizeZ, SizeT, DimensionOrder } = imgMeta.Pixels;\n  switch (DimensionOrder) {\n    case \"XYZCT\": {\n      return ({ t, c, z }) => t * SizeZ * SizeC + c * SizeZ + z;\n    }\n    case \"XYZTC\": {\n      return ({ t, c, z }) => c * SizeZ * SizeT + t * SizeZ + z;\n    }\n    case \"XYCTZ\": {\n      return ({ t, c, z }) => z * SizeC * SizeT + t * SizeC + c;\n    }\n    case \"XYCZT\": {\n      return ({ t, c, z }) => t * SizeC * SizeZ + z * SizeC + c;\n    }\n    case \"XYTCZ\": {\n      return ({ t, c, z }) => z * SizeT * SizeC + c * SizeT + t;\n    }\n    case \"XYTZC\": {\n      return ({ t, c, z }) => c * SizeT * SizeZ + z * SizeT + t;\n    }\n    default: {\n      throw new Error(`Invalid OME-XML DimensionOrder, got ${DimensionOrder}.`);\n    }\n  }\n}\n\nconst DTYPE_LOOKUP$1 = {\n  uint8: \"Uint8\",\n  uint16: \"Uint16\",\n  uint32: \"Uint32\",\n  float: \"Float32\",\n  double: \"Float64\",\n  int8: \"Int8\",\n  int16: \"Int16\",\n  int32: \"Int32\"\n};\nfunction getOmePixelSourceMeta({ Pixels }) {\n  const labels = getLabels(Pixels.DimensionOrder);\n  const dims = getDims(labels);\n  const shape = Array(labels.length).fill(0);\n  shape[dims(\"t\")] = Pixels.SizeT;\n  shape[dims(\"c\")] = Pixels.SizeC;\n  shape[dims(\"z\")] = Pixels.SizeZ;\n  if (Pixels.Interleaved) {\n    labels.push(\"_c\");\n    shape.push(3);\n  }\n  const getShape = (level) => {\n    const s = [...shape];\n    s[dims(\"x\")] = Pixels.SizeX >> level;\n    s[dims(\"y\")] = Pixels.SizeY >> level;\n    return s;\n  };\n  if (!(Pixels.Type in DTYPE_LOOKUP$1)) {\n    throw Error(`Pixel type ${Pixels.Type} not supported.`);\n  }\n  const dtype = DTYPE_LOOKUP$1[Pixels.Type];\n  if (Pixels.PhysicalSizeX && Pixels.PhysicalSizeY) {\n    const physicalSizes = {\n      x: {\n        size: Pixels.PhysicalSizeX,\n        unit: Pixels.PhysicalSizeXUnit\n      },\n      y: {\n        size: Pixels.PhysicalSizeY,\n        unit: Pixels.PhysicalSizeYUnit\n      }\n    };\n    if (Pixels.PhysicalSizeZ) {\n      physicalSizes.z = {\n        size: Pixels.PhysicalSizeZ,\n        unit: Pixels.PhysicalSizeZUnit\n      };\n    }\n    return { labels, getShape, physicalSizes, dtype };\n  }\n  return { labels, getShape, dtype };\n}\nfunction guessTileSize$1(image) {\n  const tileWidth = image.getTileWidth();\n  const tileHeight = image.getTileHeight();\n  const size = Math.min(tileWidth, tileHeight);\n  return prevPowerOf2(size);\n}\n\nasync function load$2(tiff, pool) {\n  const firstImage = await tiff.getImage(0);\n  const {\n    ImageDescription,\n    SubIFDs,\n    PhotometricInterpretation: photometricInterpretation\n  } = firstImage.fileDirectory;\n  const omexml = fromString(ImageDescription);\n  let levels;\n  let pyramidIndexer;\n  if (SubIFDs) {\n    levels = SubIFDs.length + 1;\n    pyramidIndexer = getOmeSubIFDIndexer(tiff, omexml);\n  } else {\n    levels = omexml.length;\n    pyramidIndexer = getOmeLegacyIndexer(tiff, omexml);\n  }\n  const imgMeta = omexml[0];\n  const { labels, getShape, physicalSizes, dtype } = getOmePixelSourceMeta(imgMeta);\n  const tileSize = guessTileSize$1(firstImage);\n  const meta = { photometricInterpretation, physicalSizes };\n  const data = Array.from({ length: levels }).map((_, resolution) => {\n    const shape = getShape(resolution);\n    const indexer = (sel) => pyramidIndexer(sel, resolution);\n    const source = new TiffPixelSource(indexer, dtype, tileSize, shape, labels, meta, pool);\n    return source;\n  });\n  return {\n    data,\n    metadata: imgMeta\n  };\n}\n\nasync function loadOmeTiff(source, opts = {}) {\n  const { headers, offsets, pool = true } = opts;\n  let tiff;\n  if (typeof source === \"string\") {\n    tiff = await fromUrl(source, { ...headers, cacheSize: Infinity });\n  } else {\n    tiff = await fromBlob(source);\n  }\n  if (offsets) {\n    tiff = createOffsetsProxy(tiff, offsets);\n  }\n  checkProxies(tiff);\n  return pool ? load$2(tiff, new Pool()) : load$2(tiff);\n}\n\nfunction joinUrlParts(...args) {\n  return args.map((part, i) => {\n    if (i === 0)\n      return part.trim().replace(/[/]*$/g, \"\");\n    return part.trim().replace(/(^[/]*|[/]*$)/g, \"\");\n  }).filter((x) => x.length).join(\"/\");\n}\nclass ReadOnlyStore {\n  async keys() {\n    return [];\n  }\n  async deleteItem() {\n    return false;\n  }\n  async setItem() {\n    console.warn(\"Cannot write to read-only store.\");\n    return false;\n  }\n}\nclass FileStore extends ReadOnlyStore {\n  _map;\n  _rootPrefix;\n  constructor(fileMap, rootPrefix = \"\") {\n    super();\n    this._map = fileMap;\n    this._rootPrefix = rootPrefix;\n  }\n  _key(key) {\n    return joinUrlParts(this._rootPrefix, key);\n  }\n  async getItem(key) {\n    const file = this._map.get(this._key(key));\n    if (!file) {\n      throw new KeyError(key);\n    }\n    const buffer = await file.arrayBuffer();\n    return buffer;\n  }\n  async containsItem(key) {\n    const path = this._key(key);\n    return this._map.has(path);\n  }\n}\n\nfunction isOmeZarr(dataShape, Pixels) {\n  const { SizeT, SizeC, SizeZ, SizeY, SizeX } = Pixels;\n  const omeZarrShape = [SizeT, SizeC, SizeZ, SizeY, SizeX];\n  return dataShape.every((size, i) => omeZarrShape[i] === size);\n}\nfunction guessBioformatsLabels({ shape }, { Pixels }) {\n  if (isOmeZarr(shape, Pixels)) {\n    return getLabels(\"XYZCT\");\n  }\n  const labels = getLabels(Pixels.DimensionOrder);\n  labels.forEach((lower, i) => {\n    const label = lower.toUpperCase();\n    const xmlSize = Pixels[`Size${label}`];\n    if (!xmlSize) {\n      throw Error(`Dimension ${label} is invalid for OME-XML.`);\n    }\n    if (shape[i] !== xmlSize) {\n      throw Error(\"Dimension mismatch between zarr source and OME-XML.\");\n    }\n  });\n  return labels;\n}\nfunction getRootPrefix(files, rootName) {\n  const first = files.find((f) => f.path.indexOf(rootName) > 0);\n  if (!first) {\n    throw Error(\"Could not find root in store.\");\n  }\n  const prefixLength = first.path.indexOf(rootName) + rootName.length;\n  return first.path.slice(0, prefixLength);\n}\nasync function loadMultiscales(store, path = \"\") {\n  const grp = await openGroup(store, path);\n  const rootAttrs = await grp.attrs.asObject();\n  let paths = [\"0\"];\n  if (\"multiscales\" in rootAttrs) {\n    const { datasets } = rootAttrs.multiscales[0];\n    paths = datasets.map((d) => d.path);\n  }\n  const data = paths.map((path2) => grp.getItem(path2));\n  return {\n    data: await Promise.all(data),\n    rootAttrs\n  };\n}\nfunction guessTileSize(arr) {\n  const interleaved = isInterleaved(arr.shape);\n  const [yChunk, xChunk] = arr.chunks.slice(interleaved ? -3 : -2);\n  const size = Math.min(yChunk, xChunk);\n  return prevPowerOf2(size);\n}\n\nfunction getIndexer(labels) {\n  const size = labels.length;\n  const dims = getDims(labels);\n  return (sel) => {\n    if (Array.isArray(sel)) {\n      return [...sel];\n    }\n    const selection = Array(size).fill(0);\n    for (const [key, value] of Object.entries(sel)) {\n      selection[dims(key)] = value;\n    }\n    return selection;\n  };\n}\n\nconst DTYPE_LOOKUP = {\n  u1: \"Uint8\",\n  u2: \"Uint16\",\n  u4: \"Uint32\",\n  f4: \"Float32\",\n  f8: \"Float64\",\n  i1: \"Int8\",\n  i2: \"Int16\",\n  i4: \"Int32\"\n};\nclass ZarrPixelSource {\n  constructor(data, labels, tileSize) {\n    this.labels = labels;\n    this.tileSize = tileSize;\n    this._indexer = getIndexer(labels);\n    this._data = data;\n    const xChunkSize = data.chunks[this._xIndex];\n    const yChunkSize = data.chunks[this._xIndex - 1];\n    this._readChunks = tileSize === xChunkSize && tileSize === yChunkSize;\n  }\n  _data;\n  _indexer;\n  _readChunks;\n  get shape() {\n    return this._data.shape;\n  }\n  get dtype() {\n    const suffix = this._data.dtype.slice(1);\n    if (!(suffix in DTYPE_LOOKUP)) {\n      throw Error(`Zarr dtype not supported, got ${suffix}.`);\n    }\n    return DTYPE_LOOKUP[suffix];\n  }\n  get _xIndex() {\n    const interleave = isInterleaved(this._data.shape);\n    return this._data.shape.length - (interleave ? 2 : 1);\n  }\n  _chunkIndex(selection, x, y) {\n    const sel = this._indexer(selection);\n    sel[this._xIndex] = x;\n    sel[this._xIndex - 1] = y;\n    return sel;\n  }\n  _getSlices(x, y) {\n    const { height, width } = getImageSize(this);\n    const [xStart, xStop] = [\n      x * this.tileSize,\n      Math.min((x + 1) * this.tileSize, width)\n    ];\n    const [yStart, yStop] = [\n      y * this.tileSize,\n      Math.min((y + 1) * this.tileSize, height)\n    ];\n    if (xStart === xStop || yStart === yStop) {\n      throw new BoundsCheckError(\"Tile slice is zero-sized.\");\n    }\n    return [slice(xStart, xStop), slice(yStart, yStop)];\n  }\n  async getRaster({ selection }) {\n    const sel = this._chunkIndex(selection, null, null);\n    const { data, shape } = await this._data.getRaw(sel);\n    const [height, width] = shape;\n    return { data, width, height };\n  }\n  async getTile(props) {\n    const { x, y, selection, signal } = props;\n    let res;\n    if (this._readChunks) {\n      const sel = this._chunkIndex(selection, x, y);\n      res = await this._data.getRawChunk(sel, { storeOptions: { signal } });\n    } else {\n      const [xSlice, ySlice] = this._getSlices(x, y);\n      const sel = this._chunkIndex(selection, xSlice, ySlice);\n      res = await this._data.getRaw(sel);\n    }\n    const {\n      data,\n      shape: [height, width]\n    } = res;\n    return { data, width, height };\n  }\n  onTileError(err) {\n    if (!(err instanceof BoundsCheckError)) {\n      throw err;\n    }\n  }\n}\n\nasync function load$1(root, xmlSource) {\n  if (typeof xmlSource !== \"string\") {\n    xmlSource = await xmlSource.text();\n  }\n  const imgMeta = fromString(xmlSource)[0];\n  const { data } = await loadMultiscales(root, \"0\");\n  const labels = guessBioformatsLabels(data[0], imgMeta);\n  const tileSize = guessTileSize(data[0]);\n  const pyramid = data.map((arr) => new ZarrPixelSource(arr, labels, tileSize));\n  return {\n    data: pyramid,\n    metadata: imgMeta\n  };\n}\n\nasync function load(store) {\n  const { data, rootAttrs } = await loadMultiscales(store);\n  const labels = [\"t\", \"c\", \"z\", \"y\", \"x\"];\n  const tileSize = guessTileSize(data[0]);\n  const pyramid = data.map((arr) => new ZarrPixelSource(arr, labels, tileSize));\n  return {\n    data: pyramid,\n    metadata: rootAttrs\n  };\n}\n\nasync function loadBioformatsZarr(source, options = {}) {\n  const METADATA = \"METADATA.ome.xml\";\n  const ZARR_DIR = \"data.zarr\";\n  if (typeof source === \"string\") {\n    const url = source.endsWith(\"/\") ? source.slice(0, -1) : source;\n    const store2 = new HTTPStore(url + \"/\" + ZARR_DIR, options);\n    const xmlSource = await fetch(url + \"/\" + METADATA, options.fetchOptions);\n    return load$1(store2, xmlSource);\n  }\n  const fMap = new Map();\n  let xmlFile;\n  for (const file of source) {\n    if (file.name === METADATA) {\n      xmlFile = file;\n    } else {\n      fMap.set(file.path, file);\n    }\n  }\n  if (!xmlFile) {\n    throw Error(\"No OME-XML metadata found for store.\");\n  }\n  const store = new FileStore(fMap, getRootPrefix(source, ZARR_DIR));\n  return load$1(store, xmlFile);\n}\nasync function loadOmeZarr(source, options = {}) {\n  const store = new HTTPStore(source, options);\n  if (options?.type !== \"multiscales\") {\n    throw Error(\"Only multiscale OME-Zarr is supported.\");\n  }\n  return load(store);\n}\n\nexport { BitmapLayer, COLORMAPS, DETAIL_VIEW_ID, DTYPE_VALUES, DetailView, ImageLayer, MAX_CHANNELS, MultiscaleImageLayer, OVERVIEW_VIEW_ID, OverviewLayer, OverviewView, PictureInPictureViewer, RENDERING_MODES, ScaleBarLayer, SideBySideView, SideBySideViewer, TiffPixelSource, VivView, VivViewer, VolumeLayer, VolumeView, VolumeViewer, XR3DLayer, XRLayer, ZarrPixelSource, getChannelStats, getDefaultInitialViewState, loadBioformatsZarr, loadOmeTiff, loadOmeZarr };\n", "import { RENDERING_MODES } from '@hms-dbmi/viv';\n\nexport const GLOBAL_LABELS = ['z', 't'];\n\nexport const DEFAULT_RASTER_DOMAIN_TYPE = 'Min/Max';\n\nexport const DEFAULT_RASTER_LAYER_PROPS = {\n  visible: true,\n  colormap: null,\n  opacity: 1,\n  domainType: DEFAULT_RASTER_DOMAIN_TYPE,\n  transparentColor: [0, 0, 0],\n  renderingMode: RENDERING_MODES.ADDITIVE,\n  use3d: false,\n};\n\nexport const DEFAULT_MOLECULES_LAYER = {\n  opacity: 1, radius: 20, visible: true,\n};\nexport const DEFAULT_CELLS_LAYER = {\n  opacity: 1, radius: 50, visible: true, stroked: false,\n};\nexport const DEFAULT_NEIGHBORHOODS_LAYER = {\n  visible: false,\n};\n\nexport const DEFAULT_LAYER_TYPE_ORDERING = [\n  'molecules',\n  'cells',\n  'neighborhoods',\n  'raster',\n];\n", "/**\n * Constants representing names of coordination types,\n * to help prevent typos.\n */\nexport const COORDINATION_TYPES = {\n  DATASET: 'dataset',\n  EMBEDDING_TYPE: 'embeddingType',\n  EMBEDDING_ZOOM: 'embeddingZoom',\n  EMBEDDING_ROTATION: 'embeddingRotation',\n  EMBEDDING_TARGET_X: 'embeddingTargetX',\n  EMBEDDING_TARGET_Y: 'embeddingTargetY',\n  EMBEDDING_TARGET_Z: 'embeddingTargetZ',\n  EMBEDDING_CELL_SET_POLYGONS_VISIBLE: 'embeddingCellSetPolygonsVisible',\n  EMBEDDING_CELL_SET_LABELS_VISIBLE: 'embeddingCellSetLabelsVisible',\n  EMBEDDING_CELL_SET_LABEL_SIZE: 'embeddingCellSetLabelSize',\n  EMBEDDING_CELL_RADIUS: 'embeddingCellRadius',\n  EMBEDDING_CELL_OPACITY: 'embeddingCellOpacity',\n  EMBEDDING_CELL_RADIUS_MODE: 'embeddingCellRadiusMode',\n  EMBEDDING_CELL_OPACITY_MODE: 'embeddingCellOpacityMode',\n  SPATIAL_ZOOM: 'spatialZoom',\n  SPATIAL_ROTATION: 'spatialRotation',\n  SPATIAL_TARGET_X: 'spatialTargetX',\n  SPATIAL_TARGET_Y: 'spatialTargetY',\n  SPATIAL_TARGET_Z: 'spatialTargetZ',\n  SPATIAL_ROTATION_X: 'spatialRotationX',\n  SPATIAL_ROTATION_Y: 'spatialRotationY',\n  SPATIAL_ROTATION_Z: 'spatialRotationZ',\n  SPATIAL_ROTATION_ORBIT: 'spatialRotationOrbit',\n  SPATIAL_ORBIT_AXIS: 'spatialOrbitAxis',\n  SPATIAL_AXIS_FIXED: 'spatialAxisFixed',\n  HEATMAP_ZOOM_X: 'heatmapZoomX',\n  HEATMAP_ZOOM_Y: 'heatmapZoomY',\n  HEATMAP_TARGET_X: 'heatmapTargetX',\n  HEATMAP_TARGET_Y: 'heatmapTargetY',\n  CELL_FILTER: 'cellFilter',\n  CELL_HIGHLIGHT: 'cellHighlight',\n  CELL_SET_SELECTION: 'cellSetSelection',\n  CELL_SET_HIGHLIGHT: 'cellSetHighlight',\n  CELL_SET_COLOR: 'cellSetColor',\n  GENE_FILTER: 'geneFilter',\n  GENE_HIGHLIGHT: 'geneHighlight',\n  GENE_SELECTION: 'geneSelection',\n  GENE_EXPRESSION_COLORMAP: 'geneExpressionColormap',\n  GENE_EXPRESSION_TRANSFORM: 'geneExpressionTransform',\n  GENE_EXPRESSION_COLORMAP_RANGE: 'geneExpressionColormapRange',\n  CELL_COLOR_ENCODING: 'cellColorEncoding',\n  SPATIAL_RASTER_LAYERS: 'spatialRasterLayers',\n  SPATIAL_CELLS_LAYER: 'spatialCellsLayer',\n  SPATIAL_MOLECULES_LAYER: 'spatialMoleculesLayer',\n  SPATIAL_NEIGHBORHOODS_LAYER: 'spatialNeighborhoodsLayer',\n  GENOMIC_ZOOM_X: 'genomicZoomX',\n  GENOMIC_ZOOM_Y: 'genomicZoomY',\n  GENOMIC_TARGET_X: 'genomicTargetX',\n  GENOMIC_TARGET_Y: 'genomicTargetY',\n  ADDITIONAL_CELL_SETS: 'additionalCellSets',\n  MOLECULE_HIGHLIGHT: 'moleculeHighlight',\n};\n\n/**\n * Coordination types may have default values,\n * which can be defined here, and used by the\n * auto initialization strategy.\n */\nexport const DEFAULT_COORDINATION_VALUES = {\n  [COORDINATION_TYPES.EMBEDDING_ZOOM]: null,\n  [COORDINATION_TYPES.EMBEDDING_ROTATION]: 0,\n  [COORDINATION_TYPES.EMBEDDING_TARGET_X]: null,\n  [COORDINATION_TYPES.EMBEDDING_TARGET_Y]: null,\n  [COORDINATION_TYPES.EMBEDDING_TARGET_Z]: 0,\n  [COORDINATION_TYPES.EMBEDDING_CELL_SET_POLYGONS_VISIBLE]: false,\n  [COORDINATION_TYPES.EMBEDDING_CELL_SET_LABELS_VISIBLE]: false,\n  [COORDINATION_TYPES.EMBEDDING_CELL_SET_LABEL_SIZE]: 14,\n  [COORDINATION_TYPES.EMBEDDING_CELL_RADIUS]: 1,\n  [COORDINATION_TYPES.EMBEDDING_CELL_RADIUS_MODE]: 'auto',\n  [COORDINATION_TYPES.EMBEDDING_CELL_OPACITY]: 1,\n  [COORDINATION_TYPES.EMBEDDING_CELL_OPACITY_MODE]: 'auto',\n  [COORDINATION_TYPES.SPATIAL_ZOOM]: null,\n  [COORDINATION_TYPES.SPATIAL_ROTATION]: 0,\n  [COORDINATION_TYPES.SPATIAL_TARGET_X]: null,\n  [COORDINATION_TYPES.SPATIAL_TARGET_Y]: null,\n  [COORDINATION_TYPES.SPATIAL_TARGET_Z]: null,\n  [COORDINATION_TYPES.SPATIAL_ROTATION_X]: null,\n  [COORDINATION_TYPES.SPATIAL_ROTATION_Y]: null,\n  [COORDINATION_TYPES.SPATIAL_ROTATION_Z]: null,\n  [COORDINATION_TYPES.SPATIAL_AXIS_FIXED]: false,\n  [COORDINATION_TYPES.SPATIAL_ROTATION_ORBIT]: 0,\n  [COORDINATION_TYPES.SPATIAL_ORBIT_AXIS]: 'Y',\n  [COORDINATION_TYPES.SPATIAL_RASTER_LAYERS]: null,\n  [COORDINATION_TYPES.SPATIAL_CELLS_LAYER]: null,\n  [COORDINATION_TYPES.SPATIAL_MOLECULES_LAYER]: null,\n  [COORDINATION_TYPES.SPATIAL_NEIGHBORHOODS_LAYER]: null,\n  [COORDINATION_TYPES.HEATMAP_ZOOM_X]: 0,\n  [COORDINATION_TYPES.HEATMAP_ZOOM_Y]: 0,\n  [COORDINATION_TYPES.HEATMAP_TARGET_X]: 0,\n  [COORDINATION_TYPES.HEATMAP_TARGET_Y]: 0,\n  [COORDINATION_TYPES.GENE_EXPRESSION_COLORMAP]: 'plasma',\n  [COORDINATION_TYPES.GENE_EXPRESSION_COLORMAP_RANGE]: [0.0, 1.0],\n  [COORDINATION_TYPES.GENE_EXPRESSION_TRANSFORM]: null,\n  [COORDINATION_TYPES.GENE_FILTER]: null,\n  [COORDINATION_TYPES.GENE_HIGHLIGHT]: null,\n  [COORDINATION_TYPES.GENE_SELECTION]: null,\n  [COORDINATION_TYPES.CELL_FILTER]: null,\n  [COORDINATION_TYPES.CELL_HIGHLIGHT]: null,\n  [COORDINATION_TYPES.CELL_SET_SELECTION]: null,\n  [COORDINATION_TYPES.CELL_SET_HIGHLIGHT]: null,\n  [COORDINATION_TYPES.CELL_SET_COLOR]: null,\n  [COORDINATION_TYPES.CELL_COLOR_ENCODING]: 'cellSetSelection',\n  [COORDINATION_TYPES.GENOMIC_ZOOM_X]: 0,\n  [COORDINATION_TYPES.GENOMIC_ZOOM_Y]: 0,\n  [COORDINATION_TYPES.GENOMIC_TARGET_X]: 1549999999.5,\n  [COORDINATION_TYPES.GENOMIC_TARGET_Y]: 1549999999.5,\n  [COORDINATION_TYPES.ADDITIONAL_CELL_SETS]: null,\n  [COORDINATION_TYPES.MOLECULE_HIGHLIGHT]: null,\n};\n\n// The following coordination types should be\n// initialized to independent scopes when\n// initialized automatically.\n// These make the resulting view config\n// (after auto-initialization) behave\n// like \"legacy\" Vitessce (pre-coordination model).\nexport const AUTO_INDEPENDENT_COORDINATION_TYPES = [\n  COORDINATION_TYPES.HEATMAP_ZOOM_X,\n  COORDINATION_TYPES.HEATMAP_ZOOM_Y,\n  COORDINATION_TYPES.HEATMAP_TARGET_X,\n  COORDINATION_TYPES.HEATMAP_TARGET_Y,\n  COORDINATION_TYPES.EMBEDDING_ZOOM,\n  COORDINATION_TYPES.EMBEDDING_TARGET_X,\n  COORDINATION_TYPES.EMBEDDING_TARGET_Y,\n  COORDINATION_TYPES.EMBEDDING_TARGET_Z,\n  COORDINATION_TYPES.EMBEDDING_CELL_SET_POLYGONS_VISIBLE,\n  COORDINATION_TYPES.EMBEDDING_CELL_SET_LABELS_VISIBLE,\n  COORDINATION_TYPES.EMBEDDING_CELL_SET_LABEL_SIZE,\n  COORDINATION_TYPES.EMBEDDING_CELL_RADIUS,\n  COORDINATION_TYPES.EMBEDDING_CELL_OPACITY,\n];\n\n/**\n   * Mapping from component type to\n   * supported coordination object types.\n   * This mapping can be used to determine\n   * which pieces of state that a component will\n   * need to get/set.\n   * Keys here are the component registry keys.\n   */\nexport const COMPONENT_COORDINATION_TYPES = {\n  scatterplot: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.EMBEDDING_TYPE,\n    COORDINATION_TYPES.EMBEDDING_ZOOM,\n    COORDINATION_TYPES.EMBEDDING_ROTATION,\n    COORDINATION_TYPES.EMBEDDING_TARGET_X,\n    COORDINATION_TYPES.EMBEDDING_TARGET_Y,\n    COORDINATION_TYPES.EMBEDDING_TARGET_Z,\n    COORDINATION_TYPES.EMBEDDING_CELL_SET_POLYGONS_VISIBLE,\n    COORDINATION_TYPES.EMBEDDING_CELL_SET_LABELS_VISIBLE,\n    COORDINATION_TYPES.EMBEDDING_CELL_SET_LABEL_SIZE,\n    COORDINATION_TYPES.EMBEDDING_CELL_RADIUS,\n    COORDINATION_TYPES.EMBEDDING_CELL_RADIUS_MODE,\n    COORDINATION_TYPES.EMBEDDING_CELL_OPACITY,\n    COORDINATION_TYPES.EMBEDDING_CELL_OPACITY_MODE,\n    COORDINATION_TYPES.CELL_FILTER,\n    COORDINATION_TYPES.CELL_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_SELECTION,\n    COORDINATION_TYPES.CELL_SET_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_COLOR,\n    COORDINATION_TYPES.GENE_HIGHLIGHT,\n    COORDINATION_TYPES.GENE_SELECTION,\n    COORDINATION_TYPES.GENE_EXPRESSION_COLORMAP,\n    COORDINATION_TYPES.GENE_EXPRESSION_COLORMAP_RANGE,\n    COORDINATION_TYPES.CELL_COLOR_ENCODING,\n    COORDINATION_TYPES.ADDITIONAL_CELL_SETS,\n  ],\n  spatial: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.SPATIAL_ZOOM,\n    COORDINATION_TYPES.SPATIAL_ROTATION,\n    COORDINATION_TYPES.SPATIAL_RASTER_LAYERS,\n    COORDINATION_TYPES.SPATIAL_CELLS_LAYER,\n    COORDINATION_TYPES.SPATIAL_MOLECULES_LAYER,\n    COORDINATION_TYPES.SPATIAL_NEIGHBORHOODS_LAYER,\n    COORDINATION_TYPES.SPATIAL_TARGET_X,\n    COORDINATION_TYPES.SPATIAL_TARGET_Y,\n    COORDINATION_TYPES.SPATIAL_TARGET_Z,\n    COORDINATION_TYPES.SPATIAL_ROTATION_X,\n    COORDINATION_TYPES.SPATIAL_ROTATION_Y,\n    COORDINATION_TYPES.SPATIAL_ROTATION_Z,\n    COORDINATION_TYPES.SPATIAL_ROTATION_ORBIT,\n    COORDINATION_TYPES.SPATIAL_ORBIT_AXIS,\n    COORDINATION_TYPES.SPATIAL_AXIS_FIXED,\n    COORDINATION_TYPES.CELL_FILTER,\n    COORDINATION_TYPES.CELL_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_SELECTION,\n    COORDINATION_TYPES.CELL_SET_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_COLOR,\n    COORDINATION_TYPES.GENE_HIGHLIGHT,\n    COORDINATION_TYPES.GENE_SELECTION,\n    COORDINATION_TYPES.GENE_EXPRESSION_COLORMAP,\n    COORDINATION_TYPES.GENE_EXPRESSION_COLORMAP_RANGE,\n    COORDINATION_TYPES.CELL_COLOR_ENCODING,\n    COORDINATION_TYPES.ADDITIONAL_CELL_SETS,\n    COORDINATION_TYPES.MOLECULE_HIGHLIGHT,\n  ],\n  heatmap: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.HEATMAP_ZOOM_X,\n    COORDINATION_TYPES.HEATMAP_ZOOM_Y,\n    COORDINATION_TYPES.HEATMAP_TARGET_X,\n    COORDINATION_TYPES.HEATMAP_TARGET_Y,\n    COORDINATION_TYPES.CELL_FILTER,\n    COORDINATION_TYPES.CELL_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_SELECTION,\n    COORDINATION_TYPES.CELL_SET_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_COLOR,\n    COORDINATION_TYPES.GENE_FILTER,\n    COORDINATION_TYPES.GENE_HIGHLIGHT,\n    COORDINATION_TYPES.GENE_SELECTION,\n    COORDINATION_TYPES.GENE_EXPRESSION_COLORMAP,\n    COORDINATION_TYPES.GENE_EXPRESSION_COLORMAP_RANGE,\n    COORDINATION_TYPES.CELL_COLOR_ENCODING,\n    COORDINATION_TYPES.ADDITIONAL_CELL_SETS,\n  ],\n  cellSets: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.CELL_SET_SELECTION,\n    COORDINATION_TYPES.CELL_SET_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_COLOR,\n    COORDINATION_TYPES.CELL_COLOR_ENCODING,\n    COORDINATION_TYPES.ADDITIONAL_CELL_SETS,\n  ],\n  cellSetSizes: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.CELL_SET_SELECTION,\n    COORDINATION_TYPES.CELL_SET_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_COLOR,\n    COORDINATION_TYPES.ADDITIONAL_CELL_SETS,\n  ],\n  cellSetExpression: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.GENE_SELECTION,\n    COORDINATION_TYPES.GENE_EXPRESSION_TRANSFORM,\n    COORDINATION_TYPES.CELL_SET_SELECTION,\n    COORDINATION_TYPES.CELL_SET_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_COLOR,\n    COORDINATION_TYPES.ADDITIONAL_CELL_SETS,\n  ],\n  status: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.CELL_HIGHLIGHT,\n    COORDINATION_TYPES.GENE_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_HIGHLIGHT,\n    COORDINATION_TYPES.MOLECULE_HIGHLIGHT,\n  ],\n  genes: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.GENE_FILTER,\n    COORDINATION_TYPES.GENE_HIGHLIGHT,\n    COORDINATION_TYPES.GENE_SELECTION,\n    COORDINATION_TYPES.CELL_COLOR_ENCODING,\n  ],\n  expressionHistogram: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.GENE_SELECTION,\n  ],\n  layerController: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.SPATIAL_RASTER_LAYERS,\n    COORDINATION_TYPES.SPATIAL_CELLS_LAYER,\n    COORDINATION_TYPES.SPATIAL_MOLECULES_LAYER,\n    COORDINATION_TYPES.SPATIAL_NEIGHBORHOODS_LAYER,\n    COORDINATION_TYPES.SPATIAL_ZOOM,\n    COORDINATION_TYPES.SPATIAL_TARGET_X,\n    COORDINATION_TYPES.SPATIAL_TARGET_Y,\n    COORDINATION_TYPES.SPATIAL_TARGET_Z,\n    COORDINATION_TYPES.SPATIAL_ROTATION_X,\n    COORDINATION_TYPES.SPATIAL_ROTATION_Y,\n    COORDINATION_TYPES.SPATIAL_ROTATION_Z,\n    COORDINATION_TYPES.SPATIAL_ROTATION_ORBIT,\n    COORDINATION_TYPES.SPATIAL_ORBIT_AXIS,\n  ],\n  higlass: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.GENOMIC_ZOOM_X,\n    COORDINATION_TYPES.GENOMIC_ZOOM_Y,\n    COORDINATION_TYPES.GENOMIC_TARGET_X,\n    COORDINATION_TYPES.GENOMIC_TARGET_Y,\n    COORDINATION_TYPES.GENE_FILTER,\n    COORDINATION_TYPES.GENE_HIGHLIGHT,\n    COORDINATION_TYPES.GENE_SELECTION,\n  ],\n  genomicProfiles: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.GENOMIC_ZOOM_X,\n    COORDINATION_TYPES.GENOMIC_ZOOM_Y,\n    COORDINATION_TYPES.GENOMIC_TARGET_X,\n    COORDINATION_TYPES.GENOMIC_TARGET_Y,\n    COORDINATION_TYPES.GENE_FILTER,\n    COORDINATION_TYPES.GENE_HIGHLIGHT,\n    COORDINATION_TYPES.GENE_SELECTION,\n    COORDINATION_TYPES.CELL_SET_SELECTION,\n    COORDINATION_TYPES.CELL_SET_HIGHLIGHT,\n    COORDINATION_TYPES.CELL_SET_COLOR,\n    COORDINATION_TYPES.ADDITIONAL_CELL_SETS,\n  ],\n  description: [\n    COORDINATION_TYPES.DATASET,\n    COORDINATION_TYPES.SPATIAL_RASTER_LAYERS,\n  ],\n};\n", "/* eslint-disable no-underscore-dangle */\nimport uuidv4 from 'uuid/v4';\nimport isNil from 'lodash/isNil';\nimport isEqual from 'lodash/isEqual';\nimport range from 'lodash/range';\nimport { featureCollection as turfFeatureCollection, point as turfPoint } from '@turf/helpers';\nimport centroid from '@turf/centroid';\nimport concaveman from 'concaveman';\nimport {\n  HIERARCHICAL_SCHEMAS,\n} from './constants';\nimport { getDefaultColor, PALETTE } from '../utils';\nimport { pathToKey } from './utils';\n\n/**\n * Alias for the uuidv4 function to make code more readable.\n * @returns {string} UUID.\n */\nfunction generateKey() {\n  return uuidv4();\n}\n\n/**\n * Get the set associated with a particular node.\n * Recursive.\n * @param {object} currNode A node object.\n * @returns {array} The array representing the set associated with the node.\n */\nexport function nodeToSet(currNode) {\n  if (!currNode) {\n    return [];\n  }\n  if (!currNode.children) {\n    return (currNode.set || []);\n  }\n  return currNode.children.flatMap(c => nodeToSet(c));\n}\n\n/**\n * Get the height of a node (the number of levels to reach a leaf).\n * @param {object} currNode A node object.\n * @param {number} level The level that the height will be computed relative to. By default, 0.\n * @returns {number} The height. If the node has a .children property,\n * then the minimum value returned is 1.\n */\nexport function nodeToHeight(currNode, level = 0) {\n  if (!currNode.children) {\n    return level;\n  }\n  const newLevel = level + 1;\n  const childrenHeights = currNode.children.map(c => nodeToHeight(c, newLevel));\n  return Math.max(...childrenHeights, newLevel);\n}\n\n/**\n * Get the size associated with a particular node.\n * Recursive.\n * @param {object} currNode A node object.\n * @returns {number} The length of all the node's children\n */\nexport function getNodeLength(currNode) {\n  if (!currNode) {\n    return 0;\n  }\n  if (!currNode.children) {\n    return (currNode.set?.length || 0);\n  }\n  return currNode.children.reduce((acc, curr) => acc + getNodeLength(curr), 0);\n}\n\n/**\n * Find a node with a matching name path, relative to a particular node.\n * @param {object} node A node object.\n * @param {string[]} path The name path for the node of interest.\n * @param {number} currLevelIndex The index of the current hierarchy level.\n * @returns {object|null} A matching node object, or null if none is found.\n */\nfunction nodeFindNodeByNamePath(node, path, currLevelIndex) {\n  const currNodeName = path[currLevelIndex];\n  if (node.name === currNodeName) {\n    if (currLevelIndex === path.length - 1) {\n      return node;\n    }\n    if (node.children) {\n      const foundNodes = node.children\n        .map(child => nodeFindNodeByNamePath(child, path, currLevelIndex + 1))\n        .filter(Boolean);\n      if (foundNodes.length === 1) {\n        return foundNodes[0];\n      }\n    }\n  }\n  return null;\n}\n\n/**\n * Find a node with a matching name path, relative to the whole tree.\n * @param {object} currTree A tree object.\n * @param {string[]} targetNamePath The name path for the node of interest.\n * @returns {object|null} A matching node object, or null if none is found.\n */\nexport function treeFindNodeByNamePath(currTree, targetNamePath) {\n  const foundNodes = currTree.tree\n    .map(levelZeroNode => nodeFindNodeByNamePath(levelZeroNode, targetNamePath, 0))\n    .filter(Boolean);\n  if (foundNodes.length === 1) {\n    return foundNodes[0];\n  }\n  return null;\n}\n\n/**\n * Transform a node object using a transform function.\n * @param {object} node A node object.\n * @param {function} predicate Returns true if a node matches a condition of interest.\n * @param {function} transform Takes the node matching the predicate as input, returns\n * a transformed version of the node.\n * @param {array} transformedPaths This array parameter is mutated. The path of\n * each transformed node is appended to this array.\n * @param {string[]} The current path of the node being updated, used internally\n * during recursion.\n * @returns {object} The updated node.\n */\nexport function nodeTransform(node, predicate, transform, transformedPaths, currPath) {\n  let newPath;\n  if (!currPath) {\n    newPath = [node.name];\n  } else {\n    newPath = [...currPath];\n  }\n  if (predicate(node, newPath)) {\n    transformedPaths.push(newPath);\n    return transform(node, newPath);\n  }\n  if (node.children) {\n    return {\n      ...node,\n      children: node.children.map(\n        child => nodeTransform(\n          child, predicate, transform, transformedPaths, newPath.concat([child.name]),\n        ),\n      ),\n    };\n  }\n  return node;\n}\n\n/**\n * Transform many node objects using a transform function.\n * @param {object} node A node object.\n * @param {function} predicate Returns true if a node matches a condition of interest.\n * @param {function} transform Takes the node matching the predicate as input, returns\n * a transformed version of the node.\n * @param {array} transformedPaths This array parameter is mutated. The path of\n * each transformed node is appended to this array.\n * @param {string[]} The current path of the node being updated, used internally\n * during recursion.\n * @returns {object} The updated node.\n */\nexport function nodeTransformAll(node, predicate, transform, transformedPaths, currPath) {\n  let newPath;\n  if (!currPath) {\n    newPath = [node.name];\n  } else {\n    newPath = [...currPath];\n  }\n  let newNode = node;\n  if (predicate(node, newPath)) {\n    transformedPaths.push(newPath);\n    newNode = transform(node, newPath);\n  }\n  if (node.children) {\n    return {\n      ...newNode,\n      children: newNode.children.map(\n        child => nodeTransformAll(\n          child, predicate, transform, transformedPaths, newPath.concat([child.name]),\n        ),\n      ),\n    };\n  }\n  return newNode;\n}\n\n/**\n * Append a child to a parent node.\n * @param {object} currNode A node object.\n * @param {object} newChild The child node object.\n * @returns {object} The updated node.\n */\nexport function nodeAppendChild(currNode, newChild) {\n  return {\n    ...currNode,\n    children: [...currNode.children, newChild],\n  };\n}\n\n/**\n * Prepend a child to a parent node.\n * @param {object} currNode A node object.\n * @param {object} newChild The child node object.\n * @returns {object} The updated node.\n */\nexport function nodePrependChild(currNode, newChild) {\n  return {\n    ...currNode,\n    children: [newChild, ...currNode.children],\n  };\n}\n\n/**\n * Insert a child to a parent node.\n * @param {object} currNode A node object.\n * @param {*} newChild The child node object.\n * @param {*} insertIndex The index at which to insert the child.\n * @returns {object} The updated node.\n */\nexport function nodeInsertChild(currNode, newChild, insertIndex) {\n  const newChildren = Array.from(currNode.children);\n  newChildren.splice(insertIndex, 0, newChild);\n  return {\n    ...currNode,\n    children: newChildren,\n  };\n}\n\n/**\n * Get an array representing the union of the sets of checked nodes.\n * @param {object} currTree A tree object.\n * @returns {array} An array representing the union of the sets of checked nodes.\n */\nexport function treeToUnion(currTree, checkedPaths) {\n  const nodes = checkedPaths.map(path => treeFindNodeByNamePath(currTree, path));\n  const nodeSets = nodes.map(node => nodeToSet(node).map(([cellId]) => cellId));\n  return nodeSets\n    .reduce((a, h) => a.concat(h.filter(hEl => !a.includes(hEl))), nodeSets[0] || []);\n}\n\n/**\n * Get an array representing the intersection of the sets of checked nodes.\n * @param {object} currTree A tree object.\n * @returns {array} An array representing the intersection of the sets of checked nodes.\n */\nexport function treeToIntersection(currTree, checkedPaths) {\n  const nodes = checkedPaths.map(path => treeFindNodeByNamePath(currTree, path));\n  const nodeSets = nodes.map(node => nodeToSet(node).map(([cellId]) => cellId));\n  return nodeSets\n    .reduce((a, h) => h.filter(hEl => a.includes(hEl)), nodeSets[0] || []);\n}\n\n/**\n * Get an array representing the complement of the union of the sets of checked nodes.\n * @param {object} currTree\n * @returns {array} An array representing the complement of the\n * union of the sets of checked nodes.\n */\nexport function treeToComplement(currTree, checkedPaths, items) {\n  const primaryUnion = treeToUnion(currTree, checkedPaths);\n  return items.filter(el => !primaryUnion.includes(el));\n}\n\n/**\n * Get an flattened array of descendants at a particular relative\n * level of interest.\n * @param {object} node A node object.\n * @param {number} level The relative level of interest.\n * 0 for this node's children, 1 for grandchildren, etc.\n * @param {boolean} stopEarly Should a node be returned early if no children exist?\n * @returns {object[]} An array of descendants at the specified level,\n * where the level is relative to the node.\n */\nexport function nodeToLevelDescendantNamePaths(node, level, prevPath, stopEarly = false) {\n  if (!node.children) {\n    if (!stopEarly) {\n      return null;\n    }\n    return [[...prevPath, node.name]];\n  }\n  if (level === 0) {\n    return [[...prevPath, node.name]];\n  }\n  return node.children\n    .flatMap(c => nodeToLevelDescendantNamePaths(c, level - 1, [...prevPath, node.name], stopEarly))\n    .filter(Boolean);\n}\n\n/**\n * Export the tree by clearing tree state and all node states.\n * @param {object} currTree A tree object.\n * @returns {object} Tree object with tree and node state removed.\n */\nexport function treeExport(currTree, datatype) {\n  return {\n    version: HIERARCHICAL_SCHEMAS[datatype].latestVersion,\n    datatype,\n    tree: currTree.tree,\n  };\n}\n\n/**\n * Export the tree by clearing tree state and all node states,\n * and filter so that only the level zero node of interest is included.\n * @param {object} currTree A tree object.\n * @param {string} nodePath The path of the node of interest.\n * @param {string} dataType Datatype (i.e cell sets)\n * @param {Array} cellSetColors Array of objects of cell set colors and paths\n * @param {string} theme \"light\" or \"dark\" for the vitessce theme\n * @returns {object} { treeToExport, nodeName }\n * Tree with one level zero node, and with state removed.\n */\nexport function treeExportLevelZeroNode(currTree, nodePath, datatype, cellSetColors, theme) {\n  const node = treeFindNodeByNamePath(currTree, nodePath);\n  const nodeWithColors = nodeTransformAll(node, () => true, (n, nPath) => {\n    const nodeColor = cellSetColors?.find(c => isEqual(c.path, nPath))?.color\n      ?? getDefaultColor(theme);\n    return {\n      ...n,\n      color: nodeColor.slice(0, 3),\n    };\n  }, []);\n  const treeWithOneLevelZeroNode = {\n    ...currTree,\n    tree: [nodeWithColors],\n  };\n  return {\n    treeToExport: treeExport(treeWithOneLevelZeroNode, datatype),\n    nodeName: node.name,\n  };\n}\n\n/**\n * Prepare the set of a node of interest for export.\n * @param {object} currTree A tree object.\n * @param {string} nodeKey The key of the node of interest.\n * @returns {object} { setToExport, nodeName } The set as an array.\n */\nexport function treeExportSet(currTree, nodePath) {\n  const node = treeFindNodeByNamePath(currTree, nodePath);\n  return { setToExport: nodeToSet(node), nodeName: node.name };\n}\n\n/**\n * Get an empty tree, with a default tree state.\n * @param {string} datatype The type of sets that this tree contains.\n * @returns {object} Empty tree.\n */\nexport function treeInitialize(datatype) {\n  return {\n    version: HIERARCHICAL_SCHEMAS[datatype].latestVersion,\n    datatype,\n    tree: [],\n  };\n}\n\n/**\n * For convenience, get an object with information required\n * to render a node as a component.\n * @param {object} node A node to be rendered.\n * @returns {object} An object containing properties required\n * by the TreeNode render functions.\n */\nexport function nodeToRenderProps(node, path, cellSetColor) {\n  const level = path.length - 1;\n  return {\n    title: node.name,\n    nodeKey: pathToKey(path),\n    path,\n    size: getNodeLength(node),\n    color: cellSetColor?.find(d => isEqual(d.path, path))?.color,\n    level,\n    isLeaf: (!node.children || node.children.length === 0) && Boolean(node.set),\n    height: nodeToHeight(node),\n  };\n}\n\n/**\n * Using a color and a probability, mix the color with an \"uncertainty\" color,\n * for example, gray.\n * Reference: https://github.com/bgrins/TinyColor/blob/80f7225029c428c0de0757f7d98ac15f497bee57/tinycolor.js#L701\n * @param {number[]} originalColor The color assignment for the class.\n * @param {number} p The mixing amount, or level certainty in the originalColor classification,\n * between 0 and 1.\n * @param {number[]} mixingColor The color with which to mix. By default, [128, 128, 128] gray.\n * @returns {number[]} Returns the color after mixing.\n */\nfunction colorMixWithUncertainty(originalColor, p, mixingColor = [128, 128, 128]) {\n  return [\n    ((originalColor[0] - mixingColor[0]) * p) + mixingColor[0],\n    ((originalColor[1] - mixingColor[1]) * p) + mixingColor[1],\n    ((originalColor[2] - mixingColor[2]) * p) + mixingColor[2],\n  ];\n}\n\n/**\n * Given a tree with state, get the cellIds and cellColors,\n * based on the nodes currently marked as \"visible\".\n * @param {object} currTree A tree object.\n *  @param {array} selectedNamePaths Array of arrays of strings,\n * representing set \"paths\".\n * @param {object[]} cellSetColor Array of objects with the\n * properties `path` and `color`.\n * @param {string} theme \"light\" or \"dark\" for the vitessce theme\n * @returns {array} Tuple of [cellIds, cellColors]\n * where cellIds is an array of strings,\n * and cellColors is an object mapping cellIds to color [r,g,b] arrays.\n */\nexport function treeToCellColorsBySetNames(currTree, selectedNamePaths, cellSetColor, theme) {\n  let cellColorsArray = [];\n  selectedNamePaths.forEach((setNamePath) => {\n    const node = treeFindNodeByNamePath(currTree, setNamePath);\n    if (node) {\n      const nodeSet = nodeToSet(node);\n      const nodeColor = (\n        cellSetColor?.find(d => isEqual(d.path, setNamePath))?.color\n        || getDefaultColor(theme)\n      );\n      cellColorsArray = [\n        ...cellColorsArray,\n        ...nodeSet.map(([cellId, prob]) => [\n          cellId,\n          (isNil(prob) ? nodeColor : colorMixWithUncertainty(nodeColor, prob)),\n        ]),\n      ];\n    }\n  });\n  return new Map(cellColorsArray);\n}\n\n/**\n * Given a tree with state, get an array of\n * objects with cellIds and cellColors,\n * based on the nodes currently marked as \"visible\".\n * @param {object} currTree A tree object.\n * @param {array} selectedNamePaths Array of arrays of strings,\n * representing set \"paths\".\n * @param {object[]} setColor Array of objects with the\n * properties `path` and `color`\n * @param {string} theme \"light\" or \"dark\" for the vitessce theme.\n * @returns {object[]} Array of objects with properties\n * `obsId`, `name`, and `color`.\n */\nexport function treeToObjectsBySetNames(currTree, selectedNamePaths, setColor, theme) {\n  let cellsArray = [];\n  for (let i = 0; i < selectedNamePaths.length; i += 1) {\n    const setNamePath = selectedNamePaths[i];\n    const node = treeFindNodeByNamePath(currTree, setNamePath);\n    if (node) {\n      const nodeSet = nodeToSet(node);\n      const nodeColor = (\n        setColor?.find(d => isEqual(d.path, setNamePath))?.color\n        || getDefaultColor(theme)\n      );\n      cellsArray = cellsArray.concat(nodeSet.map(([cellId]) => ({\n        obsId: cellId,\n        name: node.name,\n        color: nodeColor,\n      })));\n    }\n  }\n  return cellsArray;\n}\n\nexport function treeToCellPolygonsBySetNames(\n  currTree, cells, mapping, selectedNamePaths, cellSetColor, theme,\n) {\n  const cellSetPolygons = [];\n  selectedNamePaths.forEach((setNamePath) => {\n    const node = treeFindNodeByNamePath(currTree, setNamePath);\n    if (node) {\n      const nodeSet = nodeToSet(node);\n      const nodeColor = (\n        cellSetColor?.find(d => isEqual(d.path, setNamePath))?.color\n        || getDefaultColor(theme)\n      );\n      const cellPositions = nodeSet\n        .map(([cellId]) => ([\n          cells[cellId]?.mappings[mapping][0],\n          -cells[cellId]?.mappings[mapping][1],\n        ]))\n        .filter(cell => cell.every(i => typeof i === 'number'));\n\n      if (cellPositions.length > 2) {\n        const points = turfFeatureCollection(\n          cellPositions.map(turfPoint),\n        );\n        const concavity = Infinity;\n        const hullCoords = concaveman(cellPositions, concavity);\n        if (hullCoords) {\n          const centroidCoords = centroid(points).geometry.coordinates;\n          cellSetPolygons.push({\n            path: setNamePath,\n            name: setNamePath[setNamePath.length - 1],\n            hull: hullCoords,\n            color: nodeColor,\n            centroid: centroidCoords,\n          });\n        }\n      }\n    }\n  });\n  return cellSetPolygons;\n}\n\n/**\n * Given a tree with state, get the sizes of the\n * sets currently marked as \"visible\".\n * @param {object} currTree A tree object.\n * @param {array} selectedNamePaths Array of arrays of strings,\n * representing set \"paths\".\n * @param {object[]} setColor Array of objects with the\n * properties `path` and `color`.\n * @param {string} theme \"light\" or \"dark\" for the vitessce theme\n * @returns {object[]} Array of objects\n * with the properties `name`, `size`, `key`,\n * and `color`.\n */\nexport function treeToSetSizesBySetNames(currTree, selectedNamePaths, setColor, theme) {\n  const sizes = [];\n  selectedNamePaths.forEach((setNamePath) => {\n    const node = treeFindNodeByNamePath(currTree, setNamePath);\n    if (node) {\n      const nodeSet = nodeToSet(node);\n      const nodeColor = setColor.find(d => isEqual(d.path, setNamePath))?.color\n        || getDefaultColor(theme);\n      sizes.push({\n        key: generateKey(),\n        name: node.name,\n        size: nodeSet.length,\n        color: nodeColor,\n      });\n    }\n  });\n  return sizes;\n}\n\n/**\n * Find and remove a node from the descendants of the current node.\n * @param {object} node A node to search on.\n * @param {array} prevPath Path of the current node to be searched.\n * @param {array} filterPath The path sought.\n * @returns {object} A new node without a node at filterPath.\n */\nexport function filterNode(node, prevPath, filterPath) {\n  if (isEqual([...prevPath, node.name], filterPath)) {\n    return null;\n  }\n  if (!node.children) {\n    return node;\n  }\n  return {\n    ...node,\n    children: node.children.map(\n      c => filterNode(c, [...prevPath, node.name], filterPath),\n    ).filter(Boolean),\n  };\n}\n\nexport function treeToExpectedCheckedLevel(currTree, checkedPaths) {\n  let result = null;\n  if (currTree) {\n    currTree.tree.forEach((lzn) => {\n      const levelZeroPath = [lzn.name];\n      const height = nodeToHeight(lzn);\n      range(height).forEach((i) => {\n        const levelIndex = i + 1;\n        const levelNodePaths = nodeToLevelDescendantNamePaths(lzn, levelIndex, [], true);\n        if (isEqual(levelNodePaths, checkedPaths)) {\n          result = { levelZeroPath, levelIndex };\n        }\n      });\n    });\n  }\n  return result;\n}\n\nexport function treesConflict(cellSets, testCellSets) {\n  const paths = [];\n  const testPaths = [];\n  let hasConflict = false;\n\n  function getPaths(node, prevPath) {\n    paths.push([...prevPath, node.name]);\n    if (node.children) {\n      node.children.forEach(c => getPaths(c, [...prevPath, node.name]));\n    }\n  }\n  cellSets.tree.forEach(lzn => getPaths(lzn, []));\n\n  function getTestPaths(node, prevPath) {\n    testPaths.push([...prevPath, node.name]);\n    if (node.children) {\n      node.children.forEach(c => getPaths(c, [...prevPath, node.name]));\n    }\n  }\n  testCellSets.tree.forEach(lzn => getTestPaths(lzn, []));\n\n  testPaths.forEach((testPath) => {\n    if (paths.find(p => isEqual(p, testPath))) {\n      hasConflict = true;\n    }\n  });\n  return hasConflict;\n}\n\nexport function initializeCellSetColor(cellSets, cellSetColor) {\n  const nextCellSetColor = [...(cellSetColor || [])];\n  const nodeCountPerTreePerLevel = cellSets.tree.map(tree => Array\n    .from({\n      length: nodeToHeight(tree) + 1, // Need to add one because its an array.\n    }).fill(0));\n\n  function processNode(node, prevPath, hierarchyLevel, treeIndex) {\n    const index = nodeCountPerTreePerLevel[treeIndex][hierarchyLevel];\n    const nodePath = [...prevPath, node.name];\n\n    const nodeColor = nextCellSetColor.find(d => isEqual(d.path, nodePath));\n    if (!nodeColor) {\n      nextCellSetColor.push({\n        path: nodePath,\n        color: PALETTE[index % PALETTE.length],\n      });\n    }\n    nodeCountPerTreePerLevel[treeIndex][hierarchyLevel] += 1;\n    if (node.children) {\n      node.children.forEach(c => processNode(c, nodePath, hierarchyLevel + 1, treeIndex));\n    }\n  }\n\n  cellSets.tree.forEach((lzn, treeIndex) => processNode(lzn, [], 0, treeIndex));\n  return nextCellSetColor;\n}\n\nexport function getCellSetPolygons(params) {\n  const {\n    cells,\n    mapping,\n    cellSets,\n    cellSetSelection,\n    cellSetColor,\n    theme,\n  } = params;\n  if (cellSetSelection && cellSetSelection.length > 0 && cellSets && cells) {\n    return treeToCellPolygonsBySetNames(\n      cellSets, cells, mapping, cellSetSelection, cellSetColor, theme,\n    );\n  }\n  return [];\n}\n", "import tinycolor from 'tinycolor2';\nimport isEqual from 'lodash/isEqual';\n\n/**\n * Execute a callback function based on a keypress event.\n * @param {object} event The event from onKeyPress\n * @param {string} key The key identifier to match.\n * @param {Function} callback The function to execute.\n */\nexport function callbackOnKeyPress(event, key, callback) {\n  if (event.key === key) {\n    event.preventDefault();\n    callback();\n  }\n}\n\n/**\n * Convert an array of [r, g, b] numbers to a hex color.\n * @param {number[]} rgbArray The color [r, g, b] array.\n * @returns {string} The hex color as a string.\n */\nexport function colorArrayToString(rgbArray) {\n  return tinycolor({ r: rgbArray[0], g: rgbArray[1], b: rgbArray[2] }).toHexString();\n}\n\n/**\n * Convert a string color representation to an array of [r,g,b].\n * @param {string} colorString The color as a string.\n * @returns {number[]} The color as an array.\n */\nexport function colorStringToArray(colorString) {\n  const colorObj = tinycolor(colorString).toRgb();\n  return [colorObj.r, colorObj.g, colorObj.b];\n}\n\n/**\n * Get a string of help text for coloring a particular hierarchy level.\n * @param {integer} i The level. 1 for cluster, 2 for subcluster, etc.\n * @returns {string} The tooltip text for coloring the level.\n */\nexport function getLevelTooltipText(i) {\n  if (i === 0) return 'Color by hierarchy';\n  if (i <= 2) {\n    const subs = j => ('sub'.repeat(j));\n    return `Color by ${subs(i - 1)}cluster`;\n  }\n  return `Color by cluster level ${i}`;\n}\n\nexport function isEqualOrPrefix(targetPath, testPath) {\n  if (targetPath.length <= testPath.length) {\n    return isEqual(targetPath, testPath.slice(0, targetPath.length));\n  }\n  return false;\n}\n\nexport function tryRenamePath(targetPath, testPath, nextTargetPath) {\n  if (isEqualOrPrefix(targetPath, testPath)) {\n    return [...nextTargetPath, ...testPath.slice(nextTargetPath.length)];\n  }\n  return testPath;\n}\n\nexport const PATH_SEP = '___';\n\nexport function pathToKey(path) {\n  return path.join(PATH_SEP);\n}\n", "/* eslint-disable no-nested-ternary */\n/* eslint-disable no-param-reassign */\nimport { treeToCellColorsBySetNames } from './sets/cell-set-utils';\n\n// The functions defined here have been adapted from d3-interpolate,\n// d3-color, and d3-scale-chromatic.\n// Color string \"rgb(r,g,b)\" representations are replaced by color array [r, g, b]\n// representations, to allow them to work nicely with deck.gl,\n// without the need to converting back and forth between string and array formats.\n\n// Reference: https://github.com/d3/d3-scale-chromatic/blob/431d21da776f97c632f53a855bd822edfbbcd56e/src/diverging/RdBu.js\n// eslint-disable-next-line max-len\nconst schemeRdBu = [[103, 0, 31], [178, 24, 43], [214, 96, 77], [244, 165, 130], [253, 219, 199], [247, 247, 247], [209, 229, 240], [146, 197, 222], [67, 147, 195], [33, 102, 172], [5, 48, 97]];\n// eslint-disable-next-line max-len\nconst schemePlasma = [[13, 8, 135], [16, 7, 136], [19, 7, 137], [22, 7, 138], [25, 6, 140], [27, 6, 141], [29, 6, 142], [32, 6, 143], [34, 6, 144], [36, 6, 145], [38, 5, 145], [40, 5, 146], [42, 5, 147], [44, 5, 148], [46, 5, 149], [47, 5, 150], [49, 5, 151], [51, 5, 151], [53, 4, 152], [55, 4, 153], [56, 4, 154], [58, 4, 154], [60, 4, 155], [62, 4, 156], [63, 4, 156], [65, 4, 157], [67, 3, 158], [68, 3, 158], [70, 3, 159], [72, 3, 159], [73, 3, 160], [75, 3, 161], [76, 2, 161], [78, 2, 162], [80, 2, 162], [81, 2, 163], [83, 2, 163], [85, 2, 164], [86, 1, 164], [88, 1, 164], [89, 1, 165], [91, 1, 165], [92, 1, 166], [94, 1, 166], [96, 1, 166], [97, 0, 167], [99, 0, 167], [100, 0, 167], [102, 0, 167], [103, 0, 168], [105, 0, 168], [106, 0, 168], [108, 0, 168], [110, 0, 168], [111, 0, 168], [113, 0, 168], [114, 1, 168], [116, 1, 168], [117, 1, 168], [119, 1, 168], [120, 1, 168], [122, 2, 168], [123, 2, 168], [125, 3, 168], [126, 3, 168], [128, 4, 168], [129, 4, 167], [131, 5, 167], [132, 5, 167], [134, 6, 166], [135, 7, 166], [136, 8, 166], [138, 9, 165], [139, 10, 165], [141, 11, 165], [142, 12, 164], [143, 13, 164], [145, 14, 163], [146, 15, 163], [148, 16, 162], [149, 17, 161], [150, 19, 161], [152, 20, 160], [153, 21, 159], [154, 22, 159], [156, 23, 158], [157, 24, 157], [158, 25, 157], [160, 26, 156], [161, 27, 155], [162, 29, 154], [163, 30, 154], [165, 31, 153], [166, 32, 152], [167, 33, 151], [168, 34, 150], [170, 35, 149], [171, 36, 148], [172, 38, 148], [173, 39, 147], [174, 40, 146], [176, 41, 145], [177, 42, 144], [178, 43, 143], [179, 44, 142], [180, 46, 141], [181, 47, 140], [182, 48, 139], [183, 49, 138], [184, 50, 137], [186, 51, 136], [187, 52, 136], [188, 53, 135], [189, 55, 134], [190, 56, 133], [191, 57, 132], [192, 58, 131], [193, 59, 130], [194, 60, 129], [195, 61, 128], [196, 62, 127], [197, 64, 126], [198, 65, 125], [199, 66, 124], [200, 67, 123], [201, 68, 122], [202, 69, 122], [203, 70, 121], [204, 71, 120], [204, 73, 119], [205, 74, 118], [206, 75, 117], [207, 76, 116], [208, 77, 115], [209, 78, 114], [210, 79, 113], [211, 81, 113], [212, 82, 112], [213, 83, 111], [213, 84, 110], [214, 85, 109], [215, 86, 108], [216, 87, 107], [217, 88, 106], [218, 90, 106], [218, 91, 105], [219, 92, 104], [220, 93, 103], [221, 94, 102], [222, 95, 101], [222, 97, 100], [223, 98, 99], [224, 99, 99], [225, 100, 98], [226, 101, 97], [226, 102, 96], [227, 104, 95], [228, 105, 94], [229, 106, 93], [229, 107, 93], [230, 108, 92], [231, 110, 91], [231, 111, 90], [232, 112, 89], [233, 113, 88], [233, 114, 87], [234, 116, 87], [235, 117, 86], [235, 118, 85], [236, 119, 84], [237, 121, 83], [237, 122, 82], [238, 123, 81], [239, 124, 81], [239, 126, 80], [240, 127, 79], [240, 128, 78], [241, 129, 77], [241, 131, 76], [242, 132, 75], [243, 133, 75], [243, 135, 74], [244, 136, 73], [244, 137, 72], [245, 139, 71], [245, 140, 70], [246, 141, 69], [246, 143, 68], [247, 144, 68], [247, 145, 67], [247, 147, 66], [248, 148, 65], [248, 149, 64], [249, 151, 63], [249, 152, 62], [249, 154, 62], [250, 155, 61], [250, 156, 60], [250, 158, 59], [251, 159, 58], [251, 161, 57], [251, 162, 56], [252, 163, 56], [252, 165, 55], [252, 166, 54], [252, 168, 53], [252, 169, 52], [253, 171, 51], [253, 172, 51], [253, 174, 50], [253, 175, 49], [253, 177, 48], [253, 178, 47], [253, 180, 47], [253, 181, 46], [254, 183, 45], [254, 184, 44], [254, 186, 44], [254, 187, 43], [254, 189, 42], [254, 190, 42], [254, 192, 41], [253, 194, 41], [253, 195, 40], [253, 197, 39], [253, 198, 39], [253, 200, 39], [253, 202, 38], [253, 203, 38], [252, 205, 37], [252, 206, 37], [252, 208, 37], [252, 210, 37], [251, 211, 36], [251, 213, 36], [251, 215, 36], [250, 216, 36], [250, 218, 36], [249, 220, 36], [249, 221, 37], [248, 223, 37], [248, 225, 37], [247, 226, 37], [247, 228, 37], [246, 230, 38], [246, 232, 38], [245, 233, 38], [245, 235, 39], [244, 237, 39], [243, 238, 39], [243, 240, 39], [242, 242, 39], [241, 244, 38], [241, 245, 37], [240, 247, 36], [240, 249, 33]];\n\n// Reference: https://github.com/d3/d3-interpolate/blob/96d54051d1c2fec55f240edd0ec5401715b10390/src/rgb.js\nfunction rgbSpline(spline) {\n  return (colors) => {\n    const n = colors.length;\n    let r = new Array(n);\n    let g = new Array(n);\n    let b = new Array(n);\n    let i; let\n      color;\n    // eslint-disable-next-line no-plusplus\n    for (i = 0; i < n; ++i) {\n      color = [colors[i][0], colors[i][1], colors[i][2]];\n      r[i] = color[0] || 0;\n      g[i] = color[1] || 0;\n      b[i] = color[2] || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    return t => [r(t), g(t), b(t)];\n  };\n}\n\n// Reference: https://github.com/d3/d3-interpolate/blob/594a32af1fe1118812b439012c2cb742e907c0c0/src/basis.js\nfunction basis(values) {\n  function innerBasis(t1, v0, v1, v2, v3) {\n    const t2 = t1 * t1; const\n      t3 = t2 * t1;\n    return ((1 - 3 * t1 + 3 * t2 - t3) * v0\n          + (4 - 6 * t2 + 3 * t3) * v1\n          + (1 + 3 * t1 + 3 * t2 - 3 * t3) * v2\n          + t3 * v3) / 6;\n  }\n\n  const n = values.length - 1;\n  return (t) => {\n    const i = t <= 0 ? (t = 0) : t >= 1 ? (t = 1, n - 1) : Math.floor(t * n);\n    const v1 = values[i];\n    const v2 = values[i + 1];\n    const v0 = i > 0 ? values[i - 1] : 2 * v1 - v2;\n    const v3 = i < n - 1 ? values[i + 2] : 2 * v2 - v1;\n    return innerBasis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n\n\n// Reference: https://github.com/d3/d3-scale-chromatic/blob/ade54c13e8dfdb9807801a794eaec1a37f926b8a/src/ramp.js\nconst interpolateRgbBasis = rgbSpline(basis);\n\nfunction interpolateSequentialMulti(range) {\n  const n = range.length;\n  return t => range[Math.max(0, Math.min(n - 1, Math.floor(t * n)))];\n}\n\nexport const interpolateRdBu = interpolateRgbBasis(schemeRdBu);\nexport const interpolatePlasma = interpolateSequentialMulti(schemePlasma);\n\n\n/**\n * Get a mapping of cell IDs to cell colors based on\n * gene / cell set selection coordination state.\n * @param {object} params\n * @param {object} params.expressionMatrix { rows, cols, matrix }\n * @param {array} params.geneSelection Array of selected gene IDs.\n * @param {object} params.cellSets The cell sets tree.\n * @param {object} params.cellSetSelection Selected cell sets.\n * @param {string} params.cellColorEncoding Which to use for\n * coloring: gene expression or cell sets?\n * @returns {Map} Mapping from cell IDs to [r, g, b] color arrays.\n */\nexport function getCellColors(params) {\n  const {\n    cellColorEncoding,\n    expressionData,\n    cellSets, cellSetSelection,\n    cellSetColor,\n    expressionDataAttrs,\n    theme,\n  } = params;\n  if (cellColorEncoding === 'geneSelection' && expressionData && expressionDataAttrs) {\n    // TODO: allow other color maps.\n    const geneExpColormap = interpolatePlasma;\n    const colors = new Map();\n    for (let i = 0; i < expressionData.length; i += 1) {\n      const value = expressionData[i];\n      const cellColor = geneExpColormap(value / 255);\n      colors.set(expressionDataAttrs.rows[i], cellColor);\n    }\n    return colors;\n  } if (cellColorEncoding === 'cellSetSelection' && cellSetSelection && cellSets) {\n    // Cell sets can potentially lack set colors since the color property\n    // is not a required part of the schema.\n    // The `initializeSets` function fills in any empty colors\n    // with defaults and returns the processed tree object.\n    return treeToCellColorsBySetNames(cellSets, cellSetSelection, cellSetColor, theme);\n  }\n  return new Map();\n}\n", "import React, {\n  useRef, useState, useCallback, useMemo, useEffect, useReducer, forwardRef,\n} from 'react';\nimport uuidv4 from 'uuid/v4';\nimport DeckGL from 'deck.gl';\nimport { OrthographicView } from '@deck.gl/core'; // eslint-disable-line import/no-extraneous-dependencies\nimport range from 'lodash/range';\nimport clamp from 'lodash/clamp';\nimport isEqual from 'lodash/isEqual';\nimport { max } from 'd3-array';\nimport HeatmapCompositeTextLayer from '../../layers/HeatmapCompositeTextLayer';\nimport PixelatedBitmapLayer from '../../layers/PixelatedBitmapLayer';\nimport HeatmapBitmapLayer from '../../layers/HeatmapBitmapLayer';\nimport {\n  DEFAULT_GL_OPTIONS,\n  createDefaultUpdateCellsHover,\n  createDefaultUpdateGenesHover,\n  createDefaultUpdateViewInfo,\n  copyUint8Array,\n} from '../utils';\nimport {\n  layerFilter,\n  getAxisSizes,\n  mouseToHeatmapPosition,\n  heatmapToMousePosition,\n} from './utils';\nimport {\n  TILE_SIZE, MAX_ROW_AGG, MIN_ROW_AGG,\n  COLOR_BAR_SIZE,\n  AXIS_MARGIN,\n} from '../../layers/heatmap-constants';\nimport HeatmapWorkerPool from './HeatmapWorkerPool';\n/**\n * A heatmap component for cell x gene matrices.\n * @param {object} props\n * @param {string} props.uuid The uuid of this component,\n * used by tooltips to determine whether to render a tooltip or\n * a crosshair.\n * @param {string} props.theme The current theme name.\n * @param {object} props.initialViewState The initial viewState for\n * DeckGL.\n * @param {number} props.width The width of the canvas.\n * @param {number} props.height The height of the canvas.\n * @param {object} props.expressionMatrix An object { rows, cols, matrix },\n * where matrix is a flat Uint8Array, rows is a list of cell ID strings,\n * and cols is a list of gene ID strings.\n * @param {Map} props.cellColors Map of cell ID to color. Optional.\n * If defined, the key ordering is used to order the cell axis of the heatmap.\n * @param {function} props.clearPleaseWait The clear please wait callback,\n * called when the expression matrix has loaded (is not null).\n * @param {function} props.setCellHighlight Callback function called on\n * hover with the cell ID. Optional.\n * @param {function} props.setGeneHighlight Callback function called on\n * hover with the gene ID. Optional.\n * @param {function} props.updateViewInfo Callback function that gets called with an\n * object { uuid, project() } where project is a function that maps (cellId, geneId)\n * to canvas (x,y) coordinates. Used to show tooltips. Optional.\n * @param {boolean} props.transpose By default, false.\n * @param {string} props.variablesTitle By default, 'Genes'.\n * @param {string} props.observationsTitle By default, 'Cells'.\n * @param {string} props.colormap The name of the colormap function to use.\n * @param {array} props.colormapRange A tuple [lower, upper] to adjust the color scale.\n * @param {function} props.setColormapRange The setter function for colormapRange.\n */\nconst Heatmap = forwardRef((props, deckRef) => {\n  const {\n    uuid,\n    theme,\n    viewState: rawViewState,\n    setViewState,\n    width: viewWidth,\n    height: viewHeight,\n    expressionMatrix: expression,\n    cellColors,\n    colormap,\n    colormapRange,\n    clearPleaseWait,\n    setComponentHover,\n    setCellHighlight = createDefaultUpdateCellsHover('Heatmap'),\n    setGeneHighlight = createDefaultUpdateGenesHover('Heatmap'),\n    updateViewInfo = createDefaultUpdateViewInfo('Heatmap'),\n    setIsRendering = () => {},\n    transpose = false,\n    variablesTitle = 'Genes',\n    observationsTitle = 'Cells',\n  } = props;\n\n  const viewState = {\n    ...rawViewState,\n    target: (transpose ? [rawViewState.target[1], rawViewState.target[0]] : rawViewState.target),\n    minZoom: 0,\n  };\n\n  const axisLeftTitle = (transpose ? variablesTitle : observationsTitle);\n  const axisTopTitle = (transpose ? observationsTitle : variablesTitle);\n\n  const workerPool = useMemo(() => new HeatmapWorkerPool(), []);\n\n  useEffect(() => {\n    if (clearPleaseWait && expression) {\n      clearPleaseWait('expression-matrix');\n    }\n  }, [clearPleaseWait, expression]);\n\n  const tilesRef = useRef();\n  const dataRef = useRef();\n  const [axisLeftLabels, setAxisLeftLabels] = useState([]);\n  const [axisTopLabels, setAxisTopLabels] = useState([]);\n\n\n  // Since we are storing the tile data in a ref,\n  // and updating it asynchronously when the worker finishes,\n  // we need to tie it to a piece of state through this iteration value.\n  const [tileIteration, incTileIteration] = useReducer(i => i + 1, 0);\n\n  // We need to keep a backlog of the tasks for the worker thread,\n  // since the array buffer can only be held by one thread at a time.\n  const [backlog, setBacklog] = useState([]);\n\n  // Store a reference to the matrix Uint8Array in the dataRef,\n  // since we need to access its array buffer to transfer\n  // it back and forth from the worker thread.\n  useEffect(() => {\n    // Store the expression matrix Uint8Array in the dataRef.\n    if (expression && expression.matrix) {\n      dataRef.current = copyUint8Array(expression.matrix);\n    }\n  }, [dataRef, expression]);\n\n  // Check if the ordering of axis labels needs to be changed,\n  // for example if the cells \"selected\" (technically just colored)\n  // have changed.\n  useEffect(() => {\n    if (!expression) {\n      return;\n    }\n    const newCellOrdering = (!cellColors || cellColors.size === 0\n      ? expression.rows\n      : Array.from(cellColors.keys())\n    );\n    const oldCellOrdering = (transpose ? axisTopLabels : axisLeftLabels);\n\n    if (!isEqual(oldCellOrdering, newCellOrdering)) {\n      if (transpose) {\n        setAxisTopLabels(newCellOrdering);\n      } else {\n        setAxisLeftLabels(newCellOrdering);\n      }\n    }\n  }, [expression, cellColors, axisTopLabels, axisLeftLabels, transpose]);\n\n  // Set the genes ordering.\n  useEffect(() => {\n    if (!expression) {\n      return;\n    }\n    if (transpose) {\n      setAxisLeftLabels(expression.cols);\n    } else {\n      setAxisTopLabels(expression.cols);\n    }\n  }, [expression, transpose]);\n\n  const [cellLabelMaxLength, geneLabelMaxLength] = useMemo(() => {\n    if (!expression) {\n      return [0, 0];\n    }\n    return [\n      max(expression.rows.map(cellId => cellId.length)),\n      max(expression.cols.map(geneId => geneId.length)),\n    ];\n  }, [expression]);\n\n  const width = axisTopLabels.length;\n  const height = axisLeftLabels.length;\n\n  const [axisOffsetLeft, axisOffsetTop] = getAxisSizes(\n    transpose, geneLabelMaxLength, cellLabelMaxLength,\n  );\n\n  const offsetTop = axisOffsetTop + COLOR_BAR_SIZE;\n  const offsetLeft = axisOffsetLeft + COLOR_BAR_SIZE;\n\n  const matrixWidth = viewWidth - offsetLeft;\n  const matrixHeight = viewHeight - offsetTop;\n\n  const matrixLeft = -matrixWidth / 2;\n  const matrixRight = matrixWidth / 2;\n  const matrixTop = -matrixHeight / 2;\n  const matrixBottom = matrixHeight / 2;\n\n  const xTiles = Math.ceil(width / TILE_SIZE);\n  const yTiles = Math.ceil(height / TILE_SIZE);\n\n  const widthRatio = 1 - (TILE_SIZE - (width % TILE_SIZE)) / (xTiles * TILE_SIZE);\n  const heightRatio = 1 - (TILE_SIZE - (height % TILE_SIZE)) / (yTiles * TILE_SIZE);\n\n  const tileWidth = (matrixWidth / widthRatio) / (xTiles);\n  const tileHeight = (matrixHeight / heightRatio) / (yTiles);\n\n  const scaleFactor = 2 ** viewState.zoom;\n  const cellHeight = (matrixHeight * scaleFactor) / height;\n  const cellWidth = (matrixWidth * scaleFactor) / width;\n\n  // Get power of 2 between 1 and 16,\n  // for number of cells to aggregate together in each direction.\n  const aggSizeX = clamp(2 ** Math.ceil(Math.log2(1 / cellWidth)), MIN_ROW_AGG, MAX_ROW_AGG);\n  const aggSizeY = clamp(2 ** Math.ceil(Math.log2(1 / cellHeight)), MIN_ROW_AGG, MAX_ROW_AGG);\n\n  const [targetX, targetY] = viewState.target;\n\n  // Emit the viewInfo object on viewState updates\n  // (used by tooltips / crosshair elements).\n  useEffect(() => {\n    updateViewInfo({\n      uuid,\n      project: (cellId, geneId) => {\n        const colI = transpose ? axisTopLabels.indexOf(cellId) : axisTopLabels.indexOf(geneId);\n        const rowI = transpose ? axisLeftLabels.indexOf(geneId) : axisLeftLabels.indexOf(cellId);\n        return heatmapToMousePosition(\n          colI, rowI, {\n            offsetLeft,\n            offsetTop,\n            targetX: viewState.target[0],\n            targetY: viewState.target[1],\n            scaleFactor,\n            matrixWidth,\n            matrixHeight,\n            numRows: height,\n            numCols: width,\n          },\n        );\n      },\n    });\n  }, [uuid, updateViewInfo, transpose, axisTopLabels, axisLeftLabels, offsetLeft,\n    offsetTop, viewState, scaleFactor, matrixWidth, matrixHeight, height, width]);\n\n\n  // Listen for viewState changes.\n  // Do not allow the user to zoom and pan outside of the initial window.\n  const onViewStateChange = useCallback(({ viewState: nextViewState }) => {\n    const { zoom: nextZoom } = nextViewState;\n    const nextScaleFactor = 2 ** nextZoom;\n\n    const minTargetX = nextZoom === 0 ? 0 : -(matrixRight - (matrixRight / nextScaleFactor));\n    const maxTargetX = -1 * minTargetX;\n\n    const minTargetY = nextZoom === 0 ? 0 : -(matrixBottom - (matrixBottom / nextScaleFactor));\n    const maxTargetY = -1 * minTargetY;\n\n    // Manipulate view state if necessary to keep the user in the window.\n    const nextTarget = [\n      clamp(nextViewState.target[0], minTargetX, maxTargetX),\n      clamp(nextViewState.target[1], minTargetY, maxTargetY),\n    ];\n\n    setViewState({\n      zoom: nextZoom,\n      target: (transpose ? [nextTarget[1], nextTarget[0]] : nextTarget),\n    });\n  }, [matrixRight, matrixBottom, transpose, setViewState]);\n\n  // If `expression` or `cellOrdering` have changed,\n  // then new tiles need to be generated,\n  // so add a new task to the backlog.\n  useEffect(() => {\n    if (!expression) {\n      return;\n    }\n    // Use a uuid to give the task a unique ID,\n    // to help identify where in the list it is located\n    // after the worker thread asynchronously sends the data back\n    // to this thread.\n    if (\n      axisTopLabels && axisLeftLabels && xTiles && yTiles\n    ) {\n      setBacklog(prev => [...prev, uuidv4()]);\n    }\n  }, [dataRef, expression, axisTopLabels, axisLeftLabels, xTiles, yTiles]);\n\n  // When the backlog has updated, a new worker job can be submitted if:\n  // - the backlog has length >= 1 (at least one job is waiting), and\n  // - buffer.byteLength is not zero, so the worker does not currently \"own\" the buffer.\n  useEffect(() => {\n    if (backlog.length < 1) {\n      return;\n    }\n    const curr = backlog[backlog.length - 1];\n    if (dataRef.current && dataRef.current.buffer.byteLength) {\n      const { rows, cols, matrix } = expression;\n      const promises = range(yTiles).map(i => range(xTiles).map(async j => workerPool.process({\n        curr,\n        tileI: i,\n        tileJ: j,\n        tileSize: TILE_SIZE,\n        cellOrdering: transpose ? axisTopLabels : axisLeftLabels,\n        rows,\n        cols,\n        transpose,\n        data: matrix.buffer.slice(),\n      })));\n      const process = async () => {\n        const tiles = await Promise.all(promises.flat());\n        tilesRef.current = tiles.map(i => i.tile);\n        incTileIteration();\n        dataRef.current = new Uint8Array(tiles[0].buffer);\n        const { curr: currWork } = tiles[0];\n        setBacklog((prev) => {\n          const currIndex = prev.indexOf(currWork);\n          return prev.slice(currIndex + 1, prev.length);\n        });\n      };\n      process();\n    }\n  }, [axisLeftLabels, axisTopLabels, backlog, expression, transpose, xTiles, yTiles, workerPool]);\n\n  useEffect(() => {\n    setIsRendering(backlog.length > 0);\n  }, [backlog, setIsRendering]);\n\n  // Update the heatmap tiles if:\n  // - new tiles are available (`tileIteration` has changed), or\n  // - the matrix bounds have changed, or\n  // - the `aggSizeX` or `aggSizeY` have changed, or\n  // - the cell ordering has changed.\n  const heatmapLayers = useMemo(() => {\n    if (!tilesRef.current || backlog.length) {\n      return [];\n    }\n    function getLayer(i, j, tile) {\n      return new HeatmapBitmapLayer({\n        id: `heatmapLayer-${tileIteration}-${i}-${j}`,\n        image: tile,\n        bounds: [\n          matrixLeft + j * tileWidth,\n          matrixTop + i * tileHeight,\n          matrixLeft + (j + 1) * tileWidth,\n          matrixTop + (i + 1) * tileHeight,\n        ],\n        aggSizeX,\n        aggSizeY,\n        colormap,\n        colorScaleLo: colormapRange[0],\n        colorScaleHi: colormapRange[1],\n        updateTriggers: {\n          image: [axisLeftLabels, axisTopLabels],\n          bounds: [tileHeight, tileWidth],\n        },\n      });\n    }\n    const layers = tilesRef\n      .current.map((tile, index) => getLayer(Math.floor(index / xTiles), index % xTiles, tile));\n    return layers;\n  }, [backlog, tileIteration, matrixLeft, tileWidth, matrixTop, tileHeight,\n    aggSizeX, aggSizeY, colormap, colormapRange,\n    axisLeftLabels, axisTopLabels, xTiles]);\n\n\n  // Map cell and gene names to arrays with indices,\n  // to prepare to render the names in TextLayers.\n  const axisTopLabelData = useMemo(() => axisTopLabels.map((d, i) => [i, d]), [axisTopLabels]);\n  const axisLeftLabelData = useMemo(() => axisLeftLabels.map((d, i) => [i, d]), [axisLeftLabels]);\n\n  // Generate the axis label, axis title, and loading indicator text layers.\n  const textLayers = [\n    new HeatmapCompositeTextLayer({\n      targetX,\n      targetY,\n      scaleFactor,\n      axisLeftLabelData,\n      matrixTop,\n      height,\n      matrixHeight,\n      cellHeight,\n      cellWidth,\n      axisTopLabelData,\n      matrixLeft,\n      width,\n      matrixWidth,\n      viewHeight,\n      viewWidth,\n      theme,\n      axisLeftTitle,\n      axisTopTitle,\n      axisOffsetLeft,\n      axisOffsetTop,\n    }),\n  ];\n\n  // Create the left color bar with a BitmapLayer.\n  // TODO: find a way to do aggregation for this as well.\n  const cellColorsTiles = useMemo(() => {\n    if (!cellColors) {\n      return null;\n    }\n\n    let cellId;\n    let offset;\n    let color;\n    let rowI;\n\n    const cellOrdering = (transpose ? axisTopLabels : axisLeftLabels);\n    const colorBarTileWidthPx = (transpose ? TILE_SIZE : 1);\n    const colorBarTileHeightPx = (transpose ? 1 : TILE_SIZE);\n\n    const result = range((transpose ? xTiles : yTiles)).map((i) => {\n      const tileData = new Uint8ClampedArray(TILE_SIZE * 1 * 4);\n\n      range(TILE_SIZE).forEach((tileY) => {\n        rowI = (i * TILE_SIZE) + tileY; // the row / cell index\n        if (rowI < cellOrdering.length) {\n          cellId = cellOrdering[rowI];\n          color = cellColors.get(cellId);\n          offset = (transpose ? tileY : (TILE_SIZE - tileY - 1)) * 4;\n          if (color) {\n            const [rValue, gValue, bValue] = color;\n            tileData[offset + 0] = rValue;\n            tileData[offset + 1] = gValue;\n            tileData[offset + 2] = bValue;\n            tileData[offset + 3] = 255;\n          }\n        }\n      });\n\n      return new ImageData(tileData, colorBarTileWidthPx, colorBarTileHeightPx);\n    });\n\n    return result;\n  }, [cellColors, transpose, axisTopLabels, axisLeftLabels, xTiles, yTiles]);\n\n  const cellColorsLayers = useMemo(() => (cellColorsTiles\n    ? cellColorsTiles\n      .map((tile, i) => new PixelatedBitmapLayer({\n        id: `${(transpose ? 'colorsTopLayer' : 'colorsLeftLayer')}-${i}-${uuidv4()}`,\n        image: tile,\n        bounds: (transpose ? [\n          matrixLeft + i * tileWidth,\n          -matrixHeight / 2,\n          matrixLeft + (i + 1) * tileWidth,\n          matrixHeight / 2,\n        ] : [\n          -matrixWidth / 2,\n          matrixTop + i * tileHeight,\n          matrixWidth / 2,\n          matrixTop + (i + 1) * tileHeight,\n        ]),\n      }))\n    : []), [cellColorsTiles, matrixTop, matrixLeft, matrixHeight,\n    matrixWidth, tileWidth, tileHeight, transpose]);\n\n  const layers = heatmapLayers\n    .concat(textLayers)\n    .concat(cellColorsLayers);\n\n  // Set up the onHover function.\n  function onHover(info, event) {\n    if (!expression) {\n      return;\n    }\n    const { x: mouseX, y: mouseY } = event.offsetCenter;\n    const [colI, rowI] = mouseToHeatmapPosition(mouseX, mouseY, {\n      offsetLeft,\n      offsetTop,\n      targetX,\n      targetY,\n      scaleFactor,\n      matrixWidth,\n      matrixHeight,\n      numRows: height,\n      numCols: width,\n    });\n\n    if (colI === null) {\n      if (transpose) {\n        setCellHighlight(null);\n      } else {\n        setGeneHighlight(null);\n      }\n    }\n\n    if (rowI === null) {\n      if (transpose) {\n        setGeneHighlight(null);\n      } else {\n        setCellHighlight(null);\n      }\n    }\n\n    const obsI = expression.rows.indexOf(transpose\n      ? axisTopLabels[colI]\n      : axisLeftLabels[rowI]);\n    const varI = expression.cols.indexOf(transpose\n      ? axisLeftLabels[rowI]\n      : axisTopLabels[colI]);\n\n    const obsId = expression.rows[obsI];\n    const varId = expression.cols[varI];\n    if (setComponentHover) {\n      setComponentHover();\n    }\n    setCellHighlight(obsId || null);\n    setGeneHighlight(varId || null);\n  }\n\n  return (\n    <DeckGL\n      id={`deckgl-overlay-${uuid}`}\n      ref={deckRef}\n      views={[\n        // Note that there are multiple views here,\n        // but only one viewState.\n        new OrthographicView({\n          id: 'heatmap',\n          controller: true,\n          x: offsetLeft,\n          y: offsetTop,\n          width: matrixWidth,\n          height: matrixHeight,\n        }),\n        new OrthographicView({\n          id: 'axisLeft',\n          controller: false,\n          x: (transpose ? COLOR_BAR_SIZE : 0),\n          y: offsetTop,\n          width: axisOffsetLeft,\n          height: matrixHeight,\n        }),\n        new OrthographicView({\n          id: 'axisTop',\n          controller: false,\n          x: offsetLeft,\n          y: (transpose ? 0 : COLOR_BAR_SIZE),\n          width: matrixWidth,\n          height: axisOffsetTop,\n        }),\n        new OrthographicView({\n          id: 'colorsLeft',\n          controller: false,\n          x: axisOffsetLeft,\n          y: offsetTop,\n          width: COLOR_BAR_SIZE - AXIS_MARGIN,\n          height: matrixHeight,\n        }),\n        new OrthographicView({\n          id: 'colorsTop',\n          controller: false,\n          x: offsetLeft,\n          y: axisOffsetTop,\n          width: matrixWidth,\n          height: COLOR_BAR_SIZE - AXIS_MARGIN,\n        }),\n      ]}\n      layers={layers}\n      layerFilter={layerFilter}\n      getCursor={interactionState => (interactionState.isDragging ? 'grabbing' : 'default')}\n      glOptions={DEFAULT_GL_OPTIONS}\n      onViewStateChange={onViewStateChange}\n      viewState={viewState}\n      onHover={onHover}\n    />\n  );\n});\n\nexport default Heatmap;\n", "/* eslint-disable no-underscore-dangle */\nimport { COORDINATE_SYSTEM, CompositeLayer } from '@deck.gl/core'; // eslint-disable-line import/no-extraneous-dependencies\nimport { TextLayer } from '@deck.gl/layers'; // eslint-disable-line import/no-extraneous-dependencies\nimport {\n  AXIS_LABEL_TEXT_SIZE,\n  AXIS_TITLE_TEXT_SIZE,\n  AXIS_MARGIN,\n  THEME_TO_TEXT_COLOR,\n  AXIS_FONT_FAMILY,\n} from './heatmap-constants';\n\nexport default class HeatmapCompositeTextLayer extends CompositeLayer {\n  _renderAxisTopLayers() {\n    const {\n      axisTopLabelData, matrixLeft, width, matrixWidth, viewWidth, theme,\n      targetX, targetY, axisTopTitle, cellWidth, axisOffsetTop, scaleFactor,\n    } = this.props;\n    const showAxisTopLabels = cellWidth >= AXIS_LABEL_TEXT_SIZE;\n    const axisLabelTop = targetY + (axisOffsetTop - AXIS_MARGIN) / 2 / scaleFactor;\n    return [\n      new TextLayer({\n        id: 'axisTopLabels',\n        coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n        data: axisTopLabelData,\n        getText: d => d[1],\n        getPosition: d => [matrixLeft + ((d[0] + 0.5) / width) * matrixWidth, axisLabelTop],\n        getTextAnchor: 'start',\n        getColor: () => THEME_TO_TEXT_COLOR[theme],\n        getSize: (showAxisTopLabels ? AXIS_LABEL_TEXT_SIZE : 0),\n        getAngle: 75,\n        fontFamily: AXIS_FONT_FAMILY,\n        updateTriggers: {\n          getPosition: [axisLabelTop, matrixLeft, matrixWidth, viewWidth],\n          getSize: [showAxisTopLabels],\n          getColor: [theme],\n        },\n      }),\n      new TextLayer({\n        id: 'axisTopTitle',\n        coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n        data: [{ title: axisTopTitle }],\n        getText: d => d.title,\n        getPosition: [targetX, targetY],\n        getTextAnchor: 'middle',\n        getColor: () => THEME_TO_TEXT_COLOR[theme],\n        getSize: (!showAxisTopLabels ? AXIS_TITLE_TEXT_SIZE : 0),\n        getAngle: 0,\n        fontFamily: AXIS_FONT_FAMILY,\n        updateTriggers: {\n          getSize: [showAxisTopLabels],\n          getColor: [theme],\n        },\n      }),\n    ];\n  }\n\n  _renderAxisLeftLayers() {\n    const {\n      axisLeftLabelData, matrixTop, height, matrixHeight,\n      viewHeight, theme, axisLeftTitle, targetX, targetY, cellHeight, axisOffsetLeft,\n      scaleFactor,\n    } = this.props;\n    const showAxisLeftLabels = cellHeight >= AXIS_LABEL_TEXT_SIZE;\n    const axisLabelLeft = targetX + (axisOffsetLeft - AXIS_MARGIN) / 2 / scaleFactor;\n    return [\n      new TextLayer({\n        id: 'axisLeftLabels',\n        coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n        data: axisLeftLabelData,\n        getText: d => d[1],\n        getPosition: d => [axisLabelLeft, matrixTop + ((d[0] + 0.5) / height) * matrixHeight],\n        getTextAnchor: 'end',\n        getColor: () => THEME_TO_TEXT_COLOR[theme],\n        getSize: (showAxisLeftLabels ? AXIS_LABEL_TEXT_SIZE : 0),\n        getAngle: 0,\n        fontFamily: AXIS_FONT_FAMILY,\n        updateTriggers: {\n          getPosition: [axisLabelLeft, matrixTop, matrixHeight, viewHeight],\n          getSize: [showAxisLeftLabels],\n          getColor: [theme],\n        },\n      }),\n      new TextLayer({\n        id: 'axisLeftTitle',\n        coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n        data: [{ title: axisLeftTitle }],\n        getText: d => d.title,\n        getPosition: [targetX, targetY],\n        getTextAnchor: 'middle',\n        getColor: () => THEME_TO_TEXT_COLOR[theme],\n        getSize: (!showAxisLeftLabels ? AXIS_TITLE_TEXT_SIZE : 0),\n        getAngle: 90,\n        fontFamily: AXIS_FONT_FAMILY,\n        updateTriggers: {\n          getSize: [showAxisLeftLabels],\n          getColor: [theme],\n        },\n      }),\n    ];\n  }\n\n  renderLayers() {\n    return [\n      this._renderAxisTopLayers(),\n      this._renderAxisLeftLayers(),\n    ];\n  }\n}\n\nHeatmapCompositeTextLayer.layerName = 'HeatmapCompositeTextLayer';\n", "import GL from '@luma.gl/constants'; // eslint-disable-line import/no-extraneous-dependencies\n\nexport const TILE_SIZE = 2048;\nexport const MIN_ROW_AGG = 1;\nexport const MAX_ROW_AGG = 16;\n\nexport const COLOR_BAR_SIZE = 20;\nexport const AXIS_LABEL_TEXT_SIZE = 9;\nexport const AXIS_TITLE_TEXT_SIZE = 15;\nexport const AXIS_MIN_SIZE = 10;\nexport const AXIS_MAX_SIZE = 90;\nexport const AXIS_MARGIN = 3;\nexport const THEME_TO_TEXT_COLOR = {\n  dark: [224, 224, 224],\n  light: [64, 64, 64],\n};\nexport const AXIS_FONT_FAMILY = \"-apple-system, 'Helvetica Neue', Arial, sans-serif\";\n\nexport const PIXELATED_TEXTURE_PARAMETERS = {\n  // NEAREST for integer data to prevent interpolation.\n  [GL.TEXTURE_MIN_FILTER]: GL.NEAREST,\n  [GL.TEXTURE_MAG_FILTER]: GL.NEAREST,\n  // CLAMP_TO_EDGE to remove tile artifacts.\n  [GL.TEXTURE_WRAP_S]: GL.CLAMP_TO_EDGE,\n  [GL.TEXTURE_WRAP_T]: GL.CLAMP_TO_EDGE,\n};\n", "import { BitmapLayer } from '@deck.gl/layers'; // eslint-disable-line import/no-extraneous-dependencies\nimport { CompositeLayer } from '@deck.gl/core'; // eslint-disable-line import/no-extraneous-dependencies\nimport { PIXELATED_TEXTURE_PARAMETERS } from './heatmap-constants';\n\n\n// These are the same defaultProps as for BitmapLayer.\nconst defaultProps = {\n  ...BitmapLayer.defaultProps,\n  image: { type: 'object', value: null, async: true },\n  bounds: { type: 'array', value: [1, 0, 0, 1], compare: true },\n  desaturate: {\n    type: 'number', min: 0, max: 1, value: 0,\n  },\n  transparentColor: { type: 'color', value: [0, 0, 0, 0] },\n  tintColor: { type: 'color', value: [255, 255, 255] },\n};\n\nexport default class PixelatedBitmapLayer extends CompositeLayer {\n  renderLayers() {\n    const { image } = this.props;\n    return new BitmapLayer(this.props, {\n      id: `${this.props.id}-wrapped`,\n      image,\n      textureParameters: PIXELATED_TEXTURE_PARAMETERS,\n    });\n  }\n}\n\nPixelatedBitmapLayer.layerName = 'PixelatedBitmapLayer';\nPixelatedBitmapLayer.defaultProps = defaultProps;\n", "/* eslint-disable no-underscore-dangle */\nimport GL from '@luma.gl/constants'; // eslint-disable-line import/no-extraneous-dependencies\nimport { _mergeShaders, project32, picking } from '@deck.gl/core'; // eslint-disable-line import/no-extraneous-dependencies\nimport { BitmapLayer } from '@deck.gl/layers'; // eslint-disable-line import/no-extraneous-dependencies\nimport { Texture2D } from '@luma.gl/core';\nimport { PIXELATED_TEXTURE_PARAMETERS, TILE_SIZE } from './heatmap-constants';\nimport { GLSL_COLORMAPS, GLSL_COLORMAP_DEFAULT, COLORMAP_SHADER_PLACEHOLDER } from './constants';\nimport { vertexShader, fragmentShader } from './heatmap-bitmap-layer-shaders';\n\nconst defaultProps = {\n  image: { type: 'object', value: null, async: true },\n  colormap: { type: 'string', value: GLSL_COLORMAP_DEFAULT, compare: true },\n  bounds: { type: 'array', value: [1, 0, 0, 1], compare: true },\n  aggSizeX: { type: 'number', value: 8.0, compare: true },\n  aggSizeY: { type: 'number', value: 8.0, compare: true },\n  colorScaleLo: { type: 'number', value: 0.0, compare: true },\n  colorScaleHi: { type: 'number', value: 1.0, compare: true },\n};\n\n/**\n * A BitmapLayer that performs aggregation in the fragment shader,\n * and renders its texture from a Uint8Array rather than an ImageData.\n */\nexport default class HeatmapBitmapLayer extends BitmapLayer {\n  /**\n   * Copy of getShaders from Layer (grandparent, parent of BitmapLayer).\n   * Reference: https://github.com/visgl/deck.gl/blob/0afd4e99a6199aeec979989e0c361c97e6c17a16/modules/core/src/lib/layer.js#L302\n   * @param {object} shaders\n   * @returns {object} Merged shaders.\n   */\n  _getShaders(shaders) {\n    this.props.extensions.forEach((extension) => {\n      // eslint-disable-next-line no-param-reassign\n      shaders = _mergeShaders(shaders, extension.getShaders.call(this, extension));\n    });\n    return shaders;\n  }\n\n  /**\n   * Need to override to provide custom shaders.\n   */\n  getShaders() {\n    const { colormap } = this.props;\n    const fragmentShaderWithColormap = (GLSL_COLORMAPS.includes(colormap)\n      ? fragmentShader.replace(COLORMAP_SHADER_PLACEHOLDER, colormap)\n      : fragmentShader.replace(COLORMAP_SHADER_PLACEHOLDER, GLSL_COLORMAP_DEFAULT)\n    );\n    return this._getShaders({\n      vs: vertexShader,\n      fs: fragmentShaderWithColormap,\n      modules: [project32, picking],\n    });\n  }\n\n  updateState(args) {\n    super.updateState(args);\n    this.loadTexture(this.props.image);\n    const { props, oldProps } = args;\n    if (props.colormap !== oldProps.colormap) {\n      const { gl } = this.context;\n      // eslint-disable-next-line no-unused-expressions\n      this.state.model?.delete();\n      this.state.model = this._getModel(gl);\n      this.getAttributeManager().invalidateAll();\n    }\n  }\n\n  /**\n   * Need to override to provide additional uniform values.\n   * Simplified by removing video-related code.\n   * Reference: https://github.com/visgl/deck.gl/blob/0afd4e99a6199aeec979989e0c361c97e6c17a16/modules/layers/src/bitmap-layer/bitmap-layer.js#L173\n   * @param {*} opts\n   */\n  draw(opts) {\n    const { uniforms } = opts;\n    const { bitmapTexture, model } = this.state;\n    const {\n      aggSizeX,\n      aggSizeY,\n      colorScaleLo,\n      colorScaleHi,\n    } = this.props;\n\n    // Render the image\n    if (bitmapTexture && model) {\n      model\n        .setUniforms(\n          Object.assign({}, uniforms, {\n            uBitmapTexture: bitmapTexture,\n            uTextureSize: [TILE_SIZE, TILE_SIZE],\n            uAggSize: [aggSizeX, aggSizeY],\n            uColorScaleRange: [colorScaleLo, colorScaleHi],\n          }),\n        )\n        .draw();\n    }\n  }\n\n  /**\n   * Need to override to provide the custom DEFAULT_TEXTURE_PARAMETERS\n   * object.\n   * Simplified by removing video-related code.\n   * Reference: https://github.com/visgl/deck.gl/blob/0afd4e99a6199aeec979989e0c361c97e6c17a16/modules/layers/src/bitmap-layer/bitmap-layer.js#L218\n   * @param {Uint8Array} image\n   */\n  loadTexture(image) {\n    const { gl } = this.context;\n\n    if (this.state.bitmapTexture) {\n      this.state.bitmapTexture.delete();\n    }\n\n    if (image instanceof Texture2D) {\n      this.setState({\n        bitmapTexture: image,\n      });\n    } else if (image) {\n      this.setState({\n        bitmapTexture: new Texture2D(gl, {\n          data: image,\n          mipmaps: false,\n          parameters: PIXELATED_TEXTURE_PARAMETERS,\n          // Each color contains a single luminance value.\n          // When sampled, rgb are all set to this luminance, alpha is 1.0.\n          // Reference: https://luma.gl/docs/api-reference/webgl/texture#texture-formats\n          format: GL.LUMINANCE,\n          dataFormat: GL.LUMINANCE,\n          type: GL.UNSIGNED_BYTE,\n          width: TILE_SIZE,\n          height: TILE_SIZE,\n        }),\n      });\n    }\n  }\n}\nHeatmapBitmapLayer.layerName = 'HeatmapBitmapLayer';\nHeatmapBitmapLayer.defaultProps = defaultProps;\n", "// List of the GLSL colormaps available,\n// to validate against before string replacing.\nexport const GLSL_COLORMAPS = [\n  'plasma',\n  'viridis',\n  'jet',\n];\nexport const GLSL_COLORMAP_DEFAULT = 'plasma';\nexport const COLORMAP_SHADER_PLACEHOLDER = 'COLORMAP_FUNC';\n", "/**\n * No change to the vertex shader from the base BitmapLayer.\n * Reference: https://github.com/visgl/deck.gl/blob/8.2-release/modules/layers/src/bitmap-layer/bitmap-layer-vertex.js\n */\nexport var vertexShader = \"\\n#define SHADER_NAME heatmap-bitmap-layer-vertex-shader\\n\\nattribute vec2 texCoords;\\nattribute vec3 positions;\\nattribute vec3 positions64Low;\\n\\nvarying vec2 vTexCoord;\\n\\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\\n\\nvoid main(void) {\\n  geometry.worldPosition = positions;\\n  geometry.uv = texCoords;\\n  geometry.pickingColor = pickingColor;\\n\\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\\n\\n  vTexCoord = texCoords;\\n\\n  vec4 color = vec4(0.0);\\n  DECKGL_FILTER_COLOR(color, geometry);\\n}\\n\";\n/**\n * Fragment shader adapted to perform aggregation and\n * take color scale functions + sliders into account.\n * Reference: https://github.com/visgl/deck.gl/blob/8.2-release/modules/layers/src/bitmap-layer/bitmap-layer-fragment.js\n * Reference: https://github.com/hms-dbmi/viv/blob/06231ae02cac1ff57ba458c71e9bc59ed2fc4f8b/src/layers/XRLayer/xr-layer-fragment-colormap.webgl1.glsl\n */\n\nexport var fragmentShader = \"\\n#define SHADER_NAME heatmap-bitmap-layer-fragment-shader\\n\\n#ifdef GL_ES\\nprecision mediump float;\\n#endif\\n\\nvec4 rdbu (float x_2865134303) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);\\n  const float e1 = 0.35;\\n  const vec4 v1 = vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);\\n  const float e2 = 0.5;\\n  const vec4 v2 = vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);\\n  const float e3 = 0.6;\\n  const vec4 v3 = vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);\\n  const float e4 = 0.7;\\n  const vec4 v4 = vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);\\n  const float e5 = 1.0;\\n  const vec4 v5 = vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);\\n  float a0 = smoothstep(e0,e1,x_2865134303);\\n  float a1 = smoothstep(e1,e2,x_2865134303);\\n  float a2 = smoothstep(e2,e3,x_2865134303);\\n  float a3 = smoothstep(e3,e4,x_2865134303);\\n  float a4 = smoothstep(e4,e5,x_2865134303);\\n  return max(mix(v0,v1,a0)*step(e0,x_2865134303)*step(x_2865134303,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_2865134303)*step(x_2865134303,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_2865134303)*step(x_2865134303,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_2865134303)*step(x_2865134303,e4),mix(v4,v5,a4)*step(e4,x_2865134303)*step(x_2865134303,e5)\\n  ))));\\n}\\n\\nvec4 plasma (float x_4113959278) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);\\n  float a0 = smoothstep(e0,e1,x_4113959278);\\n  float a1 = smoothstep(e1,e2,x_4113959278);\\n  float a2 = smoothstep(e2,e3,x_4113959278);\\n  float a3 = smoothstep(e3,e4,x_4113959278);\\n  float a4 = smoothstep(e4,e5,x_4113959278);\\n  float a5 = smoothstep(e5,e6,x_4113959278);\\n  float a6 = smoothstep(e6,e7,x_4113959278);\\n  float a7 = smoothstep(e7,e8,x_4113959278);\\n  return max(mix(v0,v1,a0)*step(e0,x_4113959278)*step(x_4113959278,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_4113959278)*step(x_4113959278,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_4113959278)*step(x_4113959278,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_4113959278)*step(x_4113959278,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_4113959278)*step(x_4113959278,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_4113959278)*step(x_4113959278,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_4113959278)*step(x_4113959278,e7),mix(v7,v8,a7)*step(e7,x_4113959278)*step(x_4113959278,e8)\\n  )))))));\\n}\\n\\nvec4 viridis (float x_1156145534) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);\\n  float a0 = smoothstep(e0,e1,x_1156145534);\\n  float a1 = smoothstep(e1,e2,x_1156145534);\\n  float a2 = smoothstep(e2,e3,x_1156145534);\\n  float a3 = smoothstep(e3,e4,x_1156145534);\\n  float a4 = smoothstep(e4,e5,x_1156145534);\\n  float a5 = smoothstep(e5,e6,x_1156145534);\\n  float a6 = smoothstep(e6,e7,x_1156145534);\\n  float a7 = smoothstep(e7,e8,x_1156145534);\\n  return max(mix(v0,v1,a0)*step(e0,x_1156145534)*step(x_1156145534,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_1156145534)*step(x_1156145534,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_1156145534)*step(x_1156145534,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_1156145534)*step(x_1156145534,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_1156145534)*step(x_1156145534,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_1156145534)*step(x_1156145534,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_1156145534)*step(x_1156145534,e7),mix(v7,v8,a7)*step(e7,x_1156145534)*step(x_1156145534,e8)\\n  )))))));\\n}\\n\\nvec4 greys (float x_2073311089) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_2073311089);\\n  return mix(v0,v1,a0)*step(e0,x_2073311089)*step(x_2073311089,e1);\\n}\\n\\nvec4 magma (float x_2664132035) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.01568627450980392,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);\\n  float a0 = smoothstep(e0,e1,x_2664132035);\\n  float a1 = smoothstep(e1,e2,x_2664132035);\\n  float a2 = smoothstep(e2,e3,x_2664132035);\\n  float a3 = smoothstep(e3,e4,x_2664132035);\\n  float a4 = smoothstep(e4,e5,x_2664132035);\\n  float a5 = smoothstep(e5,e6,x_2664132035);\\n  float a6 = smoothstep(e6,e7,x_2664132035);\\n  float a7 = smoothstep(e7,e8,x_2664132035);\\n  return max(mix(v0,v1,a0)*step(e0,x_2664132035)*step(x_2664132035,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_2664132035)*step(x_2664132035,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_2664132035)*step(x_2664132035,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_2664132035)*step(x_2664132035,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_2664132035)*step(x_2664132035,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_2664132035)*step(x_2664132035,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_2664132035)*step(x_2664132035,e7),mix(v7,v8,a7)*step(e7,x_2664132035)*step(x_2664132035,e8)\\n  )))))));\\n}\\n\\nvec4 jet (float x_2485945205) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.5137254901960784,1);\\n  const float e1 = 0.125;\\n  const vec4 v1 = vec4(0,0.23529411764705882,0.6666666666666666,1);\\n  const float e2 = 0.375;\\n  const vec4 v2 = vec4(0.0196078431372549,1,1,1);\\n  const float e3 = 0.625;\\n  const vec4 v3 = vec4(1,1,0,1);\\n  const float e4 = 0.875;\\n  const vec4 v4 = vec4(0.9803921568627451,0,0,1);\\n  const float e5 = 1.0;\\n  const vec4 v5 = vec4(0.5019607843137255,0,0,1);\\n  float a0 = smoothstep(e0,e1,x_2485945205);\\n  float a1 = smoothstep(e1,e2,x_2485945205);\\n  float a2 = smoothstep(e2,e3,x_2485945205);\\n  float a3 = smoothstep(e3,e4,x_2485945205);\\n  float a4 = smoothstep(e4,e5,x_2485945205);\\n  return max(mix(v0,v1,a0)*step(e0,x_2485945205)*step(x_2485945205,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_2485945205)*step(x_2485945205,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_2485945205)*step(x_2485945205,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_2485945205)*step(x_2485945205,e4),mix(v4,v5,a4)*step(e4,x_2485945205)*step(x_2485945205,e5)\\n  ))));\\n}\\n\\nvec4 bone (float x_2693572714) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.376;\\n  const vec4 v1 = vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);\\n  const float e2 = 0.753;\\n  const vec4 v2 = vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);\\n  const float e3 = 1.0;\\n  const vec4 v3 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_2693572714);\\n  float a1 = smoothstep(e1,e2,x_2693572714);\\n  float a2 = smoothstep(e2,e3,x_2693572714);\\n  return max(mix(v0,v1,a0)*step(e0,x_2693572714)*step(x_2693572714,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_2693572714)*step(x_2693572714,e2),mix(v2,v3,a2)*step(e2,x_2693572714)*step(x_2693572714,e3)\\n  ));\\n}\\n\\nvec4 copper (float x_2606013778) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.804;\\n  const vec4 v1 = vec4(1,0.6274509803921569,0.4,1);\\n  const float e2 = 1.0;\\n  const vec4 v2 = vec4(1,0.7803921568627451,0.4980392156862745,1);\\n  float a0 = smoothstep(e0,e1,x_2606013778);\\n  float a1 = smoothstep(e1,e2,x_2606013778);\\n  return max(mix(v0,v1,a0)*step(e0,x_2606013778)*step(x_2606013778,e1),mix(v1,v2,a1)*step(e1,x_2606013778)*step(x_2606013778,e2)\\n  );\\n}\\n\\nvec4 density (float x_4072297271) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);\\n  float a0 = smoothstep(e0,e1,x_4072297271);\\n  float a1 = smoothstep(e1,e2,x_4072297271);\\n  float a2 = smoothstep(e2,e3,x_4072297271);\\n  float a3 = smoothstep(e3,e4,x_4072297271);\\n  float a4 = smoothstep(e4,e5,x_4072297271);\\n  float a5 = smoothstep(e5,e6,x_4072297271);\\n  float a6 = smoothstep(e6,e7,x_4072297271);\\n  float a7 = smoothstep(e7,e8,x_4072297271);\\n  return max(mix(v0,v1,a0)*step(e0,x_4072297271)*step(x_4072297271,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_4072297271)*step(x_4072297271,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_4072297271)*step(x_4072297271,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_4072297271)*step(x_4072297271,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_4072297271)*step(x_4072297271,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_4072297271)*step(x_4072297271,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_4072297271)*step(x_4072297271,e7),mix(v7,v8,a7)*step(e7,x_4072297271)*step(x_4072297271,e8)\\n  )))))));\\n}\\n\\nvec4 inferno (float x_524681000) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.01568627450980392,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8901960784313725,0.34901960784313724,0.2,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9882352941176471,1,0.6431372549019608,1);\\n  float a0 = smoothstep(e0,e1,x_524681000);\\n  float a1 = smoothstep(e1,e2,x_524681000);\\n  float a2 = smoothstep(e2,e3,x_524681000);\\n  float a3 = smoothstep(e3,e4,x_524681000);\\n  float a4 = smoothstep(e4,e5,x_524681000);\\n  float a5 = smoothstep(e5,e6,x_524681000);\\n  float a6 = smoothstep(e6,e7,x_524681000);\\n  float a7 = smoothstep(e7,e8,x_524681000);\\n  return max(mix(v0,v1,a0)*step(e0,x_524681000)*step(x_524681000,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_524681000)*step(x_524681000,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_524681000)*step(x_524681000,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_524681000)*step(x_524681000,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_524681000)*step(x_524681000,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_524681000)*step(x_524681000,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_524681000)*step(x_524681000,e7),mix(v7,v8,a7)*step(e7,x_524681000)*step(x_524681000,e8)\\n  )))))));\\n}\\n\\nvec4 cool (float x_3050536724) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.49019607843137253,0,0.7019607843137254,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.4549019607843137,0,0.8549019607843137,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0,0.8,0.7725490196078432,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0,0.9686274509803922,0.5725490196078431,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0,1,0.34509803921568627,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.1568627450980392,1,0.03137254901960784,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.5764705882352941,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_3050536724);\\n  float a1 = smoothstep(e1,e2,x_3050536724);\\n  float a2 = smoothstep(e2,e3,x_3050536724);\\n  float a3 = smoothstep(e3,e4,x_3050536724);\\n  float a4 = smoothstep(e4,e5,x_3050536724);\\n  float a5 = smoothstep(e5,e6,x_3050536724);\\n  float a6 = smoothstep(e6,e7,x_3050536724);\\n  float a7 = smoothstep(e7,e8,x_3050536724);\\n  return max(mix(v0,v1,a0)*step(e0,x_3050536724)*step(x_3050536724,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_3050536724)*step(x_3050536724,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_3050536724)*step(x_3050536724,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_3050536724)*step(x_3050536724,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_3050536724)*step(x_3050536724,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_3050536724)*step(x_3050536724,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_3050536724)*step(x_3050536724,e7),mix(v7,v8,a7)*step(e7,x_3050536724)*step(x_3050536724,e8)\\n  )))))));\\n}\\n\\nvec4 hot (float x_4009354686) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.3;\\n  const vec4 v1 = vec4(0.9019607843137255,0,0,1);\\n  const float e2 = 0.6;\\n  const vec4 v2 = vec4(1,0.8235294117647058,0,1);\\n  const float e3 = 1.0;\\n  const vec4 v3 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_4009354686);\\n  float a1 = smoothstep(e1,e2,x_4009354686);\\n  float a2 = smoothstep(e2,e3,x_4009354686);\\n  return max(mix(v0,v1,a0)*step(e0,x_4009354686)*step(x_4009354686,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_4009354686)*step(x_4009354686,e2),mix(v2,v3,a2)*step(e2,x_4009354686)*step(x_4009354686,e3)\\n  ));\\n}\\n\\nvec4 spring (float x_2270446359) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(1,0,1,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_2270446359);\\n  return mix(v0,v1,a0)*step(e0,x_2270446359)*step(x_2270446359,e1);\\n}\\n\\nvec4 summer (float x_1101081466) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0.5019607843137255,0.4,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0.4,1);\\n  float a0 = smoothstep(e0,e1,x_1101081466);\\n  return mix(v0,v1,a0)*step(e0,x_1101081466)*step(x_1101081466,e1);\\n}\\n\\nvec4 autumn (float x_3652770500) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(1,0,0,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_3652770500);\\n  return mix(v0,v1,a0)*step(e0,x_3652770500)*step(x_3652770500,e1);\\n}\\n\\nvec4 winter (float x_1155565894) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,1,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(0,1,0.5019607843137255,1);\\n  float a0 = smoothstep(e0,e1,x_1155565894);\\n  return mix(v0,v1,a0)*step(e0,x_1155565894)*step(x_1155565894,e1);\\n}\\n\\n// The texture (GL.LUMINANCE & Uint8Array).\\nuniform sampler2D uBitmapTexture;\\n\\n// What are the dimensions of the texture (width, height)?\\nuniform vec2 uTextureSize;\\n\\n// How many consecutive pixels should be aggregated together along each axis?\\nuniform vec2 uAggSize;\\n\\n// What are the values of the color scale sliders?\\nuniform vec2 uColorScaleRange;\\n\\n// The texture coordinate, varying (interpolated between values set by the vertex shader).\\nvarying vec2 vTexCoord;\\n\\nvoid main(void) {\\n  // Compute 1 pixel in texture coordinates\\n  vec2 onePixel = vec2(1.0, 1.0) / uTextureSize;\\n  \\n  vec2 viewCoord = vec2(floor(vTexCoord.x * uTextureSize.x), floor(vTexCoord.y * uTextureSize.y));\\n\\n  // Compute (x % aggSizeX, y % aggSizeY).\\n  // These values will be the number of values to the left / above the current position to consider.\\n  vec2 modAggSize = vec2(-1.0 * mod(viewCoord.x, uAggSize.x), -1.0 * mod(viewCoord.y, uAggSize.y));\\n\\n  // Take the sum of values along each axis.\\n  float intensitySum = 0.0;\\n  vec2 offsetPixels = vec2(0.0, 0.0);\\n\\n  for(int i = 0; i < 16; i++) {\\n    // Check to break outer loop early.\\n    // Uniforms cannot be used as conditions in GLSL for loops.\\n    if(float(i) >= uAggSize.y) {\\n      // Done in the y direction.\\n      break;\\n    }\\n\\n    offsetPixels = vec2(offsetPixels.x, (modAggSize.y + float(i)) * onePixel.y);\\n\\n    for(int j = 0; j < 16; j++) {\\n      // Check to break inner loop early.\\n      // Uniforms cannot be used as conditions in GLSL for loops.\\n      if(float(j) >= uAggSize.x) {\\n        // Done in the x direction.\\n        break;\\n      }\\n\\n      offsetPixels = vec2((modAggSize.x + float(j)) * onePixel.x, offsetPixels.y);\\n      intensitySum += texture2D(uBitmapTexture, vTexCoord + offsetPixels).r;\\n    }\\n  }\\n  \\n  // Compute the mean value.\\n  float intensityMean = intensitySum / (uAggSize.x * uAggSize.y);\\n  \\n  // Re-scale using the color scale slider values.\\n  float scaledIntensityMean = (intensityMean - uColorScaleRange[0]) / max(0.005, (uColorScaleRange[1] - uColorScaleRange[0]));\\n\\n  gl_FragColor = COLORMAP_FUNC(clamp(scaledIntensityMean, 0.0, 1.0));\\n\\n  geometry.uv = vTexCoord;\\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\\n}\\n\";", "import clamp from 'lodash/clamp';\nimport range from 'lodash/range';\n\nimport {\n  AXIS_LABEL_TEXT_SIZE,\n  AXIS_MIN_SIZE,\n  AXIS_MAX_SIZE,\n} from '../../layers/heatmap-constants';\n\nexport function getGeneByCellTile(view, {\n  tileSize, tileI, tileJ, numCells, numGenes, cellOrdering, cells,\n}) {\n  const tileData = new Uint8Array(tileSize * tileSize);\n  let offset;\n  let value;\n  let cellI;\n  let geneI;\n  let sortedCellI;\n\n  const tileSizeRange = range(tileSize);\n\n  tileSizeRange.forEach((j) => {\n    // Need to iterate over cells in the outer loop.\n    cellI = (tileJ * tileSize) + j;\n    if (cellI < numCells) {\n      sortedCellI = cells.indexOf(cellOrdering[cellI]);\n      if (sortedCellI >= -1) {\n        tileSizeRange.forEach((i) => {\n          geneI = (tileI * tileSize) + i;\n          value = view[sortedCellI * numGenes + geneI];\n          offset = ((tileSize - i - 1) * tileSize + j);\n          tileData[offset] = value;\n        });\n      }\n    }\n  });\n  return tileData;\n}\n\nexport function getCellByGeneTile(view, {\n  tileSize, tileI, tileJ, numCells, numGenes, cellOrdering, cells,\n}) {\n  const tileData = new Uint8Array(tileSize * tileSize);\n  let offset;\n  let value;\n  let cellI;\n  let geneI;\n  let sortedCellI;\n\n  const tileSizeRange = range(tileSize);\n\n  tileSizeRange.forEach((i) => {\n    // Need to iterate over cells in the outer loop.\n    cellI = (tileI * tileSize) + i;\n    if (cellI < numCells) {\n      sortedCellI = cells.indexOf(cellOrdering[cellI]);\n      if (sortedCellI >= -1) {\n        tileSizeRange.forEach((j) => {\n          geneI = (tileJ * tileSize) + j;\n          if (geneI < numGenes) {\n            value = view[sortedCellI * numGenes + geneI];\n          } else {\n            value = 0;\n          }\n          offset = ((tileSize - i - 1) * tileSize + j);\n          tileData[offset] = value;\n        });\n      }\n    }\n  });\n\n  return tileData;\n}\n\n/**\n * Called before a layer is drawn to determine whether it should be rendered.\n * Reference: https://deck.gl/docs/api-reference/core/deck#layerfilter\n * @param {object} params A viewport, layer pair.\n * @param {object} params.layer The layer to check.\n * @param {object} params.viewport The viewport to check.\n * @returns {boolean} Should this layer be rendered in this viewport?\n */\nexport function layerFilter({ layer, viewport }) {\n  if (viewport.id === 'axisLeft') {\n    return layer.id.startsWith('axisLeft');\n  } if (viewport.id === 'axisTop') {\n    return layer.id.startsWith('axisTop');\n  } if (viewport.id === 'heatmap') {\n    return layer.id.startsWith('heatmap');\n  } if (viewport.id === 'colorsLeft') {\n    return layer.id.startsWith('colorsLeft');\n  } if (viewport.id === 'colorsTop') {\n    return layer.id.startsWith('colorsTop');\n  }\n  return false;\n}\n\n/**\n * Get the size of the left and top heatmap axes,\n * taking into account the maximum label string lengths.\n * @param {boolean} transpose Is the heatmap transposed?\n * @param {number} geneLabelMaxLength What is the maximum length gene label?\n * @param {number} cellLabelMaxLength What is the maximum length cell label?\n * @returns {number[]} [axisOffsetLeft, axisOffsetTop]\n */\nexport function getAxisSizes(transpose, geneLabelMaxLength, cellLabelMaxLength) {\n  const axisOffsetLeft = clamp(\n    (transpose ? geneLabelMaxLength : cellLabelMaxLength) * AXIS_LABEL_TEXT_SIZE,\n    AXIS_MIN_SIZE,\n    AXIS_MAX_SIZE,\n  );\n  const axisOffsetTop = clamp(\n    (transpose ? cellLabelMaxLength : geneLabelMaxLength) * AXIS_LABEL_TEXT_SIZE,\n    AXIS_MIN_SIZE,\n    AXIS_MAX_SIZE,\n  );\n  return [axisOffsetLeft, axisOffsetTop];\n}\n\n/**\n * Convert a mouse coordinate (x, y) to a heatmap coordinate (col index, row index).\n * @param {number} mouseX The mouse X of interest.\n * @param {number} mouseY The mouse Y of interest.\n * @param {object} param2 An object containing current sizes and scale factors.\n * @returns {number[]} [colI, rowI]\n */\nexport function mouseToHeatmapPosition(mouseX, mouseY, {\n  offsetLeft, offsetTop, targetX, targetY, scaleFactor, matrixWidth, matrixHeight, numRows, numCols,\n}) {\n  // TODO: use linear algebra\n  const viewMouseX = mouseX - offsetLeft;\n  const viewMouseY = mouseY - offsetTop;\n\n  if (viewMouseX < 0 || viewMouseY < 0) {\n    // The mouse is outside the heatmap.\n    return [null, null];\n  }\n\n  // Determine the rowI and colI values based on the current viewState.\n  const bboxTargetX = targetX * scaleFactor + matrixWidth * scaleFactor / 2;\n  const bboxTargetY = targetY * scaleFactor + matrixHeight * scaleFactor / 2;\n\n  const bboxLeft = bboxTargetX - matrixWidth / 2;\n  const bboxTop = bboxTargetY - matrixHeight / 2;\n\n  const zoomedOffsetLeft = bboxLeft / (matrixWidth * scaleFactor);\n  const zoomedOffsetTop = bboxTop / (matrixHeight * scaleFactor);\n\n  const zoomedViewMouseX = viewMouseX / (matrixWidth * scaleFactor);\n  const zoomedViewMouseY = viewMouseY / (matrixHeight * scaleFactor);\n\n  const zoomedMouseX = zoomedOffsetLeft + zoomedViewMouseX;\n  const zoomedMouseY = zoomedOffsetTop + zoomedViewMouseY;\n\n  const rowI = Math.floor(zoomedMouseY * numRows);\n  const colI = Math.floor(zoomedMouseX * numCols);\n  return [colI, rowI];\n}\n\n/**\n * Convert a heatmap coordinate (col index, row index) to a mouse coordinate (x, y).\n * @param {number} colI The column index of interest.\n * @param {number} rowI The row index of interest.\n * @param {object} param2 An object containing current sizes and scale factors.\n * @returns {number[]} [x, y]\n */\nexport function heatmapToMousePosition(colI, rowI, {\n  offsetLeft, offsetTop, targetX, targetY, scaleFactor, matrixWidth, matrixHeight, numRows, numCols,\n}) {\n  // TODO: use linear algebra\n  let zoomedMouseY = null;\n  let zoomedMouseX = null;\n\n  if (rowI !== null) {\n    const minY = -matrixHeight * scaleFactor / 2;\n    const maxY = matrixHeight * scaleFactor / 2;\n    const totalHeight = maxY - minY;\n\n    const minInViewY = (targetY * scaleFactor) - (matrixHeight / 2);\n    const maxInViewY = (targetY * scaleFactor) + (matrixHeight / 2);\n    const inViewHeight = maxInViewY - minInViewY;\n\n    const normalizedRowY = (rowI + 0.5) / numRows;\n    const globalRowY = minY + (normalizedRowY * totalHeight);\n\n    if (minInViewY <= globalRowY && globalRowY <= maxInViewY) {\n      zoomedMouseY = offsetTop + ((globalRowY - minInViewY) / inViewHeight) * matrixHeight;\n    }\n  }\n  if (colI !== null) {\n    const minX = -matrixWidth * scaleFactor / 2;\n    const maxX = matrixWidth * scaleFactor / 2;\n    const totalWidth = maxX - minX;\n\n    const minInViewX = (targetX * scaleFactor) - (matrixWidth / 2);\n    const maxInViewX = (targetX * scaleFactor) + (matrixWidth / 2);\n    const inViewWidth = maxInViewX - minInViewX;\n\n    const normalizedRowX = (colI + 0.5) / numCols;\n    const globalRowX = minX + (normalizedRowX * totalWidth);\n\n    if (minInViewX <= globalRowX && globalRowX <= maxInViewX) {\n      zoomedMouseX = offsetLeft + ((globalRowX - minInViewX) / inViewWidth) * matrixWidth;\n    }\n  }\n  return [zoomedMouseX, zoomedMouseY];\n}\n", "const encodedJs = \"KCgpPT57dmFyIGNFPU9iamVjdC5jcmVhdGU7dmFyIFA9T2JqZWN0LmRlZmluZVByb3BlcnR5O3ZhciBmRT1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO3ZhciBpRT1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lczt2YXIgWEU9T2JqZWN0LmdldFByb3RvdHlwZU9mLHNFPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7dmFyIGFFPUU9PlAoRSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGpfPXR5cGVvZiByZXF1aXJlIT0idW5kZWZpbmVkIj9yZXF1aXJlOkU9Pnt0aHJvdyBuZXcgRXJyb3IoJ0R5bmFtaWMgcmVxdWlyZSBvZiAiJytFKyciIGlzIG5vdCBzdXBwb3J0ZWQnKX07dmFyIEE9KEUsXyk9PigpPT4oX3x8RSgoXz17ZXhwb3J0czp7fX0pLmV4cG9ydHMsXyksXy5leHBvcnRzKTt2YXIgYkU9KEUsXyxSKT0+e2lmKF8mJnR5cGVvZiBfPT0ib2JqZWN0Inx8dHlwZW9mIF89PSJmdW5jdGlvbiIpZm9yKGxldCBUIG9mIGlFKF8pKSFzRS5jYWxsKEUsVCkmJlQhPT0iZGVmYXVsdCImJlAoRSxULHtnZXQ6KCk9Pl9bVF0sZW51bWVyYWJsZTohKFI9ZkUoXyxUKSl8fFIuZW51bWVyYWJsZX0pO3JldHVybiBFfSxzPUU9PmJFKGFFKFAoRSE9bnVsbD9jRShYRShFKSk6e30sImRlZmF1bHQiLEUmJkUuX19lc01vZHVsZSYmImRlZmF1bHQiaW4gRT97Z2V0OigpPT5FLmRlZmF1bHQsZW51bWVyYWJsZTohMH06e3ZhbHVlOkUsZW51bWVyYWJsZTohMH0pKSxFKTt2YXIgYj1BKChoXyxhKT0+e2Z1bmN0aW9uIGRFKEUsXyxSKXtyZXR1cm4gRT09PUUmJihSIT09dm9pZCAwJiYoRT1FPD1SP0U6UiksXyE9PXZvaWQgMCYmKEU9RT49Xz9FOl8pKSxFfWEuZXhwb3J0cz1kRX0pO3ZhciBvPUEoKFFfLGQpPT57ZnVuY3Rpb24gSEUoRSl7dmFyIF89dHlwZW9mIEU7cmV0dXJuIEUhPW51bGwmJihfPT0ib2JqZWN0Inx8Xz09ImZ1bmN0aW9uIil9ZC5leHBvcnRzPUhFfSk7dmFyIFc9QSgod18sSCk9Pnt2YXIgV0U9dHlwZW9mIGdsb2JhbD09Im9iamVjdCImJmdsb2JhbCYmZ2xvYmFsLk9iamVjdD09PU9iamVjdCYmZ2xvYmFsO0guZXhwb3J0cz1XRX0pO3ZhciB1PUEoKGtfLFYpPT57dmFyIFZFPVcoKSx1RT10eXBlb2Ygc2VsZj09Im9iamVjdCImJnNlbGYmJnNlbGYuT2JqZWN0PT09T2JqZWN0JiZzZWxmLFlFPVZFfHx1RXx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKTtWLmV4cG9ydHM9WUV9KTt2YXIgRz1BKCh2XyxZKT0+e3ZhciBsRT11KCksZ0U9bEUuU3ltYm9sO1kuZXhwb3J0cz1nRX0pO3ZhciBwPUEoKEpfLEspPT57dmFyIGw9RygpLGc9T2JqZWN0LnByb3RvdHlwZSxLRT1nLmhhc093blByb3BlcnR5LHBFPWcudG9TdHJpbmcsbj1sP2wudG9TdHJpbmdUYWc6dm9pZCAwO2Z1bmN0aW9uIG1FKEUpe3ZhciBfPUtFLmNhbGwoRSxuKSxSPUVbbl07dHJ5e0Vbbl09dm9pZCAwO3ZhciBUPSEwfWNhdGNoKHgpe312YXIgTj1wRS5jYWxsKEUpO3JldHVybiBUJiYoXz9FW25dPVI6ZGVsZXRlIEVbbl0pLE59Sy5leHBvcnRzPW1FfSk7dmFyIHk9QSgoJF8sbSk9Pnt2YXIgeUU9T2JqZWN0LnByb3RvdHlwZSxaRT15RS50b1N0cmluZztmdW5jdGlvbiBqRShFKXtyZXR1cm4gWkUuY2FsbChFKX1tLmV4cG9ydHM9akV9KTt2YXIgcj1BKCh6XyxxKT0+e3ZhciBaPUcoKSxxRT1wKCksaEU9eSgpLFFFPSJbb2JqZWN0IE51bGxdIix3RT0iW29iamVjdCBVbmRlZmluZWRdIixqPVo/Wi50b1N0cmluZ1RhZzp2b2lkIDA7ZnVuY3Rpb24ga0UoRSl7cmV0dXJuIEU9PW51bGw/RT09PXZvaWQgMD93RTpRRTpqJiZqIGluIE9iamVjdChFKT9xRShFKTpoRShFKX1xLmV4cG9ydHM9a0V9KTt2YXIgUT1BKChFMCxoKT0+e2Z1bmN0aW9uIHZFKEUpe3JldHVybiBFIT1udWxsJiZ0eXBlb2YgRT09Im9iamVjdCJ9aC5leHBvcnRzPXZFfSk7dmFyIGs9QSgoXzAsdyk9Pnt2YXIgSkU9cigpLCRFPVEoKSx6RT0iW29iamVjdCBTeW1ib2xdIjtmdW5jdGlvbiBFXyhFKXtyZXR1cm4gdHlwZW9mIEU9PSJzeW1ib2wifHwkRShFKSYmSkUoRSk9PXpFfXcuZXhwb3J0cz1FX30pO3ZhciBjPUEoKFIwLCQpPT57dmFyIHY9bygpLF9fPWsoKSxKPTAvMCxSXz0vXlxzK3xccyskL2csVF89L15bLStdMHhbMC05YS1mXSskL2ksQV89L14wYlswMV0rJC9pLHhfPS9eMG9bMC03XSskL2ksTl89cGFyc2VJbnQ7ZnVuY3Rpb24gSV8oRSl7aWYodHlwZW9mIEU9PSJudW1iZXIiKXJldHVybiBFO2lmKF9fKEUpKXJldHVybiBKO2lmKHYoRSkpe3ZhciBfPXR5cGVvZiBFLnZhbHVlT2Y9PSJmdW5jdGlvbiI/RS52YWx1ZU9mKCk6RTtFPXYoXyk/XysiIjpffWlmKHR5cGVvZiBFIT0ic3RyaW5nIilyZXR1cm4gRT09PTA/RTorRTtFPUUucmVwbGFjZShSXywiIik7dmFyIFI9QV8udGVzdChFKTtyZXR1cm4gUnx8eF8udGVzdChFKT9OXyhFLnNsaWNlKDIpLFI/Mjo4KTpUXy50ZXN0KEUpP0o6K0V9JC5leHBvcnRzPUlffSk7dmFyIEVFPUEoKFQwLHopPT57dmFyIFNfPWIoKSxmPWMoKTtmdW5jdGlvbiBPXyhFLF8sUil7cmV0dXJuIFI9PT12b2lkIDAmJihSPV8sXz12b2lkIDApLFIhPT12b2lkIDAmJihSPWYoUiksUj1SPT09Uj9SOjApLF8hPT12b2lkIDAmJihfPWYoXyksXz1fPT09Xz9fOjApLFNfKGYoRSksXyxSKX16LmV4cG9ydHM9T199KTt2YXIgUkU9QSgoQTAsX0UpPT57dmFyIE1fPU1hdGguY2VpbCxGXz1NYXRoLm1heDtmdW5jdGlvbiBDXyhFLF8sUixUKXtmb3IodmFyIE49LTEseD1GXyhNXygoXy1FKS8oUnx8MSkpLDApLE89QXJyYXkoeCk7eC0tOylPW1Q/eDorK05dPUUsRSs9UjtyZXR1cm4gT31fRS5leHBvcnRzPUNffSk7dmFyIEFFPUEoKHgwLFRFKT0+e2Z1bmN0aW9uIGVfKEUsXyl7cmV0dXJuIEU9PT1ffHxFIT09RSYmXyE9PV99VEUuZXhwb3J0cz1lX30pO3ZhciBORT1BKChOMCx4RSk9Pnt2YXIgTF89cigpLEJfPW8oKSxVXz0iW29iamVjdCBBc3luY0Z1bmN0aW9uXSIsRF89IltvYmplY3QgRnVuY3Rpb25dIix0Xz0iW29iamVjdCBHZW5lcmF0b3JGdW5jdGlvbl0iLG5fPSJbb2JqZWN0IFByb3h5XSI7ZnVuY3Rpb24gb18oRSl7aWYoIUJfKEUpKXJldHVybiExO3ZhciBfPUxfKEUpO3JldHVybiBfPT1EX3x8Xz09dF98fF89PVVffHxfPT1uX314RS5leHBvcnRzPW9ffSk7dmFyIFNFPUEoKEkwLElFKT0+e3ZhciBQXz05MDA3MTk5MjU0NzQwOTkxO2Z1bmN0aW9uIEdfKEUpe3JldHVybiB0eXBlb2YgRT09Im51bWJlciImJkU+LTEmJkUlMT09MCYmRTw9UF99SUUuZXhwb3J0cz1HX30pO3ZhciBNRT1BKChTMCxPRSk9Pnt2YXIgcl89TkUoKSxjXz1TRSgpO2Z1bmN0aW9uIGZfKEUpe3JldHVybiBFIT1udWxsJiZjXyhFLmxlbmd0aCkmJiFyXyhFKX1PRS5leHBvcnRzPWZffSk7dmFyIENFPUEoKE8wLEZFKT0+e3ZhciBpXz05MDA3MTk5MjU0NzQwOTkxLFhfPS9eKD86MHxbMS05XVxkKikkLztmdW5jdGlvbiBzXyhFLF8pe3ZhciBSPXR5cGVvZiBFO3JldHVybiBfPV89PW51bGw/aV86XywhIV8mJihSPT0ibnVtYmVyInx8UiE9InN5bWJvbCImJlhfLnRlc3QoRSkpJiZFPi0xJiZFJTE9PTAmJkU8X31GRS5leHBvcnRzPXNffSk7dmFyIExFPUEoKE0wLGVFKT0+e3ZhciBhXz1BRSgpLGJfPU1FKCksZF89Q0UoKSxIXz1vKCk7ZnVuY3Rpb24gV18oRSxfLFIpe2lmKCFIXyhSKSlyZXR1cm4hMTt2YXIgVD10eXBlb2YgXztyZXR1cm4oVD09Im51bWJlciI/Yl8oUikmJmRfKF8sUi5sZW5ndGgpOlQ9PSJzdHJpbmciJiZfIGluIFIpP2FfKFJbX10sRSk6ITF9ZUUuZXhwb3J0cz1XX30pO3ZhciBERT1BKChGMCxVRSk9Pnt2YXIgVl89YygpLEJFPTEvMCx1Xz0xNzk3NjkzMTM0ODYyMzE1N2UyOTI7ZnVuY3Rpb24gWV8oRSl7aWYoIUUpcmV0dXJuIEU9PT0wP0U6MDtpZihFPVZfKEUpLEU9PT1CRXx8RT09PS1CRSl7dmFyIF89RTwwPy0xOjE7cmV0dXJuIF8qdV99cmV0dXJuIEU9PT1FP0U6MH1VRS5leHBvcnRzPVlffSk7dmFyIG5FPUEoKEMwLHRFKT0+e3ZhciBsXz1SRSgpLGdfPUxFKCksaT1ERSgpO2Z1bmN0aW9uIEtfKEUpe3JldHVybiBmdW5jdGlvbihfLFIsVCl7cmV0dXJuIFQmJnR5cGVvZiBUIT0ibnVtYmVyIiYmZ18oXyxSLFQpJiYoUj1UPXZvaWQgMCksXz1pKF8pLFI9PT12b2lkIDA/KFI9XyxfPTApOlI9aShSKSxUPVQ9PT12b2lkIDA/XzxSPzE6LTE6aShUKSxsXyhfLFIsVCxFKX19dEUuZXhwb3J0cz1LX30pO3ZhciBQRT1BKChlMCxvRSk9Pnt2YXIgcF89bkUoKSxtXz1wXygpO29FLmV4cG9ydHM9bV99KTt2YXIgeV89cyhFRSgpKSxYPXMoUEUoKSk7dmFyIFM9e0RFUFRIX0JVRkZFUl9CSVQ6MjU2LFNURU5DSUxfQlVGRkVSX0JJVDoxMDI0LENPTE9SX0JVRkZFUl9CSVQ6MTYzODQsUE9JTlRTOjAsTElORVM6MSxMSU5FX0xPT1A6MixMSU5FX1NUUklQOjMsVFJJQU5HTEVTOjQsVFJJQU5HTEVfU1RSSVA6NSxUUklBTkdMRV9GQU46NixaRVJPOjAsT05FOjEsU1JDX0NPTE9SOjc2OCxPTkVfTUlOVVNfU1JDX0NPTE9SOjc2OSxTUkNfQUxQSEE6NzcwLE9ORV9NSU5VU19TUkNfQUxQSEE6NzcxLERTVF9BTFBIQTo3NzIsT05FX01JTlVTX0RTVF9BTFBIQTo3NzMsRFNUX0NPTE9SOjc3NCxPTkVfTUlOVVNfRFNUX0NPTE9SOjc3NSxTUkNfQUxQSEFfU0FUVVJBVEU6Nzc2LENPTlNUQU5UX0NPTE9SOjMyNzY5LE9ORV9NSU5VU19DT05TVEFOVF9DT0xPUjozMjc3MCxDT05TVEFOVF9BTFBIQTozMjc3MSxPTkVfTUlOVVNfQ09OU1RBTlRfQUxQSEE6MzI3NzIsRlVOQ19BREQ6MzI3NzQsRlVOQ19TVUJUUkFDVDozMjc3OCxGVU5DX1JFVkVSU0VfU1VCVFJBQ1Q6MzI3NzksQkxFTkRfRVFVQVRJT046MzI3NzcsQkxFTkRfRVFVQVRJT05fUkdCOjMyNzc3LEJMRU5EX0VRVUFUSU9OX0FMUEhBOjM0ODc3LEJMRU5EX0RTVF9SR0I6MzI5NjgsQkxFTkRfU1JDX1JHQjozMjk2OSxCTEVORF9EU1RfQUxQSEE6MzI5NzAsQkxFTkRfU1JDX0FMUEhBOjMyOTcxLEJMRU5EX0NPTE9SOjMyNzczLEFSUkFZX0JVRkZFUl9CSU5ESU5HOjM0OTY0LEVMRU1FTlRfQVJSQVlfQlVGRkVSX0JJTkRJTkc6MzQ5NjUsTElORV9XSURUSDoyODQ5LEFMSUFTRURfUE9JTlRfU0laRV9SQU5HRTozMzkwMSxBTElBU0VEX0xJTkVfV0lEVEhfUkFOR0U6MzM5MDIsQ1VMTF9GQUNFX01PREU6Mjg4NSxGUk9OVF9GQUNFOjI4ODYsREVQVEhfUkFOR0U6MjkyOCxERVBUSF9XUklURU1BU0s6MjkzMCxERVBUSF9DTEVBUl9WQUxVRToyOTMxLERFUFRIX0ZVTkM6MjkzMixTVEVOQ0lMX0NMRUFSX1ZBTFVFOjI5NjEsU1RFTkNJTF9GVU5DOjI5NjIsU1RFTkNJTF9GQUlMOjI5NjQsU1RFTkNJTF9QQVNTX0RFUFRIX0ZBSUw6Mjk2NSxTVEVOQ0lMX1BBU1NfREVQVEhfUEFTUzoyOTY2LFNURU5DSUxfUkVGOjI5NjcsU1RFTkNJTF9WQUxVRV9NQVNLOjI5NjMsU1RFTkNJTF9XUklURU1BU0s6Mjk2OCxTVEVOQ0lMX0JBQ0tfRlVOQzozNDgxNixTVEVOQ0lMX0JBQ0tfRkFJTDozNDgxNyxTVEVOQ0lMX0JBQ0tfUEFTU19ERVBUSF9GQUlMOjM0ODE4LFNURU5DSUxfQkFDS19QQVNTX0RFUFRIX1BBU1M6MzQ4MTksU1RFTkNJTF9CQUNLX1JFRjozNjAwMyxTVEVOQ0lMX0JBQ0tfVkFMVUVfTUFTSzozNjAwNCxTVEVOQ0lMX0JBQ0tfV1JJVEVNQVNLOjM2MDA1LFZJRVdQT1JUOjI5NzgsU0NJU1NPUl9CT1g6MzA4OCxDT0xPUl9DTEVBUl9WQUxVRTozMTA2LENPTE9SX1dSSVRFTUFTSzozMTA3LFVOUEFDS19BTElHTk1FTlQ6MzMxNyxQQUNLX0FMSUdOTUVOVDozMzMzLE1BWF9URVhUVVJFX1NJWkU6MzM3OSxNQVhfVklFV1BPUlRfRElNUzozMzg2LFNVQlBJWEVMX0JJVFM6MzQwOCxSRURfQklUUzozNDEwLEdSRUVOX0JJVFM6MzQxMSxCTFVFX0JJVFM6MzQxMixBTFBIQV9CSVRTOjM0MTMsREVQVEhfQklUUzozNDE0LFNURU5DSUxfQklUUzozNDE1LFBPTFlHT05fT0ZGU0VUX1VOSVRTOjEwNzUyLFBPTFlHT05fT0ZGU0VUX0ZBQ1RPUjozMjgyNCxURVhUVVJFX0JJTkRJTkdfMkQ6MzI4NzMsU0FNUExFX0JVRkZFUlM6MzI5MzYsU0FNUExFUzozMjkzNyxTQU1QTEVfQ09WRVJBR0VfVkFMVUU6MzI5MzgsU0FNUExFX0NPVkVSQUdFX0lOVkVSVDozMjkzOSxDT01QUkVTU0VEX1RFWFRVUkVfRk9STUFUUzozNDQ2NyxWRU5ET1I6NzkzNixSRU5ERVJFUjo3OTM3LFZFUlNJT046NzkzOCxJTVBMRU1FTlRBVElPTl9DT0xPUl9SRUFEX1RZUEU6MzU3MzgsSU1QTEVNRU5UQVRJT05fQ09MT1JfUkVBRF9GT1JNQVQ6MzU3MzksQlJPV1NFUl9ERUZBVUxUX1dFQkdMOjM3NDQ0LFNUQVRJQ19EUkFXOjM1MDQ0LFNUUkVBTV9EUkFXOjM1MDQwLERZTkFNSUNfRFJBVzozNTA0OCxBUlJBWV9CVUZGRVI6MzQ5NjIsRUxFTUVOVF9BUlJBWV9CVUZGRVI6MzQ5NjMsQlVGRkVSX1NJWkU6MzQ2NjAsQlVGRkVSX1VTQUdFOjM0NjYxLENVUlJFTlRfVkVSVEVYX0FUVFJJQjozNDM0MixWRVJURVhfQVRUUklCX0FSUkFZX0VOQUJMRUQ6MzQzMzgsVkVSVEVYX0FUVFJJQl9BUlJBWV9TSVpFOjM0MzM5LFZFUlRFWF9BVFRSSUJfQVJSQVlfU1RSSURFOjM0MzQwLFZFUlRFWF9BVFRSSUJfQVJSQVlfVFlQRTozNDM0MSxWRVJURVhfQVRUUklCX0FSUkFZX05PUk1BTElaRUQ6MzQ5MjIsVkVSVEVYX0FUVFJJQl9BUlJBWV9QT0lOVEVSOjM0MzczLFZFUlRFWF9BVFRSSUJfQVJSQVlfQlVGRkVSX0JJTkRJTkc6MzQ5NzUsQ1VMTF9GQUNFOjI4ODQsRlJPTlQ6MTAyOCxCQUNLOjEwMjksRlJPTlRfQU5EX0JBQ0s6MTAzMixCTEVORDozMDQyLERFUFRIX1RFU1Q6MjkyOSxESVRIRVI6MzAyNCxQT0xZR09OX09GRlNFVF9GSUxMOjMyODIzLFNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRTozMjkyNixTQU1QTEVfQ09WRVJBR0U6MzI5MjgsU0NJU1NPUl9URVNUOjMwODksU1RFTkNJTF9URVNUOjI5NjAsTk9fRVJST1I6MCxJTlZBTElEX0VOVU06MTI4MCxJTlZBTElEX1ZBTFVFOjEyODEsSU5WQUxJRF9PUEVSQVRJT046MTI4MixPVVRfT0ZfTUVNT1JZOjEyODUsQ09OVEVYVF9MT1NUX1dFQkdMOjM3NDQyLENXOjIzMDQsQ0NXOjIzMDUsRE9OVF9DQVJFOjQzNTIsRkFTVEVTVDo0MzUzLE5JQ0VTVDo0MzU0LEdFTkVSQVRFX01JUE1BUF9ISU5UOjMzMTcwLEJZVEU6NTEyMCxVTlNJR05FRF9CWVRFOjUxMjEsU0hPUlQ6NTEyMixVTlNJR05FRF9TSE9SVDo1MTIzLElOVDo1MTI0LFVOU0lHTkVEX0lOVDo1MTI1LEZMT0FUOjUxMjYsRE9VQkxFOjUxMzAsREVQVEhfQ09NUE9ORU5UOjY0MDIsQUxQSEE6NjQwNixSR0I6NjQwNyxSR0JBOjY0MDgsTFVNSU5BTkNFOjY0MDksTFVNSU5BTkNFX0FMUEhBOjY0MTAsVU5TSUdORURfU0hPUlRfNF80XzRfNDozMjgxOSxVTlNJR05FRF9TSE9SVF81XzVfNV8xOjMyODIwLFVOU0lHTkVEX1NIT1JUXzVfNl81OjMzNjM1LEZSQUdNRU5UX1NIQURFUjozNTYzMixWRVJURVhfU0hBREVSOjM1NjMzLENPTVBJTEVfU1RBVFVTOjM1NzEzLERFTEVURV9TVEFUVVM6MzU3MTIsTElOS19TVEFUVVM6MzU3MTQsVkFMSURBVEVfU1RBVFVTOjM1NzE1LEFUVEFDSEVEX1NIQURFUlM6MzU3MTcsQUNUSVZFX0FUVFJJQlVURVM6MzU3MjEsQUNUSVZFX1VOSUZPUk1TOjM1NzE4LE1BWF9WRVJURVhfQVRUUklCUzozNDkyMSxNQVhfVkVSVEVYX1VOSUZPUk1fVkVDVE9SUzozNjM0NyxNQVhfVkFSWUlOR19WRUNUT1JTOjM2MzQ4LE1BWF9DT01CSU5FRF9URVhUVVJFX0lNQUdFX1VOSVRTOjM1NjYxLE1BWF9WRVJURVhfVEVYVFVSRV9JTUFHRV9VTklUUzozNTY2MCxNQVhfVEVYVFVSRV9JTUFHRV9VTklUUzozNDkzMCxNQVhfRlJBR01FTlRfVU5JRk9STV9WRUNUT1JTOjM2MzQ5LFNIQURFUl9UWVBFOjM1NjYzLFNIQURJTkdfTEFOR1VBR0VfVkVSU0lPTjozNTcyNCxDVVJSRU5UX1BST0dSQU06MzU3MjUsTkVWRVI6NTEyLEFMV0FZUzo1MTksTEVTUzo1MTMsRVFVQUw6NTE0LExFUVVBTDo1MTUsR1JFQVRFUjo1MTYsR0VRVUFMOjUxOCxOT1RFUVVBTDo1MTcsS0VFUDo3NjgwLFJFUExBQ0U6NzY4MSxJTkNSOjc2ODIsREVDUjo3NjgzLElOVkVSVDo1Mzg2LElOQ1JfV1JBUDozNDA1NSxERUNSX1dSQVA6MzQwNTYsTkVBUkVTVDo5NzI4LExJTkVBUjo5NzI5LE5FQVJFU1RfTUlQTUFQX05FQVJFU1Q6OTk4NCxMSU5FQVJfTUlQTUFQX05FQVJFU1Q6OTk4NSxORUFSRVNUX01JUE1BUF9MSU5FQVI6OTk4NixMSU5FQVJfTUlQTUFQX0xJTkVBUjo5OTg3LFRFWFRVUkVfTUFHX0ZJTFRFUjoxMDI0MCxURVhUVVJFX01JTl9GSUxURVI6MTAyNDEsVEVYVFVSRV9XUkFQX1M6MTAyNDIsVEVYVFVSRV9XUkFQX1Q6MTAyNDMsVEVYVFVSRV8yRDozNTUzLFRFWFRVUkU6NTg5MCxURVhUVVJFX0NVQkVfTUFQOjM0MDY3LFRFWFRVUkVfQklORElOR19DVUJFX01BUDozNDA2OCxURVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1g6MzQwNjksVEVYVFVSRV9DVUJFX01BUF9ORUdBVElWRV9YOjM0MDcwLFRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWTozNDA3MSxURVhUVVJFX0NVQkVfTUFQX05FR0FUSVZFX1k6MzQwNzIsVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9aOjM0MDczLFRFWFRVUkVfQ1VCRV9NQVBfTkVHQVRJVkVfWjozNDA3NCxNQVhfQ1VCRV9NQVBfVEVYVFVSRV9TSVpFOjM0MDc2LFRFWFRVUkUwOjMzOTg0LEFDVElWRV9URVhUVVJFOjM0MDE2LFJFUEVBVDoxMDQ5NyxDTEFNUF9UT19FREdFOjMzMDcxLE1JUlJPUkVEX1JFUEVBVDozMzY0OCxURVhUVVJFX1dJRFRIOjQwOTYsVEVYVFVSRV9IRUlHSFQ6NDA5NyxGTE9BVF9WRUMyOjM1NjY0LEZMT0FUX1ZFQzM6MzU2NjUsRkxPQVRfVkVDNDozNTY2NixJTlRfVkVDMjozNTY2NyxJTlRfVkVDMzozNTY2OCxJTlRfVkVDNDozNTY2OSxCT09MOjM1NjcwLEJPT0xfVkVDMjozNTY3MSxCT09MX1ZFQzM6MzU2NzIsQk9PTF9WRUM0OjM1NjczLEZMT0FUX01BVDI6MzU2NzQsRkxPQVRfTUFUMzozNTY3NSxGTE9BVF9NQVQ0OjM1Njc2LFNBTVBMRVJfMkQ6MzU2NzgsU0FNUExFUl9DVUJFOjM1NjgwLExPV19GTE9BVDozNjMzNixNRURJVU1fRkxPQVQ6MzYzMzcsSElHSF9GTE9BVDozNjMzOCxMT1dfSU5UOjM2MzM5LE1FRElVTV9JTlQ6MzYzNDAsSElHSF9JTlQ6MzYzNDEsRlJBTUVCVUZGRVI6MzYxNjAsUkVOREVSQlVGRkVSOjM2MTYxLFJHQkE0OjMyODU0LFJHQjVfQTE6MzI4NTUsUkdCNTY1OjM2MTk0LERFUFRIX0NPTVBPTkVOVDE2OjMzMTg5LFNURU5DSUxfSU5ERVg6NjQwMSxTVEVOQ0lMX0lOREVYODozNjE2OCxERVBUSF9TVEVOQ0lMOjM0MDQxLFJFTkRFUkJVRkZFUl9XSURUSDozNjE2MixSRU5ERVJCVUZGRVJfSEVJR0hUOjM2MTYzLFJFTkRFUkJVRkZFUl9JTlRFUk5BTF9GT1JNQVQ6MzYxNjQsUkVOREVSQlVGRkVSX1JFRF9TSVpFOjM2MTc2LFJFTkRFUkJVRkZFUl9HUkVFTl9TSVpFOjM2MTc3LFJFTkRFUkJVRkZFUl9CTFVFX1NJWkU6MzYxNzgsUkVOREVSQlVGRkVSX0FMUEhBX1NJWkU6MzYxNzksUkVOREVSQlVGRkVSX0RFUFRIX1NJWkU6MzYxODAsUkVOREVSQlVGRkVSX1NURU5DSUxfU0laRTozNjE4MSxGUkFNRUJVRkZFUl9BVFRBQ0hNRU5UX09CSkVDVF9UWVBFOjM2MDQ4LEZSQU1FQlVGRkVSX0FUVEFDSE1FTlRfT0JKRUNUX05BTUU6MzYwNDksRlJBTUVCVUZGRVJfQVRUQUNITUVOVF9URVhUVVJFX0xFVkVMOjM2MDUwLEZSQU1FQlVGRkVSX0FUVEFDSE1FTlRfVEVYVFVSRV9DVUJFX01BUF9GQUNFOjM2MDUxLENPTE9SX0FUVEFDSE1FTlQwOjM2MDY0LERFUFRIX0FUVEFDSE1FTlQ6MzYwOTYsU1RFTkNJTF9BVFRBQ0hNRU5UOjM2MTI4LERFUFRIX1NURU5DSUxfQVRUQUNITUVOVDozMzMwNixOT05FOjAsRlJBTUVCVUZGRVJfQ09NUExFVEU6MzYwNTMsRlJBTUVCVUZGRVJfSU5DT01QTEVURV9BVFRBQ0hNRU5UOjM2MDU0LEZSQU1FQlVGRkVSX0lOQ09NUExFVEVfTUlTU0lOR19BVFRBQ0hNRU5UOjM2MDU1LEZSQU1FQlVGRkVSX0lOQ09NUExFVEVfRElNRU5TSU9OUzozNjA1NyxGUkFNRUJVRkZFUl9VTlNVUFBPUlRFRDozNjA2MSxGUkFNRUJVRkZFUl9CSU5ESU5HOjM2MDA2LFJFTkRFUkJVRkZFUl9CSU5ESU5HOjM2MDA3LFJFQURfRlJBTUVCVUZGRVI6MzYwMDgsRFJBV19GUkFNRUJVRkZFUjozNjAwOSxNQVhfUkVOREVSQlVGRkVSX1NJWkU6MzQwMjQsSU5WQUxJRF9GUkFNRUJVRkZFUl9PUEVSQVRJT046MTI4NixVTlBBQ0tfRkxJUF9ZX1dFQkdMOjM3NDQwLFVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTDozNzQ0MSxVTlBBQ0tfQ09MT1JTUEFDRV9DT05WRVJTSU9OX1dFQkdMOjM3NDQzLFJFQURfQlVGRkVSOjMwNzQsVU5QQUNLX1JPV19MRU5HVEg6MzMxNCxVTlBBQ0tfU0tJUF9ST1dTOjMzMTUsVU5QQUNLX1NLSVBfUElYRUxTOjMzMTYsUEFDS19ST1dfTEVOR1RIOjMzMzAsUEFDS19TS0lQX1JPV1M6MzMzMSxQQUNLX1NLSVBfUElYRUxTOjMzMzIsVEVYVFVSRV9CSU5ESU5HXzNEOjMyODc0LFVOUEFDS19TS0lQX0lNQUdFUzozMjg3NyxVTlBBQ0tfSU1BR0VfSEVJR0hUOjMyODc4LE1BWF8zRF9URVhUVVJFX1NJWkU6MzI4ODMsTUFYX0VMRU1FTlRTX1ZFUlRJQ0VTOjMzZTMsTUFYX0VMRU1FTlRTX0lORElDRVM6MzMwMDEsTUFYX1RFWFRVUkVfTE9EX0JJQVM6MzQwNDUsTUFYX0ZSQUdNRU5UX1VOSUZPUk1fQ09NUE9ORU5UUzozNTY1NyxNQVhfVkVSVEVYX1VOSUZPUk1fQ09NUE9ORU5UUzozNTY1OCxNQVhfQVJSQVlfVEVYVFVSRV9MQVlFUlM6MzUwNzEsTUlOX1BST0dSQU1fVEVYRUxfT0ZGU0VUOjM1MDc2LE1BWF9QUk9HUkFNX1RFWEVMX09GRlNFVDozNTA3NyxNQVhfVkFSWUlOR19DT01QT05FTlRTOjM1NjU5LEZSQUdNRU5UX1NIQURFUl9ERVJJVkFUSVZFX0hJTlQ6MzU3MjMsUkFTVEVSSVpFUl9ESVNDQVJEOjM1OTc3LFZFUlRFWF9BUlJBWV9CSU5ESU5HOjM0MjI5LE1BWF9WRVJURVhfT1VUUFVUX0NPTVBPTkVOVFM6MzcxNTQsTUFYX0ZSQUdNRU5UX0lOUFVUX0NPTVBPTkVOVFM6MzcxNTcsTUFYX1NFUlZFUl9XQUlUX1RJTUVPVVQ6MzcxMzcsTUFYX0VMRU1FTlRfSU5ERVg6MzYyMDMsUkVEOjY0MDMsUkdCODozMjg0OSxSR0JBODozMjg1NixSR0IxMF9BMjozMjg1NyxURVhUVVJFXzNEOjMyODc5LFRFWFRVUkVfV1JBUF9SOjMyODgyLFRFWFRVUkVfTUlOX0xPRDozMzA4MixURVhUVVJFX01BWF9MT0Q6MzMwODMsVEVYVFVSRV9CQVNFX0xFVkVMOjMzMDg0LFRFWFRVUkVfTUFYX0xFVkVMOjMzMDg1LFRFWFRVUkVfQ09NUEFSRV9NT0RFOjM0ODkyLFRFWFRVUkVfQ09NUEFSRV9GVU5DOjM0ODkzLFNSR0I6MzU5MDQsU1JHQjg6MzU5MDUsU1JHQjhfQUxQSEE4OjM1OTA3LENPTVBBUkVfUkVGX1RPX1RFWFRVUkU6MzQ4OTQsUkdCQTMyRjozNDgzNixSR0IzMkY6MzQ4MzcsUkdCQTE2RjozNDg0MixSR0IxNkY6MzQ4NDMsVEVYVFVSRV8yRF9BUlJBWTozNTg2NixURVhUVVJFX0JJTkRJTkdfMkRfQVJSQVk6MzU4NjksUjExRl9HMTFGX0IxMEY6MzU4OTgsUkdCOV9FNTozNTkwMSxSR0JBMzJVSTozNjIwOCxSR0IzMlVJOjM2MjA5LFJHQkExNlVJOjM2MjE0LFJHQjE2VUk6MzYyMTUsUkdCQThVSTozNjIyMCxSR0I4VUk6MzYyMjEsUkdCQTMySTozNjIyNixSR0IzMkk6MzYyMjcsUkdCQTE2STozNjIzMixSR0IxNkk6MzYyMzMsUkdCQThJOjM2MjM4LFJHQjhJOjM2MjM5LFJFRF9JTlRFR0VSOjM2MjQ0LFJHQl9JTlRFR0VSOjM2MjQ4LFJHQkFfSU5URUdFUjozNjI0OSxSODozMzMyMSxSRzg6MzMzMjMsUjE2RjozMzMyNSxSMzJGOjMzMzI2LFJHMTZGOjMzMzI3LFJHMzJGOjMzMzI4LFI4STozMzMyOSxSOFVJOjMzMzMwLFIxNkk6MzMzMzEsUjE2VUk6MzMzMzIsUjMySTozMzMzMyxSMzJVSTozMzMzNCxSRzhJOjMzMzM1LFJHOFVJOjMzMzM2LFJHMTZJOjMzMzM3LFJHMTZVSTozMzMzOCxSRzMySTozMzMzOSxSRzMyVUk6MzMzNDAsUjhfU05PUk06MzY3NTYsUkc4X1NOT1JNOjM2NzU3LFJHQjhfU05PUk06MzY3NTgsUkdCQThfU05PUk06MzY3NTksUkdCMTBfQTJVSTozNjk3NSxURVhUVVJFX0lNTVVUQUJMRV9GT1JNQVQ6MzcxNjcsVEVYVFVSRV9JTU1VVEFCTEVfTEVWRUxTOjMzNTAzLFVOU0lHTkVEX0lOVF8yXzEwXzEwXzEwX1JFVjozMzY0MCxVTlNJR05FRF9JTlRfMTBGXzExRl8xMUZfUkVWOjM1ODk5LFVOU0lHTkVEX0lOVF81XzlfOV85X1JFVjozNTkwMixGTE9BVF8zMl9VTlNJR05FRF9JTlRfMjRfOF9SRVY6MzYyNjksVU5TSUdORURfSU5UXzI0Xzg6MzQwNDIsSEFMRl9GTE9BVDo1MTMxLFJHOjMzMzE5LFJHX0lOVEVHRVI6MzMzMjAsSU5UXzJfMTBfMTBfMTBfUkVWOjM2MjU1LENVUlJFTlRfUVVFUlk6MzQ5MTcsUVVFUllfUkVTVUxUOjM0OTE4LFFVRVJZX1JFU1VMVF9BVkFJTEFCTEU6MzQ5MTksQU5ZX1NBTVBMRVNfUEFTU0VEOjM1ODg3LEFOWV9TQU1QTEVTX1BBU1NFRF9DT05TRVJWQVRJVkU6MzYyMDIsTUFYX0RSQVdfQlVGRkVSUzozNDg1MixEUkFXX0JVRkZFUjA6MzQ4NTMsRFJBV19CVUZGRVIxOjM0ODU0LERSQVdfQlVGRkVSMjozNDg1NSxEUkFXX0JVRkZFUjM6MzQ4NTYsRFJBV19CVUZGRVI0OjM0ODU3LERSQVdfQlVGRkVSNTozNDg1OCxEUkFXX0JVRkZFUjY6MzQ4NTksRFJBV19CVUZGRVI3OjM0ODYwLERSQVdfQlVGRkVSODozNDg2MSxEUkFXX0JVRkZFUjk6MzQ4NjIsRFJBV19CVUZGRVIxMDozNDg2MyxEUkFXX0JVRkZFUjExOjM0ODY0LERSQVdfQlVGRkVSMTI6MzQ4NjUsRFJBV19CVUZGRVIxMzozNDg2NixEUkFXX0JVRkZFUjE0OjM0ODY3LERSQVdfQlVGRkVSMTU6MzQ4NjgsTUFYX0NPTE9SX0FUVEFDSE1FTlRTOjM2MDYzLENPTE9SX0FUVEFDSE1FTlQxOjM2MDY1LENPTE9SX0FUVEFDSE1FTlQyOjM2MDY2LENPTE9SX0FUVEFDSE1FTlQzOjM2MDY3LENPTE9SX0FUVEFDSE1FTlQ0OjM2MDY4LENPTE9SX0FUVEFDSE1FTlQ1OjM2MDY5LENPTE9SX0FUVEFDSE1FTlQ2OjM2MDcwLENPTE9SX0FUVEFDSE1FTlQ3OjM2MDcxLENPTE9SX0FUVEFDSE1FTlQ4OjM2MDcyLENPTE9SX0FUVEFDSE1FTlQ5OjM2MDczLENPTE9SX0FUVEFDSE1FTlQxMDozNjA3NCxDT0xPUl9BVFRBQ0hNRU5UMTE6MzYwNzUsQ09MT1JfQVRUQUNITUVOVDEyOjM2MDc2LENPTE9SX0FUVEFDSE1FTlQxMzozNjA3NyxDT0xPUl9BVFRBQ0hNRU5UMTQ6MzYwNzgsQ09MT1JfQVRUQUNITUVOVDE1OjM2MDc5LFNBTVBMRVJfM0Q6MzU2NzksU0FNUExFUl8yRF9TSEFET1c6MzU2ODIsU0FNUExFUl8yRF9BUlJBWTozNjI4OSxTQU1QTEVSXzJEX0FSUkFZX1NIQURPVzozNjI5MixTQU1QTEVSX0NVQkVfU0hBRE9XOjM2MjkzLElOVF9TQU1QTEVSXzJEOjM2Mjk4LElOVF9TQU1QTEVSXzNEOjM2Mjk5LElOVF9TQU1QTEVSX0NVQkU6MzYzMDAsSU5UX1NBTVBMRVJfMkRfQVJSQVk6MzYzMDMsVU5TSUdORURfSU5UX1NBTVBMRVJfMkQ6MzYzMDYsVU5TSUdORURfSU5UX1NBTVBMRVJfM0Q6MzYzMDcsVU5TSUdORURfSU5UX1NBTVBMRVJfQ1VCRTozNjMwOCxVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWTozNjMxMSxNQVhfU0FNUExFUzozNjE4MyxTQU1QTEVSX0JJTkRJTkc6MzUwOTcsUElYRUxfUEFDS19CVUZGRVI6MzUwNTEsUElYRUxfVU5QQUNLX0JVRkZFUjozNTA1MixQSVhFTF9QQUNLX0JVRkZFUl9CSU5ESU5HOjM1MDUzLFBJWEVMX1VOUEFDS19CVUZGRVJfQklORElORzozNTA1NSxDT1BZX1JFQURfQlVGRkVSOjM2NjYyLENPUFlfV1JJVEVfQlVGRkVSOjM2NjYzLENPUFlfUkVBRF9CVUZGRVJfQklORElORzozNjY2MixDT1BZX1dSSVRFX0JVRkZFUl9CSU5ESU5HOjM2NjYzLEZMT0FUX01BVDJ4MzozNTY4NSxGTE9BVF9NQVQyeDQ6MzU2ODYsRkxPQVRfTUFUM3gyOjM1Njg3LEZMT0FUX01BVDN4NDozNTY4OCxGTE9BVF9NQVQ0eDI6MzU2ODksRkxPQVRfTUFUNHgzOjM1NjkwLFVOU0lHTkVEX0lOVF9WRUMyOjM2Mjk0LFVOU0lHTkVEX0lOVF9WRUMzOjM2Mjk1LFVOU0lHTkVEX0lOVF9WRUM0OjM2Mjk2LFVOU0lHTkVEX05PUk1BTElaRUQ6MzU4NjMsU0lHTkVEX05PUk1BTElaRUQ6MzY3NjQsVkVSVEVYX0FUVFJJQl9BUlJBWV9JTlRFR0VSOjM1MDY5LFZFUlRFWF9BVFRSSUJfQVJSQVlfRElWSVNPUjozNTA3MCxUUkFOU0ZPUk1fRkVFREJBQ0tfQlVGRkVSX01PREU6MzU5NjcsTUFYX1RSQU5TRk9STV9GRUVEQkFDS19TRVBBUkFURV9DT01QT05FTlRTOjM1OTY4LFRSQU5TRk9STV9GRUVEQkFDS19WQVJZSU5HUzozNTk3MSxUUkFOU0ZPUk1fRkVFREJBQ0tfQlVGRkVSX1NUQVJUOjM1OTcyLFRSQU5TRk9STV9GRUVEQkFDS19CVUZGRVJfU0laRTozNTk3MyxUUkFOU0ZPUk1fRkVFREJBQ0tfUFJJTUlUSVZFU19XUklUVEVOOjM1OTc2LE1BWF9UUkFOU0ZPUk1fRkVFREJBQ0tfSU5URVJMRUFWRURfQ09NUE9ORU5UUzozNTk3OCxNQVhfVFJBTlNGT1JNX0ZFRURCQUNLX1NFUEFSQVRFX0FUVFJJQlM6MzU5NzksSU5URVJMRUFWRURfQVRUUklCUzozNTk4MCxTRVBBUkFURV9BVFRSSUJTOjM1OTgxLFRSQU5TRk9STV9GRUVEQkFDS19CVUZGRVI6MzU5ODIsVFJBTlNGT1JNX0ZFRURCQUNLX0JVRkZFUl9CSU5ESU5HOjM1OTgzLFRSQU5TRk9STV9GRUVEQkFDSzozNjM4NixUUkFOU0ZPUk1fRkVFREJBQ0tfUEFVU0VEOjM2Mzg3LFRSQU5TRk9STV9GRUVEQkFDS19BQ1RJVkU6MzYzODgsVFJBTlNGT1JNX0ZFRURCQUNLX0JJTkRJTkc6MzYzODksRlJBTUVCVUZGRVJfQVRUQUNITUVOVF9DT0xPUl9FTkNPRElORzozMzI5NixGUkFNRUJVRkZFUl9BVFRBQ0hNRU5UX0NPTVBPTkVOVF9UWVBFOjMzMjk3LEZSQU1FQlVGRkVSX0FUVEFDSE1FTlRfUkVEX1NJWkU6MzMyOTgsRlJBTUVCVUZGRVJfQVRUQUNITUVOVF9HUkVFTl9TSVpFOjMzMjk5LEZSQU1FQlVGRkVSX0FUVEFDSE1FTlRfQkxVRV9TSVpFOjMzMzAwLEZSQU1FQlVGRkVSX0FUVEFDSE1FTlRfQUxQSEFfU0laRTozMzMwMSxGUkFNRUJVRkZFUl9BVFRBQ0hNRU5UX0RFUFRIX1NJWkU6MzMzMDIsRlJBTUVCVUZGRVJfQVRUQUNITUVOVF9TVEVOQ0lMX1NJWkU6MzMzMDMsRlJBTUVCVUZGRVJfREVGQVVMVDozMzMwNCxERVBUSDI0X1NURU5DSUw4OjM1MDU2LERSQVdfRlJBTUVCVUZGRVJfQklORElORzozNjAwNixSRUFEX0ZSQU1FQlVGRkVSX0JJTkRJTkc6MzYwMTAsUkVOREVSQlVGRkVSX1NBTVBMRVM6MzYwMTEsRlJBTUVCVUZGRVJfQVRUQUNITUVOVF9URVhUVVJFX0xBWUVSOjM2MDUyLEZSQU1FQlVGRkVSX0lOQ09NUExFVEVfTVVMVElTQU1QTEU6MzYxODIsVU5JRk9STV9CVUZGRVI6MzUzNDUsVU5JRk9STV9CVUZGRVJfQklORElORzozNTM2OCxVTklGT1JNX0JVRkZFUl9TVEFSVDozNTM2OSxVTklGT1JNX0JVRkZFUl9TSVpFOjM1MzcwLE1BWF9WRVJURVhfVU5JRk9STV9CTE9DS1M6MzUzNzEsTUFYX0ZSQUdNRU5UX1VOSUZPUk1fQkxPQ0tTOjM1MzczLE1BWF9DT01CSU5FRF9VTklGT1JNX0JMT0NLUzozNTM3NCxNQVhfVU5JRk9STV9CVUZGRVJfQklORElOR1M6MzUzNzUsTUFYX1VOSUZPUk1fQkxPQ0tfU0laRTozNTM3NixNQVhfQ09NQklORURfVkVSVEVYX1VOSUZPUk1fQ09NUE9ORU5UUzozNTM3NyxNQVhfQ09NQklORURfRlJBR01FTlRfVU5JRk9STV9DT01QT05FTlRTOjM1Mzc5LFVOSUZPUk1fQlVGRkVSX09GRlNFVF9BTElHTk1FTlQ6MzUzODAsQUNUSVZFX1VOSUZPUk1fQkxPQ0tTOjM1MzgyLFVOSUZPUk1fVFlQRTozNTM4MyxVTklGT1JNX1NJWkU6MzUzODQsVU5JRk9STV9CTE9DS19JTkRFWDozNTM4NixVTklGT1JNX09GRlNFVDozNTM4NyxVTklGT1JNX0FSUkFZX1NUUklERTozNTM4OCxVTklGT1JNX01BVFJJWF9TVFJJREU6MzUzODksVU5JRk9STV9JU19ST1dfTUFKT1I6MzUzOTAsVU5JRk9STV9CTE9DS19CSU5ESU5HOjM1MzkxLFVOSUZPUk1fQkxPQ0tfREFUQV9TSVpFOjM1MzkyLFVOSUZPUk1fQkxPQ0tfQUNUSVZFX1VOSUZPUk1TOjM1Mzk0LFVOSUZPUk1fQkxPQ0tfQUNUSVZFX1VOSUZPUk1fSU5ESUNFUzozNTM5NSxVTklGT1JNX0JMT0NLX1JFRkVSRU5DRURfQllfVkVSVEVYX1NIQURFUjozNTM5NixVTklGT1JNX0JMT0NLX1JFRkVSRU5DRURfQllfRlJBR01FTlRfU0hBREVSOjM1Mzk4LE9CSkVDVF9UWVBFOjM3MTM4LFNZTkNfQ09ORElUSU9OOjM3MTM5LFNZTkNfU1RBVFVTOjM3MTQwLFNZTkNfRkxBR1M6MzcxNDEsU1lOQ19GRU5DRTozNzE0MixTWU5DX0dQVV9DT01NQU5EU19DT01QTEVURTozNzE0MyxVTlNJR05BTEVEOjM3MTQ0LFNJR05BTEVEOjM3MTQ1LEFMUkVBRFlfU0lHTkFMRUQ6MzcxNDYsVElNRU9VVF9FWFBJUkVEOjM3MTQ3LENPTkRJVElPTl9TQVRJU0ZJRUQ6MzcxNDgsV0FJVF9GQUlMRUQ6MzcxNDksU1lOQ19GTFVTSF9DT01NQU5EU19CSVQ6MSxDT0xPUjo2MTQ0LERFUFRIOjYxNDUsU1RFTkNJTDo2MTQ2LE1JTjozMjc3NSxNQVg6MzI3NzYsREVQVEhfQ09NUE9ORU5UMjQ6MzMxOTAsU1RSRUFNX1JFQUQ6MzUwNDEsU1RSRUFNX0NPUFk6MzUwNDIsU1RBVElDX1JFQUQ6MzUwNDUsU1RBVElDX0NPUFk6MzUwNDYsRFlOQU1JQ19SRUFEOjM1MDQ5LERZTkFNSUNfQ09QWTozNTA1MCxERVBUSF9DT01QT05FTlQzMkY6MzYwMTIsREVQVEgzMkZfU1RFTkNJTDg6MzYwMTMsSU5WQUxJRF9JTkRFWDo0Mjk0OTY3Mjk1LFRJTUVPVVRfSUdOT1JFRDotMSxNQVhfQ0xJRU5UX1dBSVRfVElNRU9VVF9XRUJHTDozNzQ0NyxWRVJURVhfQVRUUklCX0FSUkFZX0RJVklTT1JfQU5HTEU6MzUwNzAsVU5NQVNLRURfVkVORE9SX1dFQkdMOjM3NDQ1LFVOTUFTS0VEX1JFTkRFUkVSX1dFQkdMOjM3NDQ2LE1BWF9URVhUVVJFX01BWF9BTklTT1RST1BZX0VYVDozNDA0NyxURVhUVVJFX01BWF9BTklTT1RST1BZX0VYVDozNDA0NixDT01QUkVTU0VEX1JHQl9TM1RDX0RYVDFfRVhUOjMzNzc2LENPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDFfRVhUOjMzNzc3LENPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDNfRVhUOjMzNzc4LENPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDVfRVhUOjMzNzc5LENPTVBSRVNTRURfUjExX0VBQzozNzQ4OCxDT01QUkVTU0VEX1NJR05FRF9SMTFfRUFDOjM3NDg5LENPTVBSRVNTRURfUkcxMV9FQUM6Mzc0OTAsQ09NUFJFU1NFRF9TSUdORURfUkcxMV9FQUM6Mzc0OTEsQ09NUFJFU1NFRF9SR0I4X0VUQzI6Mzc0OTIsQ09NUFJFU1NFRF9SR0JBOF9FVEMyX0VBQzozNzQ5MyxDT01QUkVTU0VEX1NSR0I4X0VUQzI6Mzc0OTQsQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfRVRDMl9FQUM6Mzc0OTUsQ09NUFJFU1NFRF9SR0I4X1BVTkNIVEhST1VHSF9BTFBIQTFfRVRDMjozNzQ5NixDT01QUkVTU0VEX1NSR0I4X1BVTkNIVEhST1VHSF9BTFBIQTFfRVRDMjozNzQ5NyxDT01QUkVTU0VEX1JHQl9QVlJUQ180QlBQVjFfSU1HOjM1ODQwLENPTVBSRVNTRURfUkdCQV9QVlJUQ180QlBQVjFfSU1HOjM1ODQyLENPTVBSRVNTRURfUkdCX1BWUlRDXzJCUFBWMV9JTUc6MzU4NDEsQ09NUFJFU1NFRF9SR0JBX1BWUlRDXzJCUFBWMV9JTUc6MzU4NDMsQ09NUFJFU1NFRF9SR0JfRVRDMV9XRUJHTDozNjE5NixDT01QUkVTU0VEX1JHQl9BVENfV0VCR0w6MzU5ODYsQ09NUFJFU1NFRF9SR0JBX0FUQ19FWFBMSUNJVF9BTFBIQV9XRUJHTDozNTk4NixDT01QUkVTU0VEX1JHQkFfQVRDX0lOVEVSUE9MQVRFRF9BTFBIQV9XRUJHTDozNDc5OCxVTlNJR05FRF9JTlRfMjRfOF9XRUJHTDozNDA0MixIQUxGX0ZMT0FUX09FUzozNjE5MyxSR0JBMzJGX0VYVDozNDgzNixSR0IzMkZfRVhUOjM0ODM3LEZSQU1FQlVGRkVSX0FUVEFDSE1FTlRfQ09NUE9ORU5UX1RZUEVfRVhUOjMzMjk3LFVOU0lHTkVEX05PUk1BTElaRURfRVhUOjM1ODYzLE1JTl9FWFQ6MzI3NzUsTUFYX0VYVDozMjc3NixTUkdCX0VYVDozNTkwNCxTUkdCX0FMUEhBX0VYVDozNTkwNixTUkdCOF9BTFBIQThfRVhUOjM1OTA3LEZSQU1FQlVGRkVSX0FUVEFDSE1FTlRfQ09MT1JfRU5DT0RJTkdfRVhUOjMzMjk2LEZSQUdNRU5UX1NIQURFUl9ERVJJVkFUSVZFX0hJTlRfT0VTOjM1NzIzLENPTE9SX0FUVEFDSE1FTlQwX1dFQkdMOjM2MDY0LENPTE9SX0FUVEFDSE1FTlQxX1dFQkdMOjM2MDY1LENPTE9SX0FUVEFDSE1FTlQyX1dFQkdMOjM2MDY2LENPTE9SX0FUVEFDSE1FTlQzX1dFQkdMOjM2MDY3LENPTE9SX0FUVEFDSE1FTlQ0X1dFQkdMOjM2MDY4LENPTE9SX0FUVEFDSE1FTlQ1X1dFQkdMOjM2MDY5LENPTE9SX0FUVEFDSE1FTlQ2X1dFQkdMOjM2MDcwLENPTE9SX0FUVEFDSE1FTlQ3X1dFQkdMOjM2MDcxLENPTE9SX0FUVEFDSE1FTlQ4X1dFQkdMOjM2MDcyLENPTE9SX0FUVEFDSE1FTlQ5X1dFQkdMOjM2MDczLENPTE9SX0FUVEFDSE1FTlQxMF9XRUJHTDozNjA3NCxDT0xPUl9BVFRBQ0hNRU5UMTFfV0VCR0w6MzYwNzUsQ09MT1JfQVRUQUNITUVOVDEyX1dFQkdMOjM2MDc2LENPTE9SX0FUVEFDSE1FTlQxM19XRUJHTDozNjA3NyxDT0xPUl9BVFRBQ0hNRU5UMTRfV0VCR0w6MzYwNzgsQ09MT1JfQVRUQUNITUVOVDE1X1dFQkdMOjM2MDc5LERSQVdfQlVGRkVSMF9XRUJHTDozNDg1MyxEUkFXX0JVRkZFUjFfV0VCR0w6MzQ4NTQsRFJBV19CVUZGRVIyX1dFQkdMOjM0ODU1LERSQVdfQlVGRkVSM19XRUJHTDozNDg1NixEUkFXX0JVRkZFUjRfV0VCR0w6MzQ4NTcsRFJBV19CVUZGRVI1X1dFQkdMOjM0ODU4LERSQVdfQlVGRkVSNl9XRUJHTDozNDg1OSxEUkFXX0JVRkZFUjdfV0VCR0w6MzQ4NjAsRFJBV19CVUZGRVI4X1dFQkdMOjM0ODYxLERSQVdfQlVGRkVSOV9XRUJHTDozNDg2MixEUkFXX0JVRkZFUjEwX1dFQkdMOjM0ODYzLERSQVdfQlVGRkVSMTFfV0VCR0w6MzQ4NjQsRFJBV19CVUZGRVIxMl9XRUJHTDozNDg2NSxEUkFXX0JVRkZFUjEzX1dFQkdMOjM0ODY2LERSQVdfQlVGRkVSMTRfV0VCR0w6MzQ4NjcsRFJBV19CVUZGRVIxNV9XRUJHTDozNDg2OCxNQVhfQ09MT1JfQVRUQUNITUVOVFNfV0VCR0w6MzYwNjMsTUFYX0RSQVdfQlVGRkVSU19XRUJHTDozNDg1MixWRVJURVhfQVJSQVlfQklORElOR19PRVM6MzQyMjksUVVFUllfQ09VTlRFUl9CSVRTX0VYVDozNDkxNixDVVJSRU5UX1FVRVJZX0VYVDozNDkxNyxRVUVSWV9SRVNVTFRfRVhUOjM0OTE4LFFVRVJZX1JFU1VMVF9BVkFJTEFCTEVfRVhUOjM0OTE5LFRJTUVfRUxBUFNFRF9FWFQ6MzUwMDcsVElNRVNUQU1QX0VYVDozNjM5MixHUFVfRElTSk9JTlRfRVhUOjM2Nzk1fTt2YXIgVTA9e1tTLlRFWFRVUkVfTUlOX0ZJTFRFUl06Uy5ORUFSRVNULFtTLlRFWFRVUkVfTUFHX0ZJTFRFUl06Uy5ORUFSRVNULFtTLlRFWFRVUkVfV1JBUF9TXTpTLkNMQU1QX1RPX0VER0UsW1MuVEVYVFVSRV9XUkFQX1RdOlMuQ0xBTVBfVE9fRURHRX07ZnVuY3Rpb24gR0UoRSx7dGlsZVNpemU6Xyx0aWxlSTpSLHRpbGVKOlQsbnVtQ2VsbHM6TixudW1HZW5lczp4LGNlbGxPcmRlcmluZzpPLGNlbGxzOkN9KXtsZXQgZT1uZXcgVWludDhBcnJheShfKl8pLEwsTSxJLEIsRixVPSgwLFguZGVmYXVsdCkoXyk7cmV0dXJuIFUuZm9yRWFjaChEPT57ST1UKl8rRCxJPE4mJihGPUMuaW5kZXhPZihPW0ldKSxGPj0tMSYmVS5mb3JFYWNoKHQ9PntCPVIqXyt0LE09RVtGKngrQl0sTD0oXy10LTEpKl8rRCxlW0xdPU19KSl9KSxlfWZ1bmN0aW9uIHJFKEUse3RpbGVTaXplOl8sdGlsZUk6Uix0aWxlSjpULG51bUNlbGxzOk4sbnVtR2VuZXM6eCxjZWxsT3JkZXJpbmc6TyxjZWxsczpDfSl7bGV0IGU9bmV3IFVpbnQ4QXJyYXkoXypfKSxMLE0sSSxCLEYsVT0oMCxYLmRlZmF1bHQpKF8pO3JldHVybiBVLmZvckVhY2goRD0+e0k9UipfK0QsSTxOJiYoRj1DLmluZGV4T2YoT1tJXSksRj49LTEmJlUuZm9yRWFjaCh0PT57Qj1UKl8rdCxCPHg/TT1FW0YqeCtCXTpNPTAsTD0oXy1ELTEpKl8rdCxlW0xdPU19KSl9KSxlfWZ1bmN0aW9uIFpfKHtjdXJyOkUsdGlsZUk6Xyx0aWxlSjpSLHRpbGVTaXplOlQsY2VsbE9yZGVyaW5nOk4scm93czp4LGNvbHM6TyxkYXRhOkMsdHJhbnNwb3NlOmV9KXtsZXQgTD1uZXcgVWludDhBcnJheShDKSxNPU8ubGVuZ3RoLEk9Ti5sZW5ndGg7cmV0dXJuW3t0aWxlOihlP0dFOnJFKShMLHt0aWxlU2l6ZTpULHRpbGVJOl8sdGlsZUo6UixudW1DZWxsczpJLG51bUdlbmVzOk0sY2VsbE9yZGVyaW5nOk4sY2VsbHM6eH0pLGJ1ZmZlcjpDLGN1cnI6RX0sW0NdXX1pZih0eXBlb2Ygc2VsZiE9InVuZGVmaW5lZCIpe2xldCBFPXtnZXRUaWxlOlpffTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLF89Pnt0cnl7bGV0W1IsVF09Xy5kYXRhLFtOLHhdPUVbUl0oVCk7c2VsZi5wb3N0TWVzc2FnZShOLHgpfWNhdGNoKFIpe2NvbnNvbGUud2FybihSKX19KX19KSgpOwo=\";\nconst blob = typeof window !== \"undefined\" && window.Blob && new Blob([atob(encodedJs)], { type: \"text/javascript;charset=utf-8\" });\nexport default function() {\n  const objURL = blob && (window.URL || window.webkitURL).createObjectURL(blob);\n  try {\n    return objURL ? new Worker(objURL) : new Worker(\"data:application/javascript;base64,\" + encodedJs, {type: \"module\"});\n  } finally {\n    objURL && (window.URL || window.webkitURL).revokeObjectURL(objURL);\n  }\n}", "// https://developer.mozilla.org/en-US/docs/Web/API/NavigatorConcurrentHardware/hardwareConcurrency\n// We need to give a different way of getting this for safari, so 4 is probably a safe bet\n// for parallel processing in the meantime.  More can't really hurt since they'll just block\n// each other and not the UI thread, which is the real benefit.\nconst defaultPoolSize = typeof navigator !== 'undefined' ? navigator.hardwareConcurrency || 4 : null;\n\n/**\n * Pool for workers to decode chunks of the images.\n * This is a line-for-line copy of GeoTIFFs old implementation: https://github.com/geotiffjs/geotiff.js/blob/v1.0.0-beta.6/src/pool.js\n */\nexport default class Pool {\n  /**\n   * @constructor\n   * @param {object} Worker The worker class to be used for processing.\n   */\n  constructor(Worker) {\n    this.workers = [];\n    this.idleWorkers = [];\n    this.waitQueue = [];\n    this.decoder = null;\n\n    // eslint-disable-next-line no-plusplus\n    for (let i = 0; i < defaultPoolSize; ++i) {\n      const w = new Worker();\n      this.workers.push(w);\n      this.idleWorkers.push(w);\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  async process() {\n    throw new Error('Pool needs to implement \"process\" method');\n  }\n\n  async waitForWorker() {\n    const idleWorker = this.idleWorkers.pop();\n    if (idleWorker) {\n      return idleWorker;\n    }\n    const waiter = {};\n    const promise = new Promise((resolve) => {\n      waiter.resolve = resolve;\n    });\n\n    this.waitQueue.push(waiter);\n    return promise;\n  }\n\n  async finishTask(currentWorker) {\n    const waiter = this.waitQueue.pop();\n    if (waiter) {\n      waiter.resolve(currentWorker);\n    } else {\n      this.idleWorkers.push(currentWorker);\n    }\n  }\n\n  destroy() {\n    // eslint-disable-next-line no-plusplus\n    for (let i = 0; i < this.workers.length; ++i) {\n      this.workers[i].terminate();\n    }\n  }\n}\n", "import Worker from './heatmap.worker'; // eslint-disable-line import/no-unresolved\nimport Pool from '../../Pool';\n\n/**\n * Pool for workers to decode chunks of the images.\n * This is a line-for-line copy of GeoTIFFs old implementation: https://github.com/geotiffjs/geotiff.js/blob/v1.0.0-beta.6/src/pool.js\n */\nexport default class HeatmapPool extends Pool {\n  constructor() {\n    super(Worker);\n  }\n\n  /**\n   * Process each heatmap tile\n   * @param {object} params The arguments passed to the heatmap worker.\n   * @param {string} params.curr The current task uuid.\n   * @param {number} params.xTiles How many tiles required in the x direction?\n   * @param {number} params.yTiles How many tiles required in the y direction?\n   * @param {number} params.tileSize How many entries along each tile axis?\n   * @param {string[]} params.cellOrdering The current ordering of cells.\n   * @param {string[]} params.rows The name of each row (cell ID).\n   * Does not take transpose into account (always cells).\n   * @param {string[]} params.cols The name of each column (gene ID).\n   * Does not take transpose into account (always genes).\n   * @param {ArrayBuffer} params.data The array buffer.\n   * Need to transfer back to main thread when done.\n   * @param {boolean} params.transpose Is the heatmap transposed?\n   * @returns {array} [message, transfers]\n   * @returns {Promise.<ArrayBuffer>} the decoded result as a `Promise`\n   */\n  async process(args) {\n    const currentWorker = await this.waitForWorker();\n    return new Promise((resolve, reject) => {\n      currentWorker.onmessage = (event) => {\n        // this.workers.push(currentWorker);\n        this.finishTask(currentWorker);\n        resolve(event.data);\n      };\n      currentWorker.onerror = (error) => {\n        // this.workers.push(currentWorker);\n        this.finishTask(currentWorker);\n        reject(error);\n      };\n      currentWorker.postMessage(['getTile', args], [args.data]);\n    });\n  }\n}\n", "import React from 'react';\nimport Tooltip2D from '../tooltip/Tooltip2D';\nimport TooltipContent from '../tooltip/TooltipContent';\nimport { useComponentHover, useComponentViewInfo } from '../../app/state/hooks';\n\nexport default function HeatmapTooltipSubscriber(props) {\n  const {\n    parentUuid,\n    width, height, transpose,\n    getCellInfo, getGeneInfo,\n    cellHighlight, geneHighlight,\n  } = props;\n\n  const sourceUuid = useComponentHover();\n  const viewInfo = useComponentViewInfo(parentUuid);\n\n  const [cellInfo, cellCoord] = (cellHighlight && getCellInfo ? (\n    [\n      getCellInfo(cellHighlight),\n      (viewInfo && viewInfo.project\n        ? viewInfo.project(cellHighlight, null)[(transpose ? 0 : 1)]\n        : null),\n    ]\n  ) : ([null, null]));\n\n  const [geneInfo, geneCoord] = (geneHighlight && getGeneInfo ? (\n    [\n      getGeneInfo(geneHighlight),\n      (viewInfo && viewInfo.project\n        ? viewInfo.project(null, geneHighlight)[(transpose ? 1 : 0)]\n        : null),\n    ]\n  ) : ([null, null]));\n\n  const x = (transpose ? cellCoord : geneCoord);\n  const y = (transpose ? geneCoord : cellCoord);\n\n  return (\n    (cellInfo || geneInfo ? (\n      <Tooltip2D\n        x={x}\n        y={y}\n        parentUuid={parentUuid}\n        parentWidth={width}\n        parentHeight={height}\n        sourceUuid={sourceUuid}\n      >\n        <TooltipContent info={{ ...geneInfo, ...cellInfo }} />\n      </Tooltip2D>\n    ) : null)\n  );\n}\n", "import React from 'react';\nimport Tooltip from './Tooltip';\n\n/**\n * A tooltip component that also incorporates a crosshair element.\n * @param {object} props\n * @param {string} props.parentUuid A unique identifier corresponding to the plot\n * with which this scatterplot is associated.\n * @param {string} props.sourceUuid A unique identifier corresponding to the plot\n * from which this tooltip originated.\n * @param {number} props.x The x coordinate for the tooltip.\n * @param {number} props.y The y coordinate for the tooltip.\n * @param {number} props.parentWidth The width of the parent plot container element.\n * @param {number} props.parentHeight The height of the parent plot container element.\n * @param {React.Component} props.children The tooltip contents as a react component.\n */\nexport default function Tooltip2D(props) {\n  const {\n    parentUuid,\n    sourceUuid,\n    x,\n    y,\n    parentWidth,\n    parentHeight,\n    children,\n  } = props;\n  // Check if out of bounds.\n  if (x < 0 || x > parentWidth || y < 0 || y > parentHeight) {\n    return null;\n  }\n  // Show tooltip or crosshair?\n  const isTooltipVisible = (parentUuid === sourceUuid);\n  const crosshairWidth = 1;\n  return (\n    <>\n      {isTooltipVisible ? (\n        <Tooltip\n          x={x}\n          y={y}\n          parentWidth={parentWidth}\n          parentHeight={parentHeight}\n        >\n          {children}\n        </Tooltip>\n      ) : (\n        <>\n          {x !== null ? (\n            <div\n              className=\"cell-emphasis-crosshair\"\n              style={{\n                left: `${x - crosshairWidth / 2}px`,\n                top: 0,\n                width: `${crosshairWidth}px`,\n                height: `${parentHeight}px`,\n              }}\n            />\n          ) : null}\n          {y !== null ? (\n            <div\n              className=\"cell-emphasis-crosshair\"\n              style={{\n                left: 0,\n                top: `${y - crosshairWidth / 2}px`,\n                width: `${parentWidth}px`,\n                height: `${crosshairWidth}px`,\n              }}\n            />\n          ) : null}\n        </>\n      )}\n    </>\n  );\n}\n", "import React, { useEffect, useRef, useState } from 'react';\nimport Paper from '@material-ui/core/Paper';\nimport Popper from '@material-ui/core/Popper';\nimport { useVitessceContainer } from '../hooks';\nimport { styles } from './styles';\n\nexport default function Tooltip(props) {\n  const {\n    x,\n    y,\n    parentWidth,\n    parentHeight,\n    children,\n  } = props;\n  const ref = useRef();\n  const classes = styles();\n  const [placementX, setPlacementX] = useState('start');\n  const [placementY, setPlacementY] = useState('bottom');\n\n  const getTooltipContainer = useVitessceContainer(ref);\n\n  // Do collision detection based on the bounds of the tooltip ancestor element.\n  useEffect(() => {\n    if (ref && ref.current) {\n      const flipX = (x > parentWidth / 2);\n      const flipY = (y > parentHeight / 2);\n      setPlacementX(flipX ? 'end' : 'start');\n      setPlacementY(flipY ? 'top' : 'bottom');\n      ref.current.style.left = `${x + (flipX ? -20 : 5)}px`;\n      ref.current.style.top = `${y + (flipY ? -20 : 5)}px`;\n    }\n  }, [x, y, parentWidth, parentHeight]);\n\n  return (\n    <div\n      ref={ref}\n      className={classes.tooltipAnchor}\n    >\n      {ref && ref.current ? (\n        <Popper\n          open\n          anchorEl={ref.current}\n          container={getTooltipContainer}\n          transition\n          placement={`${placementY}-${placementX}`}\n        >\n          <Paper elevation={4} className={classes.tooltipContent}>\n            {children}\n          </Paper>\n        </Popper>\n      ) : null}\n    </div>\n  );\n}\n", "import { makeStyles } from '@material-ui/core/styles';\n\nexport const styles = makeStyles(() => ({\n  tooltipAnchor: {\n    position: 'relative',\n    width: '0px',\n    height: '0px',\n    pointerEvents: 'none',\n    userSelect: 'none',\n  },\n  tooltipContent: {\n    opacity: 0.9,\n    padding: '5px',\n    pointerEvents: 'none',\n    '& table > tbody > tr > th, & table > tbody > tr > td': {\n      fontSize: '80%',\n      opacity: 0.8,\n      outline: 0,\n      padding: '0 2px',\n    },\n    '& table': {\n      borderCollapse: 'collapse',\n    },\n  },\n}));\n", "import React from 'react';\n\nexport default function TooltipContent(props) {\n  const {\n    info,\n  } = props;\n\n  return (\n    <table>\n      <tbody>\n        {Object.entries(info).map(([key, value]) => (\n          <tr key={key}>\n            <th>{key}</th>\n            <td>{value}</td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n}\n", "import React, { useCallback } from 'react';\nimport debounce from 'lodash/debounce';\nimport Slider from '@material-ui/core/Slider';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableRow from '@material-ui/core/TableRow';\nimport { useStyles } from '../shared-plot-options/styles';\nimport OptionsContainer from '../shared-plot-options/OptionsContainer';\nimport OptionSelect from '../shared-plot-options/OptionSelect';\nimport { GLSL_COLORMAPS } from '../../layers/constants';\n\nexport default function HeatmapOptions(props) {\n  const {\n    geneExpressionColormap,\n    setGeneExpressionColormap,\n    geneExpressionColormapRange,\n    setGeneExpressionColormapRange,\n  } = props;\n\n  const classes = useStyles();\n\n  function handleGeneExpressionColormapChange(event) {\n    setGeneExpressionColormap(event.target.value);\n  }\n\n  function handleColormapRangeChange(event, value) {\n    setGeneExpressionColormapRange(value);\n  }\n  const handleColormapRangeChangeDebounced = useCallback(\n    debounce(handleColormapRangeChange, 5, { trailing: true }),\n    [handleColormapRangeChange],\n  );\n\n  return (\n    <OptionsContainer>\n      <TableRow>\n        <TableCell className={classes.labelCell} htmlFor=\"gene-expression-colormap-select\">\n          Gene Expression Colormap\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <OptionSelect\n            className={classes.select}\n            value={geneExpressionColormap}\n            onChange={handleGeneExpressionColormapChange}\n            inputProps={{\n              id: 'gene-expression-colormap-select',\n            }}\n          >\n            {GLSL_COLORMAPS.map(cmap => (\n              <option key={cmap} value={cmap}>{cmap}</option>\n            ))}\n          </OptionSelect>\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell}>\n          Gene Expression Colormap Range\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <Slider\n            classes={{ root: classes.slider, valueLabel: classes.sliderValueLabel }}\n            value={geneExpressionColormapRange}\n            onChange={handleColormapRangeChangeDebounced}\n            aria-labelledby=\"gene-expression-colormap-range-slider\"\n            valueLabelDisplay=\"auto\"\n            step={0.005}\n            min={0.0}\n            max={1.0}\n          />\n        </TableCell>\n      </TableRow>\n    </OptionsContainer>\n  );\n}\n", "import { makeStyles } from '@material-ui/core/styles';\n\nexport const useStyles = makeStyles(theme => ({\n  box: {\n    boxSizing: 'border-box',\n  },\n  checkbox: {\n    padding: '3px',\n    color: theme.palette.primaryForeground,\n    '&:checked': {\n      color: theme.palette.primaryForeground,\n    },\n    '& input': {\n      height: '100%',\n    },\n  },\n  slider: {\n    color: theme.palette.primaryForeground,\n    minWidth: '60px',\n    padding: '10px 0 10px 0',\n  },\n  sliderValueLabel: {\n    '& span': {\n      '& span': {\n        color: theme.palette.primaryBackground,\n      },\n    },\n  },\n  tableContainer: {\n    overflow: 'hidden',\n    overflowX: 'hidden !important',\n  },\n  labelCell: {\n    padding: '2px 8px 2px 16px',\n  },\n  inputCell: {\n    padding: '2px 16px 2px 8px',\n    overflow: 'visible',\n  },\n  select: {\n    '& select': {\n      fontSize: '.875rem',\n    },\n  },\n  selectRoot: {\n    padding: 0,\n    height: 'auto',\n  },\n}));\n", "import React from 'react';\nimport Box from '@material-ui/core/Box';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport { useStyles } from './styles';\n\nexport default function OptionsContainer(props) {\n  const {\n    children,\n  } = props;\n\n  const classes = useStyles();\n\n  return (\n    <Box className={classes.box}>\n      <TableContainer className={classes.tableContainer}>\n        <Table className={classes.table} size=\"small\">\n          <TableBody>\n            {children}\n          </TableBody>\n        </Table>\n      </TableContainer>\n    </Box>\n  );\n}\n", "import React from 'react';\nimport Select from '@material-ui/core/Select';\nimport { useStyles } from './styles';\n\nexport default function OptionSelect(props) {\n  const { classes: classesProp = {} } = props;\n  const classes = useStyles();\n  return (\n    <Select\n      native\n      disableUnderline\n      {...props}\n      classes={{\n        root: classes.selectRoot,\n        ...classesProp,\n      }}\n    />\n  );\n}\n", "import React, { useEffect, useMemo, useCallback } from 'react';\nimport TitleInfo from '../TitleInfo';\nimport { capitalize } from '../../utils';\nimport {\n  useDeckCanvasSize, useReady, useUrls, useExpressionValueGetter,\n} from '../hooks';\nimport { setCellSelection, mergeCellSets, canLoadResolution } from '../utils';\nimport {\n  useCellsData,\n  useCellSetsData,\n  useGeneSelection,\n  useMoleculesData,\n  useNeighborhoodsData,\n  useRasterData,\n  useExpressionAttrs,\n} from '../data-hooks';\nimport { getCellColors } from '../interpolate-colors';\nimport Spatial from './Spatial';\nimport SpatialOptions from './SpatialOptions';\nimport SpatialTooltipSubscriber from './SpatialTooltipSubscriber';\nimport { makeSpatialSubtitle, getInitialSpatialTargets } from './utils';\nimport {\n  useCoordination,\n  useLoaders,\n  useSetComponentHover,\n  useSetComponentViewInfo,\n  useAuxiliaryCoordination,\n} from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\n\nconst SPATIAL_DATA_TYPES = [\n  'cells', 'molecules', 'raster', 'cell-sets', 'expression-matrix',\n];\n\n/**\n * A subscriber component for the spatial plot.\n * @param {object} props\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n */\nexport default function SpatialSubscriber(props) {\n  const {\n    uuid,\n    coordinationScopes,\n    removeGridComponent,\n    observationsLabelOverride: observationsLabel = 'cell',\n    observationsPluralLabelOverride: observationsPluralLabel = `${observationsLabel}s`,\n    subobservationsLabelOverride: subobservationsLabel = 'molecule',\n    subobservationsPluralLabelOverride: subobservationsPluralLabel = `${subobservationsLabel}s`,\n    theme,\n    disableTooltip = false,\n    title = 'Spatial',\n    disable3d,\n    globalDisable3d,\n  } = props;\n\n  const loaders = useLoaders();\n  const setComponentHover = useSetComponentHover();\n  const setComponentViewInfo = useSetComponentViewInfo(uuid);\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    spatialZoom: zoom,\n    spatialTargetX: targetX,\n    spatialTargetY: targetY,\n    spatialTargetZ: targetZ,\n    spatialRotationX: rotationX,\n    spatialRotationY: rotationY,\n    spatialRotationZ: rotationZ,\n    spatialRotationOrbit: rotationOrbit,\n    spatialOrbitAxis: orbitAxis,\n    spatialRasterLayers: rasterLayers,\n    spatialCellsLayer: cellsLayer,\n    spatialMoleculesLayer: moleculesLayer,\n    spatialNeighborhoodsLayer: neighborhoodsLayer,\n    cellFilter,\n    cellHighlight,\n    geneSelection,\n    cellSetSelection,\n    cellSetColor,\n    cellColorEncoding,\n    additionalCellSets,\n    spatialAxisFixed,\n    geneExpressionColormap,\n    geneExpressionColormapRange,\n  }, {\n    setSpatialZoom: setZoom,\n    setSpatialTargetX: setTargetX,\n    setSpatialTargetY: setTargetY,\n    setSpatialTargetZ: setTargetZ,\n    setSpatialRotationX: setRotationX,\n    setSpatialRotationOrbit: setRotationOrbit,\n    setSpatialOrbitAxis: setOrbitAxis,\n    setSpatialRasterLayers: setRasterLayers,\n    setSpatialCellsLayer: setCellsLayer,\n    setSpatialMoleculesLayer: setMoleculesLayer,\n    setSpatialNeighborhoodsLayer: setNeighborhoodsLayer,\n    setCellFilter,\n    setCellSetSelection,\n    setCellHighlight,\n    setCellSetColor,\n    setCellColorEncoding,\n    setAdditionalCellSets,\n    setMoleculeHighlight,\n    setSpatialAxisFixed,\n    setGeneExpressionColormap,\n    setGeneExpressionColormapRange,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.spatial, coordinationScopes);\n\n  const [\n    {\n      rasterLayersCallbacks,\n    },\n  ] = useAuxiliaryCoordination(\n    COMPONENT_COORDINATION_TYPES.layerController,\n    coordinationScopes,\n  );\n\n  const use3d = rasterLayers?.some(l => l.use3d);\n\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady,\n    resetReadyItems,\n  ] = useReady(\n    SPATIAL_DATA_TYPES,\n  );\n  const [width, height, deckRef] = useDeckCanvasSize();\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  // Also clear the array of automatically-initialized layers.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [cells, cellsCount] = useCellsData(\n    loaders, dataset, setItemIsReady, addUrl, false,\n    { setSpatialCellsLayer: setCellsLayer },\n    { spatialCellsLayer: cellsLayer },\n  );\n  const [molecules, moleculesCount, locationsCount] = useMoleculesData(\n    loaders, dataset, setItemIsReady, addUrl, false,\n    { setSpatialMoleculesLayer: setMoleculesLayer },\n    { spatialMoleculesLayer: moleculesLayer },\n  );\n  const [neighborhoods] = useNeighborhoodsData(\n    loaders, dataset, setItemIsReady, addUrl, false,\n    { setSpatialNeighborhoodsLayer: setNeighborhoodsLayer },\n    { spatialNeighborhoodsLayer: neighborhoodsLayer },\n  );\n  const [cellSets] = useCellSetsData(\n    loaders, dataset, setItemIsReady, addUrl, false,\n    { setCellSetSelection, setCellSetColor },\n    { cellSetSelection, cellSetColor },\n  );\n  const [expressionData] = useGeneSelection(\n    loaders, dataset, setItemIsReady, false, geneSelection, setItemIsNotReady,\n  );\n  const [attrs] = useExpressionAttrs(\n    loaders, dataset, setItemIsReady, addUrl, false,\n  );\n  // eslint-disable-next-line no-unused-vars\n  const [raster, imageLayerLoaders, imageLayerMeta] = useRasterData(\n    loaders, dataset, setItemIsReady, addUrl, false,\n    { setSpatialRasterLayers: setRasterLayers },\n    { spatialRasterLayers: rasterLayers },\n  );\n\n  const layers = useMemo(() => {\n    // Only want to pass in cells layer once if there is not `bitmask`.\n    // We pass in the cells data regardless because it is needed for selection,\n    // but the rendering layer itself is not needed.\n    const canPassInCellsLayer = !imageLayerMeta.some(l => l?.metadata?.isBitmask);\n    return [\n      ...(moleculesLayer ? [{ ...moleculesLayer, type: 'molecules' }] : []),\n      ...((cellsLayer && canPassInCellsLayer) ? [{ ...cellsLayer, type: 'cells' }] : []),\n      ...(neighborhoodsLayer ? [{ ...neighborhoodsLayer, type: 'neighborhoods' }] : []),\n      ...(rasterLayers ? rasterLayers.map(l => ({ ...l, type: (l.type && ['raster', 'bitmask'].includes(l.type) ? l.type : 'raster') })) : []),\n    ];\n  }, [cellsLayer, moleculesLayer, neighborhoodsLayer, rasterLayers, imageLayerMeta]);\n\n  useEffect(() => {\n    if ((typeof targetX !== 'number' || typeof targetY !== 'number')) {\n      const {\n        initialTargetX, initialTargetY, initialTargetZ, initialZoom,\n      } = getInitialSpatialTargets({\n        width,\n        height,\n        cells,\n        imageLayerLoaders,\n        useRaster: Boolean(loaders[dataset].loaders.raster),\n        use3d,\n      });\n      setTargetX(initialTargetX);\n      setTargetY(initialTargetY);\n      setTargetZ(initialTargetZ);\n      setZoom(initialZoom);\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [imageLayerLoaders, cells, targetX, targetY, setTargetX, setTargetY, setZoom, use3d]);\n\n  const mergedCellSets = useMemo(() => mergeCellSets(\n    cellSets, additionalCellSets,\n  ), [cellSets, additionalCellSets]);\n\n  const setCellSelectionProp = useCallback((v) => {\n    setCellSelection(\n      v, additionalCellSets, cellSetColor,\n      setCellSetSelection, setAdditionalCellSets, setCellSetColor,\n      setCellColorEncoding,\n    );\n  }, [additionalCellSets, cellSetColor, setCellColorEncoding,\n    setAdditionalCellSets, setCellSetColor, setCellSetSelection]);\n\n  const cellColors = useMemo(() => getCellColors({\n    cellColorEncoding,\n    expressionData: expressionData && expressionData[0],\n    geneSelection,\n    cellSets: mergedCellSets,\n    cellSetSelection,\n    cellSetColor,\n    expressionDataAttrs: attrs,\n    theme,\n  }), [cellColorEncoding, geneSelection, mergedCellSets, theme,\n    cellSetColor, cellSetSelection, expressionData, attrs]);\n\n  // The bitmask layer needs access to a array (i.e a texture) lookup of cell -> expression value\n  // where each cell id indexes into the array.\n  // Cell ids in `attrs.rows` do not necessaryily correspond to indices in that array, though,\n  // so we create a \"shifted\" array where this is the case.\n  const shiftedExpressionDataForBitmask = useMemo(() => {\n    const hasBitmask = imageLayerMeta.some(l => l?.metadata?.isBitmask);\n    if (attrs?.rows && expressionData && hasBitmask) {\n      const maxId = attrs.rows.reduce((max, curr) => Math.max(max, Number(curr)));\n      const result = new Uint8Array(maxId + 1);\n      // eslint-disable-next-line no-plusplus\n      for (let i = 0; i < attrs.rows.length; i++) {\n        const id = attrs.rows[i];\n        result.set(expressionData[0].slice(i, i + 1), Number(id));\n      }\n      return [result];\n    } return [new Uint8Array()];\n  }, [attrs, expressionData, imageLayerMeta]);\n\n  const cellSelection = useMemo(() => Array.from(cellColors.keys()), [cellColors]);\n\n  const getCellInfo = (cellId) => {\n    const cell = cells[cellId];\n    if (cell) {\n      return {\n        [`${capitalize(observationsLabel)} ID`]: cellId,\n        ...cell.factors,\n      };\n    }\n    return null;\n  };\n\n  const setViewState = ({\n    zoom: newZoom,\n    target,\n    rotationX: newRotationX,\n    rotationOrbit: newRotationOrbit,\n    orbitAxis: newOrbitAxis,\n  }) => {\n    setZoom(newZoom);\n    setTargetX(target[0]);\n    setTargetY(target[1]);\n    setTargetZ(target[2] || null);\n    setRotationX(newRotationX);\n    setRotationOrbit(newRotationOrbit);\n    setOrbitAxis(newOrbitAxis || null);\n  };\n\n  const subtitle = makeSpatialSubtitle({\n    observationsCount: cellsCount,\n    observationsLabel,\n    observationsPluralLabel,\n    subobservationsCount: moleculesCount,\n    subobservationsLabel,\n    subobservationsPluralLabel,\n    locationsCount,\n  });\n\n  // Set up a getter function for gene expression values, to be used\n  // by the DeckGL layer to obtain values for instanced attributes.\n  const getExpressionValue = useExpressionValueGetter({ attrs, expressionData });\n  const hasExpressionData = loaders[dataset].loaders['expression-matrix'];\n  const hasCellsData = loaders[dataset].loaders.cells\n    || imageLayerMeta.some(l => l?.metadata?.isBitmask);\n  const canLoad3DLayers = imageLayerLoaders.some(loader => Boolean(\n    Array.from({\n      length: loader.data.length,\n    }).filter((_, res) => canLoadResolution(loader.data, res)).length,\n  ));\n  // Only show 3D options if we can theoretically load the data and it is allowed to be loaded.\n  const canShow3DOptions = canLoad3DLayers\n    && !(disable3d?.length === imageLayerLoaders.length) && !globalDisable3d;\n\n  return (\n    <TitleInfo\n      title={title}\n      info={subtitle}\n      isSpatial\n      urls={urls}\n      theme={theme}\n      removeGridComponent={removeGridComponent}\n      isReady={isReady}\n      options={\n        // Only show button if there is expression or 3D data because only cells data\n        // does not have any options (i.e for color encoding, you need to switch to expression data)\n        canShow3DOptions || hasExpressionData ? (\n          <SpatialOptions\n            observationsLabel={observationsLabel}\n            cellColorEncoding={cellColorEncoding}\n            setCellColorEncoding={setCellColorEncoding}\n            setSpatialAxisFixed={setSpatialAxisFixed}\n            spatialAxisFixed={spatialAxisFixed}\n            use3d={use3d}\n            geneExpressionColormap={geneExpressionColormap}\n            setGeneExpressionColormap={setGeneExpressionColormap}\n            geneExpressionColormapRange={geneExpressionColormapRange}\n            setGeneExpressionColormapRange={setGeneExpressionColormapRange}\n            canShowExpressionOptions={hasExpressionData}\n            canShowColorEncodingOption={hasCellsData && hasExpressionData}\n            canShow3DOptions={canShow3DOptions}\n          />\n        ) : null\n      }\n    >\n      <Spatial\n        ref={deckRef}\n        uuid={uuid}\n        width={width}\n        height={height}\n        viewState={{\n          zoom,\n          target: [targetX, targetY, targetZ],\n          rotationX,\n          rotationY,\n          rotationZ,\n          rotationOrbit,\n          orbitAxis,\n        }}\n        setViewState={setViewState}\n        layers={layers}\n        cells={cells}\n        cellFilter={cellFilter}\n        cellSelection={cellSelection}\n        cellHighlight={cellHighlight}\n        cellColors={cellColors}\n        molecules={molecules}\n        neighborhoods={neighborhoods}\n        imageLayerLoaders={imageLayerLoaders}\n        setCellFilter={setCellFilter}\n        setCellSelection={setCellSelectionProp}\n        setCellHighlight={setCellHighlight}\n        setMoleculeHighlight={setMoleculeHighlight}\n        setComponentHover={() => {\n          setComponentHover(uuid);\n        }}\n        updateViewInfo={setComponentViewInfo}\n        rasterLayersCallbacks={rasterLayersCallbacks}\n        spatialAxisFixed={spatialAxisFixed}\n        geneExpressionColormap={geneExpressionColormap}\n        geneExpressionColormapRange={geneExpressionColormapRange}\n        expressionData={shiftedExpressionDataForBitmask}\n        cellColorEncoding={cellColorEncoding}\n        getExpressionValue={getExpressionValue}\n        theme={theme}\n      />\n      {!disableTooltip && (\n        <SpatialTooltipSubscriber\n          parentUuid={uuid}\n          cellHighlight={cellHighlight}\n          width={width}\n          height={height}\n          getCellInfo={getCellInfo}\n        />\n      )}\n    </TitleInfo>\n  );\n}\n", "import React, { forwardRef } from 'react';\nimport isEqual from 'lodash/isEqual';\nimport { COORDINATE_SYSTEM } from '@deck.gl/core'; // eslint-disable-line import/no-extraneous-dependencies\nimport { PolygonLayer, ScatterplotLayer } from '@deck.gl/layers'; // eslint-disable-line import/no-extraneous-dependencies\nimport { Matrix4 } from 'math.gl';\nimport { ScaleBarLayer, MultiscaleImageLayer } from '@hms-dbmi/viv';\nimport { getSelectionLayers } from '../../layers';\nimport { cellLayerDefaultProps, PALETTE, getDefaultColor } from '../utils';\nimport { getSourceFromLoader } from '../../utils';\nimport { square, getLayerLoaderTuple, renderSubBitmaskLayers } from './utils';\nimport AbstractSpatialOrScatterplot from '../shared-spatial-scatterplot/AbstractSpatialOrScatterplot';\nimport { createCellsQuadTree } from '../shared-spatial-scatterplot/quadtree';\nimport { ScaledExpressionExtension } from '../../layer-extensions';\n\nconst CELLS_LAYER_ID = 'cells-layer';\nconst MOLECULES_LAYER_ID = 'molecules-layer';\nconst NEIGHBORHOODS_LAYER_ID = 'neighborhoods-layer';\n\n// Default getter function props.\nconst defaultGetCellCoords = cell => cell.xy;\nconst makeDefaultGetCellPolygon = radius => (cellEntry) => {\n  const cell = cellEntry[1];\n  return cell.poly?.length ? cell.poly : square(cell.xy[0], cell.xy[1], radius);\n};\nconst makeDefaultGetCellColors = (cellColors, theme) => (cellEntry) => {\n  const [r, g, b, a] = (cellColors && cellColors.get(cellEntry[0])) || getDefaultColor(theme);\n  return [r, g, b, 255 * (a || 1)];\n};\nconst makeDefaultGetCellIsSelected = (cellSelection) => {\n  if (cellSelection) {\n    // For performance, convert the Array to a Set instance.\n    // Set.has() is faster than Array.includes().\n    const cellSelectionSet = new Set(cellSelection);\n    return cellEntry => (cellSelectionSet.has(cellEntry[0]) ? 1.0 : 0.0);\n  }\n  return () => 0.0;\n};\n\n/**\n * React component which expresses the spatial relationships between cells and molecules.\n * @param {object} props\n * @param {string} props.uuid A unique identifier for this component,\n * used to determine when to show tooltips vs. crosshairs.\n * @param {number} props.height Height of the DeckGL canvas, used when\n * rendering the scale bar layer.\n * @param {number} props.width Width of the DeckGL canvas, used when\n * rendering the scale bar layer.\n * @param {object} props.viewState The DeckGL viewState object.\n * @param {function} props.setViewState A handler for updating the DeckGL\n * viewState object.\n * @param {object} props.molecules Molecules data.\n * @param {object} props.cells Cells data.\n * @param {object} props.neighborhoods Neighborhoods data.\n * @param {number} props.lineWidthScale Width of cell border in view space (deck.gl).\n * @param {number} props.lineWidthMaxPixels Max width of the cell border in pixels (deck.gl).\n * @param {object} props.imageLayerLoaders An object mapping raster layer index to Viv loader\n * instances.\n * @param {object} props.cellColors Map from cell IDs to colors [r, g, b].\n * @param {function} props.getCellCoords Getter function for cell coordinates\n * (used by the selection layer).\n * @param {function} props.getCellColor Getter function for cell color as [r, g, b] array.\n * @param {function} props.getCellPolygon Getter function for cell polygons.\n * @param {function} props.getCellIsSelected Getter function for cell layer isSelected.\n * @param {function} props.getMoleculeColor\n * @param {function} props.getMoleculePosition\n * @param {function} props.getNeighborhoodPolygon\n * @param {function} props.updateViewInfo Handler for DeckGL viewport updates,\n * used when rendering tooltips and crosshairs.\n * @param {function} props.onCellClick Getter function for cell layer onClick.\n * @param {string} props.theme \"light\" or \"dark\" for the vitessce theme\n */\nclass Spatial extends AbstractSpatialOrScatterplot {\n  constructor(props) {\n    super(props);\n\n    // To avoid storing large arrays/objects\n    // in React state, this component\n    // uses instance variables.\n    // All instance variables used in this class:\n    this.cellsEntries = [];\n    this.moleculesEntries = [];\n    this.cellsQuadTree = null;\n    this.cellsLayer = null;\n    this.moleculesLayer = null;\n    this.neighborhoodsLayer = null;\n    this.imageLayers = [];\n    this.layerLoaderSelections = {};\n    // Better for the bitmask layer when there is no color data to use this.\n    // 2048 is best for performance and for stability (4096 texture size is not always supported).\n    this.randomColorData = {\n      data: new Uint8Array(2048 * 2048 * 3)\n        .map((_, j) => (j < 4 ? 0 : Math.round(255 * Math.random()))),\n      // This buffer should be able to hold colors for 2048 x 2048 ~ 4 million cells.\n      height: 2048,\n      width: 2048,\n    };\n    this.color = { ...this.randomColorData };\n    this.expression = {\n      data: new Uint8Array(2048 * 2048),\n      // This buffer should be able to hold colors for 2048 x 2048 ~ 4 million cells.\n      height: 2048,\n      width: 2048,\n    };\n\n    // Initialize data and layers.\n    this.onUpdateCellsData();\n    this.onUpdateCellsLayer();\n    this.onUpdateMoleculesData();\n    this.onUpdateMoleculesLayer();\n    this.onUpdateNeighborhoodsData();\n    this.onUpdateNeighborhoodsLayer();\n    this.onUpdateImages();\n  }\n\n  createCellsLayer(layerDef) {\n    const {\n      radius, stroked, visible, opacity,\n    } = layerDef;\n    const { cellsEntries } = this;\n    const {\n      theme,\n      cellFilter,\n      cellSelection,\n      setCellHighlight,\n      setComponentHover,\n      getCellIsSelected = makeDefaultGetCellIsSelected(\n        cellsEntries.length === cellSelection.length ? null : cellSelection,\n      ),\n      cellColors,\n      getCellColor = makeDefaultGetCellColors(cellColors, theme),\n      getCellPolygon = makeDefaultGetCellPolygon(radius),\n      onCellClick,\n      lineWidthScale = 10,\n      lineWidthMaxPixels = 2,\n      geneExpressionColormapRange,\n      cellColorEncoding,\n      getExpressionValue,\n      geneExpressionColormap,\n    } = this.props;\n    const filteredCellsEntries = cellFilter\n      ? cellsEntries.filter(cellEntry => cellFilter.includes(cellEntry[0]))\n      : cellsEntries;\n\n    // Graphics rendering has the y-axis positive going south,\n    // so we need to flip it for rendering tooltips.\n    const flipYTooltip = true;\n\n    return new PolygonLayer({\n      id: CELLS_LAYER_ID,\n      backgroundColor: [0, 0, 0],\n      isSelected: getCellIsSelected,\n      getPolygon: getCellPolygon,\n      updateTriggers: {\n        getLineWidth: [stroked],\n        isSelected: cellSelection,\n        getExpressionValue,\n        getFillColor: [opacity, cellColorEncoding, cellSelection, cellColors],\n        getLineColor: [cellColorEncoding, cellSelection, cellColors],\n      },\n      getFillColor: (cellEntry) => {\n        const color = getCellColor(cellEntry);\n        color[3] = opacity * 255;\n        return color;\n      },\n      getLineColor: (cellEntry) => {\n        const color = getCellColor(cellEntry);\n        color[3] = 255;\n        return color;\n      },\n      onClick: (info) => {\n        if (onCellClick) {\n          onCellClick(info);\n        }\n      },\n      visible,\n      getLineWidth: stroked ? 1 : 0,\n      lineWidthScale,\n      lineWidthMaxPixels,\n      getExpressionValue,\n      extensions: [new ScaledExpressionExtension()],\n      colorScaleLo: geneExpressionColormapRange[0],\n      colorScaleHi: geneExpressionColormapRange[1],\n      isExpressionMode: cellColorEncoding === 'geneSelection',\n      colormap: geneExpressionColormap,\n      ...cellLayerDefaultProps(\n        filteredCellsEntries,\n        undefined,\n        setCellHighlight,\n        setComponentHover,\n        flipYTooltip,\n      ),\n    });\n  }\n\n  createMoleculesLayer(layerDef) {\n    const {\n      setMoleculeHighlight,\n      getMoleculeColor = d => PALETTE[d[2] % PALETTE.length],\n      getMoleculePosition = d => [d[0], d[1], 0],\n    } = this.props;\n    const { moleculesEntries } = this;\n\n    return new ScatterplotLayer({\n      id: MOLECULES_LAYER_ID,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: moleculesEntries,\n      pickable: true,\n      autoHighlight: true,\n      radiusMaxPixels: 3,\n      opacity: layerDef.opacity,\n      visible: layerDef.visible,\n      getRadius: layerDef.radius,\n      getPosition: getMoleculePosition,\n      getLineColor: getMoleculeColor,\n      getFillColor: getMoleculeColor,\n      onHover: (info) => {\n        if (setMoleculeHighlight) {\n          if (info.object) {\n            setMoleculeHighlight(info.object[3]);\n          } else {\n            setMoleculeHighlight(null);\n          }\n        }\n      },\n    });\n  }\n\n  createNeighborhoodsLayer(layerDef) {\n    const {\n      getNeighborhoodPolygon = (neighborhoodsEntry) => {\n        const neighborhood = neighborhoodsEntry[1];\n        return neighborhood.poly;\n      },\n    } = this.props;\n    const { neighborhoodsEntries } = this;\n\n    return new PolygonLayer({\n      id: NEIGHBORHOODS_LAYER_ID,\n      getPolygon: getNeighborhoodPolygon,\n      coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n      data: neighborhoodsEntries,\n      pickable: true,\n      autoHighlight: true,\n      stroked: true,\n      filled: false,\n      getElevation: 0,\n      getLineWidth: 10,\n      visible: layerDef.visible,\n    });\n  }\n\n  createSelectionLayers() {\n    const {\n      viewState,\n      getCellCoords = defaultGetCellCoords,\n      setCellSelection,\n    } = this.props;\n    const { tool } = this.state;\n    const { cellsQuadTree } = this;\n    return getSelectionLayers(\n      tool,\n      viewState.zoom,\n      CELLS_LAYER_ID,\n      getCellCoords,\n      setCellSelection,\n      cellsQuadTree,\n    );\n  }\n\n  createScaleBarLayer() {\n    const {\n      viewState,\n      width,\n      height,\n      imageLayerLoaders = {},\n      layers,\n    } = this.props;\n    const use3d = (layers || []).some(i => i.use3d);\n    // Just get the first layer/loader since they should all be spatially\n    // resolved and therefore have the same unit size scale.\n    const loaders = Object.values(imageLayerLoaders);\n    if (!viewState || !width || !height || loaders.length < 1) return null;\n    const loader = loaders[0];\n    if (!loader) return null;\n    const source = getSourceFromLoader(loader);\n    if (!source.meta) return null;\n    const { physicalSizes } = source.meta;\n    if (physicalSizes && !use3d) {\n      const { x } = physicalSizes;\n      const { unit, size } = x;\n      if (unit && size) {\n        return new ScaleBarLayer({\n          id: 'scalebar-layer',\n          unit,\n          size,\n          viewState: { ...viewState, width, height },\n        });\n      }\n      return null;\n    }\n    return null;\n  }\n\n  createImageLayer(rawLayerDef, loader, i) {\n    const layerDef = {\n      ...rawLayerDef,\n      channels: rawLayerDef.channels.filter(\n        channel => channel.selection && channel.color && channel.slider,\n      ),\n    };\n\n    // We need to keep the same selections array reference,\n    // otherwise the Viv layer will not be re-used as we want it to,\n    // since selections is one of its `updateTriggers`.\n    // Reference: https://github.com/hms-dbmi/viv/blob/ad86d0f/src/layers/MultiscaleImageLayer/MultiscaleImageLayer.js#L127\n    let selections;\n    const nextLoaderSelection = layerDef.channels.map(c => c.selection);\n    const prevLoaderSelection = this.layerLoaderSelections[layerDef.index];\n    if (isEqual(prevLoaderSelection, nextLoaderSelection)) {\n      selections = prevLoaderSelection;\n    } else {\n      selections = nextLoaderSelection;\n      this.layerLoaderSelections[layerDef.index] = nextLoaderSelection;\n    }\n    const layerProps = {\n      colormap: layerDef.colormap,\n      opacity: layerDef.opacity,\n      transparentColor: layerDef.transparentColor,\n      colors: layerDef.channels.map(c => c.color),\n      sliders: layerDef.channels.map(c => c.slider),\n      resolution: layerDef.resolution,\n      renderingMode: layerDef.renderingMode,\n      xSlice: layerDef.xSlice,\n      ySlice: layerDef.ySlice,\n      zSlice: layerDef.zSlice,\n      callback: layerDef.callback,\n      visibilities: layerDef.channels.map(c => (!layerDef.visible && typeof layerDef.visible === 'boolean'\n        ? false\n        : c.visible)),\n    };\n\n    if (!loader || !layerProps) return null;\n    const {\n      metadata: { transform },\n      data,\n    } = loader;\n    let modelMatrix;\n    if (transform) {\n      const { scale, translate } = transform;\n      modelMatrix = new Matrix4()\n        .translate([translate.x, translate.y, 0])\n        .scale(scale);\n    } else if (layerDef.modelMatrix) {\n      // eslint-disable-next-line prefer-destructuring\n      modelMatrix = new Matrix4(layerDef.modelMatrix);\n    }\n    if (rawLayerDef.type === 'bitmask') {\n      const {\n        geneExpressionColormap,\n        geneExpressionColormapRange = [0.0, 1.0],\n        cellColorEncoding,\n      } = this.props;\n      return new MultiscaleImageLayer({\n        // `bitmask` is used by the AbstractSpatialOrScatterplot\n        // https://github.com/vitessce/vitessce/pull/927/files#diff-9cab35a2ca0c5b6d9754b177810d25079a30ca91efa062d5795181360bc3ff2cR111\n        id: `bitmask-layer-${layerDef.index}-${i}`,\n        channelsVisible: layerProps.visibilities,\n        opacity: layerProps.opacity,\n        modelMatrix,\n        hoveredCell: Number(this.props.cellHighlight),\n        renderSubLayers: renderSubBitmaskLayers,\n        loader: data,\n        selections,\n        // For some reason, deck.gl doesn't recognize the prop diffing\n        // unless these are separated out.  I don't think it's a bug, just\n        // has to do with the fact that we don't have it in the `defaultProps`,\n        // could be wrong though.\n        cellColorData: this.color.data,\n        cellTexHeight: this.color.height,\n        cellTexWidth: this.color.width,\n        excludeBackground: true,\n        onViewportLoad: layerProps.callback,\n        colorScaleLo: geneExpressionColormapRange[0],\n        colorScaleHi: geneExpressionColormapRange[1],\n        isExpressionMode: cellColorEncoding === 'geneSelection',\n        colormap: geneExpressionColormap,\n        expressionData: this.expression.data,\n      });\n    }\n    const [Layer, layerLoader] = getLayerLoaderTuple(data, layerDef.use3d);\n\n    return new Layer({\n      loader: layerLoader,\n      id: `${layerDef.use3d ? 'volume' : 'image'}-layer-${layerDef.index}-${i}`,\n      colors: layerProps.colors,\n      contrastLimits: layerProps.sliders,\n      selections,\n      channelsVisible: layerProps.visibilities,\n      opacity: layerProps.opacity,\n      colormap: layerProps.colormap,\n      modelMatrix,\n      transparentColor: layerProps.transparentColor,\n      resolution: layerProps.resolution,\n      renderingMode: layerProps.renderingMode,\n      pickable: false,\n      xSlice: layerProps.xSlice,\n      ySlice: layerProps.ySlice,\n      zSlice: layerProps.zSlice,\n      onViewportLoad: layerProps.callback,\n    });\n  }\n\n  createImageLayers() {\n    const {\n      layers,\n      imageLayerLoaders = {},\n      rasterLayersCallbacks = [],\n    } = this.props;\n    const use3d = (layers || []).some(i => i.use3d);\n    const use3dIndex = (layers || []).findIndex(i => i.use3d);\n    return (layers || [])\n      .filter(layer => layer.type === 'raster' || layer.type === 'bitmask')\n      .filter(layer => (use3d ? layer.use3d === use3d : true))\n      .map((layer, i) => this.createImageLayer(\n        { ...layer, callback: rasterLayersCallbacks[use3d ? use3dIndex : i] },\n        imageLayerLoaders[layer.index],\n        i,\n      ));\n  }\n\n  getLayers() {\n    const {\n      imageLayers, cellsLayer, neighborhoodsLayer, moleculesLayer,\n    } = this;\n    return [\n      ...imageLayers,\n      cellsLayer,\n      neighborhoodsLayer,\n      moleculesLayer,\n      this.createScaleBarLayer(),\n      ...this.createSelectionLayers(),\n    ];\n  }\n\n  onUpdateCellsData() {\n    const { cells = {}, getCellCoords = defaultGetCellCoords } = this.props;\n    const cellsEntries = Object.entries(cells);\n    this.cellsEntries = cellsEntries;\n    this.cellsQuadTree = createCellsQuadTree(cellsEntries, getCellCoords);\n  }\n\n  onUpdateCellsLayer() {\n    const { layers } = this.props;\n    const layerDef = (layers || []).find(layer => layer.type === 'cells');\n    if (layerDef) {\n      this.cellsLayer = this.createCellsLayer(layerDef);\n    } else {\n      this.cellsLayer = null;\n    }\n  }\n\n  onUpdateCellColors() {\n    const color = this.randomColorData;\n    const { size } = this.props.cellColors;\n    if (typeof size === 'number') {\n      const cellIds = this.props.cellColors.keys();\n      color.data = new Uint8Array(color.height * color.width * 3).fill(\n        getDefaultColor(this.props.theme)[0],\n      );\n      // 0th cell id is the empty space of the image i.e black color.\n      color.data[0] = 0;\n      color.data[1] = 0;\n      color.data[2] = 0;\n      // eslint-disable-next-line no-restricted-syntax\n      for (const id of cellIds) {\n        if (id > 0) {\n          const cellColor = this.props.cellColors.get(id);\n          if (cellColor) {\n            color.data.set(cellColor.slice(0, 3), Number(id) * 3);\n          }\n        }\n      }\n    }\n    this.color = color;\n  }\n\n  onUpdateExpressionData() {\n    const { expressionData } = this.props;\n    if (expressionData[0]?.length) {\n      this.expression.data = new Uint8Array(\n        this.expression.height * this.expression.width,\n      );\n      this.expression.data.set(expressionData[0]);\n    }\n  }\n\n  onUpdateMoleculesData() {\n    const { molecules = {} } = this.props;\n    const moleculesEntries = Object.entries(molecules).flatMap(\n      ([molecule, coords], index) => coords.map(([x, y]) => [x, y, index, molecule]),\n    );\n    this.moleculesEntries = moleculesEntries;\n  }\n\n  onUpdateMoleculesLayer() {\n    const { layers } = this.props;\n    const layerDef = (layers || []).find(layer => layer.type === 'molecules');\n    if (layerDef) {\n      this.moleculesLayer = this.createMoleculesLayer(layerDef);\n    } else {\n      this.moleculesLayer = null;\n    }\n  }\n\n  onUpdateNeighborhoodsData() {\n    const { neighborhoods = {} } = this.props;\n    const neighborhoodsEntries = Object.entries(neighborhoods);\n    this.neighborhoodsEntries = neighborhoodsEntries;\n  }\n\n  onUpdateNeighborhoodsLayer() {\n    const { layers } = this.props;\n    const layerDef = (layers || []).find(\n      layer => layer.type === 'neighborhoods',\n    );\n    if (layerDef) {\n      this.neighborhoodsLayer = this.createNeighborhoodsLayer(layerDef);\n    } else {\n      this.neighborhoodsLayer = null;\n    }\n  }\n\n  onUpdateImages() {\n    this.imageLayers = this.createImageLayers();\n  }\n\n  viewInfoDidUpdate() {\n    const { getCellCoords = defaultGetCellCoords } = this.props;\n    super.viewInfoDidUpdate(getCellCoords);\n  }\n\n  /**\n   * Here, asynchronously check whether props have\n   * updated which require re-computing memoized variables,\n   * followed by a re-render.\n   * This function does not follow React conventions or paradigms,\n   * it is only implemented this way to try to squeeze out\n   * performance.\n   * @param {object} prevProps The previous props to diff against.\n   */\n  componentDidUpdate(prevProps) {\n    this.viewInfoDidUpdate();\n\n    const shallowDiff = propName => prevProps[propName] !== this.props[propName];\n    if (['cells'].some(shallowDiff)) {\n      // Cells data changed.\n      this.onUpdateCellsData();\n      this.forceUpdate();\n    }\n\n    if (\n      [\n        'layers',\n        'cells',\n        'cellFilter',\n        'cellSelection',\n        'cellColors',\n        'geneExpressionColormapRange',\n        'cellColorEncoding',\n        'geneExpressionColormap',\n      ].some(shallowDiff)\n    ) {\n      // Cells layer props changed.\n      this.onUpdateCellsLayer();\n      this.forceUpdate();\n    }\n\n    if (['cellColors'].some(shallowDiff)) {\n      // Cells Color layer props changed.\n      this.onUpdateCellColors();\n      this.forceUpdate();\n    }\n\n    if (['expressionData'].some(shallowDiff)) {\n      // Expression data prop changed.\n      this.onUpdateExpressionData();\n      this.forceUpdate();\n    }\n\n    if (['molecules'].some(shallowDiff)) {\n      // Molecules data changed.\n      this.onUpdateMoleculesData();\n      this.forceUpdate();\n    }\n\n    if (['layers', 'molecules'].some(shallowDiff)) {\n      // Molecules layer props changed.\n      this.onUpdateMoleculesLayer();\n      this.forceUpdate();\n    }\n\n    if (['neighborhoods'].some(shallowDiff)) {\n      // Neighborhoods data changed.\n      this.onUpdateNeighborhoodsData();\n      this.forceUpdate();\n    }\n\n    if (['layers', 'neighborhoods'].some(shallowDiff)) {\n      // Neighborhoods layer props changed.\n      this.onUpdateNeighborhoodsLayer();\n      this.forceUpdate();\n    }\n\n    if (\n      [\n        'layers',\n        'imageLayerLoaders',\n        'cellColors',\n        'cellHighlight',\n        'geneExpressionColormapRange',\n        'expressionData',\n        'rasterLayersCallbacks',\n        'geneExpressionColormap',\n      ].some(shallowDiff)\n    ) {\n      // Image layers changed.\n      this.onUpdateImages();\n      this.forceUpdate();\n    }\n  }\n\n  // render() is implemented in the abstract parent class.\n}\n\n/**\n * Need this wrapper function here,\n * since we want to pass a forwardRef\n * so that outer components can\n * access the grandchild DeckGL ref,\n * but we are using a class component.\n */\nconst SpatialWrapper = forwardRef((props, deckRef) => (\n  <Spatial {...props} deckRef={deckRef} />\n));\nexport default SpatialWrapper;\n", "import { COORDINATE_SYSTEM } from '@deck.gl/core'; // eslint-disable-line import/no-extraneous-dependencies\nimport { DataFilterExtension } from '@deck.gl/extensions'; // eslint-disable-line import/no-extraneous-dependencies\nimport SelectionLayer from './SelectionLayer';\n\n/**\n * Convert a DeckGL layer ID to a \"base\" layer ID for selection.\n * @param {string} layerId The layer ID to convert.\n * @returns {string} The base layer ID.\n */\nfunction getBaseLayerId(layerId) {\n  return `base-${layerId}`;\n}\n\n/**\n * Convert a DeckGL layer ID to a \"selected\" layer ID for selection.\n * @param {string} layerId The layer ID to convert.\n * @returns {string} The base layer ID.\n */\nfunction getSelectedLayerId(layerId) {\n  return `selected-${layerId}`;\n}\n\n/**\n * Construct DeckGL selection layers.\n * @param {string} tool\n * @param {number} zoom\n * @param {string} cellBaseLayerId\n * @param {function} getCellCoords\n * @param {function} updateCellsSelection\n * @returns {object[]} The array of DeckGL selection layers.\n */\nexport function getSelectionLayers(\n  tool,\n  zoom,\n  layerId,\n  getCellCoords,\n  updateCellsSelection,\n  cellsQuadTree,\n  flipY = false,\n) {\n  if (!tool) {\n    return [];\n  }\n\n  const cellBaseLayerId = getBaseLayerId(layerId);\n  const editHandlePointRadius = 5 / (zoom + 16);\n\n  return [new SelectionLayer({\n    id: 'selection',\n    flipY,\n    cellsQuadTree,\n    getCellCoords,\n    coordinateSystem: COORDINATE_SYSTEM.CARTESIAN,\n    selectionType: tool,\n    onSelect: ({ pickingInfos }) => {\n      const cellIds = pickingInfos.map(cellObj => cellObj[0]);\n      if (updateCellsSelection) {\n        updateCellsSelection(cellIds);\n      }\n    },\n    layerIds: [cellBaseLayerId],\n    getTentativeFillColor: () => [255, 255, 255, 95],\n    getTentativeLineColor: () => [143, 143, 143, 255],\n    getTentativeLineDashArray: () => [7, 4],\n    lineWidthMinPixels: 2,\n    lineWidthMaxPixels: 2,\n    getEditHandlePointColor: () => [0xff, 0xff, 0xff, 0xff],\n    getEditHandlePointRadius: () => editHandlePointRadius,\n    editHandlePointRadiusScale: 1,\n    editHandlePointRadiusMinPixels: editHandlePointRadius,\n    editHandlePointRadiusMaxPixels: 2 * editHandlePointRadius,\n  })];\n}\n\n/**\n * Get deck.gl layer props for selection overlays.\n * @param {object} props\n * @returns {object} Object with two properties,\n * overlay: overlayProps, base: baseProps,\n * where the values are deck.gl layer props.\n */\nexport function overlayBaseProps(props) {\n  const {\n    id, getColor, data, isSelected, ...rest\n  } = props;\n  return {\n    overlay: {\n      id: getSelectedLayerId(id),\n      getFillColor: getColor,\n      getLineColor: getColor,\n      data,\n      getFilterValue: isSelected,\n      extensions: [new DataFilterExtension({ filterSize: 1 })],\n      filterRange: [1, 1],\n      ...rest,\n    },\n    base: {\n      id: getBaseLayerId(id),\n      getLineColor: getColor,\n      getFillColor: getColor,\n      // Alternatively: contrast outlines with solids:\n      // getLineColor: getColor,\n      // getFillColor: [255, 255, 255],\n      data: data.slice(),\n      ...rest,\n    },\n  };\n}\n", "/* eslint-disable import/no-extraneous-dependencies */\n/* eslint-disable no-underscore-dangle */\n// File adopted from nebula.gl's SelectionLayer\n// https://github.com/uber/nebula.gl/blob/8e9c2ec8d7cf4ca7050909ed826eb847d5e2cd9c/modules/layers/src/layers/selection-layer.js\nimport { CompositeLayer } from 'deck.gl';\nimport { polygon as turfPolygon, point as turfPoint } from '@turf/helpers';\nimport booleanWithin from '@turf/boolean-within';\nimport booleanContains from '@turf/boolean-contains';\nimport booleanOverlap from '@turf/boolean-overlap';\nimport booleanPointInPolygon from '@turf/boolean-point-in-polygon';\nimport { ScatterplotLayer } from '@deck.gl/layers';\nimport { SELECTION_TYPE } from 'nebula.gl';\nimport { EditableGeoJsonLayer } from '@nebula.gl/layers';\nimport { DrawRectangleMode, DrawPolygonByDraggingMode, ViewMode } from '@nebula.gl/edit-modes';\n\nconst EDIT_TYPE_ADD = 'addFeature';\nconst EDIT_TYPE_CLEAR = 'clearFeatures';\n\n// Customize the click handlers for the rectangle and polygon tools,\n// so that clicking triggers the `onEdit` callback.\nclass ClickableDrawRectangleMode extends DrawRectangleMode {\n  // eslint-disable-next-line class-methods-use-this\n  handleClick(event, props) {\n    props.onEdit({ editType: EDIT_TYPE_CLEAR });\n  }\n}\n\nclass ClickableDrawPolygonByDraggingMode extends DrawPolygonByDraggingMode {\n  // eslint-disable-next-line class-methods-use-this\n  handleClick(event, props) {\n    props.onEdit({ editType: EDIT_TYPE_CLEAR });\n  }\n}\n\nconst MODE_MAP = {\n  [SELECTION_TYPE.RECTANGLE]: ClickableDrawRectangleMode,\n  [SELECTION_TYPE.POLYGON]: ClickableDrawPolygonByDraggingMode,\n};\n\nconst defaultProps = {\n  selectionType: SELECTION_TYPE.RECTANGLE,\n  layerIds: [],\n  onSelect: () => {},\n};\n\nconst EMPTY_DATA = {\n  type: 'FeatureCollection',\n  features: [],\n};\n\nconst LAYER_ID_GEOJSON = 'selection-geojson';\n\nconst PASS_THROUGH_PROPS = [\n  'lineWidthScale',\n  'lineWidthMinPixels',\n  'lineWidthMaxPixels',\n  'lineWidthUnits',\n  'lineJointRounded',\n  'lineMiterLimit',\n  'pointRadiusScale',\n  'pointRadiusMinPixels',\n  'pointRadiusMaxPixels',\n  'lineDashJustified',\n  'getLineColor',\n  'getFillColor',\n  'getRadius',\n  'getLineWidth',\n  'getLineDashArray',\n  'getTentativeLineDashArray',\n  'getTentativeLineColor',\n  'getTentativeFillColor',\n  'getTentativeLineWidth',\n  'editHandlePointRadiusScale',\n  'editHandlePointRadiusMinPixels',\n  'editHandlePointRadiusMaxPixels',\n  'getEditHandlePointColor',\n  'getEditHandlePointRadius',\n  'modeHandlers',\n];\n\nexport default class SelectionLayer extends CompositeLayer {\n  _selectPolygonObjects(coordinates) {\n    const {\n      onSelect,\n      getCellCoords,\n      cellsQuadTree,\n      flipY,\n    } = this.props;\n\n    const flippedCoordinates = (flipY\n      ? coordinates.map(poly => poly.map(p => ([p[0], -p[1]])))\n      : coordinates);\n\n    // Convert the selection to a turf polygon object.\n    const selectedPolygon = turfPolygon(flippedCoordinates);\n\n    // Create an array to store the results.\n    const pickingInfos = [];\n\n    // quadtree.visit() takes a callback that returns a boolean:\n    // If true returned, then the children of the node are _not_ visited.\n    // If false returned, then the children of the node are visited.\n    // Reference: https://github.com/d3/d3-quadtree#quadtree_visit\n    cellsQuadTree.visit((node, x0, y0, x1, y1) => {\n      const nodePoints = [[[x0, y0], [x1, y0], [x1, y1], [x0, y1], [x0, y0]]];\n      const nodePolygon = turfPolygon(nodePoints);\n\n      const nodePolygonContainsSelectedPolygon = booleanContains(nodePolygon, selectedPolygon);\n      const nodePolygonWithinSelectedPolygon = booleanWithin(nodePolygon, selectedPolygon);\n      const nodePolygonOverlapsSelectedPolgyon = booleanOverlap(nodePolygon, selectedPolygon);\n\n      if (!nodePolygonContainsSelectedPolygon\n        && !nodePolygonWithinSelectedPolygon\n        && !nodePolygonOverlapsSelectedPolgyon) {\n        // We are not interested in anything below this node,\n        // so return true because we are done with this node.\n        return true;\n      }\n\n      // This node made it past the above return statement, so it must either\n      // contain, be within, or overlap with the selected polygon.\n\n      // Check if this is a leaf node.\n      if (node.data\n        && booleanPointInPolygon(turfPoint(getCellCoords(node.data[1])), selectedPolygon)) {\n        // This node has data, so it is a leaf node representing one data point,\n        // and we have verified that the point is in the selected polygon.\n        pickingInfos.push(node.data);\n      }\n\n      // Return false because we are not done.\n      // We want to visit the children of this node.\n      return false;\n    });\n\n    onSelect({ pickingInfos });\n  }\n\n  renderLayers() {\n    const { onSelect } = this.props;\n    const mode = MODE_MAP[this.props.selectionType] || ViewMode;\n\n    const inheritedProps = {};\n    PASS_THROUGH_PROPS.forEach((p) => {\n      if (this.props[p] !== undefined) inheritedProps[p] = this.props[p];\n    });\n    const layers = [\n      new EditableGeoJsonLayer(\n        this.getSubLayerProps({\n          id: LAYER_ID_GEOJSON,\n          pickable: true,\n          mode,\n          modeConfig: {\n            dragToDraw: true,\n          },\n          selectedFeatureIndexes: [],\n          data: EMPTY_DATA,\n          onEdit: ({ updatedData, editType }) => {\n            if (editType === EDIT_TYPE_ADD) {\n              const { coordinates } = updatedData.features[0].geometry;\n              this._selectPolygonObjects(coordinates);\n            } else if (editType === EDIT_TYPE_CLEAR) {\n              // We want to select an empty array to clear any previous selection.\n              onSelect({ pickingInfos: [] });\n            }\n          },\n          _subLayerProps: {\n            guides: {\n              pointType: 'circle',\n              _subLayerProps: {\n                'points-circle': {\n                  // Styling for editHandles goes here.\n                  // Reference: https://github.com/uber/nebula.gl/issues/618#issuecomment-898466319\n                  type: ScatterplotLayer,\n                  radiusScale: 1,\n                  stroked: true,\n                  getLineWidth: 1,\n                  radiusMinPixels: 1,\n                  radiusMaxPixels: 3,\n                  getRadius: 2,\n                },\n              },\n            },\n          },\n          ...inheritedProps,\n        }),\n      ),\n    ];\n\n    return layers;\n  }\n}\n\nSelectionLayer.layerName = 'SelectionLayer';\nSelectionLayer.defaultProps = defaultProps;\n", "/* eslint-disable no-plusplus */\nimport shortNumber from 'short-number';\nimport isEqual from 'lodash/isEqual';\nimport {\n  getDefaultInitialViewState,\n  MultiscaleImageLayer,\n  ImageLayer,\n  VolumeLayer,\n} from '@hms-dbmi/viv';\nimport { extent } from 'd3-array';\nimport { Matrix4 } from 'math.gl';\nimport { divide, compare, unit } from 'mathjs';\nimport { pluralize, getSourceFromLoader, isRgb } from '../../utils';\nimport { VIEWER_PALETTE } from '../utils';\nimport {\n  GLOBAL_LABELS,\n  DEFAULT_RASTER_LAYER_PROPS,\n  DEFAULT_LAYER_TYPE_ORDERING,\n} from './constants';\nimport BitmaskLayer from '../../layers/BitmaskLayer';\nimport { getMultiSelectionStats } from '../layer-controller/utils';\n\nexport function square(x, y, r) {\n  return [[x, y + r], [x + r, y], [x, y - r], [x - r, y]];\n}\n\n/**\n * Sort spatial layer definition array,\n * to keep the ordering in the layer controller\n * consistent.\n * Intended to be used with auto-initialized layer\n * definition arrays only, as a pre-defined layer array\n * should not be re-ordered.\n * @param {object[]} layers Array of layer definition objects.\n * Object must have a .type property.\n */\nexport function sortLayers(layers) {\n  return layers.sort((a, b) => (\n    DEFAULT_LAYER_TYPE_ORDERING.indexOf(a.type) - DEFAULT_LAYER_TYPE_ORDERING.indexOf(b.type)\n  ));\n}\n\n/**\n * Return the midpoint of the global dimensions.\n * @param {object} source PixelSource object from Viv\n * @returns {object} The selection.\n */\nfunction getDefaultGlobalSelection(source) {\n  const globalIndices = source.labels\n    .filter(dim => GLOBAL_LABELS.includes(dim));\n  const selection = {};\n  globalIndices.forEach((dim) => {\n    selection[dim] = Math.floor(\n      (source.shape[source.labels.indexOf(dim)] || 0) / 2,\n    );\n  });\n  return selection;\n}\n\n/**\n * Create a default selection using the midpoint of the available global dimensions,\n * and then the first four available selections from the first selectable channel.\n * @param {object} source PixelSource object from Viv\n * @returns {object} The selection.\n */\nfunction buildDefaultSelection(source) {\n  const selection = [];\n  const globalSelection = getDefaultGlobalSelection(source);\n  // First non-global dimension with some sort of selectable values\n  const firstNonGlobalDimension = source.labels.filter(\n    dim => !GLOBAL_LABELS.includes(dim)\n      && source.shape[source.labels.indexOf(dim)],\n  )[0];\n  for (let i = 0; i < Math.min(4, source.shape[\n    source.labels.indexOf(firstNonGlobalDimension)\n  ]); i += 1) {\n    selection.push(\n      {\n        [firstNonGlobalDimension]: i,\n        ...globalSelection,\n      },\n    );\n  }\n  return selection;\n}\n\n/**\n * @param {Array.<number>} shape loader shape\n */\nexport function isInterleaved(shape) {\n  const lastDimSize = shape[shape.length - 1];\n  return lastDimSize === 3 || lastDimSize === 4;\n}\n\n/**\n * Initialize the channel selections for an individual layer.\n * @param {object} loader A viv loader instance with channel names appended by Vitessce loaders\n * of the form { data: (PixelSource[]|PixelSource), metadata: Object, channels }\n * @returns {object[]} An array of selected channels with default\n * domain/slider settings.\n */\nexport async function initializeLayerChannels(loader, use3d) {\n  const result = [];\n  const source = getSourceFromLoader(loader);\n  // Add channel automatically as the first avaialable value for each dimension.\n  let defaultSelection = buildDefaultSelection(source);\n  defaultSelection = isInterleaved(source.shape)\n    ? [{ ...defaultSelection[0], c: 0 }] : defaultSelection;\n  const stats = await getMultiSelectionStats({\n    loader: loader.data, selections: defaultSelection, use3d,\n  });\n\n  const domains = isRgb(loader)\n    ? [[0, 255], [0, 255], [0, 255]]\n    : stats.domains;\n  const colors = isRgb(loader)\n    ? [[255, 0, 0], [0, 255, 0], [0, 0, 255]]\n    : null;\n  const sliders = isRgb(loader)\n    ? [[0, 255], [0, 255], [0, 255]]\n    : stats.sliders;\n\n  defaultSelection.forEach((selection, i) => {\n    const domain = domains[i];\n    const slider = sliders[i];\n    const channel = {\n      selection,\n      // eslint-disable-next-line no-nested-ternary\n      color: colors ? colors[i]\n        : defaultSelection.length !== 1\n          ? VIEWER_PALETTE[i] : [255, 255, 255],\n      visible: true,\n      slider: slider || domain,\n    };\n    result.push(channel);\n  });\n  return result;\n}\n\nfunction getMetaWithTransformMatrices(imageMeta, imageLoaders) {\n  // Do not fill in transformation matrices if any of the layers specify one.\n  const sources = imageLoaders.map(loader => getSourceFromLoader(loader));\n  if (\n    imageMeta.map(meta => meta?.metadata?.transform?.matrix\n      || meta?.metadata?.transform?.scale\n      || meta?.metadata?.transform?.translate).some(Boolean)\n    || sources.every(\n      source => !source.meta?.physicalSizes?.x || !source.meta?.physicalSizes?.y,\n    )\n  ) {\n    return imageMeta;\n  }\n  // Get the minimum physical among all the current images.\n  const minPhysicalSize = sources.reduce((acc, source) => {\n    const hasZPhyscialSize = source.meta?.physicalSizes?.z?.size;\n    const sizes = [\n      unit(`${source.meta?.physicalSizes.x.size} ${source.meta?.physicalSizes.x.unit}`.replace('\u00B5', 'u')),\n      unit(`${source.meta?.physicalSizes.y.size} ${source.meta?.physicalSizes.y.unit}`.replace('\u00B5', 'u')),\n    ];\n    if (hasZPhyscialSize) {\n      sizes.push(unit(`${source.meta?.physicalSizes.z.size} ${source.meta?.physicalSizes.z.unit}`.replace('\u00B5', 'u')));\n    }\n    acc[0] = (acc[0] === undefined || compare(sizes[0], acc[0]) === -1) ? sizes[0] : acc[0];\n    acc[1] = (acc[1] === undefined || compare(sizes[1], acc[1]) === -1) ? sizes[1] : acc[1];\n    acc[2] = (acc[2] === undefined || compare(sizes[2], acc[2]) === -1) ? sizes[2] : acc[2];\n    return acc;\n  }, []);\n  const imageMetaWithTransform = imageMeta.map((meta, j) => {\n    const source = sources[j];\n    const hasZPhyscialSize = source.meta?.physicalSizes?.z?.size;\n    const sizes = [\n      unit(`${source.meta?.physicalSizes.x.size} ${source.meta?.physicalSizes.x.unit}`.replace('\u00B5', 'u')),\n      unit(`${source.meta?.physicalSizes.y.size} ${source.meta?.physicalSizes.y.unit}`.replace('\u00B5', 'u')),\n    ];\n    if (hasZPhyscialSize) {\n      sizes.push(unit(`${source.meta?.physicalSizes.z.size} ${source.meta?.physicalSizes.z.unit}`.replace('\u00B5', 'u')));\n    }\n    // Find the ratio of the sizes to get the scaling factor.\n    const scale = sizes.map((i, k) => divide(i, minPhysicalSize[k]));\n    // Add in z dimension needed for Matrix4 scale API.\n    if (!scale[2]) {\n      scale[2] = 1;\n    }\n    // no need to store/use identity scaling\n    if (isEqual(scale, [1, 1, 1])) {\n      return meta;\n    }\n    // Make sure to scale the z direction by one.\n    const matrix = new Matrix4().scale([...scale]);\n    const newMeta = { ...meta };\n    newMeta.metadata = {\n      ...newMeta.metadata,\n      // We don't want to store matrix objects in the view config.\n      transform: { matrix: matrix.toArray() },\n    };\n    return newMeta;\n  });\n  return imageMetaWithTransform;\n}\n\n/**\n * Given a set of image layer loader creator functions,\n * create loader objects for an initial layer or set of layers,\n * which will be selected based on default values predefined in\n * the image data file or otherwise by a heuristic\n * (the midpoint of the layers array).\n * @param {object[]} rasterLayers A list of layer metadata objects with\n * shape { name, type, url, createLoader }.\n * @param {(string[]|null)} rasterRenderLayers A list of default raster layers. Optional.\n */\nexport async function initializeRasterLayersAndChannels(\n  rasterLayers,\n  rasterRenderLayers,\n  usePhysicalSizeScaling,\n) {\n  const nextImageLoaders = [];\n  let nextImageMetaAndLayers = [];\n  const autoImageLayerDefPromises = [];\n\n  // Start all loader creators immediately.\n  // Reference: https://eslint.org/docs/rules/no-await-in-loop\n  const loaders = await Promise.all(rasterLayers.map(layer => layer.loaderCreator()));\n\n  for (let i = 0; i < rasterLayers.length; i++) {\n    const layer = rasterLayers[i];\n    const loader = loaders[i];\n    nextImageLoaders[i] = loader;\n    nextImageMetaAndLayers[i] = layer;\n  }\n  if (usePhysicalSizeScaling) {\n    nextImageMetaAndLayers = getMetaWithTransformMatrices(nextImageMetaAndLayers, nextImageLoaders);\n  }\n  // No layers were pre-defined so set up the default image layers.\n  if (!rasterRenderLayers) {\n    // Midpoint of images list as default image to show.\n    const layerIndex = Math.floor(rasterLayers.length / 2);\n    const loader = nextImageLoaders[layerIndex];\n    const autoImageLayerDefPromise = initializeLayerChannels(loader)\n      .then(channels => Promise.resolve({\n        type: nextImageMetaAndLayers[layerIndex]?.metadata?.isBitmask ? 'bitmask' : 'raster',\n        index: layerIndex,\n        ...DEFAULT_RASTER_LAYER_PROPS,\n        channels: channels.map((channel, j) => ({\n          ...channel,\n          ...(nextImageMetaAndLayers[layerIndex].channels\n            ? nextImageMetaAndLayers[layerIndex].channels[j] : []),\n        })),\n        modelMatrix: nextImageMetaAndLayers[layerIndex]?.metadata?.transform?.matrix,\n        transparentColor: layerIndex > 0 ? [0, 0, 0] : null,\n      }));\n    autoImageLayerDefPromises.push(autoImageLayerDefPromise);\n  } else {\n    // The renderLayers parameter is a list of layer names to show by default.\n    const globalIndicesOfRenderLayers = rasterRenderLayers\n      .map(imageName => rasterLayers.findIndex(image => image.name === imageName));\n    for (let i = 0; i < globalIndicesOfRenderLayers.length; i++) {\n      const layerIndex = globalIndicesOfRenderLayers[i];\n      const loader = nextImageLoaders[layerIndex];\n      const autoImageLayerDefPromise = initializeLayerChannels(loader)\n        // eslint-disable-next-line no-loop-func\n        .then(channels => Promise.resolve({\n          type: nextImageMetaAndLayers[layerIndex]?.metadata?.isBitmask ? 'bitmask' : 'raster',\n          index: layerIndex,\n          ...DEFAULT_RASTER_LAYER_PROPS,\n          channels: channels.map((channel, j) => ({\n            ...channel,\n            ...(nextImageMetaAndLayers[layerIndex].channels\n              ? nextImageMetaAndLayers[layerIndex].channels[j] : []),\n          })),\n          domainType: 'Min/Max',\n          modelMatrix: nextImageMetaAndLayers[layerIndex]?.metadata?.transform?.matrix,\n          transparentColor: i > 0 ? [0, 0, 0] : null,\n        }));\n      autoImageLayerDefPromises.push(autoImageLayerDefPromise);\n    }\n  }\n\n  const autoImageLayerDefs = await Promise.all(autoImageLayerDefPromises);\n  return [autoImageLayerDefs, nextImageLoaders, nextImageMetaAndLayers];\n}\n\n/**\n * Make a subtitle for the spatial component.\n * @param {object} params\n * @param {number} params.observationsCount\n * @param {string} params.observationsLabel\n * @param {string} params.observationsPluralLabel\n * @param {number} params.subobservationsCount\n * @param {string} params.subobservationsLabel\n * @param {string} params.subobservationsPluralLabel\n * @param {number} params.locationsCount\n * @returns {string} The subtitle string,\n * with info about items with zero counts omitted.\n */\nexport function makeSpatialSubtitle({\n  observationsCount, observationsLabel, observationsPluralLabel,\n  subobservationsCount, subobservationsLabel, subobservationsPluralLabel,\n  locationsCount,\n}) {\n  const parts = [];\n  if (subobservationsCount > 0) {\n    let part = `${subobservationsCount} ${pluralize(subobservationsLabel, subobservationsPluralLabel, subobservationsCount)}`;\n    if (locationsCount > 0) {\n      part += ` at ${shortNumber(locationsCount)} locations`;\n    }\n    parts.push(part);\n  }\n  if (observationsCount > 0) {\n    parts.push(`${observationsCount} ${pluralize(observationsLabel, observationsPluralLabel, observationsCount)}`);\n  }\n  return parts.join(', ');\n}\n\nexport function getInitialSpatialTargets({\n  width,\n  height,\n  cells,\n  imageLayerLoaders,\n  useRaster,\n  use3d,\n}) {\n  let initialTargetX = -Infinity;\n  let initialTargetY = -Infinity;\n  let initialTargetZ = -Infinity;\n  let initialZoom = -Infinity;\n  // Some backoff from completely filling the screen.\n  const zoomBackoff = use3d ? 1.5 : 0.1;\n  const cellValues = Object.values(cells);\n  if (imageLayerLoaders.length > 0 && useRaster) {\n    for (let i = 0; i < imageLayerLoaders.length; i += 1) {\n      const viewSize = { height, width };\n      const { target, zoom: newViewStateZoom } = getDefaultInitialViewState(\n        imageLayerLoaders[i].data,\n        viewSize,\n        zoomBackoff,\n        use3d,\n      );\n      if (target[0] > initialTargetX) {\n        // eslint-disable-next-line prefer-destructuring\n        initialTargetX = target[0];\n        initialZoom = newViewStateZoom;\n      }\n      if (target[1] > initialTargetY) {\n        // eslint-disable-next-line prefer-destructuring\n        initialTargetY = target[1];\n        initialZoom = newViewStateZoom;\n      }\n      if (target[2] > initialTargetZ) {\n        // eslint-disable-next-line prefer-destructuring\n        initialTargetZ = target[2];\n        initialZoom = newViewStateZoom;\n      } else {\n        initialTargetZ = null;\n      }\n    }\n  } else if (cellValues.length > 0\n    // Only use cellValues in quadtree calculation if there is\n    // centroid data in the cells (i.e not just ids).\n    && cellValues[0].xy\n    && !useRaster) {\n    const cellCoordinates = cellValues.map(c => c.xy);\n    let xExtent = extent(cellCoordinates, c => c[0]);\n    let yExtent = extent(cellCoordinates, c => c[1]);\n    let xRange = xExtent[1] - xExtent[0];\n    let yRange = yExtent[1] - yExtent[0];\n    const getViewExtentFromPolygonExtents = extents => [\n      Math.min(...extents.map(i => i[0])),\n      Math.max(...extents.map(i => i[1])),\n    ];\n    if (xRange === 0) {\n      // The fall back is the cells' polygon coordinates, if the original range\n      // is 0 i.e the centroids are all on the same axis.\n      const polygonExtentsX = cellValues.map(cell => extent(cell.poly, i => i[0]));\n      xExtent = getViewExtentFromPolygonExtents(polygonExtentsX);\n      xRange = xExtent[1] - xExtent[0];\n    }\n    if (yRange === 0) {\n      // The fall back is the first cells' polygon coordinates, if the original range\n      // is 0 i.e the centroids are all on the same axis.\n      const polygonExtentsY = cellValues.map(cell => extent(cell.poly, i => i[1]));\n      yExtent = getViewExtentFromPolygonExtents(polygonExtentsY);\n      yRange = yExtent[1] - yExtent[0];\n    }\n    initialTargetX = xExtent[0] + xRange / 2;\n    initialTargetY = yExtent[0] + yRange / 2;\n    initialTargetZ = null;\n    initialZoom = Math.log2(Math.min(width / xRange, height / yRange)) - zoomBackoff;\n  } else {\n    return {\n      initialTargetX: null, initialTargetY: null, initialTargetZ: null, initialZoom: null,\n    };\n  }\n  return {\n    initialTargetX, initialTargetY, initialZoom, initialTargetZ,\n  };\n}\n\n/**\n * Make a subtitle for the spatial component.\n * @param {object} data PixelSource | PixelSource[]\n * @returns {Array} [Layer, PixelSource | PixelSource[]] tuple.\n */\nexport function getLayerLoaderTuple(data, use3d) {\n  const loader = ((Array.isArray(data) && data.length > 1) || !Array.isArray(data))\n    ? data : data[0];\n  if (use3d) {\n    return [VolumeLayer, Array.isArray(loader) ? loader : [loader]];\n  }\n  const Layer = (Array.isArray(data) && data.length > 1) ? MultiscaleImageLayer : ImageLayer;\n  return [Layer, loader];\n}\n\n\nexport function renderSubBitmaskLayers(props) {\n  const {\n    bbox: {\n      left, top, right, bottom,\n    },\n    x,\n    y,\n    z,\n  } = props.tile;\n  const {\n    data, id, loader,\n  } = props;\n  // Only render in positive coorinate system\n  if ([left, bottom, right, top].some(v => v < 0) || !data) {\n    return null;\n  }\n  const base = loader[0];\n  const [height, width] = loader[0].shape.slice(-2);\n  // Tiles are exactly fitted to have height and width such that their bounds\n  // match that of the actual image (not some padded version).\n  // Thus the right/bottom given by deck.gl are incorrect since\n  // they assume tiles are of uniform sizes, which is not the case for us.\n  const bounds = [\n    left,\n    data.height < base.tileSize ? height : bottom,\n    data.width < base.tileSize ? width : right,\n    top,\n  ];\n  return new BitmaskLayer(props, {\n    channelData: data,\n    // Uncomment to help debugging - shades the tile being hovered over.\n    // autoHighlight: true,\n    // highlightColor: [80, 80, 80, 50],\n    // Shared props with BitmapLayer:\n    bounds,\n    id: `sub-layer-${bounds}-${id}`,\n    tileId: { x, y, z },\n  });\n}\n", "import GL from '@luma.gl/constants'; // eslint-disable-line import/no-extraneous-dependencies\nimport { project32, picking } from '@deck.gl/core'; // eslint-disable-line import/no-extraneous-dependencies\nimport { Texture2D, isWebGL2 } from '@luma.gl/core';\nimport { XRLayer } from '@hms-dbmi/viv';\nimport { fs, vs } from './bitmask-layer-shaders';\nimport {\n  GLSL_COLORMAPS,\n  GLSL_COLORMAP_DEFAULT,\n  COLORMAP_SHADER_PLACEHOLDER,\n} from './constants';\n\nfunction padWithDefault(arr, defaultValue, padWidth) {\n  const newArr = [...arr];\n  for (let i = 0; i < padWidth; i += 1) {\n    newArr.push(defaultValue);\n  }\n  return newArr;\n}\n\nconst defaultProps = {\n  hoveredCell: { type: 'number', value: null, compare: true },\n  cellColorData: { type: 'object', value: null, compare: true },\n  colormap: { type: 'string', value: GLSL_COLORMAP_DEFAULT, compare: true },\n  expressionData: { type: 'object', value: null, compare: true },\n};\n\n/**\n * A BitmapLayer that performs aggregation in the fragment shader,\n * and renders its texture from a Uint8Array rather than an ImageData.\n */\nexport default class BitmaskLayer extends XRLayer {\n  // eslint-disable-next-line class-methods-use-this\n  getShaders() {\n    const { colormap } = this.props;\n    return {\n      fs,\n      vs,\n      modules: [project32, picking],\n      defines: {\n        [COLORMAP_SHADER_PLACEHOLDER]: GLSL_COLORMAPS.includes(colormap)\n          ? colormap\n          : GLSL_COLORMAP_DEFAULT,\n      },\n    };\n  }\n\n  updateState({ props, oldProps, changeFlags }) {\n    super.updateState({ props, oldProps, changeFlags });\n    if (props.cellColorData !== oldProps.cellColorData) {\n      this.setColorTexture();\n    }\n    if (props.expressionData !== oldProps.expressionData) {\n      const { expressionData, cellTexHeight, cellTexWidth } = this.props;\n      const expressionTex = this.dataToTexture(\n        expressionData,\n        cellTexWidth,\n        cellTexHeight,\n      );\n      this.setState({ expressionTex });\n    }\n    if (props.colormap !== oldProps.colormap) {\n      const { gl } = this.context;\n      if (this.state.model) {\n        this.state.model.delete();\n      }\n      // eslint-disable-next-line no-underscore-dangle\n      this.setState({ model: this._getModel(gl) });\n\n      this.getAttributeManager().invalidateAll();\n    }\n  }\n\n  setColorTexture() {\n    const {\n      cellColorData: data,\n      cellTexHeight: height,\n      cellTexWidth: width,\n    } = this.props;\n    const colorTex = new Texture2D(this.context.gl, {\n      width,\n      height,\n      // Only use Float32 so we don't have to write two shaders\n      data,\n      // we don't want or need mimaps\n      mipmaps: false,\n      parameters: {\n        // NEAREST for integer data\n        [GL.TEXTURE_MIN_FILTER]: GL.NEAREST,\n        [GL.TEXTURE_MAG_FILTER]: GL.NEAREST,\n        // CLAMP_TO_EDGE to remove tile artifacts\n        [GL.TEXTURE_WRAP_S]: GL.CLAMP_TO_EDGE,\n        [GL.TEXTURE_WRAP_T]: GL.CLAMP_TO_EDGE,\n      },\n      format: GL.RGB,\n      dataFormat: GL.RGB,\n      type: GL.UNSIGNED_BYTE,\n    });\n    this.setState({ colorTex });\n  }\n\n  draw(opts) {\n    const { uniforms } = opts;\n    const {\n      channelsVisible,\n      hoveredCell,\n      colorScaleLo,\n      colorScaleHi,\n      isExpressionMode,\n    } = this.props;\n    const {\n      textures, model, colorTex, expressionTex,\n    } = this.state;\n    // Render the image\n    if (textures && model && colorTex) {\n      model\n        .setUniforms(\n          Object.assign({}, uniforms, {\n            hovered: hoveredCell || 0,\n            colorTex,\n            expressionTex,\n            colorTexHeight: colorTex.height,\n            colorTexWidth: colorTex.width,\n            channelsVisible: padWithDefault(\n              channelsVisible,\n              false,\n              // There are six texture entries on the shaders\n              6 - channelsVisible.length,\n            ),\n            uColorScaleRange: [colorScaleLo, colorScaleHi],\n            uIsExpressionMode: isExpressionMode,\n            ...textures,\n          }),\n        )\n        .draw();\n    }\n  }\n\n  /**\n   * This function creates textures from the data\n   */\n  dataToTexture(data, width, height) {\n    const isWebGL2On = isWebGL2(this.context.gl);\n    return new Texture2D(this.context.gl, {\n      width,\n      height,\n      // Only use Float32 so we don't have to write two shaders\n      data: new Float32Array(data),\n      // we don't want or need mimaps\n      mipmaps: false,\n      parameters: {\n        // NEAREST for integer data\n        [GL.TEXTURE_MIN_FILTER]: GL.NEAREST,\n        [GL.TEXTURE_MAG_FILTER]: GL.NEAREST,\n        // CLAMP_TO_EDGE to remove tile artifacts\n        [GL.TEXTURE_WRAP_S]: GL.CLAMP_TO_EDGE,\n        [GL.TEXTURE_WRAP_T]: GL.CLAMP_TO_EDGE,\n      },\n      format: isWebGL2On ? GL.R32F : GL.LUMINANCE,\n      dataFormat: isWebGL2On ? GL.RED : GL.LUMINANCE,\n      type: GL.FLOAT,\n    });\n  }\n}\nBitmaskLayer.layerName = 'BitmaskLayer';\nBitmaskLayer.defaultProps = defaultProps;\n", "export var vs = \"\\n#define SHADER_NAME bitmask-layer-vertex-shader\\n\\nattribute vec2 texCoords;\\nattribute vec3 positions;\\nattribute vec3 positions64Low;\\nattribute vec3 instancePickingColors;\\n\\nvarying vec2 vTexCoord;\\n\\nvoid main(void) {\\n  geometry.worldPosition = positions;\\n  geometry.uv = texCoords;\\n  geometry.pickingColor = instancePickingColors;\\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\\n  vTexCoord = texCoords;\\n  vec4 color = vec4(0.0);\\n  DECKGL_FILTER_COLOR(color, geometry);\\n}\\n\";\nexport var fs = \"\\n#define SHADER_NAME bitmask-layer-fragment-shader\\nprecision highp float;\\n\\nvec4 plasma (float x_1306414511) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);\\n  float a0 = smoothstep(e0,e1,x_1306414511);\\n  float a1 = smoothstep(e1,e2,x_1306414511);\\n  float a2 = smoothstep(e2,e3,x_1306414511);\\n  float a3 = smoothstep(e3,e4,x_1306414511);\\n  float a4 = smoothstep(e4,e5,x_1306414511);\\n  float a5 = smoothstep(e5,e6,x_1306414511);\\n  float a6 = smoothstep(e6,e7,x_1306414511);\\n  float a7 = smoothstep(e7,e8,x_1306414511);\\n  return max(mix(v0,v1,a0)*step(e0,x_1306414511)*step(x_1306414511,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_1306414511)*step(x_1306414511,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_1306414511)*step(x_1306414511,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_1306414511)*step(x_1306414511,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_1306414511)*step(x_1306414511,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_1306414511)*step(x_1306414511,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_1306414511)*step(x_1306414511,e7),mix(v7,v8,a7)*step(e7,x_1306414511)*step(x_1306414511,e8)\\n  )))))));\\n}\\n\\nvec4 viridis (float x_1870111103) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);\\n  float a0 = smoothstep(e0,e1,x_1870111103);\\n  float a1 = smoothstep(e1,e2,x_1870111103);\\n  float a2 = smoothstep(e2,e3,x_1870111103);\\n  float a3 = smoothstep(e3,e4,x_1870111103);\\n  float a4 = smoothstep(e4,e5,x_1870111103);\\n  float a5 = smoothstep(e5,e6,x_1870111103);\\n  float a6 = smoothstep(e6,e7,x_1870111103);\\n  float a7 = smoothstep(e7,e8,x_1870111103);\\n  return max(mix(v0,v1,a0)*step(e0,x_1870111103)*step(x_1870111103,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_1870111103)*step(x_1870111103,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_1870111103)*step(x_1870111103,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_1870111103)*step(x_1870111103,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_1870111103)*step(x_1870111103,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_1870111103)*step(x_1870111103,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_1870111103)*step(x_1870111103,e7),mix(v7,v8,a7)*step(e7,x_1870111103)*step(x_1870111103,e8)\\n  )))))));\\n}\\n\\nvec4 greys (float x_1268378094) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_1268378094);\\n  return mix(v0,v1,a0)*step(e0,x_1268378094)*step(x_1268378094,e1);\\n}\\n\\nvec4 magma (float x_2443053725) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.01568627450980392,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);\\n  float a0 = smoothstep(e0,e1,x_2443053725);\\n  float a1 = smoothstep(e1,e2,x_2443053725);\\n  float a2 = smoothstep(e2,e3,x_2443053725);\\n  float a3 = smoothstep(e3,e4,x_2443053725);\\n  float a4 = smoothstep(e4,e5,x_2443053725);\\n  float a5 = smoothstep(e5,e6,x_2443053725);\\n  float a6 = smoothstep(e6,e7,x_2443053725);\\n  float a7 = smoothstep(e7,e8,x_2443053725);\\n  return max(mix(v0,v1,a0)*step(e0,x_2443053725)*step(x_2443053725,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_2443053725)*step(x_2443053725,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_2443053725)*step(x_2443053725,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_2443053725)*step(x_2443053725,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_2443053725)*step(x_2443053725,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_2443053725)*step(x_2443053725,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_2443053725)*step(x_2443053725,e7),mix(v7,v8,a7)*step(e7,x_2443053725)*step(x_2443053725,e8)\\n  )))))));\\n}\\n\\nvec4 jet (float x_623120303) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.5137254901960784,1);\\n  const float e1 = 0.125;\\n  const vec4 v1 = vec4(0,0.23529411764705882,0.6666666666666666,1);\\n  const float e2 = 0.375;\\n  const vec4 v2 = vec4(0.0196078431372549,1,1,1);\\n  const float e3 = 0.625;\\n  const vec4 v3 = vec4(1,1,0,1);\\n  const float e4 = 0.875;\\n  const vec4 v4 = vec4(0.9803921568627451,0,0,1);\\n  const float e5 = 1.0;\\n  const vec4 v5 = vec4(0.5019607843137255,0,0,1);\\n  float a0 = smoothstep(e0,e1,x_623120303);\\n  float a1 = smoothstep(e1,e2,x_623120303);\\n  float a2 = smoothstep(e2,e3,x_623120303);\\n  float a3 = smoothstep(e3,e4,x_623120303);\\n  float a4 = smoothstep(e4,e5,x_623120303);\\n  return max(mix(v0,v1,a0)*step(e0,x_623120303)*step(x_623120303,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_623120303)*step(x_623120303,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_623120303)*step(x_623120303,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_623120303)*step(x_623120303,e4),mix(v4,v5,a4)*step(e4,x_623120303)*step(x_623120303,e5)\\n  ))));\\n}\\n\\nvec4 bone (float x_783795047) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.376;\\n  const vec4 v1 = vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);\\n  const float e2 = 0.753;\\n  const vec4 v2 = vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);\\n  const float e3 = 1.0;\\n  const vec4 v3 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_783795047);\\n  float a1 = smoothstep(e1,e2,x_783795047);\\n  float a2 = smoothstep(e2,e3,x_783795047);\\n  return max(mix(v0,v1,a0)*step(e0,x_783795047)*step(x_783795047,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_783795047)*step(x_783795047,e2),mix(v2,v3,a2)*step(e2,x_783795047)*step(x_783795047,e3)\\n  ));\\n}\\n\\nvec4 copper (float x_3932431844) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.804;\\n  const vec4 v1 = vec4(1,0.6274509803921569,0.4,1);\\n  const float e2 = 1.0;\\n  const vec4 v2 = vec4(1,0.7803921568627451,0.4980392156862745,1);\\n  float a0 = smoothstep(e0,e1,x_3932431844);\\n  float a1 = smoothstep(e1,e2,x_3932431844);\\n  return max(mix(v0,v1,a0)*step(e0,x_3932431844)*step(x_3932431844,e1),mix(v1,v2,a1)*step(e1,x_3932431844)*step(x_3932431844,e2)\\n  );\\n}\\n\\nvec4 density (float x_2921433544) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);\\n  float a0 = smoothstep(e0,e1,x_2921433544);\\n  float a1 = smoothstep(e1,e2,x_2921433544);\\n  float a2 = smoothstep(e2,e3,x_2921433544);\\n  float a3 = smoothstep(e3,e4,x_2921433544);\\n  float a4 = smoothstep(e4,e5,x_2921433544);\\n  float a5 = smoothstep(e5,e6,x_2921433544);\\n  float a6 = smoothstep(e6,e7,x_2921433544);\\n  float a7 = smoothstep(e7,e8,x_2921433544);\\n  return max(mix(v0,v1,a0)*step(e0,x_2921433544)*step(x_2921433544,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_2921433544)*step(x_2921433544,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_2921433544)*step(x_2921433544,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_2921433544)*step(x_2921433544,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_2921433544)*step(x_2921433544,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_2921433544)*step(x_2921433544,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_2921433544)*step(x_2921433544,e7),mix(v7,v8,a7)*step(e7,x_2921433544)*step(x_2921433544,e8)\\n  )))))));\\n}\\n\\nvec4 inferno (float x_1987546174) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.01568627450980392,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8901960784313725,0.34901960784313724,0.2,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9882352941176471,1,0.6431372549019608,1);\\n  float a0 = smoothstep(e0,e1,x_1987546174);\\n  float a1 = smoothstep(e1,e2,x_1987546174);\\n  float a2 = smoothstep(e2,e3,x_1987546174);\\n  float a3 = smoothstep(e3,e4,x_1987546174);\\n  float a4 = smoothstep(e4,e5,x_1987546174);\\n  float a5 = smoothstep(e5,e6,x_1987546174);\\n  float a6 = smoothstep(e6,e7,x_1987546174);\\n  float a7 = smoothstep(e7,e8,x_1987546174);\\n  return max(mix(v0,v1,a0)*step(e0,x_1987546174)*step(x_1987546174,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_1987546174)*step(x_1987546174,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_1987546174)*step(x_1987546174,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_1987546174)*step(x_1987546174,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_1987546174)*step(x_1987546174,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_1987546174)*step(x_1987546174,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_1987546174)*step(x_1987546174,e7),mix(v7,v8,a7)*step(e7,x_1987546174)*step(x_1987546174,e8)\\n  )))))));\\n}\\n\\nvec4 cool (float x_761030515) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.49019607843137253,0,0.7019607843137254,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.4549019607843137,0,0.8549019607843137,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0,0.8,0.7725490196078432,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0,0.9686274509803922,0.5725490196078431,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0,1,0.34509803921568627,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.1568627450980392,1,0.03137254901960784,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.5764705882352941,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_761030515);\\n  float a1 = smoothstep(e1,e2,x_761030515);\\n  float a2 = smoothstep(e2,e3,x_761030515);\\n  float a3 = smoothstep(e3,e4,x_761030515);\\n  float a4 = smoothstep(e4,e5,x_761030515);\\n  float a5 = smoothstep(e5,e6,x_761030515);\\n  float a6 = smoothstep(e6,e7,x_761030515);\\n  float a7 = smoothstep(e7,e8,x_761030515);\\n  return max(mix(v0,v1,a0)*step(e0,x_761030515)*step(x_761030515,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_761030515)*step(x_761030515,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_761030515)*step(x_761030515,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_761030515)*step(x_761030515,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_761030515)*step(x_761030515,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_761030515)*step(x_761030515,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_761030515)*step(x_761030515,e7),mix(v7,v8,a7)*step(e7,x_761030515)*step(x_761030515,e8)\\n  )))))));\\n}\\n\\nvec4 hot (float x_180130041) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.3;\\n  const vec4 v1 = vec4(0.9019607843137255,0,0,1);\\n  const float e2 = 0.6;\\n  const vec4 v2 = vec4(1,0.8235294117647058,0,1);\\n  const float e3 = 1.0;\\n  const vec4 v3 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_180130041);\\n  float a1 = smoothstep(e1,e2,x_180130041);\\n  float a2 = smoothstep(e2,e3,x_180130041);\\n  return max(mix(v0,v1,a0)*step(e0,x_180130041)*step(x_180130041,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_180130041)*step(x_180130041,e2),mix(v2,v3,a2)*step(e2,x_180130041)*step(x_180130041,e3)\\n  ));\\n}\\n\\nvec4 spring (float x_755571360) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(1,0,1,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_755571360);\\n  return mix(v0,v1,a0)*step(e0,x_755571360)*step(x_755571360,e1);\\n}\\n\\nvec4 summer (float x_2651158874) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0.5019607843137255,0.4,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0.4,1);\\n  float a0 = smoothstep(e0,e1,x_2651158874);\\n  return mix(v0,v1,a0)*step(e0,x_2651158874)*step(x_2651158874,e1);\\n}\\n\\nvec4 autumn (float x_626866098) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(1,0,0,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_626866098);\\n  return mix(v0,v1,a0)*step(e0,x_626866098)*step(x_626866098,e1);\\n}\\n\\nvec4 winter (float x_2098958741) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,1,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(0,1,0.5019607843137255,1);\\n  float a0 = smoothstep(e0,e1,x_2098958741);\\n  return mix(v0,v1,a0)*step(e0,x_2098958741)*step(x_2098958741,e1);\\n}\\n\\n// Data (mask) texture\\nuniform sampler2D channel0;\\nuniform sampler2D channel1;\\nuniform sampler2D channel2;\\nuniform sampler2D channel3;\\nuniform sampler2D channel4;\\nuniform sampler2D channel5;\\n\\n// Color texture\\nuniform sampler2D colorTex;\\nuniform float colorTexHeight;\\nuniform float colorTexWidth;\\nuniform float hovered;\\n// range\\nuniform bool channelsVisible[6];\\n\\n// Expression mapping\\nuniform vec2 uColorScaleRange;\\nuniform bool uIsExpressionMode;\\nuniform sampler2D expressionTex;\\n\\n// opacity\\nuniform float opacity;\\n\\nvarying vec2 vTexCoord;\\n\\nvec4 sampleAndGetColor(sampler2D dataTex, vec2 coord, bool isOn){\\n  float sampledData = texture(dataTex, coord).r;\\n  vec4 hoveredColor = float(sampledData == hovered && sampledData > 0. && hovered > 0.) * vec4(0., 0., 1., 1.);\\n  // Colors are laid out corresponding to ids in row-major order in the texture.  So if width of the texture is 10, and you want ID 25,\\n  // you need coordinate (1, 4) (i.e 2 rows down, and 5 columns over indexed from 0 for a total of 25 units covered in row major order).\\n  vec2 colorTexCoord = vec2(mod(sampledData, colorTexWidth) / colorTexWidth, floor(sampledData / colorTexWidth) / (colorTexHeight - 1.));\\n  float expressionValue = texture(expressionTex, colorTexCoord).r / 255.;\\n  float scaledExpressionValue = (expressionValue - uColorScaleRange[0]) / max(0.005, (uColorScaleRange[1] - uColorScaleRange[0]));\\n  vec4 sampledColor = float(uIsExpressionMode) * COLORMAP_FUNC(clamp(scaledExpressionValue, 0.0, 1.0)) +  (1. - float(uIsExpressionMode)) * vec4(texture(colorTex, colorTexCoord).rgb, 1.);\\n  // Only return a color if the data is non-zero.\\n  return max(0., min(sampledData, 1.)) * float(isOn) * (sampledColor + hoveredColor);\\n}\\n\\nvoid main() {\\n\\n  gl_FragColor = sampleAndGetColor(channel0, vTexCoord, channelsVisible[0]);\\n\\n  // If the sampled color and the currently stored color (gl_FragColor) are identical, don't blend and use the sampled color,\\n  // otherwise just use the currently stored color.  Repeat this for all channels.\\n  vec4 sampledColor = sampleAndGetColor(channel1, vTexCoord, channelsVisible[1]);\\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\\n  sampledColor = sampleAndGetColor(channel2, vTexCoord, channelsVisible[2]);\\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\\n  sampledColor = sampleAndGetColor(channel3, vTexCoord, channelsVisible[3]);\\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\\n  sampledColor = sampleAndGetColor(channel4, vTexCoord, channelsVisible[4]);\\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\\n  sampledColor = sampleAndGetColor(channel5, vTexCoord, channelsVisible[5]);\\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\\n  // Apply the opacity if there is pixel data, and if the pixel data is empty i.e no segmentation, use 0 opacity.\\n  gl_FragColor = vec4(gl_FragColor.rgb, (gl_FragColor.rgb == vec3(0., 0., 0.)) ? 0.0 : opacity);\\n\\n  geometry.uv = vTexCoord;\\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\\n}\\n\";", "import { getChannelStats } from '@hms-dbmi/viv';\nimport { Matrix4 } from 'math.gl';\n\nasync function getSingleSelectionStats2D({ loader, selection }) {\n  const data = Array.isArray(loader) ? loader[loader.length - 1] : loader;\n  const raster = await data.getRaster({ selection });\n  const selectionStats = getChannelStats(raster.data);\n  const { domain, contrastLimits: slider } = selectionStats;\n  return { domain, slider };\n}\n\nasync function getSingleSelectionStats3D({ loader, selection }) {\n  const lowResSource = loader[loader.length - 1];\n  const { shape, labels } = lowResSource;\n  // eslint-disable-next-line no-bitwise\n  const sizeZ = shape[labels.indexOf('z')] >> (loader.length - 1);\n  const raster0 = await lowResSource.getRaster({\n    selection: { ...selection, z: 0 },\n  });\n  const rasterMid = await lowResSource.getRaster({\n    selection: { ...selection, z: Math.floor(sizeZ / 2) },\n  });\n  const rasterTop = await lowResSource.getRaster({\n    selection: { ...selection, z: Math.max(0, sizeZ - 1) },\n  });\n  const stats0 = getChannelStats(raster0.data);\n  const statsMid = getChannelStats(rasterMid.data);\n  const statsTop = getChannelStats(rasterTop.data);\n  return {\n    domain: [\n      Math.min(stats0.domain[0], statsMid.domain[0], statsTop.domain[0]),\n      Math.max(stats0.domain[1], statsMid.domain[1], statsTop.domain[1]),\n    ],\n    slider: [\n      Math.min(\n        stats0.contrastLimits[0],\n        statsMid.contrastLimits[0],\n        statsTop.contrastLimits[0],\n      ),\n      Math.max(\n        stats0.contrastLimits[1],\n        statsMid.contrastLimits[1],\n        statsTop.contrastLimits[1],\n      ),\n    ],\n  };\n}\n\n/**\n * Get bounding cube for a given loader i.e [[0, width], [0, height], [0, depth]]\n * @param {Object} loader PixelSource|PixelSource[]\n * @param {[]} selection Selection for stats.\n * @param {boolean} use3d Whether or not to get 3d stats.\n * @returns {Object} { domains, sliders }\n */\nexport const getSingleSelectionStats = async ({ loader, selection, use3d }) => {\n  const getStats = use3d\n    ? getSingleSelectionStats3D\n    : getSingleSelectionStats2D;\n  return getStats({ loader, selection });\n};\n\nexport const getMultiSelectionStats = async ({ loader, selections, use3d }) => {\n  const stats = await Promise.all(\n    selections.map(selection => getSingleSelectionStats({ loader, selection, use3d })),\n  );\n  const domains = stats.map(stat => stat.domain);\n  const sliders = stats.map(stat => stat.slider);\n  return { domains, sliders };\n};\n\n/**\n * Get physical size scaling Matrix4\n * @param {Object} loader PixelSource\n * @returns {Object} matrix\n */\nexport function getPhysicalSizeScalingMatrix(loader) {\n  const { x, y, z } = loader?.meta?.physicalSizes ?? {};\n  if (x?.size && y?.size && z?.size) {\n    const min = Math.min(z.size, x.size, y.size);\n    const ratio = [x.size / min, y.size / min, z.size / min];\n    return new Matrix4().scale(ratio);\n  }\n  return new Matrix4().identity();\n}\n\n/**\n * Get bounding cube for a given loader\n * @param {Object} loader PixelSource|PixelSource[]\n * @returns {Array} [0, width], [0, height], [0, depth]]\n */\nexport function getBoundingCube(loader) {\n  const source = Array.isArray(loader) ? loader[0] : loader;\n  const { shape, labels } = source;\n  const physicalSizeScalingMatrix = getPhysicalSizeScalingMatrix(source);\n  const xSlice = [0, physicalSizeScalingMatrix[0] * shape[labels.indexOf('x')]];\n  const ySlice = [0, physicalSizeScalingMatrix[5] * shape[labels.indexOf('y')]];\n  const zSlice = [\n    0,\n    physicalSizeScalingMatrix[10] * shape[labels.indexOf('z')],\n  ];\n  return [xSlice, ySlice, zSlice];\n}\n\nexport function abbreviateNumber(value) {\n  // Return an abbreviated representation of value, in 5 characters or less.\n\n  const maxLength = 5;\n  let maxNaiveDigits = maxLength;\n\n  /* eslint-disable no-plusplus */\n  if (!Number.isInteger(value)) {\n    --maxNaiveDigits;\n  } // Wasted on \".\"\n  if (value < 1) {\n    --maxNaiveDigits;\n  } // Wasted on \"0.\"\n  /* eslint-disable no-plusplus */\n\n  const naive = Intl.NumberFormat('en-US', {\n    maximumSignificantDigits: maxNaiveDigits,\n    useGrouping: false,\n  }).format(value);\n  if (naive.length <= maxLength) return naive;\n\n  // \"e+9\" consumes 3 characters, so if we even had two significant digits,\n  // it would take take us to six characters, including the decimal point.\n  return value.toExponential(0);\n}\n", "import React, { PureComponent } from 'react';\nimport DeckGL, { OrthographicView, OrbitView } from 'deck.gl';\nimport ToolMenu from './ToolMenu';\nimport { DEFAULT_GL_OPTIONS } from '../utils';\nimport { getCursor, getCursorWithTool } from './cursor';\n\n/**\n * Abstract class component intended to be inherited by\n * the Spatial and Scatterplot class components.\n * Contains a common constructor, common DeckGL callbacks,\n * and common render function.\n */\nexport default class AbstractSpatialOrScatterplot extends PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      gl: null,\n      tool: null,\n    };\n\n    this.viewport = null;\n\n    this.onViewStateChange = this.onViewStateChange.bind(this);\n    this.onInitializeViewInfo = this.onInitializeViewInfo.bind(this);\n    this.onWebGLInitialized = this.onWebGLInitialized.bind(this);\n    this.onToolChange = this.onToolChange.bind(this);\n    this.onHover = this.onHover.bind(this);\n  }\n\n  /**\n   * Called by DeckGL upon a viewState change,\n   * for example zoom or pan interaction.\n   * Emit the new viewState to the `setViewState`\n   * handler prop.\n   * @param {object} params\n   * @param {object} params.viewState The next deck.gl viewState.\n   */\n  onViewStateChange({ viewState: nextViewState }) {\n    const {\n      setViewState, viewState, layers, spatialAxisFixed,\n    } = this.props;\n    const use3d = layers?.some(l => l.use3d);\n    setViewState({\n      ...nextViewState,\n      // If the axis is fixed, just use the current target in state i.e don't change target.\n      target: spatialAxisFixed && use3d ? viewState.target : nextViewState.target,\n    });\n  }\n\n  /**\n   * Called by DeckGL upon viewport\n   * initialization.\n   * @param {object} viewState\n   * @param {object} viewState.viewport\n   */\n  onInitializeViewInfo({ viewport }) {\n    this.viewport = viewport;\n  }\n\n  /**\n   * Called by DeckGL upon initialization,\n   * helps to understand when to pass layers\n   * to the DeckGL component.\n   * @param {object} gl The WebGL context object.\n   */\n  onWebGLInitialized(gl) {\n    this.setState({ gl });\n  }\n\n  /**\n   * Called by the ToolMenu buttons.\n   * Emits the new tool value to the\n   * `onToolChange` prop.\n   * @param {string} tool Name of tool.\n   */\n  onToolChange(tool) {\n    const { onToolChange: onToolChangeProp } = this.props;\n    this.setState({ tool });\n    if (onToolChangeProp) {\n      onToolChangeProp(tool);\n    }\n  }\n\n  /**\n   * Create the DeckGL layers.\n   * @returns {object[]} Array of\n   * DeckGL layer objects.\n   * Intended to be overriden by descendants.\n   */\n  // eslint-disable-next-line class-methods-use-this\n  getLayers() {\n    return [];\n  }\n\n  // eslint-disable-next-line consistent-return\n  onHover(info) {\n    const {\n      coordinate, sourceLayer: layer, tile,\n    } = info;\n    const {\n      setCellHighlight, cellHighlight, setComponentHover, layers,\n    } = this.props;\n    const hasBitmask = (layers || []).some(l => l.type === 'bitmask');\n    if (!setCellHighlight || !tile) {\n      return null;\n    }\n    if (!layer || !coordinate) {\n      if (cellHighlight && hasBitmask) {\n        setCellHighlight(null);\n      }\n      return null;\n    }\n    const { content, bbox, z } = tile;\n    if (!content) {\n      if (cellHighlight && hasBitmask) {\n        setCellHighlight(null);\n      }\n      return null;\n    }\n    const { data, width, height } = content;\n    const {\n      left, right, top, bottom,\n    } = bbox;\n    const bounds = [\n      left,\n      data.height < layer.tileSize ? height : bottom,\n      data.width < layer.tileSize ? width : right,\n      top,\n    ];\n    if (!data) {\n      if (cellHighlight && hasBitmask) {\n        setCellHighlight(null);\n      }\n      return null;\n    }\n    // Tiled layer needs a custom layerZoomScale.\n    if (layer.id.includes('bitmask')) {\n      // The zoomed out layer needs to use the fixed zoom at which it is rendered.\n      const layerZoomScale = Math.max(\n        1,\n        2 ** Math.round(-z),\n      );\n      const dataCoords = [\n        Math.floor((coordinate[0] - bounds[0]) / layerZoomScale),\n        Math.floor((coordinate[1] - bounds[3]) / layerZoomScale),\n      ];\n      const coords = dataCoords[1] * width + dataCoords[0];\n      const hoverData = data.map(d => d[coords]);\n      const cellId = hoverData.find(i => i > 0);\n      if (cellId !== Number(cellHighlight)) {\n        if (setComponentHover) {\n          setComponentHover();\n        }\n        // eslint-disable-next-line no-unused-expressions\n        setCellHighlight(cellId ? String(cellId) : null);\n      }\n    }\n  }\n\n  /**\n   * Emits a function to project from the\n   * cell ID space to the scatterplot or\n   * spatial coordinate space, via the\n   * `updateViewInfo` prop.\n   */\n  viewInfoDidUpdate(getCellCoords) {\n    const { updateViewInfo, cells, uuid } = this.props;\n    const { viewport } = this;\n    if (updateViewInfo && viewport) {\n      updateViewInfo({\n        uuid,\n        project: (cellId) => {\n          const cell = cells[cellId];\n          try {\n            const [positionX, positionY] = getCellCoords(cell);\n            return viewport.project([positionX, positionY]);\n          } catch (e) {\n            return [null, null];\n          }\n        },\n      });\n    }\n  }\n\n  /**\n   * Intended to be overriden by descendants.\n   */\n  componentDidUpdate() {\n\n  }\n\n  /**\n   * A common render function for both Spatial\n   * and Scatterplot components.\n   */\n  render() {\n    const {\n      deckRef, viewState, uuid, layers: layerProps,\n    } = this.props;\n    const { gl, tool } = this.state;\n    const layers = this.getLayers();\n    const use3d = (layerProps || []).some(l => l.use3d);\n\n    const showCellSelectionTools = this.cellsLayer !== null\n      || (this.cellsEntries.length && this.cellsEntries[0][1].xy);\n    const showPanTool = this.cellsLayer !== null || layerProps.findIndex(l => l.type === 'bitmask' || l.type === 'raster') >= 0;\n    // For large datasets or ray casting, the visual quality takes only a small\n    // hit in exchange for much better performance by setting this to false:\n    // https://deck.gl/docs/api-reference/core/deck#usedevicepixels\n    const useDevicePixels = this.cellsEntries.length < 100000 && !use3d;\n\n    return (\n      <>\n        <ToolMenu\n          activeTool={tool}\n          setActiveTool={this.onToolChange}\n          visibleTools={{\n            pan: showPanTool,\n            selectRectangle: showCellSelectionTools,\n            selectLasso: showCellSelectionTools,\n          }}\n        />\n        <DeckGL\n          id={`deckgl-overlay-${uuid}`}\n          ref={deckRef}\n          views={[\n            use3d\n              ? new OrbitView({ id: 'orbit', controller: true, orbitAxis: 'Y' })\n              : new OrthographicView({\n                id: 'ortho',\n              }),\n          ]} // id is a fix for https://github.com/uber/deck.gl/issues/3259\n          layers={\n            gl && viewState.target.slice(0, 2).every(i => typeof i === 'number')\n              ? layers\n              : []\n          }\n          glOptions={DEFAULT_GL_OPTIONS}\n          onWebGLInitialized={this.onWebGLInitialized}\n          onViewStateChange={this.onViewStateChange}\n          viewState={viewState}\n          useDevicePixels={useDevicePixels}\n          controller={tool ? { dragPan: false } : true}\n          getCursor={tool ? getCursorWithTool : getCursor}\n          onHover={this.onHover}\n        >\n          {this.onInitializeViewInfo}\n        </DeckGL>\n      </>\n    );\n  }\n}\n", "import React from 'react';\nimport { SELECTION_TYPE } from 'nebula.gl';\nimport { ReactComponent as PointerIconSVG } from '../../assets/tools/near_me.svg';\nimport { ReactComponent as SelectRectangleIconSVG } from '../../assets/tools/selection_rectangle.svg';\nimport { ReactComponent as SelectLassoIconSVG } from '../../assets/tools/selection_lasso.svg';\n\nexport function IconButton(props) {\n  const {\n    alt, onClick, isActive, children,\n  } = props;\n  const inactive = 'btn btn-outline-secondary mr-2 icon';\n  const active = `${inactive} active`;\n  return (\n    <button\n      className={isActive ? active : inactive}\n      onClick={onClick}\n      type=\"button\"\n      title={alt}\n    >\n      {children}\n    </button>\n  );\n}\n\nexport default function ToolMenu(props) {\n  const {\n    setActiveTool,\n    activeTool,\n    visibleTools = { pan: true, selectRectangle: true, selectLasso: true },\n  } = props;\n  return (\n    <div className=\"tool\">\n      {visibleTools.pan && (\n      <IconButton\n        alt=\"pointer tool\"\n        onClick={() => setActiveTool(null)}\n        isActive={activeTool === null}\n      ><PointerIconSVG />\n      </IconButton>\n      )}\n      {visibleTools.selectRectangle ? (\n        <IconButton\n          alt=\"select rectangle\"\n          onClick={() => setActiveTool(SELECTION_TYPE.RECTANGLE)}\n          isActive={activeTool === SELECTION_TYPE.RECTANGLE}\n        ><SelectRectangleIconSVG />\n        </IconButton>\n      ) : null}\n      {visibleTools.selectLasso ? (\n        <IconButton\n          alt=\"select lasso\"\n          onClick={() => setActiveTool(SELECTION_TYPE.POLYGON)}\n          isActive={activeTool === SELECTION_TYPE.POLYGON}\n        ><SelectLassoIconSVG />\n        </IconButton>\n      ) : null}\n    </div>\n  );\n}\n", "import * as React from \"react\";\n\nfunction SvgNearMe(props) {\n  return <svg width={24} height={24} viewBox=\"0 0 24 24\" {...props}><path fill=\"none\" d=\"M0 0h24v24H0V0z\" /><path d=\"M21 3L3 10.53v.98l6.84 2.65L12.48 21h.98L21 3z\" /></svg>;\n}\n\nexport const ReactComponent = SvgNearMe;", "import * as React from \"react\";\n\nfunction SvgSelectionRectangle(props) {\n  return <svg width={24} height={24} viewBox=\"0 0 24 24\" {...props}><path d=\"       M19 19h2v2h-2v-2zm0-2h2v-2h-2v2z       M3 13h2v-2H3v2zm0 4h2v-2H3v2z       m0-8h2V7H3v2zm0-4h2V3H3v2z       m4 0h2V3H7v2zm8 16h2v-2h-2v2z       m-4 0h2v-2h-2v2z       m4 0h2v-2h-2v2z       m-8 0h2v-2H7v2z       m-4 0h2v-2H3v2z       M11 5h2v-2h-2v2z       M15 5h2v-2h-2v2z       M19 5h2v-2h-2v2z       M19 9h2v-2h-2v2z       M19 13h2v-2h-2v2z     \" /></svg>;\n}\n\nexport const ReactComponent = SvgSelectionRectangle;", "import * as React from \"react\";\n\nfunction SvgSelectionLasso(props) {\n  return <svg width={24} height={24} viewBox=\"0 0 24 24\" {...props}><g transform=\"translate(0,3)\"><path style={{\n        strokeWidth: 0.343565\n      }} d=\"M 23.942314,4.6958443 C 23.446206,1.8868581 19.727461,0 14.687364,0 13.437819,0 12.150138,0.11543779 10.859708,0.34287772 4.1629423,1.5250844 -0.58168816,5.2884937 0.05768601,8.911385 c 0.25355086,1.439193 1.35605049,2.63583 3.04638949,3.461072 -0.2569865,0.387198 -0.4074679,0.826617 -0.4074679,1.29524 0,1.337498 1.1863293,2.457176 2.7639791,2.728248 l -1.3615475,2.333149 c -0.1576963,0.271073 -0.066308,0.61876 0.2047647,0.776457 0.090014,0.05291 0.1886171,0.07799 0.2858459,0.07799 0.1951448,0 0.3851362,-0.100665 0.4912977,-0.281723 l 1.6803757,-2.88148 C 8.41868,16.20561 9.6895264,15.063601 9.6998333,13.683844 c 6.872e-4,-0.0055 0.00137,-0.01065 0.00137,-0.01615 0,-0.02336 -0.00344,-0.04569 -0.00481,-0.06837 1.1292977,-0.0213 2.2847067,-0.130211 3.4435507,-0.334975 6.69711,-1.181863 11.44174,-4.9456164 10.802366,-8.5685077 z M 3.83312,13.667353 c 0,-0.30749 0.1281497,-0.59849 0.3470005,-0.848261 0.1219655,0.04295 0.2456489,0.08383 0.3717372,0.123339 l 1.2234344,2.352045 C 4.6865351,15.149835 3.83312,14.46408 3.83312,13.667353 Z M 7.0141869,15.216144 6.0223152,13.309702 5.4008064,12.114097 c 0.121622,-0.03161 0.2477103,-0.05634 0.3772342,-0.07387 0.1367388,-0.0189 0.2772568,-0.02886 0.420867,-0.02886 0.5067581,0 0.980534,0.11956 1.3701366,0.317454 0.5696305,0.289968 0.9554538,0.750345 0.9904974,1.262944 0.00137,0.02542 0.0055,0.05016 0.0055,0.07593 0,0.698124 -0.6562089,1.310356 -1.5508518,1.548447 z m 5.9185921,-3.126441 c -1.217251,0.214728 -2.429691,0.323982 -3.6060571,0.324669 -0.5765018,-0.911821 -1.7614569,-1.53917 -3.1278143,-1.53917 -0.4717146,0 -0.921441,0.07593 -1.332001,0.211292 -0.3061162,0.100665 -0.5878394,0.237403 -0.8427645,0.39991 C 2.4598914,10.828133 1.4360682,9.8579062 1.2319907,8.7035283 0.72660678,5.8381974 5.2307418,2.5475333 11.067221,1.5175259 c 1.222061,-0.2161023 2.439998,-0.3246688 3.620143,-0.3246688 4.371863,0 7.694479,1.5250844 8.080645,3.7101568 0.505041,2.8653309 -3.998751,6.1566821 -9.83523,7.1866891 z\" id=\"path10\" /></g></svg>;\n}\n\nexport const ReactComponent = SvgSelectionLasso;", "export const getCursorWithTool = () => 'crosshair';\nexport const getCursor = interactionState => (interactionState.isDragging\n  ? 'grabbing' : 'default'\n);\n", "import { quadtree } from 'd3-quadtree';\n\n/**\n * Create a d3-quadtree object for cells data points.\n * @param {array} cellsEntries Array of [cellId, cell] tuples,\n * resulting from running Object.entries on the cells object.\n * @param {function} getCellCoords Given a cell object, return the\n * spatial/scatterplot coordinates [x, y].\n * @returns {object} Quadtree instance.\n */\nexport function createCellsQuadTree(cellsEntries, getCellCoords) {\n  // Use the cellsEntries variable since it is already\n  // an array, converted by Object.entries().\n  // Only use cellsEntries in quadtree calculation if there is\n  // centroid data in the cells (i.e not just ids).\n  // eslint-disable-next-line no-unused-vars\n  if (!cellsEntries || !cellsEntries.length || !getCellCoords(cellsEntries[0][1])) {\n    // Abort if the cells data is not yet available.\n    return null;\n  }\n  const tree = quadtree()\n    .x(d => getCellCoords(d[1])[0])\n    .y(d => getCellCoords(d[1])[1])\n    .addAll(cellsEntries);\n  return tree;\n}\n", "/* eslint-disable no-underscore-dangle */\n/* eslint-disable import/no-extraneous-dependencies */\nimport GL from '@luma.gl/constants';\nimport { LayerExtension } from '@deck.gl/core';\nimport { GLSL_COLORMAPS, GLSL_COLORMAP_DEFAULT, COLORMAP_SHADER_PLACEHOLDER } from '../../layers/constants';\nimport module from './shader-module';\n\nconst defaultProps = {\n  colormap: { type: 'string', value: GLSL_COLORMAP_DEFAULT, compare: true },\n  colorScaleLo: { type: 'number', value: 0.0, compare: true },\n  colorScaleHi: { type: 'number', value: 1.0, compare: true },\n  isExpressionMode: false,\n  getExpressionValue: { type: 'accessor', value: 0 },\n  getSelectionState: { type: 'accessor', value: 0.0 },\n};\n\nexport default class ScaledExpressionExtension extends LayerExtension {\n  getShaders() {\n    const { colormap } = this.props;\n    return {\n      modules: [module],\n      defines: {\n        [COLORMAP_SHADER_PLACEHOLDER]: GLSL_COLORMAPS.includes(colormap)\n          ? colormap\n          : GLSL_COLORMAP_DEFAULT,\n      },\n    };\n  }\n\n  updateState({ props, oldProps }) {\n    if (props.colormap !== oldProps.colormap) {\n      const { gl } = this.context;\n      // Normal single model layers, like ScatterplotLayer\n      if (this.state.model) {\n        // eslint-disable-next-line no-unused-expressions\n        this.state.model?.delete();\n        this.state.model = this._getModel(gl);\n      } else {\n        // Special handling for PolygonLayer sublayer models.\n        if (this.state.models) {\n          // eslint-disable-next-line no-unused-expressions\n          this.state.models?.forEach(model => model?.delete());\n        }\n        if (this.state.topModel) {\n           // eslint-disable-next-line no-unused-expressions\n           this.state.topModel?.delete();\n        }\n        if (this.state.sideModel) {\n           // eslint-disable-next-line no-unused-expressions\n           this.state.sideModel?.delete();\n        }\n        if (this._getModels) {\n          this.setState(this._getModels(this.context.gl));\n        }\n      }\n      const attributeManager = this.getAttributeManager();\n      if (attributeManager) {\n        this.getAttributeManager().invalidateAll();\n      }\n    }\n  }\n\n  initializeState() {\n    const layer = this.getCurrentLayer();\n    // No need to run this on layers that don't have a `draw` call.\n    if (layer.isComposite) {\n      return;\n    }\n    const attributeManager = this.getAttributeManager();\n    if (attributeManager) {\n      // This attributes is the array of expression data needed for\n      // coloring cells against the colormap.\n      attributeManager.add({\n        expressionValue: {\n          type: GL.FLOAT,\n          size: 1,\n          transition: true,\n          accessor: 'getExpressionValue',\n          defaultValue: 1,\n          // PolygonLayer fill needs not-intsanced attribute but\n          // ScatterplotLayer and the PolygonLayer stroke needs instanced.\n          // So use another attribute's divisor property as a proxy for this divisor.\n          divisor: Object.values(attributeManager.attributes)[0].settings.divisor,\n        },\n      });\n    }\n  }\n\n  draw() {\n    const {\n      colorScaleLo,\n      colorScaleHi,\n      isExpressionMode,\n    } = this.props;\n    const {\n      topModel, sideModel, models, model,\n    } = this.state;\n    const uniforms = {\n      uColorScaleRange: [colorScaleLo, colorScaleHi],\n      uIsExpressionMode: isExpressionMode,\n    };\n    // ScatterplotLayer model\n    // eslint-disable-next-line no-unused-expressions\n    model?.setUniforms(uniforms);\n\n    // PolygonLayer models from sublayers\n    // eslint-disable-next-line no-unused-expressions\n    models?.forEach(m => m.setUniforms(uniforms));\n    // eslint-disable-next-line no-unused-expressions\n    topModel?.setUniforms(uniforms);\n    // eslint-disable-next-line no-unused-expressions\n    sideModel?.setUniforms(uniforms);\n  }\n}\n\nScaledExpressionExtension.extensionName = 'ScaledExpressionExtension';\nScaledExpressionExtension.defaultProps = defaultProps;\n", "/**\n *\n * Reference: https://github.com/visgl/deck.gl/blob/8.4-release/modules/layers/src/scatterplot-layer/scatterplot-layer-vertex.glsl.js\n * Reference: https://observablehq.com/@rreusser/selecting-the-right-opacity-for-2d-point-clouds\n * Reference: https://github.com/flekschas/regl-scatterplot/blob/5e3b03e/src/point.vs\n */\nvar vs = \"\\nvec4 plasma (float x_1648624884) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);\\n  float a0 = smoothstep(e0,e1,x_1648624884);\\n  float a1 = smoothstep(e1,e2,x_1648624884);\\n  float a2 = smoothstep(e2,e3,x_1648624884);\\n  float a3 = smoothstep(e3,e4,x_1648624884);\\n  float a4 = smoothstep(e4,e5,x_1648624884);\\n  float a5 = smoothstep(e5,e6,x_1648624884);\\n  float a6 = smoothstep(e6,e7,x_1648624884);\\n  float a7 = smoothstep(e7,e8,x_1648624884);\\n  return max(mix(v0,v1,a0)*step(e0,x_1648624884)*step(x_1648624884,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_1648624884)*step(x_1648624884,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_1648624884)*step(x_1648624884,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_1648624884)*step(x_1648624884,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_1648624884)*step(x_1648624884,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_1648624884)*step(x_1648624884,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_1648624884)*step(x_1648624884,e7),mix(v7,v8,a7)*step(e7,x_1648624884)*step(x_1648624884,e8)\\n  )))))));\\n}\\n\\nvec4 viridis (float x_686877309) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);\\n  float a0 = smoothstep(e0,e1,x_686877309);\\n  float a1 = smoothstep(e1,e2,x_686877309);\\n  float a2 = smoothstep(e2,e3,x_686877309);\\n  float a3 = smoothstep(e3,e4,x_686877309);\\n  float a4 = smoothstep(e4,e5,x_686877309);\\n  float a5 = smoothstep(e5,e6,x_686877309);\\n  float a6 = smoothstep(e6,e7,x_686877309);\\n  float a7 = smoothstep(e7,e8,x_686877309);\\n  return max(mix(v0,v1,a0)*step(e0,x_686877309)*step(x_686877309,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_686877309)*step(x_686877309,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_686877309)*step(x_686877309,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_686877309)*step(x_686877309,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_686877309)*step(x_686877309,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_686877309)*step(x_686877309,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_686877309)*step(x_686877309,e7),mix(v7,v8,a7)*step(e7,x_686877309)*step(x_686877309,e8)\\n  )))))));\\n}\\n\\nvec4 greys (float x_3692066534) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_3692066534);\\n  return mix(v0,v1,a0)*step(e0,x_3692066534)*step(x_3692066534,e1);\\n}\\n\\nvec4 magma (float x_652973032) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.01568627450980392,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);\\n  float a0 = smoothstep(e0,e1,x_652973032);\\n  float a1 = smoothstep(e1,e2,x_652973032);\\n  float a2 = smoothstep(e2,e3,x_652973032);\\n  float a3 = smoothstep(e3,e4,x_652973032);\\n  float a4 = smoothstep(e4,e5,x_652973032);\\n  float a5 = smoothstep(e5,e6,x_652973032);\\n  float a6 = smoothstep(e6,e7,x_652973032);\\n  float a7 = smoothstep(e7,e8,x_652973032);\\n  return max(mix(v0,v1,a0)*step(e0,x_652973032)*step(x_652973032,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_652973032)*step(x_652973032,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_652973032)*step(x_652973032,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_652973032)*step(x_652973032,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_652973032)*step(x_652973032,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_652973032)*step(x_652973032,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_652973032)*step(x_652973032,e7),mix(v7,v8,a7)*step(e7,x_652973032)*step(x_652973032,e8)\\n  )))))));\\n}\\n\\nvec4 jet (float x_799389509) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.5137254901960784,1);\\n  const float e1 = 0.125;\\n  const vec4 v1 = vec4(0,0.23529411764705882,0.6666666666666666,1);\\n  const float e2 = 0.375;\\n  const vec4 v2 = vec4(0.0196078431372549,1,1,1);\\n  const float e3 = 0.625;\\n  const vec4 v3 = vec4(1,1,0,1);\\n  const float e4 = 0.875;\\n  const vec4 v4 = vec4(0.9803921568627451,0,0,1);\\n  const float e5 = 1.0;\\n  const vec4 v5 = vec4(0.5019607843137255,0,0,1);\\n  float a0 = smoothstep(e0,e1,x_799389509);\\n  float a1 = smoothstep(e1,e2,x_799389509);\\n  float a2 = smoothstep(e2,e3,x_799389509);\\n  float a3 = smoothstep(e3,e4,x_799389509);\\n  float a4 = smoothstep(e4,e5,x_799389509);\\n  return max(mix(v0,v1,a0)*step(e0,x_799389509)*step(x_799389509,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_799389509)*step(x_799389509,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_799389509)*step(x_799389509,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_799389509)*step(x_799389509,e4),mix(v4,v5,a4)*step(e4,x_799389509)*step(x_799389509,e5)\\n  ))));\\n}\\n\\nvec4 bone (float x_1404936397) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.376;\\n  const vec4 v1 = vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);\\n  const float e2 = 0.753;\\n  const vec4 v2 = vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);\\n  const float e3 = 1.0;\\n  const vec4 v3 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_1404936397);\\n  float a1 = smoothstep(e1,e2,x_1404936397);\\n  float a2 = smoothstep(e2,e3,x_1404936397);\\n  return max(mix(v0,v1,a0)*step(e0,x_1404936397)*step(x_1404936397,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_1404936397)*step(x_1404936397,e2),mix(v2,v3,a2)*step(e2,x_1404936397)*step(x_1404936397,e3)\\n  ));\\n}\\n\\nvec4 copper (float x_41650866) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.804;\\n  const vec4 v1 = vec4(1,0.6274509803921569,0.4,1);\\n  const float e2 = 1.0;\\n  const vec4 v2 = vec4(1,0.7803921568627451,0.4980392156862745,1);\\n  float a0 = smoothstep(e0,e1,x_41650866);\\n  float a1 = smoothstep(e1,e2,x_41650866);\\n  return max(mix(v0,v1,a0)*step(e0,x_41650866)*step(x_41650866,e1),mix(v1,v2,a1)*step(e1,x_41650866)*step(x_41650866,e2)\\n  );\\n}\\n\\nvec4 density (float x_681601952) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);\\n  float a0 = smoothstep(e0,e1,x_681601952);\\n  float a1 = smoothstep(e1,e2,x_681601952);\\n  float a2 = smoothstep(e2,e3,x_681601952);\\n  float a3 = smoothstep(e3,e4,x_681601952);\\n  float a4 = smoothstep(e4,e5,x_681601952);\\n  float a5 = smoothstep(e5,e6,x_681601952);\\n  float a6 = smoothstep(e6,e7,x_681601952);\\n  float a7 = smoothstep(e7,e8,x_681601952);\\n  return max(mix(v0,v1,a0)*step(e0,x_681601952)*step(x_681601952,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_681601952)*step(x_681601952,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_681601952)*step(x_681601952,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_681601952)*step(x_681601952,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_681601952)*step(x_681601952,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_681601952)*step(x_681601952,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_681601952)*step(x_681601952,e7),mix(v7,v8,a7)*step(e7,x_681601952)*step(x_681601952,e8)\\n  )))))));\\n}\\n\\nvec4 inferno (float x_902288871) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0.01568627450980392,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0.8901960784313725,0.34901960784313724,0.2,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.9882352941176471,1,0.6431372549019608,1);\\n  float a0 = smoothstep(e0,e1,x_902288871);\\n  float a1 = smoothstep(e1,e2,x_902288871);\\n  float a2 = smoothstep(e2,e3,x_902288871);\\n  float a3 = smoothstep(e3,e4,x_902288871);\\n  float a4 = smoothstep(e4,e5,x_902288871);\\n  float a5 = smoothstep(e5,e6,x_902288871);\\n  float a6 = smoothstep(e6,e7,x_902288871);\\n  float a7 = smoothstep(e7,e8,x_902288871);\\n  return max(mix(v0,v1,a0)*step(e0,x_902288871)*step(x_902288871,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_902288871)*step(x_902288871,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_902288871)*step(x_902288871,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_902288871)*step(x_902288871,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_902288871)*step(x_902288871,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_902288871)*step(x_902288871,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_902288871)*step(x_902288871,e7),mix(v7,v8,a7)*step(e7,x_902288871)*step(x_902288871,e8)\\n  )))))));\\n}\\n\\nvec4 cool (float x_2444426143) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0.49019607843137253,0,0.7019607843137254,1);\\n  const float e1 = 0.13;\\n  const vec4 v1 = vec4(0.4549019607843137,0,0.8549019607843137,1);\\n  const float e2 = 0.25;\\n  const vec4 v2 = vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);\\n  const float e3 = 0.38;\\n  const vec4 v3 = vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);\\n  const float e4 = 0.5;\\n  const vec4 v4 = vec4(0,0.8,0.7725490196078432,1);\\n  const float e5 = 0.63;\\n  const vec4 v5 = vec4(0,0.9686274509803922,0.5725490196078431,1);\\n  const float e6 = 0.75;\\n  const vec4 v6 = vec4(0,1,0.34509803921568627,1);\\n  const float e7 = 0.88;\\n  const vec4 v7 = vec4(0.1568627450980392,1,0.03137254901960784,1);\\n  const float e8 = 1.0;\\n  const vec4 v8 = vec4(0.5764705882352941,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_2444426143);\\n  float a1 = smoothstep(e1,e2,x_2444426143);\\n  float a2 = smoothstep(e2,e3,x_2444426143);\\n  float a3 = smoothstep(e3,e4,x_2444426143);\\n  float a4 = smoothstep(e4,e5,x_2444426143);\\n  float a5 = smoothstep(e5,e6,x_2444426143);\\n  float a6 = smoothstep(e6,e7,x_2444426143);\\n  float a7 = smoothstep(e7,e8,x_2444426143);\\n  return max(mix(v0,v1,a0)*step(e0,x_2444426143)*step(x_2444426143,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_2444426143)*step(x_2444426143,e2),\\n    max(mix(v2,v3,a2)*step(e2,x_2444426143)*step(x_2444426143,e3),\\n    max(mix(v3,v4,a3)*step(e3,x_2444426143)*step(x_2444426143,e4),\\n    max(mix(v4,v5,a4)*step(e4,x_2444426143)*step(x_2444426143,e5),\\n    max(mix(v5,v6,a5)*step(e5,x_2444426143)*step(x_2444426143,e6),\\n    max(mix(v6,v7,a6)*step(e6,x_2444426143)*step(x_2444426143,e7),mix(v7,v8,a7)*step(e7,x_2444426143)*step(x_2444426143,e8)\\n  )))))));\\n}\\n\\nvec4 hot (float x_1123650753) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,0,1);\\n  const float e1 = 0.3;\\n  const vec4 v1 = vec4(0.9019607843137255,0,0,1);\\n  const float e2 = 0.6;\\n  const vec4 v2 = vec4(1,0.8235294117647058,0,1);\\n  const float e3 = 1.0;\\n  const vec4 v3 = vec4(1,1,1,1);\\n  float a0 = smoothstep(e0,e1,x_1123650753);\\n  float a1 = smoothstep(e1,e2,x_1123650753);\\n  float a2 = smoothstep(e2,e3,x_1123650753);\\n  return max(mix(v0,v1,a0)*step(e0,x_1123650753)*step(x_1123650753,e1),\\n    max(mix(v1,v2,a1)*step(e1,x_1123650753)*step(x_1123650753,e2),mix(v2,v3,a2)*step(e2,x_1123650753)*step(x_1123650753,e3)\\n  ));\\n}\\n\\nvec4 spring (float x_3460271019) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(1,0,1,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_3460271019);\\n  return mix(v0,v1,a0)*step(e0,x_3460271019)*step(x_3460271019,e1);\\n}\\n\\nvec4 summer (float x_1787574999) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0.5019607843137255,0.4,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0.4,1);\\n  float a0 = smoothstep(e0,e1,x_1787574999);\\n  return mix(v0,v1,a0)*step(e0,x_1787574999)*step(x_1787574999,e1);\\n}\\n\\nvec4 autumn (float x_204634793) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(1,0,0,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(1,1,0,1);\\n  float a0 = smoothstep(e0,e1,x_204634793);\\n  return mix(v0,v1,a0)*step(e0,x_204634793)*step(x_204634793,e1);\\n}\\n\\nvec4 winter (float x_4071283602) {\\n  const float e0 = 0.0;\\n  const vec4 v0 = vec4(0,0,1,1);\\n  const float e1 = 1.0;\\n  const vec4 v1 = vec4(0,1,0.5019607843137255,1);\\n  float a0 = smoothstep(e0,e1,x_4071283602);\\n  return mix(v0,v1,a0)*step(e0,x_4071283602)*step(x_4071283602,e1);\\n}\\n\\n// Custom attributes for Vitessce:\\nattribute float expressionValue;\\n\\n// Custom uniforms for Vitessce:\\nuniform vec2 uColorScaleRange;\\nuniform bool uIsExpressionMode;\\n\\n\";\nvar inject = {\n  'vs:DECKGL_FILTER_COLOR': \"\\n    if(uIsExpressionMode) {\\n      float normalizedExpressionValue = expressionValue / 255.0;\\n      float scaledExpressionValue = (normalizedExpressionValue - uColorScaleRange[0]) / max(0.005, (uColorScaleRange[1] - uColorScaleRange[0]));\\n      color.rgb = COLORMAP_FUNC(clamp(scaledExpressionValue, 0.0, 1.0)).rgb;\\n    }\\n  \"\n};\nexport default {\n  name: 'scaled-expression',\n  vs: vs,\n  inject: inject\n};", "import ScaledExpressionExtension from './ScaledExpressionExtension';\n\nexport default ScaledExpressionExtension;\n", "/* eslint-disable no-underscore-dangle */\n/* eslint-disable import/no-extraneous-dependencies */\nimport GL from '@luma.gl/constants';\nimport { LayerExtension } from '@deck.gl/core';\nimport module from './shader-module';\n\nexport default class SelectionExtension extends LayerExtension {\n  // eslint-disable-next-line class-methods-use-this\n  getShaders() {\n    return {\n      modules: [module],\n    };\n  }\n\n  initializeState(context, extension) {\n    const attributeManager = this.getAttributeManager();\n    if (attributeManager) {\n      attributeManager.add({\n        isSelected: {\n          type: GL.FLOAT,\n          size: 1,\n          transition: true,\n          accessor: 'getCellIsSelected',\n          defaultValue: 1,\n          // PolygonLayer needs not-intsanced attribute but\n          // ScatterplotLayer needs instanced.\n          divisor: Number(extension.opts.instanced),\n        },\n      });\n    }\n  }\n}\n\nSelectionExtension.extensionName = 'SelectionExtension';\n", "var vs = \"\\nattribute float isSelected;\\n\";\nvar inject = {\n  'vs:DECKGL_FILTER_GL_POSITION': \"\\n    position.z += (1. - isSelected) * .00005; // Add a small z offset for unselected points in the positive direction i.e into the screen.\\n  \",\n  'fs:#main-start': \" // Gets rid of bad border effects (active after deck.gl 8.5): https://github.com/visgl/deck.gl/pull/6081\\n    float distToCenterNew = length(unitPosition) * outerRadiusPixels;\\n    float inCircleNew = step(distToCenterNew, outerRadiusPixels);\\n    if (inCircleNew == 0.0) {\\n      discard;\\n    }\\n  \"\n};\nexport default {\n  name: 'selection',\n  vs: vs,\n  inject: inject\n};", "import SelectionExtension from './SelectionExtension';\n\nexport default SelectionExtension;\n", "import React, { useCallback } from 'react';\nimport debounce from 'lodash/debounce';\n\nimport Checkbox from '@material-ui/core/Checkbox';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableRow from '@material-ui/core/TableRow';\nimport Slider from '@material-ui/core/Slider';\nimport { makeStyles, createStyles } from '@material-ui/core/styles';\nimport { useStyles } from '../shared-plot-options/styles';\nimport OptionsContainer from '../shared-plot-options/OptionsContainer';\nimport CellColorEncodingOption from '../shared-plot-options/CellColorEncodingOption';\nimport OptionSelect from '../shared-plot-options/OptionSelect';\nimport { GLSL_COLORMAPS } from '../../layers/constants';\n\nconst useToggleStyles = makeStyles(() => createStyles({\n  cameraLabel: {\n    padding: '0px 0px 0px 16px',\n  },\n  box: {\n    padding: '0px',\n  },\n  button: {\n    padding: '0px 0px 0px 8px',\n  },\n}));\n\nconst ToggleFixedAxisButton = ({\n  setSpatialAxisFixed,\n  spatialAxisFixed,\n  use3d,\n}) => {\n  const classes = useToggleStyles();\n  return (\n    <TableRow>\n      <TableCell className={classes.cameraLabel}>\n      Fix Camera Axis\n      </TableCell>\n      <TableCell className={classes.box}>\n        <Checkbox\n          onClick={() => setSpatialAxisFixed(!spatialAxisFixed)}\n          disabled={!use3d}\n          checked={Boolean(spatialAxisFixed)}\n        />\n      </TableCell>\n    </TableRow>\n  );\n};\n\nexport default function SpatialOptions(props) {\n  const {\n    observationsLabel,\n    cellColorEncoding,\n    setCellColorEncoding,\n    setSpatialAxisFixed,\n    spatialAxisFixed,\n    use3d,\n    geneExpressionColormap,\n    setGeneExpressionColormap,\n    geneExpressionColormapRange,\n    setGeneExpressionColormapRange,\n    canShowExpressionOptions,\n    canShowColorEncodingOption,\n    canShow3DOptions,\n  } = props;\n\n  function handleGeneExpressionColormapChange(event) {\n    setGeneExpressionColormap(event.target.value);\n  }\n\n  function handleColormapRangeChange(event, value) {\n    setGeneExpressionColormapRange(value);\n  }\n  const handleColormapRangeChangeDebounced = useCallback(\n    debounce(handleColormapRangeChange, 5, { trailing: true }),\n    [handleColormapRangeChange],\n  );\n\n  const classes = useStyles();\n\n  return (\n    <OptionsContainer>\n      {canShowColorEncodingOption ? (\n        <CellColorEncodingOption\n          observationsLabel={observationsLabel}\n          cellColorEncoding={cellColorEncoding}\n          setCellColorEncoding={setCellColorEncoding}\n        />\n      ) : null}\n      {canShow3DOptions ? (\n        <ToggleFixedAxisButton\n          setSpatialAxisFixed={setSpatialAxisFixed}\n          spatialAxisFixed={spatialAxisFixed}\n          use3d={use3d}\n        />\n      ) : null}\n      {canShowExpressionOptions ? (\n        <>\n          <TableRow>\n            <TableCell className={classes.labelCell} htmlFor=\"gene-expression-colormap-select\">\n          Gene Expression Colormap\n            </TableCell>\n            <TableCell className={classes.inputCell}>\n              <OptionSelect\n                className={classes.select}\n                value={geneExpressionColormap}\n                onChange={handleGeneExpressionColormapChange}\n                inputProps={{\n                  id: 'gene-expression-colormap-select',\n                }}\n              >\n                {GLSL_COLORMAPS.map(cmap => (\n                  <option key={cmap} value={cmap}>{cmap}</option>\n                ))}\n              </OptionSelect>\n            </TableCell>\n          </TableRow>\n          <TableRow>\n            <TableCell className={classes.labelCell}>\n          Gene Expression Colormap Range\n            </TableCell>\n            <TableCell className={classes.inputCell}>\n              <Slider\n                classes={{ root: classes.slider, valueLabel: classes.sliderValueLabel }}\n                value={geneExpressionColormapRange}\n                onChange={handleColormapRangeChangeDebounced}\n                aria-labelledby=\"gene-expression-colormap-range-slider\"\n                valueLabelDisplay=\"auto\"\n                step={0.005}\n                min={0.0}\n                max={1.0}\n              />\n            </TableCell>\n          </TableRow>\n        </>\n      ) : null}\n    </OptionsContainer>\n  );\n}\n", "import React from 'react';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableRow from '@material-ui/core/TableRow';\nimport { capitalize } from '../../utils';\nimport OptionSelect from './OptionSelect';\nimport { useStyles } from './styles';\n\nexport default function CellColorEncodingOption(props) {\n  const {\n    observationsLabel,\n    cellColorEncoding,\n    setCellColorEncoding,\n  } = props;\n\n  const classes = useStyles();\n\n  const observationsLabelNice = capitalize(observationsLabel);\n\n  function handleColorEncodingChange(event) {\n    setCellColorEncoding(event.target.value);\n  }\n\n  return (\n    <TableRow>\n      <TableCell className={classes.labelCell} htmlFor=\"cell-color-encoding-select\">\n        {observationsLabelNice} Color Encoding\n      </TableCell>\n      <TableCell className={classes.inputCell}>\n        <OptionSelect\n          className={classes.select}\n          value={cellColorEncoding}\n          onChange={handleColorEncodingChange}\n          inputProps={{\n            id: 'cell-color-encoding-select',\n          }}\n        >\n          <option value=\"cellSetSelection\">Cell Sets</option>\n          <option value=\"geneSelection\">Gene Expression</option>\n        </OptionSelect>\n      </TableCell>\n    </TableRow>\n  );\n}\n", "import React from 'react';\nimport Tooltip2D from '../tooltip/Tooltip2D';\nimport TooltipContent from '../tooltip/TooltipContent';\nimport { useComponentHover, useComponentViewInfo } from '../../app/state/hooks';\n\nexport default function SpatialTooltipSubscriber(props) {\n  const {\n    parentUuid,\n    cellHighlight,\n    width,\n    height,\n    getCellInfo,\n  } = props;\n\n  const sourceUuid = useComponentHover();\n  const viewInfo = useComponentViewInfo(parentUuid);\n\n  const [cellInfo, x, y] = (cellHighlight && getCellInfo ? (\n    [\n      getCellInfo(cellHighlight),\n      ...(viewInfo && viewInfo.project ? viewInfo.project(cellHighlight) : [null, null]),\n    ]\n  ) : ([null, null, null]));\n\n  return (\n    (cellInfo ? (\n      <Tooltip2D\n        x={x}\n        y={y}\n        parentUuid={parentUuid}\n        sourceUuid={sourceUuid}\n        parentWidth={width}\n        parentHeight={height}\n      >\n        <TooltipContent info={cellInfo} />\n      </Tooltip2D>\n    ) : null)\n  );\n}\n", "import React, {\n  useState, useEffect, useCallback, useMemo,\n} from 'react';\nimport { extent } from 'd3-array';\nimport isEqual from 'lodash/isEqual';\nimport TitleInfo from '../TitleInfo';\nimport { pluralize, capitalize } from '../../utils';\nimport {\n  useDeckCanvasSize, useReady, useUrls, useExpressionValueGetter,\n} from '../hooks';\nimport { setCellSelection, mergeCellSets } from '../utils';\nimport { getCellSetPolygons } from '../sets/cell-set-utils';\nimport {\n  useCellsData,\n  useCellSetsData,\n  useGeneSelection,\n  useExpressionAttrs,\n} from '../data-hooks';\nimport { getCellColors } from '../interpolate-colors';\nimport Scatterplot from './Scatterplot';\nimport ScatterplotTooltipSubscriber from './ScatterplotTooltipSubscriber';\nimport ScatterplotOptions from './ScatterplotOptions';\nimport {\n  useCoordination,\n  useLoaders,\n  useSetComponentHover,\n  useSetComponentViewInfo,\n} from '../../app/state/hooks';\nimport {\n  getPointSizeDevicePixels,\n  getPointOpacity,\n} from '../shared-spatial-scatterplot/dynamic-opacity';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\n\nconst SCATTERPLOT_DATA_TYPES = ['cells', 'expression-matrix', 'cell-sets'];\n\n/**\n * A subscriber component for the scatterplot.\n * @param {object} props\n * @param {number} props.uuid The unique identifier for this component.\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {boolean} props.disableTooltip Should the tooltip be disabled?\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title An override value for the component title.\n * @param {number} props.averageFillDensity Override the average fill density calculation\n * when using dynamic opacity mode.\n */\nexport default function ScatterplotSubscriber(props) {\n  const {\n    uuid,\n    coordinationScopes,\n    removeGridComponent,\n    theme,\n    disableTooltip = false,\n    observationsLabelOverride: observationsLabel = 'cell',\n    observationsPluralLabelOverride: observationsPluralLabel = `${observationsLabel}s`,\n    title: titleOverride,\n    // Average fill density for dynamic opacity calculation.\n    averageFillDensity,\n  } = props;\n\n  const loaders = useLoaders();\n  const setComponentHover = useSetComponentHover();\n  const setComponentViewInfo = useSetComponentViewInfo(uuid);\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    embeddingZoom: zoom,\n    embeddingTargetX: targetX,\n    embeddingTargetY: targetY,\n    embeddingTargetZ: targetZ,\n    embeddingType: mapping,\n    cellFilter,\n    cellHighlight,\n    geneSelection,\n    cellSetSelection,\n    cellSetColor,\n    cellColorEncoding,\n    additionalCellSets,\n    embeddingCellSetPolygonsVisible: cellSetPolygonsVisible,\n    embeddingCellSetLabelsVisible: cellSetLabelsVisible,\n    embeddingCellSetLabelSize: cellSetLabelSize,\n    embeddingCellRadius: cellRadiusFixed,\n    embeddingCellRadiusMode: cellRadiusMode,\n    embeddingCellOpacity: cellOpacityFixed,\n    embeddingCellOpacityMode: cellOpacityMode,\n    geneExpressionColormap,\n    geneExpressionColormapRange,\n  }, {\n    setEmbeddingZoom: setZoom,\n    setEmbeddingTargetX: setTargetX,\n    setEmbeddingTargetY: setTargetY,\n    setEmbeddingTargetZ: setTargetZ,\n    setCellFilter,\n    setCellSetSelection,\n    setCellHighlight,\n    setCellSetColor,\n    setCellColorEncoding,\n    setAdditionalCellSets,\n    setEmbeddingCellSetPolygonsVisible: setCellSetPolygonsVisible,\n    setEmbeddingCellSetLabelsVisible: setCellSetLabelsVisible,\n    setEmbeddingCellSetLabelSize: setCellSetLabelSize,\n    setEmbeddingCellRadius: setCellRadiusFixed,\n    setEmbeddingCellRadiusMode: setCellRadiusMode,\n    setEmbeddingCellOpacity: setCellOpacityFixed,\n    setEmbeddingCellOpacityMode: setCellOpacityMode,\n    setGeneExpressionColormap,\n    setGeneExpressionColormapRange,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.scatterplot, coordinationScopes);\n\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [width, height, deckRef] = useDeckCanvasSize();\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    SCATTERPLOT_DATA_TYPES,\n  );\n\n  const title = titleOverride || `Scatterplot (${mapping})`;\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [cells, cellsCount] = useCellsData(loaders, dataset, setItemIsReady, addUrl, true);\n  const [cellSets] = useCellSetsData(\n    loaders,\n    dataset,\n    setItemIsReady,\n    addUrl,\n    false,\n    { setCellSetSelection, setCellSetColor },\n    { cellSetSelection, cellSetColor },\n  );\n  const [expressionData] = useGeneSelection(\n    loaders, dataset, setItemIsReady, false, geneSelection, setItemIsNotReady,\n  );\n  const [attrs] = useExpressionAttrs(\n    loaders, dataset, setItemIsReady, addUrl, false,\n  );\n\n  const [dynamicCellRadius, setDynamicCellRadius] = useState(cellRadiusFixed);\n  const [dynamicCellOpacity, setDynamicCellOpacity] = useState(cellOpacityFixed);\n\n  const mergedCellSets = useMemo(() => mergeCellSets(\n    cellSets, additionalCellSets,\n  ), [cellSets, additionalCellSets]);\n\n  const setCellSelectionProp = useCallback((v) => {\n    setCellSelection(\n      v, additionalCellSets, cellSetColor,\n      setCellSetSelection, setAdditionalCellSets, setCellSetColor,\n      setCellColorEncoding,\n    );\n  }, [additionalCellSets, cellSetColor, setCellColorEncoding,\n    setAdditionalCellSets, setCellSetColor, setCellSetSelection]);\n\n  const cellColors = useMemo(() => getCellColors({\n    cellColorEncoding,\n    expressionData: expressionData && expressionData[0],\n    geneSelection,\n    cellSets: mergedCellSets,\n    cellSetSelection,\n    cellSetColor,\n    expressionDataAttrs: attrs,\n    theme,\n  }), [cellColorEncoding, geneSelection, mergedCellSets, theme,\n    cellSetSelection, cellSetColor, expressionData, attrs]);\n\n  // cellSetPolygonCache is an array of tuples like [(key0, val0), (key1, val1), ...],\n  // where the keys are cellSetSelection arrays.\n  const [cellSetPolygonCache, setCellSetPolygonCache] = useState([]);\n  const cacheHas = (cache, key) => cache.findIndex(el => isEqual(el[0], key)) !== -1;\n  const cacheGet = (cache, key) => cache.find(el => isEqual(el[0], key))?.[1];\n  const cellSetPolygons = useMemo(() => {\n    if ((cellSetLabelsVisible || cellSetPolygonsVisible)\n      && !cacheHas(cellSetPolygonCache, cellSetSelection)\n      && mergedCellSets?.tree?.length\n      && Object.values(cells).length\n      && cellSetColor?.length) {\n      const newCellSetPolygons = getCellSetPolygons({\n        cells,\n        mapping,\n        cellSets: mergedCellSets,\n        cellSetSelection,\n        cellSetColor,\n        theme,\n      });\n      setCellSetPolygonCache(cache => [...cache, [cellSetSelection, newCellSetPolygons]]);\n      return newCellSetPolygons;\n    }\n    return cacheGet(cellSetPolygonCache, cellSetSelection) || [];\n  }, [cellSetPolygonsVisible, cellSetPolygonCache, cellSetLabelsVisible, theme,\n    cells, mapping, mergedCellSets, cellSetSelection, cellSetColor]);\n\n\n  const cellSelection = useMemo(() => Array.from(cellColors.keys()), [cellColors]);\n\n  const [xRange, yRange, xExtent, yExtent, numCells] = useMemo(() => {\n    const cellValues = cells && Object.values(cells);\n    if (cellValues?.length) {\n      const cellCoordinates = Object.values(cells)\n        .map(c => c.mappings[mapping]);\n      const xE = extent(cellCoordinates, c => c[0]);\n      const yE = extent(cellCoordinates, c => c[1]);\n      const xR = xE[1] - xE[0];\n      const yR = yE[1] - yE[0];\n      return [xR, yR, xE, yE, cellValues.length];\n    }\n    return [null, null, null, null, null];\n  }, [cells, mapping]);\n\n  // After cells have loaded or changed,\n  // compute the cell radius scale based on the\n  // extents of the cell coordinates on the x/y axes.\n  useEffect(() => {\n    if (xRange && yRange) {\n      const pointSizeDevicePixels = getPointSizeDevicePixels(\n        window.devicePixelRatio, zoom, xRange, yRange, width, height,\n      );\n      setDynamicCellRadius(pointSizeDevicePixels);\n\n      const nextCellOpacityScale = getPointOpacity(\n        zoom, xRange, yRange, width, height, numCells, averageFillDensity,\n      );\n      setDynamicCellOpacity(nextCellOpacityScale);\n\n      if (typeof targetX !== 'number' || typeof targetY !== 'number') {\n        const newTargetX = xExtent[0] + xRange / 2;\n        const newTargetY = yExtent[0] + yRange / 2;\n        const newZoom = Math.log2(Math.min(width / xRange, height / yRange));\n        setTargetX(newTargetX);\n        // Graphics rendering has the y-axis going south so we need to multiply by negative one.\n        setTargetY(-newTargetY);\n        setZoom(newZoom);\n      }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [xRange, yRange, xExtent, yExtent, numCells, cells, mapping,\n    width, height, zoom, averageFillDensity]);\n\n  const getCellInfo = useCallback((cellId) => {\n    const cellInfo = cells[cellId];\n    return {\n      [`${capitalize(observationsLabel)} ID`]: cellId,\n      ...(cellInfo ? cellInfo.factors : {}),\n    };\n  }, [cells, observationsLabel]);\n\n  const cellSelectionSet = useMemo(() => new Set(cellSelection), [cellSelection]);\n  const getCellIsSelected = useCallback(cellEntry => (\n    (cellSelectionSet || new Set([])).has(cellEntry[0]) ? 1.0 : 0.0), [cellSelectionSet]);\n\n  const cellRadius = (cellRadiusMode === 'manual' ? cellRadiusFixed : dynamicCellRadius);\n  const cellOpacity = (cellOpacityMode === 'manual' ? cellOpacityFixed : dynamicCellOpacity);\n\n  // Set up a getter function for gene expression values, to be used\n  // by the DeckGL layer to obtain values for instanced attributes.\n  const getExpressionValue = useExpressionValueGetter({ attrs, expressionData });\n\n  return (\n    <TitleInfo\n      title={title}\n      info={`${cellsCount} ${pluralize(observationsLabel, observationsPluralLabel, cellsCount)}`}\n      removeGridComponent={removeGridComponent}\n      urls={urls}\n      theme={theme}\n      isReady={isReady}\n      options={(\n        <ScatterplotOptions\n          observationsLabel={observationsLabel}\n          cellRadius={cellRadiusFixed}\n          setCellRadius={setCellRadiusFixed}\n          cellRadiusMode={cellRadiusMode}\n          setCellRadiusMode={setCellRadiusMode}\n          cellOpacity={cellOpacityFixed}\n          setCellOpacity={setCellOpacityFixed}\n          cellOpacityMode={cellOpacityMode}\n          setCellOpacityMode={setCellOpacityMode}\n          cellSetLabelsVisible={cellSetLabelsVisible}\n          setCellSetLabelsVisible={setCellSetLabelsVisible}\n          cellSetLabelSize={cellSetLabelSize}\n          setCellSetLabelSize={setCellSetLabelSize}\n          cellSetPolygonsVisible={cellSetPolygonsVisible}\n          setCellSetPolygonsVisible={setCellSetPolygonsVisible}\n          cellColorEncoding={cellColorEncoding}\n          setCellColorEncoding={setCellColorEncoding}\n          geneExpressionColormap={geneExpressionColormap}\n          setGeneExpressionColormap={setGeneExpressionColormap}\n          geneExpressionColormapRange={geneExpressionColormapRange}\n          setGeneExpressionColormapRange={setGeneExpressionColormapRange}\n        />\n      )}\n    >\n      <Scatterplot\n        ref={deckRef}\n        uuid={uuid}\n        theme={theme}\n        viewState={{ zoom, target: [targetX, targetY, targetZ] }}\n        setViewState={({ zoom: newZoom, target }) => {\n          setZoom(newZoom);\n          setTargetX(target[0]);\n          setTargetY(target[1]);\n          setTargetZ(target[2] || 0);\n        }}\n        cells={cells}\n        mapping={mapping}\n        cellFilter={cellFilter}\n        cellSelection={cellSelection}\n        cellHighlight={cellHighlight}\n        cellColors={cellColors}\n        cellSetPolygons={cellSetPolygons}\n        cellSetLabelSize={cellSetLabelSize}\n        cellSetLabelsVisible={cellSetLabelsVisible}\n        cellSetPolygonsVisible={cellSetPolygonsVisible}\n        setCellFilter={setCellFilter}\n        setCellSelection={setCellSelectionProp}\n        setCellHighlight={setCellHighlight}\n        cellRadius={cellRadius}\n        cellOpacity={cellOpacity}\n        cellColorEncoding={cellColorEncoding}\n        geneExpressionColormap={geneExpressionColormap}\n        geneExpressionColormapRange={geneExpressionColormapRange}\n        setComponentHover={() => {\n          setComponentHover(uuid);\n        }}\n        updateViewInfo={setComponentViewInfo}\n        getExpressionValue={getExpressionValue}\n        getCellIsSelected={getCellIsSelected}\n\n      />\n      {!disableTooltip && (\n      <ScatterplotTooltipSubscriber\n        parentUuid={uuid}\n        cellHighlight={cellHighlight}\n        width={width}\n        height={height}\n        getCellInfo={getCellInfo}\n      />\n      )}\n    </TitleInfo>\n  );\n}\n", "import React, { forwardRef } from 'react';\nimport { PolygonLayer, TextLayer, ScatterplotLayer } from '@deck.gl/layers'; // eslint-disable-line import/no-extraneous-dependencies\nimport { forceSimulation } from 'd3-force';\nimport { getSelectionLayers } from '../../layers';\nimport { cellLayerDefaultProps, getDefaultColor } from '../utils';\nimport {\n  createCellsQuadTree,\n} from '../shared-spatial-scatterplot/quadtree';\nimport AbstractSpatialOrScatterplot from '../shared-spatial-scatterplot/AbstractSpatialOrScatterplot';\nimport { forceCollideRects } from '../shared-spatial-scatterplot/force-collide-rects';\nimport { ScaledExpressionExtension, SelectionExtension } from '../../layer-extensions';\n\nconst CELLS_LAYER_ID = 'scatterplot';\nconst LABEL_FONT_FAMILY = \"-apple-system, 'Helvetica Neue', Arial, sans-serif\";\nconst NUM_FORCE_SIMULATION_TICKS = 100;\nconst LABEL_UPDATE_ZOOM_DELTA = 0.25;\n\n// Default getter function props.\nconst makeDefaultGetCellPosition = mapping => (cellEntry) => {\n  const { mappings } = cellEntry[1];\n  if (!(mapping in mappings)) {\n    const available = Object.keys(mappings).map(s => `\"${s}\"`).join(', ');\n    throw new Error(`Expected to find \"${mapping}\", but available mappings are: ${available}`);\n  }\n  const mappedCell = mappings[mapping];\n  // The negative applied to the y-axis is because\n  // graphics rendering has the y-axis positive going south.\n  return [mappedCell[0], -mappedCell[1], 0];\n};\nconst makeDefaultGetCellCoords = mapping => cell => cell.mappings[mapping];\nconst makeDefaultGetCellColors = (cellColors, theme) => (cellEntry) => {\n  const [r, g, b, a] = (cellColors && cellColors.get(cellEntry[0])) || getDefaultColor(theme);\n  return [r, g, b, 255 * (a || 1)];\n};\n\n/**\n * React component which renders a scatterplot from cell data, typically tSNE or PCA.\n * @param {object} props\n * @param {string} props.uuid A unique identifier for this component.\n * @param {string} props.theme The current vitessce theme.\n * @param {object} props.viewState The deck.gl view state.\n * @param {function} props.setViewState Function to call to update the deck.gl view state.\n * @param {object} props.cells\n * @param {string} props.mapping The name of the coordinate mapping field,\n * for each cell, for example \"PCA\" or \"t-SNE\".\n * @param {Map} props.cellColors Mapping of cell IDs to colors.\n * @param {array} props.cellSelection Array of selected cell IDs.\n * @param {array} props.cellFilter Array of filtered cell IDs. By default, null.\n * @param {number} props.cellRadius The value for `radiusScale` to pass\n * to the deck.gl cells ScatterplotLayer.\n * @param {number} props.cellOpacity The value for `opacity` to pass\n * to the deck.gl cells ScatterplotLayer.\n * @param {function} props.getCellCoords Getter function for cell coordinates\n * (used by the selection layer).\n * @param {function} props.getCellPosition Getter function for cell [x, y, z] position.\n * @param {function} props.getCellColor Getter function for cell color as [r, g, b] array.\n * @param {function} props.getCellIsSelected Getter function for cell layer isSelected.\n * @param {function} props.setCellSelection\n * @param {function} props.setCellHighlight\n * @param {function} props.updateViewInfo\n * @param {function} props.onToolChange Callback for tool changes\n * (lasso/pan/rectangle selection tools).\n * @param {function} props.onCellClick Getter function for cell layer onClick.\n */\nclass Scatterplot extends AbstractSpatialOrScatterplot {\n  constructor(props) {\n    super(props);\n\n    // To avoid storing large arrays/objects\n    // in React state, this component\n    // uses instance variables.\n    // All instance variables used in this class:\n    this.cellsEntries = [];\n    this.cellsQuadTree = null;\n    this.cellsLayer = null;\n    this.cellSetsForceSimulation = forceCollideRects();\n    this.cellSetsLabelPrevZoom = null;\n    this.cellSetsLayers = [];\n\n    // Initialize data and layers.\n    this.onUpdateCellsData();\n    this.onUpdateCellsLayer();\n    this.onUpdateCellSetsLayers();\n  }\n\n  createCellsLayer() {\n    const { cellsEntries } = this;\n    const {\n      theme,\n      mapping,\n      getCellPosition = makeDefaultGetCellPosition(mapping),\n      cellRadius = 1.0,\n      cellOpacity = 1.0,\n      cellFilter,\n      cellSelection,\n      setCellHighlight,\n      setComponentHover,\n      getCellIsSelected,\n      cellColors,\n      getCellColor = makeDefaultGetCellColors(cellColors, theme),\n      getExpressionValue,\n      onCellClick,\n      geneExpressionColormap,\n      geneExpressionColormapRange = [0.0, 1.0],\n      cellColorEncoding,\n    } = this.props;\n    const filteredCellsEntries = (cellFilter\n      ? cellsEntries.filter(cellEntry => cellFilter.includes(cellEntry[0]))\n      : cellsEntries);\n    return new ScatterplotLayer({\n      id: CELLS_LAYER_ID,\n      backgroundColor: (theme === 'dark' ? [0, 0, 0] : [241, 241, 241]),\n      getCellIsSelected,\n      opacity: cellOpacity,\n      radiusScale: cellRadius,\n      radiusMinPixels: 1,\n      radiusMaxPixels: 30,\n      // Our radius pixel setters measure in pixels.\n      radiusUnits: 'pixels',\n      getPosition: getCellPosition,\n      getFillColor: getCellColor,\n      getLineColor: getCellColor,\n      getRadius: 1,\n      getExpressionValue,\n      getLineWidth: 0,\n      extensions: [\n        new ScaledExpressionExtension(),\n        new SelectionExtension({ instanced: true }),\n      ],\n      colorScaleLo: geneExpressionColormapRange[0],\n      colorScaleHi: geneExpressionColormapRange[1],\n      isExpressionMode: (cellColorEncoding === 'geneSelection'),\n      colormap: geneExpressionColormap,\n      onClick: (info) => {\n        if (onCellClick) {\n          onCellClick(info);\n        }\n      },\n      updateTriggers: {\n        getExpressionValue,\n        getFillColor: [cellColorEncoding, cellSelection, cellColors],\n        getLineColor: [cellColorEncoding, cellSelection, cellColors],\n        getCellIsSelected,\n      },\n      ...cellLayerDefaultProps(\n        filteredCellsEntries, undefined, setCellHighlight, setComponentHover,\n      ),\n      stroked: 0,\n    });\n  }\n\n  createCellSetsLayers() {\n    const {\n      theme,\n      cellSetPolygons,\n      viewState,\n      cellSetPolygonsVisible,\n      cellSetLabelsVisible,\n      cellSetLabelSize,\n    } = this.props;\n\n    const result = [];\n\n    if (cellSetPolygonsVisible) {\n      result.push(new PolygonLayer({\n        id: 'cell-sets-polygon-layer',\n        data: cellSetPolygons,\n        stroked: true,\n        filled: false,\n        wireframe: true,\n        lineWidthMaxPixels: 1,\n        getPolygon: d => d.hull,\n        getLineColor: d => d.color,\n        getLineWidth: 1,\n      }));\n    }\n\n    if (cellSetLabelsVisible) {\n      const { zoom } = viewState;\n      const nodes = cellSetPolygons.map(p => ({\n        x: p.centroid[0],\n        y: p.centroid[1],\n        label: p.name,\n      }));\n\n      const collisionForce = this.cellSetsForceSimulation\n        .size(d => ([\n          cellSetLabelSize * 1 / (2 ** zoom) * 4 * d.label.length,\n          cellSetLabelSize * 1 / (2 ** zoom) * 1.5,\n        ]));\n\n      forceSimulation()\n        .nodes(nodes)\n        .force('collision', collisionForce)\n        .tick(NUM_FORCE_SIMULATION_TICKS);\n\n      result.push(new TextLayer({\n        id: 'cell-sets-text-layer',\n        data: nodes,\n        getPosition: d => ([d.x, d.y]),\n        getText: d => d.label,\n        getColor: (theme === 'dark' ? [255, 255, 255] : [0, 0, 0]),\n        getSize: cellSetLabelSize,\n        getAngle: 0,\n        getTextAnchor: 'middle',\n        getAlignmentBaseline: 'center',\n        fontFamily: LABEL_FONT_FAMILY,\n        fontWeight: 'normal',\n      }));\n    }\n\n    return result;\n  }\n\n  createSelectionLayers() {\n    const {\n      viewState,\n      mapping,\n      getCellCoords = makeDefaultGetCellCoords(mapping),\n      setCellSelection,\n    } = this.props;\n    const { tool } = this.state;\n    const { cellsQuadTree } = this;\n    const flipYTooltip = true;\n    return getSelectionLayers(\n      tool,\n      viewState.zoom,\n      CELLS_LAYER_ID,\n      getCellCoords,\n      setCellSelection,\n      cellsQuadTree,\n      flipYTooltip,\n    );\n  }\n\n  getLayers() {\n    const {\n      cellsLayer,\n      cellSetsLayers,\n    } = this;\n    return [\n      cellsLayer,\n      ...cellSetsLayers,\n      ...this.createSelectionLayers(),\n    ];\n  }\n\n  onUpdateCellsData() {\n    const {\n      cells = {},\n      mapping,\n      getCellCoords = makeDefaultGetCellCoords(mapping),\n    } = this.props;\n    const cellsEntries = Object.entries(cells);\n    this.cellsEntries = cellsEntries;\n    this.cellsQuadTree = createCellsQuadTree(cellsEntries, getCellCoords);\n  }\n\n  onUpdateCellsLayer() {\n    this.cellsLayer = this.createCellsLayer();\n  }\n\n  onUpdateCellSetsLayers(onlyViewStateChange) {\n    // Because the label sizes for the force simulation depend on the zoom level,\n    // we _could_ run the simulation every time the zoom level changes.\n    // However, this has a performance impact in firefox.\n    if (onlyViewStateChange) {\n      const { viewState, cellSetLabelsVisible } = this.props;\n      const { zoom } = viewState;\n      const { cellSetsLabelPrevZoom } = this;\n      // Instead, we can just check if the zoom level has changed\n      // by some relatively large delta, to be more conservative\n      // about re-running the force simulation.\n      if (cellSetLabelsVisible\n        && (\n          cellSetsLabelPrevZoom === null\n          || Math.abs(cellSetsLabelPrevZoom - zoom) > LABEL_UPDATE_ZOOM_DELTA\n        )\n      ) {\n        this.cellSetsLayers = this.createCellSetsLayers();\n        this.cellSetsLabelPrevZoom = zoom;\n      }\n    } else {\n      // Otherwise, something more substantial than just\n      // the viewState has changed, such as the label array\n      // itself, so we always want to update the layer\n      // in this case.\n      this.cellSetsLayers = this.createCellSetsLayers();\n    }\n  }\n\n  viewInfoDidUpdate() {\n    const {\n      mapping,\n      getCellPosition = makeDefaultGetCellPosition(mapping),\n    } = this.props;\n    super.viewInfoDidUpdate(cell => getCellPosition([null, cell]));\n  }\n\n  /**\n   * Here, asynchronously check whether props have\n   * updated which require re-computing memoized variables,\n   * followed by a re-render.\n   * This function does not follow React conventions or paradigms,\n   * it is only implemented this way to try to squeeze out\n   * performance.\n   * @param {object} prevProps The previous props to diff against.\n   */\n  componentDidUpdate(prevProps) {\n    this.viewInfoDidUpdate();\n\n    const shallowDiff = propName => (prevProps[propName] !== this.props[propName]);\n    if (['cells'].some(shallowDiff)) {\n      // Cells data changed.\n      this.onUpdateCellsData();\n      this.forceUpdate();\n    }\n\n    if ([\n      'cells', 'cellFilter', 'cellSelection', 'cellColors',\n      'cellRadius', 'cellOpacity', 'cellRadiusMode', 'geneExpressionColormap',\n      'geneExpressionColormapRange', 'geneSelection', 'cellColorEncoding',\n    ].some(shallowDiff)) {\n      // Cells layer props changed.\n      this.onUpdateCellsLayer();\n      this.forceUpdate();\n    }\n    if ([\n      'cellSetPolygons', 'cellSetPolygonsVisible',\n      'cellSetLabelsVisible', 'cellSetLabelSize',\n    ].some(shallowDiff)) {\n      // Cell sets layer props changed.\n      this.onUpdateCellSetsLayers(false);\n      this.forceUpdate();\n    }\n    if (shallowDiff('viewState')) {\n      // The viewState prop has changed (due to zoom or pan).\n      this.onUpdateCellSetsLayers(true);\n      this.forceUpdate();\n    }\n  }\n\n  // render() is implemented in the abstract parent class.\n}\n\n/**\n * Need this wrapper function here,\n * since we want to pass a forwardRef\n * so that outer components can\n * access the grandchild DeckGL ref,\n * but we are using a class component.\n */\nconst ScatterplotWrapper = forwardRef((props, deckRef) => (\n  <Scatterplot\n    {...props}\n    deckRef={deckRef}\n  />\n));\nexport default ScatterplotWrapper;\n", "/* eslint-disable no-plusplus */\n/* eslint-disable no-param-reassign */\nimport { quadtree } from 'd3-quadtree';\n\n/**\n * Returns a closure that returns a constant value.\n */\nfunction constant(v) {\n  return (() => v);\n}\n\n/**\n * Adds a tiny bit of randomness to a number.\n */\nfunction jiggle(v) {\n  return v + (Math.random() - 0.5) * 1e-6;\n}\n\n/**\n * A force function to be used with d3.forceSimulation.\n * This has been adapted for use here, with comments explaining each part.\n * Reference: https://bl.ocks.org/cmgiven/547658968d365bcc324f3e62e175709b\n */\nexport function forceCollideRects() {\n  // D3 implements things with function prototypes rather than classes.\n  // Pretend these variables are the \"instance members\" of a class.\n  // Note that this function actually returns the internal force() function,\n  // but that the force() function is a closure with access to these instance members.\n\n  let nodes;\n  let masses;\n  let strength = 1;\n  let iterations = 1;\n\n  let sizes;\n  let size = constant([0, 0]);\n\n  // Given a node, return the center point along the x-axis.\n  function xCenter(d) {\n    return d.x + d.vx + sizes[d.index][0] / 2;\n  }\n\n  // Given a node, return the center point along the y-axis.\n  function yCenter(d) {\n    return d.y + d.vy + sizes[d.index][1] / 2;\n  }\n\n  // Given a quadtree node, initialize its .size property.\n  function prepare(quad) {\n    if (quad.data) {\n      // This is a leaf node, so we set quad.size to the node's size.\n      // (No need to compute the max of internal nodes,\n      // since leaf nodes do not have any internal nodes).\n      quad.size = sizes[quad.data.index];\n    } else {\n      quad.size = [0, 0];\n      // Internal nodes of the quadtree are represented\n      // as four-element arrays in left-to-right, top-to-bottom order.\n      // Here, we are setting quad.size to [maxWidth, maxHeight]\n      // among the internal nodes of this current `quad` node.\n      for (let i = 0; i < 4; i++) {\n        if (quad[i] && quad[i].size) {\n          quad.size[0] = Math.max(quad.size[0], quad[i].size[0]);\n          quad.size[1] = Math.max(quad.size[1], quad[i].size[1]);\n        }\n      }\n    }\n  }\n\n  function force() {\n    let node;\n    let nodeSize;\n    let nodeMass;\n    let xi;\n    let yi;\n\n    // Create a quadtree based on node center points.\n    // Initialize each quadtree node's .size property by calling\n    // the prepare() function on each quadtree node.\n    const tree = quadtree(nodes, xCenter, yCenter).visitAfter(prepare);\n\n    // Update the .vx and .vy properties of both `node` and `data`\n    // (the current node pair).\n    function apply(quad, x0, y0, x1, y1) {\n      // `quad` is a quadtree node.\n      const { data } = quad;\n      const xSize = (nodeSize[0] + quad.size[0]) / 2;\n      const ySize = (nodeSize[1] + quad.size[1]) / 2;\n\n      if (data && data.index > node.index) {\n        // This is a leaf node because `data` is defined.\n        // `x` is the difference in x centers between `node` and `data`.\n        // `y` is the difference in y centers between `node` and `data`.\n        let x = jiggle(xi - xCenter(data));\n        let y = jiggle(yi - yCenter(data));\n        const xd = Math.abs(x) - xSize;\n        const yd = Math.abs(y) - ySize;\n\n        // If `xd` and `yd` is less than zero,\n        // then there is an overlap between the two nodes.\n        if (xd < 0 && yd < 0) {\n          const l = Math.sqrt(x * x + y * y);\n          const m = masses[data.index] / (nodeMass + masses[data.index]);\n\n          // We move the nodes either in the x or y direction.\n          // Nodes are moved proportionally to:\n          // their distance apart (`l`), their amount of overlap (`xd` or `yd`), their masses (`m`),\n          // and the strength parameter (`strength`).\n          if (Math.abs(xd) < Math.abs(yd)) {\n            node.vx -= (x *= xd / l * strength) * m;\n            data.vx += x * (1 - m);\n          } else {\n            node.vy -= (y *= yd / l * strength) * m;\n            data.vy += y * (1 - m);\n          }\n        }\n        // When the quadtree.visit callback returns _true_ for a node,\n        // then the node's children will _not_ be visited.\n        return x0 > xi + xSize || x1 < xi - xSize || y0 > yi + ySize || y1 < yi - ySize;\n      }\n      return false;\n    }\n\n    function iterate() {\n      // On every iteration, use the `apply` function to visit every node\n      // which has an index greater than the current node's index,\n      // (visiting every node pair).\n      for (let j = 0; j < nodes.length; j++) {\n        node = nodes[j];\n        nodeSize = sizes[j];\n        nodeMass = masses[j];\n        xi = xCenter(node);\n        yi = yCenter(node);\n\n        tree.visit(apply);\n      }\n    }\n\n    // Do the specified number of iterations.\n    for (let i = 0; i < iterations; i++) {\n      iterate();\n    }\n  }\n\n  // The \"constructor\".\n  // Takes a list of nodes as input.\n  force.initialize = (v) => {\n    nodes = v;\n    // Get the size [w, h] of each node using the size getter function.\n    sizes = nodes.map(size);\n    // Get the mass of each node,\n    // which is the sum of its horizontal and vertical edge lengths.\n    masses = sizes.map(d => d[0] + d[1]);\n  };\n\n  // Set the number of iterations.\n  // If no value is provided as a parameter, this acts as a getter function.\n  force.iterations = (...v) => {\n    if (v.length) {\n      iterations = +v[0];\n      return force;\n    }\n    return iterations;\n  };\n\n  // Set the strength value.\n  // If no value is provided as a parameter, this acts as a getter function.\n  force.strength = (...v) => {\n    if (v.length) {\n      strength = +v[0];\n      return force;\n    }\n    return strength;\n  };\n\n  // Set the size function.\n  // The size function takes a node as a parameter and returns its size.\n  // If no size function is provided as a parameter, this acts as a getter function.\n  force.size = (...v) => {\n    if (v.length) {\n      size = (typeof v[0] === 'function' ? v[0] : constant(v[0]));\n      return force;\n    }\n    return size;\n  };\n\n  // Returns the force closure.\n  return force;\n}\n", "import React from 'react';\nimport Tooltip2D from '../tooltip/Tooltip2D';\nimport TooltipContent from '../tooltip/TooltipContent';\nimport { useComponentHover, useComponentViewInfo } from '../../app/state/hooks';\n\nexport default function ScatterplotTooltipSubscriber(props) {\n  const {\n    parentUuid,\n    cellHighlight,\n    width,\n    height,\n    getCellInfo,\n  } = props;\n\n  const sourceUuid = useComponentHover();\n  const viewInfo = useComponentViewInfo(parentUuid);\n\n  const [cellInfo, x, y] = (cellHighlight && getCellInfo ? (\n    [\n      getCellInfo(cellHighlight),\n      ...(viewInfo && viewInfo.project ? viewInfo.project(cellHighlight) : [null, null]),\n    ]\n  ) : ([null, null, null]));\n\n  return (\n    (cellInfo ? (\n      <Tooltip2D\n        x={x}\n        y={y}\n        parentUuid={parentUuid}\n        sourceUuid={sourceUuid}\n        parentWidth={width}\n        parentHeight={height}\n      >\n        <TooltipContent info={cellInfo} />\n      </Tooltip2D>\n    ) : null)\n  );\n}\n", "import React, { useCallback } from 'react';\nimport debounce from 'lodash/debounce';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Slider from '@material-ui/core/Slider';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableRow from '@material-ui/core/TableRow';\nimport { capitalize } from '../../utils';\nimport { useStyles } from '../shared-plot-options/styles';\nimport OptionsContainer from '../shared-plot-options/OptionsContainer';\nimport OptionSelect from '../shared-plot-options/OptionSelect';\nimport CellColorEncodingOption from '../shared-plot-options/CellColorEncodingOption';\nimport { GLSL_COLORMAPS } from '../../layers/constants';\n\nexport default function ScatterplotOptions(props) {\n  const {\n    observationsLabel,\n    cellRadius,\n    setCellRadius,\n    cellRadiusMode,\n    setCellRadiusMode,\n    cellOpacity,\n    setCellOpacity,\n    cellOpacityMode,\n    setCellOpacityMode,\n    cellSetLabelsVisible,\n    setCellSetLabelsVisible,\n    cellSetLabelSize,\n    setCellSetLabelSize,\n    cellSetPolygonsVisible,\n    setCellSetPolygonsVisible,\n    cellColorEncoding,\n    setCellColorEncoding,\n    geneExpressionColormap,\n    setGeneExpressionColormap,\n    geneExpressionColormapRange,\n    setGeneExpressionColormapRange,\n  } = props;\n\n  const observationsLabelNice = capitalize(observationsLabel);\n\n  const classes = useStyles();\n\n  function handleCellRadiusModeChange(event) {\n    setCellRadiusMode(event.target.value);\n  }\n\n  function handleCellOpacityModeChange(event) {\n    setCellOpacityMode(event.target.value);\n  }\n\n  function handleRadiusChange(event, value) {\n    setCellRadius(value);\n  }\n\n  function handleOpacityChange(event, value) {\n    setCellOpacity(value);\n  }\n\n  function handleLabelVisibilityChange(event) {\n    setCellSetLabelsVisible(event.target.checked);\n  }\n\n  function handleLabelSizeChange(event, value) {\n    setCellSetLabelSize(value);\n  }\n\n  function handlePolygonVisibilityChange(event) {\n    setCellSetPolygonsVisible(event.target.checked);\n  }\n\n  function handleGeneExpressionColormapChange(event) {\n    setGeneExpressionColormap(event.target.value);\n  }\n\n  function handleColormapRangeChange(event, value) {\n    setGeneExpressionColormapRange(value);\n  }\n  const handleColormapRangeChangeDebounced = useCallback(\n    debounce(handleColormapRangeChange, 5, { trailing: true }),\n    [handleColormapRangeChange],\n  );\n\n  return (\n    <OptionsContainer>\n      <CellColorEncodingOption\n        observationsLabel={observationsLabel}\n        cellColorEncoding={cellColorEncoding}\n        setCellColorEncoding={setCellColorEncoding}\n      />\n      <TableRow>\n        <TableCell className={classes.labelCell}>\n          {observationsLabelNice} Set Labels Visible\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <Checkbox\n            className={classes.checkbox}\n            checked={cellSetLabelsVisible}\n            onChange={handleLabelVisibilityChange}\n            name=\"scatterplot-option-cell-set-labels\"\n            color=\"default\"\n          />\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell}>\n          {observationsLabelNice} Set Label Size\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <Slider\n            disabled={!cellSetLabelsVisible}\n            classes={{ root: classes.slider, valueLabel: classes.sliderValueLabel }}\n            value={cellSetLabelSize}\n            onChange={handleLabelSizeChange}\n            aria-labelledby=\"cell-set-label-size-slider\"\n            valueLabelDisplay=\"auto\"\n            step={1}\n            min={8}\n            max={36}\n          />\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell}>\n          {observationsLabelNice} Set Polygons Visible\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <Checkbox\n            className={classes.checkbox}\n            checked={cellSetPolygonsVisible}\n            onChange={handlePolygonVisibilityChange}\n            name=\"scatterplot-option-cell-set-polygons\"\n            color=\"default\"\n          />\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell} htmlFor=\"cell-radius-mode-select\">\n          {observationsLabelNice} Radius Mode\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <OptionSelect\n            className={classes.select}\n            value={cellRadiusMode}\n            onChange={handleCellRadiusModeChange}\n            inputProps={{\n              id: 'cell-radius-mode-select',\n            }}\n          >\n            <option value=\"auto\">Auto</option>\n            <option value=\"manual\">Manual</option>\n          </OptionSelect>\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell}>\n          {observationsLabelNice} Radius\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <Slider\n            disabled={cellRadiusMode !== 'manual'}\n            classes={{ root: classes.slider, valueLabel: classes.sliderValueLabel }}\n            value={cellRadius}\n            onChange={handleRadiusChange}\n            aria-labelledby=\"cell-radius-slider\"\n            valueLabelDisplay=\"auto\"\n            step={0.01}\n            min={0.01}\n            max={10}\n          />\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell} htmlFor=\"cell-opacity-mode-select\">\n          {observationsLabelNice} Opacity Mode\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <OptionSelect\n            className={classes.select}\n            value={cellOpacityMode}\n            onChange={handleCellOpacityModeChange}\n            inputProps={{\n              id: 'cell-opacity-mode-select',\n            }}\n          >\n            <option value=\"auto\">Auto</option>\n            <option value=\"manual\">Manual</option>\n          </OptionSelect>\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell}>\n          {observationsLabelNice} Opacity\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <Slider\n            disabled={cellOpacityMode !== 'manual'}\n            classes={{ root: classes.slider, valueLabel: classes.sliderValueLabel }}\n            value={cellOpacity}\n            onChange={handleOpacityChange}\n            aria-labelledby=\"cell-opacity-slider\"\n            valueLabelDisplay=\"auto\"\n            step={0.05}\n            min={0.0}\n            max={1.0}\n          />\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell} htmlFor=\"gene-expression-colormap-select\">\n          Gene Expression Colormap\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <OptionSelect\n            className={classes.select}\n            value={geneExpressionColormap}\n            onChange={handleGeneExpressionColormapChange}\n            inputProps={{\n              id: 'gene-expression-colormap-select',\n            }}\n          >\n            {GLSL_COLORMAPS.map(cmap => (\n              <option key={cmap} value={cmap}>{cmap}</option>\n            ))}\n          </OptionSelect>\n        </TableCell>\n      </TableRow>\n      <TableRow>\n        <TableCell className={classes.labelCell}>\n          Gene Expression Colormap Range\n        </TableCell>\n        <TableCell className={classes.inputCell}>\n          <Slider\n            classes={{ root: classes.slider, valueLabel: classes.sliderValueLabel }}\n            value={geneExpressionColormapRange}\n            onChange={handleColormapRangeChangeDebounced}\n            aria-labelledby=\"gene-expression-colormap-range-slider\"\n            valueLabelDisplay=\"auto\"\n            step={0.005}\n            min={0.0}\n            max={1.0}\n          />\n        </TableCell>\n      </TableRow>\n    </OptionsContainer>\n  );\n}\n", "import { OrthographicView } from 'deck.gl';\nimport clamp from 'lodash/clamp';\n\n// Reference: https://observablehq.com/@rreusser/selecting-the-right-opacity-for-2d-point-clouds\n// Reference: https://observablehq.com/@bmschmidt/dot-density-election-maps-with-webgl\nexport function getPointSizeDevicePixels(devicePixelRatio, zoom, xRange, yRange, width, height) {\n  // Size of a point, in units of the diagonal axis.\n  const pointSize = 0.001;\n  // Point size maximum, in screen pixels.\n  const pointScreenSizeMax = 10;\n\n  // Point size minimum, in screen pixels.\n  const pointScreenSizeMin = 1 / devicePixelRatio;\n\n  const scaleFactor = 2 ** zoom;\n  const xAxisRange = 2.0 / ((xRange * scaleFactor) / width);\n  const yAxisRange = 2.0 / ((yRange * scaleFactor) / height);\n\n  // The diagonal screen size as a fraction of the current diagonal axis range,\n  // then converted to device pixels.\n  const diagonalScreenSize = Math.sqrt((width ** 2) + (height ** 2));\n  const diagonalAxisRange = Math.sqrt((xAxisRange ** 2) + (yAxisRange ** 2));\n  const diagonalFraction = pointSize / diagonalAxisRange;\n  const deviceSize = diagonalFraction * diagonalScreenSize;\n\n  const pointSizeDevicePixels = clamp(\n    deviceSize,\n    pointScreenSizeMin,\n    pointScreenSizeMax,\n  );\n  return pointSizeDevicePixels;\n}\n\n// Reference: https://observablehq.com/@rreusser/selecting-the-right-opacity-for-2d-point-clouds\nexport function getPointOpacity(zoom, xRange, yRange, width, height, numCells, avgFillDensity) {\n  const N = numCells;\n  const [minX, minY, maxX, maxY] = new OrthographicView({ zoom }).makeViewport({\n    height,\n    width,\n    viewState: { zoom, target: [0, 0, 0] },\n  }).getBounds();\n  const X = maxY - minY;\n  const Y = maxX - minX;\n  const X0 = xRange;\n  const Y0 = yRange;\n  const W = width;\n  const H = height;\n\n  let rho = avgFillDensity;\n  if (!rho) {\n    rho = Math.min(1, 1 / (10 ** (Math.log10(N) - 3)));\n  }\n  // p in the calculation is the pixel length/width of a given point, which for us is 1\n  // so it does not factor into our calculation here.\n  const alpha = ((rho * W * H) / N) * (Y0 / Y) * (X0 / X);\n  const pointOpacity = clamp(alpha, 1.01 / 255, 1.0);\n  return pointOpacity;\n}\n", "import React, {\n  useEffect,\n} from 'react';\nimport { VitessceGridLayout } from './vitessce-grid-layout';\nimport { useRowHeight, createLoaders } from './vitessce-grid-utils';\nimport {\n  useViewConfigStoreApi,\n  useSetViewConfig,\n  useSetLoaders,\n  useEmitGridResize,\n  useRemoveComponent,\n  useChangeLayout,\n  useLayout,\n} from './state/hooks';\n\nconst padding = 10;\nconst margin = 5;\n\n/**\n * The wrapper for the VitessceGrid and LoadingIndicator components.\n * @param {object} props\n * @param {number} props.rowHeight The height of each grid row. Optional.\n * @param {object} props.config The view config.\n * @param {function} props.getComponent A function that maps component names to their\n * React counterparts.\n * @param {string} props.theme The theme name.\n * @param {number} props.height Total height for grid. Optional.\n * @param {function} props.onWarn A callback for warning messages. Optional.\n */\nexport default function VitessceGrid(props) {\n  const {\n    rowHeight: initialRowHeight,\n    config,\n    getComponent,\n    theme,\n    height,\n  } = props;\n\n  const [rowHeight, containerRef] = useRowHeight(config, initialRowHeight, height, margin, padding);\n  const onResize = useEmitGridResize();\n\n  // When the row height has changed, publish a GRID_RESIZE event.\n  useEffect(() => {\n    onResize();\n  }, [rowHeight, onResize]);\n\n  const viewConfigStoreApi = useViewConfigStoreApi();\n  const setViewConfig = useSetViewConfig(viewConfigStoreApi);\n  const setLoaders = useSetLoaders();\n  const removeComponent = useRemoveComponent();\n  const changeLayout = useChangeLayout();\n  const layout = useLayout();\n\n  // Update the view config and loaders in the global state.\n  useEffect(() => {\n    if (config) {\n      setViewConfig(config);\n      const loaders = createLoaders(config.datasets, config.description);\n      setLoaders(loaders);\n    } else {\n      // No config found, so clear the loaders.\n      setLoaders({});\n    }\n  }, [config, setViewConfig, setLoaders]);\n\n  return (\n    <div\n      ref={containerRef}\n      className={`vitessce-container vitessce-theme-${theme}`}\n    >\n      {layout && (\n        <VitessceGridLayout\n          layout={layout}\n          height={height}\n          rowHeight={rowHeight}\n          theme={theme}\n          getComponent={getComponent}\n          draggableHandle=\".title\"\n          margin={margin}\n          padding={padding}\n          onRemoveComponent={removeComponent}\n          onLayoutChange={changeLayout}\n          reactGridLayoutProps={{\n            onResize,\n            onResizeStop: onResize,\n          }}\n        />\n      )}\n    </div>\n  );\n}\n", "import React from 'react';\nimport { Responsive, WidthProvider } from 'react-grid-layout';\nimport isEqual from 'lodash/isEqual';\nimport { getMaxRows, resolveLayout, COMPONENT_ID_PREFIX } from './layout-utils';\n\nconst ResponsiveGridLayout = WidthProvider(Responsive);\n\nclass ResponsiveHeightGridLayout extends ResponsiveGridLayout {\n  componentDidUpdate(prevProps) {\n    if (this.props.height !== prevProps.height) {\n      this.onWindowResize();\n    }\n  }\n}\n\nexport default function VitessceGridLayout(props) {\n  const {\n    layout,\n    getComponent, padding, margin, draggableHandle,\n    reactGridLayoutProps, rowHeight, theme, height,\n    onRemoveComponent, onLayoutChange: onLayoutChangeProp,\n  } = props;\n\n  // If layout changes, update grid components.\n  const {\n    cols: gridCols, layouts: gridLayouts, breakpoints: gridBreakpoints, components: gridComponents,\n  } = resolveLayout(layout);\n\n  const maxRows = getMaxRows(gridLayouts);\n\n  // Inline CSS is generally avoided, but this saves the end-user a little work,\n  // and prevents class names from getting out of sync.\n  const style = (\n    <style>\n      {`\n        ${draggableHandle} {\n          cursor: grab;\n        }\n        ${draggableHandle}:active {\n          cursor: grabbing;\n        }\n     `}\n    </style>\n  );\n\n  const onLayoutChange = (newLayout) => {\n    if (newLayout.length === Object.entries(gridComponents).length) {\n      const newComponentProps = [];\n      newLayout.forEach((nextC) => {\n        const id = nextC.i;\n        const prevC = gridComponents[id];\n        if (prevC) {\n          const i = parseInt(id.substring(id.indexOf(COMPONENT_ID_PREFIX) + 1), 10);\n          const nextProps = {\n            x: nextC.x, y: nextC.y, w: nextC.w, h: nextC.h,\n          };\n          const prevProps = {\n            x: prevC.x, y: prevC.y, w: prevC.w, h: prevC.h,\n          };\n          if (!isEqual(nextProps, prevProps)) {\n            newComponentProps.push([i, nextProps]);\n          }\n        }\n      });\n      if (newComponentProps.length > 0) {\n        onLayoutChangeProp(newComponentProps);\n      }\n    }\n  };\n\n  const layoutChildren = Object.entries(gridComponents).map(([k, v], i) => {\n    const Component = getComponent(v.component);\n\n    const removeGridComponent = () => {\n      onRemoveComponent(i);\n    };\n\n    return (\n      <div key={k}>\n        <Component\n          {... v.props}\n          uuid={i}\n          coordinationScopes={v.coordinationScopes}\n          theme={theme}\n          removeGridComponent={removeGridComponent}\n        />\n      </div>\n    );\n  });\n  return (gridLayouts && gridComponents && gridBreakpoints && gridCols) && (\n    <>\n      {style}\n      <ResponsiveHeightGridLayout\n        className=\"layout\"\n        cols={gridCols}\n        layouts={gridLayouts}\n        breakpoints={gridBreakpoints}\n        height={height}\n        rowHeight={\n          rowHeight\n          || (\n            (window.innerHeight - 2 * padding - (maxRows - 1) * margin)\n            / maxRows\n          )}\n        containerPadding={[padding, padding]}\n        margin={[margin, margin]}\n        draggableHandle={draggableHandle}\n        onLayoutChange={onLayoutChange}\n        {... reactGridLayoutProps}\n      >\n        {layoutChildren}\n      </ResponsiveHeightGridLayout>\n    </>\n  );\n}\n\nVitessceGridLayout.defaultProps = {\n  padding: 10,\n  margin: 10,\n};\n", "import { range } from '../../utils';\n\nexport const COMPONENT_ID_PREFIX = 'i';\n\nfunction sum(a) {\n  return a.reduce((x, y) => x + y, 0);\n}\n\nexport function makeGridLayout(colXs, colLayout) {\n  const colWs = [];\n  for (let i = 0; i < colXs.length; i++) { // eslint-disable-line no-plusplus\n    colWs.push(colXs[i + 1] - colXs[i]);\n  }\n  return Object.entries(colLayout).map(([id, spec]) => ({\n    i: id,\n    y: spec.y,\n    h: spec.h || 1,\n    x: colXs[spec.x],\n    w: sum(colWs.slice(spec.x, spec.x + (spec.w || 1))),\n  }));\n}\n\nexport function getMaxRows(layouts) {\n  return Math.max(\n    ...Object.values(layouts).map(\n      layout => Math.max(\n        ...layout.map(xywh => xywh.y + xywh.h),\n      ),\n    ),\n  );\n}\n\nexport function resolveLayout(layout) {\n  const cols = {};\n  const layouts = {};\n  const breakpoints = {};\n  const components = {};\n  const positions = {};\n\n  (('components' in layout) ? layout.components : layout).forEach(\n    (def, i) => {\n      const id = `${COMPONENT_ID_PREFIX}${i}`;\n      components[id] = {\n        component: def.component,\n        props: def.props || {},\n        coordinationScopes: def.coordinationScopes || {},\n      };\n      positions[id] = {\n        id, x: def.x, y: def.y, w: def.w, h: def.h,\n      };\n    },\n  );\n\n  if ('components' in layout) {\n    Object.entries(layout.columns).forEach(\n      ([width, columnXs]) => {\n        cols[width] = columnXs[columnXs.length - 1];\n        layouts[width] = makeGridLayout(columnXs, positions);\n        breakpoints[width] = width;\n      },\n    );\n  } else {\n    // static layout\n    const id = 'ID';\n    const columnCount = 12;\n    cols[id] = columnCount;\n    layouts[id] = makeGridLayout(range(columnCount + 1), positions);\n    breakpoints[id] = 1000;\n    // Default has different numbers of columns at different widths,\n    // so we do need to override that to ensure the same number of columns,\n    // regardless of window width.\n  }\n  return {\n    cols, layouts, breakpoints, components,\n  };\n}\n", "import {\n  useState, useEffect, useRef,\n} from 'react';\nimport { getSourceAndLoaderFromFileType } from '../loaders/types';\n\n/**\n * Return the bottom coordinate of the layout.\n * https://github.com/STRML/react-grid-layout/blob/20dac73f91274526034c00968b5bedb9c2ed36b9/lib/utils.js#L82\n * @param  {array} layout react-grid-layout layout array.\n * @returns {number} Bottom coordinate.\n */\nfunction getNumRows(layout) {\n  let max = 0;\n  let bottomY;\n  // eslint-disable-next-line no-plusplus\n  for (let i = 0, len = layout.length; i < len; i++) {\n    bottomY = layout[i].y + layout[i].h;\n    if (bottomY > max) max = bottomY;\n  }\n  return max;\n}\n\n/**\n * Compute the row height based on the container height, number of rows,\n * and margin/padding. Basically the reverse of the react-grid-layout's\n * `.containerHeight()` function.\n * https://github.com/STRML/react-grid-layout/blob/83251e5e682abfa3252ff89d4bacf47fdc1f4270/lib/ReactGridLayout.jsx#L223\n * @param {number} containerHeight The height of the .vitessce-container element.\n * @param {number} numRows The number of rows in the layout.\n * @param {number} margin The margin value that will be passed to VitessceGrid.\n * @param {number} padding The padding value that will be passed to VitessceGrid.\n * @returns {number} The new row height value.\n */\nfunction getRowHeight(containerHeight, numRows, margin, padding) {\n  const effectiveContainerHeight = containerHeight - 2 * padding - (numRows - 1) * margin;\n  return effectiveContainerHeight / numRows;\n}\n\nexport function useRowHeight(config, initialRowHeight, height, margin, padding) {\n  const [containerHeight, setContainerHeight] = useState(height);\n  const [rowHeight, setRowHeight] = useState(initialRowHeight);\n  const containerRef = useRef();\n\n  // Detect when the `config` or `containerHeight` variables\n  // have changed, and update `rowHeight` in response.\n  useEffect(() => {\n    const numRows = getNumRows(config.layout);\n    const newRowHeight = getRowHeight(containerHeight, numRows, margin, padding);\n    setRowHeight(newRowHeight);\n  }, [containerHeight, config, margin, padding]);\n\n  // Update the `containerHeight` state when the `height` prop has changed.\n  useEffect(() => {\n    if (height !== null && height !== undefined) {\n      setContainerHeight(height);\n    }\n  }, [height]);\n\n  // If no height prop has been provided, set the `containerHeight`\n  // using height of the `.vitessce-container` element.\n  // Check the container element height whenever the window has been\n  // resized, as it may change if `.vitessce-container` should be\n  // sized relative to its parent (and by extension, potentially the window).\n  useEffect(() => {\n    if (height !== null && height !== undefined) {\n      // eslint will complain if the return value is inconsistent,\n      // so return a no-op function.\n      return () => {};\n    }\n    function onWindowResize() {\n      if (!containerRef.current) return;\n      const containerRect = containerRef.current.getBoundingClientRect();\n      setContainerHeight(containerRect.height);\n    }\n    window.addEventListener('resize', onWindowResize);\n    onWindowResize();\n    return () => {\n      window.removeEventListener('resize', onWindowResize);\n    };\n  }, [containerRef, height]);\n\n\n  return [rowHeight, containerRef];\n}\n\n/**\n * Create a mapping from dataset ID to loader objects by data type.\n * @param {object[]} datasets The datasets array from the view config.\n * @param {string} configDescription The top-level description in the\n * view config.\n * @returns {object} Mapping from dataset ID to data type to loader\n * instance.\n */\nexport function createLoaders(datasets, configDescription) {\n  const result = {};\n  const dataSources = {};\n  datasets.forEach((dataset) => {\n    const datasetLoaders = {\n      name: dataset.name,\n      description: dataset.description || configDescription,\n      loaders: {},\n    };\n    dataset.files.forEach((file) => {\n      const [DataSourceClass, LoaderClass] = getSourceAndLoaderFromFileType(file.fileType);\n      // Create _one_ DataSourceClass instance per URL. Derived loaders share this object.\n      const { url, options, requestInit } = file;\n      const fileId = url || JSON.stringify(options);\n      if (!(fileId in dataSources)) {\n        dataSources[fileId] = new DataSourceClass({ url, requestInit });\n      }\n      const loader = new LoaderClass(dataSources[fileId], file);\n      datasetLoaders.loaders[file.type] = loader;\n    });\n    result[dataset.uid] = datasetLoaders;\n  });\n  return result;\n}\n", "import Ajv from 'ajv';\nimport AbstractTwoStepLoader from './AbstractTwoStepLoader';\nimport { LoaderValidationError, AbstractLoaderError } from './errors/index';\nimport LoaderResult from './LoaderResult';\n\nimport cellsSchema from '../schemas/cells.schema.json';\nimport moleculesSchema from '../schemas/molecules.schema.json';\nimport neighborhoodsSchema from '../schemas/neighborhoods.schema.json';\nimport rasterSchema from '../schemas/raster.schema.json';\nimport cellSetsSchema from '../schemas/cell-sets.schema.json';\n\nconst typeToSchema = {\n  cells: cellsSchema,\n  molecules: moleculesSchema,\n  neighborhoods: neighborhoodsSchema,\n  raster: rasterSchema,\n  'cell-sets': cellSetsSchema,\n};\n\nexport default class JsonLoader extends AbstractTwoStepLoader {\n  constructor(dataSource, params) {\n    super(dataSource, params);\n\n    const { type } = params;\n    this.schema = typeToSchema[type];\n  }\n\n  load() {\n    const {\n      url, type, fileType,\n    } = this;\n    if (this.data) {\n      return this.data;\n    }\n    this.data = this.dataSource.data\n      .then((data) => {\n        if (data instanceof AbstractLoaderError) {\n          return Promise.reject(data);\n        }\n        const [valid, reason] = this.validate(data);\n        if (valid) {\n          return Promise.resolve(new LoaderResult(data, url));\n        }\n        return Promise.reject(new LoaderValidationError(type, fileType, url, reason));\n      });\n    return this.data;\n  }\n\n  validate(data) {\n    const { schema, type } = this;\n    if (!schema) {\n      throw Error(`No schema for ${type}`);\n    }\n    const validate = new Ajv().compile(schema);\n    const valid = validate(data);\n    let failureReason;\n    if (!valid) {\n      failureReason = validate.errors;\n    }\n    return [valid, failureReason];\n  }\n}\n", "import uuidv4 from 'uuid/v4';\n\n/**\n * A loader ancestor class containing a default constructor\n * and a stub for the required load() method.\n */\nexport default class AbstractLoader {\n  constructor({\n    type, url, requestInit, options,\n  }) {\n    this.type = type;\n    this.url = url;\n    this.requestInit = requestInit;\n    this.options = options;\n\n    this.subscriptions = {};\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  load() {\n    throw new Error('The load() method has not been implemented.');\n  }\n\n  subscribe(subscriber) {\n    const token = uuidv4();\n    this.subscriptions[token] = subscriber;\n    return token;\n  }\n\n  unsubscribe(token) {\n    delete this.subscriptions[token];\n  }\n\n  publish(data) {\n    Object.values(this.subscriptions).forEach((subscriber) => {\n      subscriber(data);\n    });\n  }\n}\n", "import AbstractLoader from './AbstractLoader';\n\nexport default class AbstractTwoStepLoader extends AbstractLoader {\n  constructor(dataSource, params) {\n    super(params);\n    this.dataSource = dataSource;\n  }\n}\n", "\n\nexport default class LoaderResult {\n  constructor(data, url, coordinationValues = null) {\n    this.data = data;\n    this.url = url;\n    this.coordinationValues = coordinationValues;\n  }\n}\n", "import { openArray } from 'zarr';\nimport AbstractTwoStepLoader from './AbstractTwoStepLoader';\nimport LoaderResult from './LoaderResult';\n\nexport default class MatrixZarrLoader extends AbstractTwoStepLoader {\n  loadAttrs() {\n    if (this.attrs) {\n      return this.attrs;\n    }\n    this.attrs = this.dataSource.getJson('.zattrs');\n    return this.attrs;\n  }\n\n  loadArr() {\n    const { store } = this.dataSource;\n    if (this.arr) {\n      return this.arr;\n    }\n    this.arr = openArray({ store, path: '/', mode: 'r' }).then(z => new Promise((resolve) => {\n      z.getRaw([null, null])\n        .then(resolve);\n    }));\n    return this.arr;\n  }\n\n  load() {\n    return Promise\n      .all([this.loadAttrs(), this.loadArr()])\n      .then(data => Promise.resolve(new LoaderResult(data, null)));\n  }\n}\n", "import genesSchema from '../schemas/genes.schema.json';\nimport JsonLoader from './JsonLoader';\nimport { AbstractLoaderError } from './errors';\nimport LoaderResult from './LoaderResult';\n\nexport default class GenesJsonAsMatrixZarrLoader extends JsonLoader {\n  constructor(dataSource, params) {\n    super(dataSource, params);\n\n    this.schema = genesSchema;\n  }\n\n  async load() {\n    const payload = await super.load().catch(reason => Promise.resolve(reason));\n    if (payload instanceof AbstractLoaderError) {\n      return Promise.reject(payload);\n    }\n    const { data, url } = payload;\n    const cols = Object.keys(data);\n    const rows = (cols.length > 0 ? Object.keys(data[cols[0]].cells) : []);\n    const attrs = { rows, cols };\n\n    const normalizedFlatMatrix = rows\n      .flatMap(cellId => cols.map(\n        geneId => (data[geneId].cells[cellId] / data[geneId].max) * 255,\n      ));\n    // Need to wrap the NestedArray to mock the HTTPStore-based array\n    // which returns promises.\n    const arr = { data: Uint8Array.from(normalizedFlatMatrix) };\n    return Promise.resolve(new LoaderResult([attrs, arr], url));\n  }\n}\n", "import { extent } from 'd3-array';\nimport range from 'lodash/range';\nimport clustersSchema from '../schemas/clusters.schema.json';\nimport JsonLoader from './JsonLoader';\nimport { AbstractLoaderError } from './errors';\nimport LoaderResult from './LoaderResult';\n\nexport default class ClustersJsonAsMatrixZarrLoader extends JsonLoader {\n  constructor(dataSource, params) {\n    super(dataSource, params);\n\n    this.schema = clustersSchema;\n  }\n\n  async load() {\n    const payload = await super.load().catch(reason => Promise.resolve(reason));\n    if (payload instanceof AbstractLoaderError) {\n      return Promise.reject(payload);\n    }\n    const { data, url } = payload;\n    const { rows, cols, matrix } = data;\n    const attrs = {\n      rows: cols,\n      cols: rows,\n    };\n    const shape = [attrs.rows.length, attrs.cols.length];\n    // Normalize values by converting to one-byte integers.\n    // Normalize for each gene (column) independently.\n    const normalizedMatrix = matrix.map((col) => {\n      const [min, max] = extent(col);\n      const normalize = d => Math.floor(((d - min) / (max - min)) * 255);\n      return col.map(normalize);\n    });\n    // Transpose the normalized matrix.\n    const tNormalizedMatrix = range(shape[0])\n      .map(i => range(shape[1]).map(j => normalizedMatrix[j][i]));\n    // Flatten the transposed matrix.\n    const normalizedFlatMatrix = tNormalizedMatrix.flat();\n    // Need to wrap the NestedArray to mock the HTTPStore-based array\n    // which returns promises.\n    const arr = { data: Uint8Array.from(normalizedFlatMatrix) };\n    return Promise.resolve(new LoaderResult([attrs, arr], url));\n  }\n}\n", "import { ZarrPixelSource, loadOmeTiff } from '@hms-dbmi/viv';\nimport { openArray } from 'zarr';\nimport rasterSchema from '../schemas/raster.schema.json';\nimport JsonLoader from './JsonLoader';\nimport { AbstractLoaderError } from './errors';\nimport LoaderResult from './LoaderResult';\n\nimport { initializeRasterLayersAndChannels } from '../components/spatial/utils';\n\nasync function initLoader(imageData) {\n  const {\n    type, url, metadata, requestInit,\n  } = imageData;\n  switch (type) {\n    case ('zarr'): {\n      const {\n        dimensions, isPyramid, transform,\n      } = metadata || {};\n      const labels = dimensions.map(d => d.field);\n      let source;\n      if (isPyramid) {\n        const metadataUrl = `${url}${\n          url.slice(-1) === '/' ? '' : '/'\n        }.zmetadata`;\n        const response = await fetch(metadataUrl);\n        const { metadata: zarrMetadata } = await response.json();\n        const paths = Object.keys(zarrMetadata)\n          .filter(metaKey => metaKey.includes('.zarray'))\n          .map(arrMetaKeys => arrMetaKeys.slice(0, -7));\n        const data = await Promise.all(\n          paths.map(path => openArray({ store: url, path })),\n        );\n        const [yChunk, xChunk] = data[0].chunks.slice(-2);\n        const size = Math.min(yChunk, xChunk);\n        // deck.gl requirement for power-of-two tile size.\n        const tileSize = 2 ** Math.floor(Math.log2(size));\n        source = data.map(d => new ZarrPixelSource(d, labels, tileSize));\n      } else {\n        const data = await openArray({ store: url });\n        source = new ZarrPixelSource(data, labels);\n      }\n      return { data: source, metadata: { dimensions, transform }, channels: (dimensions.find(d => d.field === 'channel') || dimensions[0]).values };\n    }\n    case ('ome-tiff'): {\n      let loader;\n      // Fetch offsets for ome-tiff if needed.\n      if (metadata && 'omeTiffOffsetsUrl' in metadata) {\n        const { omeTiffOffsetsUrl } = metadata;\n        const res = await fetch(omeTiffOffsetsUrl, (requestInit || {}));\n        if (res.ok) {\n          const offsets = await res.json();\n          loader = await loadOmeTiff(\n            url,\n            {\n              offsets,\n              headers: requestInit?.headers,\n            },\n          );\n        } else {\n          throw new Error('Offsets not found but provided.');\n        }\n      } else {\n        loader = await loadOmeTiff(url, { headers: requestInit?.headers });\n      }\n      const { Pixels: { Channels } } = loader.metadata;\n      const channels = Array.isArray(Channels)\n        ? Channels.map((channel, i) => channel.Name || `Channel ${i}`)\n        : [Channels.Name || `Channel ${0}`];\n      return { ...loader, channels };\n    }\n    default: {\n      throw Error(`Image type (${type}) is not supported`);\n    }\n  }\n}\n\nexport default class RasterLoader extends JsonLoader {\n  constructor(dataSource, params) {\n    const { url, options } = params;\n    if (!url && options) {\n      // eslint-disable-next-line no-param-reassign\n      dataSource.url = URL.createObjectURL(new Blob([JSON.stringify(options)]));\n    }\n    super(dataSource, params);\n    this.schema = rasterSchema;\n  }\n\n  async load() {\n    const payload = await super.load().catch(reason => Promise.resolve(reason));\n    if (payload instanceof AbstractLoaderError) {\n      return Promise.reject(payload);\n    }\n    const { data: raster } = payload;\n    const { images, renderLayers, usePhysicalSizeScaling = false } = raster;\n\n    // Get image name and URL tuples.\n    const urls = images\n      .filter(image => !image.url.includes('zarr'))\n      .map(image => ([image.url, image.name]));\n\n    // Add a loaderCreator function for each image layer.\n    const imagesWithLoaderCreators = images.map(image => ({\n      ...image,\n      loaderCreator: async () => initLoader(image),\n    }));\n\n    // TODO: use options for initial selection of channels\n    // which omit domain/slider ranges.\n    if (!this.autoImageCache) {\n      this.autoImageCache = initializeRasterLayersAndChannels(\n        imagesWithLoaderCreators,\n        renderLayers,\n        usePhysicalSizeScaling,\n      );\n    }\n\n    return this.autoImageCache.then((autoImages) => {\n      const [autoImageLayers, imageLayerLoaders, imageLayerMeta] = autoImages;\n\n      const coordinationValues = {\n        spatialRasterLayers: autoImageLayers,\n      };\n      return new LoaderResult(\n        { loaders: imageLayerLoaders, meta: imageLayerMeta },\n        urls,\n        coordinationValues,\n      );\n    });\n  }\n}\n", "import { loadOmeZarr } from '@hms-dbmi/viv';\nimport { AbstractLoaderError } from './errors';\nimport LoaderResult from './LoaderResult';\n\nimport { initializeRasterLayersAndChannels } from '../components/spatial/utils';\nimport AbstractTwoStepLoader from './AbstractTwoStepLoader';\n\nfunction hexToRgb(hex) {\n  const result = /^#?([A-F\\d]{2})([A-F\\d]{2})([A-F\\d]{2})$/i.exec(hex);\n  return [\n    parseInt(result[1].toLowerCase(), 16),\n    parseInt(result[2].toLowerCase(), 16),\n    parseInt(result[3].toLowerCase(), 16),\n  ];\n}\n\nexport default class OmeZarrLoader extends AbstractTwoStepLoader {\n  async load() {\n    const payload = await this.dataSource.getJson('.zattrs').catch(reason => Promise.resolve(reason));\n    if (payload instanceof AbstractLoaderError) {\n      return Promise.reject(payload);\n    }\n\n    const loader = await loadOmeZarr(this.url, { fetchOptions: this.requestInit, type: 'multiscales' });\n    const { metadata } = loader;\n\n    const { omero } = metadata;\n\n    if (!omero) {\n      console.error('Path for image not valid');\n      return Promise.reject(payload);\n    }\n\n    const { rdefs, channels } = omero;\n\n    const t = rdefs.defaultT ?? 0;\n    const z = rdefs.defaultZ ?? 0;\n\n    const imagesWithLoaderCreators = [\n      {\n        name: omero.name,\n        channels: channels.map((channel, i) => ({\n          selection: { z, t, c: i },\n          slider: [channel.window.start, channel.window.end],\n          color: hexToRgb(channel.color),\n        })),\n        loaderCreator: async () => ({ ...loader, channels: channels.map(c => c.label) }),\n      },\n    ];\n\n    // TODO: use options for initial selection of channels\n    // which omit domain/slider ranges.\n    const [\n      autoImageLayers, imageLayerLoaders, imageLayerMeta,\n    ] = await initializeRasterLayersAndChannels(\n      imagesWithLoaderCreators, undefined,\n    );\n\n    const coordinationValues = {\n      spatialRasterLayers: autoImageLayers,\n    };\n    return Promise.resolve(new LoaderResult(\n      { loaders: imageLayerLoaders, meta: imageLayerMeta },\n      [],\n      coordinationValues,\n    ));\n  }\n}\n", "import Ajv from 'ajv';\nimport isNil from 'lodash/isNil';\nimport { dsvFormat } from 'd3-dsv';\nimport { parse as json2csv } from 'json2csv';\nimport { colorArrayToString, colorStringToArray } from './utils';\nimport { nodeTransform } from './cell-set-utils';\nimport { getDefaultColor } from '../utils';\nimport {\n  HIERARCHICAL_SCHEMAS, TABULAR_SCHEMAS,\n  MIME_TYPE_JSON, MIME_TYPE_TABULAR,\n  SEPARATOR_TABULAR, NA_VALUE_TABULAR,\n} from './constants';\n\n/**\n * Check if an imported tree has an old schema version that we know how to\n * \"upgrade\" to the latest schema version.  Validate against the schema.\n * @param {object} currTree A hierarchical tree object with a .version property,\n * which has already passed schema validation, but may not have the latest schema version.\n * @param {string} datatype The data type of the items in the schema.\n */\nexport function tryUpgradeTreeToLatestSchema(currTree, datatype) {\n  const validate = new Ajv().compile(HIERARCHICAL_SCHEMAS[datatype].schema);\n  const valid = validate(currTree);\n  if (!valid) {\n    const failureReason = JSON.stringify(validate.errors, null, 2);\n    throw new Error(`Tree validation failed: ${failureReason}`);\n  } else if (currTree.datatype !== datatype) {\n    throw new Error(\n      `The data type does not match the expected data type of '${datatype}'.`,\n    );\n  }\n  if (currTree.version === '0.1.2') {\n    // To upgrade from cell-sets schema 0.1.2 to 0.1.3,\n    // add a confidence value of null for each cell ID.\n    return {\n      ...currTree,\n      version: HIERARCHICAL_SCHEMAS[datatype].latestVersion,\n      tree: currTree.tree.map(levelZeroNode => nodeTransform(\n        levelZeroNode,\n        n => !n.children && Array.isArray(n.set),\n        n => ({ ...n, set: n.set.map(itemId => ([itemId, null])) }), [],\n      )),\n    };\n  }\n  return currTree;\n}\n\n/**\n * Handler for JSON imports. Validates and upgrades against the hierarchical sets schema.\n * @param {string} result The data passed from the FileReader as a string.\n * @param {string} datatype The data type to validate against.\n * @param {string} theme \"light\" or \"dark\" for the vitessce theme\n * @returns {object} The imported tree object.\n * @throws {Error} Throws error if validation fails or if the datatype does not match.\n */\n// eslint-disable-next-line no-unused-vars\nexport function handleImportJSON(result, datatype, theme) {\n  let importData = JSON.parse(result);\n  // Validate the imported file.\n  importData = tryUpgradeTreeToLatestSchema(importData, datatype);\n  return importData;\n}\n\n/**\n * Handler for tabular imports. Validates against the tabular sets schema.\n * @param {string} result The data passed from the FileReader as a string.\n * @param {string} datatype The data type to validate against.\n * @param {string} theme \"light\" or \"dark\" for the vitessce theme\n * @returns {object} The imported tree object.\n * @throws {Error} Throws error if validation fails or if the datatype does not match.\n */\nexport function handleImportTabular(result, datatype, theme) {\n  const dsvParser = dsvFormat(SEPARATOR_TABULAR);\n  const importData = dsvParser.parse(result, row => ({\n    groupName: row.groupName,\n    setName: row.setName,\n    setColor: (row.setColor ? colorStringToArray(row.setColor) : getDefaultColor(theme)),\n    obsId: row.obsId,\n    predictionScore: (\n      (\n        isNil(row.predictionScore)\n        || row.predictionScore === NA_VALUE_TABULAR\n      )\n        ? null\n        : +row.predictionScore\n    ),\n  }));\n  // Validate the imported file.\n  const validate = new Ajv().compile(TABULAR_SCHEMAS[datatype].schema);\n  const valid = validate(importData);\n  if (!valid) {\n    const failureReason = JSON.stringify(validate.errors, null, 2);\n    throw new Error(`Import validation failed: ${failureReason}`);\n  } else {\n    // Convert the validated array to a tree representation.\n    const treeToImport = {\n      version: HIERARCHICAL_SCHEMAS[datatype].latestVersion,\n      datatype,\n      tree: [],\n    };\n    const uniqueGroupNames = Array.from(new Set(importData.map(d => d.groupName)));\n    uniqueGroupNames.forEach((groupName) => {\n      const levelZeroNode = {\n        name: groupName,\n        children: [],\n      };\n      const groupRows = importData.filter(d => d.groupName === groupName);\n      const uniqueSetNames = Array.from(new Set(groupRows.map(d => d.setName)));\n      uniqueSetNames.forEach((setName) => {\n        const setRows = groupRows.filter(d => d.setName === setName);\n        const { setColor } = setRows[0];\n        const levelOneNode = {\n          name: setName,\n          color: setColor,\n          set: setRows.map(d => ([d.obsId, d.predictionScore])),\n        };\n        levelZeroNode.children.push(levelOneNode);\n      });\n      treeToImport.tree.push(levelZeroNode);\n    });\n    return treeToImport;\n  }\n}\n\n/**\n * Convert a tree object to a JSON representation.\n * @param {object} result The object to export.\n * @returns {string} The data in a string representation.\n */\nexport function handleExportJSON(result) {\n  const jsonString = JSON.stringify(result);\n  const dataString = `data:${MIME_TYPE_JSON};charset=utf-8,${encodeURIComponent(jsonString)}`;\n  return dataString;\n}\n\n/**\n * Convert a tree object with one level (height === 1) to a tabular representation.\n * @param {object} result The object to export.\n * @returns {string} The data in a string representation.\n */\nexport function handleExportTabular(result) {\n  // Convert a tree object to an array of JSON objects.\n  const exportData = [];\n  result.tree.forEach((levelZeroNode) => {\n    levelZeroNode.children.forEach((levelOneNode) => {\n      if (levelOneNode.set) {\n        levelOneNode.set.forEach(([obsId, prob]) => {\n          exportData.push({\n            groupName: levelZeroNode.name,\n            setName: levelOneNode.name,\n            setColor: colorArrayToString(levelOneNode.color),\n            obsId,\n            predictionScore: isNil(prob) ? NA_VALUE_TABULAR : prob,\n          });\n        });\n      }\n    });\n  });\n  const csvString = json2csv(exportData, {\n    fields: ['groupName', 'setName', 'setColor', 'obsId', 'predictionScore'],\n    delimiter: SEPARATOR_TABULAR,\n  });\n  const dataString = `data:${MIME_TYPE_TABULAR};charset=utf-8,${encodeURIComponent(csvString)}`;\n  return dataString;\n}\n\n/**\n * Download a file. Appends and removes an anchor node in the DOM.\n * @param {string} dataString The function that converts the data to a string.\n * @param {string} fileName The name of the file to be downloaded.\n */\nexport function downloadForUser(dataString, fileName) {\n  const downloadAnchorNode = document.createElement('a');\n  downloadAnchorNode.setAttribute('href', dataString);\n  downloadAnchorNode.setAttribute('download', fileName);\n  document.body.appendChild(downloadAnchorNode); // required for firefox\n  downloadAnchorNode.click();\n  downloadAnchorNode.remove();\n}\n", "import cellSetsSchema from '../schemas/cell-sets.schema.json';\nimport JsonLoader from './JsonLoader';\nimport { tryUpgradeTreeToLatestSchema } from '../components/sets/io';\nimport { AbstractLoaderError } from './errors';\nimport LoaderResult from './LoaderResult';\n\nimport { initializeCellSetColor } from '../components/sets/cell-set-utils';\n\nexport default class CellSetsJsonLoader extends JsonLoader {\n  constructor(dataSource, params) {\n    super(dataSource, params);\n\n    this.schema = cellSetsSchema;\n  }\n\n  async load() {\n    const payload = await super.load().catch(reason => Promise.resolve(reason));\n    if (payload instanceof AbstractLoaderError) {\n      return Promise.reject(payload);\n    }\n    const { data: rawData, url } = payload;\n    const upgradedData = tryUpgradeTreeToLatestSchema(rawData, 'cell');\n\n    const coordinationValues = {\n      cellSetSelection: [],\n      cellSetColor: [],\n    };\n\n    // Set up the initial coordination values.\n    if (upgradedData && upgradedData.tree.length >= 1) {\n      const { tree } = upgradedData;\n      const newAutoSetSelectionParentName = tree[0].name;\n      // Create a list of set paths to initally select.\n      const newAutoSetSelections = tree[0].children\n        .map(node => ([newAutoSetSelectionParentName, node.name]));\n      // Create a list of cell set objects with color mappings.\n      const newAutoSetColors = initializeCellSetColor(upgradedData, []);\n      coordinationValues.cellSetSelection = newAutoSetSelections;\n      coordinationValues.cellSetColor = newAutoSetColors;\n    }\n    return Promise.resolve(new LoaderResult(upgradedData, url, coordinationValues));\n  }\n}\n", "/* eslint-disable no-control-regex */\nimport { InternMap } from 'internmap';\nimport {\n  treeInitialize,\n  nodeAppendChild,\n  initializeCellSetColor,\n} from '../../components/sets/cell-set-utils';\nimport {\n  SETS_DATATYPE_CELL,\n} from '../../components/sets/constants';\nimport AbstractTwoStepLoader from '../AbstractTwoStepLoader';\nimport LoaderResult from '../LoaderResult';\n\nexport function dataToCellSetsTree(data, options) {\n  const [cellNames, cellSets] = data;\n  const cellSetsTree = treeInitialize(SETS_DATATYPE_CELL);\n  cellSets.forEach((cellSetIds, j) => {\n    const name = options[j].groupName;\n    let levelZeroNode = {\n      name,\n      children: [],\n    };\n    if (cellSetIds.length > 0 && Array.isArray(cellSetIds[0])) {\n      // Multi-level case.\n      const levelSets = new InternMap([], JSON.stringify);\n\n      cellNames.forEach((id, i) => {\n        const classes = cellSetIds.map(col => col[i]);\n        if (levelSets.has(classes)) {\n          levelSets.get(classes).push([id, null]);\n        } else {\n          levelSets.set(classes, [[id, null]]);\n        }\n      });\n\n      const levels = Array.from(levelSets.keys());\n\n      const getNextLevelNames = (levelSuffixes) => {\n        const nextLevelNames = Array.from(new Set(levelSuffixes.map(l => l[0])));\n        return nextLevelNames.sort((a, b) => a.localeCompare(b));\n      };\n\n      // Recursive function to create nodes.\n      const getNode = (parentLevelPrefixes, currLevelName, childLevelSuffixes) => {\n        const isLeaf = childLevelSuffixes.length === 0;\n        const resultNode = {\n          name: currLevelName,\n        };\n        if (isLeaf) {\n          // Base case: this is a leaf node.\n          resultNode.set = levelSets.get([...parentLevelPrefixes, currLevelName]);\n        } else {\n          // Are the remaining suffices redundant?\n          // Consider [\"Parent\", \"Child\", \"Child\"]\n          // where parentLevelPrefixes is [\"Parent\"] and currLevelName is \"Child\".\n          const shouldBeLeaf = (\n            childLevelSuffixes.length === 1\n            && currLevelName === childLevelSuffixes[0][childLevelSuffixes[0].length - 1]\n          );\n          if (shouldBeLeaf) {\n            resultNode.set = levelSets.get(\n              [...parentLevelPrefixes, currLevelName, ...childLevelSuffixes[0]],\n            );\n          } else {\n            // Recursion, run getNode() on each of the unique names at the next level.\n            const nextLevelNames = getNextLevelNames(childLevelSuffixes);\n\n            resultNode.children = nextLevelNames\n              .map(nextLevelName => getNode(\n                [...parentLevelPrefixes, currLevelName],\n                nextLevelName,\n                childLevelSuffixes\n                  .filter(l => l[0] === nextLevelName)\n                  .map(l => l.slice(1))\n                  .filter(v => v.length > 0),\n              ));\n          }\n        }\n        return resultNode;\n      };\n      // Start the recursion.\n      const levelOneNodes = getNextLevelNames(levels)\n        .map(levelOneName => getNode(\n          [],\n          levelOneName,\n          levels.filter(l => l[0] === levelOneName).map(l => l.slice(1)),\n        ));\n\n      levelZeroNode.children = levelOneNodes;\n    } else {\n      // Single-level case.\n      const uniqueCellSetIds = Array.from(new Set(cellSetIds)).sort();\n      const clusters = {};\n      // eslint-disable-next-line no-return-assign\n      uniqueCellSetIds.forEach(id => (clusters[id] = { name: id, set: [] }));\n      cellSetIds.forEach((id, i) => clusters[id].set.push([cellNames[i], null]));\n      Object.values(clusters).forEach(\n        // eslint-disable-next-line no-return-assign\n        cluster => (levelZeroNode = nodeAppendChild(levelZeroNode, cluster)),\n      );\n    }\n    cellSetsTree.tree.push(levelZeroNode);\n  });\n  return cellSetsTree;\n}\n\n/**\n * Loader for converting zarr into the cell sets json schema.\n */\nexport default class CellSetsZarrLoader extends AbstractTwoStepLoader {\n  loadCellSetIds() {\n    const { options } = this;\n    const cellSetZarrLocation = options.map(({ setName }) => setName);\n    return this.dataSource.loadObsVariables(cellSetZarrLocation);\n  }\n\n  async load() {\n    if (!this.cellSetsTree) {\n      const { options } = this;\n      this.cellSetsTree = Promise.all([\n        this.dataSource.loadObsIndex(),\n        this.loadCellSetIds(),\n      ]).then(data => dataToCellSetsTree(data, options));\n    }\n    const cellSetsTree = await this.cellSetsTree;\n    const coordinationValues = {};\n    const { tree } = cellSetsTree;\n    const newAutoSetSelectionParentName = tree[0].name;\n    // Create a list of set paths to initally select.\n    const newAutoSetSelections = tree[0].children.map(node => [\n      newAutoSetSelectionParentName,\n      node.name,\n    ]);\n    // Create a list of cell set objects with color mappings.\n    const newAutoSetColors = initializeCellSetColor(cellSetsTree, []);\n    coordinationValues.cellSetSelection = newAutoSetSelections;\n    coordinationValues.cellSetColor = newAutoSetColors;\n    return Promise.resolve(\n      new LoaderResult(cellSetsTree, null, coordinationValues),\n    );\n  }\n}\n", "import LoaderResult from '../LoaderResult';\nimport AbstractTwoStepLoader from '../AbstractTwoStepLoader';\n\n/**\n * Loader for converting zarr into the cell json schema.\n */\nexport default class CellsZarrLoader extends AbstractTwoStepLoader {\n  /**\n   * Class method for loading spatial cell centroids.\n   * @returns {Promise} A promise for an array of tuples/triples for cell centroids.\n   */\n  loadXy() {\n    const { xy } = (this.options || {});\n    if (this.xy) {\n      return this.xy;\n    }\n    if (!this.xy && xy) {\n      this.xy = this.dataSource.loadNumeric(xy);\n      return this.xy;\n    }\n    this.xy = Promise.resolve(null);\n    return this.xy;\n  }\n\n  /**\n   * Class method for loading spatial cell polygons.\n   * @returns {Promise} A promise for an array of arrays for cell polygons.\n   */\n  loadPoly() {\n    const { poly } = (this.options || {});\n    if (this.poly) {\n      return this.poly;\n    }\n    if (!this.poly && poly) {\n      this.poly = this.dataSource.loadNumeric(poly);\n      return this.poly;\n    }\n    this.poly = Promise.resolve(null);\n    return this.poly;\n  }\n\n  /**\n   * Class method for loading various mappings, like UMAP or tSNE cooridnates.\n   * @returns {Promise} A promise for an array of tuples of coordinates.\n   */\n  loadMappings() {\n    const { mappings } = (this.options || {});\n    if (this.mappings) {\n      return this.mappings;\n    }\n    if (!this.mappings && mappings) {\n      this.mappings = Promise.all(\n        Object.keys(mappings).map(async (coordinationName) => {\n          const { key } = mappings[coordinationName];\n          return { coordinationName, arr: await this.dataSource.loadNumeric(key) };\n        }),\n      );\n      return this.mappings;\n    }\n    this.mappings = Promise.resolve(null);\n    return this.mappings;\n  }\n\n  /**\n   * Class method for loading factors, which are cell set ids.\n   * @returns {Promise} A promise for an array of an array of strings of ids,\n   * where subarray is a clustering/factor.\n   */\n  loadFactors() {\n    const { factors } = (this.options || {});\n    if (factors) {\n      return this.dataSource.loadObsVariables(factors);\n    }\n    return Promise.resolve(null);\n  }\n\n  async load() {\n    if (!this.cells) {\n      this.cells = Promise.all([\n        this.loadMappings(),\n        this.loadXy(),\n        this.loadPoly(),\n        this.dataSource.loadObsIndex(),\n        this.loadFactors(),\n      ]).then(([mappings, xy, poly, cellNames, factors]) => {\n        const cells = {};\n        cellNames.forEach((name, i) => {\n          cells[name] = {};\n          if (mappings) {\n            mappings.forEach(({ coordinationName, arr }) => {\n              if (!cells[name].mappings) {\n                cells[name].mappings = {};\n              }\n              const { dims } = this.options.mappings[coordinationName];\n              cells[name].mappings[coordinationName] = dims.map(\n                dim => arr.data[i][dim],\n              );\n            });\n          }\n          if (xy) {\n            cells[name].xy = xy.data[i];\n          }\n          if (poly) {\n            cells[name].poly = poly.data[i];\n          }\n          if (factors) {\n            const factorsObj = {};\n            factors.forEach(\n              // eslint-disable-next-line no-return-assign\n              (factor, j) => (factorsObj[this.options.factors[j].split('/').slice(-1)] = factor[i]),\n            );\n            cells[name].factors = factorsObj;\n          }\n        });\n        return cells;\n      });\n    }\n    return Promise.resolve(new LoaderResult(await this.cells, null));\n  }\n}\n", "/* eslint-disable no-underscore-dangle */\nimport { openArray, slice } from 'zarr';\nimport { extent } from 'd3-array';\nimport LoaderResult from '../LoaderResult';\nimport AbstractTwoStepLoader from '../AbstractTwoStepLoader';\n\nconst normalize = (arr) => {\n  const [min, max] = extent(arr);\n  const ratio = 255 / (max - min);\n  const data = new Uint8Array(\n    arr.map(i => Math.floor((i - min) * ratio)),\n  );\n  return { data };\n};\n\nconst concatenateColumnVectors = (arr) => {\n  const numCols = arr.length;\n  const numRows = arr[0].length;\n  const { BYTES_PER_ELEMENT } = arr[0];\n  const view = new DataView(new ArrayBuffer(numCols * numRows * BYTES_PER_ELEMENT));\n  const TypedArray = arr[0].constructor;\n  const dtype = TypedArray.name.replace('Array', '');\n  for (let i = 0; i < numCols; i += 1) {\n    for (let j = 0; j < numRows; j += 1) {\n      view[`set${dtype}`](BYTES_PER_ELEMENT * (j * numCols + i), arr[i][j], true);\n    }\n  }\n  return new TypedArray(view.buffer);\n};\n\n/**\n * Loader for converting zarr into the a cell x gene matrix for use in Genes/Heatmap components.\n */\nexport default class MatrixZarrLoader extends AbstractTwoStepLoader {\n  /**\n   * Class method for loading the genes list from AnnData.var,\n   * filtered if a there is a `geneFilterZarr` present in the view config.\n   * @returns {Promise} A promise for the zarr array contianing the gene names.\n   */\n  async loadFilteredGeneNames() {\n    if (this.filteredGeneNames) {\n      return this.filteredGeneNames;\n    }\n    const { geneFilter: geneFilterZarr } = this.options;\n    const getFilterFn = async () => {\n      if (!geneFilterZarr) return data => data;\n      const geneFilter = await this.dataSource.getFlatArrDecompressed(geneFilterZarr);\n      return data => data.filter((_, j) => geneFilter[j]);\n    };\n\n    this.filteredGeneNames = Promise\n      .all([this.dataSource.loadVarIndex(), getFilterFn()])\n      .then(([data, filter]) => filter(data));\n    return this.filteredGeneNames;\n  }\n\n  /**\n   * Class method for loading a filtered subset of the genes list\n   * @param {String} filterZarr A location in the zarr store to fetch a boolean array from.\n   * @returns {Array} A list of filtered genes.\n   */\n  async _getFilteredGenes(filterZarr) {\n    const filter = await this.dataSource.getFlatArrDecompressed(filterZarr);\n    const geneNames = await this.loadFilteredGeneNames();\n    const genes = geneNames.filter((_, i) => filter[i]);\n    return genes;\n  }\n\n  /**\n   * Class method for getting the integer indices of a selection of genes within a list.\n   * @param {Array} selection A list of gene names.\n   * @returns {Array} A list of integer indices.\n   */\n  async _getGeneIndices(selection) {\n    const geneNames = await this.loadFilteredGeneNames();\n    return selection.map(gene => geneNames.indexOf(gene));\n  }\n\n  /**\n   * Class method for getting the number of cells i.e entries in `obs`.\n   * @returns {Number} The number of cells.\n   */\n  async _getNumCells() {\n    const cells = await this.dataSource.loadObsIndex();\n    return cells.length;\n  }\n\n  /**\n   * Class method for getting the number of genes i.e entries in `var`,\n   * potentially filtered by `genesFilter`.\n   * @returns {Number} The number of genes.\n   */\n  async _getNumGenes() {\n    const genes = await this.loadFilteredGeneNames();\n    return genes.length;\n  }\n\n  /**\n   * Class method for opening the sparse matrix arrays in zarr.\n   * @returns {Array} A list of promises pointing to the indptr, indices, and data of the matrix.\n   */\n  async _openSparseArrays() {\n    const { options: { matrix } } = this;\n    const { store } = this.dataSource;\n    if (this.sparseArrays) {\n      return this.sparseArrays;\n    }\n    this.sparseArrays = Promise.all(\n      ['indptr', 'indices', 'data'].map(name => openArray({ store, path: `${matrix}/${name}`, mode: 'r' })),\n    );\n    return this.sparseArrays;\n  }\n\n  /**\n   * Class method for loading a gene selection from a CSC matrix.\n   * @param {Array} selection A list of gene names whose data should be fetched.\n   * @returns {Promise} A Promise.all array of promises containing Uint8Arrays, one per selection.\n   */\n  async _loadCSCGeneSelection(selection) {\n    const indices = await this._getGeneIndices(selection);\n    const [indptrArr, indexArr, cellXGeneArr] = await this._openSparseArrays();\n    const numCells = await this._getNumCells();\n    const { data: cols } = await indptrArr.getRaw(null);\n    // If there is not change in the column indexer, then the data is all zeros\n    return Promise.all(\n      indices.map(async (index) => {\n        const startRowIndex = cols[index];\n        const endRowIndex = cols[index + 1];\n        const isColumnAllZeros = startRowIndex === endRowIndex;\n        const geneData = new Float32Array(numCells).fill(0);\n        if (isColumnAllZeros) {\n          return geneData;\n        }\n        const { data: rowIndices } = await indexArr.get([\n          slice(startRowIndex, endRowIndex),\n        ]);\n        const { data: cellXGeneData } = await cellXGeneArr.get([\n          slice(startRowIndex, endRowIndex),\n        ]);\n        for (let rowIndex = 0; rowIndex < rowIndices.length; rowIndex += 1) {\n          geneData[rowIndices[rowIndex]] = cellXGeneData[rowIndex];\n        }\n        return geneData;\n      }),\n    );\n  }\n\n  /**\n   * Class method for loading a gene selection from a CSR matrix.\n   * @param {Array} selection A list of gene names whose data should be fetched.\n   * @returns {Promise} A Promise.all array of promises containing Uint8Arrays, one per selection.\n   */\n  async _loadCSRGeneSelection(selection) {\n    const indices = await this._getGeneIndices(selection);\n    const numGenes = await this._getNumGenes();\n    const numCells = await this._getNumCells();\n    const cellXGene = await this._loadCSRSparseCellXGene();\n    return indices.map((index) => {\n      const geneData = new Float32Array(numCells).fill(0);\n      for (let i = 0; i < numCells; i += 1) {\n        geneData[i] = cellXGene[i * numGenes + index];\n      }\n      return geneData;\n    });\n  }\n\n  /**\n   * Class method for loading row oriented (CSR) sparse data from zarr.\n   *\n   * @returns {Object} A { data: Float32Array } contianing the CellXGene matrix.\n   */\n  async _loadCSRSparseCellXGene() {\n    if (this._sparseMatrix) {\n      return this._sparseMatrix;\n    }\n    this._sparseMatrix = this._openSparseArrays().then(async (sparseArrays) => {\n      const { options: { matrix } } = this;\n      const { shape } = await this.dataSource.getJson(`${matrix}/.zattrs`);\n      const [rows, cols, cellXGene] = await Promise.all(\n        sparseArrays.map(async (arr) => {\n          const { data } = await arr.getRaw(null);\n          return data;\n        }),\n      );\n      const cellXGeneMatrix = new Float32Array(shape[0] * shape[1]).fill(0);\n      let row = 0;\n      rows.forEach((_, index) => {\n        const rowStart = rows[index];\n        const rowEnd = rows[index + 1];\n        for (let i = rowStart; i < rowEnd; i += 1) {\n          const val = cellXGene[i];\n          const col = cols[i];\n          cellXGeneMatrix[row * shape[1] + col] = val;\n        }\n        row += 1;\n      });\n      return cellXGeneMatrix;\n    });\n    return this._sparseMatrix;\n  }\n\n  /**\n   * Class method for loading column oriented (CSC) sparse data from zarr.\n   * @returns {Object} A { data: Float32Array } contianing the CellXGene matrix.\n   */\n  async _loadCSCSparseCellXGene() {\n    if (this._sparseMatrix) {\n      return this._sparseMatrix;\n    }\n    this._sparseMatrix = this._openSparseArrays().then(async (sparseArrays) => {\n      const { options: { matrix } } = this;\n      const { shape } = await this.dataSource.getJson(`${matrix}/.zattrs`);\n      const [cols, rows, cellXGene] = await Promise.all(\n        sparseArrays.map(async (arr) => {\n          const { data } = await arr.getRaw(null);\n          return data;\n        }),\n      );\n      const cellXGeneMatrix = new Float32Array(shape[0] * shape[1]).fill(0);\n      let col = 0;\n      cols.forEach((_, index) => {\n        const colStart = cols[index];\n        const colEnd = cols[index + 1];\n        for (let i = colStart; i < colEnd; i += 1) {\n          const val = cellXGene[i];\n          const row = rows[i];\n          cellXGeneMatrix[row * shape[1] + col] = val;\n        }\n        col += 1;\n      });\n      return cellXGeneMatrix;\n    });\n    return this._sparseMatrix;\n  }\n\n  /**\n   * Class method for loading the cell x gene matrix.\n   * @returns {Promise} A promise for the zarr array contianing the cell x gene data.\n   */\n  async loadCellXGene() {\n    const { store } = this.dataSource;\n    if (this.cellXGene) {\n      return this.cellXGene;\n    }\n    const { options: { matrix, matrixGeneFilter } } = this;\n    if (!this._matrixZattrs) {\n      this._matrixZattrs = await this.dataSource.getJson(`${matrix}/.zattrs`);\n    }\n    const encodingType = this._matrixZattrs['encoding-type'];\n    if (!matrixGeneFilter) {\n      if (encodingType === 'csr_matrix') {\n        this.cellXGene = this._loadCSRSparseCellXGene().then(data => normalize(data));\n      } else if (encodingType === 'csc_matrix') {\n        this.cellXGene = this._loadCSCSparseCellXGene().then(data => normalize(data));\n      } else {\n        if (!this.arr) {\n          this.arr = openArray({ store, path: matrix, mode: 'r' });\n        }\n        this.cellXGene = this.arr.then(z => z.getRaw(null).then(({ data }) => normalize(data)));\n      }\n    } else if (encodingType === 'csr_matrix') {\n      this.cellXGene = this._loadCSRSparseCellXGene().then(\n        async (cellXGene) => {\n          const filteredGenes = await this._getFilteredGenes(matrixGeneFilter);\n          const numGenesFiltered = filteredGenes.length;\n          const geneNames = await this.loadFilteredGeneNames();\n          const numGenes = geneNames.length;\n          const numCells = await this._getNumCells();\n          const cellXGeneMatrixFiltered = new Float32Array(\n            numCells * numGenesFiltered,\n          ).fill(0);\n          for (let i = 0; i < numGenesFiltered; i += 1) {\n            const index = geneNames.indexOf(filteredGenes[i]);\n            for (let j = 0; j < numCells; j += 1) {\n              cellXGeneMatrixFiltered[j * numGenesFiltered + i] = cellXGene[j * numGenes + index];\n            }\n          }\n          return normalize(cellXGeneMatrixFiltered);\n        },\n      );\n    } else {\n      const genes = await this._getFilteredGenes(matrixGeneFilter);\n      this.cellXGene = this.loadGeneSelection({ selection: genes, shouldNormalize: false })\n        .then(({ data }) => (normalize(concatenateColumnVectors(data))));\n    }\n    return this.cellXGene;\n  }\n\n  /**\n   * Class method for loading a gene selection.\n   * @param {Object} args\n   * @param {Array} args.selection A list of gene names whose data should be fetched.\n   * @param {Boolean} args.shouldNormalize A list of gene names whose data should be fetched.\n   * @returns {Object} { data } containing an array of gene expression data.\n   */\n  async loadGeneSelection({ selection, shouldNormalize = true }) {\n    const { options: { matrix } } = this;\n    const { store } = this.dataSource;\n    if (!this._matrixZattrs) {\n      this._matrixZattrs = await this.dataSource.getJson(`${matrix}/.zattrs`);\n    }\n    const encodingType = this._matrixZattrs['encoding-type'];\n    let genes;\n    if (encodingType === 'csc_matrix') {\n      genes = await this._loadCSCGeneSelection(selection);\n    } else if (encodingType === 'csr_matrix') {\n      genes = await this._loadCSRGeneSelection(selection);\n    } else {\n      if (!this.arr) {\n        this.arr = openArray({ store, path: matrix, mode: 'r' });\n      }\n      const indices = await this._getGeneIndices(selection);\n      // We can index directly into a normal dense array zarr store via `get`.\n      genes = await Promise.all(\n        indices.map(index => this.arr.then(z => z.get([null, index])).then(({ data }) => data)),\n      );\n    }\n    return { data: genes.map(i => (shouldNormalize ? normalize(i).data : i)), url: null };\n  }\n\n  /**\n   * Class method for loading only attributes i.e rows and columns\n   * @param {Array} selection A list of gene names whose data should be fetched.\n   * @returns {Object} { data: { rows, cols }, url } containing row and col labels for the matrix.\n   */\n  loadAttrs() {\n    return Promise.all([this.dataSource.loadObsIndex(), this.loadFilteredGeneNames()])\n      .then((d) => {\n        const [cellNames, geneNames] = d;\n        const attrs = { rows: cellNames, cols: geneNames };\n        return {\n          data: attrs,\n          url: null,\n        };\n      });\n  }\n\n  load() {\n    return Promise.all([this.loadAttrs(), this.loadCellXGene()]).then(\n      async (d) => {\n        const [{ data: attrs }, cellXGene] = d;\n        const {\n          options: { matrixGeneFilter: matrixGeneFilterZarr },\n        } = this;\n        // In order to return the correct gene list with the heatmap data,\n        // we need to filter the columns of attrs so it matches the cellXGene data.\n        if (matrixGeneFilterZarr) {\n          const matrixGeneFilter = await this.dataSource.getFlatArrDecompressed(\n            matrixGeneFilterZarr,\n          );\n          attrs.cols = attrs.cols.filter((_, i) => matrixGeneFilter[i]);\n        }\n        return Promise.resolve(new LoaderResult([attrs, cellXGene], null));\n      },\n    );\n  }\n}\n", "import CellSetsZarrLoader from './CellSetsZarrLoader';\nimport CellsZarrLoader from './CellsZarrLoader';\nimport MatrixZarrLoader from './MatrixZarrLoader';\n\nexport default { CellSetsZarrLoader, CellsZarrLoader, MatrixZarrLoader };\n", "import AbstractTwoStepLoader from './AbstractTwoStepLoader';\nimport LoaderResult from './LoaderResult';\n\nexport default class GenomicProfilesZarrLoader extends AbstractTwoStepLoader {\n  loadAttrs() {\n    if (this.attrs) {\n      return this.attrs;\n    }\n    this.attrs = this.dataSource.getJson('.zattrs');\n    return this.attrs;\n  }\n\n  load() {\n    const { url } = this;\n    return this.loadAttrs()\n      .then(attrs => Promise.resolve(new LoaderResult(attrs, url)));\n  }\n}\n", "/* eslint-disable no-underscore-dangle */\nimport { openArray } from 'zarr';\nimport range from 'lodash/range';\nimport ZarrDataSource from './ZarrDataSource';\n\nconst readFloat32FromUint8 = (bytes) => {\n  if (bytes.length !== 4) {\n    throw new Error('readFloat32 only takes in length 4 byte buffers');\n  }\n  return new Int32Array(bytes.buffer)[0];\n};\n\nconst HEADER_LENGTH = 4;\n\n/**\n   * Method for decoding text arrays from zarr.\n   * Largerly a port of https://github.com/zarr-developers/numcodecs/blob/2c1aff98e965c3c4747d9881d8b8d4aad91adb3a/numcodecs/vlen.pyx#L135-L178\n   * @returns {string[]} An array of strings.\n   */\nfunction parseVlenUtf8(buffer) {\n  const decoder = new TextDecoder();\n  let data = 0;\n  const dataEnd = data + buffer.length;\n  const length = readFloat32FromUint8(buffer.slice(data, HEADER_LENGTH));\n  if (buffer.length < HEADER_LENGTH) {\n    throw new Error('corrupt buffer, missing or truncated header');\n  }\n  data += HEADER_LENGTH;\n  const output = new Array(length);\n  for (let i = 0; i < length; i += 1) {\n    if (data + 4 > dataEnd) {\n      throw new Error('corrupt buffer, data seem truncated');\n    }\n    const l = readFloat32FromUint8(buffer.slice(data, data + 4));\n    data += 4;\n    if (data + l > dataEnd) {\n      throw new Error('corrupt buffer, data seem truncated');\n    }\n    output[i] = decoder.decode(buffer.slice(data, data + l));\n    data += l;\n  }\n  return output;\n}\n\n/**\n * A base AnnData loader which has all shared methods for more comlpex laoders,\n * like loading cell names and ids. It inherits from AbstractLoader.\n */\nexport default class AnnDataSource extends ZarrDataSource {\n  constructor(...args) {\n    super(...args);\n    /** @type {Map<string, Promise<string[]>} */\n    this.obsPromises = new Map();\n  }\n\n  /**\n   * Class method for loading obs variables.\n   * Takes the location as an argument because this is shared across objects,\n   * which have different ways of specifying location.\n   * @param {string[]} obsPaths An array of strings like \"obs/leiden\" or \"obs/bulk_labels.\"\n   * @returns {Promise} A promise for an array of ids with one per cell.\n   */\n  loadObsVariables(obsPaths) {\n    const obsPromises = obsPaths.map((obsPath) => {\n      const getObsCol = (obsCol) => {\n        if (!this.obsPromises.has(obsCol)) {\n          const obsPromise = this._loadObsVariable(obsCol).catch((err) => {\n            // clear from cache if promise rejects\n            this.obsPromises.delete(obsCol);\n            // propagate error\n            throw err;\n          });\n          this.obsPromises.set(obsCol, obsPromise);\n        }\n        return this.obsPromises.get(obsCol);\n      };\n      if (Array.isArray(obsPath)) {\n        return Promise.resolve(Promise.all(obsPath.map(getObsCol)));\n      }\n      return getObsCol(obsPath);\n    });\n    return Promise.all(obsPromises);\n  }\n\n  async _loadObsVariable(obs) {\n    const { store } = this;\n    const { categories } = await this.getJson(`${obs}/.zattrs`);\n    let categoriesValues;\n    if (categories) {\n      const { dtype } = await this.getJson(`/obs/${categories}/.zarray`);\n      if (dtype === '|O') {\n        categoriesValues = await this.getFlatArrDecompressed(`/obs/${categories}`);\n      }\n    }\n    const obsArr = await openArray({ store, path: obs, mode: 'r' });\n    const obsValues = await obsArr.get();\n    const { data } = obsValues;\n    const mappedObsValues = Array.from(data).map(\n      i => (!categoriesValues ? String(i) : categoriesValues[i]),\n    );\n    return mappedObsValues;\n  }\n\n  /**\n   * Class method for loading general numeric arrays.\n   * @param {string} path A string like obsm.X_pca.\n   * @returns {Promise} A promise for a zarr array containing the data.\n   */\n  loadNumeric(path) {\n    const { store } = this;\n    return openArray({\n      store,\n      path,\n      mode: 'r',\n    }).then(arr => arr.get());\n  }\n\n  /**\n   * A common method for loading flattened data\n   * i.e that which has shape [n] where n is a natural number.\n   * @param {string} path A path to a flat array location, like obs/_index\n   * @returns {Array} The data from the zarr array.\n   */\n  getFlatArrDecompressed(path) {\n    const { store } = this;\n    return openArray({\n      store,\n      path,\n      mode: 'r',\n    }).then(async (z) => {\n      let data;\n      const parseAndMergeTextBytes = (dbytes) => {\n        const text = parseVlenUtf8(dbytes);\n        if (!data) {\n          data = text;\n        } else {\n          data = data.concat(text);\n        }\n      };\n      const mergeBytes = (dbytes) => {\n        if (!data) {\n          data = dbytes;\n        } else {\n          const tmp = new Uint8Array(dbytes.buffer.byteLength + data.buffer.byteLength);\n          tmp.set(new Uint8Array(data.buffer), 0);\n          tmp.set(dbytes, data.buffer.byteLength);\n          data = tmp;\n        }\n      };\n      const numRequests = Math.ceil(z.meta.shape[0] / z.meta.chunks[0]);\n      const requests = range(numRequests).map(async item => store.getItem(`${z.keyPrefix}${String(item)}`)\n        .then(buf => z.compressor.then(compressor => compressor.decode(buf))));\n      const dbytesArr = await Promise.all(requests);\n      dbytesArr.forEach((dbytes) => {\n        // Use vlenutf-8 decoding if necessary and merge `data` as a normal array.\n        if (Array.isArray(z.meta.filters) && z.meta.filters[0].id === 'vlen-utf8') {\n          parseAndMergeTextBytes(dbytes);\n          // Otherwise just merge the bytes as a typed array.\n        } else {\n          mergeBytes(dbytes);\n        }\n      });\n      const {\n        meta: {\n          shape: [length],\n        },\n      } = z;\n      // truncate the filled in values\n      return data.slice(0, length);\n    });\n  }\n\n  /**\n   * Class method for loading the obs index.\n   * @returns {Promise} An promise for a zarr array containing the indices.\n   */\n  loadObsIndex() {\n    if (this.obsIndex) {\n      return this.obsIndex;\n    }\n    this.obsIndex = this.getJson('obs/.zattrs')\n      .then(({ _index }) => this.getFlatArrDecompressed(`/obs/${_index}`));\n    return this.obsIndex;\n  }\n\n  /**\n   * Class method for loading the var index.\n   * @returns {Promise} An promise for a zarr array containing the indices.\n   */\n  loadVarIndex() {\n    if (this.varIndex) {\n      return this.varIndex;\n    }\n    this.varIndex = this.getJson('var/.zattrs')\n      .then(({ _index }) => this.getFlatArrDecompressed(`/var/${_index}`));\n    return this.varIndex;\n  }\n}\n", "import { HTTPStore, KeyError } from 'zarr';\n\n/**\n * A loader ancestor class containing a default constructor\n * and a stub for the required load() method.\n */\nexport default class ZarrDataSource {\n  constructor({ url, requestInit }) {\n    // TODO: We should probably add a way of allowing HEAD requests as well:\n    // https://github.com/gzuidhof/zarr.js/blob/375ce0c299469a970da6bb5653513564e25806bb/docs/getting-started/remote-data.md#stores\n    const supportedMethods = ['GET'];\n    this.store = new HTTPStore(url, {\n      supportedMethods, fetchOptions: requestInit,\n    });\n  }\n\n  /**\n   * Class method for decoding json from the store.\n   * @param {string} key A path to the item.\n   * @returns {Promise} This async function returns a promise\n   * that resolves to the parsed JSON if successful.\n   * @throws This may throw an error.\n   */\n  async getJson(key) {\n    try {\n      const buf = await this.store.getItem(key);\n      const text = new TextDecoder('utf-8').decode(buf);\n      return JSON.parse(text);\n    } catch (err) {\n      if (err instanceof KeyError) {\n        return {};\n      }\n      throw err;\n    }\n  }\n}\n", "import AbstractLoaderError from './AbstractLoaderError';\n\nexport default class DataSourceFetchError extends AbstractLoaderError {\n  constructor(source, url, headers) {\n    super(`${source} Error HTTP Status fetching from ${url}`);\n    this.source = source;\n    this.url = url;\n    this.headers = headers;\n  }\n\n  warnInConsole() {\n    const { source, url, headers } = this;\n    console.warn(`${source} failed to fetch from ${url} with headers ${headers}`);\n  }\n}\n", "/* eslint-disable no-underscore-dangle */\nimport DataSourceFetchError from '../errors/DataSourceFetchError';\n\nexport default class JsonSource {\n  constructor({ url, requestInit }) {\n    this.url = url;\n    this.requestInit = requestInit;\n  }\n\n  get data() {\n    if (this._data) return this._data;\n    this._data = fetch(this.url, this.requestInit).then((response) => {\n      if (!response.ok) {\n        return Promise.reject(new DataSourceFetchError('JsonSource', this.url, response.headers));\n      }\n      return response.json();\n    // eslint-disable-next-line no-console\n    }).catch(() => Promise.reject(new DataSourceFetchError('JsonSource', this.url, {})));\n    return this._data;\n  }\n}\n", "import JsonLoader from './JsonLoader';\nimport MatrixZarrLoader from './MatrixZarrLoader';\nimport GenesJsonAsMatrixZarrLoader from './GenesJsonAsMatrixZarrLoader';\nimport ClustersJsonAsMatrixZarrLoader from './ClustersJsonAsMatrixZarrLoader';\nimport RasterJsonLoader from './RasterJsonLoader';\nimport OmeZarrLoader from './OmeZarrLoader';\nimport CellSetsJsonLoader from './CellSetsJsonLoader';\nimport AnnDataLoaders from './anndata-loaders';\nimport GenomicProfilesZarrLoader from './GenomicProfilesZarrLoader';\n\nimport { AnnDataSource, ZarrDataSource, JsonSource } from './data-sources';\n\nconst ANNDATA = 'anndata';\n\nconst fileTypeToLoaderAndSource = {\n  'expression-matrix.zarr': [ZarrDataSource, MatrixZarrLoader],\n  'clusters.json': [JsonSource, ClustersJsonAsMatrixZarrLoader],\n  'genes.json': [JsonSource, GenesJsonAsMatrixZarrLoader],\n  'cells.json': [JsonSource, JsonLoader],\n  'molecules.json': [JsonSource, JsonLoader],\n  'neighborhoods.json': [JsonSource, JsonLoader],\n  'raster.json': [JsonSource, RasterJsonLoader],\n  'raster.ome-zarr': [ZarrDataSource, OmeZarrLoader],\n  'cell-sets.json': [JsonSource, CellSetsJsonLoader],\n  [`${ANNDATA}-cell-sets.zarr`]: [AnnDataSource, AnnDataLoaders.CellSetsZarrLoader],\n  [`${ANNDATA}-cells.zarr`]: [AnnDataSource, AnnDataLoaders.CellsZarrLoader],\n  [`${ANNDATA}-expression-matrix.zarr`]: [AnnDataSource, AnnDataLoaders.MatrixZarrLoader],\n  'genomic-profiles.zarr': [ZarrDataSource, GenomicProfilesZarrLoader],\n};\n\nexport function getSourceAndLoaderFromFileType(type) {\n  return fileTypeToLoaderAndSource[type] || [JsonSource, JsonLoader];\n}\n", "import React, { useEffect, useRef, useState } from 'react';\nimport { getConfig, listConfigs } from './api';\nimport Welcome from './Welcome';\nimport Warning from './Warning';\nimport Vitessce from './Vitessce';\n\nimport '../css/index.scss';\nimport '../../node_modules/react-grid-layout/css/styles.css';\nimport '../../node_modules/react-resizable/css/styles.css';\n\nfunction AwaitResponse(props) {\n  const {\n    response,\n    theme,\n  } = props;\n  const [isLoading, setIsLoading] = useState(true);\n  const responseRef = useRef();\n  useEffect(() => {\n    response.then((c) => {\n      responseRef.current = c;\n      setIsLoading(false);\n    });\n  }, [response]);\n  return (!isLoading ? React.createElement(responseRef.current) : <Warning title=\"Loading...\" theme={theme} />);\n}\n\nfunction preformattedDetails(response) {\n  return `\n    ok: ${response.ok}\n    status: ${response.status}\n    statusText: ${response.statusText}\n    redirected: ${response.redirected}\n    type: ${response.type}\n    url: ${response.url}`; // TODO: headers\n}\n\n\nfunction checkResponse(response, theme, debug) {\n  if (!response.ok) {\n    return Promise.resolve(\n      () => (\n        <Warning\n          title=\"Fetch response not OK\"\n          preformatted={preformattedDetails(response)}\n          theme={theme}\n        />\n      ),\n    );\n  }\n  return response.text().then((text) => {\n    try {\n      const config = JSON.parse(text);\n      return Promise.resolve(() => (\n        <Vitessce\n          config={config}\n          theme={theme}\n          // eslint-disable-next-line no-console\n          onConfigChange={debug ? console.log : undefined}\n          validateOnConfigChange={debug}\n        />\n      ));\n    } catch (e) {\n      return Promise.resolve(() => (\n        <Warning\n          title=\"Error parsing JSON\"\n          preformatted={preformattedDetails(response)}\n          unformatted={`${e.message}: ${text}`}\n          theme={theme}\n        />\n      ));\n    }\n  });\n}\n\n/**\n * Use the theme provided if it is valid, otherwise fall back to the 'dark' theme.\n * @param {string} theme A potentially invalid theme name.\n * @returns {string} A valid theme name.\n */\nfunction validateTheme(theme) {\n  return (['light', 'dark'].includes(theme) ? theme : 'dark');\n}\n\n/**\n * Convenience function for creating the minimal Vitessce demo and demo listing\n * components based on the current URL parameters.\n * @param {object} params\n * @param {number|null} params.rowHeight The row height to pass to the Vitessce grid.\n * Optional. By default, null.\n * @param {boolean} showBetaHeader Should the header which links to the beta documentation\n * website be rendered? Optional. By default, false.\n * @returns A component, either <Welcome/> or <Vitessce/> depending on the URL params.\n */\nexport function createApp(params) {\n  const { rowHeight = null, showBetaHeader = false } = params;\n  const urlParams = new URLSearchParams(window.location.search);\n  const datasetId = urlParams.get('dataset');\n  const debug = urlParams.get('debug') === 'true';\n  const datasetUrl = urlParams.get('url');\n  const showAll = urlParams.get('show') === 'all';\n  const theme = validateTheme(urlParams.get('theme'));\n\n  if (datasetId) {\n    const config = getConfig(datasetId);\n    return (\n      <Vitessce\n        config={config}\n        rowHeight={rowHeight}\n        theme={theme}\n        // eslint-disable-next-line no-console\n        onConfigChange={(debug ? console.log : undefined)}\n        validateOnConfigChange={debug}\n      />\n    );\n  }\n  if (datasetUrl) {\n    const responsePromise = fetch(datasetUrl)\n      .then(response => checkResponse(response, theme, debug))\n      .catch(error => Promise.resolve(() => (\n        <Warning\n          title=\"Error fetching\"\n          unformatted={error.message}\n          theme={theme}\n        />\n      )));\n    return (\n      <AwaitResponse response={responsePromise} theme={theme} />\n    );\n  }\n  const configs = listConfigs(showAll);\n  return (<Welcome configs={configs} theme={theme} showBetaHeader={showBetaHeader} />);\n}\n", "// Exported because used by the cypress tests: They route API requests to the fixtures instead.\nexport const urlPrefix = 'https://s3.amazonaws.com/vitessce-data/0.0.31/master_release';\n\nfunction makeLayerNameToConfig(datasetPrefix) {\n  return name => ({\n    name,\n    type: name.toUpperCase(),\n    fileType: `${name}.json`,\n    url: `${urlPrefix}/${datasetPrefix}/${datasetPrefix}.${name}.json`,\n  });\n}\n\nconst linnarssonLayerNames = [\n  'cells',\n  'cell-sets',\n  'raster',\n  'molecules',\n  'neighborhoods',\n];\nconst linnarssonDescription = 'Spatial organization of the somatosensory cortex revealed by cyclic smFISH';\nconst linnarssonBase = {\n  description: linnarssonDescription,\n  layers: [\n    ...linnarssonLayerNames.map(makeLayerNameToConfig('linnarsson')),\n    {\n      // TODO: remove this temporary override when the\n      // clusters.json file has been converted to expression-matrix.zarr format.\n      ...makeLayerNameToConfig('linnarsson')('clusters'),\n      type: 'EXPRESSION-MATRIX',\n    },\n  ],\n};\nconst linnarssonBaseNoClusters = {\n  description: linnarssonDescription,\n  layers: linnarssonLayerNames.filter(name => name !== 'clusters')\n    .map(makeLayerNameToConfig('linnarsson')),\n};\n\nconst driesDescription = 'Giotto, a pipeline for integrative analysis and visualization of single-cell spatial transcriptomic data';\nconst driesBase = {\n  description: driesDescription,\n  layers: [\n    'cells',\n    'cell-sets',\n  ].map(makeLayerNameToConfig('dries')),\n};\n\nconst wangDescription = 'Multiplexed imaging of high-density libraries of RNAs with MERFISH and expansion microscopy';\nconst wangBase = {\n  description: wangDescription,\n  layers: [\n    ...['cells', 'molecules'].map(makeLayerNameToConfig('wang')),\n    {\n      // TODO: remove this temporary override when the\n      // genes.json file has been converted to expression-matrix.zarr format.\n      ...makeLayerNameToConfig('wang')('genes'),\n      name: 'expression-matrix',\n      type: 'EXPRESSION-MATRIX',\n    },\n  ],\n};\n\nconst vanderbiltDescription = 'High Bit Depth (uint16) Multiplex Immunofluorescence Imaging';\nconst vanderbiltBase = {\n  description: vanderbiltDescription,\n  layers: [\n    'raster',\n  ].map(makeLayerNameToConfig('spraggins')),\n};\n\n/* eslint-disable object-property-newline */\n/* eslint-disable object-curly-newline */\n// Note that the ordering of the components in the staticLayout\n// can affect the z-index of plot tooltips due to the\n// resulting ordering of elements in the DOM.\nexport const configs = {\n  'just-scatter': {\n    version: '0.1.0',\n    public: false,\n    layers: [\n      {\n        name: 'cells',\n        type: 'CELLS',\n        fileType: 'cells.json',\n        url: `${urlPrefix}/linnarsson/linnarsson.cells.json`,\n        requestInit: {\n          // Where the client checks that the value is from an enumeration,\n          // I've chosen one of the allowed values,\n          // but nothing on our S3 actually needs any of these.\n          method: 'GET',\n          headers: { 'x-foo': 'FAKE' },\n          mode: 'cors',\n          credentials: 'omit',\n          cache: 'no-store',\n          redirect: 'error',\n          referrer: 'FAKE',\n          integrity: 'FAKE',\n        },\n      },\n    ],\n    name: 'Linnarsson, just scatterplot',\n    staticLayout: [\n      {\n        component: 'scatterplot',\n        props: {\n          mapping: 't-SNE',\n          view: {\n            zoom: 0.75,\n            target: [0, 0, 0],\n          },\n        },\n        x: 0, y: 0, w: 12, h: 2,\n      },\n    ],\n  },\n  'just-scatter-expression': {\n    version: '0.1.0',\n    public: false,\n    layers: [\n      {\n        name: 'cells',\n        type: 'CELLS',\n        url: 'https://s3.amazonaws.com/vitessce-data/0.0.20/master_release/linnarsson/linnarsson.cells.json',\n      },\n      {\n        name: 'genes',\n        type: 'GENES',\n        url: 'https://s3.amazonaws.com/vitessce-data/0.0.20/master_release/linnarsson/linnarsson.genes.json',\n      },\n    ],\n    name: 'Linnarsson, just scatterplot and expression',\n    staticLayout: [\n      {\n        component: 'scatterplot',\n        props: {\n          mapping: 't-SNE',\n          view: {\n            zoom: 0.75,\n            target: [0, 0, 0],\n          },\n        },\n        x: 0, y: 0, w: 8, h: 2,\n      },\n      {\n        component: 'genes',\n        x: 8, y: 2, w: 4, h: 2,\n      },\n    ],\n  },\n  'linnarsson-2018': {\n    name: 'Linnarsson',\n    version: '1.0.0',\n    description: linnarssonDescription,\n    public: true,\n    datasets: [\n      {\n        uid: 'linnarsson-2018',\n        name: 'Linnarsson 2018',\n        description: `Linnarsson: ${linnarssonDescription}`,\n        files: linnarssonBase.layers.map(file => ({\n          type: file.type.toLowerCase(),\n          fileType: file.fileType,\n          url: file.url,\n        })),\n      },\n    ],\n    initStrategy: 'auto',\n    coordinationSpace: {\n      embeddingZoom: {\n        PCA: 0,\n        TSNE: 0.75,\n      },\n      embeddingType: {\n        PCA: 'PCA',\n        TSNE: 't-SNE',\n      },\n      spatialZoom: {\n        A: -5.5,\n      },\n      spatialTargetX: {\n        A: 16000,\n      },\n      spatialTargetY: {\n        A: 20000,\n      },\n    },\n    layout: [\n      { component: 'description',\n        x: 0, y: 0, w: 2, h: 1 },\n      { component: 'layerController',\n        x: 0, y: 1, w: 2, h: 4,\n      },\n      { component: 'status',\n        x: 0, y: 5, w: 2, h: 1 },\n      { component: 'spatial',\n        coordinationScopes: {\n          spatialZoom: 'A',\n          spatialTargetX: 'A',\n          spatialTargetY: 'A',\n        },\n        x: 2, y: 0, w: 4, h: 4 },\n      { component: 'genes',\n        x: 9, y: 0, w: 3, h: 2 },\n      { component: 'cellSets',\n        x: 9, y: 3, w: 3, h: 2 },\n      { component: 'heatmap',\n        props: {\n          transpose: true,\n        },\n        x: 2, y: 4, w: 5, h: 2 },\n      { component: 'cellSetExpression',\n        x: 7, y: 4, w: 3, h: 2 },\n      { component: 'expressionHistogram',\n        x: 10, y: 4, w: 2, h: 2 },\n      { component: 'scatterplot',\n        coordinationScopes: {\n          embeddingType: 'PCA',\n          embeddingZoom: 'PCA',\n        },\n        x: 6, y: 0, w: 3, h: 2 },\n      { component: 'scatterplot',\n        coordinationScopes: {\n          embeddingType: 'TSNE',\n          embeddingZoom: 'TSNE',\n        },\n        x: 6, y: 2, w: 3, h: 2 },\n    ],\n  },\n  'linnarsson-2018-two-spatial': {\n    ...linnarssonBase,\n    version: '0.1.0',\n    name: 'Linnarsson (two spatial)',\n    staticLayout: [\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -8,\n            target: [18000, 18000, 0],\n          },\n        },\n        x: 0, y: 0, w: 5, h: 2 },\n      { component: 'scatterplot',\n        props: { mapping: 't-SNE' },\n        x: 0, y: 2, w: 5, h: 2 },\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -6,\n            target: [18000, 18000, 0],\n          },\n        },\n        x: 5, y: 0, w: 5, h: 2 },\n      { component: 'scatterplot',\n        props: { mapping: 'PCA' },\n        x: 5, y: 2, w: 5, h: 2 },\n      { component: 'genes',\n        x: 10, y: 2, w: 2, h: 2 },\n      { component: 'heatmap',\n        x: 0, y: 4, w: 12 },\n    ],\n  },\n  'linnarsson-2018-just-spatial': {\n    ...linnarssonBaseNoClusters,\n    version: '0.1.0',\n    name: 'Linnarsson (just spatial)',\n    staticLayout: [\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -6.5,\n            target: [18000, 18000, 0],\n          },\n        },\n        x: 0, y: 0, w: 10, h: 2 },\n      { component: 'genes',\n        x: 10, y: 1, w: 2, h: 1 },\n    ],\n  },\n  'linnarsson-2018-static': {\n    ...linnarssonBase,\n    version: '0.1.0',\n    name: 'Linnarsson (static layout)',\n    staticLayout: [\n      { component: 'description',\n        props: {\n          description: `Linnarsson (static layout): ${linnarssonDescription}`,\n        },\n        x: 0, y: 0, w: 3, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 't-SNE' },\n        x: 0, y: 2, w: 3, h: 2 },\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -6.5,\n            target: [18000, 18000, 0],\n          },\n        },\n        x: 3, y: 0, w: 6, h: 4 },\n      { component: 'genes',\n        x: 9, y: 2, w: 3, h: 2 },\n      { component: 'heatmap',\n        x: 0, y: 4, w: 12, h: 1 },\n    ],\n  },\n  'linnarsson-2018-dozen': {\n    ...linnarssonBase,\n    version: '0.1.0',\n    name: 'Linnarsson (static layout, redundant components for performance testing)',\n    staticLayout: [\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -6.5,\n            target: [18000, 18000, 0],\n          },\n        },\n        x: 0, y: 0, w: 4, h: 1 },\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -6.5,\n            target: [18000, 18000, 0],\n          },\n        },\n        x: 0, y: 1, w: 4, h: 1 },\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -6.5,\n            target: [18000, 18000, 0],\n          },\n        },\n        x: 4, y: 0, w: 4, h: 1 },\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -6.5,\n            target: [18000, 18000, 0],\n          },\n        },\n        x: 4, y: 1, w: 4, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 't-SNE' },\n        x: 0, y: 2, w: 4, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 't-SNE' },\n        x: 0, y: 3, w: 4, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 't-SNE' },\n        x: 0, y: 4, w: 4, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 't-SNE' },\n        x: 0, y: 5, w: 4, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 'PCA' },\n        x: 4, y: 2, w: 4, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 'PCA' },\n        x: 4, y: 3, w: 4, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 'PCA' },\n        x: 4, y: 4, w: 4, h: 1 },\n      { component: 'scatterplot',\n        props: { mapping: 'PCA' },\n        x: 4, y: 5, w: 4, h: 1 },\n      { component: 'genes',\n        x: 8, y: 2, w: 4, h: 2 },\n      { component: 'heatmap',\n        x: 8, y: 4, w: 4, h: 2 },\n    ],\n  },\n  'dries-2019': {\n    name: 'Dries',\n    version: '1.0.0',\n    description: driesDescription,\n    public: true,\n    datasets: [\n      {\n        uid: 'dries-2019',\n        name: 'Dries 2019',\n        files: driesBase.layers.map(file => ({\n          type: file.type.toLowerCase(),\n          fileType: file.fileType,\n          url: file.url,\n        })),\n      },\n    ],\n    initStrategy: 'auto',\n    coordinationSpace: {\n      embeddingType: {\n        TSNE: 't-SNE',\n        UMAP: 'UMAP',\n      },\n      embeddingCellSetPolygonsVisible: {\n        A: false,\n      },\n      embeddingCellSetLabelsVisible: {\n        A: true,\n      },\n      embeddingCellSetLabelSize: {\n        A: 16,\n      },\n      embeddingCellRadius: {\n        A: 1,\n      },\n      embeddingZoom: {\n        TSNE: 3,\n        UMAP: 3,\n      },\n      spatialZoom: {\n        A: -4.4,\n      },\n      spatialTargetX: {\n        A: 3800,\n      },\n      spatialTargetY: {\n        A: -900,\n      },\n    },\n    layout: [\n      { component: 'description',\n        x: 9, y: 0, w: 3, h: 2 },\n      { component: 'status',\n        x: 9, y: 2, w: 3, h: 2 },\n      { component: 'cellSets',\n        x: 9, y: 4, w: 3, h: 4 },\n      { component: 'cellSetSizes',\n        x: 5, y: 4, w: 4, h: 4 },\n      { component: 'scatterplot',\n        coordinationScopes: {\n          embeddingType: 'TSNE',\n          embeddingZoom: 'TSNE',\n          embeddingCellSetLabelsVisible: 'A',\n          embeddingCellSetLabelSize: 'A',\n          embeddingCellSetPolygonsVisible: 'A',\n          embeddingCellRadius: 'A',\n        },\n        x: 0, y: 2, w: 5, h: 4 },\n      { component: 'spatial',\n        props: {\n          cellRadius: 50,\n        },\n        coordinationScopes: {\n          spatialZoom: 'A',\n          spatialTargetX: 'A',\n          spatialTargetY: 'A',\n        },\n        x: 5, y: 0, w: 4, h: 4 },\n      { component: 'scatterplot',\n        coordinationScopes: {\n          embeddingType: 'UMAP',\n          embeddingZoom: 'UMAP',\n          embeddingCellSetLabelsVisible: 'A',\n          embeddingCellSetLabelSize: 'A',\n          embeddingCellSetPolygonsVisible: 'A',\n          embeddingCellRadius: 'A',\n        },\n        x: 0, y: 0, w: 5, h: 4 },\n    ],\n  },\n  'wang-2019': {\n    name: 'Wang',\n    version: '1.0.0',\n    description: wangDescription,\n    public: true,\n    datasets: [\n      {\n        uid: 'wang-2019',\n        name: 'Wang 2019',\n        files: wangBase.layers.map(file => ({\n          type: file.type.toLowerCase(),\n          fileType: file.fileType,\n          url: file.url,\n        })),\n      },\n    ],\n    initStrategy: 'auto',\n    coordinationSpace: {\n      spatialZoom: {\n        A: -1,\n      },\n      spatialLayers: {\n        A: [\n          {\n            type: 'molecules', radius: 2, opacity: 1, visible: true,\n          },\n          {\n            type: 'cells', opacity: 1, radius: 50, visible: true, stroked: false,\n          },\n        ],\n      },\n    },\n    layout: [\n      { component: 'spatial',\n        coordinationScopes: {\n          spatialZoom: 'A',\n          spatialLayers: 'A',\n        },\n        props: {},\n        x: 0, y: 0, w: 10, h: 2 },\n      { component: 'genes',\n        x: 10, y: 0, w: 2, h: 4 },\n      { component: 'expressionHistogram',\n        x: 0, y: 2, w: 10, h: 2 },\n    ],\n  },\n\n  vanderbilt: {\n    ...vanderbiltBase,\n    version: '0.1.0',\n    name: 'Spraggins',\n    public: true,\n    staticLayout: [\n      { component: 'spatial',\n        props: {\n          view: {\n            zoom: -6.5,\n            target: [20000, 20000, 0],\n          },\n        },\n        x: 0, y: 0, w: 9, h: 2 },\n      { component: 'layerController',\n        x: 9, y: 0, w: 3, h: 2 },\n    ],\n  },\n  'just-higlass': {\n    public: false,\n    initStrategy: 'auto',\n    version: '1.0.0',\n    datasets: [\n      {\n        uid: 'higlass-dataset',\n        name: 'HiGlass Dataset',\n        files: [],\n      },\n    ],\n    name: 'HiGlass demo',\n    coordinationSpace: {\n      genomicZoomX: {\n        A: 0,\n      },\n      genomicZoomY: {\n        A: 0,\n      },\n      genomicTargetX: {\n        A: 1549999999.5,\n      },\n      genomicTargetY: {\n        A: 1549999999.5,\n      },\n    },\n    layout: [\n      {\n        component: 'higlass',\n        coordinationScopes: {\n          genomicZoomX: 'A',\n          genomicZoomY: 'A',\n          genomicTargetX: 'A',\n          genomicTargetY: 'A',\n        },\n        props: {\n          hgViewConfig: {\n            uid: 'aa',\n            autocompleteSource: '/api/v1/suggest/?d=OHJakQICQD6gTD7skx4EWA&',\n            genomePositionSearchBox: {\n              autocompleteServer: '//higlass.io/api/v1',\n              autocompleteId: 'OHJakQICQD6gTD7skx4EWA',\n              chromInfoServer: '//higlass.io/api/v1',\n              chromInfoId: 'hg19',\n              visible: true,\n            },\n            chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',\n            tracks: {\n              top: [\n                {\n                  type: 'horizontal-gene-annotations',\n                  height: 60,\n                  tilesetUid: 'OHJakQICQD6gTD7skx4EWA',\n                  server: '//higlass.io/api/v1',\n                  uid: 'OHJakQICQD6gTD7skx4EWA',\n                  options: {\n                    name: 'Gene Annotations (hg19)',\n                    fontSize: 10,\n                    labelPosition: 'hidden',\n                    labelLeftMargin: 0,\n                    labelRightMargin: 0,\n                    labelTopMargin: 0,\n                    labelBottomMargin: 0,\n                    minHeight: 24,\n                    geneAnnotationHeight: 16,\n                    geneLabelPosition: 'outside',\n                    geneStrandSpacing: 4,\n                    showMousePosition: true,\n                    mousePositionColor: '#ff00ff',\n                    plusStrandColor: '#fdff54',\n                    minusStrandColor: '#68bf30',\n                    labelColor: 'black',\n                    trackBorderWidth: 0,\n                    trackBorderColor: 'black',\n                  },\n                },\n                {\n                  chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',\n                  type: 'horizontal-chromosome-labels',\n                  height: 30,\n                  uid: 'X4e_1DKiQHmyghDa6lLMVA',\n                  options: {\n                    color: '#808080',\n                    stroke: 'black',\n                    fontSize: 12,\n                    fontIsLeftAligned: false,\n                    showMousePosition: true,\n                    mousePositionColor: '#ff00ff',\n                  },\n                },\n              ],\n              left: [\n                {\n                  type: 'vertical-gene-annotations',\n                  width: 60,\n                  tilesetUid: 'OHJakQICQD6gTD7skx4EWA',\n                  server: '//higlass.io/api/v1',\n                  options: {\n                    labelPosition: 'bottomRight',\n                    name: 'Gene Annotations (hg19)',\n                    fontSize: 10,\n                    labelLeftMargin: 0,\n                    labelRightMargin: 0,\n                    labelTopMargin: 0,\n                    labelBottomMargin: 0,\n                    minWidth: 24,\n                    geneAnnotationHeight: 16,\n                    geneLabelPosition: 'outside',\n                    geneStrandSpacing: 4,\n                    showMousePosition: true,\n                    mousePositionColor: '#ff00ff',\n                    plusStrandColor: '#fdff54',\n                    minusStrandColor: '#68bf30',\n                    labelColor: 'black',\n                    trackBorderWidth: 0,\n                    trackBorderColor: 'black',\n                  },\n                  uid: 'dqBTMH78Rn6DeSyDBoAEXw',\n                },\n                {\n                  chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',\n                  type: 'vertical-chromosome-labels',\n                  width: 30,\n                  uid: 'RHdQK4IRQ7yJeDmKWb7Pcg',\n                  options: {\n                    color: '#777777',\n                    stroke: 'black',\n                    fontSize: 12,\n                    fontIsLeftAligned: false,\n                    minWidth: 35,\n                    showMousePosition: true,\n                    mousePositionColor: '#ff00ff',\n                  },\n                },\n              ],\n              center: [\n                {\n                  uid: 'c1',\n                  type: 'combined',\n                  height: 600,\n                  contents: [\n                    {\n                      server: '//higlass.io/api/v1',\n                      tilesetUid: 'CQMd6V_cRw6iCI_-Unl3PQ',\n                      type: 'heatmap',\n                      options: {\n                        maxZoom: null,\n                        labelPosition: 'bottomRight',\n                        name: 'Rao et al. (2014) GM12878 MboI (allreps) 1kb',\n                        backgroundColor: 'black',\n                        labelLeftMargin: 0,\n                        labelRightMargin: 0,\n                        labelTopMargin: 0,\n                        labelBottomMargin: 0,\n                        labelShowResolution: true,\n                        labelShowAssembly: true,\n                        labelColor: '#ffffff',\n                        labelTextOpacity: 0.5,\n                        labelBackgroundColor: 'black',\n                        labelBackgroundOpacity: 0.01,\n                        colorRange: [\n                          '#000000',\n                          '#222e54',\n                          '#448db2',\n                          '#68bf30',\n                          '#fdff54',\n                          '#FFFFFF',\n                        ],\n                        colorbarBackgroundColor: 'black',\n                        colorbarBackgroundOpacity: 0.01,\n                        colorbarPosition: 'topRight',\n                        trackBorderWidth: 0,\n                        trackBorderColor: 'black',\n                        heatmapValueScaling: 'log',\n                        showMousePosition: true,\n                        mousePositionColor: '#ff00ff',\n                        showTooltip: false,\n                        extent: 'full',\n                        zeroValueColor: null,\n                        scaleStartPercent: '0.00000',\n                        scaleEndPercent: '1.00000',\n                      },\n                      height: 500,\n                      uid: 'GjuZed1ySGW1IzZZqFB9BA',\n                      transforms: [\n                        {\n                          name: 'ICE',\n                          value: 'weight',\n                        },\n                      ],\n                    },\n                  ],\n                  options: {},\n                },\n              ],\n              right: [],\n              bottom: [],\n              whole: [],\n              gallery: [],\n            },\n            layout: {\n              w: 12,\n              h: 12,\n              x: 0,\n              y: 0,\n              moved: false,\n              static: false,\n            },\n          },\n        },\n        x: 0, y: 0, w: 8, h: 2,\n      },\n      {\n        component: 'higlass',\n        coordinationScopes: {\n          genomicZoomX: 'A',\n          genomicZoomY: 'A',\n          genomicTargetX: 'A',\n          genomicTargetY: 'A',\n        },\n        props: {\n          hgViewConfig: {\n            uid: 'aa',\n            autocompleteSource: '/api/v1/suggest/?d=OHJakQICQD6gTD7skx4EWA&',\n            genomePositionSearchBox: {\n              autocompleteServer: '//higlass.io/api/v1',\n              autocompleteId: 'OHJakQICQD6gTD7skx4EWA',\n              chromInfoServer: '//higlass.io/api/v1',\n              chromInfoId: 'hg19',\n              visible: true,\n            },\n            chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',\n            tracks: {\n              top: [\n                {\n                  type: 'horizontal-gene-annotations',\n                  height: 60,\n                  tilesetUid: 'OHJakQICQD6gTD7skx4EWA',\n                  server: '//higlass.io/api/v1',\n                  uid: 'OHJakQICQD6gTD7skx4EWA',\n                  options: {\n                    name: 'Gene Annotations (hg19)',\n                    fontSize: 10,\n                    labelPosition: 'hidden',\n                    labelLeftMargin: 0,\n                    labelRightMargin: 0,\n                    labelTopMargin: 0,\n                    labelBottomMargin: 0,\n                    minHeight: 24,\n                    geneAnnotationHeight: 16,\n                    geneLabelPosition: 'outside',\n                    geneStrandSpacing: 4,\n                    showMousePosition: true,\n                    mousePositionColor: '#ff00ff',\n                    plusStrandColor: '#fdff54',\n                    minusStrandColor: '#68bf30',\n                    labelColor: 'black',\n                    trackBorderWidth: 0,\n                    trackBorderColor: 'black',\n                  },\n                },\n                {\n                  chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',\n                  type: 'horizontal-chromosome-labels',\n                  height: 30,\n                  uid: 'X4e_1DKiQHmyghDa6lLMVA',\n                  options: {\n                    color: '#808080',\n                    stroke: 'black',\n                    fontSize: 12,\n                    fontIsLeftAligned: false,\n                    showMousePosition: true,\n                    mousePositionColor: '#ff00ff',\n                  },\n                },\n              ],\n              left: [\n                {\n                  type: 'vertical-gene-annotations',\n                  width: 60,\n                  tilesetUid: 'OHJakQICQD6gTD7skx4EWA',\n                  server: '//higlass.io/api/v1',\n                  options: {\n                    labelPosition: 'bottomRight',\n                    name: 'Gene Annotations (hg19)',\n                    fontSize: 10,\n                    labelLeftMargin: 0,\n                    labelRightMargin: 0,\n                    labelTopMargin: 0,\n                    labelBottomMargin: 0,\n                    minWidth: 24,\n                    geneAnnotationHeight: 16,\n                    geneLabelPosition: 'outside',\n                    geneStrandSpacing: 4,\n                    showMousePosition: true,\n                    mousePositionColor: '#ff00ff',\n                    plusStrandColor: '#fdff54',\n                    minusStrandColor: '#68bf30',\n                    labelColor: 'black',\n                    trackBorderWidth: 0,\n                    trackBorderColor: 'black',\n                  },\n                  uid: 'dqBTMH78Rn6DeSyDBoAEXw',\n                },\n                {\n                  chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',\n                  type: 'vertical-chromosome-labels',\n                  width: 30,\n                  uid: 'RHdQK4IRQ7yJeDmKWb7Pcg',\n                  options: {\n                    color: '#777777',\n                    stroke: 'black',\n                    fontSize: 12,\n                    fontIsLeftAligned: false,\n                    minWidth: 35,\n                    showMousePosition: true,\n                    mousePositionColor: '#ff00ff',\n                  },\n                },\n              ],\n              center: [\n                {\n                  uid: 'c1',\n                  type: 'combined',\n                  height: 600,\n                  contents: [\n                    {\n                      server: '//higlass.io/api/v1',\n                      tilesetUid: 'CQMd6V_cRw6iCI_-Unl3PQ',\n                      type: 'heatmap',\n                      options: {\n                        maxZoom: null,\n                        labelPosition: 'bottomRight',\n                        name: 'Rao et al. (2014) GM12878 MboI (allreps) 1kb',\n                        backgroundColor: 'black',\n                        labelLeftMargin: 0,\n                        labelRightMargin: 0,\n                        labelTopMargin: 0,\n                        labelBottomMargin: 0,\n                        labelShowResolution: true,\n                        labelShowAssembly: true,\n                        labelColor: '#ffffff',\n                        labelTextOpacity: 0.5,\n                        labelBackgroundColor: 'black',\n                        labelBackgroundOpacity: 0.01,\n                        colorRange: [\n                          '#000000',\n                          '#222e54',\n                          '#448db2',\n                          '#68bf30',\n                          '#fdff54',\n                          '#FFFFFF',\n                        ],\n                        colorbarBackgroundColor: 'black',\n                        colorbarBackgroundOpacity: 0.01,\n                        colorbarPosition: 'topRight',\n                        trackBorderWidth: 0,\n                        trackBorderColor: 'black',\n                        heatmapValueScaling: 'log',\n                        showMousePosition: true,\n                        mousePositionColor: '#ff00ff',\n                        showTooltip: false,\n                        extent: 'full',\n                        zeroValueColor: null,\n                        scaleStartPercent: '0.00000',\n                        scaleEndPercent: '1.00000',\n                      },\n                      height: 500,\n                      uid: 'GjuZed1ySGW1IzZZqFB9BA',\n                      transforms: [\n                        {\n                          name: 'ICE',\n                          value: 'weight',\n                        },\n                      ],\n                    },\n                  ],\n                  options: {},\n                },\n              ],\n              right: [],\n              bottom: [],\n              whole: [],\n              gallery: [],\n            },\n            layout: {\n              w: 12,\n              h: 12,\n              x: 0,\n              y: 0,\n              moved: false,\n              static: false,\n            },\n          },\n        },\n        x: 8, y: 0, w: 4, h: 2,\n      },\n    ],\n  },\n  'sc-atac-seq-10x-genomics-pbmc': {\n    version: '1.0.0',\n    name: 'HiGlass serverless demo with 10x Genomics scATAC-seq 5k PBMC dataset',\n    datasets: [\n      {\n        uid: '10x-genomics-pbmc',\n        name: '10x Genomics PBMC',\n        files: [\n          {\n            type: 'genomic-profiles',\n            fileType: 'genomic-profiles.zarr',\n            url: 'http://higlass-serverless.s3.amazonaws.com/multivec/pbmc_10x_peaks_by_cluster.zarr',\n          },\n        ],\n      },\n    ],\n    layout: [\n      { component: 'genomicProfiles',\n        props: {\n          profileTrackUidKey: 'file',\n        },\n        x: 0, y: 0, w: 8, h: 2,\n      },\n      { component: 'description',\n        props: {\n          description: '10x Genomics scATAC-seq of 5k PBMCs. Note: the Zarr HiGlass Plugin Datafetcher is not yet optimized. Please be patient while the HiGlass tracks load.',\n        },\n        x: 8, y: 0, w: 4, h: 2 },\n    ],\n    initStrategy: 'auto',\n  },\n  'portal-ui-featured': {\n    coordinationSpace: {\n      dataset: {\n        A: 'A',\n      },\n      spatialZoom: {\n        A: 0.6219962674826599,\n      },\n      spatialRotation: {\n        A: 0,\n      },\n      spatialTargetX: {\n        A: 550.9755273834661,\n      },\n      spatialTargetY: {\n        A: 418.2987491735642,\n      },\n      spatialTargetZ: {\n        A: 6.252776074688882e-13,\n      },\n      heatmapZoomX: {\n        A: 0,\n      },\n      heatmapZoomY: {\n        A: 0,\n      },\n      heatmapTargetX: {\n        A: 0,\n      },\n      heatmapTargetY: {\n        A: 0,\n      },\n      cellFilter: {\n        A: null,\n      },\n      cellHighlight: {\n        A: '761',\n      },\n      cellSetSelection: {\n        A: [\n          [\n            'K-Means [Mean] Expression',\n            'Cluster 1',\n          ],\n          [\n            'K-Means [Mean] Expression',\n            'Cluster 2',\n          ],\n          [\n            'K-Means [Mean] Expression',\n            'Cluster 3',\n          ],\n          [\n            'K-Means [Mean] Expression',\n            'Cluster 4',\n          ],\n          [\n            'K-Means [Mean] Expression',\n            'Cluster 5',\n          ],\n          [\n            'K-Means [Mean] Expression',\n            'Cluster 6',\n          ],\n        ],\n      },\n      cellSetHighlight: {\n        A: null,\n      },\n      cellSetColor: {\n        A: [\n          {\n            path: [\n              'K-Means [Mean] Expression',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean] Expression',\n              'Cluster 1',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean] Expression',\n              'Cluster 2',\n            ],\n            color: [\n              136,\n              204,\n              238,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean] Expression',\n              'Cluster 3',\n            ],\n            color: [\n              68,\n              170,\n              153,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean] Expression',\n              'Cluster 4',\n            ],\n            color: [\n              17,\n              119,\n              51,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean] Expression',\n              'Cluster 5',\n            ],\n            color: [\n              153,\n              153,\n              51,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean] Expression',\n              'Cluster 6',\n            ],\n            color: [\n              221,\n              204,\n              119,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Covariance] Expression',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Covariance] Expression',\n              'Cluster 1',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Covariance] Expression',\n              'Cluster 2',\n            ],\n            color: [\n              136,\n              204,\n              238,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Covariance] Expression',\n              'Cluster 3',\n            ],\n            color: [\n              68,\n              170,\n              153,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Covariance] Expression',\n              'Cluster 4',\n            ],\n            color: [\n              17,\n              119,\n              51,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Covariance] Expression',\n              'Cluster 5',\n            ],\n            color: [\n              153,\n              153,\n              51,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Covariance] Expression',\n              'Cluster 6',\n            ],\n            color: [\n              221,\n              204,\n              119,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Total] Expression',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Total] Expression',\n              'Cluster 1',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Total] Expression',\n              'Cluster 2',\n            ],\n            color: [\n              136,\n              204,\n              238,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Total] Expression',\n              'Cluster 3',\n            ],\n            color: [\n              68,\n              170,\n              153,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Total] Expression',\n              'Cluster 4',\n            ],\n            color: [\n              17,\n              119,\n              51,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Total] Expression',\n              'Cluster 5',\n            ],\n            color: [\n              153,\n              153,\n              51,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Total] Expression',\n              'Cluster 6',\n            ],\n            color: [\n              221,\n              204,\n              119,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean-All-SubRegions] Expression',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean-All-SubRegions] Expression',\n              'Cluster 1',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean-All-SubRegions] Expression',\n              'Cluster 2',\n            ],\n            color: [\n              136,\n              204,\n              238,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean-All-SubRegions] Expression',\n              'Cluster 3',\n            ],\n            color: [\n              68,\n              170,\n              153,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean-All-SubRegions] Expression',\n              'Cluster 4',\n            ],\n            color: [\n              17,\n              119,\n              51,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean-All-SubRegions] Expression',\n              'Cluster 5',\n            ],\n            color: [\n              153,\n              153,\n              51,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Mean-All-SubRegions] Expression',\n              'Cluster 6',\n            ],\n            color: [\n              221,\n              204,\n              119,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Shape-Vectors]',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Shape-Vectors]',\n              'Cluster 1',\n            ],\n            color: [\n              68,\n              119,\n              170,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Shape-Vectors]',\n              'Cluster 2',\n            ],\n            color: [\n              136,\n              204,\n              238,\n              255,\n            ],\n          },\n          {\n            path: [\n              'K-Means [Shape-Vectors]',\n              'Cluster 3',\n            ],\n            color: [\n              68,\n              170,\n              153,\n              255,\n            ],\n          },\n        ],\n      },\n      geneFilter: {\n        A: null,\n      },\n      geneHighlight: {\n        A: null,\n      },\n      geneSelection: {\n        A: null,\n      },\n      geneExpressionColormap: {\n        A: 'plasma',\n      },\n      geneExpressionColormapRange: {\n        A: [\n          0.065,\n          0.435,\n        ],\n      },\n      cellColorEncoding: {\n        A: 'cellSetSelection',\n      },\n      spatialRasterLayers: {\n        A: [\n          {\n            type: 't',\n            index: 0,\n            colormap: null,\n            opacity: 1,\n            domainType: 'Min/Max',\n            transparentColor: null,\n            channels: [\n              {\n                selection: {\n                  z: 5,\n                  t: 0,\n                  c: 10,\n                },\n                color: [\n                  0,\n                  0,\n                  255,\n                ],\n                visible: true,\n                slider: [\n                  1,\n                  14906,\n                ],\n              },\n              {\n                selection: {\n                  z: 5,\n                  t: 0,\n                  c: 15,\n                },\n                color: [\n                  0,\n                  255,\n                  0,\n                ],\n                visible: true,\n                slider: [\n                  2313,\n                  31611,\n                ],\n              },\n              {\n                selection: {\n                  z: 5,\n                  t: 0,\n                  c: 45,\n                },\n                color: [\n                  255,\n                  0,\n                  255,\n                ],\n                visible: true,\n                slider: [\n                  2570,\n                  21074,\n                ],\n              },\n              {\n                selection: {\n                  z: 5,\n                  t: 0,\n                  c: 20,\n                },\n                color: [\n                  255,\n                  255,\n                  0,\n                ],\n                visible: true,\n                slider: [\n                  2827,\n                  11565,\n                ],\n              },\n              {\n                selection: {\n                  z: 5,\n                  t: 0,\n                  c: 31,\n                },\n                slider: [\n                  5658,\n                  17479,\n                ],\n                visible: true,\n                color: [\n                  255,\n                  128,\n                  0,\n                ],\n              },\n              {\n                selection: {\n                  z: 5,\n                  t: 0,\n                  c: 39,\n                },\n                slider: [\n                  1767,\n                  11735,\n                ],\n                visible: true,\n                color: [\n                  255,\n                  255,\n                  255,\n                ],\n              },\n            ],\n          },\n        ],\n      },\n      spatialCellsLayer: {\n        A: {\n          opacity: 0,\n          radius: 50,\n          visible: true,\n          stroked: true,\n        },\n      },\n      spatialMoleculesLayer: {\n        A: null,\n      },\n      spatialNeighborhoodsLayer: {\n        A: null,\n      },\n      additionalCellSets: {\n        A: null,\n      },\n      moleculeHighlight: {\n        A: null,\n      },\n    },\n    datasets: [\n      {\n        files: [\n          {\n            fileType: 'cells.json',\n            type: 'cells',\n            url: 'https://assets.hubmapconsortium.org/ca3016d836d8ee50bef1b93f339c9679/output_json/R002_X002_Y007.cells.json?token=',\n          },\n          {\n            fileType: 'cell-sets.json',\n            type: 'cell-sets',\n            url: 'https://assets.hubmapconsortium.org/ca3016d836d8ee50bef1b93f339c9679/output_json/R002_X002_Y007.cell-sets.json?token=',\n          },\n          {\n            fileType: 'clusters.json',\n            type: 'expression-matrix',\n            url: 'https://assets.hubmapconsortium.org/ca3016d836d8ee50bef1b93f339c9679/output_json/R002_X002_Y007.clusters.json?token=',\n          },\n          {\n            fileType: 'raster.json',\n            options: {\n              images: [\n                {\n                  metadata: {\n                    omeTiffOffsetsUrl: 'https://assets.hubmapconsortium.org/ca3016d836d8ee50bef1b93f339c9679/output_offsets/R002_X002_Y007.offsets.json?token=',\n                  },\n                  name: 'R002_X002_Y007',\n                  type: 'ome-tiff',\n                  url: 'https://assets.hubmapconsortium.org/ca3016d836d8ee50bef1b93f339c9679/output/extract/expressions/ome-tiff/R002_X002_Y007.ome.tiff?token=',\n                },\n              ],\n              schemaVersion: '0.0.2',\n            },\n            type: 'raster',\n          },\n        ],\n        name: 'SPRM',\n        uid: 'A',\n      },\n    ],\n    description: '',\n    initStrategy: 'auto',\n    layout: [\n      {\n        component: 'spatial',\n        coordinationScopes: {\n          dataset: 'A',\n          spatialZoom: 'A',\n          spatialRotation: 'A',\n          spatialTargetX: 'A',\n          spatialTargetY: 'A',\n          spatialTargetZ: 'A',\n          cellFilter: 'A',\n          cellHighlight: 'A',\n          cellSetSelection: 'A',\n          cellSetHighlight: 'A',\n          cellSetColor: 'A',\n          geneHighlight: 'A',\n          geneSelection: 'A',\n          geneExpressionColormap: 'A',\n          geneExpressionColormapRange: 'A',\n          cellColorEncoding: 'A',\n          spatialRasterLayers: 'A',\n          spatialCellsLayer: 'A',\n          spatialMoleculesLayer: 'A',\n          spatialNeighborhoodsLayer: 'A',\n          additionalCellSets: 'A',\n          moleculeHighlight: 'A',\n        },\n        h: 8,\n        w: 7,\n        x: 3,\n        y: 0,\n      },\n      {\n        component: 'description',\n        coordinationScopes: {\n          dataset: 'A',\n          spatialRasterLayers: 'A',\n        },\n        h: 2,\n        w: 2,\n        x: 10,\n        y: 10,\n      },\n      {\n        component: 'layerController',\n        coordinationScopes: {\n          dataset: 'A',\n          spatialRasterLayers: 'A',\n          spatialCellsLayer: 'A',\n          spatialMoleculesLayer: 'A',\n          spatialNeighborhoodsLayer: 'A',\n        },\n        h: 8,\n        w: 3,\n        x: 0,\n        y: 0,\n      },\n      {\n        component: 'cellSets',\n        coordinationScopes: {\n          dataset: 'A',\n          cellSetSelection: 'A',\n          cellSetHighlight: 'A',\n          cellSetColor: 'A',\n          cellColorEncoding: 'A',\n          additionalCellSets: 'A',\n        },\n        h: 5,\n        w: 2,\n        x: 10,\n        y: 5,\n      },\n      {\n        component: 'genes',\n        coordinationScopes: {\n          dataset: 'A',\n          geneFilter: 'A',\n          geneHighlight: 'A',\n          geneSelection: 'A',\n          cellColorEncoding: 'A',\n        },\n        h: 5,\n        props: {\n          variablesLabelOverride: 'antigen',\n        },\n        w: 2,\n        x: 10,\n        y: 0,\n      },\n      {\n        component: 'heatmap',\n        coordinationScopes: {\n          dataset: 'A',\n          heatmapZoomX: 'A',\n          heatmapZoomY: 'A',\n          heatmapTargetX: 'A',\n          heatmapTargetY: 'A',\n          cellFilter: 'A',\n          cellHighlight: 'A',\n          cellSetSelection: 'A',\n          cellSetHighlight: 'A',\n          cellSetColor: 'A',\n          geneFilter: 'A',\n          geneHighlight: 'A',\n          geneSelection: 'A',\n          geneExpressionColormap: 'A',\n          geneExpressionColormapRange: 'A',\n          cellColorEncoding: 'A',\n          additionalCellSets: 'A',\n        },\n        h: 4,\n        props: {\n          transpose: true,\n          variablesLabelOverride: 'antigen',\n        },\n        w: 10,\n        x: 0,\n        y: 8,\n      },\n    ],\n    name: 'R002_X002_Y007',\n    version: '1.0.1',\n  },\n};\n/* eslint-enable */\n\nexport function listConfigs(showAll) {\n  return Object.entries(configs).filter(\n    entry => showAll || entry[1].public,\n  ).map(\n    ([id, config]) => ({\n      id,\n      name: config.name,\n      description: config.description,\n    }),\n  );\n}\n\nexport function getConfig(id) {\n  return configs[id];\n}\n", "import React from 'react';\n\nimport version from '../version.json';\n\nfunction DatasetList(props) {\n  const { configs, theme } = props;\n  const aClassName = 'list-group-item list-group-item-action flex-column align-items-start bg-secondary';\n  const links = configs.map(\n    ({ id, name, description }) => (\n      <div className={aClassName} key={id}>\n        <a\n          href={`?dataset=${id}&theme=${theme}`}\n          key={id}\n        >\n          <h5>{name}</h5>\n          <p>{description}</p>\n        </a>\n        <a\n          href={`?dataset=${id}&theme=${theme}&small`}\n          style={{ fontSize: '75%' }}\n        >\n          {name} as component\n        </a>\n      </div>\n    ),\n  );\n  return (\n    <div className=\"list-group\">\n      {links}\n    </div>\n  );\n}\n\nfunction Form(props) {\n  const { configs, theme } = props;\n  return (\n    <form method=\"GET\">\n      <h1>Vitessce</h1>\n      <div>Select a dataset:</div>\n      <DatasetList configs={configs} theme={theme} />\n\n      <br />\n      <div>Or specify URL of configuration:</div>\n      <div className=\"input-group mb-3\">\n        <input type=\"text\" name=\"url\" className=\"form-control\" />\n        <input type=\"hidden\" name=\"theme\" value={theme} />\n        <div className=\"input-group-append\">\n          <button className=\"btn btn-outline-secondary\" type=\"submit\">Load</button>\n        </div>\n      </div>\n    </form>\n  );\n}\n\nfunction Info() {\n  return (\n    <>\n      <p className=\"info-paragraph\">\n        Vitessce is a visual integration tool for exploration of spatial single cell experiments.\n        Its modular design is optimized for scalable, linked visualizations that support the\n        spatial and non-spatial representation of tissue-, cell- and molecule-level data.\n        Vitessce integrates the <a href=\"https://github.com/hms-dbmi/viv\">Viv library</a> to visualize\n        highly multiplexed, high-resolution, high-bit depth image data directly from\n        OME-TIFF files and Bio-Formats-compatible Zarr stores.\n      </p>\n      <h5 className=\"info-section-text\">\n        Contributors\n      </h5>\n      <ul>\n        <li><a href=\"https://github.com/keller-mark\">Mark Keller</a></li>\n        <li><a href=\"https://github.com/mccalluc\">Chuck McCallum</a></li>\n        <li><a href=\"https://github.com/ilan-gold\">Ilan Gold</a></li>\n        <li><a href=\"https://github.com/manzt\">Trevor Manz</a></li>\n        <li><a href=\"https://github.com/thomaslchan\">Tos Chan</a></li>\n        <li><a href=\"https://github.com/jkmarx\">Jennifer Marx</a></li>\n        <li><a href=\"https://github.com/pkharchenko\">Peter Kharchenko</a></li>\n        <li><a href=\"https://github.com/ngehlenborg\">Nils Gehlenborg</a></li>\n      </ul>\n      <h5 className=\"info-section-text\">\n        Source Code\n      </h5>\n      <ul>\n        <li><a href=\"https://github.com/vitessce/vitessce\">GitHub</a></li>\n        <li><a href=\"https://www.npmjs.com/package/vitessce\">NPM</a></li>\n      </ul>\n      <h5 className=\"info-section-text\">\n        Funding\n      </h5>\n      <ul>\n        <li>\n          NIH/OD Human BioMolecular Atlas Program (HuBMAP)\n          (OT2OD026677, PI: Nils Gehlenborg).\n        </li>\n        <li>\n          NIH/NLM Biomedical Informatics and Data Science Research Training Program\n          (T15LM007092, PI: Nils Gehlenborg)\n        </li>\n        <li>Harvard Stem Cell Institute (CF-0014-17-03, PI: Nils Gehlenborg)</li>\n      </ul>\n      <p className=\"info-section-text\">\n        This deployment: branch={version.branch} | hash={version.hash} | date={version.date}\n      </p>\n    </>\n  );\n}\n\nexport default function Welcome(props) {\n  const { configs, theme, showBetaHeader } = props;\n  return (\n    <div className={`vitessce-container vitessce-theme-${theme} welcome-container`}>\n      {showBetaHeader && (\n        <div className=\"welcome-beta-header\">\n          <p>Visit <a href=\"http://beta.vitessce.io\">beta.vitessce.io</a> to view the next version of the Vitessce home page and documentation!</p>\n        </div>\n      )}\n      <div className=\"react-grid-layout container-fluid\" style={{ height: 'max(100vh, 100%)' }}>\n        <div className=\"row\">\n          <div className=\"welcome-col-left\">\n            <div className=\"card card-body bg-primary\">\n              <Form configs={configs} theme={theme} />\n            </div>\n          </div>\n          <div className=\"welcome-col-right\">\n            <div className=\"card card-body bg-primary\">\n              <Info />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n", "import React from 'react';\nimport { PRIMARY_CARD } from '../components/classNames';\n\nexport default function Warning(props) {\n  const {\n    title,\n    preformatted,\n    unformatted,\n    theme,\n  } = props;\n  return (\n    <div className={`vitessce-container vitessce-theme-${theme}`}>\n      <div className=\"warning-layout container-fluid\">\n        <div className=\"row\">\n          <div className=\"col-12\">\n            <div className={PRIMARY_CARD}>\n              <h1>{title}</h1>\n              <pre>{preformatted}</pre>\n              <div>{unformatted}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n", "/* eslint-disable camelcase */\nimport React, { useEffect, useMemo } from 'react';\nimport {\n  ThemeProvider, StylesProvider,\n  createGenerateClassName,\n} from '@material-ui/core/styles';\nimport isEqual from 'lodash/isEqual';\nimport { muiTheme } from '../components/shared-mui/styles';\nimport {\n  ViewConfigProvider, createViewConfigStore,\n  AuxiliaryProvider, createAuxiliaryStore,\n} from './state/hooks';\n\nimport VitessceGrid from './VitessceGrid';\nimport Warning from './Warning';\nimport CallbackPublisher from './CallbackPublisher';\nimport { getComponent } from './component-registry';\nimport { initialize, upgradeAndValidate } from './view-config-utils';\n\nconst generateClassName = createGenerateClassName({\n  disableGlobal: true,\n});\n\n/**\n * The Vitessce component.\n * @param {object} props\n * @param {object} props.config A Vitessce view config.\n * If the config is valid, the VitessceGrid will be rendered as a child.\n * If the config is invalid, a Warning will be rendered instead.\n * @param {number} props.rowHeight Row height for grid layout. Optional.\n * @param {number} props.height Total height for grid layout. Optional.\n * @param {string} props.theme The theme, used for styling as\n * light or dark. Optional. By default, \"dark\"\n * @param {function} props.onWarn A callback for warning messages. Optional.\n * @param {function} props.onConfigChange A callback for view config\n * updates. Optional.\n * @param {function} props.onLoaderChange A callback for loader\n * updates. Optional.\n * @param {boolean} props.validateOnConfigChange Whether to validate\n * against the view config schema when publishing changes. Use for debugging\n * purposes, as this may have a performance impact. By default, false.\n */\nexport default function Vitessce(props) {\n  const {\n    config,\n    rowHeight,\n    height,\n    theme,\n    onWarn,\n    onConfigChange,\n    onLoaderChange,\n    validateOnConfigChange = false,\n  } = props;\n\n  // Process the view config and memoize the result:\n  // - Validate.\n  // - Upgrade, if legacy schema.\n  // - Validate after upgrade, if legacy schema.\n  // - Initialize (based on initStrategy).\n  const [configOrWarning, success] = useMemo(() => {\n    // If the config value is undefined, show a warning message.\n    if (!config) {\n      return [{\n        title: 'No such dataset',\n        unformatted: 'The dataset configuration could not be found.',\n      }, false];\n    }\n    // If the view config is missing a version, show a warning message.\n    if (!config.version) {\n      return [{\n        title: 'Missing version',\n        unformatted: 'The dataset configuration is missing a version, preventing validation.',\n      }, false];\n    }\n    // Check if this is a \"legacy\" view config.\n    const [upgradedConfig, upgradeSuccess] = upgradeAndValidate(config);\n    if (upgradeSuccess) {\n      // Initialize the view config according to the initStrategy.\n      const initializedConfig = initialize(upgradedConfig);\n      return [initializedConfig, true];\n    }\n    return [upgradedConfig, false];\n  }, [config]);\n\n  // Emit the upgraded/initialized view config\n  // to onConfigChange if necessary.\n  useEffect(() => {\n    if (success && !isEqual(configOrWarning, config) && onConfigChange) {\n      onConfigChange(configOrWarning);\n    }\n  }, [success, config, configOrWarning, onConfigChange]);\n\n  return success ? (\n    <StylesProvider generateClassName={generateClassName}>\n      <ThemeProvider theme={muiTheme[theme]}>\n        <ViewConfigProvider createStore={createViewConfigStore}>\n          <AuxiliaryProvider createStore={createAuxiliaryStore}>\n            <VitessceGrid\n              config={configOrWarning}\n              getComponent={getComponent}\n              rowHeight={rowHeight}\n              height={height}\n              theme={theme}\n            />\n            <CallbackPublisher\n              onWarn={onWarn}\n              onConfigChange={onConfigChange}\n              onLoaderChange={onLoaderChange}\n              validateOnConfigChange={validateOnConfigChange}\n            />\n          </AuxiliaryProvider>\n        </ViewConfigProvider>\n      </ThemeProvider>\n    </StylesProvider>\n  ) : (\n    <Warning\n      theme={theme}\n      {...configOrWarning}\n    />\n  );\n}\n", "import { useEffect } from 'react';\nimport { SCHEMA_HANDLERS, LATEST_VERSION } from './view-config-versions';\nimport { useViewConfigStoreApi, useLoaders, useWarning } from './state/hooks';\n\nfunction validateViewConfig(viewConfig) {\n  // Need the try-catch here since Zustand will actually\n  // just catch and ignore errors in its subscription callbacks.\n  try {\n    const validate = SCHEMA_HANDLERS[LATEST_VERSION][0];\n    const valid = validate(viewConfig);\n    if (!valid) {\n      const failureReason = JSON.stringify(validate.errors, null, 2);\n      throw new Error(`Config validation failed: ${failureReason}`);\n    }\n  } catch (e) {\n    console.error(e);\n  }\n  // Do nothing if successful.\n}\n\n/**\n * This is a dummy component which handles\n * publishing new view configs and loaders to\n * the provided callbacks on changes.\n * @param {object} props\n * @param {function} props.onConfigChange A callback function\n * to execute on each change of the Vitessce view config.\n * @param {function} props.onLoaderChange A callback function\n * to execute on each change of the loaders object.\n * @param {boolean} props.validateOnConfigChange Whether to validate\n * against the view config schema when publishing changes.\n */\nexport default function CallbackPublisher(props) {\n  const {\n    onWarn,\n    onConfigChange,\n    onLoaderChange,\n    validateOnConfigChange,\n  } = props;\n\n  const warning = useWarning();\n  const loaders = useLoaders();\n\n  const viewConfigStoreApi = useViewConfigStoreApi();\n\n  // View config updates are often-occurring, so\n  // we want to use the \"transient update\" approach\n  // to subscribe to view config changes.\n  // Reference: https://github.com/react-spring/zustand#transient-updates-for-often-occuring-state-changes\n  useEffect(() => viewConfigStoreApi.subscribe(\n    // The function to run on each publish.\n    (viewConfig) => {\n      if (validateOnConfigChange && viewConfig) {\n        validateViewConfig(viewConfig);\n      }\n      if (onConfigChange && viewConfig) {\n        onConfigChange(viewConfig);\n      }\n    },\n    // The function to specify which part of the store\n    // we want to subscribe to.\n    state => state.viewConfig,\n  ), [onConfigChange, validateOnConfigChange, viewConfigStoreApi]);\n\n  // Emit updates to the warning message.\n  useEffect(() => {\n    if (onWarn && warning) {\n      onWarn(warning);\n    }\n  }, [warning, onWarn]);\n\n  // Emit updates to the loaders.\n  useEffect(() => {\n    if (onLoaderChange && loaders) {\n      onLoaderChange(loaders);\n    }\n  }, [loaders, onLoaderChange]);\n\n  // Render nothing.\n  return null;\n}\n", "/* eslint-disable camelcase */\nimport Ajv from 'ajv';\nimport configSchema0_1_0 from '../schemas/config-0.1.0.schema.json';\nimport configSchema1_0_0 from '../schemas/config-1.0.0.schema.json';\nimport configSchema1_0_1 from '../schemas/config-1.0.1.schema.json';\nimport configSchema1_0_2 from '../schemas/config-1.0.2.schema.json';\nimport configSchema1_0_3 from '../schemas/config-1.0.3.schema.json';\nimport configSchema1_0_4 from '../schemas/config-1.0.4.schema.json';\nimport configSchema1_0_5 from '../schemas/config-1.0.5.schema.json';\nimport cellSetsSchema from '../schemas/cell-sets.schema.json';\nimport rasterSchema from '../schemas/raster.schema.json';\nimport {\n  upgradeFrom0_1_0,\n  upgradeFrom1_0_0,\n  upgradeFrom1_0_1,\n  upgradeFrom1_0_2,\n  upgradeFrom1_0_3,\n  upgradeFrom1_0_4,\n} from './view-config-upgraders';\n\n/**\n * Mapping from view config versions to view config schemas and upgrade functions.\n * Add a new schema and upgrade function here when bumping the view config version.\n * The latest view config version should always have a null value instead of an upgrade function.\n */\nexport const LATEST_VERSION = '1.0.5';\nexport const SCHEMA_HANDLERS = {\n  '0.1.0': [new Ajv().compile(configSchema0_1_0), upgradeFrom0_1_0],\n  '1.0.0': [new Ajv().addSchema(cellSetsSchema).addSchema(rasterSchema).compile(configSchema1_0_0), upgradeFrom1_0_0],\n  '1.0.1': [new Ajv().addSchema(cellSetsSchema).addSchema(rasterSchema).compile(configSchema1_0_1), upgradeFrom1_0_1],\n  '1.0.2': [new Ajv().addSchema(cellSetsSchema).addSchema(rasterSchema).compile(configSchema1_0_2), upgradeFrom1_0_2],\n  '1.0.3': [new Ajv().addSchema(cellSetsSchema).addSchema(rasterSchema).compile(configSchema1_0_3), upgradeFrom1_0_3],\n  '1.0.4': [new Ajv().addSchema(cellSetsSchema).addSchema(rasterSchema).compile(configSchema1_0_4), upgradeFrom1_0_4],\n  '1.0.5': [new Ajv().addSchema(cellSetsSchema).addSchema(rasterSchema).compile(configSchema1_0_5), null],\n};\n", "/* eslint-disable camelcase */\nimport uuidv4 from 'uuid/v4';\nimport cloneDeep from 'lodash/cloneDeep';\nimport { getNextScope, capitalize } from '../utils';\nimport {\n  COMPONENT_COORDINATION_TYPES,\n} from './state/coordination';\n\n/**\n * A helper function for the `upgrade()` function,\n * which helps convert `props.view` (for scatterplot and spatial),\n * into new coordination scopes, setting their values\n * in the coordination space and returning the new scope mappings.\n * This function does mutate the `coordinationSpace` parameter.\n * @param {string} prefix The coordination type prefix,\n * either 'embedding' or 'spatial'.\n * @param {object} view The view prop object containing\n * the properties `.target` and `.zoom`.\n * @param {object} coordinationSpace The coordination space.\n * @returns {object} The new coordination scope names.\n */\nfunction upgradeReplaceViewProp(prefix, view, coordinationSpace) {\n  const prevZScopes = Object.keys(coordinationSpace[`${prefix}Zoom`]);\n  const prevTXScopes = Object.keys(coordinationSpace[`${prefix}TargetX`]);\n  const prevTYScopes = Object.keys(coordinationSpace[`${prefix}TargetY`]);\n\n  const nextZScope = getNextScope(prevZScopes);\n  const nextTXScope = getNextScope(prevTXScopes);\n  const nextTYScope = getNextScope(prevTYScopes);\n\n  const { zoom, target: [targetX, targetY] } = view;\n  // eslint-disable-next-line no-param-reassign\n  coordinationSpace[`${prefix}Zoom`][nextZScope] = zoom;\n  // eslint-disable-next-line no-param-reassign\n  coordinationSpace[`${prefix}TargetX`][nextTXScope] = targetX;\n  // eslint-disable-next-line no-param-reassign\n  coordinationSpace[`${prefix}TargetY`][nextTYScope] = targetY;\n  return {\n    [`${prefix}Zoom`]: nextZScope,\n    [`${prefix}TargetX`]: nextTXScope,\n    [`${prefix}TargetY`]: nextTYScope,\n  };\n}\n\n/**\n * Convert an older view config to a newer view config.\n * @param {object} config A v0.1.0 \"legacy\" view config.\n * @returns {object} A v1.0.0 \"upgraded\" view config.\n */\nexport function upgradeFrom0_1_0(config, datasetUid = null) {\n  const coordinationSpace = {\n    embeddingType: {},\n    embeddingZoom: {},\n    embeddingTargetX: {},\n    embeddingTargetY: {},\n    spatialZoom: {},\n    spatialTargetX: {},\n    spatialTargetY: {},\n  };\n\n  const layout = [];\n  config.staticLayout.forEach((componentDef) => {\n    let newComponentDef = {\n      ...componentDef,\n      coordinationScopes: {},\n    };\n    if (componentDef.component === 'scatterplot') {\n      // Need to set up the coordinationSpace\n      // with embeddingType to replace scatterplot\n      // component prop \"mapping\".\n      if (componentDef.props.mapping) {\n        coordinationSpace.embeddingType[componentDef.props.mapping] = componentDef.props.mapping;\n        newComponentDef = {\n          ...newComponentDef,\n          coordinationScopes: {\n            ...newComponentDef.coordinationScopes,\n            embeddingType: componentDef.props.mapping,\n          },\n        };\n      }\n      // Need to set up the coordinationSpace\n      // with embeddingZoom / embeddingTargetX/Y to replace scatterplot\n      // component prop \"view\" ({ zoom, target }).\n      if (componentDef.props.view) {\n        // Note that the below function does mutate the coordinationSpace param.\n        const newScopeValues = upgradeReplaceViewProp(\n          'embedding', componentDef.props.view, coordinationSpace,\n        );\n        newComponentDef = {\n          ...newComponentDef,\n          coordinationScopes: {\n            ...newComponentDef.coordinationScopes,\n            ...newScopeValues,\n          },\n        };\n      }\n    }\n    if (componentDef.component === 'spatial') {\n      // Need to set up the coordinationSpace\n      // with spatialZoom / spatialTargetX/Y to replace spatial\n      // component prop \"view\" ({ zoom, target }).\n      if (componentDef?.props?.view) {\n        // Note that the below function does mutate the coordinationSpace param.\n        const newScopeValues = upgradeReplaceViewProp(\n          'spatial', componentDef.props.view, coordinationSpace,\n        );\n        newComponentDef = {\n          ...newComponentDef,\n          coordinationScopes: {\n            ...newComponentDef.coordinationScopes,\n            ...newScopeValues,\n          },\n        };\n      }\n    }\n    layout.push(newComponentDef);\n  });\n\n  // Use a random dataset ID when initializing automatically,\n  // so that it changes with each new v0.1.0 view config.\n  // However, check if the `datasetUid` parameter was passed,\n  // which allows for unit testing.\n  const newDatasetUid = datasetUid || uuidv4();\n\n  return {\n    version: '1.0.1',\n    name: config.name,\n    description: config.description,\n    public: config.public,\n    datasets: [\n      {\n        uid: newDatasetUid,\n        name: newDatasetUid,\n        files: config.layers.map(layer => ({\n          type: layer.type.toLowerCase(),\n          fileType: layer.fileType,\n          url: layer.url,\n        })),\n      },\n    ],\n    initStrategy: 'auto',\n    coordinationSpace,\n    layout,\n  };\n}\n\nexport function upgradeFrom1_0_0(config) {\n  const coordinationSpace = { ...config.coordinationSpace };\n\n  function replaceLayerType(layerType) {\n    // Layer type could be one of a few things, bitmask or raster at the moment.\n    const isRaster = layerType === 'raster';\n    coordinationSpace[`spatial${capitalize(layerType)}Layer${isRaster ? 's' : ''}`] = {};\n    Object.entries(coordinationSpace.spatialLayers).forEach(([scope, layers]) => {\n      if (Array.isArray(layers) && layers.find(layer => layer.type === layerType)) {\n        const typedLayers = layers\n          .filter(layer => layer.type === layerType)\n          .map((layer) => {\n            const newLayer = { ...layer };\n            delete newLayer.type;\n            return newLayer;\n          });\n        coordinationSpace[`spatial${capitalize(layerType)}Layer${isRaster ? 's' : ''}`][scope] = isRaster ? typedLayers : typedLayers[0];\n      } else {\n        coordinationSpace[`spatial${capitalize(layerType)}Layer${isRaster ? 's' : ''}`][scope] = null;\n      }\n    });\n  }\n\n  if (coordinationSpace.spatialLayers) {\n    replaceLayerType('raster');\n    replaceLayerType('cells');\n    replaceLayerType('molecules');\n    replaceLayerType('neighborhoods');\n    delete coordinationSpace.spatialLayers;\n  }\n\n  const layout = config.layout.map((component) => {\n    const newComponent = { ...component };\n\n    function replaceCoordinationScope(layerType) {\n      const isRaster = layerType === 'raster';\n      if (COMPONENT_COORDINATION_TYPES[newComponent.component].includes(`spatial${capitalize(layerType)}Layer${isRaster ? 's' : ''}`)) {\n        newComponent.coordinationScopes[`spatial${capitalize(layerType)}Layer${isRaster ? 's' : ''}`] = newComponent.coordinationScopes.spatialLayers;\n      }\n    }\n\n    if (newComponent.coordinationScopes && newComponent.coordinationScopes.spatialLayers) {\n      replaceCoordinationScope('raster');\n      replaceCoordinationScope('cells');\n      replaceCoordinationScope('molecules');\n      replaceCoordinationScope('neighborhoods');\n      delete newComponent.coordinationScopes.spatialLayers;\n    }\n    return newComponent;\n  });\n\n  return {\n    ...config,\n    coordinationSpace,\n    layout,\n    version: '1.0.1',\n  };\n}\n\n\nexport function upgradeFrom1_0_1(config) {\n  // Need to add the globalDisable3d prop to any layer controller views,\n  // to match the previous lack of 3D auto-detection behavior.\n\n  const layout = config.layout.map((component) => {\n    const newComponent = { ...component };\n    if (newComponent.component === 'layerController') {\n      newComponent.props = {\n        ...newComponent.props,\n        globalDisable3d: true,\n      };\n    }\n    return newComponent;\n  });\n\n  // Enforce bitmask or raster as spatial raster layer type, defaulting\n  // to raster layer if it is not one of bitmask or raster from the old config.\n\n  const newConfig = cloneDeep(config);\n  Object.keys((newConfig?.coordinationSpace?.spatialRasterLayers || {})).forEach((key) => {\n    if (newConfig.coordinationSpace.spatialRasterLayers[key]) {\n      newConfig.coordinationSpace.spatialRasterLayers[key].forEach((layer, index) => {\n        newConfig.coordinationSpace.spatialRasterLayers[key][index].type = ['bitmask', 'raster'].includes(layer.type) ? layer.type : 'raster';\n      });\n    }\n  });\n\n  return {\n    ...newConfig,\n    layout,\n    version: '1.0.2',\n  };\n}\n\nexport function upgradeFrom1_0_2(config) {\n  // Need to add the globalDisable3d prop to any layer controller views,\n  // to match the previous lack of 3D auto-detection behavior.\n\n  const layout = config.layout.map((component) => {\n    const newComponent = { ...component };\n    if (newComponent.component === 'layerController') {\n      newComponent.props = {\n        ...newComponent.props,\n        disableChannelsIfRgbDetected: true,\n      };\n    }\n    return newComponent;\n  });\n\n  // Enforce bitmask or raster as spatial raster layer type, defaulting\n  // to raster layer if it is not one of bitmask or raster from the old config.\n\n  const newConfig = cloneDeep(config);\n\n  return {\n    ...newConfig,\n    layout,\n    version: '1.0.3',\n  };\n}\n\nexport function upgradeFrom1_0_3(config) {\n  const newConfig = cloneDeep(config);\n\n  return {\n    ...newConfig,\n    version: '1.0.4',\n  };\n}\n\n// Added in version 1.0.5:\n// - Support for an array of strings in the setName property within options array items\n//   for the anndata-cell-sets.zarr file type.\nexport function upgradeFrom1_0_4(config) {\n  const newConfig = cloneDeep(config);\n\n  return {\n    ...newConfig,\n    version: '1.0.5',\n  };\n}\n", "import React, { useEffect, useMemo } from 'react';\nimport { useReady } from '../hooks';\nimport { useDescription, useRasterData } from '../data-hooks';\nimport { useCoordination, useLoaders } from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport TitleInfo from '../TitleInfo';\nimport Description from './Description';\n\nconst DESCRIPTION_DATA_TYPES = ['raster'];\n\n/**\n * A subscriber component for a text description component.\n * Also renders a table containing image metadata.\n * @param {object} props\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n */\nexport default function DescriptionSubscriber(props) {\n  const {\n    coordinationScopes,\n    description: descriptionOverride,\n    removeGridComponent,\n    theme,\n    title = 'Data Set',\n  } = props;\n\n  const loaders = useLoaders();\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    spatialRasterLayers: rasterLayers,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.description, coordinationScopes);\n\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    DESCRIPTION_DATA_TYPES,\n  );\n\n  // Reset loader progress when the dataset has changed.\n  useEffect(() => {\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [description] = useDescription(loaders, dataset);\n  const [raster, imageLayerLoaders, imageLayerMeta] = useRasterData(\n    loaders, dataset, setItemIsReady, () => {}, false,\n  );\n\n  const metadata = useMemo(() => {\n    const result = new Map();\n    if (rasterLayers && rasterLayers.length > 0 && raster && imageLayerMeta && imageLayerLoaders) {\n      rasterLayers.forEach((layer) => {\n        if (imageLayerMeta[layer.index]) {\n          // Want to ensure that layer index is a string.\n          const { format } = imageLayerLoaders[layer.index].metadata;\n          result.set(`${layer.index}`, {\n            name: raster.meta[layer.index].name,\n            metadata: format && format(),\n          });\n        }\n      });\n    }\n    return result;\n  }, [raster, rasterLayers, imageLayerMeta, imageLayerLoaders]);\n\n  return (\n    <TitleInfo\n      title={title}\n      removeGridComponent={removeGridComponent}\n      isScroll\n      theme={theme}\n      isReady={isReady}\n    >\n      <Description\n        description={descriptionOverride || description}\n        metadata={metadata}\n      />\n    </TitleInfo>\n  );\n}\n", "import React from 'react';\n\nexport default function Description(props) {\n  const { description, metadata } = props;\n\n  return (\n    <div className=\"description\">\n      <p>{description}</p>\n\n      {metadata && Array.from(metadata.entries())\n        .map(([layerIndex, { name: layerName, metadata: metadataRecord }]) => (\n          metadataRecord && Object.entries(metadataRecord).length > 0 ? (\n            <details key={layerIndex}>\n              <summary>{layerName}</summary>\n              <div className=\"metadata-container\">\n                <table>\n                  <tbody>\n                    {Object.entries(metadataRecord)\n                      .map(([key, value]) => (\n                        <tr key={key}>\n                          <th title={key}>{key}</th>\n                          <td title={value}>{value}</td>\n                        </tr>\n                      ))}\n                  </tbody>\n                </table>\n              </div>\n            </details>\n          ) : null))}\n    </div>\n  );\n}\n", "import React from 'react';\nimport { useCoordination, useWarning } from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport TitleInfo from '../TitleInfo';\nimport Status from './Status';\n\n/**\n * A subscriber component for the status component,\n * which renders hovered cell/gene/molecule information\n * as well as schema validation and data loading errors.\n * @param {object} props\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n */\nexport default function StatusSubscriber(props) {\n  const {\n    coordinationScopes,\n    removeGridComponent,\n    theme,\n    title = 'Status',\n  } = props;\n\n  // Get \"props\" from the coordination space.\n  const [{\n    cellHighlight,\n    geneHighlight,\n    moleculeHighlight,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.status, coordinationScopes);\n\n  const warn = useWarning();\n\n  const infos = [\n    ...(cellHighlight\n      ? [`Hovered cell ${cellHighlight}`]\n      : []\n    ),\n    ...(geneHighlight\n      ? [`Hovered gene ${geneHighlight}`]\n      : []\n    ),\n    ...(moleculeHighlight\n      ? [`Hovered gene ${moleculeHighlight}`]\n      : []\n    ),\n  ];\n  const info = infos.join('; ');\n\n  return (\n    <TitleInfo\n      title={title}\n      theme={theme}\n      removeGridComponent={removeGridComponent}\n      isScroll\n      isReady\n    >\n      <Status warn={warn} info={info} />\n    </TitleInfo>\n  );\n}\n", "import React from 'react';\n\nexport default function Status(props) {\n  const warnClass = 'alert alert-warning my-0 details';\n  const { info, warn } = props;\n  const messages = [];\n  if (info) {\n    messages.push(<p className=\"details\" key=\"info\">{info}</p>);\n  }\n  if (warn) {\n    messages.push(<p className={warnClass} key=\"warn\">{warn}</p>);\n  }\n  return (\n    messages\n  );\n}\n", "import React, { useEffect } from 'react';\nimport { pluralize } from '../../utils';\nimport { useReady, useUrls } from '../hooks';\nimport { useExpressionAttrs } from '../data-hooks';\nimport { useCoordination, useLoaders } from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\n\nimport TitleInfo from '../TitleInfo';\nimport Genes from './Genes';\n\nconst GENES_DATA_TYPES = ['expression-matrix'];\n\n/**\n * A subscriber component for a gene listing component.\n * @param {object} props\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n * @param {string} props.variablesLabelOverride The singular form\n * of the name of the variable.\n * @param {string} props.variablesPluralLabelOverride The plural\n * form of the name of the variable.\n */\nexport default function GenesSubscriber(props) {\n  const {\n    coordinationScopes,\n    removeGridComponent,\n    variablesLabelOverride: variablesLabel = 'gene',\n    variablesPluralLabelOverride: variablesPluralLabel = `${variablesLabel}s`,\n    theme,\n    title = 'Expression Levels',\n  } = props;\n\n  const loaders = useLoaders();\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    geneSelection,\n    geneFilter,\n    cellColorEncoding,\n  }, {\n    setGeneSelection,\n    setGeneFilter,\n    setGeneHighlight,\n    setCellColorEncoding,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.genes, coordinationScopes);\n\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    GENES_DATA_TYPES,\n  );\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [attrs] = useExpressionAttrs(\n    loaders, dataset, setItemIsReady, addUrl, true,\n  );\n  const geneList = attrs ? attrs.cols : [];\n  const numGenes = geneList.length;\n\n  function setGeneSelectionAndColorEncoding(newSelection) {\n    setGeneSelection(newSelection);\n    setCellColorEncoding('geneSelection');\n  }\n\n  return (\n    <TitleInfo\n      title={title}\n      info={`${numGenes} ${pluralize(variablesLabel, variablesPluralLabel, numGenes)}`}\n      theme={theme}\n      // Virtual scroll is used but this allows for the same styling as a scroll component\n      // even though this no longer uses the TitleInfo component's\n      // scroll css (SelectableTable is virtual scroll).\n      isScroll\n      removeGridComponent={removeGridComponent}\n      isReady={isReady}\n      urls={urls}\n    >\n      <Genes\n        hasColorEncoding={cellColorEncoding === 'geneSelection'}\n        geneList={geneList}\n        geneSelection={geneSelection}\n        geneFilter={geneFilter}\n        setGeneSelection={setGeneSelectionAndColorEncoding}\n        setGeneFilter={setGeneFilter}\n        setGeneHighlight={setGeneHighlight}\n      />\n    </TitleInfo>\n  );\n}\n", "import React, { useEffect, useState } from 'react';\nimport { SelectableTable } from '../selectable-table/index';\n\nexport default function Genes(props) {\n  const {\n    hasColorEncoding,\n    geneList = [],\n    geneSelection = [],\n    geneFilter = null,\n    setGeneSelection,\n  } = props;\n\n  const [searchTerm, setSearchTerm] = useState('');\n  const [searchResults, setSearchResults] = useState(geneList);\n\n  useEffect(() => {\n    const results = geneList\n      .filter(gene => gene.toLowerCase().includes(searchTerm.toLowerCase()));\n    setSearchResults(results);\n  }, [searchTerm, geneList]);\n\n  function onChange(selection) {\n    if (setGeneSelection && selection && selection.name) {\n      setGeneSelection([selection.name]);\n    }\n  }\n\n  const data = searchResults\n    .filter(gene => (geneFilter ? geneFilter.includes(gene) : true))\n    .sort((a, b) => a.localeCompare(b))\n    .map(\n      gene => ({ name: gene, value: (geneSelection ? geneSelection.includes(gene) : false) }),\n    );\n\n  const handleChange = (event) => {\n    setSearchTerm(event.target.value);\n  };\n\n  return (\n    <>\n      <input\n        className=\"search-bar\"\n        type=\"text\"\n        placeholder=\"Search\"\n        value={searchTerm}\n        onChange={handleChange}\n      />\n      <SelectableTable\n        columns={['name']}\n        data={data}\n        hasColorEncoding={hasColorEncoding}\n        idKey=\"name\"\n        valueKey=\"value\"\n        onChange={onChange}\n        allowUncheck={false}\n        showTableHead={false}\n      />\n    </>\n  );\n}\n", "/* eslint-disable jsx-a11y/no-noninteractive-element-to-interactive-role */\n/* eslint-disable jsx-a11y/click-events-have-key-events */\nimport React, { useEffect, useCallback, useState } from 'react';\nimport { Table, AutoSizer } from 'react-virtualized';\nimport uuidv4 from 'uuid/v4';\nimport union from 'lodash/union';\nimport difference from 'lodash/difference';\nimport isEqual from 'lodash/isEqual';\n\n/**\n * A table with \"selectable\" rows.\n * @prop {string[]} columns An array of column names, corresponding to data object properties.\n * @prop {object[]} data An array of data objects used to populate table rows.\n * @prop {function} onChange Callback function,\n * passed a selection object when `allowMultiple` is false (and `null` if `allowUncheck` is true),\n * or passed an array of selection objects when `allowMultiple` is true.\n * @prop {string} idKey The key for a unique identifier property of `data` objects.\n * @prop {string} valueKey If initially-selected rows are required,\n * this key specifies a boolean property of the `data` objects\n * indicating those rows that should be initially selected.\n * @prop {boolean} allowMultiple Whether to allow multiple rows to be selected. By default, false.\n * @prop {boolean} allowUncheck Whether to allow selected rows to be un-checked. By default, false.\n * @prop {boolean} showTableHead Whether to show the table header element. By default, true.\n * @prop {boolean} showTableInputs Whether to show the table input elements for each row.\n * By default, false.\n */\nexport default function SelectableTable(props) {\n  const {\n    hasColorEncoding,\n    columns,\n    data,\n    onChange,\n    idKey = 'id',\n    valueKey = 'value',\n    allowMultiple = false,\n    allowUncheck = false,\n    showTableHead = true,\n    showTableInputs = false,\n    testHeight = undefined,\n    testWidth = undefined,\n  } = props;\n\n  const [selectedRows, setSelectedRows] = useState(null);\n\n  // Callback function to update the `selectedRows` state.\n  const onSelectRow = useCallback((value, checked) => {\n    if (checked || allowUncheck) {\n      if (!allowMultiple) {\n        setSelectedRows(checked ? [value] : []);\n      } else {\n        setSelectedRows(\n          checked\n            ? union(selectedRows || [], [value])\n            : difference(selectedRows || [], [value]),\n        );\n      }\n    }\n  }, [allowMultiple, allowUncheck, selectedRows]);\n\n  // Handler for checkbox input elements.\n  const handleInputChange = useCallback((event) => {\n    const { target } = event;\n    const { checked } = target;\n    const { value } = target;\n    onSelectRow(value, checked);\n  }, [onSelectRow]);\n\n  // Function to map row IDs to corresponding objects\n  // to pass to the `onChange` callback.\n  const getDataFromIds = useCallback(ids => ids.map(id => ({\n    [idKey]: id,\n    data: data.find(item => item[idKey] === id),\n  })), [data, idKey]);\n\n  // Function to check if a row ID has been selected.\n  const isSelected = useCallback(id => (\n    Array.isArray(selectedRows) && selectedRows.includes(id)\n  ), [selectedRows]);\n\n  /* eslint-disable react-hooks/exhaustive-deps */\n  useEffect(() => {\n    // Check whether an initial set of rows should be selected.\n    const initialSelectedRows = data\n      .map((d) => {\n        if (d[valueKey]) {\n          return d[idKey];\n        }\n        return null;\n      })\n      .filter(Boolean);\n    if (!isEqual(initialSelectedRows, selectedRows)) {\n      if (initialSelectedRows.length > 0) {\n        setSelectedRows(initialSelectedRows);\n      } else {\n        setSelectedRows(null);\n      }\n    }\n  }, [data, idKey, valueKey]);\n\n  /* eslint-disable react-hooks/exhaustive-deps */\n  useEffect(() => {\n    // Call the `onChange` prop function with an updated row or set of rows.\n    if (!onChange || !selectedRows) {\n      return;\n    }\n    const selectedRowData = getDataFromIds(selectedRows);\n    if (allowMultiple) {\n      onChange(selectedRowData);\n    } else if (selectedRows.length === 1) {\n      onChange(selectedRowData[0]);\n    } else if (selectedRows.length === 0) {\n      onChange(null);\n    }\n  }, [selectedRows]);\n\n  // Generate a unique ID to use in (for, id) label-input pairs.\n  const inputUuid = uuidv4();\n\n  // Class for first column of inputs, to hide them if desired.\n  const hiddenInputsClass = (showTableInputs ? '' : 'hidden-input-column');\n\n  const rowRenderer = ({ index, style }) => (\n    // eslint-disable-next-line jsx-a11y/interactive-supports-focus\n    <div\n      key={data[index][idKey]}\n      className={`table-item table-row ${isSelected(data[index][idKey]) ? 'row-checked ' : ''}`}\n      style={style}\n      role=\"button\"\n      onClick={() => onSelectRow(\n        data[index][idKey],\n        !isSelected(data[index][idKey]) || !hasColorEncoding,\n      )}\n    >\n      <div className={`input-container ${hiddenInputsClass} table-cell`}>\n        <label htmlFor={`${inputUuid}_${data[index][idKey]}`}>\n          <input\n            id={`${inputUuid}_${data[index][idKey]}`}\n            type=\"checkbox\"\n            className={(allowMultiple ? 'checkbox' : 'radio')}\n            name={inputUuid}\n            value={data[index][idKey]}\n            onChange={handleInputChange}\n            checked={isSelected(data[index][idKey])}\n          />\n        </label>\n      </div>\n      {columns.map(column => (\n        <div\n          className=\"table-cell\"\n          key={column}\n        >\n          {data[index][column]}\n        </div>\n      ))}\n    </div>\n  );\n\n  const headerRowRenderer = ({ style }) => (\n    <div className={`${hiddenInputsClass} table-row`} style={style}>\n      {columns.map(column => (\n        <div key={column}>{column}</div>\n      ))}\n    </div>\n  );\n\n  return (\n    <div className=\"selectable-table\">\n      <AutoSizer>\n        {({ width, height }) => (\n          <Table\n            height={testHeight || height}\n            gridStyle={{ outline: 'none' }}\n            rowCount={data.length}\n            // 24 is 1 em + padding in either direction (see _selectable_table.scss).\n            rowHeight={24}\n            headerHeight={showTableHead ? 24 : undefined}\n            rowRenderer={rowRenderer}\n            width={testWidth || width}\n            headerRowRenderer={showTableHead ? headerRowRenderer : undefined}\n            rowGetter={({ index }) => data[index]}\n          />\n        )}\n      </AutoSizer>\n    </div>\n  );\n}\n", "import React, {\n  useEffect,\n  useState,\n  useMemo,\n} from 'react';\nimport isEqual from 'lodash/isEqual';\nimport packageJson from '../../../package.json';\nimport {\n  useCoordination,\n  useLoaders,\n  useSetWarning,\n} from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport SetsManager from './SetsManager';\nimport TitleInfo from '../TitleInfo';\nimport {\n  treeExportLevelZeroNode,\n  treeExportSet,\n  treeToExpectedCheckedLevel,\n  nodeToLevelDescendantNamePaths,\n  treeToIntersection,\n  treeToUnion,\n  treeToComplement,\n  treeFindNodeByNamePath,\n  treesConflict,\n  nodeTransform,\n  nodeAppendChild,\n  nodePrependChild,\n  nodeInsertChild,\n  filterNode,\n  treeInitialize,\n  initializeCellSetColor,\n} from './cell-set-utils';\nimport {\n  isEqualOrPrefix,\n  tryRenamePath,\n  PATH_SEP,\n} from './utils';\nimport {\n  downloadForUser,\n  handleExportJSON,\n  handleExportTabular,\n  tryUpgradeTreeToLatestSchema,\n} from './io';\nimport {\n  FILE_EXTENSION_JSON,\n  FILE_EXTENSION_TABULAR,\n  SETS_DATATYPE_CELL,\n} from './constants';\nimport { useUrls, useReady } from '../hooks';\nimport {\n  setCellSelection,\n  mergeCellSets,\n  getNextNumberedNodeName,\n} from '../utils';\nimport { useCellsData, useCellSetsData } from '../data-hooks';\n\nconst CELL_SETS_DATA_TYPES = ['cells', 'cell-sets'];\n\n/**\n * A subscriber wrapper around the SetsManager component\n * for the 'cell' datatype.\n * @param {object} props\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n */\nexport default function CellSetsManagerSubscriber(props) {\n  const {\n    coordinationScopes,\n    removeGridComponent,\n    theme,\n    title = 'Cell Sets',\n  } = props;\n\n  const loaders = useLoaders();\n  const setWarning = useSetWarning();\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    cellSetSelection,\n    cellSetColor,\n    additionalCellSets,\n    cellColorEncoding,\n  }, {\n    setCellSetSelection,\n    setCellColorEncoding,\n    setCellSetColor,\n    setAdditionalCellSets,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.cellSets, coordinationScopes);\n\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    CELL_SETS_DATA_TYPES,\n  );\n\n  const [cellSetExpansion, setCellSetExpansion] = useState([]);\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n    setCellSetExpansion([]);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [cells] = useCellsData(loaders, dataset, setItemIsReady, addUrl, true);\n  const [cellSets] = useCellSetsData(\n    loaders, dataset, setItemIsReady, addUrl, true,\n    { setCellSetSelection, setCellSetColor },\n    { cellSetSelection, cellSetColor },\n  );\n\n  // Validate and upgrade the additionalCellSets.\n  useEffect(() => {\n    if (additionalCellSets) {\n      let upgradedCellSets;\n      try {\n        upgradedCellSets = tryUpgradeTreeToLatestSchema(additionalCellSets, SETS_DATATYPE_CELL);\n      } catch (e) {\n        setWarning(e.message);\n        return;\n      }\n      setAdditionalCellSets(upgradedCellSets);\n    }\n  }, [additionalCellSets, setAdditionalCellSets, setWarning]);\n\n  // Get an array of all cell IDs to use for set complement operations.\n  const allCellIds = useMemo(() => (cells ? Object.keys(cells) : []), [cells]);\n\n  // A helper function for updating the encoding for cell colors,\n  // which may have previously been set to 'geneSelection'.\n  function setCellSetColorEncoding() {\n    setCellColorEncoding('cellSetSelection');\n  }\n\n  // Merged cell sets are only to be used for convenience when reading\n  // (if writing: update either `cellSets` _or_ `additionalCellSets`).\n  const mergedCellSets = useMemo(\n    () => mergeCellSets(cellSets, additionalCellSets),\n    [cellSets, additionalCellSets],\n  );\n\n  // Infer the state of the \"checked level\" radio button based on the selected cell sets.\n  const checkedLevel = useMemo(() => {\n    if (cellSetSelection && cellSetSelection.length > 0\n    && mergedCellSets && mergedCellSets.tree.length > 0) {\n      return treeToExpectedCheckedLevel(mergedCellSets, cellSetSelection);\n    }\n    return null;\n  }, [cellSetSelection, mergedCellSets]);\n\n  // Callback functions\n\n  // The user wants to select all nodes at a particular hierarchy level.\n  function onCheckLevel(levelZeroName, levelIndex) {\n    const lzn = mergedCellSets.tree.find(n => n.name === levelZeroName);\n    if (lzn) {\n      const newCellSetSelection = nodeToLevelDescendantNamePaths(lzn, levelIndex, [], true);\n      setCellSetSelection(newCellSetSelection);\n      setCellSetColorEncoding();\n    }\n  }\n\n  // The user wants to check or uncheck a cell set node.\n  function onCheckNode(targetKey, checked) {\n    const targetPath = (Array.isArray(targetKey) ? targetKey : targetKey.split(PATH_SEP));\n    if (!targetKey) {\n      return;\n    }\n    if (checked) {\n      setCellSetSelection([...cellSetSelection, targetPath]);\n    } else {\n      setCellSetSelection(cellSetSelection.filter(d => !isEqual(d, targetPath)));\n    }\n    setCellSetColorEncoding();\n  }\n\n  // The user wants to expand or collapse a node in the tree.\n  function onExpandNode(expandedKeys, targetKey, expanded) {\n    if (expanded) {\n      setCellSetExpansion(prev => ([...prev, targetKey.split(PATH_SEP)]));\n    } else {\n      setCellSetExpansion(prev => prev.filter(d => !isEqual(d, targetKey.split(PATH_SEP))));\n    }\n  }\n\n  // The user dragged a tree node and dropped it somewhere else in the tree\n  // to re-arrange or re-order the nodes.\n  // We need to verify that their drop target is valid, and if so, complete\n  // the tree re-arrangement.\n  function onDropNode(dropKey, dragKey, dropPosition, dropToGap) {\n    const dropPath = dropKey.split(PATH_SEP);\n    const dropNode = treeFindNodeByNamePath(additionalCellSets, dropPath);\n    if (!dropNode.children && !dropToGap) {\n      // Do not allow a node with a set (i.e. leaf) to become a child of another node with a set,\n      // as this will result in an internal node having a set, which we do not allow.\n      return;\n    }\n    const dropNodeLevel = dropPath.length - 1;\n    const dropNodeIsLevelZero = dropNodeLevel === 0;\n\n    // Get drag node.\n    const dragPath = dragKey.split(PATH_SEP);\n    const dragNode = treeFindNodeByNamePath(additionalCellSets, dragPath);\n\n    if (dropNodeIsLevelZero && dropToGap && !dragNode.children) {\n      // Do not allow a leaf node to become a level zero node.\n      return;\n    }\n\n    let dropParentNode;\n    let dropParentPath;\n    let dropNodeCurrIndex;\n    if (!dropNodeIsLevelZero) {\n      dropParentPath = dropPath.slice(0, -1);\n      dropParentNode = treeFindNodeByNamePath(additionalCellSets, dropParentPath);\n      dropNodeCurrIndex = dropParentNode.children.findIndex(c => c.name === dropNode.name);\n    } else {\n      dropNodeCurrIndex = additionalCellSets.tree.findIndex(\n        lzn => lzn.name === dropNode.name,\n      );\n    }\n    // Further, only allow dragging if the dragged node will have a unique\n    // name among its new siblings.\n    let hasSiblingNameConflict;\n    const dragNodeName = dragNode.name;\n    if (!dropNodeIsLevelZero && dropToGap) {\n      hasSiblingNameConflict = dropParentNode.children\n        .find(c => c !== dragNode && c.name === dragNodeName);\n    } else if (!dropToGap) {\n      hasSiblingNameConflict = dropNode.children\n        .find(c => c !== dragNode && c.name === dragNodeName);\n    } else {\n      hasSiblingNameConflict = additionalCellSets.tree\n        .find(lzn => lzn !== dragNode && lzn.name === dragNodeName);\n    }\n\n    if (hasSiblingNameConflict) {\n      return;\n    }\n\n    // Remove the dragged object from its current position.\n    // Recursively check whether each node path\n    // matches the path of the node to delete.\n    // If so, return null, and then always use\n    // .filter(Boolean) to eliminate any null array elements.\n    const nextAdditionalCellSets = {\n      ...additionalCellSets,\n      tree: additionalCellSets.tree.map(lzn => filterNode(lzn, [], dragPath)).filter(Boolean),\n    };\n\n    // Update index values after temporarily removing the dragged node.\n    // Names are unique as children of their parents.\n    if (!dropNodeIsLevelZero) {\n      dropNodeCurrIndex = dropParentNode.children.findIndex(c => c.name === dropNode.name);\n    } else {\n      dropNodeCurrIndex = nextAdditionalCellSets.tree.findIndex(\n        lzn => lzn.name === dropNode.name,\n      );\n    }\n    let newDragPath = [];\n    if (!dropToGap || !dropNodeIsLevelZero) {\n      let addChildFunction;\n      let checkPathFunction;\n      const newPath = [];\n      if (!dropToGap) {\n        // Append the dragNode to dropNode's children if dropping _onto_ the dropNode.\n        // Set dragNode as the last child of dropNode.\n        addChildFunction = n => nodeAppendChild(n, dragNode);\n        checkPathFunction = path => isEqual(path, dropPath);\n      } else if (!dropNodeIsLevelZero) {\n        // Prepend or insert the dragNode if dropping _between_ (above or below dropNode).\n        // The dropNode is at a level greater than zero,\n        // so it has a parent.\n        checkPathFunction = path => isEqual(path, dropParentPath);\n        if (dropPosition === -1) {\n          // Set dragNode as first child of dropParentNode.\n          addChildFunction = n => nodePrependChild(n, dragNode);\n        } else {\n          // Set dragNode before or after dropNode.\n          const insertIndex = dropNodeCurrIndex + (dropPosition > dropNodeCurrIndex ? 1 : 0);\n          addChildFunction = n => nodeInsertChild(n, dragNode, insertIndex);\n        }\n      }\n      nextAdditionalCellSets.tree = nextAdditionalCellSets.tree.map(\n        node => nodeTransform(\n          node,\n          (n, path) => checkPathFunction(path),\n          (n) => {\n            const newNode = addChildFunction(n);\n            return newNode;\n          },\n          newPath,\n        ),\n      );\n      // Done\n      setAdditionalCellSets(nextAdditionalCellSets);\n      newDragPath = [...newPath[0], dragNode.name];\n      setCellSetSelection([newDragPath]);\n    } else if (dropPosition === -1) {\n      // We need to drop the dragNode to level zero,\n      // and level zero nodes do not have parents.\n      // Set dragNode as first level zero node of the tree.\n      nextAdditionalCellSets.tree.unshift(dragNode);\n      setAdditionalCellSets(nextAdditionalCellSets);\n      newDragPath = [dragNode.name];\n      setCellSetSelection([newDragPath]);\n    } else {\n      // Set dragNode before or after dropNode in level zero.\n      const insertIndex = dropNodeCurrIndex + (dropPosition > dropNodeCurrIndex ? 1 : 0);\n      const newLevelZero = Array.from(nextAdditionalCellSets.tree);\n      newLevelZero.splice(insertIndex, 0, dragNode);\n      nextAdditionalCellSets.tree = newLevelZero;\n      setAdditionalCellSets(nextAdditionalCellSets);\n      newDragPath = [dragNode.name];\n      setCellSetSelection([newDragPath]);\n    }\n    const oldColors = cellSetColor.filter(\n      i => isEqualOrPrefix(dragPath, i.path),\n    );\n    const newColors = oldColors.map(\n      i => (\n        {\n          ...i,\n          path: !isEqual(i.path, dragPath)\n            ? newDragPath.concat(i.path.slice(dragPath.length))\n            : newDragPath,\n        }\n      ),\n    );\n    const newCellSetColor = cellSetColor.filter(\n      i => !isEqualOrPrefix(dragPath, i.path),\n    );\n    newCellSetColor.push(...newColors);\n    setCellSetColor(newCellSetColor);\n  }\n\n  // The user wants to change the color of a cell set node.\n  function onNodeSetColor(targetPath, color) {\n    // Replace the color if an array element for this path already exists.\n    const prevNodeColor = cellSetColor?.find(d => isEqual(d.path, targetPath));\n    if (!prevNodeColor) {\n      setCellSetColor([\n        ...(cellSetColor || []),\n        {\n          path: targetPath,\n          color,\n        },\n      ]);\n    } else {\n      setCellSetColor([\n        ...cellSetColor.filter(d => !isEqual(d.path, targetPath)),\n        {\n          path: targetPath,\n          color,\n        },\n      ]);\n    }\n  }\n\n  // The user wants to change the name of a cell set node.\n  function onNodeSetName(targetPath, name) {\n    const nextNamePath = [...targetPath];\n    nextNamePath.pop();\n    nextNamePath.push(name);\n\n    // Recursively check whether each node path\n    // matches the path or a prefix of the path of the node to rename.\n    // If so, rename the node using the new path.\n    function renameNode(node, prevPath) {\n      if (isEqual([...prevPath, node.name], targetPath)) {\n        return {\n          ...node,\n          name,\n        };\n      }\n      if (!node.children) {\n        return node;\n      }\n      return {\n        ...node,\n        children: node.children.map(c => renameNode(c, [...prevPath, node.name])),\n      };\n    }\n    const nextAdditionalCellSets = {\n      ...additionalCellSets,\n      tree: additionalCellSets.tree.map(lzn => renameNode(lzn, [])),\n    };\n    // Change all paths that have this node as a prefix (i.e. descendants).\n    const nextCellSetColor = cellSetColor.map(d => ({\n      path: tryRenamePath(targetPath, d.path, nextNamePath),\n      color: d.color,\n    }));\n    const nextCellSetSelection = cellSetSelection.map(d => (\n      tryRenamePath(targetPath, d, nextNamePath)\n    ));\n    const nextCellSetExpansion = cellSetExpansion.map(d => (\n      tryRenamePath(targetPath, d, nextNamePath)\n    ));\n    // Need to update the node path everywhere it may be present.\n    setAdditionalCellSets(nextAdditionalCellSets);\n    setCellSetColor(nextCellSetColor);\n    setCellSetSelection(nextCellSetSelection);\n    setCellSetExpansion(nextCellSetExpansion);\n  }\n\n  // Each time the user types while renaming a cell set node,\n  // we need to check whether the potential new name conflicts\n  // with any existing cell set node names.\n  // If there are conflicts, we want to disable the \"Save\" button.\n  function onNodeCheckNewName(targetPath, name) {\n    const nextNamePath = [...targetPath];\n    nextNamePath.pop();\n    nextNamePath.push(name);\n    const hasConflicts = (\n      !isEqual(targetPath, nextNamePath)\n      && treeFindNodeByNamePath(additionalCellSets, nextNamePath)\n    );\n    return hasConflicts;\n  }\n\n  // The user wants to delete a cell set node, and has confirmed their choice.\n  function onNodeRemove(targetPath) {\n    // Recursively check whether each node path\n    // matches the path of the node to delete.\n    // If so, return null, and then always use\n    // .filter(Boolean) to eliminate any null array elements.\n    const nextAdditionalCellSets = {\n      ...additionalCellSets,\n      tree: additionalCellSets.tree.map(lzn => filterNode(lzn, [], targetPath)).filter(Boolean),\n    };\n    // Delete state for all paths that have this node\n    // path as a prefix (i.e. delete all descendents).\n    const nextCellSetColor = cellSetColor.filter(d => !isEqualOrPrefix(targetPath, d.path));\n    const nextCellSetSelection = cellSetSelection.filter(d => !isEqualOrPrefix(targetPath, d));\n    const nextCellSetExpansion = cellSetExpansion.filter(d => !isEqualOrPrefix(targetPath, d));\n    setAdditionalCellSets(nextAdditionalCellSets);\n    setCellSetColor(nextCellSetColor);\n    setCellSetSelection(nextCellSetSelection);\n    setCellSetExpansion(nextCellSetExpansion);\n  }\n\n  // The user wants to view (i.e. select) a particular node,\n  // or its expanded descendents.\n  function onNodeView(targetPath) {\n    // If parent node is clicked, and if it is expanded,\n    // then select the expanded descendent nodes.\n    const setsToView = [];\n    // Recursively determine which descendent nodes are currently expanded.\n    function viewNode(node, nodePath) {\n      if (cellSetExpansion.find(expandedPath => isEqual(nodePath, expandedPath))) {\n        if (node.children) {\n          node.children.forEach((c) => {\n            viewNode(c, [...nodePath, c.name]);\n          });\n        } else {\n          setsToView.push(nodePath);\n        }\n      } else {\n        setsToView.push(nodePath);\n      }\n    }\n    const targetNode = treeFindNodeByNamePath(mergedCellSets, targetPath);\n    viewNode(targetNode, targetPath);\n    setCellSetSelection(setsToView);\n    setCellSetColorEncoding();\n  }\n\n  // The user wants to create a new level zero node.\n  function onCreateLevelZeroNode() {\n    const nextName = getNextNumberedNodeName(additionalCellSets?.tree, 'My hierarchy ');\n    setAdditionalCellSets({\n      ...(additionalCellSets || treeInitialize(SETS_DATATYPE_CELL)),\n      tree: [\n        ...(additionalCellSets ? additionalCellSets.tree : []),\n        {\n          name: nextName,\n          children: [],\n        },\n      ],\n    });\n  }\n\n  // The user wants to create a new node corresponding to\n  // the union of the selected sets.\n  function onUnion() {\n    const newSet = treeToUnion(mergedCellSets, cellSetSelection);\n    setCellSelection(\n      newSet, additionalCellSets, cellSetColor,\n      setCellSetSelection, setAdditionalCellSets, setCellSetColor,\n      setCellColorEncoding,\n      'Union ',\n    );\n  }\n\n  // The user wants to create a new node corresponding to\n  // the intersection of the selected sets.\n  function onIntersection() {\n    const newSet = treeToIntersection(mergedCellSets, cellSetSelection);\n    setCellSelection(\n      newSet, additionalCellSets, cellSetColor,\n      setCellSetSelection, setAdditionalCellSets, setCellSetColor,\n      setCellColorEncoding,\n      'Intersection ',\n    );\n  }\n\n  // The user wants to create a new node corresponding to\n  // the complement of the selected sets.\n  function onComplement() {\n    const newSet = treeToComplement(mergedCellSets, cellSetSelection, allCellIds);\n    setCellSelection(\n      newSet, additionalCellSets, cellSetColor,\n      setCellSetSelection, setAdditionalCellSets, setCellSetColor,\n      setCellColorEncoding,\n      'Complement ',\n    );\n  }\n\n  // The user wants to import a cell set hierarchy,\n  // probably from a CSV or JSON file.\n  function onImportTree(treeToImport) {\n    // Check for any naming conflicts with the current sets\n    // (both user-defined and dataset-defined) before importing.\n    const hasConflict = treesConflict(mergedCellSets, treeToImport);\n    if (!hasConflict) {\n      setAdditionalCellSets({\n        ...(additionalCellSets || treeInitialize(SETS_DATATYPE_CELL)),\n        tree: [\n          ...(additionalCellSets ? additionalCellSets.tree : []),\n          ...treeToImport.tree,\n        ],\n      });\n      // Automatically initialize set colors for the imported sets.\n      const importAutoSetColors = initializeCellSetColor(treeToImport, cellSetColor);\n      setCellSetColor([\n        ...cellSetColor,\n        ...importAutoSetColors,\n      ]);\n    }\n  }\n\n  // The user wants to download a particular hierarchy to a JSON file.\n  function onExportLevelZeroNodeJSON(nodePath) {\n    const {\n      treeToExport, nodeName,\n    } = treeExportLevelZeroNode(mergedCellSets, nodePath, SETS_DATATYPE_CELL, cellSetColor, theme);\n    downloadForUser(\n      handleExportJSON(treeToExport),\n      `${nodeName}_${packageJson.name}-${SETS_DATATYPE_CELL}-hierarchy.${FILE_EXTENSION_JSON}`,\n    );\n  }\n\n  // The user wants to download a particular hierarchy to a CSV file.\n  function onExportLevelZeroNodeTabular(nodePath) {\n    const {\n      treeToExport, nodeName,\n    } = treeExportLevelZeroNode(mergedCellSets, nodePath, SETS_DATATYPE_CELL, cellSetColor, theme);\n    downloadForUser(\n      handleExportTabular(treeToExport),\n      `${nodeName}_${packageJson.name}-${SETS_DATATYPE_CELL}-hierarchy.${FILE_EXTENSION_TABULAR}`,\n    );\n  }\n\n  // The user wants to download a particular set to a JSON file.\n  function onExportSetJSON(nodePath) {\n    const { setToExport, nodeName } = treeExportSet(mergedCellSets, nodePath);\n    downloadForUser(\n      handleExportJSON(setToExport),\n      `${nodeName}_${packageJson.name}-${SETS_DATATYPE_CELL}-set.${FILE_EXTENSION_JSON}`,\n      FILE_EXTENSION_JSON,\n    );\n  }\n  return (\n    <TitleInfo\n      title={title}\n      isScroll\n      removeGridComponent={removeGridComponent}\n      urls={urls}\n      theme={theme}\n      isReady={isReady}\n    >\n      <SetsManager\n        setColor={cellSetColor}\n        sets={cellSets}\n        additionalSets={additionalCellSets}\n        levelSelection={checkedLevel}\n        setSelection={cellSetSelection}\n        setExpansion={cellSetExpansion}\n        hasColorEncoding={cellColorEncoding === 'cellSetSelection'}\n        draggable\n        datatype={SETS_DATATYPE_CELL}\n        onError={setWarning}\n        onCheckNode={onCheckNode}\n        onExpandNode={onExpandNode}\n        onDropNode={onDropNode}\n        onCheckLevel={onCheckLevel}\n        onNodeSetColor={onNodeSetColor}\n        onNodeSetName={onNodeSetName}\n        onNodeCheckNewName={onNodeCheckNewName}\n        onNodeRemove={onNodeRemove}\n        onNodeView={onNodeView}\n        onImportTree={onImportTree}\n        onCreateLevelZeroNode={onCreateLevelZeroNode}\n        onExportLevelZeroNodeJSON={onExportLevelZeroNodeJSON}\n        onExportLevelZeroNodeTabular={onExportLevelZeroNodeTabular}\n        onExportSetJSON={onExportSetJSON}\n        onUnion={onUnion}\n        onIntersection={onIntersection}\n        onComplement={onComplement}\n        hasCheckedSetsToUnion={cellSetSelection?.length > 1}\n        hasCheckedSetsToIntersect={cellSetSelection?.length > 1}\n        hasCheckedSetsToComplement={cellSetSelection?.length > 0}\n        theme={theme}\n      />\n    </TitleInfo>\n  );\n}\n", "/* eslint-disable no-underscore-dangle */\nimport React, { useState, useMemo } from 'react';\nimport isEqual from 'lodash/isEqual';\nimport Tree from './Tree';\nimport TreeNode from './TreeNode';\nimport { PlusButton, SetOperationButtons } from './SetsManagerButtons';\nimport { nodeToRenderProps } from './cell-set-utils';\nimport { getDefaultColor } from '../utils';\nimport { pathToKey } from './utils';\n\nfunction processNode(node, prevPath, setColor, theme) {\n  const nodePath = [...prevPath, node.name];\n  return {\n    ...node,\n    ...(node.children ? ({\n      children: node.children\n        .map(c => processNode(c, nodePath, setColor)),\n    }) : {}),\n    color: setColor?.find(d => isEqual(d.path, nodePath))?.color || getDefaultColor(theme),\n  };\n}\n\nfunction processSets(sets, setColor, theme) {\n  return {\n    ...sets,\n    tree: sets ? sets.tree.map(lzn => processNode(lzn, [], setColor, theme)) : [],\n  };\n}\n\nfunction getAllKeys(node, path = []) {\n  if (!node) {\n    return null;\n  }\n  const newPath = [...path, node.name];\n  if (node.children) {\n    return [pathToKey(newPath), ...node.children.flatMap(v => getAllKeys(v, newPath))];\n  }\n  return pathToKey(newPath);\n}\n\n/**\n * A generic hierarchical set manager component.\n * @prop {object} tree An object representing set hierarchies.\n * @prop {string} datatype The data type for sets (e.g. \"cell\")\n * @prop {function} clearPleaseWait A callback to signal that loading is complete.\n * @prop {boolean} draggable Whether tree nodes can be rearranged via drag-and-drop.\n * By default, true.\n * @prop {boolean} checkable Whether to show the \"Check\" menu button\n * and checkboxes for selecting multiple sets. By default, true.\n * @prop {boolean} editable Whether to show rename, delete, color, or create options.\n * By default, true.\n * @prop {boolean} expandable Whether to allow hierarchies to be expanded\n * to show the list or tree of sets contained. By default, true.\n * @prop {boolean} operatable Whether to enable union, intersection,\n * and complement operations on checked sets. By default, true.\n * @prop {boolean} exportable Whether to enable exporting hierarchies and sets to files.\n * By default, true.\n * @prop {boolean} importable Whether to enable importing hierarchies from files.\n * By default, true.\n * @prop {function} onError Function to call with error messages (failed import validation, etc).\n * @prop {function} onCheckNode Function to call when a single node has been checked or un-checked.\n * @prop {function} onExpandNode Function to call when a node has been expanded.\n * @prop {function} onDropNode Function to call when a node has been dragged-and-dropped.\n * @prop {function} onCheckLevel Function to call when an entire hierarchy level has been selected,\n * via the \"Color by cluster\" and \"Color by subcluster\" buttons below collapsed level zero nodes.\n * @prop {function} onNodeSetColor Function to call when a new node color has been selected.\n * @prop {function} onNodeSetName Function to call when a node has been renamed.\n * @prop {function} onNodeRemove Function to call when the user clicks the \"Delete\" menu button\n * to remove a node.\n * @prop {function} onNodeView Function to call when the user wants to view the set associated\n * with a particular node.\n * @prop {function} onImportTree Function to call when a tree has been imported\n * using the \"plus\" button.\n * @prop {function} onCreateLevelZeroNode Function to call when a user clicks the \"Create hierarchy\"\n * menu option using the \"plus\" button.\n * @prop {function} onExportLevelZeroNode Function to call when a user wants to\n * export an entire hierarchy via the \"Export hierarchy\" menu button for a\n * particular level zero node.\n * @prop {function} onExportSet Function to call when a user wants to export a set associated with\n * a particular node via the \"Export set\" menu button.\n * @prop {function} onUnion Function to call when a user wants to create a new set from the union\n * of the sets associated with the currently-checked nodes.\n * @prop {function} onIntersection Function to call when a user wants to create a new set from the\n * intersection of the sets associated with the currently-checked nodes.\n * @prop {function} onComplement Function to call when a user wants to create a new set from the\n * complement of the (union of the) sets associated with the currently-checked nodes.\n * @prop {function} onView Function to call when a user wants to view the sets\n * associated with the currently-checked nodes.\n * @prop {string} theme \"light\" or \"dark\" for the vitessce theme\n */\nexport default function SetsManager(props) {\n  const {\n    theme,\n    sets,\n    additionalSets,\n    setColor, // TODO: use this\n    levelSelection: checkedLevel,\n    setSelection,\n    setExpansion,\n    hasColorEncoding,\n    datatype,\n    draggable = true,\n    checkable = true,\n    editable = true,\n    expandable = true,\n    operatable = true,\n    exportable = true,\n    importable = true,\n    onError,\n    onCheckNode,\n    onExpandNode,\n    onDropNode,\n    onCheckLevel,\n    onNodeSetColor,\n    onNodeSetName,\n    onNodeCheckNewName,\n    onNodeRemove,\n    onNodeView,\n    onImportTree,\n    onCreateLevelZeroNode,\n    onExportLevelZeroNodeJSON,\n    onExportLevelZeroNodeTabular,\n    onExportSetJSON,\n    onUnion,\n    onIntersection,\n    onComplement,\n    hasCheckedSetsToUnion,\n    hasCheckedSetsToIntersect,\n    hasCheckedSetsToComplement,\n  } = props;\n\n  const isChecking = true;\n  const autoExpandParent = true;\n  const [isDragging, setIsDragging] = useState(false);\n  const [isEditingNodeName, setIsEditingNodeName] = useState(null);\n\n  const processedSets = useMemo(() => processSets(\n    sets, setColor, theme,\n  ), [sets, setColor, theme]);\n  const processedAdditionalSets = useMemo(() => processSets(\n    additionalSets, setColor, theme,\n  ), [additionalSets, setColor, theme]);\n\n  const additionalSetKeys = (processedAdditionalSets\n    ? processedAdditionalSets.tree.flatMap(v => getAllKeys(v, []))\n    : []\n  );\n\n  const allSetSelectionKeys = (setSelection || []).map(pathToKey);\n  const allSetExpansionKeys = (setExpansion || []).map(pathToKey);\n\n  const setSelectionKeys = allSetSelectionKeys.filter(k => !additionalSetKeys.includes(k));\n  const setExpansionKeys = allSetExpansionKeys.filter(k => !additionalSetKeys.includes(k));\n\n  const additionalSetSelectionKeys = allSetSelectionKeys.filter(k => additionalSetKeys.includes(k));\n  const additionalSetExpansionKeys = allSetExpansionKeys.filter(k => additionalSetKeys.includes(k));\n\n  /**\n   * Recursively render TreeNode components.\n   * @param {object[]} nodes An array of node objects.\n   * @returns {TreeNode[]|null} Array of TreeNode components or null.\n   */\n  function renderTreeNodes(nodes, readOnly, currPath) {\n    if (!nodes) {\n      return null;\n    }\n    return nodes.map((node) => {\n      const newPath = [...currPath, node.name];\n      return (\n        <TreeNode\n          theme={theme}\n          key={pathToKey(newPath)}\n          {...nodeToRenderProps(node, newPath, setColor)}\n\n          isEditing={isEqual(isEditingNodeName, newPath)}\n\n          datatype={datatype}\n          draggable={draggable && !readOnly}\n          editable={editable && !readOnly}\n          checkable={checkable}\n          expandable={expandable}\n          exportable={exportable}\n\n          hasColorEncoding={hasColorEncoding}\n          isChecking={isChecking}\n          checkedLevelPath={checkedLevel ? checkedLevel.levelZeroPath : null}\n          checkedLevelIndex={checkedLevel ? checkedLevel.levelIndex : null}\n\n          onCheckNode={onCheckNode}\n          onCheckLevel={onCheckLevel}\n          onNodeView={onNodeView}\n          onNodeSetColor={onNodeSetColor}\n          onNodeSetName={(targetPath, name) => {\n            onNodeSetName(targetPath, name);\n            setIsEditingNodeName(null);\n          }}\n          onNodeCheckNewName={onNodeCheckNewName}\n          onNodeSetIsEditing={setIsEditingNodeName}\n          onNodeRemove={onNodeRemove}\n          onExportLevelZeroNodeJSON={onExportLevelZeroNodeJSON}\n          onExportLevelZeroNodeTabular={onExportLevelZeroNodeTabular}\n          onExportSetJSON={onExportSetJSON}\n\n          disableTooltip={isDragging}\n          onDragStart={() => setIsDragging(true)}\n          onDragEnd={() => setIsDragging(false)}\n        >\n          {renderTreeNodes(node.children, readOnly, newPath, theme)}\n        </TreeNode>\n      );\n    });\n  }\n\n  return (\n    <div className=\"sets-manager\">\n      <div className=\"sets-manager-tree\">\n        <Tree\n          draggable={false}\n          checkable={checkable}\n\n          checkedKeys={setSelectionKeys}\n          expandedKeys={setExpansionKeys}\n          autoExpandParent={autoExpandParent}\n\n          onCheck={(checkedKeys, info) => onCheckNode(\n            info.node.props.nodeKey,\n            info.checked,\n          )}\n          onExpand={(expandedKeys, info) => onExpandNode(\n            expandedKeys,\n            info.node.props.nodeKey,\n            info.expanded,\n          )}\n        >\n          {renderTreeNodes(processedSets.tree, true, [], theme)}\n        </Tree>\n        <Tree\n          draggable /* TODO */\n          checkable={checkable}\n\n          checkedKeys={additionalSetSelectionKeys}\n          expandedKeys={additionalSetExpansionKeys}\n          autoExpandParent={autoExpandParent}\n\n          onCheck={(checkedKeys, info) => onCheckNode(\n            info.node.props.nodeKey,\n            info.checked,\n          )}\n          onExpand={(expandedKeys, info) => onExpandNode(\n            expandedKeys,\n            info.node.props.nodeKey,\n            info.expanded,\n          )}\n          onDrop={(info) => {\n            const { eventKey: dropKey } = info.node.props;\n            const { eventKey: dragKey } = info.dragNode.props;\n            const { dropToGap, dropPosition } = info;\n            onDropNode(dropKey, dragKey, dropPosition, dropToGap);\n          }}\n        >\n          {renderTreeNodes(processedAdditionalSets.tree, false, [], theme)}\n        </Tree>\n\n        <PlusButton\n          datatype={datatype}\n          onError={onError}\n          onImportTree={onImportTree}\n          onCreateLevelZeroNode={onCreateLevelZeroNode}\n          importable={importable}\n          editable={editable}\n        />\n      </div>\n      {isChecking ? (\n        <div className=\"set-operation-buttons\">\n          <SetOperationButtons\n            onUnion={onUnion}\n            onIntersection={onIntersection}\n            onComplement={onComplement}\n            operatable={operatable}\n\n            hasCheckedSetsToUnion={hasCheckedSetsToUnion}\n            hasCheckedSetsToIntersect={hasCheckedSetsToIntersect}\n            hasCheckedSetsToComplement={hasCheckedSetsToComplement}\n          />\n        </div>\n      ) : null}\n    </div>\n  );\n}\n", "import React from 'react';\nimport RcTree from 'rc-tree';\nimport classNames from 'classnames';\n\n/**\n * A helper component around the rc-tree\n * library's tree component, to set\n * default props.\n */\nconst Tree = React.forwardRef((props, ref) => {\n  const {\n    prefixCls,\n    className,\n    showIcon,\n    blockNode,\n    children,\n    checkable,\n  } = props;\n  return (\n    <RcTree\n      itemHeight={32}\n      ref={ref}\n      {...props}\n      className={classNames(className, {\n        [`${prefixCls}-icon-hide`]: !showIcon,\n        [`${prefixCls}-block-node`]: blockNode,\n      })}\n      checkable={checkable ? <span className={`${prefixCls}-checkbox-inner`} /> : checkable}\n    >\n      {children}\n    </RcTree>\n  );\n});\n\nTree.defaultProps = {\n  virtual: false,\n  checkable: false,\n  showIcon: false,\n  blockNode: true,\n  prefixCls: 'rc-tree',\n};\n\nexport default Tree;\n", "import React, { useState } from 'react';\nimport clsx from 'clsx';\nimport { TreeNode as RcTreeNode } from 'rc-tree';\nimport { getDataAndAria } from 'rc-tree/es/util';\nimport classNames from 'classnames';\nimport range from 'lodash/range';\nimport isEqual from 'lodash/isEqual';\nimport PopoverMenu from './PopoverMenu';\nimport HelpTooltip from './HelpTooltip';\nimport { callbackOnKeyPress, colorArrayToString, getLevelTooltipText } from './utils';\nimport { ReactComponent as MenuSVG } from '../../assets/menu.svg';\nimport { getDefaultColor } from '../utils';\n\n\n/**\n * Construct a `menuConfig` array for the PopoverMenu component.\n * @param {object} props The props for the TreeNode component.\n * @returns {object[]} An array of menu items to pass to PopoverMenu.\n */\nfunction makeNodeViewMenuConfig(props) {\n  const {\n    path,\n    level,\n    height,\n    onCheckNode,\n    onNodeRemove,\n    onNodeSetIsEditing,\n    onExportLevelZeroNodeJSON,\n    onExportLevelZeroNodeTabular,\n    onExportSetJSON,\n    checkable,\n    editable,\n    exportable,\n    checked,\n  } = props;\n\n  return [\n    ...(editable ? [\n      {\n        title: 'Rename',\n        handler: () => { onNodeSetIsEditing(path, true); },\n        handlerKey: 'r',\n      },\n      {\n        title: 'Delete',\n        confirm: true,\n        handler: () => { onNodeRemove(path); },\n        handlerKey: 'd',\n      },\n    ] : []),\n    ...(level === 0 && exportable ? [\n      {\n        title: 'Export hierarchy',\n        subtitle: '(to JSON file)',\n        handler: () => { onExportLevelZeroNodeJSON(path); },\n        handlerKey: 'j',\n      },\n      ...(height <= 1 ? [\n        {\n          title: 'Export hierarchy',\n          subtitle: '(to CSV file)',\n          handler: () => { onExportLevelZeroNodeTabular(path); },\n          handlerKey: 't',\n        },\n      ] : []),\n    ] : []),\n    ...(level > 0 ? [\n      ...(checkable ? [\n        {\n          title: (checked ? 'Uncheck' : 'Check'),\n          handler: () => { onCheckNode(path, !checked); },\n          handlerKey: 's',\n        },\n      ] : []),\n      ...(exportable ? [\n        {\n          title: 'Export set',\n          subtitle: '(to JSON file)',\n          handler: () => { onExportSetJSON(path); },\n          handlerKey: 'e',\n        },\n      ] : []),\n    ] : []),\n  ];\n}\n\n/**\n * The \"static\" node component to render when the user is not renaming.\n * @param {object} props The props for the TreeNode component.\n */\nfunction NamedSetNodeStatic(props) {\n  const {\n    title,\n    path,\n    nodeKey,\n    level,\n    height,\n    color,\n    checkbox,\n    isChecking,\n    isLeaf,\n    onNodeSetColor,\n    onNodeView,\n    expanded,\n    onCheckLevel,\n    checkedLevelPath,\n    checkedLevelIndex,\n    disableTooltip,\n    size,\n    datatype,\n    editable,\n    theme,\n  } = props;\n  const shouldCheckNextLevel = (level === 0 && !expanded);\n  const nextLevelToCheck = (\n    (checkedLevelIndex && isEqual(path, checkedLevelPath) && checkedLevelIndex < height)\n      ? checkedLevelIndex + 1\n      : 1\n  );\n  const numberFormatter = new Intl.NumberFormat('en-US');\n  const niceSize = numberFormatter.format(size);\n  let tooltipText;\n  if (shouldCheckNextLevel) {\n    tooltipText = getLevelTooltipText(nextLevelToCheck);\n  } else if (isLeaf || !expanded) {\n    tooltipText = `Color individual set (${niceSize} ${datatype}${(size === 1 ? '' : 's')})`;\n  } else {\n    tooltipText = 'Color by expanded descendants';\n  }\n  // If this is a level zero node and is _not_ expanded, then upon click,\n  // the behavior should be to color by the first or next cluster level.\n  // If this is a level zero node and _is_ expanded, or if any other node,\n  // click should trigger onNodeView.\n  const onClick = (level === 0 && !expanded\n    ? () => onCheckLevel(nodeKey, nextLevelToCheck)\n    : () => onNodeView(path)\n  );\n  const tooltipProps = (disableTooltip ? { visible: false } : {});\n  const popoverMenuConfig = makeNodeViewMenuConfig(props);\n  return (\n    <span>\n      <HelpTooltip title={tooltipText} {...tooltipProps}>\n        <button\n          type=\"button\"\n          onClick={onClick}\n          onKeyPress={e => callbackOnKeyPress(e, 'v', () => onNodeView(path))}\n          className=\"title-button\"\n        >\n          {title}\n        </button>\n      </HelpTooltip>\n      {popoverMenuConfig.length > 0 ? (\n        <PopoverMenu\n          menuConfig={makeNodeViewMenuConfig(props)}\n          color={level > 0 && editable ? (color || getDefaultColor(theme)) : null}\n          setColor={c => onNodeSetColor(path, c)}\n        >\n          <MenuSVG className=\"node-menu-icon\" />\n        </PopoverMenu>\n      ) : null}\n      {level > 0 && isChecking ? checkbox : null}\n      {level > 0 && (<span className=\"node-size-label\">{niceSize}</span>)}\n    </span>\n  );\n}\n\n/**\n * The \"editing\" node component to render when the user is renaming,\n * containing a text input field and a save button.\n * @param {object} props The props for the TreeNode component.\n */\nfunction NamedSetNodeEditing(props) {\n  const {\n    title,\n    path,\n    onNodeSetName,\n    onNodeCheckNewName,\n  } = props;\n  const [currentTitle, setCurrentTitle] = useState(title);\n\n  // Do not allow the user to save a potential name if it conflicts with\n  // another name in the hierarchy.\n  const hasConflicts = onNodeCheckNewName(path, currentTitle);\n  function trySetName() {\n    if (!hasConflicts) {\n      onNodeSetName(path, currentTitle, true);\n    }\n  }\n  return (\n    <span className=\"title-button-with-input\">\n      <input\n        // eslint-disable-next-line jsx-a11y/no-autofocus\n        autoFocus\n        className=\"title-input\"\n        type=\"text\"\n        value={currentTitle}\n        onChange={(e) => { setCurrentTitle(e.target.value); }}\n        onKeyPress={e => callbackOnKeyPress(\n          e,\n          'Enter',\n          trySetName,\n        )}\n        onFocus={e => e.target.select()}\n      />\n      {!hasConflicts && (\n        <button\n          type=\"button\"\n          className=\"title-save-button\"\n          onClick={trySetName}\n        >\n          Save\n        </button>\n      )}\n    </span>\n  );\n}\n\n/**\n * A \"delegation\" component, to decide whether to render\n * an \"editing\" vs. \"static\" node component.\n * @param {object} props The props for the TreeNode component.\n */\nfunction NamedSetNode(props) {\n  const {\n    isEditing,\n    isCurrentSet,\n  } = props;\n  return (\n    (isEditing || isCurrentSet)\n      ? (<NamedSetNodeEditing {...props} />)\n      : (<NamedSetNodeStatic {...props} />)\n  );\n}\n\n/**\n * Buttons for viewing each hierarchy level,\n * rendered below collapsed level zero nodes.\n * @param {object} props The props for the (level zero) TreeNode component.\n */\nfunction LevelsButtons(props) {\n  const {\n    nodeKey,\n    path,\n    height,\n    onCheckLevel,\n    checkedLevelPath,\n    checkedLevelIndex,\n    hasColorEncoding,\n  } = props;\n  function onCheck(event) {\n    if (event.target.checked) {\n      const newLevel = parseInt(event.target.value, 10);\n      onCheckLevel(nodeKey, newLevel);\n    }\n  }\n  return (\n    <div className=\"level-buttons-container\">\n      {range(1, height + 1).map((i) => {\n        const isChecked = isEqual(path, checkedLevelPath) && i === checkedLevelIndex;\n        return (\n          <div className=\"level-buttons\" key={i}>\n            <HelpTooltip title={getLevelTooltipText(i)}>\n              <input\n                className={clsx('level-radio-button', { checked: isChecked && !hasColorEncoding })}\n                type=\"checkbox\"\n                value={i}\n                checked={isChecked && hasColorEncoding}\n                onChange={onCheck}\n              />\n            </HelpTooltip>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\n/**\n * Render the \"switcher\" icon.\n * Arrow for collapsed/expanded non-leaf nodes,\n * or square for leaf nodes.\n * @param {object} props The props for the TreeNode component.\n */\nfunction SwitcherIcon(props) {\n  const {\n    isLeaf, isOpen, color,\n  } = props;\n  const hexColor = (color ? colorArrayToString(color) : undefined);\n  if (isLeaf) {\n    return (\n      <i\n        className=\"anticon anticon-circle rc-tree-switcher-icon\"\n      >\n        <svg\n          viewBox=\"0 0 1024 1024\"\n          focusable=\"false\"\n          data-icon=\"caret-down\"\n          width=\"1em\"\n          height=\"1em\"\n          aria-hidden=\"true\"\n        >\n          <rect fill={hexColor} x={600 / 2} y={600 / 2} width={1024 - 600} height={1024 - 600} />\n        </svg>\n      </i>\n    );\n  }\n  return (\n    <i\n      className=\"anticon anticon-caret-down rc-tree-switcher-icon\"\n    >\n      <svg\n        viewBox=\"0 0 1024 1024\"\n        focusable=\"false\"\n        data-icon=\"caret-down\"\n        width=\"1em\"\n        height=\"1em\"\n        aria-hidden=\"true\"\n      >\n        <path\n          fill={(isOpen ? '#444' : hexColor)}\n          d=\"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z\"\n        />\n      </svg>\n    </i>\n  );\n}\n\n/**\n * A custom TreeNode component.\n * @extends {RcTreeNode} TreeNode from the rc-tree library.\n */\nexport default class TreeNode extends RcTreeNode {\n  /**\n   * Override the main node text elements.\n   */\n  renderSelector = () => {\n    const {\n      title,\n      isCurrentSet,\n      isSelected,\n      isEditing,\n      onDragStart: onDragStartProp,\n    } = this.props;\n    const {\n      rcTree: {\n        prefixCls: prefixClass,\n        draggable,\n      },\n    } = this.context;\n\n    const onDragStart = (e) => {\n      onDragStartProp();\n      this.onDragStart(e);\n    };\n\n    const wrapClass = `${prefixClass}-node-content-wrapper`;\n    const isDraggable = (!isCurrentSet && !isEditing && draggable);\n    return (\n      <span\n        ref={this.setSelectHandle}\n        title={title}\n        className={classNames(\n          wrapClass,\n          `${wrapClass}-${this.getNodeState() || 'normal'}`,\n          isSelected && `${prefixClass}-node-selected`,\n          isDraggable && 'draggable',\n        )}\n        draggable={isDraggable}\n        aria-grabbed={isDraggable}\n        onDragStart={isDraggable ? onDragStart : undefined}\n      >\n        <NamedSetNode\n          {...this.props}\n          prefixClass={prefixClass}\n          checkbox={this.renderCheckbox()}\n        />\n        {this.renderLevels()}\n      </span>\n    );\n  };\n\n  /**\n   * Render the LevelsButtons component if this node\n   * is a collapsed level zero node.\n   */\n  renderLevels = () => {\n    const { level, expanded } = this.props;\n    if (level !== 0 || expanded) {\n      return null;\n    }\n    return (\n      <LevelsButtons\n        {...this.props}\n      />\n    );\n  }\n\n  /**\n   * Override the switcher element.\n   */\n  renderSwitcher = () => {\n    const { expanded, isLeaf, color } = this.props;\n    const {\n      rcTree: {\n        prefixCls: prefixClass,\n        onNodeExpand,\n      },\n    } = this.context;\n\n    const onNodeExpandWrapper = (e) => {\n      // Do not call onNodeExpand if the node is a leaf node.\n      if (!isLeaf) {\n        onNodeExpand(e, this);\n      }\n    };\n\n    const switcherClass = classNames(\n      `${prefixClass}-switcher`,\n      { [`${prefixClass}-switcher_${(expanded ? 'open' : 'close')}`]: !isLeaf },\n    );\n    return (\n      <span\n        className={switcherClass}\n        onClick={onNodeExpandWrapper}\n        onKeyPress={e => callbackOnKeyPress(e, 'd', onNodeExpandWrapper)}\n        role=\"button\"\n        tabIndex=\"0\"\n      >\n        <SwitcherIcon\n          isLeaf={isLeaf}\n          isOpen={expanded}\n          color={color}\n        />\n      </span>\n    );\n  };\n\n  /**\n   * Override main render function,\n   * to enable overriding the sub-render functions\n   * for switcher, selector, etc.\n   */\n  render() {\n    const {\n      style, loading, level,\n      dragOver, dragOverGapTop, dragOverGapBottom,\n      isLeaf,\n      expanded, selected, checked, halfChecked,\n      onDragEnd: onDragEndProp,\n      expandable,\n      ...otherProps\n    } = this.props;\n    const {\n      rcTree: {\n        prefixCls: prefixClass,\n        filterTreeNode,\n        draggable,\n      },\n    } = this.context;\n    const disabled = this.isDisabled();\n    const dataAndAriaAttributeProps = getDataAndAria(otherProps);\n\n    const onDragEnd = (e) => {\n      onDragEndProp();\n      this.onDragEnd(e);\n    };\n\n    return (\n      <li\n        className={classNames('rc-tree-treenode', `level-${level}-treenode`, {\n          [`${prefixClass}-treenode-disabled`]: disabled,\n          [`${prefixClass}-treenode-switcher-${expanded ? 'open' : 'close'}`]: !isLeaf,\n          [`${prefixClass}-treenode-checkbox-checked`]: checked,\n          [`${prefixClass}-treenode-checkbox-indeterminate`]: halfChecked,\n          [`${prefixClass}-treenode-selected`]: selected,\n          [`${prefixClass}-treenode-loading`]: loading,\n\n          'drag-over': !disabled && dragOver,\n          'drag-over-gap-top': !disabled && dragOverGapTop,\n          'drag-over-gap-bottom': !disabled && dragOverGapBottom,\n          'filter-node': filterTreeNode && filterTreeNode(this),\n        })}\n        style={style}\n        role=\"treeitem\"\n        onDragEnter={draggable ? this.onDragEnter : undefined}\n        onDragOver={draggable ? this.onDragOver : undefined}\n        onDragLeave={draggable ? this.onDragLeave : undefined}\n        onDrop={draggable ? this.onDrop.bind(this) : undefined}\n        onDragEnd={draggable ? onDragEnd : undefined}\n        {...dataAndAriaAttributeProps}\n      >\n        {expandable ? this.renderSwitcher() : null}\n        {this.renderSelector()}\n        {this.renderChildren()}\n      </li>\n    );\n  }\n}\n", "import React, { useState, useEffect } from 'react';\nimport { TwitterPicker } from 'react-color';\nimport { colorArrayToString, callbackOnKeyPress } from './utils';\nimport { PALETTE } from '../utils';\nimport Popover from './Popover';\n\n/**\n * Wrapper around a button element that supports asking for confirmation.\n * @param {object} props\n * @param {string} props.title The main button text.\n * @param {string} props.subtitle Smaller text on a line beneath the main text. Optional.\n * @param {function} props.onClick A \"clean up\" handler passed from the parent,\n * to alert the parent Popover component that it should close the popover after the button has\n * fired its handler.\n * @param {function} props.handler A function to call on button click (or after confirmation).\n * @param {string} props.handlerKey A key associated with the button, to support accessibility.\n * @param {boolean} props.confirm Does the user need to press the button again to confirm?\n * By default, false.\n * @param {boolean} props.visible The visibility state from the parent popover,\n * so that on visibility change, the button can clear its confirmation state.\n */\nfunction PopoverMenuListButton(props) {\n  const {\n    title, subtitle, onClick, handler, handlerKey, confirm,\n    visible,\n  } = props;\n\n  const [isConfirming, setIsConfirming] = useState(false);\n\n  useEffect(() => {\n    // Want to clear the \"confirming\",\n    // state if the user hides the popover.\n    setIsConfirming(false);\n  }, [visible]);\n\n  function handleOrRequireConfirm() {\n    if (!confirm || isConfirming) {\n      onClick();\n      handler();\n    } else {\n      setIsConfirming(true);\n    }\n  }\n\n  const titleWithConfirm = `${isConfirming ? 'Confirm ' : ''}${title}`;\n\n  return (\n    <button\n      title={titleWithConfirm}\n      type=\"button\"\n      onClick={handleOrRequireConfirm}\n      onKeyPress={e => callbackOnKeyPress(e, handlerKey, handleOrRequireConfirm)}\n    >{titleWithConfirm}\n      {subtitle && (<><br /><span className=\"small\">{subtitle}</span></>)}\n    </button>\n  );\n}\n\n/**\n * Helper component to create a list of buttons for the body of a popover.\n * If the color, setColor, and palette props are provided then a color picker\n * will be rendered at the top of the button list.\n * @param {object} props\n * @param {object[]} props.menuConfig The list of button definition objects.\n * `{ title, subtitle, confirm, handler, handlerKey }`\n * @param {function} props.onClick A \"clean up\" handler passed from the parent,\n * to alert the parent Popover component that it should close the popover after the button has\n * fired its handler.\n * @param {number[]} props.color The current color. Optional.\n * @param {string} props.palette The color palette for the color picker. Optional.\n * @param {boolean} props.setColor The handler to call when a color has been selected. Optional.\n * @param {boolean} props.visible The visibility state from the parent popover,\n * so that on visibility change, buttons can clear confirmation states.\n */\nfunction PopoverMenuList(props) {\n  const {\n    menuConfig,\n    onClick,\n    color = null,\n    palette = null,\n    setColor = null,\n    visible,\n  } = props;\n\n  function handleColorChange({ rgb }) {\n    if (rgb && setColor) {\n      setColor([rgb.r, rgb.g, rgb.b]);\n    }\n  }\n\n  const defaultPalette = palette\n    ? palette.map(colorArrayToString)\n    : PALETTE.concat([[255, 255, 255], [128, 128, 128], [0, 0, 0]]).map(colorArrayToString);\n\n  return (\n    <div>\n      {color && setColor && defaultPalette && (\n        <TwitterPicker\n          className=\"popover-menu-color\"\n          disableAlpha\n          width={108}\n          triangle=\"hide\"\n          colors={defaultPalette}\n          color={colorArrayToString(color)}\n          onChangeComplete={handleColorChange}\n        />\n      )}\n      <ul className=\"popover-menu-list\">\n        {menuConfig.map(item => (\n          <li key={item.title + item.subtitle}>\n            <PopoverMenuListButton\n              {...item}\n              onClick={onClick}\n              visible={visible}\n            />\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n\n/**\n * Helper component to create a popover component with a list of buttons.\n * If the color, setColor, and palette props are provided then a color picker\n * will be rendered at the top of the button list.\n * @param {object} props\n * @param {object[]} props.menuConfig The list of button definition objects.\n * `{ title, subtitle, confirm, handler, handlerKey }`\n * @param {string} placement Where to place the popover (top, bottom, left, right).\n * @param {number[]} props.color The current color. Optional.\n * @param {string} props.palette The color palette for the color picker. Optional.\n * @param {boolean} props.setColor The handler to call when a color has been selected. Optional.\n * @param {Element|React.Component} props.children Children to render,\n * which will trigger the popover on click.\n */\nexport default function PopoverMenu(props) {\n  const {\n    menuConfig, placement, children,\n    color = null, setColor = null, palette = null,\n  } = props;\n\n  const [visible, setVisible] = useState(false);\n\n  return (\n    <Popover\n      content={(\n        <PopoverMenuList\n          menuConfig={menuConfig}\n          onClick={() => setVisible(false)}\n          color={color}\n          setColor={setColor}\n          palette={palette}\n          visible={visible}\n        />\n)}\n      placement={placement}\n      visible={visible}\n      onVisibleChange={setVisible}\n    >\n      {children}\n    </Popover>\n  );\n}\n", "import React from 'react';\nimport HelpTooltip from './HelpTooltip';\n\n/**\n * This is a wrapper around the HelpTooltip component, to style it as a popover,\n * and change the trigger to \"click\" rather than \"hover\".\n * @param {*} props Props are passed through to the HelpTooltip component.\n */\nexport default function Popover(props) {\n  return (\n    <HelpTooltip {...props} />\n  );\n}\n\nPopover.defaultProps = {\n  overlayClassName: 'popover',\n  placement: 'top',\n  trigger: 'click',\n  mouseEnterDelay: 0,\n  mouseLeaveDelay: 0,\n};\n", "import React, { useRef } from 'react';\nimport RcTooltip from 'rc-tooltip';\nimport { useVitessceContainer } from '../hooks';\n\n/**\n * This is a small wrapper around the Tooltip component from the rc-tooltip library,\n * which is required to be able to apply theme styles to the tooltip.\n * The default `getTooltipContainer` function used by rc-tooltip\n * just returns `document.body` (see https://github.com/react-component/tooltip#props),\n * We want theme styles to be applied relative to the closest `.vitessce-container`\n * ancestor element.\n * https://github.com/vitessce/vitessce/pull/494#discussion_r395957914\n * @param {object} props Props are passed through to the <RcTooltip/> from the library.\n */\nexport default function HelpTooltip(props) {\n  const { title, content, overlayClassName } = props;\n  const spanRef = useRef();\n  const getTooltipContainer = useVitessceContainer(spanRef);\n\n  const overlay = title || content;\n\n  return (\n    <>\n      <span ref={spanRef} />\n      <RcTooltip\n        getTooltipContainer={getTooltipContainer}\n        overlayClassName={overlayClassName}\n        overlay={overlay}\n        {...props}\n      />\n    </>\n  );\n}\n\nHelpTooltip.defaultProps = {\n  overlayClassName: 'help-tooltip',\n  placement: 'top',\n  trigger: 'hover',\n  mouseEnterDelay: 0.2,\n  mouseLeaveDelay: 0,\n};\n", "import * as React from \"react\";\n\nfunction SvgMenu(props) {\n  return <svg width={24} height={24} viewBox=\"0 0 24 24\" {...props}><path d=\"M12 18c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3z\" /></svg>;\n}\n\nexport const ReactComponent = SvgMenu;", "import React, { useCallback } from 'react';\nimport PopoverMenu from './PopoverMenu';\nimport {\n  handleImportJSON,\n  handleImportTabular,\n} from './io';\nimport {\n  MIME_TYPE_JSON,\n  MIME_TYPE_TABULAR,\n} from './constants';\n\nimport { ReactComponent as SetUnionSVG } from '../../assets/sets/union.svg';\nimport { ReactComponent as SetIntersectionSVG } from '../../assets/sets/intersection.svg';\nimport { ReactComponent as SetComplementSVG } from '../../assets/sets/complement.svg';\n\n/**\n * A plus button for creating or importing set hierarchies.\n * @param {object} props\n * @param {string} props.datatype The data type to validate imported hierarchies against.\n * @param {function} props.onError A callback to pass error message strings.\n * @param {function} props.onImportTree A callback to pass successfully-validated tree objects.\n * @param {function} props.onCreateLevelZeroNode A callback to create a new empty\n * level zero node.\n * @param {boolean} props.importable Is importing allowed?\n * If not, the import button will not be rendered.\n * @param {boolean} props.editable Is editing allowed?\n * If not, the create button will not be rendered.\n */\nexport function PlusButton(props) {\n  const {\n    datatype, onError, onImportTree, onCreateLevelZeroNode,\n    importable, editable,\n  } = props;\n\n  /**\n   * Import a file, then process the imported data via the supplied handler function.\n   * @param {Function} importHandler The function to process the imported data.\n   * @param {string} mimeType The accepted mime type for the file upload input.\n   * @returns {Function} An import function corresponding to the supplied parameters.\n   */\n  const onImport = useCallback((importHandler, mimeType) => () => {\n    const uploadInputNode = document.createElement('input');\n    uploadInputNode.setAttribute('type', 'file');\n    uploadInputNode.setAttribute('accept', mimeType);\n    document.body.appendChild(uploadInputNode); // required for firefox\n    uploadInputNode.click();\n    uploadInputNode.addEventListener('change', (event) => {\n      if (!(window.File && window.FileReader && window.FileList && window.Blob)) {\n        onError('Local file reading APIs are not fully supported in this browser.');\n        return;\n      }\n      const { files } = event.target;\n      if (!files || files.length !== 1) {\n        onError('Incorrect number of files selected.');\n        return;\n      }\n      const reader = new FileReader();\n      reader.addEventListener('load', () => {\n        const { result } = reader;\n        try {\n          const treeToImport = importHandler(result, datatype);\n          onError(false); // Clear any previous import error.\n          onImportTree(treeToImport);\n        } catch (e) {\n          onError(e.message);\n        }\n      }, false);\n      reader.readAsText(files[0]);\n    });\n    uploadInputNode.remove();\n  }, [datatype, onError, onImportTree]);\n\n  const menuConfig = [\n    ...(editable ? [\n      {\n        title: 'Create hierarchy',\n        handler: onCreateLevelZeroNode,\n        handlerKey: 'n',\n      },\n    ] : []),\n    ...(importable ? [\n      {\n        title: 'Import hierarchy',\n        subtitle: '(from CSV file)',\n        handler: onImport(handleImportTabular, MIME_TYPE_TABULAR),\n        handlerKey: 'c',\n      },\n      {\n        title: 'Import hierarchy',\n        subtitle: '(from JSON file)',\n        handler: onImport(handleImportJSON, MIME_TYPE_JSON),\n        handlerKey: 'j',\n      },\n    ] : []),\n  ];\n\n  return (menuConfig.length > 0 ? (\n    <PopoverMenu\n      menuConfig={menuConfig}\n    >\n      <button className=\"plus-button\" type=\"submit\">+</button>\n    </PopoverMenu>\n  ) : null);\n}\n\n/**\n * Set operations buttons (union, intersection, complement)\n * and a view checked sets button.\n * @param {object} props\n * @param {function} props.onUnion A callback for the union button.\n * @param {function} props.onIntersection A callback for the intersection button.\n * @param {function} props.onComplement A callback for the complement button.\n * @param {boolean} props.operatable Are set operations allowed?\n * If not, the union, intersection, and complement buttons will not be rendered.\n */\nexport function SetOperationButtons(props) {\n  const {\n    onUnion,\n    onIntersection,\n    onComplement,\n    operatable,\n    hasCheckedSetsToUnion,\n    hasCheckedSetsToIntersect,\n    hasCheckedSetsToComplement,\n  } = props;\n\n  return (\n    <>\n      {operatable && (\n        <>\n          <button\n            onClick={onUnion}\n            title=\"New set from union of checked sets\"\n            type=\"submit\"\n            disabled={!hasCheckedSetsToUnion}\n          >\n            <SetUnionSVG />\n          </button>\n          <button\n            onClick={onIntersection}\n            title=\"New set from intersection of checked sets\"\n            type=\"submit\"\n            disabled={!hasCheckedSetsToIntersect}\n          >\n            <SetIntersectionSVG />\n          </button>\n          <button\n            onClick={onComplement}\n            title=\"New set from complement of checked sets\"\n            type=\"submit\"\n            disabled={!hasCheckedSetsToComplement}\n          >\n            <SetComplementSVG />\n          </button>\n        </>\n      )}\n    </>\n  );\n}\n", "import * as React from \"react\";\n\nfunction SvgUnion(props) {\n  return <svg viewBox=\"0 0 16.433999 10.234\" height={12} width={18} {...props}><g transform=\"translate(0.117,-2.883)\"><path d=\"m 11.467471,11.811278 c 0.198237,-0.322177 0.508,-1.011333 0.653661,-1.454255 0.659343,-2.0049141 0.44323,-4.2620847 -0.577734,-6.0340822 l -0.168844,-0.2930481 0.105744,0.017887 c 0.759902,0.1285441 1.368762,0.3699553 1.856675,0.7361658 1.988296,1.4923476 2.192477,4.3353549 0.434717,6.0529895 -0.641216,0.626581 -1.299647,0.94683 -2.294136,1.115833 l -0.108488,0.01844 z M 4.3162122,11.919169 C 1.9278944,11.487872 0.46692382,9.0323123 1.234873,6.7401372 1.5621727,5.763213 2.2610593,4.9489746 3.1840041,4.4693005 3.5978035,4.2542401 3.9427842,4.145371 4.5197023,4.0477802 L 4.6254464,4.0298927 4.4571836,4.3223069 C 3.4332707,6.1017061 3.2180432,8.3476022 3.878868,10.357023 c 0.1458466,0.443487 0.4554716,1.132155 0.6542959,1.455285 0.054471,0.08853 0.087814,0.159599 0.074096,0.157937 -0.013718,-0.0017 -0.1446898,-0.02465 -0.2910477,-0.05108 z M 5.0000001,3 C 2.2,3 0,5.2 0,8 c 0,2.8 2.2,5 5.0000001,5 0.6,0 1.1,-0.1 1.6,-0.3 C 5.3000001,11.6 4.5,9.7999998 4.5,8 4.5,6.2 5.3000001,4.5 6.6000001,3.3 c -0.5,-0.2 -1,-0.3 -1.6,-0.3 z M 4.65,4.02 C 3.92,5.17 3.51,6.54 3.51,8 c 0,1.4599998 0.42,2.83 1.14,3.98 C 2.61,11.8 1.01,10.08 1.01,8 1.01,5.92 2.61,4.2 4.65,4.02 Z M 8,4 C 6.8,4.9 6,6.4 6,8 6,9.6 6.8,11.1 8,12 9.2,11.1 10,9.7 10,8 10,6.3 9.2,4.9 8,4 Z m 3,-1 c 2.8,0 5,2.2 5,5 0,2.8 -2.2,5 -5,5 C 10.4,13 9.9,12.9 9.4,12.7 10.7,11.6 11.5,9.8 11.5,8 11.5,6.2 10.7,4.5 9.4,3.3 9.9,3.1 10.4,3 11,3 Z m 0.35,1.02 c 0.73,1.15 1.14,2.52 1.14,3.98 0,1.46 -0.42,2.83 -1.14,3.98 2.04,-0.18 3.64,-1.9 3.64,-3.98 0,-2.08 -1.6,-3.8 -3.64,-3.98 z\" style={{\n        strokeWidth: 0.234,\n        strokeMiterlimit: 4,\n        strokeDasharray: \"none\",\n        strokeOpacity: 1\n      }} /></g></svg>;\n}\n\nexport const ReactComponent = SvgUnion;", "import * as React from \"react\";\n\nfunction SvgIntersection(props) {\n  return <svg width={18} height={12} viewBox=\"0 0 16 10\" {...props}><g transform=\"translate(0,-3)\"><path d=\"M 5.0000001,3 C 2.2,3 0,5.2 0,8 c 0,2.8 2.2,5 5.0000001,5 0.6,0 1.1,-0.1 1.6,-0.3 C 5.3000001,11.6 4.5,9.7999998 4.5,8 4.5,6.2 5.3000001,4.5 6.6000001,3.3 c -0.5,-0.2 -1,-0.3 -1.6,-0.3 z M 4.65,4.02 C 3.92,5.17 3.51,6.54 3.51,8 c 0,1.4599998 0.42,2.83 1.14,3.98 C 2.61,11.8 1.01,10.08 1.01,8 1.01,5.92 2.61,4.2 4.65,4.02 Z M 8,4 C 6.8,4.9 6,6.4 6,8 6,9.6 6.8,11.1 8,12 9.2,11.1 10,9.7 10,8 10,6.3 9.2,4.9 8,4 Z m 3,-1 c 2.8,0 5,2.2 5,5 0,2.8 -2.2,5 -5,5 C 10.4,13 9.9,12.9 9.4,12.7 10.7,11.6 11.5,9.8 11.5,8 11.5,6.2 10.7,4.5 9.4,3.3 9.9,3.1 10.4,3 11,3 Z m 0.35,1.02 c 0.73,1.15 1.14,2.52 1.14,3.98 0,1.46 -0.42,2.83 -1.14,3.98 2.04,-0.18 3.64,-1.9 3.64,-3.98 0,-2.08 -1.6,-3.8 -3.64,-3.98 z\" style={{\n        strokeWidth: 0.234,\n        strokeMiterlimit: 4,\n        strokeDasharray: \"none\",\n        strokeOpacity: 1\n      }} /></g></svg>;\n}\n\nexport const ReactComponent = SvgIntersection;", "import * as React from \"react\";\n\nfunction SvgComplement(props) {\n  return <svg id=\"svg14\" viewBox=\"0 0 25.3804963846 16\" height={16} width={25.3804963846} {...props}><defs><mask id=\"union-mask\" x={0} y={0} width={25.3804963846} height={16}><rect x=\"5%\" width=\"90%\" height=\"100%\" fill=\"white\" /><g transform=\"translate(4.69,0)\"><path d=\"m 11.467471,11.811278 c 0.198237,-0.322177 0.508,-1.011333 0.653661,-1.454255 0.659343,-2.0049141 0.44323,-4.2620847 -0.577734,-6.0340822 l -0.168844,-0.2930481 0.105744,0.017887 c 0.759902,0.1285441 1.368762,0.3699553 1.856675,0.7361658 1.988296,1.4923476 2.192477,4.3353549 0.434717,6.0529895 -0.641216,0.626581 -1.299647,0.94683 -2.294136,1.115833 l -0.108488,0.01844 z M 4.3162122,11.919169 C 1.9278944,11.487872 0.46692382,9.0323123 1.234873,6.7401372 1.5621727,5.763213 2.2610593,4.9489746 3.1840041,4.4693005 3.5978035,4.2542401 3.9427842,4.145371 4.5197023,4.0477802 L 4.6254464,4.0298927 4.4571836,4.3223069 C 3.4332707,6.1017061 3.2180432,8.3476022 3.878868,10.357023 c 0.1458466,0.443487 0.4554716,1.132155 0.6542959,1.455285 0.054471,0.08853 0.087814,0.159599 0.074096,0.157937 -0.013718,-0.0017 -0.1446898,-0.02465 -0.2910477,-0.05108 z M 5.0000001,3 C 2.2,3 0,5.2 0,8 c 0,2.8 2.2,5 5.0000001,5 0.6,0 1.1,-0.1 1.6,-0.3 C 5.3000001,11.6 4.5,9.7999998 4.5,8 4.5,6.2 5.3000001,4.5 6.6000001,3.3 c -0.5,-0.2 -1,-0.3 -1.6,-0.3 z M 4.65,4.02 C 3.92,5.17 3.51,6.54 3.51,8 c 0,1.4599998 0.42,2.83 1.14,3.98 C 2.61,11.8 1.01,10.08 1.01,8 1.01,5.92 2.61,4.2 4.65,4.02 Z M 8,4 C 6.8,4.9 6,6.4 6,8 6,9.6 6.8,11.1 8,12 9.2,11.1 10,9.7 10,8 10,6.3 9.2,4.9 8,4 Z m 3,-1 c 2.8,0 5,2.2 5,5 0,2.8 -2.2,5 -5,5 C 10.4,13 9.9,12.9 9.4,12.7 10.7,11.6 11.5,9.8 11.5,8 11.5,6.2 10.7,4.5 9.4,3.3 9.9,3.1 10.4,3 11,3 Z m 0.35,1.02 c 0.73,1.15 1.14,2.52 1.14,3.98 0,1.46 -0.42,2.83 -1.14,3.98 2.04,-0.18 3.64,-1.9 3.64,-3.98 0,-2.08 -1.6,-3.8 -3.64,-3.98 z\" style={{\n            strokeWidth: 0.234,\n            strokeMiterlimit: 4,\n            strokeDasharray: \"none\",\n            strokeOpacity: 1\n          }} fill=\"black\" /></g></mask></defs><g><rect x={0} y={0} width={25.3804963846} height={16} mask=\"url(#union-mask)\" /></g></svg>;\n}\n\nexport const ReactComponent = SvgComplement;", "/* eslint-disable dot-notation */\nimport React, {\n  useEffect, useCallback, useRef, forwardRef,\n} from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport TitleInfo from '../TitleInfo';\nimport RasterChannelController from './RasterChannelController';\nimport BitmaskChannelController from './BitmaskChannelController';\nimport VectorLayerController from './VectorLayerController';\nimport LayerController from './LayerController';\nimport ImageAddButton from './ImageAddButton';\nimport { useReady, useClosestVitessceContainerSize, useWindowDimensions } from '../hooks';\nimport { useCellsData, useMoleculesData, useRasterData } from '../data-hooks';\nimport {\n  useCoordination,\n  useLoaders,\n  useAuxiliaryCoordination,\n  useComponentLayout,\n} from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport { initializeLayerChannels } from '../spatial/utils';\nimport { DEFAULT_RASTER_LAYER_PROPS } from '../spatial/constants';\n\nconst LAYER_CONTROLLER_DATA_TYPES = ['raster'];\n\n// LayerController is memoized to prevent updates from prop changes that\n// are caused by view state updates i.e zooming and panning within\n// the actual Spatial component.  Re-rendering this component is very\n// expensive so we have to be careful with props in this file in general.\nconst LayerControllerMemoized = React.memo(\n  forwardRef((props, ref) => {\n    const {\n      title,\n      removeGridComponent,\n      theme,\n      isReady,\n      moleculesLayer,\n      dataset,\n      setMoleculesLayer,\n      cellsLayer,\n      canShowCellVecmask,\n      setCellsLayer,\n      rasterLayers,\n      imageLayerLoaders,\n      imageLayerMeta,\n      rasterLayersCallbacks,\n      setRasterLayersCallbacks,\n      areLoadingRasterChannnels,\n      setAreLoadingRasterChannnels,\n      handleRasterLayerChange,\n      handleRasterLayerRemove,\n      disable3d,\n      globalDisable3d,\n      disableChannelsIfRgbDetected,\n      layerIs3DIndex,\n      setZoom,\n      setTargetX,\n      setTargetY,\n      setTargetZ,\n      setRotationX,\n      setRotationOrbit,\n      componentHeight,\n      componentWidth,\n      spatialLayout,\n      handleImageAdd,\n      enableLayerButtonsWithOneLayer,\n    } = props;\n    const shouldShowImageLayerButton = Boolean(\n      enableLayerButtonsWithOneLayer || imageLayerLoaders?.length > 1,\n    );\n    return (\n      <TitleInfo\n        title={title}\n        isScroll\n        removeGridComponent={removeGridComponent}\n        theme={theme}\n        isReady={isReady}\n      >\n        <div className=\"layer-controller-container\" ref={ref}>\n          {moleculesLayer && (\n            <VectorLayerController\n              key={`${dataset}-molecules`}\n              label=\"Molecules\"\n              layerType=\"molecules\"\n              layer={moleculesLayer}\n              handleLayerChange={setMoleculesLayer}\n            />\n          )}\n          {cellsLayer && canShowCellVecmask && (\n            <VectorLayerController\n              key={`${dataset}-cells`}\n              label=\"Cell Segmentations\"\n              layerType=\"cells\"\n              layer={cellsLayer}\n              handleLayerChange={setCellsLayer}\n            />\n          )}\n          {rasterLayers\n            && rasterLayers.map((layer, i) => {\n              const { index } = layer;\n              const loader = imageLayerLoaders[index];\n              const layerMeta = imageLayerMeta[index];\n              // Could also be bitmask at the moment.\n              const isRaster = !layerMeta?.metadata?.isBitmask;\n              const ChannelController = isRaster\n                ? RasterChannelController\n                : BitmaskChannelController;\n              // Set up the call back mechanism so that each layer manages\n              // callbacks/loading state for itself and its channels.\n              const setRasterLayerCallback = (cb) => {\n                const newRasterLayersCallbacks = [\n                  ...(rasterLayersCallbacks || []),\n                ];\n                newRasterLayersCallbacks[i] = cb;\n                setRasterLayersCallbacks(newRasterLayersCallbacks);\n              };\n              const areLayerChannelsLoading = (areLoadingRasterChannnels || [])[i] || [];\n              const setAreLayerChannelsLoading = (v) => {\n                const newAreLoadingRasterChannnels = [\n                  ...(areLoadingRasterChannnels || []),\n                ];\n                newAreLoadingRasterChannnels[i] = v;\n                setAreLoadingRasterChannnels(newAreLoadingRasterChannnels);\n              };\n              return loader && layerMeta ? (\n                <Grid\n                  // eslint-disable-next-line react/no-array-index-key\n                  key={`${dataset}-raster-${index}-${i}`}\n                  item\n                  style={{ marginTop: '10px' }}\n                >\n                  <LayerController\n                    name={layerMeta.name}\n                    layer={layer}\n                    loader={loader}\n                    theme={theme}\n                    handleLayerChange={v => handleRasterLayerChange(v, i)}\n                    handleLayerRemove={() => handleRasterLayerRemove(i)}\n                    ChannelController={ChannelController}\n                    shouldShowTransparentColor={isRaster}\n                    shouldShowDomain={isRaster}\n                    shouldShowColormap={isRaster}\n                    // Disable 3D if given explicit instructions to do so\n                    // or if another layer is using 3D mode.\n                    disable3d={\n                      globalDisable3d\n                      || (disable3d || []).indexOf(layerMeta.name) >= 0\n                      || (typeof layerIs3DIndex === 'number'\n                        && layerIs3DIndex !== -1\n                        && layerIs3DIndex !== i)\n                    }\n                    disabled={\n                      typeof layerIs3DIndex === 'number'\n                      && layerIs3DIndex !== -1\n                      && layerIs3DIndex !== i\n                    }\n                    disableChannelsIfRgbDetected={disableChannelsIfRgbDetected}\n                    rasterLayersCallbacks={rasterLayersCallbacks}\n                    setRasterLayerCallback={setRasterLayerCallback}\n                    setViewState={({\n                      zoom: newZoom,\n                      target,\n                      rotationX: newRotationX,\n                      rotationOrbit: newRotationOrbit,\n                    }) => {\n                      setZoom(newZoom);\n                      setTargetX(target[0]);\n                      setTargetY(target[1]);\n                      setTargetZ(target[2]);\n                      setRotationX(newRotationX);\n                      setRotationOrbit(newRotationOrbit);\n                    }}\n                    setAreLayerChannelsLoading={setAreLayerChannelsLoading}\n                    areLayerChannelsLoading={areLayerChannelsLoading}\n                    spatialHeight={(componentHeight * (spatialLayout ? spatialLayout.h : 1)) / 12}\n                    spatialWidth={(componentWidth * (spatialLayout ? spatialLayout.w : 1)) / 12}\n                    shouldShowRemoveLayerButton={shouldShowImageLayerButton}\n                  />\n                </Grid>\n              ) : null;\n            })}\n          {shouldShowImageLayerButton\n            ? (\n              <Grid item>\n                <ImageAddButton\n                  imageOptions={imageLayerMeta}\n                  handleImageAdd={handleImageAdd}\n                />\n              </Grid>\n            ) : null}\n        </div>\n      </TitleInfo>\n    );\n  }),\n);\n\n/**\n * A subscriber component for the spatial layer controller.\n * @param {object} props\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n * @param {Object} props.disable3d Which layers should have 3D disabled (from `raster.json` names).\n * @param {boolean} props.globalDisable3d Disable 3D for all layers. Overrides the `disable3d` prop.\n * @param {boolean} props.disableChannelsIfRgbDetected Disable channel controls if an\n * RGB image is detected i.e 3 channel 8 bit.\n * @param {boolean} props.enableLayerButtonsWithOneLayer If there is only one layer,\n * show the the layer add/remove buttons.\n */\nfunction LayerControllerSubscriber(props) {\n  const {\n    coordinationScopes,\n    removeGridComponent,\n    theme,\n    title = 'Spatial Layers',\n    disable3d,\n    globalDisable3d,\n    disableChannelsIfRgbDetected,\n    enableLayerButtonsWithOneLayer,\n  } = props;\n\n  const loaders = useLoaders();\n\n  // Get \"props\" from the coordination space.\n  const [\n    {\n      dataset,\n      spatialRasterLayers: rasterLayers,\n      spatialCellsLayer: cellsLayer,\n      spatialMoleculesLayer: moleculesLayer,\n    },\n    {\n      setSpatialRasterLayers: setRasterLayers,\n      setSpatialCellsLayer: setCellsLayer,\n      setSpatialMoleculesLayer: setMoleculesLayer,\n      setSpatialTargetX: setTargetX,\n      setSpatialTargetY: setTargetY,\n      setSpatialTargetZ: setTargetZ,\n      setSpatialRotationX: setRotationX,\n      setSpatialRotationOrbit: setRotationOrbit,\n      setSpatialZoom: setZoom,\n    },\n  ] = useCoordination(\n    COMPONENT_COORDINATION_TYPES.layerController,\n    coordinationScopes,\n  );\n\n  const [\n    {\n      rasterLayersCallbacks,\n      areLoadingRasterChannnels,\n    },\n    {\n      setRasterLayersCallbacks,\n      setAreLoadingRasterChannnels,\n    },\n  ] = useAuxiliaryCoordination(\n    COMPONENT_COORDINATION_TYPES.layerController,\n    coordinationScopes,\n  );\n  // Spatial layout + window size is needed for the \"re-center\" button to work properly.\n  // Dimensions of the Spatial component can be inferred and used for resetting view state to\n  // a nice, centered view.\n  const [spatialLayout] = useComponentLayout('spatial', ['spatialRasterLayers'], coordinationScopes);\n  const layerControllerRef = useRef();\n  const [componentWidth, componentHeight] = useClosestVitessceContainerSize(layerControllerRef);\n  const { height: windowHeight, width: windowWidth } = useWindowDimensions();\n\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    LAYER_CONTROLLER_DATA_TYPES,\n  );\n\n  // Reset loader progress when the dataset has changed.\n  useEffect(() => {\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  // eslint-disable-next-line no-unused-vars\n  const [raster, imageLayerLoaders, imageLayerMeta] = useRasterData(\n    loaders, dataset, setItemIsReady, () => { }, false,\n    { setSpatialRasterLayers: setRasterLayers },\n    { spatialRasterLayers: rasterLayers },\n  );\n\n  useCellsData(\n    loaders, dataset, setItemIsReady, () => {}, false,\n    { setSpatialCellsLayer: setCellsLayer },\n    { spatialCellsLayer: cellsLayer },\n  );\n  useMoleculesData(\n    loaders, dataset, setItemIsReady, () => {}, false,\n    { setSpatialMoleculesLayer: setMoleculesLayer },\n    { spatialMoleculesLayer: moleculesLayer },\n  );\n\n  // useCallback prevents new functions from propogating\n  // changes to the underlying component.\n  const handleImageAdd = useCallback(async (index) => {\n    const loader = imageLayerLoaders[index];\n    const newChannels = await initializeLayerChannels(\n      loader,\n      (rasterLayers[index] || {}).use3d,\n    );\n    const newLayer = {\n      index,\n      modelMatrix: imageLayerMeta[index]?.metadata?.transform?.matrix,\n      ...DEFAULT_RASTER_LAYER_PROPS,\n      channels: newChannels,\n      type: imageLayerMeta[index]?.metadata?.isBitmask ? 'bitmask' : 'raster',\n    };\n    const newLayers = [...rasterLayers, newLayer];\n    setRasterLayers(newLayers);\n  }, [imageLayerLoaders, imageLayerMeta, rasterLayers, setRasterLayers]);\n\n  const handleRasterLayerChange = useCallback((newLayer, i) => {\n    const newLayers = [...rasterLayers];\n    newLayers[i] = newLayer;\n    setRasterLayers(newLayers);\n  }, [rasterLayers, setRasterLayers]);\n\n  const handleRasterLayerRemove = useCallback((i) => {\n    const newLayers = [...rasterLayers];\n    newLayers.splice(i, 1);\n    setRasterLayers(newLayers);\n  }, [rasterLayers, setRasterLayers]);\n\n  const hasNoBitmask = (\n    imageLayerMeta.length ? imageLayerMeta : [{ metadata: { isBitmask: true } }]\n  ).every(l => !l?.metadata?.isBitmask);\n  // Only want to show vector cells controller if there is no bitmask\n  const canShowCellVecmask = hasNoBitmask;\n  const layerIs3DIndex = rasterLayers?.findIndex && rasterLayers.findIndex(layer => layer.use3d);\n  return (\n    <LayerControllerMemoized\n      ref={layerControllerRef}\n      title={title}\n      removeGridComponent={removeGridComponent}\n      theme={theme}\n      isReady={isReady}\n      moleculesLayer={moleculesLayer}\n      dataset={dataset}\n      setMoleculesLayer={setMoleculesLayer}\n      cellsLayer={cellsLayer}\n      canShowCellVecmask={canShowCellVecmask}\n      setCellsLayer={setCellsLayer}\n      rasterLayers={rasterLayers}\n      imageLayerLoaders={imageLayerLoaders}\n      imageLayerMeta={imageLayerMeta}\n      rasterLayersCallbacks={rasterLayersCallbacks}\n      setRasterLayersCallbacks={setRasterLayersCallbacks}\n      areLoadingRasterChannnels={areLoadingRasterChannnels}\n      setAreLoadingRasterChannnels={setAreLoadingRasterChannnels}\n      handleRasterLayerChange={handleRasterLayerChange}\n      handleRasterLayerRemove={handleRasterLayerRemove}\n      disable3d={disable3d}\n      globalDisable3d={globalDisable3d}\n      layerIs3DIndex={layerIs3DIndex}\n      disableChannelsIfRgbDetected={disableChannelsIfRgbDetected}\n      enableLayerButtonsWithOneLayer={enableLayerButtonsWithOneLayer}\n      setZoom={setZoom}\n      setTargetX={setTargetX}\n      setTargetY={setTargetY}\n      setTargetZ={setTargetZ}\n      setRotationX={setRotationX}\n      setRotationOrbit={setRotationOrbit}\n      // Fall back to window for height and width.\n      componentHeight={componentHeight || windowHeight}\n      componentWidth={componentWidth || windowWidth}\n      spatialLayout={spatialLayout}\n      handleImageAdd={handleImageAdd}\n    />\n  );\n}\n\nexport default LayerControllerSubscriber;\n", "import React, { useCallback, useState, useEffect } from 'react';\n\nimport Grid from '@material-ui/core/Grid';\nimport Slider from '@material-ui/core/Slider';\nimport debounce from 'lodash/debounce';\nimport isEqual from 'lodash/isEqual';\n\nimport ChannelOptions from './ChannelOptions';\nimport { DOMAINS } from './constants';\nimport { getSourceFromLoader } from '../../utils';\nimport { getMultiSelectionStats } from './utils';\nimport {\n  ChannelSelectionDropdown,\n  ChannelVisibilityCheckbox,\n} from './shared-channel-controls';\n\n// Returns an rgb string for display, and changes the color (arr)\n// to use a grey for light theme + white color or if the colormap is on.\nexport const toRgbUIString = (on, arr, theme) => {\n  const color = on || (theme === 'light' && arr.every(i => i === 255))\n    ? [220, 220, 220]\n    : arr;\n  return `rgb(${color})`;\n};\n\nfunction abbreviateNumber(value) {\n  // Return an abbreviated representation of value, in 5 characters or less.\n\n  const maxLength = 5;\n  let maxNaiveDigits = maxLength;\n\n  /* eslint-disable no-plusplus */\n  if (!Number.isInteger(value)) {\n    --maxNaiveDigits;\n  } // Wasted on \".\"\n  if (value < 1) {\n    --maxNaiveDigits;\n  } // Wasted on \"0.\"\n  /* eslint-disable no-plusplus */\n\n  const naive = Intl.NumberFormat('en-US', {\n    maximumSignificantDigits: maxNaiveDigits,\n    useGrouping: false,\n  }).format(value);\n  if (naive.length <= maxLength) return naive;\n\n  // \"e+9\" consumes 3 characters, so if we even had two significant digits,\n  // it would take take us to six characters, including the decimal point.\n  return value.toExponential(0);\n}\n\n/**\n * Slider for controlling current colormap.\n * @prop {string} color Current color for this channel.\n * @prop {arry} slider Current value of the slider.\n * @prop {function} handleChange Callback for each slider change.\n * @prop {array} domain Current max/min allowable slider values.\n */\nfunction ChannelSlider({\n  color,\n  slider = [0, 0],\n  handleChange,\n  domain = [0, 0],\n  dtype,\n  disabled,\n}) {\n  const [min, max] = domain;\n  const handleChangeDebounced = useCallback(\n    debounce(handleChange, 3, { trailing: true }),\n    [handleChange],\n  );\n  const step = max - min < 500 && dtype === 'Float32' ? (max - min) / 500 : 1;\n  return (\n    <Slider\n      value={slider}\n      valueLabelFormat={abbreviateNumber}\n      onChange={(e, v) => handleChangeDebounced(v)}\n      valueLabelDisplay=\"auto\"\n      getAriaLabel={() => `${color}-${slider}`}\n      min={min}\n      max={max}\n      step={step}\n      orientation=\"horizontal\"\n      style={{ color, marginTop: '7px' }}\n      disabled={disabled}\n    />\n  );\n}\n\n/**\n * Controller for the handling the colormapping sliders.\n * @prop {boolean} visibility Whether or not this channel is \"on\"\n * @prop {array} slider Current slider range.\n * @prop {array} color Current color for this channel.\n * @prop {array} domain Current max/min for this channel.\n * @prop {string} dimName Name of the dimensions this slider controls (usually \"channel\").\n * @prop {boolean} colormapOn Whether or not the colormap (viridis, magma etc.) is on.\n * @prop {object} channelOptions All available options for this dimension (i.e channel names).\n * @prop {function} handlePropertyChange Callback for when a property (color, slider etc.) changes.\n * @prop {function} handleChannelRemove When a channel is removed, this is called.\n * @prop {function} handleIQRUpdate When the IQR button is clicked, this is called.\n * @prop {number} selectionIndex The current numeric index of the selection.\n */\nfunction RasterChannelController({\n  visibility = false,\n  slider,\n  color,\n  channels,\n  channelId,\n  domainType: newDomainType,\n  dimName,\n  theme,\n  loader,\n  colormapOn,\n  channelOptions,\n  handlePropertyChange,\n  handleChannelRemove,\n  handleIQRUpdate,\n  selectionIndex,\n  isLoading,\n  use3d: newUse3d,\n}) {\n  const { dtype } = getSourceFromLoader(loader);\n  const [domain, setDomain] = useState(null);\n  const [domainType, setDomainType] = useState(null);\n  const [use3d, setUse3d] = useState(null);\n  const [selection, setSelection] = useState([\n    { ...channels[channelId].selection },\n  ]);\n  const rgbColor = toRgbUIString(colormapOn, color, theme);\n\n  useEffect(() => {\n    // Use mounted to prevent state updates/re-renders after the component has been unmounted.\n    // All state updates should happen within the mounted check.\n    let mounted = true;\n    if (dtype && loader && channels) {\n      const selections = [{ ...channels[channelId].selection }];\n      let domains;\n      const hasDomainChanged = newDomainType !== domainType;\n      const has3dChanged = use3d !== newUse3d;\n      const hasSelectionChanged = !isEqual(selections, selection);\n      if (hasDomainChanged || hasSelectionChanged || has3dChanged) {\n        if (newDomainType === 'Full') {\n          domains = [DOMAINS[dtype]];\n          const [newDomain] = domains;\n          if (mounted) {\n            setDomain(newDomain);\n            setDomainType(newDomainType);\n            if (hasSelectionChanged) {\n              setSelection(selections);\n            }\n            if (has3dChanged) {\n              setUse3d(newUse3d);\n            }\n          }\n        } else {\n          getMultiSelectionStats({\n            loader: loader.data,\n            selections,\n            use3d: newUse3d,\n          }).then((stats) => {\n            // eslint-disable-next-line prefer-destructuring\n            domains = stats.domains;\n            const [newDomain] = domains;\n            if (mounted) {\n              setDomain(newDomain);\n              setDomainType(newDomainType);\n              if (hasSelectionChanged) {\n                setSelection(selections);\n              }\n              if (has3dChanged) {\n                setUse3d(newUse3d);\n              }\n            }\n          });\n        }\n      }\n    }\n    return () => {\n      mounted = false;\n    };\n  }, [\n    domainType,\n    channels,\n    channelId,\n    loader,\n    dtype,\n    newDomainType,\n    selection,\n    newUse3d,\n    use3d,\n  ]);\n  /* A valid selection is defined by an object where the keys are\n   *  the name of a dimension of the data, and the values are the\n   *  index of the image along that particular dimension.\n   *\n   *  Since we currently only support making a selection along one\n   *  addtional dimension (i.e. the dropdown just has channels or mz)\n   *  we have a helper function to create the selection.\n   *\n   *  e.g { channel: 2 } // channel dimension, third channel\n   */\n  const createSelection = index => ({ [dimName]: index });\n  return (\n    <Grid container direction=\"column\" m={1} justify=\"center\">\n      <Grid container direction=\"row\" justify=\"space-between\">\n        <Grid item xs={10}>\n          <ChannelSelectionDropdown\n            handleChange={v => handlePropertyChange('selection', createSelection(v))\n            }\n            selectionIndex={selectionIndex}\n            channelOptions={channelOptions}\n            disabled={isLoading}\n          />\n        </Grid>\n        <Grid item xs={1} style={{ marginTop: '4px' }}>\n          <ChannelOptions\n            handlePropertyChange={handlePropertyChange}\n            handleChannelRemove={handleChannelRemove}\n            handleIQRUpdate={handleIQRUpdate}\n            disabled={isLoading}\n          />\n        </Grid>\n      </Grid>\n      <Grid container direction=\"row\" justify=\"space-between\">\n        <Grid item xs={2}>\n          <ChannelVisibilityCheckbox\n            color={rgbColor}\n            checked={visibility}\n            toggle={() => handlePropertyChange('visible', !visibility)}\n            disabled={isLoading}\n          />\n        </Grid>\n        <Grid item xs={9}>\n          <ChannelSlider\n            color={rgbColor}\n            slider={slider}\n            domain={domain || DOMAINS[dtype]}\n            dtype={dtype}\n            handleChange={v => handlePropertyChange('slider', v)}\n            disabled={isLoading}\n          />\n        </Grid>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport default RasterChannelController;\n", "import React, { useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport { PopperMenu, MuiSpan } from '../shared-mui/components';\n\nimport ColorPalette from './ColorPalette';\n\nconst useStyles = makeStyles(() => ({\n  menuButton: {\n    backgroundColor: 'transparent',\n  },\n  colors: {\n    '&:hover': {\n      backgroundColor: 'transparent',\n    },\n    paddingLeft: '2px',\n    paddingRight: '2px',\n  },\n}));\n\n/**\n * Dropdown for options for a channel on the three dots button.\n * @prop {function} handlePropertyChange Callback for changing property (color, IQR of sliders).\n * @prop {function} handleChannelRemove Callback for channel removal.\n * @prop {function} handleIQRUpdate Callback for IQR slider update.\n */\nfunction ChannelOptions({ handlePropertyChange, handleChannelRemove, handleIQRUpdate }) {\n  const [open, setOpen] = useState(false);\n\n  const classes = useStyles();\n\n  const handleColorSelect = (color) => {\n    handlePropertyChange('color', color);\n  };\n\n  const handleRemove = () => {\n    setOpen(false);\n    handleChannelRemove();\n  };\n\n  return (\n    <PopperMenu\n      open={open}\n      setOpen={setOpen}\n      buttonIcon={<MoreVertIcon fontSize=\"small\" />}\n      buttonClassName={classes.menuButton}\n    >\n      <MenuItem dense disableGutters onClick={handleRemove}>\n        <MuiSpan>Remove</MuiSpan>\n      </MenuItem>\n      <MenuItem dense disableGutters onClick={handleIQRUpdate}>\n        <MuiSpan>Use IQR</MuiSpan>\n      </MenuItem>\n      <MenuItem dense disableGutters className={classes.colors}>\n        <ColorPalette handleChange={handleColorSelect} />\n      </MenuItem>\n    </PopperMenu>\n  );\n}\n\nexport default ChannelOptions;\n", "import React from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport LensIcon from '@material-ui/icons/Lens';\nimport { makeStyles } from '@material-ui/core/styles';\n\n\nimport { VIEWER_PALETTE } from '../utils';\n\nconst useStyles = makeStyles(theme => ({\n  container: {\n    width: '70px',\n    height: '40px',\n    display: 'flex',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    flexWrap: 'wrap',\n  },\n  button: {\n    padding: '3px',\n    width: '16px',\n  },\n  icon: {\n    width: '17px',\n    height: '17px',\n    stroke: theme.palette.action.selected,\n    'stroke-width': '1px',\n  },\n}));\n\nconst ColorPalette = ({ handleChange }) => {\n  const classes = useStyles();\n  return (\n    <div className={classes.container} aria-label=\"color-swatch\">\n      {VIEWER_PALETTE.map(color => (\n        <IconButton\n          className={classes.button}\n          key={color}\n          onClick={() => handleChange(color)}\n        >\n          <LensIcon\n            fontSize=\"small\"\n            style={{ color: `rgb(${color})` }}\n            className={classes.icon}\n          />\n        </IconButton>\n      ))}\n    </div>\n  );\n};\n\nexport default ColorPalette;\n", "import { DTYPE_VALUES } from '@hms-dbmi/viv';\n\nfunction getDomains() {\n  const domains = {};\n  const needMin = ['Int8', 'Int16', 'Int32'];\n  Object.keys(DTYPE_VALUES).forEach((dtype) => {\n    const { max } = DTYPE_VALUES[dtype];\n    const min = needMin.includes(dtype) ? -(max + 1) : 0;\n    domains[dtype] = [min, max];\n  });\n  return domains;\n}\n\nexport const DOMAINS = getDomains();\n", "import React from 'react';\n\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Select from '@material-ui/core/Select';\nimport { useSelectStyles } from './styles';\n\n/**\n * Dropdown for selecting a channel.\n * @prop {function} handleChange Callback for each new selection.\n * @prop {array} channelOptions List of available selections, like ['DAPI', 'FITC', ...].\n * @prop {boolean} disabled Whether or not the component is disabled.\n * @prop {number} selectionIndex Current numeric index of a selection.\n */\nexport function ChannelSelectionDropdown({\n  handleChange,\n  disabled,\n  channelOptions,\n  selectionIndex,\n}) {\n  const classes = useSelectStyles();\n  return (\n    <Select\n      classes={{ root: classes.selectRoot }}\n      native\n      value={selectionIndex}\n      onChange={e => handleChange(Number(e.target.value))}\n    >\n      {channelOptions.map((opt, i) => (\n        <option disabled={disabled} key={opt} value={i}>\n          {opt}\n        </option>\n      ))}\n    </Select>\n  );\n}\n\n/**\n * Checkbox for toggling on/off of a channel.\n * @prop {string} color Current color for this channel.\n * @prop {boolean} checked Whether or not this channel is \"on\".\n * @prop {boolean} disabled Whether or not the component is disabled.\n * @prop {function} toggle Callback for toggling on/off.\n */\nexport function ChannelVisibilityCheckbox({\n  color, checked, toggle, disabled,\n}) {\n  return (\n    <Checkbox\n      onChange={toggle}\n      checked={checked}\n      disabled={disabled}\n      style={{ color, '&$checked': { color } }}\n    />\n  );\n}\n", "import { makeStyles, withStyles } from '@material-ui/core/styles';\nimport ExpansionPanelSummary from '@material-ui/core/ExpansionPanelSummary';\nimport ExpansionPanelDetails from '@material-ui/core/ExpansionPanelDetails';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport Slider from '@material-ui/core/Slider';\nimport Grid from '@material-ui/core/Grid';\n\nexport const useSelectStyles = makeStyles(() => ({\n  selectRoot: {\n    padding: 0,\n    height: 'auto',\n    margin: '4px 0',\n  },\n}));\n\nexport const useOptionStyles = withStyles(theme => ({\n  paper: {\n    backgroundColor: theme.palette.background.paper,\n  },\n  span: {\n    width: '70px',\n    textAlign: 'center',\n    paddingLeft: '2px',\n    paddingRight: '2px',\n  },\n  colors: {\n    '&:hover': {\n      backgroundColor: 'transparent',\n    },\n    paddingLeft: '2px',\n    paddingRight: '2px',\n  },\n  popper: {\n    zIndex: 4,\n  },\n}));\n\nconst sharedControllerStyles = {\n  width: '100%',\n  flexDirection: 'column',\n};\n\nexport const useControllerSectionStyles = makeStyles(() => ({\n  root: {\n    ...sharedControllerStyles,\n    padding: '0px 8px',\n  },\n}));\n\nexport const StyledExpansionPanelDetails = withStyles(() => ({\n  root: {\n    ...sharedControllerStyles,\n    padding: '8px 8px 24px 8px',\n  },\n}))(ExpansionPanelDetails);\n\nexport const StyledExpansionPanelSummary = withStyles(theme => ({\n  root: {\n    padding: '0px 8px',\n  },\n  content: {\n    margin: '4px 0px',\n    minWidth: '0px',\n  },\n  expanded: {\n    marginBottom: theme.spacing(-3),\n    top: theme.spacing(-1),\n  },\n  expandIcon: {\n    '&$expanded': {\n      top: theme.spacing(-1.3),\n    },\n  },\n}))(ExpansionPanelSummary);\n\nexport const StyledInputLabel = withStyles(() => ({\n  root: {\n    fontSize: '14px',\n  },\n}))(InputLabel);\n\nexport const OverflowEllipsisGrid = withStyles(() => ({\n  item: {\n    width: '100%',\n    overflow: 'hidden',\n    whiteSpace: 'nowrap',\n    textOverflow: 'ellipsis',\n  },\n}))(Grid);\n\nexport const StyledSelectionSlider = withStyles(() => ({\n  root: {\n    marginTop: '7px',\n  },\n  markActive: {\n    backgroundColor: 'rgba(128, 128, 128, 0.7)',\n  },\n}))(Slider);\n", "import React from 'react';\n\nimport RemoveCircleIcon from '@material-ui/icons/RemoveCircle';\nimport IconButton from '@material-ui/core/IconButton';\n\nimport Grid from '@material-ui/core/Grid';\n\nimport { ChannelSelectionDropdown, ChannelVisibilityCheckbox } from './shared-channel-controls';\n\n/**\n * Controller for the handling the bitmask channels.\n * @prop {boolean} visibility Whether or not this channel is \"on\"\n * @prop {string} dimName Name of the dimensions this slider controls (usually \"channel\").\n * @prop {object} channelOptions All available options for this dimension (i.e channel names).\n * @prop {function} handlePropertyChange Callback for when a property (color, slider etc.) changes.\n * @prop {function} handleChannelRemove When a channel is removed, this is called.\n * @prop {number} selectionIndex The current numeric index of the selection.\n * @prop {boolean} disableOptions Whether or not channel options are be disabled (default: false).\n */\nfunction BitmaskChannelController({\n  visibility = false,\n  dimName,\n  channelOptions,\n  handlePropertyChange,\n  handleChannelRemove,\n  selectionIndex,\n  disableOptions = false,\n}) {\n  /* A valid selection is defined by an object where the keys are\n  *  the name of a dimension of the data, and the values are the\n  *  index of the image along that particular dimension.\n  *\n  *  Since we currently only support making a selection along one\n  *  addtional dimension (i.e. the dropdown just has channels or mz)\n  *  we have a helper function to create the selection.\n  *\n  *  e.g { channel: 2 } // channel dimension, third channel\n  */\n  const createSelection = index => ({ [dimName]: index });\n  return (\n    <Grid container direction=\"row\" justify=\"space-between\">\n      <Grid item xs={2}>\n        <ChannelVisibilityCheckbox\n          color={[220, 220, 220]}\n          checked={visibility}\n          toggle={() => handlePropertyChange('visible', !visibility)}\n        />\n      </Grid>\n      <Grid item xs={9}>\n        <ChannelSelectionDropdown\n          handleChange={v => handlePropertyChange('selection', createSelection(v))}\n          selectionIndex={selectionIndex}\n          disableOptions={disableOptions}\n          channelOptions={channelOptions}\n        />\n      </Grid>\n      <Grid item xs={1}>\n        <IconButton onClick={handleChannelRemove} style={{ padding: '6px 6px 6px 0px' }}>\n          <RemoveCircleIcon />\n        </IconButton>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport default BitmaskChannelController;\n", "import React from 'react';\n\nimport Grid from '@material-ui/core/Grid';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\nimport Slider from '@material-ui/core/Slider';\nimport { useControllerSectionStyles } from './styles';\n\nexport default function VectorLayerController(props) {\n  const {\n    label,\n    layer,\n    layerType,\n    handleLayerChange,\n  } = props;\n\n  const slider = layer.opacity;\n  const isOn = layer.visible;\n\n  function handleSliderChange(v) {\n    if (layerType === 'cells') {\n      const stroked = v < 0.7;\n      handleLayerChange({ ...layer, opacity: v, stroked });\n    } else {\n      handleLayerChange({ ...layer, opacity: v });\n    }\n  }\n\n  function handleCheckBoxChange(v) {\n    handleLayerChange({ ...layer, visible: v });\n  }\n\n  const classes = useControllerSectionStyles();\n  return (\n    <Grid item style={{ marginTop: '10px' }}>\n      <Paper className={classes.root}>\n        <Typography\n          style={{\n            padding: '15px 8px 0px 8px',\n            marginBottom: '-5px',\n          }}\n        >\n          {label}\n        </Typography>\n        <Grid container direction=\"row\" justify=\"space-between\">\n          <Grid item xs={2}>\n            <Checkbox color=\"primary\" checked={isOn} onChange={(e, v) => handleCheckBoxChange(v)} />\n          </Grid>\n          <Grid item xs={9} style={{ paddingRight: '8px' }}>\n            <Slider\n              value={slider}\n              min={0}\n              max={1}\n              step={0.001}\n              onChange={(e, v) => handleSliderChange(v)}\n              style={{ marginTop: '7px' }}\n              orientation=\"horizontal\"\n            />\n          </Grid>\n        </Grid>\n      </Paper>\n    </Grid>\n  );\n}\n", "import React, { useState, useRef, useEffect } from 'react';\nimport { MAX_CHANNELS, getChannelStats } from '@hms-dbmi/viv';\n\nimport Grid from '@material-ui/core/Grid';\nimport Button from '@material-ui/core/Button';\nimport AddIcon from '@material-ui/icons/Add';\nimport Slider from '@material-ui/core/Slider';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\n\nimport ExpansionPanel from '@material-ui/core/ExpansionPanel';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport VisibilityIcon from '@material-ui/icons/Visibility';\nimport VisibilityOffIcon from '@material-ui/icons/VisibilityOff';\n\nimport LayerOptions from './LayerOptions';\nimport VolumeOptions from './VolumeOptions';\nimport {\n  useControllerSectionStyles,\n  StyledExpansionPanelDetails,\n  StyledExpansionPanelSummary,\n  StyledInputLabel,\n  OverflowEllipsisGrid,\n} from './styles';\nimport { getMultiSelectionStats } from './utils';\n\nimport { GLOBAL_LABELS } from '../spatial/constants';\nimport { getSourceFromLoader, isRgb } from '../../utils';\nimport { canLoadResolution } from '../utils';\nimport { DOMAINS } from './constants';\n\nfunction TabPanel(props) {\n  const {\n    children, value, index, ...other\n  } = props;\n\n  return (\n    <div\n      role=\"tabpanel\"\n      hidden={value !== index}\n      id={`simple-tabpanel-${index}`}\n      aria-labelledby={`simple-tab-${index}`}\n      {...other}\n    >\n      {value === index && children}\n    </div>\n  );\n}\n\n// Set the domain of the sliders based on either a full range or min/max.\nasync function getDomainsAndSliders(loader, selections, domainType, use3d) {\n  let domains;\n  const stats = await getMultiSelectionStats({\n    loader: loader.data,\n    selections,\n    use3d,\n  });\n  const { sliders } = stats;\n  if (domainType === 'Min/Max') {\n    // eslint-disable-next-line prefer-destructuring\n    domains = stats.domains;\n  }\n  if (domainType === 'Full') {\n    const source = getSourceFromLoader(loader);\n    domains = selections.map(() => DOMAINS[source.dtype]);\n  }\n  return { domains, sliders };\n}\n\nconst buttonStyles = {\n  borderStyle: 'dashed',\n  marginTop: '10px',\n  fontWeight: 400,\n};\n\n/**\n * Controller for the various imaging options (color, opactiy, sliders etc.)\n * @prop {object} imageData Image config object, one of the `images` in the raster schema.\n * @prop {object} layerId Randomly generated id for the image layer that this controller handles.\n * @prop {function} handleLayerRemove Callback for handling the removal of a layer.\n * @prop {object} loader Loader object for the current imaging layer.\n * @prop {function} handleLayerChange Callback for handling the changing of layer properties.\n */\nexport default function LayerController(props) {\n  const {\n    layer,\n    name,\n    loader,\n    theme,\n    handleLayerRemove,\n    handleLayerChange,\n    shouldShowTransparentColor,\n    shouldShowDomain,\n    shouldShowColormap,\n    ChannelController,\n    setViewState,\n    disable3d,\n    setRasterLayerCallback,\n    setAreLayerChannelsLoading,\n    areLayerChannelsLoading,\n    disabled,\n    spatialHeight,\n    spatialWidth,\n    disableChannelsIfRgbDetected,\n    shouldShowRemoveLayerButton,\n  } = props;\n\n  const {\n    colormap,\n    opacity,\n    channels,\n    transparentColor,\n    renderingMode,\n    xSlice,\n    ySlice,\n    zSlice,\n    resolution,\n    use3d,\n    modelMatrix,\n  } = layer;\n  // Channels are used in a lot of callbacks and change handlers\n  // so ensuring they have an up to date copy of the data ensures consistency.\n  // See: https://github.com/vitessce/vitessce/issues/1036\n  const channelRef = useRef(channels);\n  useEffect(() => {\n    channelRef.current = channels;\n    return undefined;\n  }, [channels]);\n\n  const firstSelection = channels[0]?.selection || {};\n\n  const { data, channels: channelOptions } = loader;\n  const [tab, setTab] = useState(0);\n\n  const handleTabChange = (event, newTab) => {\n    setTab(newTab);\n  };\n  const { labels, shape } = Array.isArray(data) ? data[data.length - 1] : data;\n  const [domainType, setDomainType] = useState(layer.domainType);\n  const [isExpanded, setIsExpanded] = useState(true);\n  const [globalLabelValues, setGlobalLabelValues] = useState(\n    GLOBAL_LABELS.filter(\n      field => typeof firstSelection[field] === 'number',\n    ).reduce((o, key) => ({ ...o, [key]: firstSelection[key] }), {}),\n  );\n\n  function setVisible(v) {\n    handleLayerChange({ ...layer, visible: v });\n  }\n\n  function setColormap(v) {\n    handleLayerChange({ ...layer, colormap: v });\n  }\n\n  function setOpacity(v) {\n    handleLayerChange({ ...layer, opacity: v });\n  }\n\n  function setChannels(v) {\n    handleLayerChange({ ...layer, channels: v });\n  }\n  function setTransparentColor(v) {\n    handleLayerChange({ ...layer, transparentColor: v });\n  }\n  function setRenderingMode(v) {\n    handleLayerChange({ ...layer, renderingMode: v });\n  }\n\n  function handleMultiPropertyChange(obj) {\n    handleLayerChange({ ...layer, ...obj });\n  }\n\n  function handleSlicerSetting(slice, val) {\n    handleLayerChange({ ...layer, [`${slice}Slice`]: val });\n  }\n\n  function setChannelsAndDomainType(newChannels, newDomainType) {\n    handleLayerChange({\n      ...layer,\n      channels: newChannels,\n      domainType: newDomainType,\n    });\n  }\n\n  function setChannel(v, i) {\n    const newChannels = [...channelRef.current];\n    newChannels[i] = v;\n    handleLayerChange({ ...layer, channels: newChannels });\n  }\n\n  function addChannel(v) {\n    const newChannels = [...channelRef.current, v];\n    handleLayerChange({ ...layer, channels: newChannels });\n  }\n\n  function removeChannel(i) {\n    const newChannels = [...channelRef.current];\n    newChannels.splice(i, 1);\n    handleLayerChange({ ...layer, channels: newChannels });\n  }\n\n  const setAreAllChannelsLoading = (val) => {\n    const newAreLayerChannelsLoading = channelRef.current.map(() => val);\n    setAreLayerChannelsLoading(newAreLayerChannelsLoading);\n  };\n\n  // Handles adding a channel, creating a default selection\n  // for the current global settings and domain type.\n  const handleChannelAdd = async () => {\n    const selection = {};\n    labels.forEach((label) => {\n      // Set new image to default selection for non-global selections (0)\n      // and use current global selection otherwise.\n      selection[label] = GLOBAL_LABELS.includes(label)\n        ? globalLabelValues[label] || 0\n        : 0;\n    });\n    const { domains, sliders } = await getDomainsAndSliders(\n      loader,\n      [selection],\n      domainType,\n      use3d,\n    );\n    const domain = domains[0];\n    const slider = domain;\n    const color = [255, 255, 255];\n    const visible = true;\n    const newChannelId = channels.length;\n    const newAreLayerChannelsLoading = [...areLayerChannelsLoading];\n    newAreLayerChannelsLoading[newChannelId] = true;\n    setAreLayerChannelsLoading(newAreLayerChannelsLoading);\n    const channel = {\n      selection,\n      slider,\n      visible,\n      color,\n    };\n    setRasterLayerCallback(() => {\n      setChannel({ ...channel, slider: sliders[0] }, newChannelId);\n      const areLayerChannelsLoadingCallback = [...newAreLayerChannelsLoading];\n      areLayerChannelsLoadingCallback[newChannelId] = false;\n      setAreLayerChannelsLoading(areLayerChannelsLoadingCallback);\n      setRasterLayerCallback(null);\n    });\n    addChannel(channel);\n  };\n\n  const handleDomainChange = async (value) => {\n    setDomainType(value);\n    const selections = channels.map(channel => channel.selection);\n    let sliders = channels.map(channel => channel.slider);\n    const { domains } = await getDomainsAndSliders(\n      loader,\n      selections,\n      value,\n      use3d,\n    );\n\n    // If it's the right-most slider, we take the minimum of that and the new value.\n    // Otherwise, we use the maximum of the left-hand side and the new value.\n    sliders = sliders.map((slider, i) => {\n      const [left, right] = slider;\n      return [Math.max(left, domains[i][0]), Math.min(right, domains[i][1])];\n    });\n\n    const newChannels = channels.map((c, i) => ({ ...c, slider: sliders[i] }));\n    setChannelsAndDomainType(newChannels, value);\n  };\n\n  // This call updates all channel selections with new global selection from the UI.\n  const handleGlobalChannelsSelectionChange = async ({ selection, event }) => {\n    const selections = channels.map(channel => ({\n      ...channel.selection,\n      ...selection,\n    }));\n    const canUpdateChannels = event.type === 'mouseup' || event.type === 'keydown';\n    // Only update domains on a mouseup event for the same reason as above.\n    if (canUpdateChannels) {\n      setAreAllChannelsLoading(true);\n      getDomainsAndSliders(loader, selections, domainType, use3d).then(\n        ({ sliders }) => {\n          const newChannelsWithSelection = channels.map(c => ({\n            ...c,\n            selection: { ...c.selection, ...selection },\n          }));\n          // Set the callback before changing the selection\n          // so the callback is used when the layer (re)loads its data.\n          setRasterLayerCallback(() => {\n            setRasterLayerCallback(null);\n            setAreAllChannelsLoading(false);\n            const newChannelsWithSliders = [...newChannelsWithSelection].map(\n              (c, i) => ({\n                ...c,\n                slider: sliders[i],\n              }),\n            );\n            setChannels(newChannelsWithSliders);\n          });\n          setChannels(newChannelsWithSelection);\n        },\n      );\n    }\n    setGlobalLabelValues(prev => ({ ...prev, ...selection }));\n  };\n\n  let channelControllers = [];\n  if (labels.length > 0) {\n    const channelLabel = labels.find(c => c === 'channel' || c === 'c') || labels[0];\n    // Create the channel controllers for each channel.\n    channelControllers = channels.map(\n      // c is an object like { color, selection, slider, visible }.\n      (c, channelId) => {\n        // Update the auxiliary store with the current loading state of a channel.\n        const setIsLoading = (val) => {\n          const newAreLayerChannelsLoading = [...areLayerChannelsLoading];\n          newAreLayerChannelsLoading[channelId] = val;\n          setAreLayerChannelsLoading(newAreLayerChannelsLoading);\n        };\n        // Change one property of a channel (for now - soon\n        // nested structures allowing for multiple z/t selecitons at once, for example).\n        const handleChannelPropertyChange = (property, value) => {\n          // property is something like \"selection\" or \"slider.\"\n          // value is the actual change, like { channel: \"DAPI\" }.\n          const update = { [property]: value };\n          if (property === 'selection') {\n            // Channel is loading until the layer callback is called\n            // by the layer, which fetches the raster data.\n            setIsLoading(true);\n            update.selection = {\n              ...globalLabelValues,\n              ...update.selection,\n            };\n            setChannel({ ...c, ...update }, channelId);\n            // Call back for raster layer handles update of UI\n            // like sliders and the loading state of the channel.\n            setRasterLayerCallback(async () => {\n              const selections = [\n                { ...channels[channelId][property], ...value },\n              ];\n              const { sliders } = await getDomainsAndSliders(\n                loader,\n                selections,\n                domainType,\n                use3d,\n              );\n              [update.slider] = sliders;\n              setChannel({ ...c, ...update }, channelId);\n              setRasterLayerCallback(null);\n              setIsLoading(false);\n            });\n          } else {\n            setChannel({ ...c, ...update }, channelId);\n          }\n        };\n        const handleChannelRemove = () => {\n          removeChannel(channelId);\n        };\n        const handleIQRUpdate = async () => {\n          const { data: loaderData } = loader;\n          const source = Array.isArray(loaderData)\n            ? loaderData[loaderData.length - 1]\n            : loaderData;\n          const raster = await source.getRaster({\n            selection: channels[channelId].selection,\n          });\n          const stats = getChannelStats(raster.data);\n          const { q1, q3 } = stats;\n          setChannel({ ...c, slider: [q1, q3] }, channelId);\n        };\n        return (\n          <ChannelController\n            // eslint-disable-next-line react/no-array-index-key\n            key={`channel-controller-${channelId}`}\n            dimName={channelLabel}\n            visibility={c.visible}\n            selectionIndex={c.selection[channelLabel]}\n            slider={c.slider}\n            color={c.color}\n            channels={channels}\n            channelId={channelId}\n            domainType={domainType}\n            loader={loader}\n            globalLabelValues={globalLabelValues}\n            theme={theme}\n            channelOptions={channelOptions}\n            colormapOn={Boolean(colormap)}\n            handlePropertyChange={handleChannelPropertyChange}\n            handleChannelRemove={handleChannelRemove}\n            handleIQRUpdate={handleIQRUpdate}\n            setRasterLayerCallback={setRasterLayerCallback}\n            isLoading={areLayerChannelsLoading[channelId]}\n            use3d={use3d}\n          />\n        );\n      },\n    );\n  }\n\n  const controllerSectionClasses = useControllerSectionStyles();\n\n  const { visible } = layer;\n  const visibleSetting = typeof visible === 'boolean' ? visible : true;\n  const Visibility = visibleSetting ? VisibilityIcon : VisibilityOffIcon;\n  // Only show Volume tabs if 3D is available.\n  const hasViewableResolutions = Boolean(\n    Array.from({\n      length: loader.data.length,\n    }).filter((_, res) => canLoadResolution(loader.data, res)).length,\n  );\n  const useVolumeTabs = !disable3d && shape[labels.indexOf('z')] > 1 && hasViewableResolutions;\n  const FullController = (\n    <>\n      <LayerOptions\n        channels={channels}\n        opacity={opacity}\n        colormap={colormap}\n        transparentColor={transparentColor}\n        domainType={domainType}\n        // Only allow for global dimension controllers that\n        // exist in the `dimensions` part of the loader.\n        globalControlLabels={labels.filter(label => GLOBAL_LABELS.includes(label))}\n        globalLabelValues={globalLabelValues}\n        handleOpacityChange={setOpacity}\n        handleColormapChange={setColormap}\n        handleGlobalChannelsSelectionChange={\n          handleGlobalChannelsSelectionChange\n        }\n        handleTransparentColorChange={setTransparentColor}\n        disableChannelsIfRgbDetected={\n          isRgb(loader) && disableChannelsIfRgbDetected\n        }\n        handleDomainChange={handleDomainChange}\n        shouldShowTransparentColor={shouldShowTransparentColor}\n        shouldShowDomain={shouldShowDomain}\n        shouldShowColormap={shouldShowColormap}\n        use3d={use3d}\n        loader={loader}\n        handleMultiPropertyChange={handleMultiPropertyChange}\n        resolution={resolution}\n        disable3d={disable3d}\n        setRasterLayerCallback={setRasterLayerCallback}\n        setAreAllChannelsLoading={setAreAllChannelsLoading}\n        setViewState={setViewState}\n        spatialHeight={spatialHeight}\n        spatialWidth={spatialWidth}\n        modelMatrix={modelMatrix}\n      />\n      {isRgb(loader) && disableChannelsIfRgbDetected\n        ? null\n        : channelControllers}\n      {isRgb(loader) && disableChannelsIfRgbDetected ? null : (\n        <Button\n          disabled={channels.length === MAX_CHANNELS}\n          onClick={handleChannelAdd}\n          fullWidth\n          variant=\"outlined\"\n          style={buttonStyles}\n          startIcon={<AddIcon />}\n          size=\"small\"\n        >\n          Add Channel\n        </Button>\n      )}\n    </>\n  );\n  return (\n    <ExpansionPanel\n      className={controllerSectionClasses.root}\n      onChange={(e, expanded) => !disabled\n        && setIsExpanded(\n          expanded && e?.target?.attributes?.role?.value === 'presentation',\n        )\n      }\n      TransitionProps={{ enter: false }}\n      expanded={!disabled && isExpanded}\n    >\n      <StyledExpansionPanelSummary\n        expandIcon={<ExpandMoreIcon />}\n        aria-controls={`layer-${name}-controls`}\n      >\n        <Grid container direction=\"column\" m={1} justify=\"center\">\n          <OverflowEllipsisGrid item>\n            <Button\n              onClick={(e) => {\n                if (!disabled) {\n                  // Needed to prevent affecting the expansion panel from changing\n                  e.stopPropagation();\n                  const nextVisible = typeof visible === 'boolean' ? !visible : false;\n                  setVisible(nextVisible);\n                }\n              }}\n              style={{\n                marginRight: 8,\n                marginBottom: 2,\n                padding: 0,\n                minWidth: 0,\n              }}\n            >\n              <Visibility />\n            </Button>\n            {name}\n          </OverflowEllipsisGrid>\n          {!disabled && !isExpanded && !use3d && (\n            <Grid\n              container\n              direction=\"row\"\n              alignItems=\"center\"\n              justify=\"center\"\n            >\n              <Grid item xs={6}>\n                <StyledInputLabel htmlFor={`layer-${name}-opacity-closed`}>\n                  Opacity:\n                </StyledInputLabel>\n              </Grid>\n              <Grid item xs={6}>\n                <Slider\n                  id={`layer-${name}-opacity-closed`}\n                  value={opacity}\n                  onChange={(e, v) => setOpacity(v)}\n                  valueLabelDisplay=\"auto\"\n                  getAriaLabel={() => 'opacity slider'}\n                  min={0}\n                  max={1}\n                  step={0.01}\n                  orientation=\"horizontal\"\n                />\n              </Grid>\n            </Grid>\n          )}\n        </Grid>\n      </StyledExpansionPanelSummary>\n      <StyledExpansionPanelDetails>\n        {useVolumeTabs ? (\n          <>\n            <Tabs\n              value={tab}\n              onChange={handleTabChange}\n              aria-label=\"simple tabs example\"\n              style={{ height: '24px', minHeight: '24px' }}\n            >\n              <Tab\n                label=\"Channels\"\n                style={{\n                  fontSize: '.75rem',\n                  bottom: 12,\n                  width: '50%',\n                  minWidth: '50%',\n                }}\n                disableRipple\n              />\n              <Tab\n                label=\"Volume\"\n                style={{\n                  fontSize: '.75rem',\n                  bottom: 12,\n                  width: '50%',\n                  minWidth: '50%',\n                }}\n              />\n            </Tabs>\n            <TabPanel value={tab} index={0}>\n              {FullController}\n            </TabPanel>\n            <TabPanel value={tab} index={1} style={{ marginTop: 4 }}>\n              <VolumeOptions\n                loader={loader}\n                handleSlicerSetting={handleSlicerSetting}\n                handleRenderingModeChange={setRenderingMode}\n                renderingMode={renderingMode}\n                xSlice={xSlice}\n                ySlice={ySlice}\n                zSlice={zSlice}\n                use3d={use3d}\n                setViewState={setViewState}\n                spatialHeight={spatialHeight}\n                spatialWidth={spatialWidth}\n                modelMatrix={modelMatrix}\n              />\n            </TabPanel>\n          </>\n        ) : (\n          FullController\n        )}\n        {shouldShowRemoveLayerButton ? (\n          <Button\n            onClick={handleLayerRemove}\n            fullWidth\n            variant=\"outlined\"\n            style={buttonStyles}\n            size=\"small\"\n          >\n            Remove Image Layer\n          </Button>\n        ) : null}\n      </StyledExpansionPanelDetails>\n    </ExpansionPanel>\n  );\n}\n", "import React from 'react';\nimport range from 'lodash/range';\nimport { Matrix4 } from 'math.gl';\nimport Grid from '@material-ui/core/Grid';\nimport Slider from '@material-ui/core/Slider';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport Select from '@material-ui/core/Select';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport { getDefaultInitialViewState } from '@hms-dbmi/viv';\n\nimport {\n  getBoundingCube, getMultiSelectionStats,\n} from './utils';\nimport {\n  COLORMAP_OPTIONS,\n  canLoadResolution,\n  formatBytes,\n  getStatsForResolution,\n} from '../utils';\nimport { DEFAULT_RASTER_DOMAIN_TYPE } from '../spatial/constants';\nimport { StyledSelectionSlider, useSelectStyles } from './styles';\n\nconst DOMAIN_OPTIONS = ['Full', 'Min/Max'];\n\n/**\n * Wrapper for the dropdown that selects a colormap (None, viridis, magma, etc.).\n * @prop {Object} loader Loader object with metadata.\n * @prop {function} handleMultiPropertyChange Function to propgate multiple layer changes at once.\n * This prevents updates from overridding each other.\n * @prop {number} resolution Current 3D resolution.\n * @prop {boolean} disable3d Whether or not to enable 3D selection\n * @prop {function} setRasterLayerCallback Setter for callbacks that fire after raster/volume loads.\n * @prop {function} setAreAllChannelsLoading Setter for whether or not a given channel is loading.\n * @prop {Object} setViewState Setter for the current view state.\n * @prop {number} spatialHeight Height of the spatial component.\n * @prop {number} spatialWidth Width of the spatial component.\n * @prop {object} channels Channels object.\n * @prop {boolean} use3d Whether or not 3D is enabled for this layer.\n */\nfunction VolumeDropdown({\n  loader: loaderWithMeta,\n  handleMultiPropertyChange,\n  resolution: currResolution,\n  disable3d,\n  setRasterLayerCallback,\n  setAreAllChannelsLoading,\n  setViewState,\n  spatialHeight,\n  spatialWidth,\n  channels,\n  use3d,\n  modelMatrix,\n}) {\n  const classes = useSelectStyles();\n  const selections = channels.map(i => i.selection);\n  const { data: loader } = loaderWithMeta;\n  const handleChange = async (val) => {\n    // val is the resolution - null indicates 2D\n    const shouldUse3D = typeof val === 'number';\n    setAreAllChannelsLoading(true);\n    setRasterLayerCallback(() => {\n      setAreAllChannelsLoading(false);\n      setRasterLayerCallback(null);\n    });\n    if (shouldUse3D) {\n      const [xSlice, ySlice, zSlice] = getBoundingCube(loader);\n      const propertiesChanged = {\n        resolution: val,\n        xSlice,\n        ySlice,\n        zSlice,\n        use3d: shouldUse3D,\n      };\n      // Only make the fetch if needed i.e if the 3d was just being turned on.\n      if (!use3d) {\n        const { sliders } = await getMultiSelectionStats({\n          loader,\n          selections,\n          use3d: shouldUse3D,\n        });\n        propertiesChanged.channels = [...channels];\n        propertiesChanged.channels.forEach((ch, i) => {\n          // eslint-disable-next-line no-param-reassign\n          ch.slider = sliders[i];\n        });\n      }\n      // Update all properties at once to avoid overriding calls.\n      handleMultiPropertyChange(propertiesChanged);\n      const defaultViewState = getDefaultInitialViewState(loader,\n        { height: spatialHeight, width: spatialWidth }, 1.5, true, new Matrix4(modelMatrix));\n      setViewState({\n        ...defaultViewState,\n        rotationX: 0,\n        rotationOrbit: 0,\n      });\n    } else {\n      const { sliders } = await getMultiSelectionStats({\n        loader, selections, use3d: shouldUse3D,\n      });\n      const newChannels = [...channels];\n      newChannels.forEach((ch, i) => {\n        // eslint-disable-next-line no-param-reassign\n        ch.slider = sliders[i];\n      });\n      // Update all properties at once to avoid overriding calls.\n      handleMultiPropertyChange({\n        resolution: val,\n        use3d: shouldUse3D,\n        spatialAxisFixed: false,\n        channels: newChannels,\n      });\n      const defaultViewState = getDefaultInitialViewState(loader,\n        { height: spatialHeight, width: spatialWidth }, 0.5, false, new Matrix4(modelMatrix));\n      setViewState({\n        ...defaultViewState,\n        rotationX: null,\n        rotationOrbit: null,\n        orbitAxis: null,\n      });\n    }\n  };\n  const { labels, shape } = Array.isArray(loader) ? loader[0] : loader;\n  const hasZStack = shape[labels.indexOf('z')] > 1;\n  return (\n    <>\n      <Select\n        native\n        value={currResolution}\n        onChange={e => handleChange(\n          e.target.value === '2D' ? e.target.value : Number(e.target.value),\n        )\n        }\n        classes={{ root: classes.selectRoot }}\n      >\n        {\n          <option key=\"2D\" value=\"2D\">\n            2D Visualization\n          </option>\n        }\n        {Array.from({ length: loader.length })\n          .fill(0)\n          // eslint-disable-next-line no-unused-vars\n          .map((_, resolution) => {\n            if (loader) {\n              if (canLoadResolution(loader, resolution)) {\n                const {\n                  height,\n                  width,\n                  depthDownsampled,\n                  totalBytes,\n                } = getStatsForResolution(loader, resolution);\n                return (\n                  <option\n                    key={`(${height}, ${width}, ${depthDownsampled})`}\n                    value={resolution}\n                    disabled={\n                      disable3d\n                      || !hasZStack\n                    }\n                  >\n                    {`3D: ${resolution}x Downsampled, ~${formatBytes(\n                      totalBytes,\n                    )} per channel, (${height}, ${width}, ${depthDownsampled})`}\n                  </option>\n                );\n              }\n            }\n            return null;\n          })}\n      </Select>\n    </>\n  );\n}\n\n\n/**\n * Wrapper for the dropdown that selects a colormap (None, viridis, magma, etc.).\n * @prop {string} value Currently selected value for the colormap.\n * @prop {string} inputId Css id.\n * @prop {function} handleChange Callback for every change in colormap.\n */\nfunction ColormapSelect({ value, inputId, handleChange }) {\n  const classes = useSelectStyles();\n  return (\n    <Select\n      native\n      onChange={e => handleChange(e.target.value === '' ? null : e.target.value)}\n      value={value}\n      inputProps={{ name: 'colormap', id: inputId }}\n      style={{ width: '100%' }}\n      classes={{ root: classes.selectRoot }}\n    >\n      <option aria-label=\"None\" value=\"\">None</option>\n      {COLORMAP_OPTIONS.map(name => (\n        <option key={name} value={name}>\n          {name}\n        </option>\n      ))}\n    </Select>\n  );\n}\n\nfunction TransparentColorCheckbox({ value, handleChange }) {\n  return (\n    <Checkbox\n      style={{ float: 'left', padding: 0 }}\n      color=\"default\"\n      onChange={() => {\n        if (value) {\n          handleChange(null);\n        } else {\n          handleChange([0, 0, 0]);\n        }\n      }}\n      checked={Boolean(value)}\n    />\n  );\n}\n\n/**\n * Wrapper for the slider that updates opacity.\n * @prop {string} value Currently selected value between 0 and 1.\n * @prop {function} handleChange Callback for every change in opacity.\n */\nfunction OpacitySlider({ value, handleChange }) {\n  return (\n    <Slider\n      value={value}\n      onChange={(e, v) => handleChange(v)}\n      valueLabelDisplay=\"auto\"\n      getAriaLabel={() => 'opacity slider'}\n      min={0}\n      max={1}\n      step={0.01}\n      orientation=\"horizontal\"\n      style={{ marginTop: '7px' }}\n    />\n  );\n}\n\n/**\n * Wrapper for the dropdown that chooses the domain type.\n * @prop {string} value Currently selected value (i.e 'Max/Min').\n * @prop {string} inputId Css id.\n * @prop {function} handleChange Callback for every change in domain.\n */\nfunction SliderDomainSelector({ value, inputId, handleChange }) {\n  const classes = useSelectStyles();\n  return (\n    <Select\n      native\n      onChange={e => handleChange(e.target.value)}\n      value={value}\n      inputProps={{ name: 'domain-selector', id: inputId }}\n      style={{ width: '100%' }}\n      classes={{ root: classes.selectRoot }}\n    >\n      {DOMAIN_OPTIONS.map(name => (\n        <option key={name} value={name}>\n          {name}\n        </option>\n      ))}\n    </Select>\n  );\n}\n\n/**\n * Wrapper for the slider that chooses global selections (z, t etc.).\n * @prop {string} field The dimension this selects for (z, t etc.).\n * @prop {number} value Currently selected index (1, 4, etc.).\n * @prop {function} handleChange Callback for every change in selection.\n * @prop {function} possibleValues All available values for the field.\n */\nfunction GlobalSelectionSlider({\n  field,\n  value,\n  handleChange,\n  possibleValues,\n}) {\n  return (\n    <StyledSelectionSlider\n      value={value}\n      // See https://github.com/hms-dbmi/viv/issues/176 for why\n      // we have the two handlers.\n      onChange={\n        (event, newValue) => {\n          handleChange({ selection: { [field]: newValue }, event });\n        }\n      }\n      onChangeCommitted={\n        (event, newValue) => {\n          handleChange({ selection: { [field]: newValue }, event });\n        }\n      }\n      valueLabelDisplay=\"auto\"\n      getAriaLabel={() => `${field} slider`}\n      marks={possibleValues.map(val => ({ value: val }))}\n      min={Number(possibleValues[0])}\n      max={Number(possibleValues.slice(-1))}\n      orientation=\"horizontal\"\n      step={null}\n    />\n  );\n}\n\n/**\n * Wrapper for each of the options to show its name and then its UI component.\n * @prop {string} name Display name for option.\n * @prop {number} opacity Current opacity value.\n * @prop {string} inputId An id for css.\n * @prop {object} children Components to be rendered next to the name (slider, dropdown etc.).\n */\nfunction LayerOption({ name, inputId, children }) {\n  return (\n    <Grid container direction=\"row\" alignItems=\"center\" justify=\"center\">\n      <Grid item xs={6}>\n        <InputLabel htmlFor={inputId}>{name}:</InputLabel>\n      </Grid>\n      <Grid item xs={6}>\n        {children}\n      </Grid>\n    </Grid>\n  );\n}\n\n/**\n * Gloabl options for all channels (opacity, colormap, etc.).\n * @prop {string} colormap What colormap is currently selected (None, viridis etc.).\n * @prop {number} opacity Current opacity value.\n * @prop {function} handleColormapChange Callback for when colormap changes.\n * @prop {function} handleOpacityChange Callback for when opacity changes.\n * @prop {object} globalControlLabels All available options for global control (z and t).\n * @prop {function} handleGlobalChannelsSelectionChange Callback for global selection changes.\n * @prop {function} handleDomainChange Callback for domain type changes (full or min/max).\n * @prop {array} channels Current channel object for inferring the current global selection.\n * @prop {array} dimensions Currently available dimensions (channel, z, t etc.).\n * @prop {string} domainType One of Max/Min or Full (soon presets as well).\n * @prop {boolean} disableChannelsIfRgbDetected Whether or not we need colormap controllers if RGB.\n */\nfunction LayerOptions({\n  colormap,\n  opacity,\n  handleColormapChange,\n  handleOpacityChange,\n  handleTransparentColorChange,\n  globalControlLabels,\n  globalLabelValues,\n  handleGlobalChannelsSelectionChange,\n  handleSliderChange,\n  handleDomainChange,\n  transparentColor,\n  channels,\n  domainType,\n  disableChannelsIfRgbDetected,\n  shouldShowTransparentColor,\n  shouldShowDomain,\n  shouldShowColormap,\n  use3d,\n  loader,\n  handleMultiPropertyChange,\n  resolution,\n  disable3d,\n  setRasterLayerCallback,\n  setAreAllChannelsLoading,\n  setViewState,\n  spatialHeight,\n  spatialWidth,\n  modelMatrix,\n}) {\n  const { labels, shape } = Array.isArray(loader.data) ? loader.data[0] : loader.data;\n  const hasDimensionsAndChannels = labels.length > 0 && channels.length > 0;\n  const hasZStack = shape[labels.indexOf('z')] > 1;\n  // Only show volume button if we can actually view resolutions.\n  const hasViewableResolutions = Boolean(Array.from({\n    length: loader.data.length,\n  }).filter((_, res) => canLoadResolution(loader.data, res)).length);\n  return (\n    <Grid container direction=\"column\" style={{ width: '100%' }}>\n      {hasZStack\n        && !disable3d\n        && hasViewableResolutions\n        && (\n        <VolumeDropdown\n          loader={loader}\n          handleSliderChange={handleSliderChange}\n          handleDomainChange={handleDomainChange}\n          channels={channels}\n          handleMultiPropertyChange={handleMultiPropertyChange}\n          resolution={resolution}\n          disable3d={disable3d}\n          setRasterLayerCallback={setRasterLayerCallback}\n          setAreAllChannelsLoading={setAreAllChannelsLoading}\n          setViewState={setViewState}\n          spatialHeight={spatialHeight}\n          spatialWidth={spatialWidth}\n          use3d={use3d}\n          modelMatrix={modelMatrix}\n        />\n        )\n      }\n      {hasDimensionsAndChannels\n        && !use3d\n        && globalControlLabels.map(\n          field => shape[labels.indexOf(field)] > 1 && (\n          <LayerOption name={field} inputId={`${field}-slider`} key={field}>\n            <GlobalSelectionSlider\n              field={field}\n              value={globalLabelValues[field]}\n              handleChange={handleGlobalChannelsSelectionChange}\n              possibleValues={range(shape[labels.indexOf(field)])}\n            />\n          </LayerOption>\n          ),\n        )}\n      {!disableChannelsIfRgbDetected ? (\n        <>\n          {shouldShowColormap && (\n            <Grid item>\n              <LayerOption name=\"Colormap\" inputId=\"colormap-select\">\n                <ColormapSelect\n                  value={colormap || ''}\n                  inputId=\"colormap-select\"\n                  handleChange={handleColormapChange}\n                />\n              </LayerOption>\n            </Grid>\n          )}\n          {shouldShowDomain && (\n            <Grid item>\n              <LayerOption name=\"Domain\" inputId=\"domain-selector\">\n                <SliderDomainSelector\n                  value={domainType || DEFAULT_RASTER_DOMAIN_TYPE}\n                  handleChange={(value) => {\n                    handleDomainChange(value);\n                  }}\n                />\n              </LayerOption>\n            </Grid>\n          )}\n        </>\n      ) : null}\n      {!use3d && (\n        <Grid item>\n          <LayerOption name=\"Opacity\" inputId=\"opacity-slider\">\n            <OpacitySlider value={opacity} handleChange={handleOpacityChange} />\n          </LayerOption>\n        </Grid>\n      )}\n      {shouldShowTransparentColor && !use3d && (\n        <Grid item>\n          <LayerOption\n            name=\"Zero Transparent\"\n            inputId=\"transparent-color-selector\"\n          >\n            <TransparentColorCheckbox\n              value={transparentColor}\n              handleChange={handleTransparentColorChange}\n            />\n          </LayerOption>\n        </Grid>\n      )}\n    </Grid>\n  );\n}\n\nexport default LayerOptions;\n", "import React from 'react';\nimport { Matrix4 } from 'math.gl';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles, createStyles } from '@material-ui/core/styles';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport Slider from '@material-ui/core/Slider';\nimport { RENDERING_MODES, getDefaultInitialViewState } from '@hms-dbmi/viv';\nimport { abbreviateNumber, getBoundingCube } from './utils';\nimport { useSelectStyles } from './styles';\n\nconst useSlicerStyles = makeStyles(theme => createStyles({\n  enabled: {},\n  disabled: {\n    color: theme.palette.text.disabled,\n    // Because of the .5 opacity of the disabled color in the theme, and the fact\n    // that there are multiple overlaid parts to the slider,\n    // this needs to be set manually for the desired effect.\n    '& .MuiSlider-thumb': {\n      color: 'rgb(100, 100, 100, 1.0)',\n    },\n    '&  .MuiSlider-track': {\n      color: 'rgb(100, 100, 100, 1.0)',\n    },\n  },\n}));\n\nconst Slicer = ({\n  xSlice,\n  ySlice,\n  zSlice,\n  handleSlicerSetting,\n  loader,\n  use3d,\n}) => {\n  const [xSliceInit, ySliceInit, zSliceInit] = getBoundingCube(loader.data);\n  const sliceValuesAndSetSliceFunctions = [\n    [\n      xSlice,\n      xSliceNew => handleSlicerSetting('x', xSliceNew),\n      'x',\n      xSliceInit,\n    ],\n    [\n      ySlice,\n      ySliceNew => handleSlicerSetting('y', ySliceNew),\n      'y',\n      ySliceInit,\n    ],\n    [\n      zSlice,\n      zSliceNew => handleSlicerSetting('z', zSliceNew),\n      'z',\n      zSliceInit,\n    ],\n  ];\n  const classes = useSlicerStyles();\n  const Slicers = sliceValuesAndSetSliceFunctions.map(\n    ([val, setVal, label, [min, max]]) => (\n      <Grid\n        container\n        direction=\"row\"\n        justify=\"flex-start\"\n        alignItems=\"center\"\n        key={label}\n      >\n        <Grid item xs={1}>\n          <Typography\n            className={!use3d ? classes.disabled : classes.enabled}\n            style={{ marginBottom: 0 }}\n          >\n            {label}:\n          </Typography>\n        </Grid>\n        <Grid item xs={11}>\n          <Slider\n            disabled={!use3d}\n            className={!use3d ? classes.disabled : classes.enabled}\n            value={val}\n            onChange={(e, v) => setVal(v)}\n            valueLabelDisplay=\"auto\"\n            valueLabelFormat={v => abbreviateNumber(v)}\n            getAriaLabel={() => `${label} slider`}\n            min={min}\n            max={max}\n            step={0.005}\n            orientation=\"horizontal\"\n          />\n        </Grid>\n      </Grid>\n    ),\n  );\n  return (\n    <>\n      <Typography\n        className={!use3d ? classes.disabled : classes.enabled}\n        style={{ marginTop: 16, marginBottom: 0 }}\n      >\n        Clipping Planes:{' '}\n      </Typography>{' '}\n      {Slicers}\n    </>\n  );\n};\n\nconst renderingOptions = Object.values(RENDERING_MODES);\n\nfunction RenderingModeSelect({\n  handleRenderingModeChange,\n  renderingMode,\n  use3d,\n}) {\n  const classes = useSelectStyles();\n  // Empty option allows for displaying the title of the dropdown fully in the UI.\n  const options = !use3d ? [...renderingOptions, ''] : renderingOptions;\n  return (\n    <FormControl fullWidth>\n      <InputLabel htmlFor=\"rendering-mode-select\">Rendering Mode</InputLabel>\n      <Select\n        native\n        onChange={e => handleRenderingModeChange(e.target.value)}\n        value={use3d ? renderingMode : ''}\n        inputProps={{\n          name: 'rendering-mode',\n          id: 'rendering-mode-select',\n        }}\n        disabled={!use3d}\n        classes={{ root: classes.selectRoot }}\n      >\n        {options.map(name => (\n          <option key={name} value={name}>\n            {name}\n          </option>\n        ))}\n      </Select>\n    </FormControl>\n  );\n}\n\nconst ReCenterButton = ({\n  setViewState,\n  use3d,\n  spatialHeight,\n  spatialWidth,\n  loader,\n  modelMatrix,\n}) => (\n  <Grid item xs=\"auto\" key=\"recenter\">\n    <Button\n      onClick={() => {\n        const defaultViewState = getDefaultInitialViewState(\n          loader.data,\n          { height: spatialHeight, width: spatialWidth },\n          1.5,\n          use3d,\n          new Matrix4(modelMatrix),\n        );\n        setViewState({\n          ...defaultViewState,\n          rotationX: 0,\n          rotationOrbit: 0,\n        });\n      }\n        }\n      disabled={!use3d}\n      style={{\n        padding: 0,\n        marginBottom: 6,\n      }}\n    >\n        Re-Center\n    </Button>\n  </Grid>\n);\n\nconst VolumeOptions = ({\n  handleSlicerSetting,\n  handleRenderingModeChange,\n  renderingMode,\n  xSlice,\n  ySlice,\n  zSlice,\n  use3d,\n  loader,\n  setViewState,\n  spatialHeight,\n  spatialWidth,\n  modelMatrix,\n}) => (\n  <>\n    <RenderingModeSelect\n      handleRenderingModeChange={handleRenderingModeChange}\n      renderingMode={renderingMode}\n      use3d={use3d}\n    />\n    <Slicer\n      xSlice={xSlice}\n      ySlice={ySlice}\n      zSlice={zSlice}\n      handleSlicerSetting={handleSlicerSetting}\n      use3d={use3d}\n      loader={loader}\n    />\n    <ReCenterButton\n      setViewState={setViewState}\n      use3d={use3d}\n      spatialHeight={spatialHeight}\n      spatialWidth={spatialWidth}\n      loader={loader}\n      modelMatrix={modelMatrix}\n    />\n  </>\n);\n\nexport default VolumeOptions;\n", "import React, { useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport AddIcon from '@material-ui/icons/Add';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport { PopperMenu } from '../shared-mui/components';\n\nconst useStyles = makeStyles(() => ({\n  addButton: {\n    marginTop: '10px',\n    marginBottom: '10px',\n    fontWeight: 400,\n  },\n}));\n\nfunction ImageAddIcon() {\n  return (\n    <>\n      <AddIcon />\n      Add Image Layer\n    </>\n  );\n}\n\nfunction ImageAddButton({ imageOptions, handleImageAdd }) {\n  const [open, setOpen] = useState(false);\n  const classes = useStyles();\n\n  const handleAdd = (imgData) => {\n    setOpen(prev => !prev);\n    handleImageAdd(imgData);\n  };\n\n  if (!imageOptions) return null;\n  return (\n    <PopperMenu\n      open={open}\n      setOpen={setOpen}\n      buttonIcon={<ImageAddIcon />}\n      buttonClassName={classes.addButton}\n    >\n      {imageOptions.map((imgData, i) => (\n        <MenuItem dense key={imgData.name} onClick={() => handleAdd(i)}>\n          <span>{imgData.name}</span>\n        </MenuItem>\n      ))}\n    </PopperMenu>\n  );\n}\n\nexport default ImageAddButton;\n", "import React from 'react';\nimport TitleInfo from '../TitleInfo';\nimport { useReady, useUrls, useGridItemSize } from '../hooks';\nimport HiGlassLazy from './HiGlassLazy';\n\nconst HIGLASS_DATA_TYPES = [];\n\n/**\n * A wrapper around HiGlass (http://higlass.io/).\n * The HiGlassComponent react component is loaded lazily.\n * @prop {object} hgViewConfig A HiGlass viewconfig object to pass\n * to the HiGlassComponent viewConfig prop.\n * @prop {object} hgOptions An optional HiGlass object to pass\n * to the HiGlassComponent hgOptions prop.\n * @prop {function} removeGridComponent A grid component removal handler\n * to pass to the TitleInfo component.\n * @prop {function} onReady A callback function to signal that the component is ready.\n */\nexport default function HiGlassSubscriber(props) {\n  const {\n    coordinationScopes,\n    theme,\n    hgViewConfig,\n    removeGridComponent,\n  } = props;\n\n  // eslint-disable-next-line no-unused-vars\n  const [width, height, containerRef] = useGridItemSize();\n\n  const [\n    isReady,\n    setItemIsReady, // eslint-disable-line no-unused-vars\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems, // eslint-disable-line no-unused-vars\n  ] = useReady(\n    HIGLASS_DATA_TYPES,\n  );\n  // eslint-disable-next-line no-unused-vars\n  const [urls, addUrl, resetUrls] = useUrls();\n\n  return (\n    <div className=\"higlass-title-wrapper\">\n      <TitleInfo\n        title=\"HiGlass\"\n        removeGridComponent={removeGridComponent}\n        theme={theme}\n        isReady={isReady}\n        urls={urls}\n      >\n        <div className=\"higlass-lazy-wrapper\" ref={containerRef}>\n          <HiGlassLazy\n            coordinationScopes={coordinationScopes}\n            theme={theme}\n            hgViewConfig={hgViewConfig}\n            height={height}\n          />\n        </div>\n      </TitleInfo>\n    </div>\n  );\n}\n", "import React, {\n  useMemo, useEffect, useRef, Suspense, useState,\n} from 'react';\nimport ReactDOM from 'react-dom';\nimport dynamicImportPolyfill from 'dynamic-import-polyfill';\nimport register from 'higlass-register';\nimport { ZarrMultivecDataFetcher } from 'higlass-zarr-datafetchers';\nimport packageJson from '../../../package.json';\nimport { createWarningComponent, asEsModule } from '../utils';\nimport { useGridItemSize } from '../hooks';\nimport {\n  useCoordination,\n} from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\n\nconst PIXI_BUNDLE_VERSION = packageJson.dependencies['window-pixi'];\nconst HIGLASS_BUNDLE_VERSION = packageJson.dependencies.higlass;\nconst BUNDLE_FILE_EXT = process.env.NODE_ENV === 'development' ? 'js' : 'min.js';\nconst PIXI_BUNDLE_URL = `https://unpkg.com/window-pixi@${PIXI_BUNDLE_VERSION}/dist/pixi.${BUNDLE_FILE_EXT}`;\nconst HIGLASS_BUNDLE_URL = `https://unpkg.com/higlass@${HIGLASS_BUNDLE_VERSION}/dist/hglib.${BUNDLE_FILE_EXT}`;\n\n\n// Initialize the dynamic __import__() function.\ndynamicImportPolyfill.initialize();\n\n// Register the zarr-multivec plugin data fetcher.\n// References:\n// https://github.com/higlass/higlass-register\n// https://github.com/higlass/higlass-zarr-datafetchers\nregister(\n  { dataFetcher: ZarrMultivecDataFetcher, config: ZarrMultivecDataFetcher.config },\n  { pluginType: 'dataFetcher' },\n);\n\n// Lazy load the HiGlass React component,\n// using dynamic imports with absolute URLs.\nconst HiGlassComponent = React.lazy(() => {\n  if (!window.React) {\n    window.React = React;\n  }\n  if (!window.ReactDOM) {\n    window.ReactDOM = ReactDOM;\n  }\n  return new Promise((resolve) => {\n    const handleImportError = (e) => {\n      console.warn(e);\n      resolve(asEsModule(createWarningComponent({\n        title: 'Could not load HiGlass',\n        message: 'The HiGlass scripts could not be dynamically imported.',\n      })));\n    };\n      // eslint-disable-next-line no-undef\n    __import__(PIXI_BUNDLE_URL).then(() => {\n      // eslint-disable-next-line no-undef\n      __import__(HIGLASS_BUNDLE_URL).then(() => {\n        // React.lazy promise must return an ES module with the\n        // component as the default export.\n        resolve(asEsModule(window.hglib.HiGlassComponent));\n      }).catch(handleImportError);\n    }).catch(handleImportError);\n  });\n});\n\n// Use an arbitrary size for normalization of the zoom level.\n// (800 means 800 px width for the full genome)\nconst HG_SIZE = 800;\n\n/**\n   * A wrapper around HiGlass (http://higlass.io/).\n   * The HiGlassComponent react component is loaded lazily.\n   * @prop {object} hgViewConfig A HiGlass viewconfig object to pass\n   * to the HiGlassComponent viewConfig prop.\n   * @prop {object} hgOptions An optional HiGlass object to pass\n   * to the HiGlassComponent hgOptions prop.\n   * @prop {function} removeGridComponent A grid component removal handler\n   * to pass to the TitleInfo component.\n   * @prop {function} onReady A callback function to signal that the component is ready.\n   */\nexport default function HiGlassLazy(props) {\n  const {\n    coordinationScopes,\n    theme,\n    hgViewConfig: hgViewConfigProp,\n    hgOptions: hgOptionsProp,\n    genomeSize,\n    height,\n  } = props;\n\n  // Get \"props\" from the coordination space.\n  const [{\n    genomicZoomX,\n    genomicZoomY,\n    genomicTargetX,\n    genomicTargetY,\n  }, {\n    setGenomicZoomX,\n    setGenomicZoomY,\n    setGenomicTargetX,\n    setGenomicTargetY,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.higlass, coordinationScopes);\n\n  // eslint-disable-next-line no-unused-vars\n  const [width, computedHeight, containerRef] = useGridItemSize();\n  const [hgInstance, setHgInstance] = useState();\n  const isActiveRef = useRef();\n\n  const hgOptions = useMemo(() => ({\n    ...hgOptionsProp,\n    theme,\n  }), [hgOptionsProp, theme]);\n\n  const hgViewConfig = useMemo(() => {\n    // HiGlass needs the start and end absolute genome coordinates\n    const centerX = genomicTargetX;\n    const genomesPerUnitX = genomeSize / (2 ** genomicZoomX);\n    const unitX = width / HG_SIZE;\n    const initialXDomain = [\n      centerX - genomesPerUnitX * unitX / 2,\n      centerX + genomesPerUnitX * unitX / 2,\n    ];\n    const centerY = genomicTargetY;\n    const genomesPerUnitY = genomeSize / (2 ** genomicZoomY);\n    const unitY = height / HG_SIZE;\n    const initialYDomain = [\n      centerY - genomesPerUnitY * unitY / 2,\n      centerY + genomesPerUnitY * unitY / 2,\n    ];\n    return {\n      editable: false,\n      zoomFixed: false,\n      trackSourceServers: [\n        '//higlass.io/api/v1',\n      ],\n      exportViewUrl: '//higlass.io/api/v1/viewconfs',\n      views: [\n        {\n          uid: 'main',\n          ...hgViewConfigProp,\n          initialXDomain,\n          initialYDomain,\n        },\n      ],\n      zoomLocks: {\n        locksByViewUid: {},\n        locksDict: {},\n      },\n      locationLocks: {\n        locksByViewUid: {},\n        locksDict: {},\n      },\n      valueScaleLocks: {\n        locksByViewUid: {},\n        locksDict: {},\n      },\n    };\n  }, [genomicTargetX, genomeSize, genomicZoomX, width, genomicTargetY,\n    genomicZoomY, height, hgViewConfigProp]);\n\n  useEffect(() => {\n    const handleMouseEnter = () => {\n      isActiveRef.current = true;\n    };\n    const handleMouseLeave = () => {\n      isActiveRef.current = false;\n    };\n    const container = containerRef.current;\n    container.addEventListener('mouseenter', handleMouseEnter);\n    container.addEventListener('mouseleave', handleMouseLeave);\n    return () => {\n      container.removeEventListener('mouseenter', handleMouseEnter);\n      container.removeEventListener('mouseenter', handleMouseLeave);\n    };\n  }, [containerRef]);\n\n\n  useEffect(() => {\n    if (!hgInstance) {\n      return () => {};\n    }\n    hgInstance.api.on('viewConfig', (viewConfigString) => {\n      // Only set if the user mouse is over this component (\"is active\").\n      // Otherwise, this could be an initial on viewConfig change callback from a sibling,\n      // which will cause an infinite loop.\n      if (!isActiveRef.current) {\n        return;\n      }\n      const viewConfig = JSON.parse(viewConfigString);\n      const xDomain = viewConfig.views[0].initialXDomain;\n      const yDomain = viewConfig.views[0].initialYDomain;\n\n      const nextGenomicZoomX = Math.log2(\n        genomeSize / ((xDomain[1] - xDomain[0]) * (HG_SIZE / width)),\n      );\n      const nextGenomicZoomY = Math.log2(\n        genomeSize / ((yDomain[1] - yDomain[0]) * (HG_SIZE / height)),\n      );\n      const nextGenomicTargetX = xDomain[0] + (xDomain[1] - xDomain[0]) / 2;\n      const nextGenomicTargetY = yDomain[0] + (yDomain[1] - yDomain[0]) / 2;\n      setGenomicZoomX(nextGenomicZoomX);\n      setGenomicZoomY(nextGenomicZoomY);\n      setGenomicTargetX(nextGenomicTargetX);\n      setGenomicTargetY(nextGenomicTargetY);\n    });\n    return () => hgInstance.api.off('viewConfig');\n  }, [hgInstance, genomeSize, width, height, setGenomicZoomX, setGenomicZoomY,\n    setGenomicTargetX, setGenomicTargetY]);\n\n  return (\n    <div className=\"higlass-wrapper-parent\">\n      <div className=\"higlass-wrapper\" ref={containerRef} style={{ height: `${height}px` }}>\n        <Suspense fallback={<div>Loading...</div>}>\n          <HiGlassComponent\n            ref={setHgInstance}\n            zoomFixed={false}\n            viewConfig={hgViewConfig}\n            options={hgOptions}\n          />\n        </Suspense>\n      </div>\n    </div>\n  );\n}\n\nHiGlassLazy.defaultProps = {\n  hgOptions: {\n    bounded: true,\n    pixelPreciseMarginPadding: true,\n    containerPaddingX: 0,\n    containerPaddingY: 0,\n    sizeMode: 'default',\n  },\n  genomeSize: 3100000000,\n};\n", "import React, { useMemo, useEffect } from 'react';\nimport TitleInfo from '../TitleInfo';\nimport { useCoordination, useLoaders } from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport { useUrls, useReady, useGridItemSize } from '../hooks';\nimport { mergeCellSets } from '../utils';\nimport { useCellSetsData } from '../data-hooks';\nimport { treeToSetSizesBySetNames } from './cell-set-utils';\nimport CellSetSizesPlot from './CellSetSizesPlot';\n\nconst CELL_SET_SIZES_DATA_TYPES = ['cell-sets'];\n\n/**\n * A subscriber component for `CellSetSizePlot`,\n * which listens for cell sets data updates and\n * `GRID_RESIZE` events.\n * @param {object} props\n * @param {function} props.removeGridComponent The grid component removal function.\n * @param {function} props.onReady The function to call when the subscriptions\n * have been made.\n * @param {string} props.theme The name of the current Vitessce theme.\n * @param {string} props.title The component title.\n */\nexport default function CellSetSizesPlotSubscriber(props) {\n  const {\n    coordinationScopes,\n    removeGridComponent,\n    theme,\n    title = 'Cell Set Sizes',\n  } = props;\n\n  const loaders = useLoaders();\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    cellSetSelection,\n    cellSetColor,\n    additionalCellSets,\n  }, {\n    setCellSetSelection,\n    setCellSetColor,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.cellSetSizes, coordinationScopes);\n\n  const [width, height, containerRef] = useGridItemSize();\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    CELL_SET_SIZES_DATA_TYPES,\n  );\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [cellSets] = useCellSetsData(\n    loaders, dataset, setItemIsReady, addUrl, true,\n    { setCellSetSelection, setCellSetColor },\n    { cellSetSelection, cellSetColor },\n  );\n\n  const mergedCellSets = useMemo(\n    () => mergeCellSets(cellSets, additionalCellSets),\n    [cellSets, additionalCellSets],\n  );\n\n  // From the cell sets hierarchy and the list of selected cell sets,\n  // generate the array of set sizes data points for the bar plot.\n  const data = useMemo(() => (mergedCellSets && cellSetSelection && cellSetColor\n    ? treeToSetSizesBySetNames(mergedCellSets, cellSetSelection, cellSetColor, theme)\n    : []\n  ), [mergedCellSets, cellSetSelection, cellSetColor, theme]);\n\n  return (\n    <TitleInfo\n      title={title}\n      removeGridComponent={removeGridComponent}\n      urls={urls}\n      theme={theme}\n      isReady={isReady}\n    >\n      <div ref={containerRef} className=\"vega-container\">\n        <CellSetSizesPlot\n          data={data}\n          theme={theme}\n          width={width}\n          height={height}\n        />\n      </div>\n    </TitleInfo>\n  );\n}\n", "import React from 'react';\nimport clamp from 'lodash/clamp';\nimport { VegaPlot, VEGA_THEMES } from '../vega';\nimport { colorArrayToString } from './utils';\n\n/**\n * Cell set sizes displayed as a bar chart,\n * implemented with the VegaPlot component.\n * @param {object} props\n * @param {object[]} props.data The set size data, an array\n * of objects with properties `name`, `key`, `color`, and `size`.\n * @param {string} props.theme The name of the current Vitessce theme.\n * @param {number} props.width The container width.\n * @param {number} props.height The container height.\n * @param {number} props.marginRight The size of the margin\n * on the right side of the plot, to account for the vega menu button.\n * By default, 90.\n * @param {number} props.marginBottom The size of the margin\n * on the bottom of the plot, to account for long x-axis labels.\n * By default, 120.\n * @param {number} props.keyLength The length of the `key` property of\n * each data point. Assumes all key strings have the same length.\n * By default, 36.\n */\nexport default function CellSetSizesPlot(props) {\n  const {\n    data: rawData,\n    theme,\n    width,\n    height,\n    marginRight = 90,\n    marginBottom = 120,\n    keyLength = 36,\n  } = props;\n\n  // Add a property `keyName` which concatenates the key and the name,\n  // which is both unique and can easily be converted\n  // back to the name by taking a substring.\n  // Add a property `colorString` which contains the `[r, g, b]` color\n  // after converting to a color hex string.\n  const data = rawData.map(d => ({\n    ...d,\n    keyName: d.key + d.name,\n    colorString: colorArrayToString(d.color),\n  }));\n\n  // Manually set the color scale so that Vega-Lite does\n  // not choose the colors automatically.\n  const colors = {\n    domain: data.map(d => d.key),\n    range: data.map(d => d.colorString),\n  };\n\n  // Get an array of keys for sorting purposes.\n  const keys = data.map(d => d.keyName);\n\n  const spec = {\n    mark: { type: 'bar' },\n    encoding: {\n      x: {\n        field: 'keyName',\n        type: 'nominal',\n        axis: { labelExpr: `substring(datum.label, ${keyLength})` },\n        title: 'Cell Set',\n        sort: keys,\n      },\n      y: {\n        field: 'size',\n        type: 'quantitative',\n        title: 'Cell Set Size',\n      },\n      color: {\n        field: 'key',\n        type: 'nominal',\n        scale: colors,\n        legend: null,\n      },\n      tooltip: {\n        field: 'size',\n        type: 'quantitative',\n      },\n    },\n    width: clamp(width - marginRight, 10, Infinity),\n    height: clamp(height - marginBottom, 10, Infinity),\n    config: VEGA_THEMES[theme],\n  };\n\n  return (\n    <VegaPlot\n      data={data}\n      spec={spec}\n    />\n  );\n}\n", "import React, { Suspense, useMemo } from 'react';\nimport { Handler } from 'vega-tooltip';\nimport ReactVega from './ReactVega';\n\n// TODO: React.lazy is not working with Vitessce in the portal-ui.\n// For now, we can work around this by not using React.lazy,\n// but for performance benefits that come with lazy-loading\n// we should eventually try to resolve this issue.\n// const ReactVega = React.lazy(() => import('./ReactVega'));\n\nexport const DATASET_NAME = 'table';\n\nfunction isVega(spec) {\n  return spec.$schema === 'https://vega.github.io/schema/vega/v5.json';\n}\n\n/**\n * A wrapper around the react-vega Vega component.\n * @param {object} props\n * @param {object} spec A vega or vega-lite spec.\n * @param {object[]} data The plot data as an array of objects.\n * @param {object} signalListeners Vega signal listeners. Optional.\n */\nexport default function VegaPlot(props) {\n  const {\n    spec: partialSpec,\n    data,\n    signalListeners,\n  } = props;\n\n  const spec = {\n    ...partialSpec,\n    data: (isVega(partialSpec)\n      ? [\n        { name: DATASET_NAME },\n        ...partialSpec.data,\n      ]\n      : { name: DATASET_NAME }\n    ),\n  };\n\n  const vegaComponent = useMemo(() => (\n    <ReactVega\n      spec={spec}\n      data={{\n        [DATASET_NAME]: data,\n      }}\n      signalListeners={signalListeners}\n      tooltip={new Handler().call}\n      renderer=\"canvas\"\n      scaleFactor={3}\n    />\n  ), [spec, data, signalListeners]);\n\n  return (\n    spec && data && data.length > 0 ? (\n      <Suspense fallback={<div>Loading...</div>}>\n        {vegaComponent}\n      </Suspense>\n    ) : null\n  );\n}\n", "// See https://reactjs.org/docs/code-splitting.html#named-exports\nexport { Vega as default } from 'react-vega';\n", "/**\n * Vega-Lite themes that can be passed to the `config` property\n * of the vega-lite spec.\n */\nexport const VEGA_THEMES = {\n  dark: {\n    // The vega-themes dark theme.\n    // Reference: https://github.com/vega/vega-themes/blob/master/src/theme-dark.ts\n    background: null,\n    title: { color: '#fff' },\n    style: {\n      'guide-label': {\n        fill: '#fff',\n      },\n      'guide-title': {\n        fill: '#fff',\n      },\n    },\n    axis: {\n      domainColor: '#fff',\n      gridColor: '#888',\n      tickColor: '#fff',\n    },\n  },\n  light: {\n    // The default vega theme.\n    background: null,\n  },\n};\n", "import React, {\n  useMemo, useEffect,\n} from 'react';\nimport isEqual from 'lodash/isEqual';\nimport { sum } from 'd3-array';\nimport TitleInfo from '../TitleInfo';\nimport { useReady, useUrls, useGridItemSize } from '../hooks';\nimport {\n  useCoordination, useLoaders,\n} from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport { useGenomicProfilesData } from '../data-hooks';\nimport HiGlassLazy from './HiGlassLazy';\n\nconst GENOMIC_PROFILES_DATA_TYPES = ['genomic-profiles'];\n\nconst REFERENCE_TILESETS = {\n  hg38: {\n    chromosomes: 'NyITQvZsS_mOFNlz5C2LJg',\n    genes: 'P0PLbQMwTYGy-5uPIQid7A',\n  },\n  hg19: {\n    chromosomes: 'N12wVGG9SPiTkk03yUayUw',\n    genes: 'OHJakQICQD6gTD7skx4EWA',\n  },\n  mm9: {\n    chromosomes: 'WAVhNHYxQVueq6KulwgWiQ',\n    genes: 'GUm5aBiLRCyz2PsBea7Yzg',\n  },\n  mm10: {\n    chromosomes: 'EtrWT0VtScixmsmwFSd7zg',\n    genes: 'QDutvmyiSrec5nX4pA5WGQ',\n  },\n};\n\n/**\n * A component for visualization of genomic profiles\n * with genome-wide bar plots.\n * @param {object} props The component props.\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.profileTrackUidKey The key in the genomic profiles row_info that identifies\n * each track. By default, 'path'.\n * @param {string} props.profileTrackNameKey The key in the genomic profiles row_info that\n * gives a name for each track. By default, null. When null is provided, uses the\n * profileTrackUidKey for both UID and name. If UID values are path arrays,\n * they will be converted to name strings.\n * @param {string} props.higlassServer The URL for the higlass server used to retreive\n * reference tilesets for the chromosome and gene annotations.\n * @param {string} props.assembly The genome assembly to use for the reference\n * tilesets for the chromosome and gene annotations.\n * @param {string} props.title The title of the component.\n */\nexport default function GenomicProfilesSubscriber(props) {\n  const {\n    coordinationScopes,\n    theme,\n    removeGridComponent,\n    profileTrackUidKey = 'path',\n    profileTrackNameKey = null,\n    higlassServer = 'https://higlass.io/api/v1',\n    assembly = 'hg38',\n    title = 'Genomic Profiles',\n  } = props;\n\n  // eslint-disable-next-line no-unused-vars\n  const [width, height, containerRef] = useGridItemSize();\n  const loaders = useLoaders();\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    cellSetColor,\n    cellSetSelection,\n  }] = useCoordination(\n    COMPONENT_COORDINATION_TYPES.genomicProfiles,\n    coordinationScopes,\n  );\n\n  // eslint-disable-next-line no-unused-vars\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    GENOMIC_PROFILES_DATA_TYPES,\n  );\n    // eslint-disable-next-line no-unused-vars\n  const [urls, addUrl, resetUrls] = useUrls();\n\n  const [genomicProfilesAttrs] = useGenomicProfilesData(\n    loaders, dataset, setItemIsReady, addUrl, true,\n  );\n\n  const hgViewConfig = useMemo(() => {\n    if (!genomicProfilesAttrs || urls.length !== 1) {\n      return null;\n    }\n    // Get the URL to the data file from the downloadable URLs array.\n    const { url } = urls[0];\n\n    // Set up the colors to use in the HiGlass view config based on the current theme.\n    const foregroundColor = (theme === 'dark' ? '#C0C0C0' : '#000000');\n    const backgroundColor = (theme === 'dark' ? '#000000' : '#f1f1f1');\n    const dimColor = (theme === 'dark' ? 'dimgray' : 'silver');\n\n    // Define the \"reference tracks\" for chromosome labels and gene annotations.\n    const referenceTracks = [\n      {\n        type: 'horizontal-chromosome-labels',\n        server: higlassServer,\n        tilesetUid: REFERENCE_TILESETS[assembly].chromosomes,\n        uid: 'chromosome-labels',\n        options: {\n          color: foregroundColor,\n          fontSize: 12,\n          fontIsLeftAligned: false,\n          showMousePosition: true,\n          mousePositionColor: foregroundColor,\n        },\n        height: 30,\n      },\n      {\n        type: 'horizontal-gene-annotations',\n        server: higlassServer,\n        tilesetUid: REFERENCE_TILESETS[assembly].genes,\n        uid: 'gene-annotations',\n        options: {\n          name: 'Gene Annotations (hg38)',\n          fontSize: 10,\n          labelPosition: 'hidden',\n          labelLeftMargin: 0,\n          labelRightMargin: 0,\n          labelTopMargin: 0,\n          labelBottomMargin: 0,\n          minHeight: 24,\n          geneAnnotationHeight: 16,\n          geneLabelPosition: 'outside',\n          geneStrandSpacing: 4,\n          showMousePosition: true,\n          mousePositionColor: foregroundColor,\n          plusStrandColor: foregroundColor,\n          minusStrandColor: foregroundColor,\n          labelColor: 'black',\n          labelBackgroundColor: backgroundColor,\n          trackBorderWidth: 0,\n          trackBorderColor: 'black',\n        },\n        height: 70,\n      },\n    ];\n    // Determine the heights of each profile track by subtracting the\n    // reference track heights from the component height, then\n    // dividing by the number of profiles.\n    const referenceTracksHeightSum = sum(referenceTracks.map(t => t.height));\n    const profileTracksHeightSum = height - referenceTracksHeightSum - 10;\n    const profileTrackHeight = profileTracksHeightSum / genomicProfilesAttrs.row_infos.length;\n    const profileTracks = genomicProfilesAttrs.row_infos.map((rowInfo, i) => {\n      // Get the uid for the HiGlass track.\n      const trackUid = rowInfo[profileTrackUidKey];\n      // When profiles correspond to cell sets, the profile UID will be the cell set path array.\n      const isPath = Array.isArray(trackUid);\n      // Get the name for the HiGlass track: try the name key first,\n      // then try the tail of the path, and otherwise the track UID.\n      // eslint-disable-next-line no-nested-ternary\n      const trackName = profileTrackNameKey\n        ? rowInfo[profileTrackNameKey]\n        : (isPath ? trackUid[trackUid.length - 1] : trackUid);\n      // If the uid is a path, then try to get the corresponding cell set's color,\n      // if it is currently selected.\n      const setInSelection = isPath ? cellSetSelection?.find(s => isEqual(s, trackUid)) : false;\n      const setColor = isPath ? cellSetColor?.find(s => isEqual(s.path, trackUid))?.color : null;\n      // Get the track UID as a string before passing to HiGlass.\n      const trackUidString = isPath ? trackUid.join('__') : trackUid;\n      // Create the HiGlass track definition for this profile.\n      const track = {\n        type: 'horizontal-bar',\n        uid: `bar-track-${trackUidString}`,\n        data: {\n          type: 'zarr-multivec',\n          url,\n          row: i,\n        },\n        options: {\n          name: trackName,\n          showMousePosition: true,\n          mousePositionColor: foregroundColor,\n          labelColor: (theme === 'dark' ? 'white' : 'black'),\n          labelBackgroundColor: (theme === 'dark' ? 'black' : 'white'),\n          labelShowAssembly: false,\n        },\n        height: profileTrackHeight,\n      };\n      // Set the track color if it is available.\n      if (setColor && setInSelection) {\n        const c = setColor;\n        track.options.barFillColor = `rgb(${c[0]},${c[1]},${c[2]})`;\n      } else {\n        track.options.barFillColor = dimColor;\n      }\n      return track;\n    });\n\n    // Create the higlass view.\n    // The HiGlassLazy component will fill in the fields 'uid',\n    // 'initialXDomain', and 'initialYDomain'.\n    const hgView = {\n      tracks: {\n        top: [\n          ...referenceTracks,\n          ...profileTracks,\n        ],\n        left: [],\n        center: [],\n        right: [],\n        bottom: [],\n        whole: [],\n        gallery: [],\n      },\n      layout: {\n        w: 12,\n        h: 12,\n        x: 0,\n        y: 0,\n        static: false,\n      },\n    };\n    return hgView;\n  }, [genomicProfilesAttrs, urls, theme, height, profileTrackUidKey,\n    profileTrackNameKey, cellSetSelection, cellSetColor,\n    higlassServer, assembly]);\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return (\n    <div className=\"higlass-title-wrapper\">\n      <TitleInfo\n        title={title}\n        removeGridComponent={removeGridComponent}\n        theme={theme}\n        isReady={isReady}\n        urls={urls}\n      >\n        <div className=\"higlass-lazy-wrapper\" ref={containerRef}>\n          {hgViewConfig ? (\n            <HiGlassLazy\n              coordinationScopes={coordinationScopes}\n              theme={theme}\n              hgViewConfig={hgViewConfig}\n              height={height}\n            />\n          ) : null}\n        </div>\n      </TitleInfo>\n    </div>\n  );\n}\n", "import React, { useMemo, useEffect } from 'react';\nimport { sum } from 'd3-array';\n\nimport TitleInfo from '../TitleInfo';\nimport { useCoordination, useLoaders } from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport { useUrls, useReady, useGridItemSize } from '../hooks';\nimport { useExpressionMatrixData, useGeneSelection } from '../data-hooks';\nimport ExpressionHistogram from './ExpressionHistogram';\n\nconst EXPRESSION_HISTOGRAM_DATA_TYPES = ['expression-matrix'];\n\n/**\n * A subscriber component for `ExpressionHistogram`,\n * which listens for gene selection updates and\n * `GRID_RESIZE` events.\n * @param {object} props\n * @param {function} props.removeGridComponent The grid component removal function.\n * @param {object} props.coordinationScopes An object mapping coordination\n * types to coordination scopes.\n * @param {string} props.theme The name of the current Vitessce theme.\n */\nexport default function ExpressionHistogramSubscriber(props) {\n  const {\n    coordinationScopes,\n    removeGridComponent,\n    theme,\n  } = props;\n\n  const loaders = useLoaders();\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    geneSelection,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.expressionHistogram, coordinationScopes);\n\n  const [width, height, containerRef] = useGridItemSize();\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    EXPRESSION_HISTOGRAM_DATA_TYPES,\n  );\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [expressionMatrix] = useExpressionMatrixData(\n    loaders, dataset, setItemIsReady, addUrl, true,\n  );\n  // Get data from loaders using the data hooks.\n  const [expressionData] = useGeneSelection(\n    loaders, dataset, setItemIsReady, false, geneSelection, setItemIsNotReady,\n  );\n\n  const firstGeneSelected = geneSelection && geneSelection.length >= 1\n    ? geneSelection[0]\n    : null;\n\n  // From the expression matrix and the list of selected genes,\n  // generate the array of data points for the histogram.\n  const data = useMemo(() => {\n    if (firstGeneSelected && expressionMatrix && expressionData) {\n      // Create new cellColors map based on the selected gene.\n      return Array.from(expressionData[0]).map((_, index) => {\n        const value = expressionData[0][index];\n        const normValue = value * 100 / 255;\n        return { value: normValue, gene: firstGeneSelected };\n      });\n    }\n    if (expressionMatrix) {\n      const numGenes = expressionMatrix.cols.length;\n      return expressionMatrix.rows.map((cellId, cellIndex) => {\n        const values = expressionMatrix.matrix\n          .subarray(cellIndex * numGenes, (cellIndex + 1) * numGenes);\n        const sumValue = sum(values) * 100 / 255;\n        return { value: sumValue, gene: null };\n      });\n    }\n    return null;\n  }, [expressionMatrix, firstGeneSelected, expressionData]);\n\n  return (\n    <TitleInfo\n      title={`Expression Histogram${(firstGeneSelected ? ` (${firstGeneSelected})` : '')}`}\n      removeGridComponent={removeGridComponent}\n      urls={urls}\n      theme={theme}\n      isReady={isReady}\n    >\n      <div ref={containerRef} className=\"vega-container\">\n        <ExpressionHistogram\n          geneSelection={geneSelection}\n          data={data}\n          theme={theme}\n          width={width}\n          height={height}\n        />\n      </div>\n    </TitleInfo>\n  );\n}\n", "import React from 'react';\nimport clamp from 'lodash/clamp';\nimport { VegaPlot, VEGA_THEMES } from '../vega';\n\n/**\n * Gene expression histogram displayed as a bar chart,\n * implemented with the VegaPlot component.\n * @param {object} props\n * @param {string[]} props.geneSelection The list of genes\n * currently selected.\n * @param {object[]} props.data The expression data, an array\n * of objects with properties `value` and `gene`.\n * @param {string} props.theme The name of the current Vitessce theme.\n * @param {number} props.width The container width.\n * @param {number} props.height The container height.\n * @param {number} props.marginRight The size of the margin\n * on the right side of the plot, to account for the vega menu button.\n * By default, 90.\n * @param {number} props.marginBottom The size of the margin\n * on the bottom of the plot, to account for long x-axis labels.\n * By default, 50.\n */\nexport default function ExpressionHistogram(props) {\n  const {\n    geneSelection,\n    data,\n    theme,\n    width,\n    height,\n    marginRight = 90,\n    marginBottom = 50,\n  } = props;\n\n  const xTitle = geneSelection && geneSelection.length >= 1\n    ? 'Normalized Expression Value'\n    : 'Total Normalized Transcript Count';\n\n  const spec = {\n    mark: { type: 'bar' },\n    encoding: {\n      x: {\n        field: 'value',\n        type: 'quantitative',\n        bin: { maxbins: 50 },\n        title: xTitle,\n      },\n      y: {\n        type: 'quantitative',\n        aggregate: 'count',\n        title: 'Number of Cells',\n      },\n      color: { value: 'gray' },\n    },\n    width: clamp(width - marginRight, 10, Infinity),\n    height: clamp(height - marginBottom, 10, Infinity),\n    config: VEGA_THEMES[theme],\n  };\n\n  return (\n    <VegaPlot\n      data={data}\n      spec={spec}\n    />\n  );\n}\n", "import React, { useEffect, useReducer } from 'react';\nimport TitleInfo from '../TitleInfo';\nimport { useCoordination, useLoaders } from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport { useUrls, useReady, useGridItemSize } from '../hooks';\nimport { useGeneSelection, useExpressionAttrs, useCellSetsData } from '../data-hooks';\nimport { useExpressionByCellSet } from './hooks';\nimport CellSetExpressionPlotOptions from './CellSetExpressionPlotOptions';\n\nimport CellSetExpressionPlot from './CellSetExpressionPlot';\n\nconst CELL_SET_EXPRESSION_DATA_TYPES = ['cell-sets', 'expression-matrix'];\n\n/**\n * A subscriber component for `CellSetExpressionPlot`,\n * which listens for gene selection updates and\n * `GRID_RESIZE` events.\n * @param {object} props\n * @param {function} props.removeGridComponent The grid component removal function.\n * @param {object} props.coordinationScopes An object mapping coordination\n * types to coordination scopes.\n * @param {string} props.theme The name of the current Vitessce theme.\n */\nexport default function CellSetExpressionPlotSubscriber(props) {\n  const {\n    coordinationScopes,\n    removeGridComponent,\n    theme,\n  } = props;\n\n  const loaders = useLoaders();\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    geneSelection,\n    geneExpressionTransform,\n    cellSetSelection,\n    cellSetColor,\n    additionalCellSets,\n  }, {\n    setGeneExpressionTransform,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.cellSetExpression, coordinationScopes);\n\n  const [width, height, containerRef] = useGridItemSize();\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    CELL_SET_EXPRESSION_DATA_TYPES,\n  );\n\n  const [useGeneExpressionTransform, toggleGeneExpressionTransform] = useReducer((v) => {\n    const newValue = !v;\n    setGeneExpressionTransform(newValue ? 'log1p' : null);\n    return newValue;\n  }, geneExpressionTransform);\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [expressionData] = useGeneSelection(\n    loaders, dataset, setItemIsReady, false, geneSelection, setItemIsNotReady,\n  );\n  const [attrs] = useExpressionAttrs(\n    loaders, dataset, setItemIsReady, addUrl, false,\n  );\n  const [cellSets] = useCellSetsData(\n    loaders, dataset, setItemIsReady, addUrl, true,\n  );\n\n  const [expressionArr, setArr, expressionMax] = useExpressionByCellSet(\n    expressionData, attrs, cellSets, additionalCellSets,\n    geneSelection, cellSetSelection, cellSetColor, useGeneExpressionTransform,\n    theme,\n  );\n\n  const firstGeneSelected = geneSelection && geneSelection.length >= 1\n    ? geneSelection[0]\n    : null;\n  return (\n    <TitleInfo\n      title={`Expression by Cell Set${(firstGeneSelected ? ` (${firstGeneSelected})` : '')}`}\n      removeGridComponent={removeGridComponent}\n      urls={urls}\n      theme={theme}\n      isReady={isReady}\n      options={(\n        <CellSetExpressionPlotOptions\n          useGeneExpressionTransform={useGeneExpressionTransform}\n          toggleGeneExpressionTransform={toggleGeneExpressionTransform}\n        />\n      )}\n    >\n      <div ref={containerRef} className=\"vega-container\">\n        {expressionArr ? (\n          <CellSetExpressionPlot\n            domainMax={expressionMax}\n            colors={setArr}\n            data={expressionArr}\n            theme={theme}\n            width={width}\n            height={height}\n            useGeneExpressionTransform={useGeneExpressionTransform}\n          />\n        ) : (\n          <span>Select a gene.</span>\n        )}\n      </div>\n    </TitleInfo>\n  );\n}\n", "import { useMemo } from 'react';\nimport { mergeCellSets } from '../utils';\nimport { treeToObjectsBySetNames, treeToSetSizesBySetNames } from './cell-set-utils';\n\n/**\n * Get expression data for the cells\n * in the selected cell sets.\n * @param {object} expressionMatrix\n * @param {string[]} expressionMatrix.rows Cell IDs.\n * @param {string[]} expressionMatrix.cols Gene names.\n * @param {Uint8Array} expressionMatrix.matrix The\n * flattened expression matrix as a typed array.\n * @param {object} cellSets The cell sets from the dataset.\n * @param {object} additionalCellSets The user-defined cell sets\n * from the coordination space.\n * @param {array} geneSelection Array of selected genes.\n * @param {array} cellSetSelection Array of selected cell set paths.\n * @param {object[]} cellSetColor Array of objects with properties\n * @param {string} theme \"light\" or \"dark\" for the vitessce theme\n * `path` and `color`.\n */\nexport function useExpressionByCellSet(\n  expressionData, expressionDataAttrs, cellSets, additionalCellSets,\n  geneSelection, cellSetSelection, cellSetColor, useGeneExpressionTransform,\n  theme,\n) {\n  const mergedCellSets = useMemo(\n    () => mergeCellSets(cellSets, additionalCellSets),\n    [cellSets, additionalCellSets],\n  );\n\n  // From the expression matrix and the list of selected genes / cell sets,\n  // generate the array of data points for the plot.\n  const [expressionArr, expressionMax] = useMemo(() => {\n    if (mergedCellSets && cellSetSelection\n        && geneSelection && geneSelection.length >= 1\n        && expressionData\n    ) {\n      const cellObjects = treeToObjectsBySetNames(\n        mergedCellSets, cellSetSelection, cellSetColor, theme,\n      );\n\n      const firstGeneSelected = geneSelection[0];\n      // Create new cellColors map based on the selected gene.\n      let exprMax = -Infinity;\n      const cellIndices = {};\n      for (let i = 0; i < expressionDataAttrs.rows.length; i += 1) {\n        cellIndices[expressionDataAttrs.rows[i]] = i;\n      }\n      const exprValues = cellObjects.map((cell) => {\n        const cellIndex = cellIndices[cell.obsId];\n        const value = expressionData[0][cellIndex];\n        const normValue = value * 100 / 255;\n        const transformedValue = useGeneExpressionTransform ? Math.log(1 + normValue) : normValue;\n        exprMax = Math.max(transformedValue, exprMax);\n        return { value: transformedValue, gene: firstGeneSelected, set: cell.name };\n      });\n      return [exprValues, exprMax];\n    }\n    return [null, null];\n  }, [expressionData, expressionDataAttrs, geneSelection, theme,\n    mergedCellSets, cellSetSelection, cellSetColor, useGeneExpressionTransform]);\n\n  // From the cell sets hierarchy and the list of selected cell sets,\n  // generate the array of set sizes data points for the bar plot.\n  const setArr = useMemo(() => (mergedCellSets && cellSetSelection && cellSetColor\n    ? treeToSetSizesBySetNames(mergedCellSets, cellSetSelection, cellSetColor, theme)\n    : []\n  ), [mergedCellSets, cellSetSelection, cellSetColor, theme]);\n\n  return [expressionArr, setArr, expressionMax];\n}\n", "import React from 'react';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableRow from '@material-ui/core/TableRow';\nimport { useStyles } from '../shared-plot-options/styles';\nimport OptionsContainer from '../shared-plot-options/OptionsContainer';\n\nexport default function CellSetExpressionPlotOptions(props) {\n  const { toggleGeneExpressionTransform, useGeneExpressionTransform } = props;\n  const classes = useStyles();\n\n  function handleGeneExpressionTransformChange() {\n    toggleGeneExpressionTransform();\n  }\n\n  return (\n    <OptionsContainer>\n      <TableRow>\n        <TableCell className={classes.labelCell}>Log Transform</TableCell>\n        <TableCell className={classes.inputCell}>\n          <Checkbox\n            className={classes.checkbox}\n            checked={Boolean(useGeneExpressionTransform)}\n            onChange={handleGeneExpressionTransformChange}\n            name=\"scatterplot-option-cell-set-labels\"\n            color=\"default\"\n          />\n        </TableCell>\n      </TableRow>\n    </OptionsContainer>\n  );\n}\n", "import React from 'react';\nimport clamp from 'lodash/clamp';\nimport { VegaPlot, VEGA_THEMES, DATASET_NAME } from '../vega';\nimport { colorArrayToString } from './utils';\n\n/**\n * Gene expression histogram displayed as a bar chart,\n * implemented with the VegaPlot component.\n * @param {object} props\n * @param {object[]} props.data The expression data, an array\n * of objects with properties `value`, `gene`, and `set`.\n * @param {number} props.domainMax The maximum gene expression value.\n * @param {object[]} props.colors An object for each\n * cell set, with properties `name` and `color`.\n * @param {string} props.theme The name of the current Vitessce theme.\n * @param {number} props.width The container width.\n * @param {number} props.height The container height.\n * @param {number} props.marginRight The size of the margin\n * on the right side of the plot, to account for the vega menu button.\n * By default, 90.\n * @param {number} props.marginBottom The size of the margin\n * on the bottom of the plot, to account for long x-axis labels.\n * Default is allowing the component to automatically determine the margin.\n * @param {boolean} props.useGeneExpressionTransform Boolean representing\n * whether or not the expression values are log-transformed.\n */\nexport default function CellSetExpressionPlot(props) {\n  const {\n    domainMax = 100,\n    colors,\n    data,\n    theme,\n    width,\n    height,\n    marginRight = 90,\n    marginBottom,\n    useGeneExpressionTransform,\n  } = props;\n  // Get the max characters in an axis label for autsizing the bottom margin.\n  const maxCharactersForLabel = data.reduce((acc, val) => {\n    // eslint-disable-next-line no-param-reassign\n    acc = acc === undefined || val.set.length > acc ? val.set.length : acc;\n    return acc;\n  }, 0);\n  // Use a square-root term because the angle of the labels is 45 degrees (see below)\n  // so the perpendicular distance to the bottom of the labels is proportional to the\n  // square root of the length of the labels along the imaginary hypotenuse.\n  // 30 is an estimate of the pixel size of a given character and seems to work well.\n  const autoMarginBottom = marginBottom\n    || 30 + Math.sqrt(maxCharactersForLabel / 2) * 30;\n  // Manually set the color scale so that Vega-Lite does\n  // not choose the colors automatically.\n  const colorScale = {\n    domain: colors.map(d => d.name),\n    range: colors.map(d => colorArrayToString(d.color)),\n  };\n\n  const plotWidth = clamp(width - marginRight, 10, Infinity);\n  const plotHeight = clamp(height - autoMarginBottom, 10, Infinity);\n\n  const numBands = colors.length;\n  const bandWidth = plotWidth / numBands;\n\n  const rectColor = (theme === 'dark' ? 'white' : 'black');\n\n  const spec = {\n    $schema: 'https://vega.github.io/schema/vega/v5.json',\n    description: 'A violin plot showing distributions of expression levels for selected cell sets.',\n    width: plotWidth,\n    height: plotHeight,\n    config: {\n      ...VEGA_THEMES[theme],\n      axisBand: {\n        bandPosition: 1,\n        tickExtra: true,\n        tickOffset: 0,\n      },\n    },\n\n    signals: [\n      { name: 'bandWidth', value: bandWidth },\n      { name: 'width', value: plotWidth },\n      { name: 'height', value: plotHeight },\n      { name: 'trim', value: true },\n    ],\n\n    data: [\n      {\n        name: 'density',\n        source: DATASET_NAME,\n        transform: [\n          {\n            type: 'kde',\n            field: 'value',\n            groupby: ['set'],\n            bandwidth: 0,\n            extent: [0, domainMax],\n          },\n        ],\n      },\n      {\n        name: 'stats',\n        source: DATASET_NAME,\n        transform: [\n          {\n            type: 'aggregate',\n            groupby: ['set'],\n            fields: ['value', 'value', 'value'],\n            ops: ['q1', 'median', 'q3'],\n            as: ['q1', 'median', 'q3'],\n          },\n        ],\n      },\n    ],\n\n    scales: [\n      {\n        name: 'layout',\n        type: 'band',\n        range: 'width',\n        domain: { data: DATASET_NAME, field: 'set' },\n      },\n      {\n        name: 'yscale',\n        type: 'linear',\n        range: 'height',\n        domain: [0, domainMax],\n      },\n      {\n        name: 'wscale',\n        type: 'linear',\n        range: [0, { signal: 'bandWidth' }],\n        domain: { data: 'density', field: 'density' },\n      },\n      {\n        name: 'wscaleReversed',\n        type: 'linear',\n        reverse: true,\n        range: [0, { signal: 'bandWidth' }],\n        domain: { data: 'density', field: 'density' },\n      },\n      {\n        name: 'color',\n        type: 'ordinal',\n        ...colorScale,\n      },\n    ],\n\n    axes: [\n      {\n        orient: 'left',\n        scale: 'yscale',\n        zindex: 1,\n        // title: useGeneExpressionTransform\n        //   ? 'Log-Normalized Expression Values' : 'Normalized Expression Values',\n        title: useGeneExpressionTransform\n          ? ['Log-Transformed', 'Normalized Expression Values']\n          : 'Normalized Expression Values',\n      },\n      {\n        orient: 'bottom',\n        scale: 'layout',\n        tickCount: 5,\n        zindex: 1,\n        title: 'Cell Set',\n        labelAngle: -45,\n        labelAlign: 'right',\n      },\n    ],\n\n    marks: [\n      {\n        type: 'group',\n        from: {\n          facet: {\n            data: 'density',\n            name: 'violin',\n            groupby: 'set',\n          },\n        },\n\n        encode: {\n          enter: {\n            xc: { scale: 'layout', field: 'set', band: 0.5 },\n            width: { signal: 'bandWidth' },\n            height: { signal: 'height' },\n          },\n        },\n\n        data: [\n          {\n            name: 'summary',\n            source: 'stats',\n            transform: [\n              {\n                type: 'filter',\n                expr: 'datum.set === parent.set',\n              },\n            ],\n          },\n        ],\n\n        marks: [\n          {\n            type: 'area',\n            orient: 'vertical',\n            from: { data: 'violin' },\n            encode: {\n              enter: {\n                fill: { scale: 'color', field: { parent: 'set' } },\n              },\n              update: {\n                width: { scale: 'wscale', field: 'density' },\n                xc: { signal: 'bandWidth / 2' },\n                y2: { scale: 'yscale', field: 'value' },\n                y: { scale: 'yscale', value: 0 },\n              },\n            },\n          },\n          {\n            type: 'area',\n            orient: 'vertical',\n            from: { data: 'violin' },\n            encode: {\n              enter: {\n                fill: { scale: 'color', field: { parent: 'set' } },\n              },\n              update: {\n                width: { scale: 'wscaleReversed', field: 'density' },\n                xc: { signal: 'bandWidth' },\n                y2: { scale: 'yscale', field: 'value' },\n                y: { scale: 'yscale', value: 0 },\n              },\n            },\n          },\n          {\n            type: 'rect',\n            from: { data: 'summary' },\n            encode: {\n              enter: {\n                fill: { value: rectColor },\n                width: { value: 2 },\n              },\n              update: {\n                y: { scale: 'yscale', field: 'q1' },\n                y2: { scale: 'yscale', field: 'q3' },\n                xc: { signal: 'bandWidth / 2' },\n              },\n            },\n          },\n          {\n            type: 'rect',\n            from: { data: 'summary' },\n            encode: {\n              enter: {\n                fill: { value: rectColor },\n                height: { value: 2 },\n                width: { value: 8 },\n              },\n              update: {\n                y: { scale: 'yscale', field: 'median' },\n                xc: { signal: 'bandWidth / 2' },\n              },\n            },\n          },\n        ],\n      },\n    ],\n  };\n\n  return (\n    <VegaPlot\n      data={data}\n      spec={spec}\n    />\n  );\n}\n", "import DescriptionSubscriber from '../components/description/DescriptionSubscriber';\nimport StatusSubscriber from '../components/status/StatusSubscriber';\nimport GenesSubscriber from '../components/genes/GenesSubscriber';\nimport CellSetsManagerSubscriber from '../components/sets/CellSetsManagerSubscriber';\nimport ScatterplotSubscriber from '../components/scatterplot/ScatterplotSubscriber';\nimport SpatialSubscriber from '../components/spatial/SpatialSubscriber';\nimport HeatmapSubscriber from '../components/heatmap/HeatmapSubscriber';\nimport LayerControllerSubscriber from '../components/layer-controller/LayerControllerSubscriber';\nimport HiGlassSubscriber from '../components/higlass/HiGlassSubscriber';\nimport CellSetSizesPlotSubscriber from '../components/sets/CellSetSizesPlotSubscriber';\nimport GenomicProfilesSubscriber from '../components/higlass/GenomicProfilesSubscriber';\nimport ExpressionHistogramSubscriber from '../components/genes/ExpressionHistogramSubscriber';\nimport CellSetExpressionPlotSubscriber from '../components/sets/CellSetExpressionPlotSubscriber';\n\nconst registry = {\n  description: DescriptionSubscriber,\n  status: StatusSubscriber,\n  genes: GenesSubscriber,\n  cellSets: CellSetsManagerSubscriber,\n  scatterplot: ScatterplotSubscriber,\n  spatial: SpatialSubscriber,\n  heatmap: HeatmapSubscriber,\n  layerController: LayerControllerSubscriber,\n  cellSetSizes: CellSetSizesPlotSubscriber,\n  expressionHistogram: ExpressionHistogramSubscriber,\n  genomicProfiles: GenomicProfilesSubscriber,\n  cellSetExpression: CellSetExpressionPlotSubscriber,\n  // The plain higlass component does not abstract away the HiGlass view config,\n  // so we probably want to avoid documenting it, only use it for development purposes.\n  higlass: HiGlassSubscriber,\n};\n\nexport function getComponent(name) {\n  const component = registry[name];\n  if (component === undefined) {\n    throw new Error(`Could not find definition for \"${name}\" in registry.`);\n  }\n  return registry[name];\n}\n", "/* eslint-disable no-plusplus */\nimport packageJson from '../../package.json';\nimport { getNextScope } from '../utils';\nimport {\n  COORDINATION_TYPES,\n  DEFAULT_COORDINATION_VALUES,\n  COMPONENT_COORDINATION_TYPES,\n  AUTO_INDEPENDENT_COORDINATION_TYPES,\n} from './state/coordination';\nimport { SCHEMA_HANDLERS } from './view-config-versions';\n\n/**\n * Get a list of all unique scope names for a\n * particular coordination type, which exist in\n * a particular view config.\n * @param {object} config A view config object.\n * @param {string} coordinationType A coordination type,\n * for example 'spatialZoom' or 'dataset'.\n * @returns {string[]} Array of existing coordination scope names.\n */\nexport function getExistingScopesForCoordinationType(config, coordinationType) {\n  const spaceScopes = Object.keys(config?.coordinationSpace?.[coordinationType] || {});\n  const componentScopes = config.layout.map(c => c.coordinationScopes?.[coordinationType]);\n  return Array.from(new Set([...spaceScopes, ...componentScopes]));\n}\n\n/**\n * Give each component the same scope name for this coordination type.\n * @param {object} config A view config object.\n * @param {string} coordinationType A coordination type,\n * for example 'spatialZoom' or 'dataset'.\n * @param {*} scopeValue The initial value for the coordination scope,\n * to set in the coordination space.\n * @returns {object} The new view config.\n */\nfunction coordinateComponentsTogether(config, coordinationType, scopeValue) {\n  const scopeName = getNextScope(getExistingScopesForCoordinationType(config, coordinationType));\n  const newConfig = {\n    ...config,\n    coordinationSpace: {\n      ...config.coordinationSpace,\n      [coordinationType]: {\n        ...config?.coordinationSpace?.[coordinationType],\n        // Add the new scope name and value to the coordination space.\n        [scopeName]: scopeValue,\n      },\n    },\n    layout: config.layout.map(component => ({\n      ...component,\n      coordinationScopes: {\n        ...component.coordinationScopes,\n        // Only set the coordination scope if this component uses this coordination type,\n        // and the component is missing a coordination scope for this coordination type.\n        ...((\n          COMPONENT_COORDINATION_TYPES[component.component].includes(coordinationType)\n          && !component.coordinationScopes?.[coordinationType]\n        ) ? {\n          // Only set the new scope name if the scope name\n          // for this component and coordination type is currently undefined.\n            [coordinationType]: scopeName,\n          } : {}),\n      },\n    })),\n  };\n  return newConfig;\n}\n\n/**\n * Give each component a different scope name for this coordination type.\n * @param {object} config A view config object.\n * @param {string} coordinationType A coordination type,\n * for example 'spatialZoom' or 'dataset'.\n * @param {*} scopeValue The initial value for the coordination scope,\n * to set in the coordination space.\n * @returns {object} The new view config.\n */\nfunction coordinateComponentsIndependent(config, coordinationType, scopeValue) {\n  const newConfig = {\n    ...config,\n    layout: [...config.layout],\n  };\n  const newScopes = {};\n  newConfig.layout.forEach((component, i) => {\n    // Only set the coordination scope if this component uses this coordination type,\n    // and the component is missing a coordination scope for this coordination type.\n    if (COMPONENT_COORDINATION_TYPES[component.component].includes(coordinationType)\n      && !component.coordinationScopes?.[coordinationType]\n    ) {\n      const scopeName = getNextScope([\n        ...getExistingScopesForCoordinationType(config, coordinationType),\n        ...Object.keys(newScopes),\n      ]);\n      newScopes[scopeName] = scopeValue;\n      newConfig.layout[i] = {\n        ...component,\n        coordinationScopes: {\n          ...component.coordinationScopes,\n          [coordinationType]: scopeName,\n        },\n      };\n    }\n  });\n  newConfig.coordinationSpace = {\n    ...newConfig.coordinationSpace,\n    [coordinationType]: {\n      ...newConfig.coordinationSpace[coordinationType],\n      // Add the new scope name and value to the coordination space.\n      ...newScopes,\n    },\n  };\n  return newConfig;\n}\n\nfunction initializeAuto(config) {\n  let newConfig = config;\n  const { layout, datasets } = newConfig;\n\n  // For each coordination type, check whether it requires initialization.\n  Object.values(COORDINATION_TYPES).forEach((coordinationType) => {\n    // A coordination type requires coordination if at least one component is missing\n    // a (coordination type, coordination scope) tuple.\n    // Components may only use a subset of all coordination types.\n    const requiresCoordination = !layout\n      .every(c => (\n        !COMPONENT_COORDINATION_TYPES[c.component].includes(coordinationType)\n                || c.coordinationScopes?.[coordinationType]\n      ));\n    if (requiresCoordination) {\n      // Note that the default value may be undefined.\n      let defaultValue = DEFAULT_COORDINATION_VALUES[coordinationType];\n      // Check whether this is the special 'dataset' coordination type.\n      if (coordinationType === 'dataset' && datasets.length >= 1) {\n        // Use the first dataset ID as the default\n        // if there is at least one dataset.\n        defaultValue = datasets[0].uid;\n      }\n      // Use the list of \"independent\" coordination types\n      // to determine whether a particular coordination type\n      // should be initialized to\n      // a unique scope for every component (\"independent\")\n      // vs. the same scope for every component (\"together\").\n      if (AUTO_INDEPENDENT_COORDINATION_TYPES.includes(coordinationType)) {\n        newConfig = coordinateComponentsIndependent(newConfig, coordinationType, defaultValue);\n      } else {\n        newConfig = coordinateComponentsTogether(newConfig, coordinationType, defaultValue);\n      }\n    }\n  });\n\n  return newConfig;\n}\n\n\n/**\n * Initialize the view config:\n * - Fill in missing coordination objects with default values.\n * - Fill in missing component coordination scope mappings.\n *   based on the `initStrategy` specified in the view config.\n * Should be \"stable\": if run on the same view config twice, the return value the second\n * time should be identical to the return value the first time.\n * @param {object} config The view config prop.\n */\nexport function initialize(config) {\n  if (config.initStrategy === 'auto') {\n    return initializeAuto(config);\n  }\n  return config;\n}\n\nexport function upgradeAndValidate(oldConfig) {\n  // oldConfig object must have a `version` property.\n  let nextConfig = oldConfig;\n  let fromVersion;\n  let upgradeFunction; let\n    validateFunction;\n\n  do {\n    fromVersion = nextConfig.version;\n\n    if (!Object.keys(SCHEMA_HANDLERS).includes(fromVersion)) {\n      return [{\n        title: 'Config validation failed',\n        preformatted: 'Unknown config version.',\n      }, false];\n    }\n\n    [validateFunction, upgradeFunction] = SCHEMA_HANDLERS[fromVersion];\n\n    // Validate under the legacy schema before upgrading.\n    const validLegacy = validateFunction(nextConfig);\n    if (!validLegacy) {\n      const failureReason = JSON.stringify(validateFunction.errors, null, 2);\n      return [{\n        title: 'Config validation failed',\n        preformatted: failureReason,\n      }, false];\n    }\n\n    if (upgradeFunction) {\n      nextConfig = upgradeFunction(nextConfig);\n    }\n  } while (upgradeFunction);\n\n  // NOTE: Remove when a view config viewer/editor is available in UI.\n  console.groupCollapsed(`\uD83D\uDE84 Vitessce (${packageJson.version}) view configuration`);\n  console.info(`data:,${JSON.stringify(nextConfig)}`);\n  console.info(JSON.stringify(nextConfig, null, 2));\n  console.groupEnd();\n\n  return [nextConfig, true];\n}\n", "import Bowser from 'bowser';\nimport { compressToEncodedURIComponent, decompressFromEncodedURIComponent } from 'lz-string';\n\nconst CURRENT_VERSION = '0.0.1';\nconst VITESSCE_CONF_QUERY_STRING = 'vitessce_conf';\nconst VERSION_QUERY_STRING = 'vitessce_conf_version';\nconst LENGTH_QUERY_STRING = 'vitessce_conf_length';\n\nfunction sniffBrowser() {\n  const { browser } = Bowser.parse(window.navigator.userAgent);\n  return browser.name;\n}\n\n// https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers\nconst MAX_BROWSER_URL_LENGTHS = {\n  Chrome: 32779,\n  'Internet Explorer': 2047,\n  Edge: 2047,\n  Safari: 65000,\n  Firefox: 65000,\n};\n\nexport default class CompressedConfLengthError {\n  constructor(message) {\n    this.message = message;\n  }\n}\n\n/**\n * Encode a configuration as url params with a version and an lz-compressed conf.\n * @param {Object} params\n * @param {Object} params.conf Previous scope names.\n * @param {function} params.onOverMaximumUrlLength Callback for when new url\n * is over max length for your browser - takes two arguments: { message, willWorkOn }\n * for the error message and the browsers for which the url will work (optional).\n * @returns {string} The new params like\n * vitessce_conf_length=10&vitessce_conf_version=0.0.1&vitessce_conf=fksdfasdfjkl\n */\nexport function encodeConfInUrl({\n  conf,\n  onOverMaximumUrlLength = () => { },\n}) {\n  const compressedConf = compressToEncodedURIComponent(JSON.stringify(conf));\n  const newParams = `${LENGTH_QUERY_STRING}=${compressedConf.length}&${VERSION_QUERY_STRING}=${CURRENT_VERSION}&${VITESSCE_CONF_QUERY_STRING}=${compressedConf}`;\n  const browser = sniffBrowser();\n  const maxLength = MAX_BROWSER_URL_LENGTHS[browser];\n  if (newParams.length > maxLength) {\n    const willWorkOn = Object.entries(MAX_BROWSER_URL_LENGTHS)\n      .filter(entry => entry[1] > newParams.length)\n      .map(entry => entry[0]);\n    const message = `Configuration is ${compressedConf.length} characters; max URL for ${browser} is ${maxLength}: it will work on ${willWorkOn.join(', ') || 'no browser'}.`;\n    console.error(message);\n    onOverMaximumUrlLength({ message, willWorkOn });\n  }\n  return newParams;\n}\n\n/**\n * Decode URL params to a Vitessce configuration.\n * The URL params must have version and vitessce_conf params,\n * like vitessce_conf_length=10&vitessce_conf_version=0.0.1&vitessce_conf=fksdfasdfjkl.\n * @param {Object} queryString The URL params,\n * like vitessce_conf_length=10&vitessce_conf_version=0.0.1&vitessce_conf=fksdfasdfjkl.\n * @returns {string} A vitessce configuration.\n */\nexport function decodeURLParamsToConf(queryString) {\n  const params = new URLSearchParams(queryString.replace('#', '&'));\n  const compressedConfString = params.get(VITESSCE_CONF_QUERY_STRING);\n  const expectedConfLength = Number(params.get(LENGTH_QUERY_STRING));\n  if (expectedConfLength !== compressedConfString.length) {\n    throw new CompressedConfLengthError(`Compressed conf length (${compressedConfString.length}) != expected (${expectedConfLength}). URL truncated?`);\n  }\n  const version = params.get(VERSION_QUERY_STRING);\n  if (version === CURRENT_VERSION) {\n    const conf = JSON.parse(decompressFromEncodedURIComponent(compressedConfString));\n    return conf;\n  }\n  throw new Error('Unrecognized URL Param Version');\n}\n", "import { getNextScope, fromEntries } from '../utils';\nimport { COORDINATION_TYPES } from '../app/state/coordination';\n\n\n/**\n * Class representing a file within a Vitessce config dataset.\n */\nexport class VitessceConfigDatasetFile {\n  /**\n   * Construct a new file definition instance.\n   * @param {string} url The URL to the file.\n   * @param {string} dataType The type of data contained in the file.\n   * @param {string} fileType The file type.\n   */\n  constructor(url, dataType, fileType) {\n    this.file = {\n      url,\n      type: dataType,\n      fileType,\n    };\n  }\n\n  /**\n   * @returns {object} This dataset file as a JSON object.\n   */\n  toJSON() {\n    return this.file;\n  }\n}\n\n/**\n * Class representing a dataset within a Vitessce config.\n */\nexport class VitessceConfigDataset {\n  /**\n   * Construct a new dataset definition instance.\n   * @param {string} uid The unique ID for the dataset.\n   * @param {string} name The name of the dataset.\n   * @param {string} description A description for the dataset.\n   */\n  constructor(uid, name, description) {\n    this.dataset = {\n      uid,\n      name,\n      description,\n      files: [],\n    };\n  }\n\n  /**\n   * Add a file definition to the dataset.\n   * @param {string} url The URL to the file.\n   * @param {string} dataType The type of data contained in the file.\n   * @param {string} fileType The file type.\n   * @returns {VitessceConfigDataset} This, to allow chaining.\n   */\n  addFile(url, dataType, fileType) {\n    this.dataset.files.push(new VitessceConfigDatasetFile(url, dataType, fileType));\n    return this;\n  }\n\n  /**\n   * @returns {object} This dataset as a JSON object.\n   */\n  toJSON() {\n    return {\n      ...this.dataset,\n      files: this.dataset.files.map(f => f.toJSON()),\n    };\n  }\n}\n\n/**\n * Class representing a view within a Vitessce layout.\n */\nexport class VitessceConfigView {\n  /**\n   * Construct a new view instance.\n   * @param {string} component The name of the Vitessce component type.\n   * @param {object} coordinationScopes A mapping from coordination type\n   * names to coordination scope names.\n   * @param {number} x The x-coordinate of the view in the layout.\n   * @param {number} y The y-coordinate of the view in the layout.\n   * @param {number} w The width of the view in the layout.\n   * @param {number} h The height of the view in the layout.\n   */\n  constructor(component, coordinationScopes, x, y, w, h) {\n    this.view = {\n      component,\n      coordinationScopes,\n      x,\n      y,\n      w,\n      h,\n    };\n  }\n\n  /**\n   * Attach coordination scopes to this view.\n   * @param  {...VitessceConfigCoordinationScope} args A variable number of\n   * coordination scope instances.\n   * @returns {VitessceConfigView} This, to allow chaining.\n   */\n  useCoordination(...args) {\n    const cScopes = args;\n    cScopes.forEach((cScope) => {\n      this.view.coordinationScopes[cScope.cType] = cScope.cScope;\n    });\n    return this;\n  }\n\n  /**\n    * Set the x, y, w, h values for this view.\n    * @param {number} x The x-coordinate of the view in the layout.\n    * @param {number} y The y-coordinate of the view in the layout.\n    * @param {number} w The width of the view in the layout.\n    * @param {number} h The height of the view in the layout.\n    */\n  setXYWH(x, y, w, h) {\n    this.view.x = x;\n    this.view.y = y;\n    this.view.w = w;\n    this.view.h = h;\n  }\n\n  /**\n   * @returns {object} This view as a JSON object.\n   */\n  toJSON() {\n    return this.view;\n  }\n}\n\n/**\n * Class representing a horizontal concatenation of views.\n */\nexport class VitessceConfigViewHConcat {\n  constructor(views) {\n    this.views = views;\n  }\n}\n\n/**\n * Class representing a vertical concatenation of views.\n */\nexport class VitessceConfigViewVConcat {\n  constructor(views) {\n    this.views = views;\n  }\n}\n\n/**\n * A helper function to create a horizontal concatenation of views.\n * @param  {...(VitessceConfigView|VitessceConfigViewHConcat|VitessceConfigViewVConcat)} views A\n * variable number of views or view concatenations.\n * @returns {VitessceConfigViewHConcat} A new horizontal view concatenation instance.\n */\nexport function hconcat(...views) {\n  const vcvhc = new VitessceConfigViewHConcat(views);\n  return vcvhc;\n}\n\n/**\n * A helper function to create a vertical concatenation of views.\n * @param  {...(VitessceConfigView|VitessceConfigViewHConcat|VitessceConfigViewVConcat)} views A\n * variable number of views or view concatenations.\n * @returns {VitessceConfigViewVConcat} A new vertical view concatenation instance.\n */\nexport function vconcat(...views) {\n  const vcvvc = new VitessceConfigViewVConcat(views);\n  return vcvvc;\n}\n\n/**\n * Class representing a coordination scope in the coordination space.\n */\nexport class VitessceConfigCoordinationScope {\n  /**\n   * Construct a new coordination scope instance.\n   * @param {string} cType The coordination type for this coordination scope.\n   * @param {string} cScope The name of the coordination scope.\n   */\n  constructor(cType, cScope) {\n    this.cType = cType;\n    this.cScope = cScope;\n    this.cValue = null;\n  }\n\n  /**\n   * Set the coordination value of the coordination scope.\n   * @param {any} cValue The value to set.\n   * @returns {VitessceConfigCoordinationScope} This, to allow chaining.\n   */\n  setValue(cValue) {\n    this.cValue = cValue;\n    return this;\n  }\n}\n\n/**\n * Class representing a Vitessce view config.\n */\nexport class VitessceConfig {\n  /**\n   * Construct a new view config instance.\n   * @param {string} name A name for the config. Optional.\n   * @param {string} description A description for the config. Optional.\n   */\n  constructor(name = undefined, description = undefined) {\n    this.config = {\n      version: '1.0.0',\n      name,\n      description,\n      datasets: [],\n      coordinationSpace: {},\n      layout: [],\n      initStrategy: 'auto',\n    };\n  }\n\n  /**\n   * Add a new dataset to the config.\n   * @param {string} name A name for the dataset. Optional.\n   * @param {string} description A description for the dataset. Optional.\n   * @param {object} options Extra parameters to be used internally. Optional.\n   * @param {string} options.uid Override the automatically-generated dataset ID.\n   * Intended for internal usage by the VitessceConfig.fromJSON code.\n   * @returns {VitessceConfigDataset} A new dataset instance.\n   */\n  addDataset(name = undefined, description = undefined, options = undefined) {\n    const { uid } = options || {};\n    const prevDatasetUids = this.config.datasets.map(d => d.dataset.uid);\n    const nextUid = (uid || getNextScope(prevDatasetUids));\n    const newDataset = new VitessceConfigDataset(nextUid, name, description);\n    this.config.datasets.push(newDataset);\n    const [newScope] = this.addCoordination(COORDINATION_TYPES.DATASET);\n    newScope.setValue(nextUid);\n    return newDataset;\n  }\n\n  /**\n   * Add a new view to the config.\n   * @param {VitessceConfigDataset} dataset The dataset instance which defines the data\n   * that will be displayed in the view.\n   * @param {string} component A component name, such as \"scatterplot\" or \"spatial\".\n   * @param {object} options Extra options for the component.\n   * @param {number} options.x The x-coordinate for the view in the grid layout.\n   * @param {number} options.y The y-coordinate for the view in the grid layout.\n   * @param {number} options.w The width for the view in the grid layout.\n   * @param {number} options.h The height for the view in the grid layout.\n   * @param {number} options.mapping A convenience parameter for setting the EMBEDDING_TYPE\n   * coordination value. Only applicable if the component is \"scatterplot\".\n   * @returns {VitessceConfigView} A new view instance.\n   */\n  addView(dataset, component, options) {\n    const {\n      x = 0,\n      y = 0,\n      w = 1,\n      h = 1,\n      mapping = null,\n    } = options || {};\n    const datasetMatches = (\n      this.config.coordinationSpace[COORDINATION_TYPES.DATASET]\n        ? Object.entries(this.config.coordinationSpace[COORDINATION_TYPES.DATASET])\n        // eslint-disable-next-line no-unused-vars\n          .filter(([scopeName, datasetScope]) => datasetScope.cValue === dataset.dataset.uid)\n          .map(([scopeName]) => scopeName)\n        : []\n    );\n    let datasetScope;\n    if (datasetMatches.length === 1) {\n      [datasetScope] = datasetMatches;\n    } else {\n      throw new Error('No coordination scope matching the dataset parameter could be found in the coordination space.');\n    }\n    const coordinationScopes = {\n      [COORDINATION_TYPES.DATASET]: datasetScope,\n    };\n    const newView = new VitessceConfigView(component, coordinationScopes, x, y, w, h);\n    if (mapping) {\n      const [etScope] = this.addCoordination(COORDINATION_TYPES.EMBEDDING_TYPE);\n      etScope.setValue(mapping);\n      newView.useCoordination(etScope);\n    }\n    this.config.layout.push(newView);\n    return newView;\n  }\n\n  /**\n   * Get an array of new coordination scope instances corresponding to coordination types\n   * of interest.\n   * @param {...string} args A variable number of coordination type names.\n   * @returns {VitessceConfigCoordinationScope[]} An array of coordination scope instances.\n   */\n  addCoordination(...args) {\n    const cTypes = args;\n    const result = [];\n    cTypes.forEach((cType) => {\n      const prevScopes = (\n        this.config.coordinationSpace[cType]\n          ? Object.keys(this.config.coordinationSpace[cType])\n          : []\n      );\n      const scope = new VitessceConfigCoordinationScope(cType, getNextScope(prevScopes));\n      if (!this.config.coordinationSpace[scope.cType]) {\n        this.config.coordinationSpace[scope.cType] = {};\n      }\n      this.config.coordinationSpace[scope.cType][scope.cScope] = scope;\n      result.push(scope);\n    });\n    return result;\n  }\n\n  /**\n   * A convenience function for setting up new coordination scopes across a set of views.\n   * @param {VitessceConfigView[]} views An array of view objects to link together.\n   * @param {string[]} cTypes The coordination types on which to coordinate the views.\n   * @param {any[]} cValues Initial values corresponding to each coordination type.\n   * Should have the same length as the cTypes array. Optional.\n   * @returns {VitessceConfig} This, to allow chaining.\n   */\n  linkViews(views, cTypes, cValues = null) {\n    const cScopes = this.addCoordination(...cTypes);\n    views.forEach((view) => {\n      cScopes.forEach((cScope) => {\n        view.useCoordination(cScope);\n      });\n    });\n    if (Array.isArray(cValues) && cValues.length === cTypes.length) {\n      cScopes.forEach((cScope, i) => {\n        cScope.setValue(cValues[i]);\n      });\n    }\n    return this;\n  }\n\n  /**\n   * Set the layout of views.\n   * @param {VitessceConfigView|VitessceConfigViewHConcat|VitessceConfigViewVConcat} viewConcat A\n   * view or a concatenation of views.\n   * @returns {VitessceConfig} This, to allow chaining.\n   */\n  layout(viewConcat) {\n    function layoutAux(obj, xMin, xMax, yMin, yMax) {\n      const w = xMax - xMin;\n      const h = yMax - yMin;\n      if (obj instanceof VitessceConfigView) {\n        obj.setXYWH(xMin, yMin, w, h);\n      } else if (obj instanceof VitessceConfigViewHConcat) {\n        const { views } = obj;\n        const numViews = views.length;\n        views.forEach((view, i) => {\n          layoutAux(view, xMin + (w / numViews) * i, xMin + (w / numViews) * (i + 1), yMin, yMax);\n        });\n      } else if (obj instanceof VitessceConfigViewVConcat) {\n        const { views } = obj;\n        const numViews = views.length;\n        views.forEach((view, i) => {\n          layoutAux(view, xMin, xMax, yMin + (h / numViews) * i, yMin + (h / numViews) * (i + 1));\n        });\n      }\n    }\n\n    layoutAux(viewConcat, 0, 12, 0, 12);\n\n    return this;\n  }\n\n  /**\n   * Convert this instance to a JSON object that can be passed to the Vitessce component.\n   * @returns {object} The view config as a JSON object.\n   */\n  toJSON() {\n    return {\n      ...this.config,\n      datasets: this.config.datasets.map(d => d.toJSON()),\n      coordinationSpace: fromEntries(\n        Object.entries(this.config.coordinationSpace).map(([cType, cScopes]) => ([\n          cType,\n          fromEntries(\n            Object.entries(cScopes).map(([cScopeName, cScope]) => ([\n              cScopeName,\n              cScope.cValue,\n            ])),\n          ),\n        ])),\n      ),\n      layout: this.config.layout.map(c => c.toJSON()),\n    };\n  }\n\n  /**\n   * Create a VitessceConfig instance from an existing view config, to enable\n   * manipulation with the JavaScript API.\n   * @param {object} config An existing Vitessce view config as a JSON object.\n   * @returns {VitessceConfig} A new config instance, with values set to match\n   * the config parameter.\n   */\n  static fromJSON(config) {\n    const { name, description } = config;\n    const vc = new VitessceConfig(name, description);\n    config.datasets.forEach((d) => {\n      const newDataset = vc.addDataset(d.name, d.description, { uid: d.uid });\n      d.files.forEach((f) => {\n        newDataset.addFile(\n          f.url,\n          f.type,\n          f.fileType,\n        );\n      });\n    });\n    Object.keys(config.coordinationSpace).forEach((cType) => {\n      if (cType !== COORDINATION_TYPES.DATASET) {\n        const cObj = config.coordinationSpace[cType];\n        vc.config.coordinationSpace[cType] = {};\n        Object.entries(cObj).forEach(([cScopeName, cScopeValue]) => {\n          const scope = new VitessceConfigCoordinationScope(cType, cScopeName);\n          scope.setValue(cScopeValue);\n          vc.config.coordinationSpace[cType][cScopeName] = scope;\n        });\n      }\n    });\n    config.layout.forEach((c) => {\n      const newView = new VitessceConfigView(c.component, c.coordinationScopes, c.x, c.y, c.w, c.h);\n      vc.config.layout.push(newView);\n    });\n    return vc;\n  }\n}\n"],
  "mappings": "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,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA;AAAA,EAErB,SAAS;AAAA,IACP,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA;AAAA,EAErB,SAAS;AAAA,IACP,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,mBAAmB;AAAA;AAAA,EAErB,UAAU;AAAA,IACR,mBAAm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,KAAK,MAAM,CAAC,GAAG,IAAI;AAE7L,IAAM,eAAe,CAAC,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,KAA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,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ;AAAA,cACA;AAAA;AAAA,YAEF,OAAO;AAAA,cACL;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA;AAAA;AAAA,UAGJ;AAAA,YACE,MAAM;AAAA,cACJ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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AAmBA,gCAAgC,QAAQ,MAAM,mBAAmB;AAC/D,QAAM,cAAc,OAAO,KAAK,kBAAkB,GAAG;AACrD,QAAM,eAAe,OAAO,KAAK,kBAAkB,GAAG;AACtD,QAAM,eAAe,OAAO,KAAK,kBAAkB,GAAG;AAEtD,QAAM,aAAa,aAAa;AAChC,QAAM,cAAc,aAAa;AACjC,QAAM,cAAc,aAAa;AAEjC,QAAM,EAAE,MAAM,QAAQ,CAAC,SAAS,aAAa;AAE7C,oBAAkB,GAAG,cAAc,cAAc;AAEjD,oBAAkB,GAAG,iBAAiB,eAAe;AAErD,oBAAkB,GAAG,iBAAiB,eAAe;AACrD,SAAO;AAAA,KACJ,GAAG,eAAe;AAAA,KAClB,GAAG,kBAAkB;AAAA,KACrB,GAAG,kBAAkB;AAAA;AAAA;AASnB,0BAA0B,QAAQ,aAAa,MAAM;AAC1D,QAAM,oBAAoB;AAAA,IACxB,eAAe;AAAA,IACf,eAAe;AAAA,IACf,kBAAkB;AAAA,IAClB,kBAAkB;AAAA,IAClB,aAAa;AAAA,IACb,gBAAgB;AAAA,IAChB,gBAAgB;AAAA;AAGlB,QAAM,SAAS;AACf,SAAO,aAAa,QAAQ,CAAC,iBAAiB;AA7DhD;AA8DI,QAAI,kBAAkB,iCACjB,eADiB;AAAA,MAEpB,oBAAoB;AAAA;AAEtB,QAAI,aAAa,cAAc,eAAe;AAI5C,UAAI,aAAa,MAAM,SAAS;AAC9B,0BAAkB,cAAc,aAAa,MAAM,WAAW,aAAa,MAAM;AACjF,0BAAkB,iCACb,kBADa;AAAA,UAEhB,oBAAoB,iCACf,gBAAgB,qBADD;AAAA,YAElB,eAAe,aAAa,MAAM;AAAA;AAAA;AAAA;AAOxC,UAAI,aAAa,MAAM,MAAM;AAE3B,cAAM,iBAAiB,uBACrB,aAAa,aAAa,MAAM,MAAM;AAExC,0BAAkB,iCACb,kBADa;AAAA,UAEhB,oBAAoB,kCACf,gBAAgB,qBAChB;AAAA;AAAA;AAAA;AAKX,QAAI,aAAa,cAAc,WAAW;AAIxC,UAAI,oDAAc,UAAd,oBAAqB,MAAM;AAE7B,cAAM,iBAAiB,uBACrB,WAAW,aAAa,MAAM,MAAM;AAEtC,0BAAkB,iCACb,kBADa;AAAA,UAEhB,oBAAoB,kCACf,gBAAgB,qBAChB;AAAA;AAAA;AAAA;AAKX,WAAO,KAAK;AAAA;AAOd,QAAM,gBAAgB,cAAc;AAEpC,SAAO;AAAA,IACL,SAAS;AAAA,IACT,MAAM,OAAO;AAAA,IACb,aAAa,OAAO;AAAA,IACpB,QAAQ,OAAO;AAAA,IACf,UAAU;AAAA,MACR;AAAA,QACE,KAAK;AAAA,QACL,MAAM;AAAA,QACN,OAAO,OAAO,OAAO,IAAI,WAAU;AAAA,UACjC,MAAM,MAAM,KAAK;AAAA,UACjB,UAAU,MAAM;AAAA,UAChB,KAAK,MAAM;AAAA;AAAA;AAAA;AAAA,IAIjB,cAAc;AAAA,IACd;AAAA,IACA;AAAA;AAAA;AAIG,0BAA0B,QAAQ;AACvC,QAAM,oBAAoB,mBAAK,OAAO;AAEtC,4BAA0B,WAAW;AAEnC,UAAM,WAAW,cAAc;AAC/B,sBAAkB,UAAU,WAAW,kBAAkB,WAAW,MAAM,QAAQ;AAClF,WAAO,QAAQ,kBAAkB,eAAe,QAAQ,CAAC,CAAC,OAAO,YAAY;AAC3E,UAAI,MAAM,QAAQ,WAAW,OAAO,KAAK,WAAS,MAAM,SAAS,YAAY;AAC3E,cAAM,cAAc,OACjB,OAAO,WAAS,MAAM,SAAS,WAC/B,IAAI,CAAC,UAAU;AACd,gBAAM,WAAW,mBAAK;AACtB,iBAAO,SAAS;AAChB,iBAAO;AAAA;AAEX,0BAAkB,UAAU,WAAW,kBAAkB,WAAW,MAAM,MAAM,SAAS,WAAW,cAAc,YAAY;AAAA,aACzH;AACL,0BAAkB,UAAU,WAAW,kBAAkB,WAAW,MAAM,MAAM,SAAS;AAAA;AAAA;AAAA;AAK/F,MAAI,kBAAkB,eAAe;AACnC,qBAAiB;AACjB,qBAAiB;AACjB,qBAAiB;AACjB,qBAAiB;AACjB,WAAO,kBAAkB;AAAA;AAG3B,QAAM,SAAS,OAAO,OAAO,IAAI,CAAC,cAAc;AAC9C,UAAM,eAAe,mBAAK;AAE1B,sCAAkC,WAAW;AAC3C,YAAM,WAAW,cAAc;AAC/B,UAAI,6BAA6B,aAAa,WAAW,SAAS,UAAU,WAAW,kBAAkB,WAAW,MAAM,OAAO;AAC/H,qBAAa,mBAAmB,UAAU,WAAW,kBAAkB,WAAW,MAAM,QAAQ,aAAa,mBAAmB;AAAA;AAAA;AAIpI,QAAI,aAAa,sBAAsB,aAAa,mBAAmB,eAAe;AACpF,+BAAyB;AACzB,+BAAyB;AACzB,+BAAyB;AACzB,+BAAyB;AACzB,aAAO,aAAa,mBAAmB;AAAA;AAEzC,WAAO;AAAA;AAGT,SAAO,iCACF,SADE;AAAA,IAEL;AAAA,IACA;AAAA,IACA,SAAS;AAAA;AAAA;AAKN,0BAA0B,QAAQ;AA9MzC;AAkNE,QAAM,SAAS,OAAO,OAAO,IAAI,CAAC,cAAc;AAC9C,UAAM,eAAe,mBAAK;AAC1B,QAAI,aAAa,cAAc,mBAAmB;AAChD,mBAAa,QAAQ,iCAChB,aAAa,QADG;AAAA,QAEnB,iBAAiB;AAAA;AAAA;AAGrB,WAAO;AAAA;AAMT,QAAM,YAAY,UAAU;AAC5B,SAAO,KAAM,+CAAW,sBAAX,oBAA8B,wBAAuB,IAAK,QAAQ,CAAC,QAAQ;AACtF,QAAI,UAAU,kBAAkB,oBAAoB,MAAM;AACxD,gBAAU,kBAAkB,oBAAoB,KAAK,QAAQ,CAAC,OAAO,UAAU;AAC7E,kBAAU,kBAAkB,oBAAoB,KAAK,OAAO,OAAO,CAAC,WAAW,UAAU,SAAS,MAAM,QAAQ,MAAM,OAAO;AAAA;AAAA;AAAA;AAKnI,SAAO,iCACF,YADE;AAAA,IAEL;AAAA,IACA,SAAS;AAAA;AAAA;AAIN,0BAA0B,QAAQ;AAIvC,QAAM,SAAS,OAAO,OAAO,IAAI,CAAC,cAAc;AAC9C,UAAM,eAAe,mBAAK;AAC1B,QAAI,aAAa,cAAc,mBAAmB;AAChD,mBAAa,QAAQ,iCAChB,aAAa,QADG;AAAA,QAEnB,8BAA8B;AAAA;AAAA;AAGlC,WAAO;AAAA;AAMT,QAAM,YAAY,UAAU;AAE5B,SAAO,iCACF,YADE;AAAA,IAEL;AAAA,IACA,SAAS;AAAA;AAAA;AAIN,0BAA0B,QAAQ;AACvC,QAAM,YAAY,UAAU;AAE5B,SAAO,iCACF,YADE;AAAA,IAEL,SAAS;AAAA;AAAA;AAON,0BAA0B,QAAQ;AACvC,QAAM,YAAY,UAAU;AAE5B,SAAO,iCACF,YADE;AAAA,IAEL,SAAS;AAAA;AAAA;;;ADnQN,IAAM,iBAAiB;AACvB,IAAM,kBAAkB;AAAA,EAC7B,SAAS,CAAC,IAAI,OAAM,QAAQ,8BAAoB;AAAA,EAChD,SAAS,CAAC,IAAI,OAAM,UAAU,0BAAgB,UAAU,uBAAc,QAAQ,8BAAoB;AAAA,EAClG,SAAS,CAAC,IAAI,OAAM,UAAU,0BAAgB,UAAU,uBAAc,QAAQ,8BAAoB;AAAA,EAClG,SAAS,CAAC,IAAI,OAAM,UAAU,0BAAgB,UAAU,uBAAc,QAAQ,8BAAoB;AAAA,EAClG,SAAS,CAAC,IAAI,OAAM,UAAU,0BAAgB,UAAU,uBAAc,QAAQ,8BAAoB;AAAA,EAClG,SAAS,CAAC,IAAI,OAAM,UAAU,0BAAgB,UAAU,uBAAc,QAAQ,8BAAoB;AAAA,EAClG,SAAS,CAAC,IAAI,OAAM,UAAU,0BAAgB,UAAU,uBAAc,QAAQ,8BAAoB;AAAA;;;AD7BpG,4BAA4B,YAAY;AAGtC,MAAI;AACF,UAAM,WAAW,gBAAgB,gBAAgB;AACjD,UAAM,QAAQ,SAAS;AACvB,QAAI,CAAC,OAAO;AACV,YAAM,gBAAgB,KAAK,UAAU,SAAS,QAAQ,MAAM;AAC5D,YAAM,IAAI,MAAM,6BAA6B;AAAA;AAAA,WAExC,GAAP;AACA,YAAQ,MAAM;AAAA;AAAA;AAiBH,2BAA2B,OAAO;AAC/C,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,QAAM,UAAU;AAChB,QAAM,UAAU;AAEhB,QAAM,qBAAqB;AAM3B,cAAU,MAAM,mBAAmB,UAEjC,CAAC,eAAe;AACd,QAAI,0BAA0B,YAAY;AACxC,yBAAmB;AAAA;AAErB,QAAI,kBAAkB,YAAY;AAChC,qBAAe;AAAA;AAAA,KAKnB,WAAS,MAAM,aACd,CAAC,gBAAgB,wBAAwB;AAG5C,cAAU,MAAM;AACd,QAAI,UAAU,SAAS;AACrB,aAAO;AAAA;AAAA,KAER,CAAC,SAAS;AAGb,cAAU,MAAM;AACd,QAAI,kBAAkB,SAAS;AAC7B,qBAAe;AAAA;AAAA,KAEhB,CAAC,SAAS;AAGb,SAAO;AAAA;;;AG/ET;;;ACAA;AAEe,qBAAqB,OAAO;AACzC,QAAM,EAAE,2BAAa,aAAa;AAElC,SACE,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,KAAD,MAAI,eAEH,YAAY,MAAM,KAAK,SAAS,WAC9B,IAAI,CAAC,CAAC,YAAY,EAAE,MAAM,WAAW,UAAU,sBAC9C,kBAAkB,OAAO,QAAQ,gBAAgB,SAAS,IACxD,sCAAC,WAAD;AAAA,IAAS,KAAK;AAAA,KACZ,sCAAC,WAAD,MAAU,YACV,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,SAAD,MACE,sCAAC,SAAD,MACG,OAAO,QAAQ,gBACb,IAAI,CAAC,CAAC,KAAK,WACV,sCAAC,MAAD;AAAA,IAAI;AAAA,KACF,sCAAC,MAAD;AAAA,IAAI,OAAO;AAAA,KAAM,MACjB,sCAAC,MAAD;AAAA,IAAI,OAAO;AAAA,KAAQ,eAO/B;AAAA;;;ADpBd,IAAM,yBAAyB,CAAC;AAajB,+BAA+B,OAAO;AACnD,QAAM;AAAA,IACJ;AAAA,IACA,aAAa;AAAA,IACb;AAAA,IACA;AAAA,IACA,iBAAQ;AAAA,MACN;AAEJ,QAAM,UAAU;AAGhB,QAAM,CAAC;AAAA,IACL;AAAA,IACA,qBAAqB;AAAA,OAClB,gBAAgB,6BAA6B,aAAa;AAE/D,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAIF,cAAU,MAAM;AACd;AAAA,KAEC,CAAC,SAAS;AAGb,QAAM,CAAC,gBAAe,eAAe,SAAS;AAC9C,QAAM,CAAC,QAAQ,mBAAmB,kBAAkB,cAClD,SAAS,SAAS,gBAAgB,MAAM;AAAA,KAAI;AAG9C,QAAM,WAAW,SAAQ,MAAM;AAC7B,UAAM,SAAS,IAAI;AACnB,QAAI,gBAAgB,aAAa,SAAS,KAAK,UAAU,kBAAkB,mBAAmB;AAC5F,mBAAa,QAAQ,CAAC,UAAU;AAC9B,YAAI,eAAe,MAAM,QAAQ;AAE/B,gBAAM,EAAE,WAAW,kBAAkB,MAAM,OAAO;AAClD,iBAAO,IAAI,GAAG,MAAM,SAAS;AAAA,YAC3B,MAAM,OAAO,KAAK,MAAM,OAAO;AAAA,YAC/B,UAAU,UAAU;AAAA;AAAA;AAAA;AAAA;AAK5B,WAAO;AAAA,KACN,CAAC,QAAQ,cAAc,gBAAgB;AAE1C,SACE,sCAAC,WAAD;AAAA,IACE,OAAO;AAAA,IACP;AAAA,IACA,UAAQ;AAAA,IACR;AAAA,IACA;AAAA,KAEA,sCAAC,aAAD;AAAA,IACE,aAAa,uBAAuB;AAAA,IACpC;AAAA;AAAA;;;AEtFR;;;ACAA;AAEe,gBAAgB,OAAO;AACpC,QAAM,YAAY;AAClB,QAAM,EAAE,MAAM,gBAAS;AACvB,QAAM,WAAW;AACjB,MAAI,MAAM;AACR,aAAS,KAAK,sCAAC,KAAD;AAAA,MAAG,WAAU;AAAA,MAAU,KAAI;AAAA,OAAQ;AAAA;AAEnD,MAAI,OAAM;AACR,aAAS,KAAK,sCAAC,KAAD;AAAA,MAAG,WAAW;AAAA,MAAW,KAAI;AAAA,OAAQ;AAAA;AAErD,SACE;AAAA;;;ADKW,0BAA0B,OAAO;AAC9C,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,iBAAQ;AAAA,MACN;AAGJ,QAAM,CAAC;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,OACG,gBAAgB,6BAA6B,QAAQ;AAE1D,QAAM,QAAO;AAEb,QAAM,QAAQ;AAAA,IACZ,GAAI,gBACA,CAAC,gBAAgB,mBACjB;AAAA,IAEJ,GAAI,gBACA,CAAC,gBAAgB,mBACjB;AAAA,IAEJ,GAAI,oBACA,CAAC,gBAAgB,uBACjB;AAAA;AAGN,QAAM,OAAO,MAAM,KAAK;AAExB,SACE,sCAAC,WAAD;AAAA,IACE,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA,UAAQ;AAAA,IACR,SAAO;AAAA,KAEP,sCAAC,QAAD;AAAA,IAAQ,MAAM;AAAA,IAAM;AAAA;AAAA;;;AE3D1B;;;ACAA;;;ACEA;AACA;AACA;AACA;AACA;AACA;AAmBe,yBAAyB,OAAO;AAC7C,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,gBAAgB;AAAA,IAChB,kBAAkB;AAAA,IAClB,aAAa;AAAA,IACb,YAAY;AAAA,MACV;AAEJ,QAAM,CAAC,cAAc,mBAAmB,WAAS;AAGjD,QAAM,cAAc,cAAY,CAAC,OAAO,YAAY;AAClD,QAAI,WAAW,cAAc;AAC3B,UAAI,CAAC,eAAe;AAClB,wBAAgB,UAAU,CAAC,SAAS;AAAA,aAC/B;AACL,wBACE,UACI,MAAM,gBAAgB,IAAI,CAAC,UAC3B,WAAW,gBAAgB,IAAI,CAAC;AAAA;AAAA;AAAA,KAIzC,CAAC,eAAe,cAAc;AAGjC,QAAM,oBAAoB,cAAY,CAAC,UAAU;AAC/C,UAAM,EAAE,WAAW;AACnB,UAAM,EAAE,YAAY;AACpB,UAAM,EAAE,UAAU;AAClB,gBAAY,OAAO;AAAA,KAClB,CAAC;AAIJ,QAAM,iBAAiB,cAAY,SAAO,IAAI,IAAI,QAAO;AAAA,KACtD,QAAQ;AAAA,IACT,MAAM,KAAK,KAAK,UAAQ,KAAK,WAAW;AAAA,OACrC,CAAC,MAAM;AAGZ,QAAM,aAAa,cAAY,QAC7B,MAAM,QAAQ,iBAAiB,aAAa,SAAS,KACpD,CAAC;AAGJ,cAAU,MAAM;AAEd,UAAM,sBAAsB,KACzB,IAAI,CAAC,MAAM;AACV,UAAI,EAAE,WAAW;AACf,eAAO,EAAE;AAAA;AAEX,aAAO;AAAA,OAER,OAAO;AACV,QAAI,CAAC,SAAQ,qBAAqB,eAAe;AAC/C,UAAI,oBAAoB,SAAS,GAAG;AAClC,wBAAgB;AAAA,aACX;AACL,wBAAgB;AAAA;AAAA;AAAA,KAGnB,CAAC,MAAM,OAAO;AAGjB,cAAU,MAAM;AAEd,QAAI,CAAC,YAAY,CAAC,cAAc;AAC9B;AAAA;AAEF,UAAM,kBAAkB,eAAe;AACvC,QAAI,eAAe;AACjB,eAAS;AAAA,eACA,aAAa,WAAW,GAAG;AACpC,eAAS,gBAAgB;AAAA,eAChB,aAAa,WAAW,GAAG;AACpC,eAAS;AAAA;AAAA,KAEV,CAAC;AAGJ,QAAM,YAAY;AAGlB,QAAM,oBAAqB,kBAAkB,KAAK;AAElD,QAAM,cAAc,CAAC,EAAE,OAAO,YAE5B,sCAAC,OAAD;AAAA,IACE,KAAK,KAAK,OAAO;AAAA,IACjB,WAAW,wBAAwB,WAAW,KAAK,OAAO,UAAU,iBAAiB;AAAA,IACrF;AAAA,IACA,MAAK;AAAA,IACL,SAAS,MAAM,YACb,KAAK,OAAO,QACZ,CAAC,WAAW,KAAK,OAAO,WAAW,CAAC;AAAA,KAGtC,sCAAC,OAAD;AAAA,IAAK,WAAW,mBAAmB;AAAA,KACjC,sCAAC,SAAD;AAAA,IAAO,SAAS,GAAG,aAAa,KAAK,OAAO;AAAA,KAC1C,sCAAC,SAAD;AAAA,IACE,IAAI,GAAG,aAAa,KAAK,OAAO;AAAA,IAChC,MAAK;AAAA,IACL,WAAY,gBAAgB,aAAa;AAAA,IACzC,MAAM;AAAA,IACN,OAAO,KAAK,OAAO;AAAA,IACnB,UAAU;AAAA,IACV,SAAS,WAAW,KAAK,OAAO;AAAA,QAIrC,QAAQ,IAAI,YACX,sCAAC,OAAD;AAAA,IACE,WAAU;AAAA,IACV,KAAK;AAAA,KAEJ,KAAK,OAAO;AAMrB,QAAM,oBAAoB,CAAC,EAAE,YAC3B,sCAAC,OAAD;AAAA,IAAK,WAAW,GAAG;AAAA,IAA+B;AAAA,KAC/C,QAAQ,IAAI,YACX,sCAAC,OAAD;AAAA,IAAK,KAAK;AAAA,KAAS;AAKzB,SACE,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,WAAD,MACG,CAAC,EAAE,OAAO,aACT,sCAAC,QAAD;AAAA,IACE,QAAQ,cAAc;AAAA,IACtB,WAAW,EAAE,SAAS;AAAA,IACtB,UAAU,KAAK;AAAA,IAEf,WAAW;AAAA,IACX,cAAc,gBAAgB,KAAK;AAAA,IACnC;AAAA,IACA,OAAO,aAAa;AAAA,IACpB,mBAAmB,gBAAgB,oBAAoB;AAAA,IACvD,WAAW,CAAC,EAAE,YAAY,KAAK;AAAA;AAAA;;;ADhL5B,eAAe,OAAO;AACnC,QAAM;AAAA,IACJ;AAAA,IACA,WAAW;AAAA,IACX,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb;AAAA,MACE;AAEJ,QAAM,CAAC,YAAY,iBAAiB,WAAS;AAC7C,QAAM,CAAC,eAAe,oBAAoB,WAAS;AAEnD,cAAU,MAAM;AACd,UAAM,UAAU,SACb,OAAO,UAAQ,KAAK,cAAc,SAAS,WAAW;AACzD,qBAAiB;AAAA,KAChB,CAAC,YAAY;AAEhB,oBAAkB,WAAW;AAC3B,QAAI,oBAAoB,aAAa,UAAU,MAAM;AACnD,uBAAiB,CAAC,UAAU;AAAA;AAAA;AAIhC,QAAM,OAAO,cACV,OAAO,UAAS,aAAa,WAAW,SAAS,QAAQ,MACzD,KAAK,CAAC,GAAG,MAAM,EAAE,cAAc,IAC/B,IACC,UAAS,GAAE,MAAM,MAAM,OAAQ,gBAAgB,cAAc,SAAS,QAAQ;AAGlF,QAAM,eAAe,CAAC,UAAU;AAC9B,kBAAc,MAAM,OAAO;AAAA;AAG7B,SACE,8DACE,sCAAC,SAAD;AAAA,IACE,WAAU;AAAA,IACV,MAAK;AAAA,IACL,aAAY;AAAA,IACZ,OAAO;AAAA,IACP,UAAU;AAAA,MAEZ,sCAAC,iBAAD;AAAA,IACE,SAAS,CAAC;AAAA,IACV;AAAA,IACA;AAAA,IACA,OAAM;AAAA,IACN,UAAS;AAAA,IACT;AAAA,IACA,cAAc;AAAA,IACd,eAAe;AAAA;AAAA;;;AD7CvB,IAAM,mBAAmB,CAAC;AAgBX,yBAAyB,OAAO;AAC7C,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA,wBAAwB,iBAAiB;AAAA,IACzC,8BAA8B,uBAAuB,GAAG;AAAA,IACxD;AAAA,IACA,iBAAQ;AAAA,MACN;AAEJ,QAAM,UAAU;AAGhB,QAAM,CAAC;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KACC;AAAA,IACD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,OACG,gBAAgB,6BAA6B,OAAO;AAEzD,QAAM,CAAC,MAAM,QAAQ,aAAa;AAClC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAIF,cAAU,MAAM;AACd;AACA;AAAA,KAEC,CAAC,SAAS;AAGb,QAAM,CAAC,SAAS,mBACd,SAAS,SAAS,gBAAgB,QAAQ;AAE5C,QAAM,WAAW,QAAQ,MAAM,OAAO;AACtC,QAAM,WAAW,SAAS;AAE1B,4CAA0C,cAAc;AACtD,qBAAiB;AACjB,yBAAqB;AAAA;AAGvB,SACE,sCAAC,WAAD;AAAA,IACE,OAAO;AAAA,IACP,MAAM,GAAG,YAAY,UAAU,gBAAgB,sBAAsB;AAAA,IACrE;AAAA,IAIA,UAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,KAEA,sCAAC,OAAD;AAAA,IACE,kBAAkB,sBAAsB;AAAA,IACxC;AAAA,IACA;AAAA,IACA;AAAA,IACA,kBAAkB;AAAA,IAClB;AAAA,IACA;AAAA;AAAA;;;AGpGR;AAAA;AAAA;AAAA;AAAA;AAKA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACJA;AACA;;;ACFA;AACA;AACA;AAOA,IAAM,OAAO,QAAM,WAAW,CAAC,OAAO,QAAQ;AAC5C,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AACJ,SACE,sCAAC,QAAD;AAAA,IACE,YAAY;AAAA,IACZ;AAAA,KACI,QAHN;AAAA,IAIE,WAAW,WAAW,WAAW;AAAA,OAC9B,GAAG,wBAAwB,CAAC;AAAA,OAC5B,GAAG,yBAAyB;AAAA;AAAA,IAE/B,WAAW,YAAY,sCAAC,QAAD;AAAA,MAAM,WAAW,GAAG;AAAA,SAAiC;AAAA,MAE3E;AAAA;AAKP,KAAK,eAAe;AAAA,EAClB,SAAS;AAAA,EACT,WAAW;AAAA,EACX,UAAU;AAAA,EACV,WAAW;AAAA,EACX,WAAW;AAAA;AAGb,IAAO,eAAQ;;;AC1Cf;AACA;AACA;AACA;AACA;AACA;AACA;;;ACNA;AACA;;;ACDA;;;ACAA;AACA;AAae,qBAAqB,OAAO;AACzC,QAAM,EAAE,gBAAO,SAAS,qBAAqB;AAC7C,QAAM,UAAU;AAChB,QAAM,sBAAsB,qBAAqB;AAEjD,QAAM,UAAU,WAAS;AAEzB,SACE,8DACE,sCAAC,QAAD;AAAA,IAAM,KAAK;AAAA,MACX,sCAAC,WAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,KACI;AAAA;AAMZ,YAAY,eAAe;AAAA,EACzB,kBAAkB;AAAA,EAClB,WAAW;AAAA,EACX,SAAS;AAAA,EACT,iBAAiB;AAAA,EACjB,iBAAiB;AAAA;;;AD/BJ,iBAAiB,OAAO;AACrC,SACE,sCAAC,aAAD,mBAAiB;AAAA;AAIrB,QAAQ,eAAe;AAAA,EACrB,kBAAkB;AAAA,EAClB,WAAW;AAAA,EACX,SAAS;AAAA,EACT,iBAAiB;AAAA,EACjB,iBAAiB;AAAA;;;ADEnB,+BAA+B,OAAO;AACpC,QAAM;AAAA,IACJ;AAAA,IAAO;AAAA,IAAU;AAAA,IAAS;AAAA,IAAS;AAAA,IAAY;AAAA,IAC/C;AAAA,MACE;AAEJ,QAAM,CAAC,cAAc,mBAAmB,WAAS;AAEjD,cAAU,MAAM;AAGd,oBAAgB;AAAA,KACf,CAAC;AAEJ,oCAAkC;AAChC,QAAI,CAAC,WAAW,cAAc;AAC5B;AACA;AAAA,WACK;AACL,sBAAgB;AAAA;AAAA;AAIpB,QAAM,mBAAmB,GAAG,eAAe,aAAa,KAAK;AAE7D,SACE,sCAAC,UAAD;AAAA,IACE,OAAO;AAAA,IACP,MAAK;AAAA,IACL,SAAS;AAAA,IACT,YAAY,OAAK,mBAAmB,GAAG,YAAY;AAAA,KACnD,kBACC,YAAa,8DAAE,sCAAC,MAAD,OAAM,sCAAC,QAAD;AAAA,IAAM,WAAU;AAAA,KAAS;AAAA;AAqBrD,yBAAyB,OAAO;AAC9B,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,WAAW;AAAA,IACX;AAAA,MACE;AAEJ,6BAA2B,EAAE,OAAO;AAClC,QAAI,OAAO,UAAU;AACnB,eAAS,CAAC,IAAI,GAAG,IAAI,GAAG,IAAI;AAAA;AAAA;AAIhC,QAAM,iBAAiB,UACnB,QAAQ,IAAI,sBACZ,QAAQ,OAAO,CAAC,CAAC,KAAK,KAAK,MAAM,CAAC,KAAK,KAAK,MAAM,CAAC,GAAG,GAAG,KAAK,IAAI;AAEtE,SACE,sCAAC,OAAD,MACG,SAAS,YAAY,kBACpB,sCAAC,eAAD;AAAA,IACE,WAAU;AAAA,IACV,cAAY;AAAA,IACZ,OAAO;AAAA,IACP,UAAS;AAAA,IACT,QAAQ;AAAA,IACR,OAAO,mBAAmB;AAAA,IAC1B,kBAAkB;AAAA,MAGtB,sCAAC,MAAD;AAAA,IAAI,WAAU;AAAA,KACX,WAAW,IAAI,UACd,sCAAC,MAAD;AAAA,IAAI,KAAK,KAAK,QAAQ,KAAK;AAAA,KACzB,sCAAC,uBAAD,iCACM,OADN;AAAA,IAEE;AAAA,IACA;AAAA;AAAA;AAuBC,qBAAqB,OAAO;AACzC,QAAM;AAAA,IACJ;AAAA,IAAY;AAAA,IAAW;AAAA,IACvB,QAAQ;AAAA,IAAM,WAAW;AAAA,IAAM,UAAU;AAAA,MACvC;AAEJ,QAAM,CAAC,SAAS,cAAc,WAAS;AAEvC,SACE,sCAAC,SAAD;AAAA,IACE,SACE,sCAAC,iBAAD;AAAA,MACE;AAAA,MACA,SAAS,MAAM,WAAW;AAAA,MAC1B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAAA,IAGJ;AAAA,IACA;AAAA,IACA,iBAAiB;AAAA,KAEhB;AAAA;;;AGhKP;AAAA;AAAA;AAEA,iBAAiB,OAAO;AACtB,SAAO,+BAAC,OAAD;AAAA,IAAK,OAAO;AAAA,IAAI,QAAQ;AAAA,IAAI,SAAQ;AAAA,KAAgB,QAAO,+BAAC,QAAD;AAAA,IAAM,GAAE;AAAA;AAAA;AAGrE,IAAM,kBAAiB;;;AJa9B,gCAAgC,OAAO;AACrC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,SAAO;AAAA,IACL,GAAI,WAAW;AAAA,MACb;AAAA,QACE,OAAO;AAAA,QACP,SAAS,MAAM;AAAE,6BAAmB,MAAM;AAAA;AAAA,QAC1C,YAAY;AAAA;AAAA,MAEd;AAAA,QACE,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,MAAM;AAAE,uBAAa;AAAA;AAAA,QAC9B,YAAY;AAAA;AAAA,QAEZ;AAAA,IACJ,GAAI,UAAU,KAAK,aAAa;AAAA,MAC9B;AAAA,QACE,OAAO;AAAA,QACP,UAAU;AAAA,QACV,SAAS,MAAM;AAAE,oCAA0B;AAAA;AAAA,QAC3C,YAAY;AAAA;AAAA,MAEd,GAAI,UAAU,IAAI;AAAA,QAChB;AAAA,UACE,OAAO;AAAA,UACP,UAAU;AAAA,UACV,SAAS,MAAM;AAAE,yCAA6B;AAAA;AAAA,UAC9C,YAAY;AAAA;AAAA,UAEZ;AAAA,QACF;AAAA,IACJ,GAAI,QAAQ,IAAI;AAAA,MACd,GAAI,YAAY;AAAA,QACd;AAAA,UACE,OAAQ,UAAU,YAAY;AAAA,UAC9B,SAAS,MAAM;AAAE,wBAAY,MAAM,CAAC;AAAA;AAAA,UACpC,YAAY;AAAA;AAAA,UAEZ;AAAA,MACJ,GAAI,aAAa;AAAA,QACf;AAAA,UACE,OAAO;AAAA,UACP,UAAU;AAAA,UACV,SAAS,MAAM;AAAE,4BAAgB;AAAA;AAAA,UACjC,YAAY;AAAA;AAAA,UAEZ;AAAA,QACF;AAAA;AAAA;AAQR,4BAA4B,OAAO;AACjC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AACJ,QAAM,uBAAwB,UAAU,KAAK,CAAC;AAC9C,QAAM,mBACH,qBAAqB,SAAQ,MAAM,qBAAqB,oBAAoB,SACzE,oBAAoB,IACpB;AAEN,QAAM,kBAAkB,IAAI,KAAK,aAAa;AAC9C,QAAM,WAAW,gBAAgB,OAAO;AACxC,MAAI;AACJ,MAAI,sBAAsB;AACxB,kBAAc,oBAAoB;AAAA,aACzB,UAAU,CAAC,UAAU;AAC9B,kBAAc,yBAAyB,YAAY,WAAY,SAAS,IAAI,KAAK;AAAA,SAC5E;AACL,kBAAc;AAAA;AAMhB,QAAM,UAAW,UAAU,KAAK,CAAC,WAC7B,MAAM,aAAa,SAAS,oBAC5B,MAAM,WAAW;AAErB,QAAM,eAAgB,iBAAiB,EAAE,SAAS,UAAU;AAC5D,QAAM,oBAAoB,uBAAuB;AACjD,SACE,sCAAC,QAAD,MACE,sCAAC,aAAD;AAAA,IAAa,OAAO;AAAA,KAAiB,eACnC,sCAAC,UAAD;AAAA,IACE,MAAK;AAAA,IACL;AAAA,IACA,YAAY,OAAK,mBAAmB,GAAG,KAAK,MAAM,WAAW;AAAA,IAC7D,WAAU;AAAA,KAET,WAGJ,kBAAkB,SAAS,IAC1B,sCAAC,aAAD;AAAA,IACE,YAAY,uBAAuB;AAAA,IACnC,OAAO,QAAQ,KAAK,WAAY,SAAS,gBAAgB,SAAU;AAAA,IACnE,UAAU,OAAK,eAAe,MAAM;AAAA,KAEpC,sCAAC,iBAAD;AAAA,IAAS,WAAU;AAAA,QAEnB,MACH,QAAQ,KAAK,aAAa,WAAW,MACrC,QAAQ,KAAM,sCAAC,QAAD;AAAA,IAAM,WAAU;AAAA,KAAmB;AAAA;AAUxD,6BAA6B,OAAO;AAClC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AACJ,QAAM,CAAC,cAAc,mBAAmB,WAAS;AAIjD,QAAM,eAAe,mBAAmB,MAAM;AAC9C,wBAAsB;AACpB,QAAI,CAAC,cAAc;AACjB,oBAAc,MAAM,cAAc;AAAA;AAAA;AAGtC,SACE,sCAAC,QAAD;AAAA,IAAM,WAAU;AAAA,KACd,sCAAC,SAAD;AAAA,IAEE,WAAS;AAAA,IACT,WAAU;AAAA,IACV,MAAK;AAAA,IACL,OAAO;AAAA,IACP,UAAU,CAAC,MAAM;AAAE,sBAAgB,EAAE,OAAO;AAAA;AAAA,IAC5C,YAAY,OAAK,mBACf,GACA,SACA;AAAA,IAEF,SAAS,OAAK,EAAE,OAAO;AAAA,MAExB,CAAC,gBACA,sCAAC,UAAD;AAAA,IACE,MAAK;AAAA,IACL,WAAU;AAAA,IACV,SAAS;AAAA,KACV;AAAA;AAaT,sBAAsB,OAAO;AAC3B,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,MACE;AACJ,SACG,aAAa,eACT,sCAAC,qBAAD,mBAAyB,UACzB,sCAAC,oBAAD,mBAAwB;AAAA;AASjC,uBAAuB,OAAO;AAC5B,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AACJ,mBAAiB,OAAO;AACtB,QAAI,MAAM,OAAO,SAAS;AACxB,YAAM,WAAW,SAAS,MAAM,OAAO,OAAO;AAC9C,mBAAa,SAAS;AAAA;AAAA;AAG1B,SACE,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACZ,OAAM,GAAG,SAAS,GAAG,IAAI,CAAC,MAAM;AAC/B,UAAM,YAAY,SAAQ,MAAM,qBAAqB,MAAM;AAC3D,WACE,sCAAC,OAAD;AAAA,MAAK,WAAU;AAAA,MAAgB,KAAK;AAAA,OAClC,sCAAC,aAAD;AAAA,MAAa,OAAO,oBAAoB;AAAA,OACtC,sCAAC,SAAD;AAAA,MACE,WAAW,KAAK,sBAAsB,EAAE,SAAS,aAAa,CAAC;AAAA,MAC/D,MAAK;AAAA,MACL,OAAO;AAAA,MACP,SAAS,aAAa;AAAA,MACtB,UAAU;AAAA;AAAA;AAAA;AAgB1B,sBAAsB,OAAO;AAC3B,QAAM;AAAA,IACJ;AAAA,IAAQ;AAAA,IAAQ;AAAA,MACd;AACJ,QAAM,WAAY,QAAQ,mBAAmB,SAAS;AACtD,MAAI,QAAQ;AACV,WACE,sCAAC,KAAD;AAAA,MACE,WAAU;AAAA,OAEV,sCAAC,OAAD;AAAA,MACE,SAAQ;AAAA,MACR,WAAU;AAAA,MACV,aAAU;AAAA,MACV,OAAM;AAAA,MACN,QAAO;AAAA,MACP,eAAY;AAAA,OAEZ,sCAAC,QAAD;AAAA,MAAM,MAAM;AAAA,MAAU,GAAG,MAAM;AAAA,MAAG,GAAG,MAAM;AAAA,MAAG,OAAO,OAAO;AAAA,MAAK,QAAQ,OAAO;AAAA;AAAA;AAKxF,SACE,sCAAC,KAAD;AAAA,IACE,WAAU;AAAA,KAEV,sCAAC,OAAD;AAAA,IACE,SAAQ;AAAA,IACR,WAAU;AAAA,IACV,aAAU;AAAA,IACV,OAAM;AAAA,IACN,QAAO;AAAA,IACP,eAAY;AAAA,KAEZ,sCAAC,QAAD;AAAA,IACE,MAAO,SAAS,SAAS;AAAA,IACzB,GAAE;AAAA;AAAA;AAWZ,6BAAsC,WAAW;AAAA,EAAjD,cA3UA;AA2UA;AAIE,0CAAiB,MAAM;AACrB,YAAM;AAAA,QACJ;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,aAAa;AAAA,UACX,KAAK;AACT,YAAM;AAAA,QACJ,QAAQ;AAAA,UACN,WAAW;AAAA,UACX;AAAA;AAAA,UAEA,KAAK;AAET,YAAM,cAAc,CAAC,MAAM;AACzB;AACA,aAAK,YAAY;AAAA;AAGnB,YAAM,YAAY,GAAG;AACrB,YAAM,cAAe,CAAC,gBAAgB,CAAC,aAAa;AACpD,aACE,sCAAC,QAAD;AAAA,QACE,KAAK,KAAK;AAAA,QACV,OAAO;AAAA,QACP,WAAW,YACT,WACA,GAAG,aAAa,KAAK,kBAAkB,YACvC,cAAc,GAAG,6BACjB,eAAe;AAAA,QAEjB,WAAW;AAAA,QACX,gBAAc;AAAA,QACd,aAAa,cAAc,cAAc;AAAA,SAEzC,sCAAC,cAAD,iCACM,KAAK,QADX;AAAA,QAEE;AAAA,QACA,UAAU,KAAK;AAAA,WAEhB,KAAK;AAAA;AASZ,wCAAe,MAAM;AACnB,YAAM,EAAE,OAAO,aAAa,KAAK;AACjC,UAAI,UAAU,KAAK,UAAU;AAC3B,eAAO;AAAA;AAET,aACE,sCAAC,eAAD,mBACM,KAAK;AAAA;AAQf,0CAAiB,MAAM;AACrB,YAAM,EAAE,UAAU,QAAQ,UAAU,KAAK;AACzC,YAAM;AAAA,QACJ,QAAQ;AAAA,UACN,WAAW;AAAA,UACX;AAAA;AAAA,UAEA,KAAK;AAET,YAAM,sBAAsB,CAAC,MAAM;AAEjC,YAAI,CAAC,QAAQ;AACX,uBAAa,GAAG;AAAA;AAAA;AAIpB,YAAM,gBAAgB,YACpB,GAAG,wBACH,GAAG,GAAG,wBAAyB,WAAW,SAAS,YAAa,CAAC;AAEnE,aACE,sCAAC,QAAD;AAAA,QACE,WAAW;AAAA,QACX,SAAS;AAAA,QACT,YAAY,OAAK,mBAAmB,GAAG,KAAK;AAAA,QAC5C,MAAK;AAAA,QACL,UAAS;AAAA,SAET,sCAAC,cAAD;AAAA,QACE;AAAA,QACA,QAAQ;AAAA,QACR;AAAA;AAAA;AAAA;AAAA,EAWR,SAAS;AACP,UAQI,WAAK,OAPP;AAAA;AAAA,MAAO;AAAA,MAAS;AAAA,MAChB;AAAA,MAAU;AAAA,MAAgB;AAAA,MAC1B;AAAA,MACA;AAAA,MAAU;AAAA,MAAU;AAAA,MAAS;AAAA,MAC7B,WAAW;AAAA,MACX;AAAA,QAEE,KADC,uBACD,KADC;AAAA,MANH;AAAA,MAAO;AAAA,MAAS;AAAA,MAChB;AAAA,MAAU;AAAA,MAAgB;AAAA,MAC1B;AAAA,MACA;AAAA,MAAU;AAAA,MAAU;AAAA,MAAS;AAAA,MAC7B;AAAA,MACA;AAAA;AAGF,UAAM;AAAA,MACJ,QAAQ;AAAA,QACN,WAAW;AAAA,QACX;AAAA,QACA;AAAA;AAAA,QAEA,KAAK;AACT,UAAM,WAAW,KAAK;AACtB,UAAM,4BAA4B,eAAe;AAEjD,UAAM,YAAY,CAAC,MAAM;AACvB;AACA,WAAK,UAAU;AAAA;AAGjB,WACE,sCAAC,MAAD;AAAA,MACE,WAAW,YAAW,oBAAoB,SAAS,kBAAkB;AAAA,SAClE,GAAG,kCAAkC;AAAA,SACrC,GAAG,iCAAiC,WAAW,SAAS,YAAY,CAAC;AAAA,SACrE,GAAG,0CAA0C;AAAA,SAC7C,GAAG,gDAAgD;AAAA,SACnD,GAAG,kCAAkC;AAAA,SACrC,GAAG,iCAAiC;AAAA,QAErC,aAAa,CAAC,YAAY;AAAA,QAC1B,qBAAqB,CAAC,YAAY;AAAA,QAClC,wBAAwB,CAAC,YAAY;AAAA,QACrC,eAAe,kBAAkB,eAAe;AAAA;AAAA,MAElD;AAAA,MACA,MAAK;AAAA,MACL,aAAa,YAAY,KAAK,cAAc;AAAA,MAC5C,YAAY,YAAY,KAAK,aAAa;AAAA,MAC1C,aAAa,YAAY,KAAK,cAAc;AAAA,MAC5C,QAAQ,YAAY,KAAK,OAAO,KAAK,QAAQ;AAAA,MAC7C,WAAW,YAAY,YAAY;AAAA,OAC/B,4BAEH,aAAa,KAAK,mBAAmB,MACrC,KAAK,kBACL,KAAK;AAAA;AAAA;;;AK7ed;;;ACAA;AAAA;AAAA;AAEA,kBAAkB,OAAO;AACvB,SAAO,+BAAC,OAAD;AAAA,IAAK,SAAQ;AAAA,IAAuB,QAAQ;AAAA,IAAI,OAAO;AAAA,KAAQ,QAAO,+BAAC,KAAD;AAAA,IAAG,WAAU;AAAA,KAA0B,+BAAC,QAAD;AAAA,IAAM,GAAE;AAAA,IAAygD,OAAO;AAAA,MACtoD,aAAa;AAAA,MACb,kBAAkB;AAAA,MAClB,iBAAiB;AAAA,MACjB,eAAe;AAAA;AAAA;AAAA;AAIhB,IAAM,kBAAiB;;;ACX9B;AAAA;AAAA;AAEA,yBAAyB,OAAO;AAC9B,SAAO,+BAAC,OAAD;AAAA,IAAK,OAAO;AAAA,IAAI,QAAQ;AAAA,IAAI,SAAQ;AAAA,KAAgB,QAAO,+BAAC,KAAD;AAAA,IAAG,WAAU;AAAA,KAAkB,+BAAC,QAAD;AAAA,IAAM,GAAE;AAAA,IAAurB,OAAO;AAAA,MACjyB,aAAa;AAAA,MACb,kBAAkB;AAAA,MAClB,iBAAiB;AAAA,MACjB,eAAe;AAAA;AAAA;AAAA;AAIhB,IAAM,kBAAiB;;;ACX9B;AAAA;AAAA;AAEA,uBAAuB,OAAO;AAC5B,SAAO,+BAAC,OAAD;AAAA,IAAK,IAAG;AAAA,IAAQ,SAAQ;AAAA,IAAuB,QAAQ;AAAA,IAAI,OAAO;AAAA,KAAmB,QAAO,+BAAC,QAAD,MAAM,+BAAC,QAAD;AAAA,IAAM,IAAG;AAAA,IAAa,GAAG;AAAA,IAAG,GAAG;AAAA,IAAG,OAAO;AAAA,IAAe,QAAQ;AAAA,KAAI,+BAAC,QAAD;AAAA,IAAM,GAAE;AAAA,IAAK,OAAM;AAAA,IAAM,QAAO;AAAA,IAAO,MAAK;AAAA,MAAU,+BAAC,KAAD;AAAA,IAAG,WAAU;AAAA,KAAoB,+BAAC,QAAD;AAAA,IAAM,GAAE;AAAA,IAAygD,OAAO;AAAA,MAClxD,aAAa;AAAA,MACb,kBAAkB;AAAA,MAClB,iBAAiB;AAAA,MACjB,eAAe;AAAA;AAAA,IACd,MAAK;AAAA,SAA4B,+BAAC,KAAD,MAAG,+BAAC,QAAD;AAAA,IAAM,GAAG;AAAA,IAAG,GAAG;AAAA,IAAG,OAAO;AAAA,IAAe,QAAQ;AAAA,IAAI,MAAK;AAAA;AAAA;AAGnG,IAAM,kBAAiB;;;AHiBvB,oBAAoB,OAAO;AAChC,QAAM;AAAA,IACJ;AAAA,IAAU;AAAA,IAAS;AAAA,IAAc;AAAA,IACjC;AAAA,IAAY;AAAA,MACV;AAQJ,QAAM,WAAW,cAAY,CAAC,eAAe,aAAa,MAAM;AAC9D,UAAM,kBAAkB,SAAS,cAAc;AAC/C,oBAAgB,aAAa,QAAQ;AACrC,oBAAgB,aAAa,UAAU;AACvC,aAAS,KAAK,YAAY;AAC1B,oBAAgB;AAChB,oBAAgB,iBAAiB,UAAU,CAAC,UAAU;AACpD,UAAI,CAAE,QAAO,QAAQ,OAAO,cAAc,OAAO,YAAY,OAAO,OAAO;AACzE,gBAAQ;AACR;AAAA;AAEF,YAAM,EAAE,kBAAU,MAAM;AACxB,UAAI,CAAC,UAAS,OAAM,WAAW,GAAG;AAChC,gBAAQ;AACR;AAAA;AAEF,YAAM,SAAS,IAAI;AACnB,aAAO,iBAAiB,QAAQ,MAAM;AACpC,cAAM,EAAE,WAAW;AACnB,YAAI;AACF,gBAAM,eAAe,cAAc,QAAQ;AAC3C,kBAAQ;AACR,uBAAa;AAAA,iBACN,GAAP;AACA,kBAAQ,EAAE;AAAA;AAAA,SAEX;AACH,aAAO,WAAW,OAAM;AAAA;AAE1B,oBAAgB;AAAA,KACf,CAAC,UAAU,SAAS;AAEvB,QAAM,aAAa;AAAA,IACjB,GAAI,WAAW;AAAA,MACb;AAAA,QACE,OAAO;AAAA,QACP,SAAS;AAAA,QACT,YAAY;AAAA;AAAA,QAEZ;AAAA,IACJ,GAAI,aAAa;AAAA,MACf;AAAA,QACE,OAAO;AAAA,QACP,UAAU;AAAA,QACV,SAAS,SAAS,qBAAqB;AAAA,QACvC,YAAY;AAAA;AAAA,MAEd;AAAA,QACE,OAAO;AAAA,QACP,UAAU;AAAA,QACV,SAAS,SAAS,kBAAkB;AAAA,QACpC,YAAY;AAAA;AAAA,QAEZ;AAAA;AAGN,SAAQ,WAAW,SAAS,IAC1B,sCAAC,aAAD;AAAA,IACE;AAAA,KAEA,sCAAC,UAAD;AAAA,IAAQ,WAAU;AAAA,IAAc,MAAK;AAAA,KAAS,QAE9C;AAAA;AAaC,6BAA6B,OAAO;AACzC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,SACE,8DACG,cACC,8DACE,sCAAC,UAAD;AAAA,IACE,SAAS;AAAA,IACT,OAAM;AAAA,IACN,MAAK;AAAA,IACL,UAAU,CAAC;AAAA,KAEX,sCAAC,iBAAD,QAEF,sCAAC,UAAD;AAAA,IACE,SAAS;AAAA,IACT,OAAM;AAAA,IACN,MAAK;AAAA,IACL,UAAU,CAAC;AAAA,KAEX,sCAAC,iBAAD,QAEF,sCAAC,UAAD;AAAA,IACE,SAAS;AAAA,IACT,OAAM;AAAA,IACN,MAAK;AAAA,IACL,UAAU,CAAC;AAAA,KAEX,sCAAC,iBAAD;AAAA;;;AP9IZ,qBAAqB,MAAM,UAAU,UAAU,OAAO;AAVtD;AAWE,QAAM,WAAW,CAAC,GAAG,UAAU,KAAK;AACpC,SAAO,gDACF,OACC,KAAK,WAAY;AAAA,IACnB,UAAU,KAAK,SACZ,IAAI,OAAK,YAAY,GAAG,UAAU;AAAA,MAClC,KALA;AAAA,IAML,OAAO,6CAAU,KAAK,OAAK,UAAQ,EAAE,MAAM,eAApC,oBAAgD,UAAS,gBAAgB;AAAA;AAAA;AAIpF,qBAAqB,MAAM,UAAU,OAAO;AAC1C,SAAO,iCACF,OADE;AAAA,IAEL,MAAM,OAAO,KAAK,KAAK,IAAI,SAAO,YAAY,KAAK,IAAI,UAAU,UAAU;AAAA;AAAA;AAI/E,oBAAoB,MAAM,OAAO,IAAI;AACnC,MAAI,CAAC,MAAM;AACT,WAAO;AAAA;AAET,QAAM,UAAU,CAAC,GAAG,MAAM,KAAK;AAC/B,MAAI,KAAK,UAAU;AACjB,WAAO,CAAC,UAAU,UAAU,GAAG,KAAK,SAAS,QAAQ,OAAK,WAAW,GAAG;AAAA;AAE1E,SAAO,UAAU;AAAA;AAqDJ,qBAAqB,OAAO;AACzC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,gBAAgB;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,aAAa;AAAA,IACb,aAAa;AAAA,IACb,aAAa;AAAA,IACb,aAAa;AAAA,IACb;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,QAAM,aAAa;AACnB,QAAM,mBAAmB;AACzB,QAAM,CAAC,YAAY,iBAAiB,WAAS;AAC7C,QAAM,CAAC,mBAAmB,wBAAwB,WAAS;AAE3D,QAAM,gBAAgB,SAAQ,MAAM,YAClC,MAAM,UAAU,QACf,CAAC,MAAM,UAAU;AACpB,QAAM,0BAA0B,SAAQ,MAAM,YAC5C,gBAAgB,UAAU,QACzB,CAAC,gBAAgB,UAAU;AAE9B,QAAM,oBAAqB,0BACvB,wBAAwB,KAAK,QAAQ,OAAK,WAAW,GAAG,OACxD;AAGJ,QAAM,sBAAuB,iBAAgB,IAAI,IAAI;AACrD,QAAM,sBAAuB,iBAAgB,IAAI,IAAI;AAErD,QAAM,mBAAmB,oBAAoB,OAAO,OAAK,CAAC,kBAAkB,SAAS;AACrF,QAAM,mBAAmB,oBAAoB,OAAO,OAAK,CAAC,kBAAkB,SAAS;AAErF,QAAM,6BAA6B,oBAAoB,OAAO,OAAK,kBAAkB,SAAS;AAC9F,QAAM,6BAA6B,oBAAoB,OAAO,OAAK,kBAAkB,SAAS;AAO9F,2BAAyB,OAAO,UAAU,UAAU;AAClD,QAAI,CAAC,OAAO;AACV,aAAO;AAAA;AAET,WAAO,MAAM,IAAI,CAAC,SAAS;AACzB,YAAM,UAAU,CAAC,GAAG,UAAU,KAAK;AACnC,aACE,sCAAC,UAAD;AAAA,QACE;AAAA,QACA,KAAK,UAAU;AAAA,SACX,kBAAkB,MAAM,SAAS,YAHvC;AAAA,QAKE,WAAW,UAAQ,mBAAmB;AAAA,QAEtC;AAAA,QACA,WAAW,aAAa,CAAC;AAAA,QACzB,UAAU,YAAY,CAAC;AAAA,QACvB;AAAA,QACA;AAAA,QACA;AAAA,QAEA;AAAA,QACA;AAAA,QACA,kBAAkB,eAAe,aAAa,gBAAgB;AAAA,QAC9D,mBAAmB,eAAe,aAAa,aAAa;AAAA,QAE5D;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,eAAe,CAAC,YAAY,UAAS;AACnC,wBAAc,YAAY;AAC1B,+BAAqB;AAAA;AAAA,QAEvB;AAAA,QACA,oBAAoB;AAAA,QACpB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QAEA,gBAAgB;AAAA,QAChB,aAAa,MAAM,cAAc;AAAA,QACjC,WAAW,MAAM,cAAc;AAAA,UAE9B,gBAAgB,KAAK,UAAU,UAAU,SAAS;AAAA;AAAA;AAM3D,SACE,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,cAAD;AAAA,IACE,WAAW;AAAA,IACX;AAAA,IAEA,aAAa;AAAA,IACb,cAAc;AAAA,IACd;AAAA,IAEA,SAAS,CAAC,aAAa,SAAS,YAC9B,KAAK,KAAK,MAAM,SAChB,KAAK;AAAA,IAEP,UAAU,CAAC,cAAc,SAAS,aAChC,cACA,KAAK,KAAK,MAAM,SAChB,KAAK;AAAA,KAGN,gBAAgB,cAAc,MAAM,MAAM,IAAI,SAEjD,sCAAC,cAAD;AAAA,IACE,WAAS;AAAA,IACT;AAAA,IAEA,aAAa;AAAA,IACb,cAAc;AAAA,IACd;AAAA,IAEA,SAAS,CAAC,aAAa,SAAS,YAC9B,KAAK,KAAK,MAAM,SAChB,KAAK;AAAA,IAEP,UAAU,CAAC,cAAc,SAAS,aAChC,cACA,KAAK,KAAK,MAAM,SAChB,KAAK;AAAA,IAEP,QAAQ,CAAC,SAAS;AAChB,YAAM,EAAE,UAAU,YAAY,KAAK,KAAK;AACxC,YAAM,EAAE,UAAU,YAAY,KAAK,SAAS;AAC5C,YAAM,EAAE,WAAW,iBAAiB;AACpC,iBAAW,SAAS,SAAS,cAAc;AAAA;AAAA,KAG5C,gBAAgB,wBAAwB,MAAM,OAAO,IAAI,SAG5D,sCAAC,YAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,OAGH,aACC,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,qBAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IAEA;AAAA,IACA;AAAA,IACA;AAAA,QAGF;AAAA;;;ADpOV,IAAM,uBAAuB,CAAC,SAAS;AAaxB,mCAAmC,OAAO;AACvD,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,iBAAQ;AAAA,MACN;AAEJ,QAAM,UAAU;AAChB,QAAM,aAAa;AAGnB,QAAM,CAAC;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KACC;AAAA,IACD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,OACG,gBAAgB,6BAA6B,UAAU;AAE5D,QAAM,CAAC,MAAM,QAAQ,aAAa;AAClC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAGF,QAAM,CAAC,kBAAkB,uBAAuB,WAAS;AAGzD,cAAU,MAAM;AACd;AACA;AACA,wBAAoB;AAAA,KAEnB,CAAC,SAAS;AAGb,QAAM,CAAC,SAAS,aAAa,SAAS,SAAS,gBAAgB,QAAQ;AACvE,QAAM,CAAC,YAAY,gBACjB,SAAS,SAAS,gBAAgB,QAAQ,MAC1C,EAAE,qBAAqB,mBACvB,EAAE,kBAAkB;AAItB,cAAU,MAAM;AACd,QAAI,oBAAoB;AACtB,UAAI;AACJ,UAAI;AACF,2BAAmB,6BAA6B,oBAAoB;AAAA,eAC7D,GAAP;AACA,mBAAW,EAAE;AACb;AAAA;AAEF,4BAAsB;AAAA;AAAA,KAEvB,CAAC,oBAAoB,uBAAuB;AAG/C,QAAM,aAAa,UAAQ,MAAO,QAAQ,OAAO,KAAK,SAAS,IAAK,CAAC;AAIrE,qCAAmC;AACjC,yBAAqB;AAAA;AAKvB,QAAM,iBAAiB,UACrB,MAAM,cAAc,UAAU,qBAC9B,CAAC,UAAU;AAIb,QAAM,eAAe,UAAQ,MAAM;AACjC,QAAI,oBAAoB,iBAAiB,SAAS,KAC/C,kBAAkB,eAAe,KAAK,SAAS,GAAG;AACnD,aAAO,2BAA2B,gBAAgB;AAAA;AAEpD,WAAO;AAAA,KACN,CAAC,kBAAkB;AAKtB,wBAAsB,eAAe,YAAY;AAC/C,UAAM,MAAM,eAAe,KAAK,KAAK,OAAK,EAAE,SAAS;AACrD,QAAI,KAAK;AACP,YAAM,sBAAsB,+BAA+B,KAAK,YAAY,IAAI;AAChF,0BAAoB;AACpB;AAAA;AAAA;AAKJ,uBAAqB,WAAW,SAAS;AACvC,UAAM,aAAc,MAAM,QAAQ,aAAa,YAAY,UAAU,MAAM;AAC3E,QAAI,CAAC,WAAW;AACd;AAAA;AAEF,QAAI,SAAS;AACX,0BAAoB,CAAC,GAAG,kBAAkB;AAAA,WACrC;AACL,0BAAoB,iBAAiB,OAAO,OAAK,CAAC,UAAQ,GAAG;AAAA;AAE/D;AAAA;AAIF,wBAAsB,cAAc,WAAW,UAAU;AACvD,QAAI,UAAU;AACZ,0BAAoB,UAAS,CAAC,GAAG,MAAM,UAAU,MAAM;AAAA,WAClD;AACL,0BAAoB,UAAQ,KAAK,OAAO,OAAK,CAAC,UAAQ,GAAG,UAAU,MAAM;AAAA;AAAA;AAQ7E,sBAAoB,SAAS,SAAS,cAAc,WAAW;AAC7D,UAAM,WAAW,QAAQ,MAAM;AAC/B,UAAM,WAAW,uBAAuB,oBAAoB;AAC5D,QAAI,CAAC,SAAS,YAAY,CAAC,WAAW;AAGpC;AAAA;AAEF,UAAM,gBAAgB,SAAS,SAAS;AACxC,UAAM,sBAAsB,kBAAkB;AAG9C,UAAM,WAAW,QAAQ,MAAM;AAC/B,UAAM,WAAW,uBAAuB,oBAAoB;AAE5D,QAAI,uBAAuB,aAAa,CAAC,SAAS,UAAU;AAE1D;AAAA;AAGF,QAAI;AACJ,QAAI;AACJ,QAAI;AACJ,QAAI,CAAC,qBAAqB;AACxB,uBAAiB,SAAS,MAAM,GAAG;AACnC,uBAAiB,uBAAuB,oBAAoB;AAC5D,0BAAoB,eAAe,SAAS,UAAU,OAAK,EAAE,SAAS,SAAS;AAAA,WAC1E;AACL,0BAAoB,mBAAmB,KAAK,UAC1C,SAAO,IAAI,SAAS,SAAS;AAAA;AAKjC,QAAI;AACJ,UAAM,eAAe,SAAS;AAC9B,QAAI,CAAC,uBAAuB,WAAW;AACrC,+BAAyB,eAAe,SACrC,KAAK,OAAK,MAAM,YAAY,EAAE,SAAS;AAAA,eACjC,CAAC,WAAW;AACrB,+BAAyB,SAAS,SAC/B,KAAK,OAAK,MAAM,YAAY,EAAE,SAAS;AAAA,WACrC;AACL,+BAAyB,mBAAmB,KACzC,KAAK,SAAO,QAAQ,YAAY,IAAI,SAAS;AAAA;AAGlD,QAAI,wBAAwB;AAC1B;AAAA;AAQF,UAAM,yBAAyB,iCAC1B,qBAD0B;AAAA,MAE7B,MAAM,mBAAmB,KAAK,IAAI,SAAO,WAAW,KAAK,IAAI,WAAW,OAAO;AAAA;AAKjF,QAAI,CAAC,qBAAqB;AACxB,0BAAoB,eAAe,SAAS,UAAU,OAAK,EAAE,SAAS,SAAS;AAAA,WAC1E;AACL,0BAAoB,uBAAuB,KAAK,UAC9C,SAAO,IAAI,SAAS,SAAS;AAAA;AAGjC,QAAI,cAAc;AAClB,QAAI,CAAC,aAAa,CAAC,qBAAqB;AACtC,UAAI;AACJ,UAAI;AACJ,YAAM,UAAU;AAChB,UAAI,CAAC,WAAW;AAGd,2BAAmB,OAAK,gBAAgB,GAAG;AAC3C,4BAAoB,UAAQ,UAAQ,MAAM;AAAA,iBACjC,CAAC,qBAAqB;AAI/B,4BAAoB,UAAQ,UAAQ,MAAM;AAC1C,YAAI,iBAAiB,IAAI;AAEvB,6BAAmB,OAAK,iBAAiB,GAAG;AAAA,eACvC;AAEL,gBAAM,cAAc,oBAAqB,gBAAe,oBAAoB,IAAI;AAChF,6BAAmB,OAAK,gBAAgB,GAAG,UAAU;AAAA;AAAA;AAGzD,6BAAuB,OAAO,uBAAuB,KAAK,IACxD,UAAQ,cACN,MACA,CAAC,GAAG,SAAS,kBAAkB,OAC/B,CAAC,MAAM;AACL,cAAM,UAAU,iBAAiB;AACjC,eAAO;AAAA,SAET;AAIJ,4BAAsB;AACtB,oBAAc,CAAC,GAAG,QAAQ,IAAI,SAAS;AACvC,0BAAoB,CAAC;AAAA,eACZ,iBAAiB,IAAI;AAI9B,6BAAuB,KAAK,QAAQ;AACpC,4BAAsB;AACtB,oBAAc,CAAC,SAAS;AACxB,0BAAoB,CAAC;AAAA,WAChB;AAEL,YAAM,cAAc,oBAAqB,gBAAe,oBAAoB,IAAI;AAChF,YAAM,eAAe,MAAM,KAAK,uBAAuB;AACvD,mBAAa,OAAO,aAAa,GAAG;AACpC,6BAAuB,OAAO;AAC9B,4BAAsB;AACtB,oBAAc,CAAC,SAAS;AACxB,0BAAoB,CAAC;AAAA;AAEvB,UAAM,YAAY,aAAa,OAC7B,OAAK,gBAAgB,UAAU,EAAE;AAEnC,UAAM,YAAY,UAAU,IAC1B,OACE,iCACK,IADL;AAAA,MAEE,MAAM,CAAC,UAAQ,EAAE,MAAM,YACnB,YAAY,OAAO,EAAE,KAAK,MAAM,SAAS,WACzC;AAAA;AAIV,UAAM,kBAAkB,aAAa,OACnC,OAAK,CAAC,gBAAgB,UAAU,EAAE;AAEpC,oBAAgB,KAAK,GAAG;AACxB,oBAAgB;AAAA;AAIlB,0BAAwB,YAAY,OAAO;AAEzC,UAAM,gBAAgB,6CAAc,KAAK,OAAK,UAAQ,EAAE,MAAM;AAC9D,QAAI,CAAC,eAAe;AAClB,sBAAgB;AAAA,QACd,GAAI,gBAAgB;AAAA,QACpB;AAAA,UACE,MAAM;AAAA,UACN;AAAA;AAAA;AAAA,WAGC;AACL,sBAAgB;AAAA,QACd,GAAG,aAAa,OAAO,OAAK,CAAC,UAAQ,EAAE,MAAM;AAAA,QAC7C;AAAA,UACE,MAAM;AAAA,UACN;AAAA;AAAA;AAAA;AAAA;AAOR,yBAAuB,YAAY,OAAM;AACvC,UAAM,eAAe,CAAC,GAAG;AACzB,iBAAa;AACb,iBAAa,KAAK;AAKlB,wBAAoB,MAAM,UAAU;AAClC,UAAI,UAAQ,CAAC,GAAG,UAAU,KAAK,OAAO,aAAa;AACjD,eAAO,iCACF,OADE;AAAA,UAEL;AAAA;AAAA;AAGJ,UAAI,CAAC,KAAK,UAAU;AAClB,eAAO;AAAA;AAET,aAAO,iCACF,OADE;AAAA,QAEL,UAAU,KAAK,SAAS,IAAI,OAAK,WAAW,GAAG,CAAC,GAAG,UAAU,KAAK;AAAA;AAAA;AAGtE,UAAM,yBAAyB,iCAC1B,qBAD0B;AAAA,MAE7B,MAAM,mBAAmB,KAAK,IAAI,SAAO,WAAW,KAAK;AAAA;AAG3D,UAAM,mBAAmB,aAAa,IAAI,OAAM;AAAA,MAC9C,MAAM,cAAc,YAAY,EAAE,MAAM;AAAA,MACxC,OAAO,EAAE;AAAA;AAEX,UAAM,uBAAuB,iBAAiB,IAAI,OAChD,cAAc,YAAY,GAAG;AAE/B,UAAM,uBAAuB,iBAAiB,IAAI,OAChD,cAAc,YAAY,GAAG;AAG/B,0BAAsB;AACtB,oBAAgB;AAChB,wBAAoB;AACpB,wBAAoB;AAAA;AAOtB,8BAA4B,YAAY,OAAM;AAC5C,UAAM,eAAe,CAAC,GAAG;AACzB,iBAAa;AACb,iBAAa,KAAK;AAClB,UAAM,eACJ,CAAC,UAAQ,YAAY,iBAClB,uBAAuB,oBAAoB;AAEhD,WAAO;AAAA;AAIT,wBAAsB,YAAY;AAKhC,UAAM,yBAAyB,iCAC1B,qBAD0B;AAAA,MAE7B,MAAM,mBAAmB,KAAK,IAAI,SAAO,WAAW,KAAK,IAAI,aAAa,OAAO;AAAA;AAInF,UAAM,mBAAmB,aAAa,OAAO,OAAK,CAAC,gBAAgB,YAAY,EAAE;AACjF,UAAM,uBAAuB,iBAAiB,OAAO,OAAK,CAAC,gBAAgB,YAAY;AACvF,UAAM,uBAAuB,iBAAiB,OAAO,OAAK,CAAC,gBAAgB,YAAY;AACvF,0BAAsB;AACtB,oBAAgB;AAChB,wBAAoB;AACpB,wBAAoB;AAAA;AAKtB,sBAAoB,YAAY;AAG9B,UAAM,aAAa;AAEnB,sBAAkB,MAAM,UAAU;AAChC,UAAI,iBAAiB,KAAK,kBAAgB,UAAQ,UAAU,gBAAgB;AAC1E,YAAI,KAAK,UAAU;AACjB,eAAK,SAAS,QAAQ,CAAC,MAAM;AAC3B,qBAAS,GAAG,CAAC,GAAG,UAAU,EAAE;AAAA;AAAA,eAEzB;AACL,qBAAW,KAAK;AAAA;AAAA,aAEb;AACL,mBAAW,KAAK;AAAA;AAAA;AAGpB,UAAM,aAAa,uBAAuB,gBAAgB;AAC1D,aAAS,YAAY;AACrB,wBAAoB;AACpB;AAAA;AAIF,mCAAiC;AAC/B,UAAM,WAAW,wBAAwB,yDAAoB,MAAM;AACnE,0BAAsB,iCAChB,sBAAsB,eAAe,sBADrB;AAAA,MAEpB,MAAM;AAAA,QACJ,GAAI,qBAAqB,mBAAmB,OAAO;AAAA,QACnD;AAAA,UACE,MAAM;AAAA,UACN,UAAU;AAAA;AAAA;AAAA;AAAA;AAQlB,qBAAmB;AACjB,UAAM,SAAS,YAAY,gBAAgB;AAC3C,qBACE,QAAQ,oBAAoB,cAC5B,qBAAqB,uBAAuB,iBAC5C,sBACA;AAAA;AAMJ,4BAA0B;AACxB,UAAM,SAAS,mBAAmB,gBAAgB;AAClD,qBACE,QAAQ,oBAAoB,cAC5B,qBAAqB,uBAAuB,iBAC5C,sBACA;AAAA;AAMJ,0BAAwB;AACtB,UAAM,SAAS,iBAAiB,gBAAgB,kBAAkB;AAClE,qBACE,QAAQ,oBAAoB,cAC5B,qBAAqB,uBAAuB,iBAC5C,sBACA;AAAA;AAMJ,wBAAsB,cAAc;AAGlC,UAAM,cAAc,cAAc,gBAAgB;AAClD,QAAI,CAAC,aAAa;AAChB,4BAAsB,iCAChB,sBAAsB,eAAe,sBADrB;AAAA,QAEpB,MAAM;AAAA,UACJ,GAAI,qBAAqB,mBAAmB,OAAO;AAAA,UACnD,GAAG,aAAa;AAAA;AAAA;AAIpB,YAAM,sBAAsB,uBAAuB,cAAc;AACjE,sBAAgB;AAAA,QACd,GAAG;AAAA,QACH,GAAG;AAAA;AAAA;AAAA;AAMT,qCAAmC,UAAU;AAC3C,UAAM;AAAA,MACJ;AAAA,MAAc;AAAA,QACZ,wBAAwB,gBAAgB,UAAU,oBAAoB,cAAc;AACxF,oBACE,iBAAiB,eACjB,GAAG,YAAY,gBAAY,QAAQ,gCAAgC;AAAA;AAKvE,wCAAsC,UAAU;AAC9C,UAAM;AAAA,MACJ;AAAA,MAAc;AAAA,QACZ,wBAAwB,gBAAgB,UAAU,oBAAoB,cAAc;AACxF,oBACE,oBAAoB,eACpB,GAAG,YAAY,gBAAY,QAAQ,gCAAgC;AAAA;AAKvE,2BAAyB,UAAU;AACjC,UAAM,EAAE,aAAa,aAAa,cAAc,gBAAgB;AAChE,oBACE,iBAAiB,cACjB,GAAG,YAAY,gBAAY,QAAQ,0BAA0B,uBAC7D;AAAA;AAGJ,SACE,sCAAC,WAAD;AAAA,IACE,OAAO;AAAA,IACP,UAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KAEA,sCAAC,aAAD;AAAA,IACE,UAAU;AAAA,IACV,MAAM;AAAA,IACN,gBAAgB;AAAA,IAChB,gBAAgB;AAAA,IAChB,cAAc;AAAA,IACd,cAAc;AAAA,IACd,kBAAkB,sBAAsB;AAAA,IACxC,WAAS;AAAA,IACT,UAAU;AAAA,IACV,SAAS;AAAA,IACT;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,uBAAuB,sDAAkB,UAAS;AAAA,IAClD,2BAA2B,sDAAkB,UAAS;AAAA,IACtD,4BAA4B,sDAAkB,UAAS;AAAA,IACvD;AAAA;AAAA;;;AY/mBR;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;ACJA;AAEA;AACA;AACA;AACA;;;ACLA;AACA;AACA;AACA;;;ACHA;AACA;AACA;AACA;AAKA,IAAM,aAAY,YAAW,WAAU;AAAA,EACrC,WAAW;AAAA,IACT,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY;AAAA,IACZ,UAAU;AAAA;AAAA,EAEZ,QAAQ;AAAA,IACN,SAAS;AAAA,IACT,OAAO;AAAA;AAAA,EAET,MAAM;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ,MAAM,QAAQ,OAAO;AAAA,IAC7B,gBAAgB;AAAA;AAAA;AAIpB,IAAM,eAAe,CAAC,EAAE,mBAAmB;AACzC,QAAM,UAAU;AAChB,SACE,sCAAC,OAAD;AAAA,IAAK,WAAW,QAAQ;AAAA,IAAW,cAAW;AAAA,KAC3C,eAAe,IAAI,WAClB,sCAAC,aAAD;AAAA,IACE,WAAW,QAAQ;AAAA,IACnB,KAAK;AAAA,IACL,SAAS,MAAM,aAAa;AAAA,KAE5B,sCAAC,UAAD;AAAA,IACE,UAAS;AAAA,IACT,OAAO,EAAE,OAAO,OAAO;AAAA,IACvB,WAAW,QAAQ;AAAA;AAAA;AAQ/B,IAAO,uBAAQ;;;AD1Cf,IAAM,aAAY,YAAW,MAAO;AAAA,EAClC,YAAY;AAAA,IACV,iBAAiB;AAAA;AAAA,EAEnB,QAAQ;AAAA,IACN,WAAW;AAAA,MACT,iBAAiB;AAAA;AAAA,IAEnB,aAAa;AAAA,IACb,cAAc;AAAA;AAAA;AAUlB,wBAAwB,EAAE,sBAAsB,qBAAqB,mBAAmB;AACtF,QAAM,CAAC,MAAM,WAAW,WAAS;AAEjC,QAAM,UAAU;AAEhB,QAAM,oBAAoB,CAAC,UAAU;AACnC,yBAAqB,SAAS;AAAA;AAGhC,QAAM,eAAe,MAAM;AACzB,YAAQ;AACR;AAAA;AAGF,SACE,sCAAC,YAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA,YAAY,sCAAC,cAAD;AAAA,MAAc,UAAS;AAAA;AAAA,IACnC,iBAAiB,QAAQ;AAAA,KAEzB,sCAAC,WAAD;AAAA,IAAU,OAAK;AAAA,IAAC,gBAAc;AAAA,IAAC,SAAS;AAAA,KACtC,sCAAC,SAAD,MAAS,YAEX,sCAAC,WAAD;AAAA,IAAU,OAAK;AAAA,IAAC,gBAAc;AAAA,IAAC,SAAS;AAAA,KACtC,sCAAC,SAAD,MAAS,aAEX,sCAAC,WAAD;AAAA,IAAU,OAAK;AAAA,IAAC,gBAAc;AAAA,IAAC,WAAW,QAAQ;AAAA,KAChD,sCAAC,sBAAD;AAAA,IAAc,cAAc;AAAA;AAAA;AAMpC,IAAO,yBAAQ;;;AE3Df,sBAAsB;AACpB,QAAM,UAAU;AAChB,QAAM,UAAU,CAAC,QAAQ,SAAS;AAClC,SAAO,KAAK,cAAc,QAAQ,CAAC,UAAU;AAC3C,UAAM,EAAE,cAAQ,aAAa;AAC7B,UAAM,MAAM,QAAQ,SAAS,SAAS,CAAE,QAAM,KAAK;AACnD,YAAQ,SAAS,CAAC,KAAK;AAAA;AAEzB,SAAO;AAAA;AAGF,IAAM,UAAU;;;ACbvB;AAEA;AACA;;;ACHA;AACA;AACA;AACA;AACA;AACA;AAEO,IAAM,kBAAkB,YAAW,MAAO;AAAA,EAC/C,YAAY;AAAA,IACV,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA;AAAA;AAIL,IAAM,kBAAkB,WAAW,WAAU;AAAA,EAClD,OAAO;AAAA,IACL,iBAAiB,MAAM,QAAQ,WAAW;AAAA;AAAA,EAE5C,MAAM;AAAA,IACJ,OAAO;AAAA,IACP,WAAW;AAAA,IACX,aAAa;AAAA,IACb,cAAc;AAAA;AAAA,EAEhB,QAAQ;AAAA,IACN,WAAW;AAAA,MACT,iBAAiB;AAAA;AAAA,IAEnB,aAAa;AAAA,IACb,cAAc;AAAA;AAAA,EAEhB,QAAQ;AAAA,IACN,QAAQ;AAAA;AAAA;AAIZ,IAAM,yBAAyB;AAAA,EAC7B,OAAO;AAAA,EACP,eAAe;AAAA;AAGV,IAAM,6BAA6B,YAAW,MAAO;AAAA,EAC1D,MAAM,iCACD,yBADC;AAAA,IAEJ,SAAS;AAAA;AAAA;AAIN,IAAM,8BAA8B,WAAW,MAAO;AAAA,EAC3D,MAAM,iCACD,yBADC;AAAA,IAEJ,SAAS;AAAA;AAAA,IAET;AAEG,IAAM,8BAA8B,WAAW,WAAU;AAAA,EAC9D,MAAM;AAAA,IACJ,SAAS;AAAA;AAAA,EAEX,SAAS;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA;AAAA,EAEZ,UAAU;AAAA,IACR,cAAc,MAAM,QAAQ;AAAA,IAC5B,KAAK,MAAM,QAAQ;AAAA;AAAA,EAErB,YAAY;AAAA,IACV,cAAc;AAAA,MACZ,KAAK,MAAM,QAAQ;AAAA;AAAA;AAAA,IAGrB;AAEG,IAAM,mBAAmB,WAAW,MAAO;AAAA,EAChD,MAAM;AAAA,IACJ,UAAU;AAAA;AAAA,IAEV;AAEG,IAAM,uBAAuB,WAAW,MAAO;AAAA,EACpD,MAAM;AAAA,IACJ,OAAO;AAAA,IACP,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,cAAc;AAAA;AAAA,IAEd;AAEG,IAAM,wBAAwB,WAAW,MAAO;AAAA,EACrD,MAAM;AAAA,IACJ,WAAW;AAAA;AAAA,EAEb,YAAY;AAAA,IACV,iBAAiB;AAAA;AAAA,IAEjB;;;ADpFG,kCAAkC;AAAA,EACvC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GACC;AACD,QAAM,UAAU;AAChB,SACE,sCAAC,SAAD;AAAA,IACE,SAAS,EAAE,MAAM,QAAQ;AAAA,IACzB,QAAM;AAAA,IACN,OAAO;AAAA,IACP,UAAU,OAAK,aAAa,OAAO,EAAE,OAAO;AAAA,KAE3C,eAAe,IAAI,CAAC,KAAK,MACxB,sCAAC,UAAD;AAAA,IAAQ;AAAA,IAAoB,KAAK;AAAA,IAAK,OAAO;AAAA,KAC1C;AAAA;AAcJ,mCAAmC;AAAA,EACxC;AAAA,EAAO;AAAA,EAAS;AAAA,EAAQ;AAAA,GACvB;AACD,SACE,sCAAC,WAAD;AAAA,IACE,UAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA,OAAO,EAAE,OAAO,aAAa,EAAE;AAAA;AAAA;;;AJjC9B,IAAM,gBAAgB,CAAC,IAAI,KAAK,UAAU;AAC/C,QAAM,QAAQ,MAAO,UAAU,WAAW,IAAI,MAAM,OAAK,MAAM,OAC3D,CAAC,KAAK,KAAK,OACX;AACJ,SAAO,OAAO;AAAA;AAGhB,2BAA0B,OAAO;AAG/B,QAAM,YAAY;AAClB,MAAI,iBAAiB;AAGrB,MAAI,CAAC,OAAO,UAAU,QAAQ;AAC5B,MAAE;AAAA;AAEJ,MAAI,QAAQ,GAAG;AACb,MAAE;AAAA;AAIJ,QAAM,QAAQ,KAAK,aAAa,SAAS;AAAA,IACvC,0BAA0B;AAAA,IAC1B,aAAa;AAAA,KACZ,OAAO;AACV,MAAI,MAAM,UAAU;AAAW,WAAO;AAItC,SAAO,MAAM,cAAc;AAAA;AAU7B,uBAAuB;AAAA,EACrB;AAAA,EACA,SAAS,CAAC,GAAG;AAAA,EACb;AAAA,EACA,SAAS,CAAC,GAAG;AAAA,EACb;AAAA,EACA;AAAA,GACC;AACD,QAAM,CAAC,KAAK,QAAO;AACnB,QAAM,wBAAwB,cAC5B,UAAS,cAAc,GAAG,EAAE,UAAU,SACtC,CAAC;AAEH,QAAM,OAAO,OAAM,MAAM,OAAO,UAAU,YAAa,QAAM,OAAO,MAAM;AAC1E,SACE,sCAAC,SAAD;AAAA,IACE,OAAO;AAAA,IACP,kBAAkB;AAAA,IAClB,UAAU,CAAC,GAAG,MAAM,sBAAsB;AAAA,IAC1C,mBAAkB;AAAA,IAClB,cAAc,MAAM,GAAG,SAAS;AAAA,IAChC;AAAA,IACA,KAAK;AAAA,IACL;AAAA,IACA,aAAY;AAAA,IACZ,OAAO,EAAE,OAAO,WAAW;AAAA,IAC3B;AAAA;AAAA;AAmBN,iCAAiC;AAAA,EAC/B,aAAa;AAAA,EACb;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,YAAY;AAAA,EACZ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,OAAO;AAAA,GACN;AACD,QAAM,EAAE,UAAU,oBAAoB;AACtC,QAAM,CAAC,QAAQ,aAAa,WAAS;AACrC,QAAM,CAAC,YAAY,iBAAiB,WAAS;AAC7C,QAAM,CAAC,OAAO,YAAY,WAAS;AACnC,QAAM,CAAC,WAAW,gBAAgB,WAAS;AAAA,IACzC,mBAAK,UAAS,WAAW;AAAA;AAE3B,QAAM,WAAW,cAAc,YAAY,OAAO;AAElD,cAAU,MAAM;AAGd,QAAI,UAAU;AACd,QAAI,SAAS,UAAU,WAAU;AAC/B,YAAM,aAAa,CAAC,mBAAK,UAAS,WAAW;AAC7C,UAAI;AACJ,YAAM,mBAAmB,kBAAkB;AAC3C,YAAM,eAAe,UAAU;AAC/B,YAAM,sBAAsB,CAAC,UAAQ,YAAY;AACjD,UAAI,oBAAoB,uBAAuB,cAAc;AAC3D,YAAI,kBAAkB,QAAQ;AAC5B,oBAAU,CAAC,QAAQ;AACnB,gBAAM,CAAC,aAAa;AACpB,cAAI,SAAS;AACX,sBAAU;AACV,0BAAc;AACd,gBAAI,qBAAqB;AACvB,2BAAa;AAAA;AAEf,gBAAI,cAAc;AAChB,uBAAS;AAAA;AAAA;AAAA,eAGR;AACL,iCAAuB;AAAA,YACrB,QAAQ,OAAO;AAAA,YACf;AAAA,YACA,OAAO;AAAA,aACN,KAAK,CAAC,UAAU;AAEjB,sBAAU,MAAM;AAChB,kBAAM,CAAC,aAAa;AACpB,gBAAI,SAAS;AACX,wBAAU;AACV,4BAAc;AACd,kBAAI,qBAAqB;AACvB,6BAAa;AAAA;AAEf,kBAAI,cAAc;AAChB,yBAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOrB,WAAO,MAAM;AACX,gBAAU;AAAA;AAAA,KAEX;AAAA,IACD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAYF,QAAM,kBAAkB,WAAU,IAAG,UAAU;AAC/C,SACE,sCAAC,OAAD;AAAA,IAAM,WAAS;AAAA,IAAC,WAAU;AAAA,IAAS,GAAG;AAAA,IAAG,SAAQ;AAAA,KAC/C,sCAAC,OAAD;AAAA,IAAM,WAAS;AAAA,IAAC,WAAU;AAAA,IAAM,SAAQ;AAAA,KACtC,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,0BAAD;AAAA,IACE,cAAc,OAAK,qBAAqB,aAAa,gBAAgB;AAAA,IAErE;AAAA,IACA;AAAA,IACA,UAAU;AAAA,OAGd,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,IAAG,OAAO,EAAE,WAAW;AAAA,KACpC,sCAAC,wBAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA,UAAU;AAAA,QAIhB,sCAAC,OAAD;AAAA,IAAM,WAAS;AAAA,IAAC,WAAU;AAAA,IAAM,SAAQ;AAAA,KACtC,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,2BAAD;AAAA,IACE,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ,MAAM,qBAAqB,WAAW,CAAC;AAAA,IAC/C,UAAU;AAAA,OAGd,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,eAAD;AAAA,IACE,OAAO;AAAA,IACP;AAAA,IACA,QAAQ,UAAU,QAAQ;AAAA,IAC1B;AAAA,IACA,cAAc,OAAK,qBAAqB,UAAU;AAAA,IAClD,UAAU;AAAA;AAAA;AAQtB,IAAO,kCAAQ;;;AMxPf;AAEA;AACA;AAEA;AAcA,kCAAkC;AAAA,EAChC,aAAa;AAAA,EACb;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,iBAAiB;AAAA,GAChB;AAWD,QAAM,kBAAkB,WAAU,IAAG,UAAU;AAC/C,SACE,sCAAC,OAAD;AAAA,IAAM,WAAS;AAAA,IAAC,WAAU;AAAA,IAAM,SAAQ;AAAA,KACtC,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,2BAAD;AAAA,IACE,OAAO,CAAC,KAAK,KAAK;AAAA,IAClB,SAAS;AAAA,IACT,QAAQ,MAAM,qBAAqB,WAAW,CAAC;AAAA,OAGnD,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,0BAAD;AAAA,IACE,cAAc,OAAK,qBAAqB,aAAa,gBAAgB;AAAA,IACrE;AAAA,IACA;AAAA,IACA;AAAA,OAGJ,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,aAAD;AAAA,IAAY,SAAS;AAAA,IAAqB,OAAO,EAAE,SAAS;AAAA,KAC1D,sCAAC,kBAAD;AAAA;AAOV,IAAO,mCAAQ;;;ACjEf;AAEA;AACA;AACA;AACA;AACA;AAGe,+BAA+B,OAAO;AACnD,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,QAAM,SAAS,MAAM;AACrB,QAAM,OAAO,MAAM;AAEnB,8BAA4B,GAAG;AAC7B,QAAI,cAAc,SAAS;AACzB,YAAM,UAAU,IAAI;AACpB,wBAAkB,iCAAK,QAAL,EAAY,SAAS,GAAG;AAAA,WACrC;AACL,wBAAkB,iCAAK,QAAL,EAAY,SAAS;AAAA;AAAA;AAI3C,gCAA8B,GAAG;AAC/B,sBAAkB,iCAAK,QAAL,EAAY,SAAS;AAAA;AAGzC,QAAM,UAAU;AAChB,SACE,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,OAAO,EAAE,WAAW;AAAA,KAC7B,sCAAC,QAAD;AAAA,IAAO,WAAW,QAAQ;AAAA,KACxB,sCAAC,YAAD;AAAA,IACE,OAAO;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA;AAAA,KAGf,QAEH,sCAAC,OAAD;AAAA,IAAM,WAAS;AAAA,IAAC,WAAU;AAAA,IAAM,SAAQ;AAAA,KACtC,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,WAAD;AAAA,IAAU,OAAM;AAAA,IAAU,SAAS;AAAA,IAAM,UAAU,CAAC,GAAG,MAAM,qBAAqB;AAAA,OAEpF,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,IAAG,OAAO,EAAE,cAAc;AAAA,KACvC,sCAAC,SAAD;AAAA,IACE,OAAO;AAAA,IACP,KAAK;AAAA,IACL,KAAK;AAAA,IACL,MAAM;AAAA,IACN,UAAU,CAAC,GAAG,MAAM,mBAAmB;AAAA,IACvC,OAAO,EAAE,WAAW;AAAA,IACpB,aAAY;AAAA;AAAA;;;ACzD1B;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAeA,IAAM,iBAAiB,CAAC,QAAQ;AAiBhC,wBAAwB;AAAA,EACtB,QAAQ;AAAA,EACR;AAAA,EACA,YAAY;AAAA,EACZ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GACC;AACD,QAAM,UAAU;AAChB,QAAM,aAAa,UAAS,IAAI,OAAK,EAAE;AACvC,QAAM,EAAE,MAAM,WAAW;AACzB,QAAM,eAAe,CAAO,QAAQ;AAElC,UAAM,cAAc,OAAO,QAAQ;AACnC,6BAAyB;AACzB,2BAAuB,MAAM;AAC3B,+BAAyB;AACzB,6BAAuB;AAAA;AAEzB,QAAI,aAAa;AACf,YAAM,CAAC,QAAQ,QAAQ,UAAU,gBAAgB;AACjD,YAAM,oBAAoB;AAAA,QACxB,YAAY;AAAA,QACZ;AAAA,QACA;AAAA,QACA;AAAA,QACA,OAAO;AAAA;AAGT,UAAI,CAAC,OAAO;AACV,cAAM,EAAE,YAAY,MAAM,uBAAuB;AAAA,UAC/C;AAAA,UACA;AAAA,UACA,OAAO;AAAA;AAET,0BAAkB,WAAW,CAAC,GAAG;AACjC,0BAAkB,SAAS,QAAQ,CAAC,IAAI,MAAM;AAE5C,aAAG,SAAS,QAAQ;AAAA;AAAA;AAIxB,gCAA0B;AAC1B,YAAM,mBAAmB,2BAA2B,QAClD,EAAE,QAAQ,eAAe,OAAO,gBAAgB,KAAK,MAAM,IAAI,SAAQ;AACzE,mBAAa,iCACR,mBADQ;AAAA,QAEX,WAAW;AAAA,QACX,eAAe;AAAA;AAAA,WAEZ;AACL,YAAM,EAAE,YAAY,MAAM,uBAAuB;AAAA,QAC/C;AAAA,QAAQ;AAAA,QAAY,OAAO;AAAA;AAE7B,YAAM,cAAc,CAAC,GAAG;AACxB,kBAAY,QAAQ,CAAC,IAAI,MAAM;AAE7B,WAAG,SAAS,QAAQ;AAAA;AAGtB,gCAA0B;AAAA,QACxB,YAAY;AAAA,QACZ,OAAO;AAAA,QACP,kBAAkB;AAAA,QAClB,UAAU;AAAA;AAEZ,YAAM,mBAAmB,2BAA2B,QAClD,EAAE,QAAQ,eAAe,OAAO,gBAAgB,KAAK,OAAO,IAAI,SAAQ;AAC1E,mBAAa,iCACR,mBADQ;AAAA,QAEX,WAAW;AAAA,QACX,eAAe;AAAA,QACf,WAAW;AAAA;AAAA;AAAA;AAIjB,QAAM,EAAE,QAAQ,UAAU,MAAM,QAAQ,UAAU,OAAO,KAAK;AAC9D,QAAM,YAAY,MAAM,OAAO,QAAQ,QAAQ;AAC/C,SACE,8DACE,sCAAC,SAAD;AAAA,IACE,QAAM;AAAA,IACN,OAAO;AAAA,IACP,UAAU,OAAK,aACb,EAAE,OAAO,UAAU,OAAO,EAAE,OAAO,QAAQ,OAAO,EAAE,OAAO;AAAA,IAG7D,SAAS,EAAE,MAAM,QAAQ;AAAA,KAGvB,sCAAC,UAAD;AAAA,IAAQ,KAAI;AAAA,IAAK,OAAM;AAAA,KAAK,qBAI7B,MAAM,KAAK,EAAE,QAAQ,OAAO,UAC1B,KAAK,GAEL,IAAI,CAAC,GAAG,eAAe;AACtB,QAAI,QAAQ;AACV,UAAI,kBAAkB,QAAQ,aAAa;AACzC,cAAM;AAAA,UACJ;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,YACE,sBAAsB,QAAQ;AAClC,eACE,sCAAC,UAAD;AAAA,UACE,KAAK,IAAI,WAAW,UAAU;AAAA,UAC9B,OAAO;AAAA,UACP,UACE,aACG,CAAC;AAAA,WAGL,OAAO,6BAA6B,YACnC,6BACiB,WAAW,UAAU;AAAA;AAAA;AAKhD,WAAO;AAAA;AAAA;AAcnB,wBAAwB,EAAE,OAAO,SAAS,gBAAgB;AACxD,QAAM,UAAU;AAChB,SACE,sCAAC,SAAD;AAAA,IACE,QAAM;AAAA,IACN,UAAU,OAAK,aAAa,EAAE,OAAO,UAAU,KAAK,OAAO,EAAE,OAAO;AAAA,IACpE;AAAA,IACA,YAAY,EAAE,MAAM,YAAY,IAAI;AAAA,IACpC,OAAO,EAAE,OAAO;AAAA,IAChB,SAAS,EAAE,MAAM,QAAQ;AAAA,KAEzB,sCAAC,UAAD;AAAA,IAAQ,cAAW;AAAA,IAAO,OAAM;AAAA,KAAG,SAClC,iBAAiB,IAAI,WACpB,sCAAC,UAAD;AAAA,IAAQ,KAAK;AAAA,IAAM,OAAO;AAAA,KACvB;AAAA;AAOX,kCAAkC,EAAE,OAAO,gBAAgB;AACzD,SACE,sCAAC,WAAD;AAAA,IACE,OAAO,EAAE,OAAO,QAAQ,SAAS;AAAA,IACjC,OAAM;AAAA,IACN,UAAU,MAAM;AACd,UAAI,OAAO;AACT,qBAAa;AAAA,aACR;AACL,qBAAa,CAAC,GAAG,GAAG;AAAA;AAAA;AAAA,IAGxB,SAAS,QAAQ;AAAA;AAAA;AAUvB,uBAAuB,EAAE,OAAO,gBAAgB;AAC9C,SACE,sCAAC,SAAD;AAAA,IACE;AAAA,IACA,UAAU,CAAC,GAAG,MAAM,aAAa;AAAA,IACjC,mBAAkB;AAAA,IAClB,cAAc,MAAM;AAAA,IACpB,KAAK;AAAA,IACL,KAAK;AAAA,IACL,MAAM;AAAA,IACN,aAAY;AAAA,IACZ,OAAO,EAAE,WAAW;AAAA;AAAA;AAW1B,8BAA8B,EAAE,OAAO,SAAS,gBAAgB;AAC9D,QAAM,UAAU;AAChB,SACE,sCAAC,SAAD;AAAA,IACE,QAAM;AAAA,IACN,UAAU,OAAK,aAAa,EAAE,OAAO;AAAA,IACrC;AAAA,IACA,YAAY,EAAE,MAAM,mBAAmB,IAAI;AAAA,IAC3C,OAAO,EAAE,OAAO;AAAA,IAChB,SAAS,EAAE,MAAM,QAAQ;AAAA,KAExB,eAAe,IAAI,WAClB,sCAAC,UAAD;AAAA,IAAQ,KAAK;AAAA,IAAM,OAAO;AAAA,KACvB;AAAA;AAcX,+BAA+B;AAAA,EAC7B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GACC;AACD,SACE,sCAAC,uBAAD;AAAA,IACE;AAAA,IAGA,UACE,CAAC,OAAO,aAAa;AACnB,mBAAa,EAAE,WAAW,GAAG,QAAQ,YAAY;AAAA;AAAA,IAGrD,mBACE,CAAC,OAAO,aAAa;AACnB,mBAAa,EAAE,WAAW,GAAG,QAAQ,YAAY;AAAA;AAAA,IAGrD,mBAAkB;AAAA,IAClB,cAAc,MAAM,GAAG;AAAA,IACvB,OAAO,eAAe,IAAI,SAAQ,GAAE,OAAO;AAAA,IAC3C,KAAK,OAAO,eAAe;AAAA,IAC3B,KAAK,OAAO,eAAe,MAAM;AAAA,IACjC,aAAY;AAAA,IACZ,MAAM;AAAA;AAAA;AAYZ,qBAAqB,EAAE,aAAM,SAAS,YAAY;AAChD,SACE,sCAAC,OAAD;AAAA,IAAM,WAAS;AAAA,IAAC,WAAU;AAAA,IAAM,YAAW;AAAA,IAAS,SAAQ;AAAA,KAC1D,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,aAAD;AAAA,IAAY,SAAS;AAAA,KAAU,OAAK,OAEtC,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACZ;AAAA;AAoBT,sBAAsB;AAAA,EACpB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GACC;AACD,QAAM,EAAE,QAAQ,UAAU,MAAM,QAAQ,OAAO,QAAQ,OAAO,KAAK,KAAK,OAAO;AAC/E,QAAM,2BAA2B,OAAO,SAAS,KAAK,UAAS,SAAS;AACxE,QAAM,YAAY,MAAM,OAAO,QAAQ,QAAQ;AAE/C,QAAM,yBAAyB,QAAQ,MAAM,KAAK;AAAA,IAChD,QAAQ,OAAO,KAAK;AAAA,KACnB,OAAO,CAAC,GAAG,QAAQ,kBAAkB,OAAO,MAAM,MAAM;AAC3D,SACE,sCAAC,OAAD;AAAA,IAAM,WAAS;AAAA,IAAC,WAAU;AAAA,IAAS,OAAO,EAAE,OAAO;AAAA,KAChD,aACI,CAAC,aACD,0BAEH,sCAAC,gBAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA,UAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MAIH,4BACI,CAAC,SACD,oBAAoB,IACrB,WAAS,MAAM,OAAO,QAAQ,UAAU,KACxC,sCAAC,aAAD;AAAA,IAAa,MAAM;AAAA,IAAO,SAAS,GAAG;AAAA,IAAgB,KAAK;AAAA,KACzD,sCAAC,uBAAD;AAAA,IACE;AAAA,IACA,OAAO,kBAAkB;AAAA,IACzB,cAAc;AAAA,IACd,gBAAgB,OAAM,MAAM,OAAO,QAAQ;AAAA,QAKlD,CAAC,+BACA,8DACG,sBACC,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,KACR,sCAAC,aAAD;AAAA,IAAa,MAAK;AAAA,IAAW,SAAQ;AAAA,KACnC,sCAAC,gBAAD;AAAA,IACE,OAAO,YAAY;AAAA,IACnB,SAAQ;AAAA,IACR,cAAc;AAAA,QAKrB,oBACC,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,KACR,sCAAC,aAAD;AAAA,IAAa,MAAK;AAAA,IAAS,SAAQ;AAAA,KACjC,sCAAC,sBAAD;AAAA,IACE,OAAO,cAAc;AAAA,IACrB,cAAc,CAAC,UAAU;AACvB,yBAAmB;AAAA;AAAA,UAO7B,MACH,CAAC,SACA,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,KACR,sCAAC,aAAD;AAAA,IAAa,MAAK;AAAA,IAAU,SAAQ;AAAA,KAClC,sCAAC,eAAD;AAAA,IAAe,OAAO;AAAA,IAAS,cAAc;AAAA,QAIlD,8BAA8B,CAAC,SAC9B,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,KACR,sCAAC,aAAD;AAAA,IACE,MAAK;AAAA,IACL,SAAQ;AAAA,KAER,sCAAC,0BAAD;AAAA,IACE,OAAO;AAAA,IACP,cAAc;AAAA;AAAA;AAS5B,IAAO,uBAAQ;;;ACjdf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA,IAAM,kBAAkB,YAAW,WAAS,cAAa;AAAA,EACvD,SAAS;AAAA,EACT,UAAU;AAAA,IACR,OAAO,MAAM,QAAQ,KAAK;AAAA,IAI1B,sBAAsB;AAAA,MACpB,OAAO;AAAA;AAAA,IAET,uBAAuB;AAAA,MACrB,OAAO;AAAA;AAAA;AAAA;AAKb,IAAM,SAAS,CAAC;AAAA,EACd;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,MACI;AACJ,QAAM,CAAC,YAAY,YAAY,cAAc,gBAAgB,OAAO;AACpE,QAAM,kCAAkC;AAAA,IACtC;AAAA,MACE;AAAA,MACA,eAAa,oBAAoB,KAAK;AAAA,MACtC;AAAA,MACA;AAAA;AAAA,IAEF;AAAA,MACE;AAAA,MACA,eAAa,oBAAoB,KAAK;AAAA,MACtC;AAAA,MACA;AAAA;AAAA,IAEF;AAAA,MACE;AAAA,MACA,eAAa,oBAAoB,KAAK;AAAA,MACtC;AAAA,MACA;AAAA;AAAA;AAGJ,QAAM,UAAU;AAChB,QAAM,UAAU,gCAAgC,IAC9C,CAAC,CAAC,KAAK,QAAQ,OAAO,CAAC,KAAK,WAC1B,sCAAC,OAAD;AAAA,IACE,WAAS;AAAA,IACT,WAAU;AAAA,IACV,SAAQ;AAAA,IACR,YAAW;AAAA,IACX,KAAK;AAAA,KAEL,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,aAAD;AAAA,IACE,WAAW,CAAC,QAAQ,QAAQ,WAAW,QAAQ;AAAA,IAC/C,OAAO,EAAE,cAAc;AAAA,KAEtB,OAAM,OAGX,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,SAAD;AAAA,IACE,UAAU,CAAC;AAAA,IACX,WAAW,CAAC,QAAQ,QAAQ,WAAW,QAAQ;AAAA,IAC/C,OAAO;AAAA,IACP,UAAU,CAAC,GAAG,MAAM,OAAO;AAAA,IAC3B,mBAAkB;AAAA,IAClB,kBAAkB,OAAK,iBAAiB;AAAA,IACxC,cAAc,MAAM,GAAG;AAAA,IACvB;AAAA,IACA,KAAK;AAAA,IACL,MAAM;AAAA,IACN,aAAY;AAAA;AAMtB,SACE,8DACE,sCAAC,aAAD;AAAA,IACE,WAAW,CAAC,QAAQ,QAAQ,WAAW,QAAQ;AAAA,IAC/C,OAAO,EAAE,WAAW,IAAI,cAAc;AAAA,KACvC,oBACkB,MACL,KACb;AAAA;AAKP,IAAM,mBAAmB,OAAO,OAAO;AAEvC,6BAA6B;AAAA,EAC3B;AAAA,EACA;AAAA,EACA;AAAA,GACC;AACD,QAAM,UAAU;AAEhB,QAAM,UAAU,CAAC,QAAQ,CAAC,GAAG,kBAAkB,MAAM;AACrD,SACE,sCAAC,aAAD;AAAA,IAAa,WAAS;AAAA,KACpB,sCAAC,aAAD;AAAA,IAAY,SAAQ;AAAA,KAAwB,mBAC5C,sCAAC,SAAD;AAAA,IACE,QAAM;AAAA,IACN,UAAU,OAAK,0BAA0B,EAAE,OAAO;AAAA,IAClD,OAAO,QAAQ,gBAAgB;AAAA,IAC/B,YAAY;AAAA,MACV,MAAM;AAAA,MACN,IAAI;AAAA;AAAA,IAEN,UAAU,CAAC;AAAA,IACX,SAAS,EAAE,MAAM,QAAQ;AAAA,KAExB,QAAQ,IAAI,WACX,sCAAC,UAAD;AAAA,IAAQ,KAAK;AAAA,IAAM,OAAO;AAAA,KACvB;AAAA;AAQb,IAAM,iBAAiB,CAAC;AAAA,EACtB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,MAEA,sCAAC,OAAD;AAAA,EAAM,MAAI;AAAA,EAAC,IAAG;AAAA,EAAO,KAAI;AAAA,GACvB,sCAAC,QAAD;AAAA,EACE,SAAS,MAAM;AACb,UAAM,mBAAmB,2BACvB,OAAO,MACP,EAAE,QAAQ,eAAe,OAAO,gBAChC,KACA,OACA,IAAI,SAAQ;AAEd,iBAAa,iCACR,mBADQ;AAAA,MAEX,WAAW;AAAA,MACX,eAAe;AAAA;AAAA;AAAA,EAInB,UAAU,CAAC;AAAA,EACX,OAAO;AAAA,IACL,SAAS;AAAA,IACT,cAAc;AAAA;AAAA,GAEjB;AAML,IAAM,gBAAgB,CAAC;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,MAEA,8DACE,sCAAC,qBAAD;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,IAEF,sCAAC,QAAD;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,IAEF,sCAAC,gBAAD;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAKN,IAAO,wBAAQ;;;AF1Lf,kBAAkB,OAAO;AACvB,QAEI,aADF;AAAA;AAAA,IAAU;AAAA,IAAO;AAAA,MACf,KADyB,kBACzB,KADyB;AAAA,IAA3B;AAAA,IAAU;AAAA,IAAO;AAAA;AAGnB,SACE,sCAAC,OAAD;AAAA,IACE,MAAK;AAAA,IACL,QAAQ,UAAU;AAAA,IAClB,IAAI,mBAAmB;AAAA,IACvB,mBAAiB,cAAc;AAAA,KAC3B,QAEH,UAAU,SAAS;AAAA;AAM1B,8BAAoC,QAAQ,YAAY,YAAY,OAAO;AAAA;AACzE,QAAI;AACJ,UAAM,QAAQ,MAAM,uBAAuB;AAAA,MACzC,QAAQ,OAAO;AAAA,MACf;AAAA,MACA;AAAA;AAEF,UAAM,EAAE,YAAY;AACpB,QAAI,eAAe,WAAW;AAE5B,gBAAU,MAAM;AAAA;AAElB,QAAI,eAAe,QAAQ;AACzB,YAAM,SAAS,oBAAoB;AACnC,gBAAU,WAAW,IAAI,MAAM,QAAQ,OAAO;AAAA;AAEhD,WAAO,EAAE,SAAS;AAAA;AAAA;AAGpB,IAAM,eAAe;AAAA,EACnB,aAAa;AAAA,EACb,WAAW;AAAA,EACX,YAAY;AAAA;AAWC,yBAAyB,OAAO;AAnF/C;AAoFE,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAIJ,QAAM,aAAa,QAAO;AAC1B,cAAU,MAAM;AACd,eAAW,UAAU;AACrB,WAAO;AAAA,KACN,CAAC;AAEJ,QAAM,iBAAiB,kBAAS,OAAT,oBAAa,cAAa;AAEjD,QAAM,EAAE,MAAM,UAAU,mBAAmB;AAC3C,QAAM,CAAC,KAAK,UAAU,WAAS;AAE/B,QAAM,kBAAkB,CAAC,OAAO,WAAW;AACzC,WAAO;AAAA;AAET,QAAM,EAAE,QAAQ,UAAU,MAAM,QAAQ,QAAQ,KAAK,KAAK,SAAS,KAAK;AACxE,QAAM,CAAC,YAAY,iBAAiB,WAAS,MAAM;AACnD,QAAM,CAAC,YAAY,iBAAiB,WAAS;AAC7C,QAAM,CAAC,mBAAmB,wBAAwB,WAChD,cAAc,OACZ,WAAS,OAAO,eAAe,WAAW,UAC1C,OAAO,CAAC,GAAG,QAAS,iCAAK,IAAL,GAAS,MAAM,eAAe,SAAS;AAG/D,sBAAoB,GAAG;AACrB,sBAAkB,iCAAK,QAAL,EAAY,SAAS;AAAA;AAGzC,uBAAqB,GAAG;AACtB,sBAAkB,iCAAK,QAAL,EAAY,UAAU;AAAA;AAG1C,sBAAoB,GAAG;AACrB,sBAAkB,iCAAK,QAAL,EAAY,SAAS;AAAA;AAGzC,uBAAqB,GAAG;AACtB,sBAAkB,iCAAK,QAAL,EAAY,UAAU;AAAA;AAE1C,+BAA6B,GAAG;AAC9B,sBAAkB,iCAAK,QAAL,EAAY,kBAAkB;AAAA;AAElD,4BAA0B,GAAG;AAC3B,sBAAkB,iCAAK,QAAL,EAAY,eAAe;AAAA;AAG/C,qCAAmC,KAAK;AACtC,sBAAkB,kCAAK,QAAU;AAAA;AAGnC,+BAA6B,QAAO,KAAK;AACvC,sBAAkB,iCAAK,QAAL,GAAa,GAAG,gBAAe;AAAA;AAGnD,oCAAkC,aAAa,eAAe;AAC5D,sBAAkB,iCACb,QADa;AAAA,MAEhB,UAAU;AAAA,MACV,YAAY;AAAA;AAAA;AAIhB,sBAAoB,GAAG,GAAG;AACxB,UAAM,cAAc,CAAC,GAAG,WAAW;AACnC,gBAAY,KAAK;AACjB,sBAAkB,iCAAK,QAAL,EAAY,UAAU;AAAA;AAG1C,sBAAoB,GAAG;AACrB,UAAM,cAAc,CAAC,GAAG,WAAW,SAAS;AAC5C,sBAAkB,iCAAK,QAAL,EAAY,UAAU;AAAA;AAG1C,yBAAuB,GAAG;AACxB,UAAM,cAAc,CAAC,GAAG,WAAW;AACnC,gBAAY,OAAO,GAAG;AACtB,sBAAkB,iCAAK,QAAL,EAAY,UAAU;AAAA;AAG1C,QAAM,2BAA2B,CAAC,QAAQ;AACxC,UAAM,6BAA6B,WAAW,QAAQ,IAAI,MAAM;AAChE,+BAA2B;AAAA;AAK7B,QAAM,mBAAmB,MAAY;AACnC,UAAM,YAAY;AAClB,WAAO,QAAQ,CAAC,UAAU;AAGxB,gBAAU,SAAS,cAAc,SAAS,SACtC,kBAAkB,UAAU,IAC5B;AAAA;AAEN,UAAM,EAAE,SAAS,YAAY,MAAM,qBACjC,QACA,CAAC,YACD,YACA;AAEF,UAAM,SAAS,QAAQ;AACvB,UAAM,SAAS;AACf,UAAM,QAAQ,CAAC,KAAK,KAAK;AACzB,UAAM,WAAU;AAChB,UAAM,eAAe,UAAS;AAC9B,UAAM,6BAA6B,CAAC,GAAG;AACvC,+BAA2B,gBAAgB;AAC3C,+BAA2B;AAC3B,UAAM,UAAU;AAAA,MACd;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAEF,2BAAuB,MAAM;AAC3B,iBAAW,iCAAK,UAAL,EAAc,QAAQ,QAAQ,OAAM;AAC/C,YAAM,kCAAkC,CAAC,GAAG;AAC5C,sCAAgC,gBAAgB;AAChD,iCAA2B;AAC3B,6BAAuB;AAAA;AAEzB,eAAW;AAAA;AAGb,QAAM,qBAAqB,CAAO,UAAU;AAC1C,kBAAc;AACd,UAAM,aAAa,UAAS,IAAI,aAAW,QAAQ;AACnD,QAAI,UAAU,UAAS,IAAI,aAAW,QAAQ;AAC9C,UAAM,EAAE,YAAY,MAAM,qBACxB,QACA,YACA,OACA;AAKF,cAAU,QAAQ,IAAI,CAAC,QAAQ,MAAM;AACnC,YAAM,CAAC,MAAM,SAAS;AACtB,aAAO,CAAC,KAAK,IAAI,MAAM,QAAQ,GAAG,KAAK,KAAK,IAAI,OAAO,QAAQ,GAAG;AAAA;AAGpE,UAAM,cAAc,UAAS,IAAI,CAAC,GAAG,MAAO,iCAAK,IAAL,EAAQ,QAAQ,QAAQ;AACpE,6BAAyB,aAAa;AAAA;AAIxC,QAAM,sCAAsC,CAAO,OAAyB,eAAzB,KAAyB,WAAzB,EAAE,WAAW,SAAY;AAC1E,UAAM,aAAa,UAAS,IAAI,aAAY,kCACvC,QAAQ,YACR;AAEL,UAAM,oBAAoB,MAAM,SAAS,aAAa,MAAM,SAAS;AAErE,QAAI,mBAAmB;AACrB,+BAAyB;AACzB,2BAAqB,QAAQ,YAAY,YAAY,OAAO,KAC1D,CAAC,EAAE,cAAc;AACf,cAAM,2BAA2B,UAAS,IAAI,OAAM,iCAC/C,IAD+C;AAAA,UAElD,WAAW,kCAAK,EAAE,YAAc;AAAA;AAIlC,+BAAuB,MAAM;AAC3B,iCAAuB;AACvB,mCAAyB;AACzB,gBAAM,yBAAyB,CAAC,GAAG,0BAA0B,IAC3D,CAAC,GAAG,MAAO,iCACN,IADM;AAAA,YAET,QAAQ,QAAQ;AAAA;AAGpB,sBAAY;AAAA;AAEd,oBAAY;AAAA;AAAA;AAIlB,yBAAqB,UAAS,kCAAK,OAAS;AAAA;AAG9C,MAAI,qBAAqB;AACzB,MAAI,OAAO,SAAS,GAAG;AACrB,UAAM,eAAe,OAAO,KAAK,OAAK,MAAM,aAAa,MAAM,QAAQ,OAAO;AAE9E,yBAAqB,UAAS,IAE5B,CAAC,GAAG,cAAc;AAEhB,YAAM,eAAe,CAAC,QAAQ;AAC5B,cAAM,6BAA6B,CAAC,GAAG;AACvC,mCAA2B,aAAa;AACxC,mCAA2B;AAAA;AAI7B,YAAM,8BAA8B,CAAC,UAAU,UAAU;AAGvD,cAAM,SAAS,GAAG,WAAW;AAC7B,YAAI,aAAa,aAAa;AAG5B,uBAAa;AACb,iBAAO,YAAY,kCACd,oBACA,OAAO;AAEZ,qBAAW,kCAAK,IAAM,SAAU;AAGhC,iCAAuB,MAAY;AACjC,kBAAM,aAAa;AAAA,cACjB,kCAAK,UAAS,WAAW,YAAc;AAAA;AAEzC,kBAAM,EAAE,YAAY,MAAM,qBACxB,QACA,YACA,YACA;AAEF,aAAC,OAAO,UAAU;AAClB,uBAAW,kCAAK,IAAM,SAAU;AAChC,mCAAuB;AACvB,yBAAa;AAAA;AAAA,eAEV;AACL,qBAAW,kCAAK,IAAM,SAAU;AAAA;AAAA;AAGpC,YAAM,sBAAsB,MAAM;AAChC,sBAAc;AAAA;AAEhB,YAAM,kBAAkB,MAAY;AAClC,cAAM,EAAE,MAAM,eAAe;AAC7B,cAAM,SAAS,MAAM,QAAQ,cACzB,WAAW,WAAW,SAAS,KAC/B;AACJ,cAAM,SAAS,MAAM,OAAO,UAAU;AAAA,UACpC,WAAW,UAAS,WAAW;AAAA;AAEjC,cAAM,QAAQ,gBAAgB,OAAO;AACrC,cAAM,EAAE,IAAI,OAAO;AACnB,mBAAW,iCAAK,IAAL,EAAQ,QAAQ,CAAC,IAAI,QAAO;AAAA;AAEzC,aACE,sCAAC,mBAAD;AAAA,QAEE,KAAK,sBAAsB;AAAA,QAC3B,SAAS;AAAA,QACT,YAAY,EAAE;AAAA,QACd,gBAAgB,EAAE,UAAU;AAAA,QAC5B,QAAQ,EAAE;AAAA,QACV,OAAO,EAAE;AAAA,QACT,UAAU;AAAA,QACV;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,YAAY,QAAQ;AAAA,QACpB,sBAAsB;AAAA,QACtB;AAAA,QACA;AAAA,QACA;AAAA,QACA,WAAW,wBAAwB;AAAA,QACnC;AAAA;AAAA;AAAA;AAOV,QAAM,2BAA2B;AAEjC,QAAM,EAAE,YAAY;AACpB,QAAM,iBAAiB,OAAO,YAAY,YAAY,UAAU;AAChE,QAAM,aAAa,iBAAiB,iBAAiB;AAErD,QAAM,yBAAyB,QAC7B,MAAM,KAAK;AAAA,IACT,QAAQ,OAAO,KAAK;AAAA,KACnB,OAAO,CAAC,GAAG,QAAQ,kBAAkB,OAAO,MAAM,MAAM;AAE7D,QAAM,gBAAgB,CAAC,aAAa,MAAM,OAAO,QAAQ,QAAQ,KAAK;AACtE,QAAM,iBACJ,8DACE,sCAAC,sBAAD;AAAA,IACE,UAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IAGA,qBAAqB,OAAO,OAAO,WAAS,cAAc,SAAS;AAAA,IACnE;AAAA,IACA,qBAAqB;AAAA,IACrB,sBAAsB;AAAA,IACtB;AAAA,IAGA,8BAA8B;AAAA,IAC9B,8BACE,MAAM,WAAW;AAAA,IAEnB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MAED,MAAM,WAAW,+BACd,OACA,oBACH,MAAM,WAAW,+BAA+B,OAC/C,sCAAC,SAAD;AAAA,IACE,UAAU,UAAS,WAAW;AAAA,IAC9B,SAAS;AAAA,IACT,WAAS;AAAA,IACT,SAAQ;AAAA,IACR,OAAO;AAAA,IACP,WAAW,sCAAC,SAAD;AAAA,IACX,MAAK;AAAA,KACN;AAMP,SACE,sCAAC,gBAAD;AAAA,IACE,WAAW,yBAAyB;AAAA,IACpC,UAAU,CAAC,GAAG,aAAU;AApd9B;AAodiC,cAAC,YACvB,cACD,YAAY,4CAAG,WAAH,oBAAW,eAAX,oBAAuB,SAAvB,mBAA6B,WAAU;AAAA;AAAA,IAGvD,iBAAiB,EAAE,OAAO;AAAA,IAC1B,UAAU,CAAC,YAAY;AAAA,KAEvB,sCAAC,6BAAD;AAAA,IACE,YAAY,sCAAC,gBAAD;AAAA,IACZ,iBAAe,SAAS;AAAA,KAExB,sCAAC,OAAD;AAAA,IAAM,WAAS;AAAA,IAAC,WAAU;AAAA,IAAS,GAAG;AAAA,IAAG,SAAQ;AAAA,KAC/C,sCAAC,sBAAD;AAAA,IAAsB,MAAI;AAAA,KACxB,sCAAC,SAAD;AAAA,IACE,SAAS,CAAC,MAAM;AACd,UAAI,CAAC,UAAU;AAEb,UAAE;AACF,cAAM,cAAc,OAAO,YAAY,YAAY,CAAC,UAAU;AAC9D,mBAAW;AAAA;AAAA;AAAA,IAGf,OAAO;AAAA,MACL,aAAa;AAAA,MACb,cAAc;AAAA,MACd,SAAS;AAAA,MACT,UAAU;AAAA;AAAA,KAGZ,sCAAC,YAAD,QAED,QAEF,CAAC,YAAY,CAAC,cAAc,CAAC,SAC5B,sCAAC,OAAD;AAAA,IACE,WAAS;AAAA,IACT,WAAU;AAAA,IACV,YAAW;AAAA,IACX,SAAQ;AAAA,KAER,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,kBAAD;AAAA,IAAkB,SAAS,SAAS;AAAA,KAAuB,cAI7D,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,IAAC,IAAI;AAAA,KACb,sCAAC,SAAD;AAAA,IACE,IAAI,SAAS;AAAA,IACb,OAAO;AAAA,IACP,UAAU,CAAC,GAAG,MAAM,WAAW;AAAA,IAC/B,mBAAkB;AAAA,IAClB,cAAc,MAAM;AAAA,IACpB,KAAK;AAAA,IACL,KAAK;AAAA,IACL,MAAM;AAAA,IACN,aAAY;AAAA,UAOxB,sCAAC,6BAAD,MACG,gBACC,8DACE,sCAAC,MAAD;AAAA,IACE,OAAO;AAAA,IACP,UAAU;AAAA,IACV,cAAW;AAAA,IACX,OAAO,EAAE,QAAQ,QAAQ,WAAW;AAAA,KAEpC,sCAAC,KAAD;AAAA,IACE,OAAM;AAAA,IACN,OAAO;AAAA,MACL,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,UAAU;AAAA;AAAA,IAEZ,eAAa;AAAA,MAEf,sCAAC,KAAD;AAAA,IACE,OAAM;AAAA,IACN,OAAO;AAAA,MACL,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,UAAU;AAAA;AAAA,OAIhB,sCAAC,UAAD;AAAA,IAAU,OAAO;AAAA,IAAK,OAAO;AAAA,KAC1B,iBAEH,sCAAC,UAAD;AAAA,IAAU,OAAO;AAAA,IAAK,OAAO;AAAA,IAAG,OAAO,EAAE,WAAW;AAAA,KAClD,sCAAC,uBAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA,2BAA2B;AAAA,IAC3B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,SAKN,gBAED,8BACC,sCAAC,SAAD;AAAA,IACE,SAAS;AAAA,IACT,WAAS;AAAA,IACT,SAAQ;AAAA,IACR,OAAO;AAAA,IACP,MAAK;AAAA,KACN,wBAGC;AAAA;;;AGjlBZ;AACA;AACA;AACA;AAGA,IAAM,aAAY,aAAW,MAAO;AAAA,EAClC,WAAW;AAAA,IACT,WAAW;AAAA,IACX,cAAc;AAAA,IACd,YAAY;AAAA;AAAA;AAIhB,wBAAwB;AACtB,SACE,8DACE,sCAAC,UAAD,OAAW;AAAA;AAMjB,wBAAwB,EAAE,cAAc,kBAAkB;AACxD,QAAM,CAAC,MAAM,WAAW,WAAS;AACjC,QAAM,UAAU;AAEhB,QAAM,YAAY,CAAC,YAAY;AAC7B,YAAQ,UAAQ,CAAC;AACjB,mBAAe;AAAA;AAGjB,MAAI,CAAC;AAAc,WAAO;AAC1B,SACE,sCAAC,YAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA,YAAY,sCAAC,cAAD;AAAA,IACZ,iBAAiB,QAAQ;AAAA,KAExB,aAAa,IAAI,CAAC,SAAS,MAC1B,sCAAC,WAAD;AAAA,IAAU,OAAK;AAAA,IAAC,KAAK,QAAQ;AAAA,IAAM,SAAS,MAAM,UAAU;AAAA,KAC1D,sCAAC,QAAD,MAAO,QAAQ;AAAA;AAOzB,IAAO,yBAAQ;;;AZ1Bf,IAAM,8BAA8B,CAAC;AAMrC,IAAM,0BAA0B,QAAM,KACpC,YAAW,CAAC,OAAO,QAAQ;AACzB,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AACJ,QAAM,6BAA6B,QACjC,kCAAkC,wDAAmB,UAAS;AAEhE,SACE,sCAAC,WAAD;AAAA,IACE,OAAO;AAAA,IACP,UAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,KAEA,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,IAA6B;AAAA,KACzC,kBACC,sCAAC,uBAAD;AAAA,IACE,KAAK,GAAG;AAAA,IACR,OAAM;AAAA,IACN,WAAU;AAAA,IACV,OAAO;AAAA,IACP,mBAAmB;AAAA,MAGtB,cAAc,sBACb,sCAAC,uBAAD;AAAA,IACE,KAAK,GAAG;AAAA,IACR,OAAM;AAAA,IACN,WAAU;AAAA,IACV,OAAO;AAAA,IACP,mBAAmB;AAAA,MAGtB,gBACI,aAAa,IAAI,CAAC,OAAO,MAAM;AAlG9C;AAmGc,UAAM,EAAE,UAAU;AAClB,UAAM,SAAS,kBAAkB;AACjC,UAAM,YAAY,eAAe;AAEjC,UAAM,WAAW,CAAC,+CAAW,aAAX,oBAAqB;AACvC,UAAM,oBAAoB,WACtB,kCACA;AAGJ,UAAM,yBAAyB,CAAC,OAAO;AACrC,YAAM,2BAA2B;AAAA,QAC/B,GAAI,yBAAyB;AAAA;AAE/B,+BAAyB,KAAK;AAC9B,+BAAyB;AAAA;AAE3B,UAAM,0BAA2B,8BAA6B,IAAI,MAAM;AACxE,UAAM,6BAA6B,CAAC,MAAM;AACxC,YAAM,+BAA+B;AAAA,QACnC,GAAI,6BAA6B;AAAA;AAEnC,mCAA6B,KAAK;AAClC,mCAA6B;AAAA;AAE/B,WAAO,UAAU,YACf,sCAAC,OAAD;AAAA,MAEE,KAAK,GAAG,kBAAkB,SAAS;AAAA,MACnC,MAAI;AAAA,MACJ,OAAO,EAAE,WAAW;AAAA,OAEpB,sCAAC,iBAAD;AAAA,MACE,MAAM,UAAU;AAAA,MAChB;AAAA,MACA;AAAA,MACA;AAAA,MACA,mBAAmB,OAAK,wBAAwB,GAAG;AAAA,MACnD,mBAAmB,MAAM,wBAAwB;AAAA,MACjD;AAAA,MACA,4BAA4B;AAAA,MAC5B,kBAAkB;AAAA,MAClB,oBAAoB;AAAA,MAGpB,WACE,mBACI,cAAa,IAAI,QAAQ,UAAU,SAAS,KAC5C,OAAO,mBAAmB,YACzB,mBAAmB,MACnB,mBAAmB;AAAA,MAE1B,UACE,OAAO,mBAAmB,YACvB,mBAAmB,MACnB,mBAAmB;AAAA,MAExB;AAAA,MACA;AAAA,MACA;AAAA,MACA,cAAc,CAAC;AAAA,QACb,MAAM;AAAA,QACN;AAAA,QACA,WAAW;AAAA,QACX,eAAe;AAAA,YACX;AACJ,gBAAQ;AACR,mBAAW,OAAO;AAClB,mBAAW,OAAO;AAClB,mBAAW,OAAO;AAClB,qBAAa;AACb,yBAAiB;AAAA;AAAA,MAEnB;AAAA,MACA;AAAA,MACA,eAAgB,kBAAmB,iBAAgB,cAAc,IAAI,KAAM;AAAA,MAC3E,cAAe,iBAAkB,iBAAgB,cAAc,IAAI,KAAM;AAAA,MACzE,6BAA6B;AAAA,UAG/B;AAAA,MAEP,6BAEG,sCAAC,OAAD;AAAA,IAAM,MAAI;AAAA,KACR,sCAAC,wBAAD;AAAA,IACE,cAAc;AAAA,IACd;AAAA,QAGF;AAAA;AAuBhB,mCAAmC,OAAO;AACxC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,iBAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,QAAM,UAAU;AAGhB,QAAM;AAAA,IACJ;AAAA,MACE;AAAA,MACA,qBAAqB;AAAA,MACrB,mBAAmB;AAAA,MACnB,uBAAuB;AAAA;AAAA,IAEzB;AAAA,MACE,wBAAwB;AAAA,MACxB,sBAAsB;AAAA,MACtB,0BAA0B;AAAA,MAC1B,mBAAmB;AAAA,MACnB,mBAAmB;AAAA,MACnB,mBAAmB;AAAA,MACnB,qBAAqB;AAAA,MACrB,yBAAyB;AAAA,MACzB,gBAAgB;AAAA;AAAA,MAEhB,gBACF,6BAA6B,iBAC7B;AAGF,QAAM;AAAA,IACJ;AAAA,MACE;AAAA,MACA;AAAA;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA;AAAA,MAEA,yBACF,6BAA6B,iBAC7B;AAKF,QAAM,CAAC,iBAAiB,mBAAmB,WAAW,CAAC,wBAAwB;AAC/E,QAAM,qBAAqB;AAC3B,QAAM,CAAC,gBAAgB,mBAAmB,gCAAgC;AAC1E,QAAM,EAAE,QAAQ,cAAc,OAAO,gBAAgB;AAErD,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAIF,cAAU,MAAM;AACd;AAAA,KAEC,CAAC,SAAS;AAIb,QAAM,CAAC,QAAQ,mBAAmB,kBAAkB,cAClD,SAAS,SAAS,gBAAgB,MAAM;AAAA,KAAK,OAC7C,EAAE,wBAAwB,mBAC1B,EAAE,qBAAqB;AAGzB,eACE,SAAS,SAAS,gBAAgB,MAAM;AAAA,KAAI,OAC5C,EAAE,sBAAsB,iBACxB,EAAE,mBAAmB;AAEvB,mBACE,SAAS,SAAS,gBAAgB,MAAM;AAAA,KAAI,OAC5C,EAAE,0BAA0B,qBAC5B,EAAE,uBAAuB;AAK3B,QAAM,iBAAiB,cAAY,CAAO,UAAU;AAnTtD;AAoTI,UAAM,SAAS,kBAAkB;AACjC,UAAM,cAAc,MAAM,wBACxB,QACC,cAAa,UAAU,IAAI;AAE9B,UAAM,WAAW;AAAA,MACf;AAAA,MACA,aAAa,mCAAe,WAAf,oBAAuB,aAAvB,oBAAiC,cAAjC,mBAA4C;AAAA,OACtD,6BAHY;AAAA,MAIf,UAAU;AAAA,MACV,MAAM,4BAAe,WAAf,mBAAuB,aAAvB,mBAAiC,aAAY,YAAY;AAAA;AAEjE,UAAM,YAAY,CAAC,GAAG,cAAc;AACpC,oBAAgB;AAAA,MACf,CAAC,mBAAmB,gBAAgB,cAAc;AAErD,QAAM,0BAA0B,cAAY,CAAC,UAAU,MAAM;AAC3D,UAAM,YAAY,CAAC,GAAG;AACtB,cAAU,KAAK;AACf,oBAAgB;AAAA,KACf,CAAC,cAAc;AAElB,QAAM,0BAA0B,cAAY,CAAC,MAAM;AACjD,UAAM,YAAY,CAAC,GAAG;AACtB,cAAU,OAAO,GAAG;AACpB,oBAAgB;AAAA,KACf,CAAC,cAAc;AAElB,QAAM,eACJ,gBAAe,SAAS,iBAAiB,CAAC,EAAE,UAAU,EAAE,WAAW,WACnE,MAAM,OAAE;AAlVZ;AAkVe,YAAC,+BAAG,aAAH,oBAAa;AAAA;AAE3B,QAAM,qBAAqB;AAC3B,QAAM,iBAAiB,8CAAc,cAAa,aAAa,UAAU,WAAS,MAAM;AACxF,SACE,sCAAC,yBAAD;AAAA,IACE,KAAK;AAAA,IACL,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IAEA,iBAAiB,mBAAmB;AAAA,IACpC,gBAAgB,kBAAkB;AAAA,IAClC;AAAA,IACA;AAAA;AAAA;AAKN,IAAO,oCAAQ;;;AahYf;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AASA,IAAM,sBAAsB,gBAAY,aAAa;AACrD,IAAM,yBAAyB,gBAAY,aAAa;AACxD,IAAM,kBAAkB,OAAyC,OAAO;AACxE,IAAM,kBAAkB,iCAAiC,iCAAiC;AAC1F,IAAM,qBAAqB,6BAA6B,qCAAqC;AAI7F,sBAAsB;AAMtB,SACE,EAAE,aAAa,yBAAyB,QAAQ,wBAAwB,UACxE,EAAE,YAAY;AAKhB,IAAM,mBAAmB,QAAM,KAAK,MAAM;AACxC,MAAI,CAAC,OAAO,OAAO;AACjB,WAAO,QAAQ;AAAA;AAEjB,MAAI,CAAC,OAAO,UAAU;AACpB,WAAO,WAAW;AAAA;AAEpB,SAAO,IAAI,QAAQ,CAAC,YAAY;AAC9B,UAAM,oBAAoB,CAAC,MAAM;AAC/B,cAAQ,KAAK;AACb,cAAQ,WAAW,uBAAuB;AAAA,QACxC,OAAO;AAAA,QACP,SAAS;AAAA;AAAA;AAIb,eAAW,iBAAiB,KAAK,MAAM;AAErC,iBAAW,oBAAoB,KAAK,MAAM;AAGxC,gBAAQ,WAAW,OAAO,MAAM;AAAA,SAC/B,MAAM;AAAA,OACR,MAAM;AAAA;AAAA;AAMb,IAAM,UAAU;AAaD,qBAAqB,OAAO;AACzC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA,cAAc;AAAA,IACd,WAAW;AAAA,IACX;AAAA,IACA;AAAA,MACE;AAGJ,QAAM,CAAC;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KACC;AAAA,IACD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,OACG,gBAAgB,6BAA6B,SAAS;AAG3D,QAAM,CAAC,OAAO,gBAAgB,gBAAgB;AAC9C,QAAM,CAAC,YAAY,iBAAiB;AACpC,QAAM,cAAc;AAEpB,QAAM,YAAY,UAAQ,MAAO,iCAC5B,gBAD4B;AAAA,IAE/B;AAAA,MACE,CAAC,eAAe;AAEpB,QAAM,eAAe,UAAQ,MAAM;AAEjC,UAAM,UAAU;AAChB,UAAM,kBAAkB,aAAc,SAAK;AAC3C,UAAM,QAAQ,QAAQ;AACtB,UAAM,iBAAiB;AAAA,MACrB,UAAU,kBAAkB,QAAQ;AAAA,MACpC,UAAU,kBAAkB,QAAQ;AAAA;AAEtC,UAAM,UAAU;AAChB,UAAM,kBAAkB,aAAc,SAAK;AAC3C,UAAM,QAAQ,SAAS;AACvB,UAAM,iBAAiB;AAAA,MACrB,UAAU,kBAAkB,QAAQ;AAAA,MACpC,UAAU,kBAAkB,QAAQ;AAAA;AAEtC,WAAO;AAAA,MACL,UAAU;AAAA,MACV,WAAW;AAAA,MACX,oBAAoB;AAAA,QAClB;AAAA;AAAA,MAEF,eAAe;AAAA,MACf,OAAO;AAAA,QACL;AAAA,UACE,KAAK;AAAA,WACF,mBAFL;AAAA,UAGE;AAAA,UACA;AAAA;AAAA;AAAA,MAGJ,WAAW;AAAA,QACT,gBAAgB;AAAA,QAChB,WAAW;AAAA;AAAA,MAEb,eAAe;AAAA,QACb,gBAAgB;AAAA,QAChB,WAAW;AAAA;AAAA,MAEb,iBAAiB;AAAA,QACf,gBAAgB;AAAA,QAChB,WAAW;AAAA;AAAA;AAAA,KAGd;AAAA,IAAC;AAAA,IAAgB;AAAA,IAAY;AAAA,IAAc;AAAA,IAAO;AAAA,IACnD;AAAA,IAAc;AAAA,IAAQ;AAAA;AAExB,cAAU,MAAM;AACd,UAAM,mBAAmB,MAAM;AAC7B,kBAAY,UAAU;AAAA;AAExB,UAAM,mBAAmB,MAAM;AAC7B,kBAAY,UAAU;AAAA;AAExB,UAAM,YAAY,aAAa;AAC/B,cAAU,iBAAiB,cAAc;AACzC,cAAU,iBAAiB,cAAc;AACzC,WAAO,MAAM;AACX,gBAAU,oBAAoB,cAAc;AAC5C,gBAAU,oBAAoB,cAAc;AAAA;AAAA,KAE7C,CAAC;AAGJ,cAAU,MAAM;AACd,QAAI,CAAC,YAAY;AACf,aAAO,MAAM;AAAA;AAAA;AAEf,eAAW,IAAI,GAAG,cAAc,CAAC,qBAAqB;AAIpD,UAAI,CAAC,YAAY,SAAS;AACxB;AAAA;AAEF,YAAM,aAAa,KAAK,MAAM;AAC9B,YAAM,UAAU,WAAW,MAAM,GAAG;AACpC,YAAM,UAAU,WAAW,MAAM,GAAG;AAEpC,YAAM,mBAAmB,KAAK,KAC5B,aAAe,UAAQ,KAAK,QAAQ,MAAO,WAAU;AAEvD,YAAM,mBAAmB,KAAK,KAC5B,aAAe,UAAQ,KAAK,QAAQ,MAAO,WAAU;AAEvD,YAAM,qBAAqB,QAAQ,KAAM,SAAQ,KAAK,QAAQ,MAAM;AACpE,YAAM,qBAAqB,QAAQ,KAAM,SAAQ,KAAK,QAAQ,MAAM;AACpE,sBAAgB;AAChB,sBAAgB;AAChB,wBAAkB;AAClB,wBAAkB;AAAA;AAEpB,WAAO,MAAM,WAAW,IAAI,IAAI;AAAA,KAC/B;AAAA,IAAC;AAAA,IAAY;AAAA,IAAY;AAAA,IAAO;AAAA,IAAQ;AAAA,IAAiB;AAAA,IAC1D;AAAA,IAAmB;AAAA;AAErB,SACE,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,IAAkB,KAAK;AAAA,IAAc,OAAO,EAAE,QAAQ,GAAG;AAAA,KACtE,sCAAC,UAAD;AAAA,IAAU,UAAU,sCAAC,OAAD,MAAK;AAAA,KACvB,sCAAC,kBAAD;AAAA,IACE,KAAK;AAAA,IACL,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,SAAS;AAAA;AAAA;AAQrB,YAAY,eAAe;AAAA,EACzB,WAAW;AAAA,IACT,SAAS;AAAA,IACT,2BAA2B;AAAA,IAC3B,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,UAAU;AAAA;AAAA,EAEZ,YAAY;AAAA;;;ADlOd,IAAM,qBAAqB;AAaZ,2BAA2B,OAAO;AAC/C,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAGJ,QAAM,CAAC,OAAO,QAAQ,gBAAgB;AAEtC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAGF,QAAM,CAAC,MAAM,QAAQ,aAAa;AAElC,SACE,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,WAAD;AAAA,IACE,OAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KAEA,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,IAAuB,KAAK;AAAA,KACzC,sCAAC,aAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA;;;AEtDZ;;;ACAA;AACA;;;ACDA;AACA;;;ACAA;;;ADSO,IAAM,eAAe;AAE5B,gBAAgB,MAAM;AACpB,SAAO,KAAK,YAAY;AAAA;AAUX,kBAAkB,OAAO;AACtC,QAAM;AAAA,IACJ,MAAM;AAAA,IACN;AAAA,IACA;AAAA,MACE;AAEJ,QAAM,OAAO,iCACR,cADQ;AAAA,IAEX,MAAO,OAAO,eACV;AAAA,MACA,EAAE,MAAM;AAAA,MACR,GAAG,YAAY;AAAA,QAEf,EAAE,MAAM;AAAA;AAId,QAAM,gBAAgB,UAAQ,MAC5B,sCAAC,MAAD;AAAA,IACE;AAAA,IACA,MAAM;AAAA,OACH,eAAe;AAAA;AAAA,IAElB;AAAA,IACA,SAAS,IAAI,UAAU;AAAA,IACvB,UAAS;AAAA,IACT,aAAa;AAAA,MAEd,CAAC,MAAM,MAAM;AAEhB,SACE,QAAQ,QAAQ,KAAK,SAAS,IAC5B,sCAAC,WAAD;AAAA,IAAU,UAAU,sCAAC,OAAD,MAAK;AAAA,KACtB,iBAED;AAAA;;;AEvDD,IAAM,cAAc;AAAA,EACzB,MAAM;AAAA,IAGJ,YAAY;AAAA,IACZ,OAAO,EAAE,OAAO;AAAA,IAChB,OAAO;AAAA,MACL,eAAe;AAAA,QACb,MAAM;AAAA;AAAA,MAER,eAAe;AAAA,QACb,MAAM;AAAA;AAAA;AAAA,IAGV,MAAM;AAAA,MACJ,aAAa;AAAA,MACb,WAAW;AAAA,MACX,WAAW;AAAA;AAAA;AAAA,EAGf,OAAO;AAAA,IAEL,YAAY;AAAA;AAAA;;;AHFD,0BAA0B,OAAO;AAC9C,QAAM;AAAA,IACJ,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc;AAAA,IACd,eAAe;AAAA,IACf,YAAY;AAAA,MACV;AAOJ,QAAM,OAAO,QAAQ,IAAI,OAAM,iCAC1B,IAD0B;AAAA,IAE7B,SAAS,EAAE,MAAM,EAAE;AAAA,IACnB,aAAa,mBAAmB,EAAE;AAAA;AAKpC,QAAM,SAAS;AAAA,IACb,QAAQ,KAAK,IAAI,OAAK,EAAE;AAAA,IACxB,OAAO,KAAK,IAAI,OAAK,EAAE;AAAA;AAIzB,QAAM,OAAO,KAAK,IAAI,OAAK,EAAE;AAE7B,QAAM,OAAO;AAAA,IACX,MAAM,EAAE,MAAM;AAAA,IACd,UAAU;AAAA,MACR,GAAG;AAAA,QACD,OAAO;AAAA,QACP,MAAM;AAAA,QACN,MAAM,EAAE,WAAW,0BAA0B;AAAA,QAC7C,OAAO;AAAA,QACP,MAAM;AAAA;AAAA,MAER,GAAG;AAAA,QACD,OAAO;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA;AAAA,MAET,OAAO;AAAA,QACL,OAAO;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA,QACP,QAAQ;AAAA;AAAA,MAEV,SAAS;AAAA,QACP,OAAO;AAAA,QACP,MAAM;AAAA;AAAA;AAAA,IAGV,OAAO,OAAM,QAAQ,aAAa,IAAI;AAAA,IACtC,QAAQ,OAAM,SAAS,cAAc,IAAI;AAAA,IACzC,QAAQ,YAAY;AAAA;AAGtB,SACE,sCAAC,UAAD;AAAA,IACE;AAAA,IACA;AAAA;AAAA;;;ADhFN,IAAM,4BAA4B,CAAC;AAapB,oCAAoC,OAAO;AACxD,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,iBAAQ;AAAA,MACN;AAEJ,QAAM,UAAU;AAGhB,QAAM,CAAC;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KACC;AAAA,IACD;AAAA,IACA;AAAA,OACG,gBAAgB,6BAA6B,cAAc;AAEhE,QAAM,CAAC,OAAO,QAAQ,gBAAgB;AACtC,QAAM,CAAC,MAAM,QAAQ,aAAa;AAClC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAIF,cAAU,MAAM;AACd;AACA;AAAA,KAEC,CAAC,SAAS;AAGb,QAAM,CAAC,YAAY,gBACjB,SAAS,SAAS,gBAAgB,QAAQ,MAC1C,EAAE,qBAAqB,mBACvB,EAAE,kBAAkB;AAGtB,QAAM,iBAAiB,UACrB,MAAM,cAAc,UAAU,qBAC9B,CAAC,UAAU;AAKb,QAAM,OAAO,UAAQ,MAAO,kBAAkB,oBAAoB,eAC9D,yBAAyB,gBAAgB,kBAAkB,cAAc,SACzE,IACD,CAAC,gBAAgB,kBAAkB,cAAc;AAEpD,SACE,sCAAC,WAAD;AAAA,IACE,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KAEA,sCAAC,OAAD;AAAA,IAAK,KAAK;AAAA,IAAc,WAAU;AAAA,KAChC,sCAAC,kBAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA;;;AK9FV;AAAA;AAAA;AAAA;AAGA;AACA;AAUA,IAAM,8BAA8B,CAAC;AAErC,IAAM,qBAAqB;AAAA,EACzB,MAAM;AAAA,IACJ,aAAa;AAAA,IACb,OAAO;AAAA;AAAA,EAET,MAAM;AAAA,IACJ,aAAa;AAAA,IACb,OAAO;AAAA;AAAA,EAET,KAAK;AAAA,IACH,aAAa;AAAA,IACb,OAAO;AAAA;AAAA,EAET,MAAM;AAAA,IACJ,aAAa;AAAA,IACb,OAAO;AAAA;AAAA;AAyBI,mCAAmC,OAAO;AACvD,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,qBAAqB;AAAA,IACrB,sBAAsB;AAAA,IACtB,gBAAgB;AAAA,IAChB,WAAW;AAAA,IACX,iBAAQ;AAAA,MACN;AAGJ,QAAM,CAAC,OAAO,QAAQ,gBAAgB;AACtC,QAAM,UAAU;AAGhB,QAAM,CAAC;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,OACG,gBACH,6BAA6B,iBAC7B;AAIF,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAGF,QAAM,CAAC,MAAM,QAAQ,aAAa;AAElC,QAAM,CAAC,wBAAwB,uBAC7B,SAAS,SAAS,gBAAgB,QAAQ;AAG5C,QAAM,eAAe,UAAQ,MAAM;AACjC,QAAI,CAAC,wBAAwB,KAAK,WAAW,GAAG;AAC9C,aAAO;AAAA;AAGT,UAAM,EAAE,QAAQ,KAAK;AAGrB,UAAM,kBAAmB,UAAU,SAAS,YAAY;AACxD,UAAM,kBAAmB,UAAU,SAAS,YAAY;AACxD,UAAM,WAAY,UAAU,SAAS,YAAY;AAGjD,UAAM,kBAAkB;AAAA,MACtB;AAAA,QACE,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,YAAY,mBAAmB,UAAU;AAAA,QACzC,KAAK;AAAA,QACL,SAAS;AAAA,UACP,OAAO;AAAA,UACP,UAAU;AAAA,UACV,mBAAmB;AAAA,UACnB,mBAAmB;AAAA,UACnB,oBAAoB;AAAA;AAAA,QAEtB,QAAQ;AAAA;AAAA,MAEV;AAAA,QACE,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,YAAY,mBAAmB,UAAU;AAAA,QACzC,KAAK;AAAA,QACL,SAAS;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,UACV,eAAe;AAAA,UACf,iBAAiB;AAAA,UACjB,kBAAkB;AAAA,UAClB,gBAAgB;AAAA,UAChB,mBAAmB;AAAA,UACnB,WAAW;AAAA,UACX,sBAAsB;AAAA,UACtB,mBAAmB;AAAA,UACnB,mBAAmB;AAAA,UACnB,mBAAmB;AAAA,UACnB,oBAAoB;AAAA,UACpB,iBAAiB;AAAA,UACjB,kBAAkB;AAAA,UAClB,YAAY;AAAA,UACZ,sBAAsB;AAAA,UACtB,kBAAkB;AAAA,UAClB,kBAAkB;AAAA;AAAA,QAEpB,QAAQ;AAAA;AAAA;AAMZ,UAAM,2BAA2B,KAAI,gBAAgB,IAAI,OAAK,EAAE;AAChE,UAAM,yBAAyB,SAAS,2BAA2B;AACnE,UAAM,qBAAqB,yBAAyB,qBAAqB,UAAU;AACnF,UAAM,gBAAgB,qBAAqB,UAAU,IAAI,CAAC,SAAS,MAAM;AAjK7E;AAmKM,YAAM,WAAW,QAAQ;AAEzB,YAAM,SAAS,MAAM,QAAQ;AAI7B,YAAM,YAAY,sBACd,QAAQ,uBACP,SAAS,SAAS,SAAS,SAAS,KAAK;AAG9C,YAAM,iBAAiB,SAAS,qDAAkB,KAAK,OAAK,UAAQ,GAAG,aAAa;AACpF,YAAM,WAAW,SAAS,oDAAc,KAAK,OAAK,UAAQ,EAAE,MAAM,eAAxC,oBAAoD,QAAQ;AAEtF,YAAM,iBAAiB,SAAS,SAAS,KAAK,QAAQ;AAEtD,YAAM,QAAQ;AAAA,QACZ,MAAM;AAAA,QACN,KAAK,aAAa;AAAA,QAClB,MAAM;AAAA,UACJ,MAAM;AAAA,UACN;AAAA,UACA,KAAK;AAAA;AAAA,QAEP,SAAS;AAAA,UACP,MAAM;AAAA,UACN,mBAAmB;AAAA,UACnB,oBAAoB;AAAA,UACpB,YAAa,UAAU,SAAS,UAAU;AAAA,UAC1C,sBAAuB,UAAU,SAAS,UAAU;AAAA,UACpD,mBAAmB;AAAA;AAAA,QAErB,QAAQ;AAAA;AAGV,UAAI,YAAY,gBAAgB;AAC9B,cAAM,IAAI;AACV,cAAM,QAAQ,eAAe,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE;AAAA,aACjD;AACL,cAAM,QAAQ,eAAe;AAAA;AAE/B,aAAO;AAAA;AAMT,UAAM,SAAS;AAAA,MACb,QAAQ;AAAA,QACN,KAAK;AAAA,UACH,GAAG;AAAA,UACH,GAAG;AAAA;AAAA,QAEL,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,SAAS;AAAA;AAAA,MAEX,QAAQ;AAAA,QACN,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA,QACH,QAAQ;AAAA;AAAA;AAGZ,WAAO;AAAA,KACN;AAAA,IAAC;AAAA,IAAsB;AAAA,IAAM;AAAA,IAAO;AAAA,IAAQ;AAAA,IAC7C;AAAA,IAAqB;AAAA,IAAkB;AAAA,IACvC;AAAA,IAAe;AAAA;AAGjB,cAAU,MAAM;AACd;AACA;AAAA,KAEC,CAAC,SAAS;AAEb,SACE,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,sCAAC,WAAD;AAAA,IACE,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KAEA,sCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,IAAuB,KAAK;AAAA,KACxC,eACC,sCAAC,aAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,OAEA;AAAA;;;ACpQd;AACA;;;ACDA;AACA;AAqBe,6BAA6B,OAAO;AACjD,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc;AAAA,IACd,eAAe;AAAA,MACb;AAEJ,QAAM,SAAS,iBAAiB,cAAc,UAAU,IACpD,gCACA;AAEJ,QAAM,OAAO;AAAA,IACX,MAAM,EAAE,MAAM;AAAA,IACd,UAAU;AAAA,MACR,GAAG;AAAA,QACD,OAAO;AAAA,QACP,MAAM;AAAA,QACN,KAAK,EAAE,SAAS;AAAA,QAChB,OAAO;AAAA;AAAA,MAET,GAAG;AAAA,QACD,MAAM;AAAA,QACN,WAAW;AAAA,QACX,OAAO;AAAA;AAAA,MAET,OAAO,EAAE,OAAO;AAAA;AAAA,IAElB,OAAO,OAAM,QAAQ,aAAa,IAAI;AAAA,IACtC,QAAQ,OAAM,SAAS,cAAc,IAAI;AAAA,IACzC,QAAQ,YAAY;AAAA;AAGtB,SACE,sCAAC,UAAD;AAAA,IACE;AAAA,IACA;AAAA;AAAA;;;ADnDN,IAAM,kCAAkC,CAAC;AAY1B,uCAAuC,OAAO;AAC3D,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,QAAM,UAAU;AAGhB,QAAM,CAAC;AAAA,IACL;AAAA,IACA;AAAA,OACG,gBAAgB,6BAA6B,qBAAqB;AAEvE,QAAM,CAAC,OAAO,QAAQ,gBAAgB;AACtC,QAAM,CAAC,MAAM,QAAQ,aAAa;AAClC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAIF,cAAU,MAAM;AACd;AACA;AAAA,KAEC,CAAC,SAAS;AAGb,QAAM,CAAC,oBAAoB,wBACzB,SAAS,SAAS,gBAAgB,QAAQ;AAG5C,QAAM,CAAC,kBAAkB,iBACvB,SAAS,SAAS,gBAAgB,OAAO,eAAe;AAG1D,QAAM,oBAAoB,iBAAiB,cAAc,UAAU,IAC/D,cAAc,KACd;AAIJ,QAAM,OAAO,UAAQ,MAAM;AACzB,QAAI,qBAAqB,oBAAoB,gBAAgB;AAE3D,aAAO,MAAM,KAAK,eAAe,IAAI,IAAI,CAAC,GAAG,UAAU;AACrD,cAAM,QAAQ,eAAe,GAAG;AAChC,cAAM,YAAY,QAAQ,MAAM;AAChC,eAAO,EAAE,OAAO,WAAW,MAAM;AAAA;AAAA;AAGrC,QAAI,kBAAkB;AACpB,YAAM,WAAW,iBAAiB,KAAK;AACvC,aAAO,iBAAiB,KAAK,IAAI,CAAC,QAAQ,cAAc;AACtD,cAAM,SAAS,iBAAiB,OAC7B,SAAS,YAAY,UAAW,aAAY,KAAK;AACpD,cAAM,WAAW,KAAI,UAAU,MAAM;AACrC,eAAO,EAAE,OAAO,UAAU,MAAM;AAAA;AAAA;AAGpC,WAAO;AAAA,KACN,CAAC,kBAAkB,mBAAmB;AAEzC,SACE,sCAAC,WAAD;AAAA,IACE,OAAO,uBAAwB,oBAAoB,KAAK,uBAAuB;AAAA,IAC/E;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KAEA,sCAAC,OAAD;AAAA,IAAK,KAAK;AAAA,IAAc,WAAU;AAAA,KAChC,sCAAC,qBAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA;;;AEzGV;;;ACAA;AAqBO,gCACL,gBAAgB,qBAAqB,UAAU,oBAC/C,eAAe,kBAAkB,cAAc,4BAC/C,OACA;AACA,QAAM,iBAAiB,UACrB,MAAM,cAAc,UAAU,qBAC9B,CAAC,UAAU;AAKb,QAAM,CAAC,eAAe,iBAAiB,UAAQ,MAAM;AACnD,QAAI,kBAAkB,oBACf,iBAAiB,cAAc,UAAU,KACzC,gBACL;AACA,YAAM,cAAc,wBAClB,gBAAgB,kBAAkB,cAAc;AAGlD,YAAM,oBAAoB,cAAc;AAExC,UAAI,UAAU;AACd,YAAM,cAAc;AACpB,eAAS,IAAI,GAAG,IAAI,oBAAoB,KAAK,QAAQ,KAAK,GAAG;AAC3D,oBAAY,oBAAoB,KAAK,MAAM;AAAA;AAE7C,YAAM,aAAa,YAAY,IAAI,CAAC,SAAS;AAC3C,cAAM,YAAY,YAAY,KAAK;AACnC,cAAM,QAAQ,eAAe,GAAG;AAChC,cAAM,YAAY,QAAQ,MAAM;AAChC,cAAM,mBAAmB,6BAA6B,KAAK,IAAI,IAAI,aAAa;AAChF,kBAAU,KAAK,IAAI,kBAAkB;AACrC,eAAO,EAAE,OAAO,kBAAkB,MAAM,mBAAmB,KAAK,KAAK;AAAA;AAEvE,aAAO,CAAC,YAAY;AAAA;AAEtB,WAAO,CAAC,MAAM;AAAA,KACb;AAAA,IAAC;AAAA,IAAgB;AAAA,IAAqB;AAAA,IAAe;AAAA,IACtD;AAAA,IAAgB;AAAA,IAAkB;AAAA,IAAc;AAAA;AAIlD,QAAM,SAAS,UAAQ,MAAO,kBAAkB,oBAAoB,eAChE,yBAAyB,gBAAgB,kBAAkB,cAAc,SACzE,IACD,CAAC,gBAAgB,kBAAkB,cAAc;AAEpD,SAAO,CAAC,eAAe,QAAQ;AAAA;;;ACtEjC;AACA;AACA;AACA;AAIe,sCAAsC,OAAO;AAC1D,QAAM,EAAE,+BAA+B,+BAA+B;AACtE,QAAM,UAAU;AAEhB,iDAA+C;AAC7C;AAAA;AAGF,SACE,sCAAC,kBAAD,MACE,sCAAC,WAAD,MACE,sCAAC,YAAD;AAAA,IAAW,WAAW,QAAQ;AAAA,KAAW,kBACzC,sCAAC,YAAD;AAAA,IAAW,WAAW,QAAQ;AAAA,KAC5B,sCAAC,WAAD;AAAA,IACE,WAAW,QAAQ;AAAA,IACnB,SAAS,QAAQ;AAAA,IACjB,UAAU;AAAA,IACV,MAAK;AAAA,IACL,OAAM;AAAA;AAAA;;;ACzBlB;AACA;AAyBe,+BAA+B,OAAO;AACnD,QAAM;AAAA,IACJ,YAAY;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc;AAAA,IACd;AAAA,IACA;AAAA,MACE;AAEJ,QAAM,wBAAwB,KAAK,OAAO,CAAC,KAAK,QAAQ;AAEtD,UAAM,QAAQ,UAAa,IAAI,IAAI,SAAS,MAAM,IAAI,IAAI,SAAS;AACnE,WAAO;AAAA,KACN;AAKH,QAAM,mBAAmB,gBACpB,KAAK,KAAK,KAAK,wBAAwB,KAAK;AAGjD,QAAM,aAAa;AAAA,IACjB,QAAQ,OAAO,IAAI,OAAK,EAAE;AAAA,IAC1B,OAAO,OAAO,IAAI,OAAK,mBAAmB,EAAE;AAAA;AAG9C,QAAM,YAAY,OAAM,QAAQ,aAAa,IAAI;AACjD,QAAM,aAAa,OAAM,SAAS,kBAAkB,IAAI;AAExD,QAAM,WAAW,OAAO;AACxB,QAAM,YAAY,YAAY;AAE9B,QAAM,YAAa,UAAU,SAAS,UAAU;AAEhD,QAAM,OAAO;AAAA,IACX,SAAS;AAAA,IACT,aAAa;AAAA,IACb,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ,iCACH,YAAY,SADT;AAAA,MAEN,UAAU;AAAA,QACR,cAAc;AAAA,QACd,WAAW;AAAA,QACX,YAAY;AAAA;AAAA;AAAA,IAIhB,SAAS;AAAA,MACP,EAAE,MAAM,aAAa,OAAO;AAAA,MAC5B,EAAE,MAAM,SAAS,OAAO;AAAA,MACxB,EAAE,MAAM,UAAU,OAAO;AAAA,MACzB,EAAE,MAAM,QAAQ,OAAO;AAAA;AAAA,IAGzB,MAAM;AAAA,MACJ;AAAA,QACE,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,WAAW;AAAA,UACT;AAAA,YACE,MAAM;AAAA,YACN,OAAO;AAAA,YACP,SAAS,CAAC;AAAA,YACV,WAAW;AAAA,YACX,QAAQ,CAAC,GAAG;AAAA;AAAA;AAAA;AAAA,MAIlB;AAAA,QACE,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,WAAW;AAAA,UACT;AAAA,YACE,MAAM;AAAA,YACN,SAAS,CAAC;AAAA,YACV,QAAQ,CAAC,SAAS,SAAS;AAAA,YAC3B,KAAK,CAAC,MAAM,UAAU;AAAA,YACtB,IAAI,CAAC,MAAM,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA,IAM7B,QAAQ;AAAA,MACN;AAAA,QACE,MAAM;AAAA,QACN,MAAM;AAAA,QACN,OAAO;AAAA,QACP,QAAQ,EAAE,MAAM,cAAc,OAAO;AAAA;AAAA,MAEvC;AAAA,QACE,MAAM;AAAA,QACN,MAAM;AAAA,QACN,OAAO;AAAA,QACP,QAAQ,CAAC,GAAG;AAAA;AAAA,MAEd;AAAA,QACE,MAAM;AAAA,QACN,MAAM;AAAA,QACN,OAAO,CAAC,GAAG,EAAE,QAAQ;AAAA,QACrB,QAAQ,EAAE,MAAM,WAAW,OAAO;AAAA;AAAA,MAEpC;AAAA,QACE,MAAM;AAAA,QACN,MAAM;AAAA,QACN,SAAS;AAAA,QACT,OAAO,CAAC,GAAG,EAAE,QAAQ;AAAA,QACrB,QAAQ,EAAE,MAAM,WAAW,OAAO;AAAA;AAAA,MAEpC;AAAA,QACE,MAAM;AAAA,QACN,MAAM;AAAA,SACH;AAAA;AAAA,IAIP,MAAM;AAAA,MACJ;AAAA,QACE,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,QAAQ;AAAA,QAGR,OAAO,6BACH,CAAC,mBAAmB,kCACpB;AAAA;AAAA,MAEN;AAAA,QACE,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,WAAW;AAAA,QACX,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,YAAY;AAAA,QACZ,YAAY;AAAA;AAAA;AAAA,IAIhB,OAAO;AAAA,MACL;AAAA,QACE,MAAM;AAAA,QACN,MAAM;AAAA,UACJ,OAAO;AAAA,YACL,MAAM;AAAA,YACN,MAAM;AAAA,YACN,SAAS;AAAA;AAAA;AAAA,QAIb,QAAQ;AAAA,UACN,OAAO;AAAA,YACL,IAAI,EAAE,OAAO,UAAU,OAAO,OAAO,MAAM;AAAA,YAC3C,OAAO,EAAE,QAAQ;AAAA,YACjB,QAAQ,EAAE,QAAQ;AAAA;AAAA;AAAA,QAItB,MAAM;AAAA,UACJ;AAAA,YACE,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,WAAW;AAAA,cACT;AAAA,gBACE,MAAM;AAAA,gBACN,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA,QAMd,OAAO;AAAA,UACL;AAAA,YACE,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,MAAM,EAAE,MAAM;AAAA,YACd,QAAQ;AAAA,cACN,OAAO;AAAA,gBACL,MAAM,EAAE,OAAO,SAAS,OAAO,EAAE,QAAQ;AAAA;AAAA,cAE3C,QAAQ;AAAA,gBACN,OAAO,EAAE,OAAO,UAAU,OAAO;AAAA,gBACjC,IAAI,EAAE,QAAQ;AAAA,gBACd,IAAI,EAAE,OAAO,UAAU,OAAO;AAAA,gBAC9B,GAAG,EAAE,OAAO,UAAU,OAAO;AAAA;AAAA;AAAA;AAAA,UAInC;AAAA,YACE,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,MAAM,EAAE,MAAM;AAAA,YACd,QAAQ;AAAA,cACN,OAAO;AAAA,gBACL,MAAM,EAAE,OAAO,SAAS,OAAO,EAAE,QAAQ;AAAA;AAAA,cAE3C,QAAQ;AAAA,gBACN,OAAO,EAAE,OAAO,kBAAkB,OAAO;AAAA,gBACzC,IAAI,EAAE,QAAQ;AAAA,gBACd,IAAI,EAAE,OAAO,UAAU,OAAO;AAAA,gBAC9B,GAAG,EAAE,OAAO,UAAU,OAAO;AAAA;AAAA;AAAA;AAAA,UAInC;AAAA,YACE,MAAM;AAAA,YACN,MAAM,EAAE,MAAM;AAAA,YACd,QAAQ;AAAA,cACN,OAAO;AAAA,gBACL,MAAM,EAAE,OAAO;AAAA,gBACf,OAAO,EAAE,OAAO;AAAA;AAAA,cAElB,QAAQ;AAAA,gBACN,GAAG,EAAE,OAAO,UAAU,OAAO;AAAA,gBAC7B,IAAI,EAAE,OAAO,UAAU,OAAO;AAAA,gBAC9B,IAAI,EAAE,QAAQ;AAAA;AAAA;AAAA;AAAA,UAIpB;AAAA,YACE,MAAM;AAAA,YACN,MAAM,EAAE,MAAM;AAAA,YACd,QAAQ;AAAA,cACN,OAAO;AAAA,gBACL,MAAM,EAAE,OAAO;AAAA,gBACf,QAAQ,EAAE,OAAO;AAAA,gBACjB,OAAO,EAAE,OAAO;AAAA;AAAA,cAElB,QAAQ;AAAA,gBACN,GAAG,EAAE,OAAO,UAAU,OAAO;AAAA,gBAC7B,IAAI,EAAE,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAS5B,SACE,sCAAC,UAAD;AAAA,IACE;AAAA,IACA;AAAA;AAAA;;;AHtQN,IAAM,iCAAiC,CAAC,aAAa;AAYtC,yCAAyC,OAAO;AAC7D,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,MACE;AAEJ,QAAM,UAAU;AAGhB,QAAM,CAAC;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KACC;AAAA,IACD;AAAA,OACG,gBAAgB,6BAA6B,mBAAmB;AAErE,QAAM,CAAC,OAAO,QAAQ,gBAAgB;AACtC,QAAM,CAAC,MAAM,QAAQ,aAAa;AAClC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,SACF;AAGF,QAAM,CAAC,4BAA4B,iCAAiC,YAAW,CAAC,MAAM;AACpF,UAAM,WAAW,CAAC;AAClB,+BAA2B,WAAW,UAAU;AAChD,WAAO;AAAA,KACN;AAGH,cAAU,MAAM;AACd;AACA;AAAA,KAEC,CAAC,SAAS;AAGb,QAAM,CAAC,kBAAkB,iBACvB,SAAS,SAAS,gBAAgB,OAAO,eAAe;AAE1D,QAAM,CAAC,SAAS,mBACd,SAAS,SAAS,gBAAgB,QAAQ;AAE5C,QAAM,CAAC,YAAY,gBACjB,SAAS,SAAS,gBAAgB,QAAQ;AAG5C,QAAM,CAAC,eAAe,QAAQ,iBAAiB,uBAC7C,gBAAgB,OAAO,UAAU,oBACjC,eAAe,kBAAkB,cAAc,4BAC/C;AAGF,QAAM,oBAAoB,iBAAiB,cAAc,UAAU,IAC/D,cAAc,KACd;AACJ,SACE,sCAAC,WAAD;AAAA,IACE,OAAO,yBAA0B,oBAAoB,KAAK,uBAAuB;AAAA,IACjF;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,SACE,sCAAC,8BAAD;AAAA,MACE;AAAA,MACA;AAAA;AAAA,KAIJ,sCAAC,OAAD;AAAA,IAAK,KAAK;AAAA,IAAc,WAAU;AAAA,KAC/B,gBACC,sCAAC,uBAAD;AAAA,IACE,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,OAGF,sCAAC,QAAD,MAAM;AAAA;;;AIpGhB,IAAM,WAAW;AAAA,EACf,aAAa;AAAA,EACb,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,UAAU;AAAA,EACV,aAAa;AAAA,EACb,SAAS;AAAA,EACT,SAAS;AAAA,EACT,iBAAiB;AAAA,EACjB,cAAc;AAAA,EACd,qBAAqB;AAAA,EACrB,iBAAiB;AAAA,EACjB,mBAAmB;AAAA,EAGnB,SAAS;AAAA;AAGJ,sBAAsB,OAAM;AACjC,QAAM,YAAY,SAAS;AAC3B,MAAI,cAAc,QAAW;AAC3B,UAAM,IAAI,MAAM,kCAAkC;AAAA;AAEpD,SAAO,SAAS;AAAA;;;ACjBX,8CAA8C,QAAQ,kBAAkB;AApB/E;AAqBE,QAAM,cAAc,OAAO,KAAK,yCAAQ,sBAAR,oBAA4B,sBAAqB;AACjF,QAAM,kBAAkB,OAAO,OAAO,IAAI,OAAE;AAtB9C;AAsBiD,oBAAE,uBAAF,oBAAuB;AAAA;AACtE,SAAO,MAAM,KAAK,IAAI,IAAI,CAAC,GAAG,aAAa,GAAG;AAAA;AAYhD,sCAAsC,QAAQ,kBAAkB,YAAY;AAnC5E;AAoCE,QAAM,YAAY,aAAa,qCAAqC,QAAQ;AAC5E,QAAM,YAAY,iCACb,SADa;AAAA,IAEhB,mBAAmB,iCACd,OAAO,oBADO;AAAA,OAEhB,mBAAmB,iCACf,wCAAQ,sBAAR,oBAA4B,oBADb;AAAA,SAGjB,YAAY;AAAA;AAAA;AAAA,IAGjB,QAAQ,OAAO,OAAO,IAAI,eAAU;AA/CxC;AA+C4C,8CACnC,YADmC;AAAA,QAEtC,oBAAoB,kCACf,UAAU,qBAIX,6BAA6B,UAAU,WAAW,SAAS,qBACxD,CAAC,kBAAU,uBAAV,oBAA+B,qBACjC;AAAA,WAGC,mBAAmB;AAAA,YAClB;AAAA;AAAA;AAAA;AAIZ,SAAO;AAAA;AAYT,yCAAyC,QAAQ,kBAAkB,YAAY;AAC7E,QAAM,YAAY,iCACb,SADa;AAAA,IAEhB,QAAQ,CAAC,GAAG,OAAO;AAAA;AAErB,QAAM,YAAY;AAClB,YAAU,OAAO,QAAQ,CAAC,WAAW,MAAM;AAlF7C;AAqFI,QAAI,6BAA6B,UAAU,WAAW,SAAS,qBAC1D,CAAC,kBAAU,uBAAV,oBAA+B,oBACnC;AACA,YAAM,YAAY,aAAa;AAAA,QAC7B,GAAG,qCAAqC,QAAQ;AAAA,QAChD,GAAG,OAAO,KAAK;AAAA;AAEjB,gBAAU,aAAa;AACvB,gBAAU,OAAO,KAAK,iCACjB,YADiB;AAAA,QAEpB,oBAAoB,iCACf,UAAU,qBADK;AAAA,WAEjB,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAK5B,YAAU,oBAAoB,iCACzB,UAAU,oBADe;AAAA,KAE3B,mBAAmB,kCACf,UAAU,kBAAkB,oBAE5B;AAAA;AAGP,SAAO;AAAA;AAGT,wBAAwB,QAAQ;AAC9B,MAAI,YAAY;AAChB,QAAM,EAAE,QAAQ,aAAa;AAG7B,SAAO,OAAO,oBAAoB,QAAQ,CAAC,qBAAqB;AAI9D,UAAM,uBAAuB,CAAC,OAC3B,MAAM,OAAE;AA3Hf;AA4HQ,cAAC,6BAA6B,EAAE,WAAW,SAAS,qBACzC,UAAE,uBAAF,oBAAuB;AAAA;AAEtC,QAAI,sBAAsB;AAExB,UAAI,eAAe,4BAA4B;AAE/C,UAAI,qBAAqB,aAAa,SAAS,UAAU,GAAG;AAG1D,uBAAe,SAAS,GAAG;AAAA;AAO7B,UAAI,oCAAoC,SAAS,mBAAmB;AAClE,oBAAY,gCAAgC,WAAW,kBAAkB;AAAA,aACpE;AACL,oBAAY,6BAA6B,WAAW,kBAAkB;AAAA;AAAA;AAAA;AAK5E,SAAO;AAAA;AAaF,oBAAoB,QAAQ;AACjC,MAAI,OAAO,iBAAiB,QAAQ;AAClC,WAAO,eAAe;AAAA;AAExB,SAAO;AAAA;AAGF,4BAA4B,WAAW;AAE5C,MAAI,aAAa;AACjB,MAAI;AACJ,MAAI;AAAiB,MACnB;AAEF,KAAG;AACD,kBAAc,WAAW;AAEzB,QAAI,CAAC,OAAO,KAAK,iBAAiB,SAAS,cAAc;AACvD,aAAO,CAAC;AAAA,QACN,OAAO;AAAA,QACP,cAAc;AAAA,SACb;AAAA;AAGL,KAAC,kBAAkB,mBAAmB,gBAAgB;AAGtD,UAAM,cAAc,iBAAiB;AACrC,QAAI,CAAC,aAAa;AAChB,YAAM,gBAAgB,KAAK,UAAU,iBAAiB,QAAQ,MAAM;AACpE,aAAO,CAAC;AAAA,QACN,OAAO;AAAA,QACP,cAAc;AAAA,SACb;AAAA;AAGL,QAAI,iBAAiB;AACnB,mBAAa,gBAAgB;AAAA;AAAA,WAExB;AAGT,UAAQ,eAAe,uBAAgB,gBAAY;AACnD,UAAQ,KAAK,SAAS,KAAK,UAAU;AACrC,UAAQ,KAAK,KAAK,UAAU,YAAY,MAAM;AAC9C,UAAQ;AAER,SAAO,CAAC,YAAY;AAAA;;;AnD9LtB,IAAM,oBAAoB,wBAAwB;AAAA,EAChD,eAAe;AAAA;AAsBF,kBAAkB,OAAO;AACtC,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,yBAAyB;AAAA,MACvB;AAOJ,QAAM,CAAC,iBAAiB,WAAW,UAAQ,MAAM;AAE/C,QAAI,CAAC,QAAQ;AACX,aAAO,CAAC;AAAA,QACN,OAAO;AAAA,QACP,aAAa;AAAA,SACZ;AAAA;AAGL,QAAI,CAAC,OAAO,SAAS;AACnB,aAAO,CAAC;AAAA,QACN,OAAO;AAAA,QACP,aAAa;AAAA,SACZ;AAAA;AAGL,UAAM,CAAC,gBAAgB,kBAAkB,mBAAmB;AAC5D,QAAI,gBAAgB;AAElB,YAAM,oBAAoB,WAAW;AACrC,aAAO,CAAC,mBAAmB;AAAA;AAE7B,WAAO,CAAC,gBAAgB;AAAA,KACvB,CAAC;AAIJ,cAAU,MAAM;AACd,QAAI,WAAW,CAAC,UAAQ,iBAAiB,WAAW,gBAAgB;AAClE,qBAAe;AAAA;AAAA,KAEhB,CAAC,SAAS,QAAQ,iBAAiB;AAEtC,SAAO,UACL,sCAAC,gBAAD;AAAA,IAAgB;AAAA,KACd,sCAAC,eAAD;AAAA,IAAe,OAAO,SAAS;AAAA,KAC7B,sCAAC,oBAAD;AAAA,IAAoB,aAAa;AAAA,KAC/B,sCAAC,mBAAD;AAAA,IAAmB,aAAa;AAAA,KAC9B,sCAAC,cAAD;AAAA,IACE,QAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MAEF,sCAAC,mBAAD;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,WAOV,sCAAC,SAAD;AAAA,IACE;AAAA,KACI;AAAA;;;AJ3GV,uBAAuB,OAAO;AAC5B,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,MACE;AACJ,QAAM,CAAC,WAAW,gBAAgB,WAAS;AAC3C,QAAM,cAAc;AACpB,cAAU,MAAM;AACd,aAAS,KAAK,CAAC,MAAM;AACnB,kBAAY,UAAU;AACtB,mBAAa;AAAA;AAAA,KAEd,CAAC;AACJ,SAAQ,CAAC,YAAY,QAAM,cAAc,YAAY,WAAW,sCAAC,SAAD;AAAA,IAAS,OAAM;AAAA,IAAa;AAAA;AAAA;AAG9F,6BAA6B,UAAU;AACrC,SAAO;AAAA,UACC,SAAS;AAAA,cACL,SAAS;AAAA,kBACL,SAAS;AAAA,kBACT,SAAS;AAAA,YACf,SAAS;AAAA,WACV,SAAS;AAAA;AAIpB,uBAAuB,UAAU,OAAO,OAAO;AAC7C,MAAI,CAAC,SAAS,IAAI;AAChB,WAAO,QAAQ,QACb,MACE,sCAAC,SAAD;AAAA,MACE,OAAM;AAAA,MACN,cAAc,oBAAoB;AAAA,MAClC;AAAA;AAAA;AAKR,SAAO,SAAS,OAAO,KAAK,CAAC,SAAS;AACpC,QAAI;AACF,YAAM,SAAS,KAAK,MAAM;AAC1B,aAAO,QAAQ,QAAQ,MACrB,sCAAC,UAAD;AAAA,QACE;AAAA,QACA;AAAA,QAEA,gBAAgB,QAAQ,QAAQ,MAAM;AAAA,QACtC,wBAAwB;AAAA;AAAA,aAGrB,GAAP;AACA,aAAO,QAAQ,QAAQ,MACrB,sCAAC,SAAD;AAAA,QACE,OAAM;AAAA,QACN,cAAc,oBAAoB;AAAA,QAClC,aAAa,GAAG,EAAE,YAAY;AAAA,QAC9B;AAAA;AAAA;AAAA;AAAA;AAYV,uBAAuB,OAAO;AAC5B,SAAQ,CAAC,SAAS,QAAQ,SAAS,SAAS,QAAQ;AAAA;AAa/C,mBAAmB,QAAQ;AAChC,QAAM,EAAE,YAAY,MAAM,iBAAiB,UAAU;AACrD,QAAM,YAAY,IAAI,gBAAgB,OAAO,SAAS;AACtD,QAAM,YAAY,UAAU,IAAI;AAChC,QAAM,QAAQ,UAAU,IAAI,aAAa;AACzC,QAAM,aAAa,UAAU,IAAI;AACjC,QAAM,UAAU,UAAU,IAAI,YAAY;AAC1C,QAAM,QAAQ,cAAc,UAAU,IAAI;AAE1C,MAAI,WAAW;AACb,UAAM,SAAS,UAAU;AACzB,WACE,sCAAC,UAAD;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MAEA,gBAAiB,QAAQ,QAAQ,MAAM;AAAA,MACvC,wBAAwB;AAAA;AAAA;AAI9B,MAAI,YAAY;AACd,UAAM,kBAAkB,MAAM,YAC3B,KAAK,cAAY,cAAc,UAAU,OAAO,QAChD,MAAM,WAAS,QAAQ,QAAQ,MAC9B,sCAAC,SAAD;AAAA,MACE,OAAM;AAAA,MACN,aAAa,MAAM;AAAA,MACnB;AAAA;AAGN,WACE,sCAAC,eAAD;AAAA,MAAe,UAAU;AAAA,MAAiB;AAAA;AAAA;AAG9C,QAAM,WAAU,YAAY;AAC5B,SAAQ,sCAAC,SAAD;AAAA,IAAS,SAAS;AAAA,IAAS;AAAA,IAAc;AAAA;AAAA;;;AwDlInD;AACA;AAEA,IAAM,kBAAkB;AACxB,IAAM,6BAA6B;AACnC,IAAM,uBAAuB;AAC7B,IAAM,sBAAsB;AAE5B,wBAAwB;AACtB,QAAM,EAAE,YAAY,OAAO,MAAM,OAAO,UAAU;AAClD,SAAO,QAAQ;AAAA;AAIjB,IAAM,0BAA0B;AAAA,EAC9B,QAAQ;AAAA,EACR,qBAAqB;AAAA,EACrB,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,SAAS;AAAA;AAGX,sCAA+C;AAAA,EAC7C,YAAY,SAAS;AACnB,SAAK,UAAU;AAAA;AAAA;AAcZ,yBAAyB;AAAA,EAC9B;AAAA,EACA,yBAAyB,MAAM;AAAA;AAAA,GAC9B;AACD,QAAM,iBAAiB,8BAA8B,KAAK,UAAU;AACpE,QAAM,YAAY,GAAG,uBAAuB,eAAe,UAAU,wBAAwB,mBAAmB,8BAA8B;AAC9I,QAAM,UAAU;AAChB,QAAM,YAAY,wBAAwB;AAC1C,MAAI,UAAU,SAAS,WAAW;AAChC,UAAM,aAAa,OAAO,QAAQ,yBAC/B,OAAO,WAAS,MAAM,KAAK,UAAU,QACrC,IAAI,WAAS,MAAM;AACtB,UAAM,UAAU,oBAAoB,eAAe,kCAAkC,cAAc,8BAA8B,WAAW,KAAK,SAAS;AAC1J,YAAQ,MAAM;AACd,2BAAuB,EAAE,SAAS;AAAA;AAEpC,SAAO;AAAA;AAWF,+BAA+B,aAAa;AACjD,QAAM,SAAS,IAAI,gBAAgB,YAAY,QAAQ,KAAK;AAC5D,QAAM,uBAAuB,OAAO,IAAI;AACxC,QAAM,qBAAqB,OAAO,OAAO,IAAI;AAC7C,MAAI,uBAAuB,qBAAqB,QAAQ;AACtD,UAAM,IAAI,0BAA0B,2BAA2B,qBAAqB,wBAAwB;AAAA;AAE9G,QAAM,WAAU,OAAO,IAAI;AAC3B,MAAI,aAAY,iBAAiB;AAC/B,UAAM,OAAO,KAAK,MAAM,kCAAkC;AAC1D,WAAO;AAAA;AAET,QAAM,IAAI,MAAM;AAAA;;;ACtEX,sCAAgC;AAAA,EAOrC,YAAY,KAAK,UAAU,UAAU;AACnC,SAAK,OAAO;AAAA,MACV;AAAA,MACA,MAAM;AAAA,MACN;AAAA;AAAA;AAAA,EAOJ,SAAS;AACP,WAAO,KAAK;AAAA;AAAA;AAOT,kCAA4B;AAAA,EAOjC,YAAY,KAAK,OAAM,cAAa;AAClC,SAAK,UAAU;AAAA,MACb;AAAA,MACA;AAAA,MACA;AAAA,MACA,OAAO;AAAA;AAAA;AAAA,EAWX,QAAQ,KAAK,UAAU,UAAU;AAC/B,SAAK,QAAQ,MAAM,KAAK,IAAI,0BAA0B,KAAK,UAAU;AACrE,WAAO;AAAA;AAAA,EAMT,SAAS;AACP,WAAO,iCACF,KAAK,UADH;AAAA,MAEL,OAAO,KAAK,QAAQ,MAAM,IAAI,OAAK,EAAE;AAAA;AAAA;AAAA;AAQpC,+BAAyB;AAAA,EAW9B,YAAY,WAAW,oBAAoB,GAAG,GAAG,GAAG,GAAG;AACrD,SAAK,OAAO;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAAA;AAAA,EAUJ,mBAAmB,MAAM;AACvB,UAAM,UAAU;AAChB,YAAQ,QAAQ,CAAC,WAAW;AAC1B,WAAK,KAAK,mBAAmB,OAAO,SAAS,OAAO;AAAA;AAEtD,WAAO;AAAA;AAAA,EAUT,QAAQ,GAAG,GAAG,GAAG,GAAG;AAClB,SAAK,KAAK,IAAI;AACd,SAAK,KAAK,IAAI;AACd,SAAK,KAAK,IAAI;AACd,SAAK,KAAK,IAAI;AAAA;AAAA,EAMhB,SAAS;AACP,WAAO,KAAK;AAAA;AAAA;AAOT,sCAAgC;AAAA,EACrC,YAAY,OAAO;AACjB,SAAK,QAAQ;AAAA;AAAA;AAOV,sCAAgC;AAAA,EACrC,YAAY,OAAO;AACjB,SAAK,QAAQ;AAAA;AAAA;AAUV,oBAAoB,OAAO;AAChC,QAAM,QAAQ,IAAI,0BAA0B;AAC5C,SAAO;AAAA;AASF,oBAAoB,OAAO;AAChC,QAAM,QAAQ,IAAI,0BAA0B;AAC5C,SAAO;AAAA;AAMF,4CAAsC;AAAA,EAM3C,YAAY,OAAO,QAAQ;AACzB,SAAK,QAAQ;AACb,SAAK,SAAS;AACd,SAAK,SAAS;AAAA;AAAA,EAQhB,SAAS,QAAQ;AACf,SAAK,SAAS;AACd,WAAO;AAAA;AAAA;AAOJ,2BAAqB;AAAA,EAM1B,YAAY,QAAO,QAAW,eAAc,QAAW;AACrD,SAAK,SAAS;AAAA,MACZ,SAAS;AAAA,MACT;AAAA,MACA;AAAA,MACA,UAAU;AAAA,MACV,mBAAmB;AAAA,MACnB,QAAQ;AAAA,MACR,cAAc;AAAA;AAAA;AAAA,EAalB,WAAW,QAAO,QAAW,eAAc,QAAW,UAAU,QAAW;AACzE,UAAM,EAAE,QAAQ,WAAW;AAC3B,UAAM,kBAAkB,KAAK,OAAO,SAAS,IAAI,OAAK,EAAE,QAAQ;AAChE,UAAM,UAAW,OAAO,aAAa;AACrC,UAAM,aAAa,IAAI,sBAAsB,SAAS,OAAM;AAC5D,SAAK,OAAO,SAAS,KAAK;AAC1B,UAAM,CAAC,YAAY,KAAK,gBAAgB,mBAAmB;AAC3D,aAAS,SAAS;AAClB,WAAO;AAAA;AAAA,EAiBT,QAAQ,SAAS,WAAW,SAAS;AACnC,UAAM;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,UAAU;AAAA,QACR,WAAW;AACf,UAAM,iBACJ,KAAK,OAAO,kBAAkB,mBAAmB,WAC7C,OAAO,QAAQ,KAAK,OAAO,kBAAkB,mBAAmB,UAE/D,OAAO,CAAC,CAAC,WAAW,mBAAkB,cAAa,WAAW,QAAQ,QAAQ,KAC9E,IAAI,CAAC,CAAC,eAAe,aACtB;AAEN,QAAI;AACJ,QAAI,eAAe,WAAW,GAAG;AAC/B,OAAC,gBAAgB;AAAA,WACZ;AACL,YAAM,IAAI,MAAM;AAAA;AAElB,UAAM,qBAAqB;AAAA,OACxB,mBAAmB,UAAU;AAAA;AAEhC,UAAM,UAAU,IAAI,mBAAmB,WAAW,oBAAoB,GAAG,GAAG,GAAG;AAC/E,QAAI,SAAS;AACX,YAAM,CAAC,WAAW,KAAK,gBAAgB,mBAAmB;AAC1D,cAAQ,SAAS;AACjB,cAAQ,gBAAgB;AAAA;AAE1B,SAAK,OAAO,OAAO,KAAK;AACxB,WAAO;AAAA;AAAA,EAST,mBAAmB,MAAM;AACvB,UAAM,SAAS;AACf,UAAM,SAAS;AACf,WAAO,QAAQ,CAAC,UAAU;AACxB,YAAM,aACJ,KAAK,OAAO,kBAAkB,SAC1B,OAAO,KAAK,KAAK,OAAO,kBAAkB,UAC1C;AAEN,YAAM,QAAQ,IAAI,gCAAgC,OAAO,aAAa;AACtE,UAAI,CAAC,KAAK,OAAO,kBAAkB,MAAM,QAAQ;AAC/C,aAAK,OAAO,kBAAkB,MAAM,SAAS;AAAA;AAE/C,WAAK,OAAO,kBAAkB,MAAM,OAAO,MAAM,UAAU;AAC3D,aAAO,KAAK;AAAA;AAEd,WAAO;AAAA;AAAA,EAWT,UAAU,OAAO,QAAQ,UAAU,MAAM;AACvC,UAAM,UAAU,KAAK,gBAAgB,GAAG;AACxC,UAAM,QAAQ,CAAC,SAAS;AACtB,cAAQ,QAAQ,CAAC,WAAW;AAC1B,aAAK,gBAAgB;AAAA;AAAA;AAGzB,QAAI,MAAM,QAAQ,YAAY,QAAQ,WAAW,OAAO,QAAQ;AAC9D,cAAQ,QAAQ,CAAC,QAAQ,MAAM;AAC7B,eAAO,SAAS,QAAQ;AAAA;AAAA;AAG5B,WAAO;AAAA;AAAA,EAST,OAAO,YAAY;AACjB,uBAAmB,KAAK,MAAM,MAAM,MAAM,MAAM;AAC9C,YAAM,IAAI,OAAO;AACjB,YAAM,IAAI,OAAO;AACjB,UAAI,eAAe,oBAAoB;AACrC,YAAI,QAAQ,MAAM,MAAM,GAAG;AAAA,iBAClB,eAAe,2BAA2B;AACnD,cAAM,EAAE,UAAU;AAClB,cAAM,WAAW,MAAM;AACvB,cAAM,QAAQ,CAAC,MAAM,MAAM;AACzB,oBAAU,MAAM,OAAQ,IAAI,WAAY,GAAG,OAAQ,IAAI,WAAa,KAAI,IAAI,MAAM;AAAA;AAAA,iBAE3E,eAAe,2BAA2B;AACnD,cAAM,EAAE,UAAU;AAClB,cAAM,WAAW,MAAM;AACvB,cAAM,QAAQ,CAAC,MAAM,MAAM;AACzB,oBAAU,MAAM,MAAM,MAAM,OAAQ,IAAI,WAAY,GAAG,OAAQ,IAAI,WAAa,KAAI;AAAA;AAAA;AAAA;AAK1F,cAAU,YAAY,GAAG,IAAI,GAAG;AAEhC,WAAO;AAAA;AAAA,EAOT,SAAS;AACP,WAAO,iCACF,KAAK,SADH;AAAA,MAEL,UAAU,KAAK,OAAO,SAAS,IAAI,OAAK,EAAE;AAAA,MAC1C,mBAAmB,YACjB,OAAO,QAAQ,KAAK,OAAO,mBAAmB,IAAI,CAAC,CAAC,OAAO,aAAc;AAAA,QACvE;AAAA,QACA,YACE,OAAO,QAAQ,SAAS,IAAI,CAAC,CAAC,YAAY,YAAa;AAAA,UACrD;AAAA,UACA,OAAO;AAAA;AAAA;AAAA,MAKf,QAAQ,KAAK,OAAO,OAAO,IAAI,OAAK,EAAE;AAAA;AAAA;AAAA,SAWnC,SAAS,QAAQ;AACtB,UAAM,EAAE,aAAM,8BAAgB;AAC9B,UAAM,KAAK,IAAI,eAAe,OAAM;AACpC,WAAO,SAAS,QAAQ,CAAC,MAAM;AAC7B,YAAM,aAAa,GAAG,WAAW,EAAE,MAAM,EAAE,aAAa,EAAE,KAAK,EAAE;AACjE,QAAE,MAAM,QAAQ,CAAC,MAAM;AACrB,mBAAW,QACT,EAAE,KACF,EAAE,MACF,EAAE;AAAA;AAAA;AAIR,WAAO,KAAK,OAAO,mBAAmB,QAAQ,CAAC,UAAU;AACvD,UAAI,UAAU,mBAAmB,SAAS;AACxC,cAAM,OAAO,OAAO,kBAAkB;AACtC,WAAG,OAAO,kBAAkB,SAAS;AACrC,eAAO,QAAQ,MAAM,QAAQ,CAAC,CAAC,YAAY,iBAAiB;AAC1D,gBAAM,QAAQ,IAAI,gCAAgC,OAAO;AACzD,gBAAM,SAAS;AACf,aAAG,OAAO,kBAAkB,OAAO,cAAc;AAAA;AAAA;AAAA;AAIvD,WAAO,OAAO,QAAQ,CAAC,MAAM;AAC3B,YAAM,UAAU,IAAI,mBAAmB,EAAE,WAAW,EAAE,oBAAoB,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;AAC3F,SAAG,OAAO,OAAO,KAAK;AAAA;AAExB,WAAO;AAAA;AAAA;",
  "names": []
}
